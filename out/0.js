(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[0],{

/***/ "./node_modules/@babel/runtime/helpers/construct.js":
/*!**********************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/construct.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var setPrototypeOf = __webpack_require__(/*! ./setPrototypeOf.js */ \"./node_modules/@babel/runtime/helpers/setPrototypeOf.js\");\n\nvar isNativeReflectConstruct = __webpack_require__(/*! ./isNativeReflectConstruct.js */ \"./node_modules/@babel/runtime/helpers/isNativeReflectConstruct.js\");\n\nfunction _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    module.exports = _construct = Reflect.construct, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;\n  } else {\n    module.exports = _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nmodule.exports = _construct, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jb25zdHJ1Y3QuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jb25zdHJ1Y3QuanM/YjE3YyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgc2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKFwiLi9zZXRQcm90b3R5cGVPZi5qc1wiKTtcblxudmFyIGlzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IHJlcXVpcmUoXCIuL2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdC5qc1wiKTtcblxuZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7XG4gIGlmIChpc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSkge1xuICAgIG1vZHVsZS5leHBvcnRzID0gX2NvbnN0cnVjdCA9IFJlZmxlY3QuY29uc3RydWN0LCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gbW9kdWxlLmV4cG9ydHM7XG4gIH0gZWxzZSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBfY29uc3RydWN0ID0gZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7XG4gICAgICB2YXIgYSA9IFtudWxsXTtcbiAgICAgIGEucHVzaC5hcHBseShhLCBhcmdzKTtcbiAgICAgIHZhciBDb25zdHJ1Y3RvciA9IEZ1bmN0aW9uLmJpbmQuYXBwbHkoUGFyZW50LCBhKTtcbiAgICAgIHZhciBpbnN0YW5jZSA9IG5ldyBDb25zdHJ1Y3RvcigpO1xuICAgICAgaWYgKENsYXNzKSBzZXRQcm90b3R5cGVPZihpbnN0YW5jZSwgQ2xhc3MucHJvdG90eXBlKTtcbiAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICB9LCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gbW9kdWxlLmV4cG9ydHM7XG4gIH1cblxuICByZXR1cm4gX2NvbnN0cnVjdC5hcHBseShudWxsLCBhcmd1bWVudHMpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IF9jb25zdHJ1Y3QsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBtb2R1bGUuZXhwb3J0czsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/@babel/runtime/helpers/construct.js\n");

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/isNativeFunction.js":
/*!*****************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/isNativeFunction.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("function _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}\n\nmodule.exports = _isNativeFunction, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pc05hdGl2ZUZ1bmN0aW9uLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaXNOYXRpdmVGdW5jdGlvbi5qcz9jNWY3Il0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIF9pc05hdGl2ZUZ1bmN0aW9uKGZuKSB7XG4gIHJldHVybiBGdW5jdGlvbi50b1N0cmluZy5jYWxsKGZuKS5pbmRleE9mKFwiW25hdGl2ZSBjb2RlXVwiKSAhPT0gLTE7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gX2lzTmF0aXZlRnVuY3Rpb24sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBtb2R1bGUuZXhwb3J0czsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/@babel/runtime/helpers/isNativeFunction.js\n");

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/isNativeReflectConstruct.js":
/*!*************************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/isNativeReflectConstruct.js ***!
  \*************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nmodule.exports = _isNativeReflectConstruct, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QuanM/NmY4ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkge1xuICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwidW5kZWZpbmVkXCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7XG4gIGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7XG4gIGlmICh0eXBlb2YgUHJveHkgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIHRydWU7XG5cbiAgdHJ5IHtcbiAgICBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0LCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gbW9kdWxlLmV4cG9ydHM7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/@babel/runtime/helpers/isNativeReflectConstruct.js\n");

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("function _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}\n\nmodule.exports = _taggedTemplateLiteral, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90YWdnZWRUZW1wbGF0ZUxpdGVyYWwuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90YWdnZWRUZW1wbGF0ZUxpdGVyYWwuanM/NTY0MCJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBfdGFnZ2VkVGVtcGxhdGVMaXRlcmFsKHN0cmluZ3MsIHJhdykge1xuICBpZiAoIXJhdykge1xuICAgIHJhdyA9IHN0cmluZ3Muc2xpY2UoMCk7XG4gIH1cblxuICByZXR1cm4gT2JqZWN0LmZyZWV6ZShPYmplY3QuZGVmaW5lUHJvcGVydGllcyhzdHJpbmdzLCB7XG4gICAgcmF3OiB7XG4gICAgICB2YWx1ZTogT2JqZWN0LmZyZWV6ZShyYXcpXG4gICAgfVxuICB9KSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gX3RhZ2dlZFRlbXBsYXRlTGl0ZXJhbCwgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IG1vZHVsZS5leHBvcnRzOyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js\n");

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/toArray.js":
/*!********************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/toArray.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var arrayWithHoles = __webpack_require__(/*! ./arrayWithHoles.js */ \"./node_modules/@babel/runtime/helpers/arrayWithHoles.js\");\n\nvar iterableToArray = __webpack_require__(/*! ./iterableToArray.js */ \"./node_modules/@babel/runtime/helpers/iterableToArray.js\");\n\nvar unsupportedIterableToArray = __webpack_require__(/*! ./unsupportedIterableToArray.js */ \"./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js\");\n\nvar nonIterableRest = __webpack_require__(/*! ./nonIterableRest.js */ \"./node_modules/@babel/runtime/helpers/nonIterableRest.js\");\n\nfunction _toArray(arr) {\n  return arrayWithHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableRest();\n}\n\nmodule.exports = _toArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90b0FycmF5LmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdG9BcnJheS5qcz80ODBmIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBhcnJheVdpdGhIb2xlcyA9IHJlcXVpcmUoXCIuL2FycmF5V2l0aEhvbGVzLmpzXCIpO1xuXG52YXIgaXRlcmFibGVUb0FycmF5ID0gcmVxdWlyZShcIi4vaXRlcmFibGVUb0FycmF5LmpzXCIpO1xuXG52YXIgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkgPSByZXF1aXJlKFwiLi91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheS5qc1wiKTtcblxudmFyIG5vbkl0ZXJhYmxlUmVzdCA9IHJlcXVpcmUoXCIuL25vbkl0ZXJhYmxlUmVzdC5qc1wiKTtcblxuZnVuY3Rpb24gX3RvQXJyYXkoYXJyKSB7XG4gIHJldHVybiBhcnJheVdpdGhIb2xlcyhhcnIpIHx8IGl0ZXJhYmxlVG9BcnJheShhcnIpIHx8IHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFycikgfHwgbm9uSXRlcmFibGVSZXN0KCk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gX3RvQXJyYXksIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBtb2R1bGUuZXhwb3J0czsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/@babel/runtime/helpers/toArray.js\n");

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/wrapNativeSuper.js":
/*!****************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/wrapNativeSuper.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var getPrototypeOf = __webpack_require__(/*! ./getPrototypeOf.js */ \"./node_modules/@babel/runtime/helpers/getPrototypeOf.js\");\n\nvar setPrototypeOf = __webpack_require__(/*! ./setPrototypeOf.js */ \"./node_modules/@babel/runtime/helpers/setPrototypeOf.js\");\n\nvar isNativeFunction = __webpack_require__(/*! ./isNativeFunction.js */ \"./node_modules/@babel/runtime/helpers/isNativeFunction.js\");\n\nvar construct = __webpack_require__(/*! ./construct.js */ \"./node_modules/@babel/runtime/helpers/construct.js\");\n\nfunction _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  module.exports = _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return construct(Class, arguments, getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return setPrototypeOf(Wrapper, Class);\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;\n  return _wrapNativeSuper(Class);\n}\n\nmodule.exports = _wrapNativeSuper, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy93cmFwTmF0aXZlU3VwZXIuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy93cmFwTmF0aXZlU3VwZXIuanM/YTEyOCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKFwiLi9nZXRQcm90b3R5cGVPZi5qc1wiKTtcblxudmFyIHNldFByb3RvdHlwZU9mID0gcmVxdWlyZShcIi4vc2V0UHJvdG90eXBlT2YuanNcIik7XG5cbnZhciBpc05hdGl2ZUZ1bmN0aW9uID0gcmVxdWlyZShcIi4vaXNOYXRpdmVGdW5jdGlvbi5qc1wiKTtcblxudmFyIGNvbnN0cnVjdCA9IHJlcXVpcmUoXCIuL2NvbnN0cnVjdC5qc1wiKTtcblxuZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykge1xuICB2YXIgX2NhY2hlID0gdHlwZW9mIE1hcCA9PT0gXCJmdW5jdGlvblwiID8gbmV3IE1hcCgpIDogdW5kZWZpbmVkO1xuXG4gIG1vZHVsZS5leHBvcnRzID0gX3dyYXBOYXRpdmVTdXBlciA9IGZ1bmN0aW9uIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpIHtcbiAgICBpZiAoQ2xhc3MgPT09IG51bGwgfHwgIWlzTmF0aXZlRnVuY3Rpb24oQ2xhc3MpKSByZXR1cm4gQ2xhc3M7XG5cbiAgICBpZiAodHlwZW9mIENsYXNzICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvblwiKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIF9jYWNoZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgaWYgKF9jYWNoZS5oYXMoQ2xhc3MpKSByZXR1cm4gX2NhY2hlLmdldChDbGFzcyk7XG5cbiAgICAgIF9jYWNoZS5zZXQoQ2xhc3MsIFdyYXBwZXIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIFdyYXBwZXIoKSB7XG4gICAgICByZXR1cm4gY29uc3RydWN0KENsYXNzLCBhcmd1bWVudHMsIGdldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yKTtcbiAgICB9XG5cbiAgICBXcmFwcGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xhc3MucHJvdG90eXBlLCB7XG4gICAgICBjb25zdHJ1Y3Rvcjoge1xuICAgICAgICB2YWx1ZTogV3JhcHBlcixcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gc2V0UHJvdG90eXBlT2YoV3JhcHBlciwgQ2xhc3MpO1xuICB9LCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gbW9kdWxlLmV4cG9ydHM7XG4gIHJldHVybiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfd3JhcE5hdGl2ZVN1cGVyLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gbW9kdWxlLmV4cG9ydHM7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/@babel/runtime/helpers/wrapNativeSuper.js\n");

/***/ }),

/***/ "./node_modules/base64-js/index.js":
/*!*****************************************!*\
  !*** ./node_modules/base64-js/index.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvYmFzZTY0LWpzL2luZGV4LmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2Jhc2U2NC1qcy9pbmRleC5qcz8xZmI1Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xuXG5leHBvcnRzLmJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoXG5leHBvcnRzLnRvQnl0ZUFycmF5ID0gdG9CeXRlQXJyYXlcbmV4cG9ydHMuZnJvbUJ5dGVBcnJheSA9IGZyb21CeXRlQXJyYXlcblxudmFyIGxvb2t1cCA9IFtdXG52YXIgcmV2TG9va3VwID0gW11cbnZhciBBcnIgPSB0eXBlb2YgVWludDhBcnJheSAhPT0gJ3VuZGVmaW5lZCcgPyBVaW50OEFycmF5IDogQXJyYXlcblxudmFyIGNvZGUgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLydcbmZvciAodmFyIGkgPSAwLCBsZW4gPSBjb2RlLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gIGxvb2t1cFtpXSA9IGNvZGVbaV1cbiAgcmV2TG9va3VwW2NvZGUuY2hhckNvZGVBdChpKV0gPSBpXG59XG5cbi8vIFN1cHBvcnQgZGVjb2RpbmcgVVJMLXNhZmUgYmFzZTY0IHN0cmluZ3MsIGFzIE5vZGUuanMgZG9lcy5cbi8vIFNlZTogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQmFzZTY0I1VSTF9hcHBsaWNhdGlvbnNcbnJldkxvb2t1cFsnLScuY2hhckNvZGVBdCgwKV0gPSA2MlxucmV2TG9va3VwWydfJy5jaGFyQ29kZUF0KDApXSA9IDYzXG5cbmZ1bmN0aW9uIGdldExlbnMgKGI2NCkge1xuICB2YXIgbGVuID0gYjY0Lmxlbmd0aFxuXG4gIGlmIChsZW4gJSA0ID4gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBzdHJpbmcuIExlbmd0aCBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNCcpXG4gIH1cblxuICAvLyBUcmltIG9mZiBleHRyYSBieXRlcyBhZnRlciBwbGFjZWhvbGRlciBieXRlcyBhcmUgZm91bmRcbiAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vYmVhdGdhbW1pdC9iYXNlNjQtanMvaXNzdWVzLzQyXG4gIHZhciB2YWxpZExlbiA9IGI2NC5pbmRleE9mKCc9JylcbiAgaWYgKHZhbGlkTGVuID09PSAtMSkgdmFsaWRMZW4gPSBsZW5cblxuICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gdmFsaWRMZW4gPT09IGxlblxuICAgID8gMFxuICAgIDogNCAtICh2YWxpZExlbiAlIDQpXG5cbiAgcmV0dXJuIFt2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuXVxufVxuXG4vLyBiYXNlNjQgaXMgNC8zICsgdXAgdG8gdHdvIGNoYXJhY3RlcnMgb2YgdGhlIG9yaWdpbmFsIGRhdGFcbmZ1bmN0aW9uIGJ5dGVMZW5ndGggKGI2NCkge1xuICB2YXIgbGVucyA9IGdldExlbnMoYjY0KVxuICB2YXIgdmFsaWRMZW4gPSBsZW5zWzBdXG4gIHZhciBwbGFjZUhvbGRlcnNMZW4gPSBsZW5zWzFdXG4gIHJldHVybiAoKHZhbGlkTGVuICsgcGxhY2VIb2xkZXJzTGVuKSAqIDMgLyA0KSAtIHBsYWNlSG9sZGVyc0xlblxufVxuXG5mdW5jdGlvbiBfYnl0ZUxlbmd0aCAoYjY0LCB2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuKSB7XG4gIHJldHVybiAoKHZhbGlkTGVuICsgcGxhY2VIb2xkZXJzTGVuKSAqIDMgLyA0KSAtIHBsYWNlSG9sZGVyc0xlblxufVxuXG5mdW5jdGlvbiB0b0J5dGVBcnJheSAoYjY0KSB7XG4gIHZhciB0bXBcbiAgdmFyIGxlbnMgPSBnZXRMZW5zKGI2NClcbiAgdmFyIHZhbGlkTGVuID0gbGVuc1swXVxuICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gbGVuc1sxXVxuXG4gIHZhciBhcnIgPSBuZXcgQXJyKF9ieXRlTGVuZ3RoKGI2NCwgdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikpXG5cbiAgdmFyIGN1ckJ5dGUgPSAwXG5cbiAgLy8gaWYgdGhlcmUgYXJlIHBsYWNlaG9sZGVycywgb25seSBnZXQgdXAgdG8gdGhlIGxhc3QgY29tcGxldGUgNCBjaGFyc1xuICB2YXIgbGVuID0gcGxhY2VIb2xkZXJzTGVuID4gMFxuICAgID8gdmFsaWRMZW4gLSA0XG4gICAgOiB2YWxpZExlblxuXG4gIHZhciBpXG4gIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gNCkge1xuICAgIHRtcCA9XG4gICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkpXSA8PCAxOCkgfFxuICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMSldIDw8IDEyKSB8XG4gICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAyKV0gPDwgNikgfFxuICAgICAgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAzKV1cbiAgICBhcnJbY3VyQnl0ZSsrXSA9ICh0bXAgPj4gMTYpICYgMHhGRlxuICAgIGFycltjdXJCeXRlKytdID0gKHRtcCA+PiA4KSAmIDB4RkZcbiAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDB4RkZcbiAgfVxuXG4gIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDIpIHtcbiAgICB0bXAgPVxuICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpKV0gPDwgMikgfFxuICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMSldID4+IDQpXG4gICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAweEZGXG4gIH1cblxuICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAxKSB7XG4gICAgdG1wID1cbiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSldIDw8IDEwKSB8XG4gICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAxKV0gPDwgNCkgfFxuICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMildID4+IDIpXG4gICAgYXJyW2N1ckJ5dGUrK10gPSAodG1wID4+IDgpICYgMHhGRlxuICAgIGFycltjdXJCeXRlKytdID0gdG1wICYgMHhGRlxuICB9XG5cbiAgcmV0dXJuIGFyclxufVxuXG5mdW5jdGlvbiB0cmlwbGV0VG9CYXNlNjQgKG51bSkge1xuICByZXR1cm4gbG9va3VwW251bSA+PiAxOCAmIDB4M0ZdICtcbiAgICBsb29rdXBbbnVtID4+IDEyICYgMHgzRl0gK1xuICAgIGxvb2t1cFtudW0gPj4gNiAmIDB4M0ZdICtcbiAgICBsb29rdXBbbnVtICYgMHgzRl1cbn1cblxuZnVuY3Rpb24gZW5jb2RlQ2h1bmsgKHVpbnQ4LCBzdGFydCwgZW5kKSB7XG4gIHZhciB0bXBcbiAgdmFyIG91dHB1dCA9IFtdXG4gIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgaSArPSAzKSB7XG4gICAgdG1wID1cbiAgICAgICgodWludDhbaV0gPDwgMTYpICYgMHhGRjAwMDApICtcbiAgICAgICgodWludDhbaSArIDFdIDw8IDgpICYgMHhGRjAwKSArXG4gICAgICAodWludDhbaSArIDJdICYgMHhGRilcbiAgICBvdXRwdXQucHVzaCh0cmlwbGV0VG9CYXNlNjQodG1wKSlcbiAgfVxuICByZXR1cm4gb3V0cHV0LmpvaW4oJycpXG59XG5cbmZ1bmN0aW9uIGZyb21CeXRlQXJyYXkgKHVpbnQ4KSB7XG4gIHZhciB0bXBcbiAgdmFyIGxlbiA9IHVpbnQ4Lmxlbmd0aFxuICB2YXIgZXh0cmFCeXRlcyA9IGxlbiAlIDMgLy8gaWYgd2UgaGF2ZSAxIGJ5dGUgbGVmdCwgcGFkIDIgYnl0ZXNcbiAgdmFyIHBhcnRzID0gW11cbiAgdmFyIG1heENodW5rTGVuZ3RoID0gMTYzODMgLy8gbXVzdCBiZSBtdWx0aXBsZSBvZiAzXG5cbiAgLy8gZ28gdGhyb3VnaCB0aGUgYXJyYXkgZXZlcnkgdGhyZWUgYnl0ZXMsIHdlJ2xsIGRlYWwgd2l0aCB0cmFpbGluZyBzdHVmZiBsYXRlclxuICBmb3IgKHZhciBpID0gMCwgbGVuMiA9IGxlbiAtIGV4dHJhQnl0ZXM7IGkgPCBsZW4yOyBpICs9IG1heENodW5rTGVuZ3RoKSB7XG4gICAgcGFydHMucHVzaChlbmNvZGVDaHVuayh1aW50OCwgaSwgKGkgKyBtYXhDaHVua0xlbmd0aCkgPiBsZW4yID8gbGVuMiA6IChpICsgbWF4Q2h1bmtMZW5ndGgpKSlcbiAgfVxuXG4gIC8vIHBhZCB0aGUgZW5kIHdpdGggemVyb3MsIGJ1dCBtYWtlIHN1cmUgdG8gbm90IGZvcmdldCB0aGUgZXh0cmEgYnl0ZXNcbiAgaWYgKGV4dHJhQnl0ZXMgPT09IDEpIHtcbiAgICB0bXAgPSB1aW50OFtsZW4gLSAxXVxuICAgIHBhcnRzLnB1c2goXG4gICAgICBsb29rdXBbdG1wID4+IDJdICtcbiAgICAgIGxvb2t1cFsodG1wIDw8IDQpICYgMHgzRl0gK1xuICAgICAgJz09J1xuICAgIClcbiAgfSBlbHNlIGlmIChleHRyYUJ5dGVzID09PSAyKSB7XG4gICAgdG1wID0gKHVpbnQ4W2xlbiAtIDJdIDw8IDgpICsgdWludDhbbGVuIC0gMV1cbiAgICBwYXJ0cy5wdXNoKFxuICAgICAgbG9va3VwW3RtcCA+PiAxMF0gK1xuICAgICAgbG9va3VwWyh0bXAgPj4gNCkgJiAweDNGXSArXG4gICAgICBsb29rdXBbKHRtcCA8PCAyKSAmIDB4M0ZdICtcbiAgICAgICc9J1xuICAgIClcbiAgfVxuXG4gIHJldHVybiBwYXJ0cy5qb2luKCcnKVxufVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/base64-js/index.js\n");

/***/ }),

/***/ "./node_modules/buffer/index.js":
/*!**************************************!*\
  !*** ./node_modules/buffer/index.js ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(global) {/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n\n\nvar base64 = __webpack_require__(/*! base64-js */ \"./node_modules/base64-js/index.js\")\nvar ieee754 = __webpack_require__(/*! ieee754 */ \"./node_modules/ieee754/index.js\")\nvar isArray = __webpack_require__(/*! isarray */ \"./node_modules/isarray/index.js\")\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../webpack/buildin/global.js */ \"./node_modules/webpack/buildin/global.js\")))//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvYnVmZmVyL2luZGV4LmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2J1ZmZlci9pbmRleC5qcz9iNjM5Il0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogVGhlIGJ1ZmZlciBtb2R1bGUgZnJvbSBub2RlLmpzLCBmb3IgdGhlIGJyb3dzZXIuXG4gKlxuICogQGF1dGhvciAgIEZlcm9zcyBBYm91a2hhZGlqZWggPGh0dHA6Ly9mZXJvc3Mub3JnPlxuICogQGxpY2Vuc2UgIE1JVFxuICovXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1wcm90byAqL1xuXG4ndXNlIHN0cmljdCdcblxudmFyIGJhc2U2NCA9IHJlcXVpcmUoJ2Jhc2U2NC1qcycpXG52YXIgaWVlZTc1NCA9IHJlcXVpcmUoJ2llZWU3NTQnKVxudmFyIGlzQXJyYXkgPSByZXF1aXJlKCdpc2FycmF5JylcblxuZXhwb3J0cy5CdWZmZXIgPSBCdWZmZXJcbmV4cG9ydHMuU2xvd0J1ZmZlciA9IFNsb3dCdWZmZXJcbmV4cG9ydHMuSU5TUEVDVF9NQVhfQllURVMgPSA1MFxuXG4vKipcbiAqIElmIGBCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVGA6XG4gKiAgID09PSB0cnVlICAgIFVzZSBVaW50OEFycmF5IGltcGxlbWVudGF0aW9uIChmYXN0ZXN0KVxuICogICA9PT0gZmFsc2UgICBVc2UgT2JqZWN0IGltcGxlbWVudGF0aW9uIChtb3N0IGNvbXBhdGlibGUsIGV2ZW4gSUU2KVxuICpcbiAqIEJyb3dzZXJzIHRoYXQgc3VwcG9ydCB0eXBlZCBhcnJheXMgYXJlIElFIDEwKywgRmlyZWZveCA0KywgQ2hyb21lIDcrLCBTYWZhcmkgNS4xKyxcbiAqIE9wZXJhIDExLjYrLCBpT1MgNC4yKy5cbiAqXG4gKiBEdWUgdG8gdmFyaW91cyBicm93c2VyIGJ1Z3MsIHNvbWV0aW1lcyB0aGUgT2JqZWN0IGltcGxlbWVudGF0aW9uIHdpbGwgYmUgdXNlZCBldmVuXG4gKiB3aGVuIHRoZSBicm93c2VyIHN1cHBvcnRzIHR5cGVkIGFycmF5cy5cbiAqXG4gKiBOb3RlOlxuICpcbiAqICAgLSBGaXJlZm94IDQtMjkgbGFja3Mgc3VwcG9ydCBmb3IgYWRkaW5nIG5ldyBwcm9wZXJ0aWVzIHRvIGBVaW50OEFycmF5YCBpbnN0YW5jZXMsXG4gKiAgICAgU2VlOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02OTU0MzguXG4gKlxuICogICAtIENocm9tZSA5LTEwIGlzIG1pc3NpbmcgdGhlIGBUeXBlZEFycmF5LnByb3RvdHlwZS5zdWJhcnJheWAgZnVuY3Rpb24uXG4gKlxuICogICAtIElFMTAgaGFzIGEgYnJva2VuIGBUeXBlZEFycmF5LnByb3RvdHlwZS5zdWJhcnJheWAgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyBhcnJheXMgb2ZcbiAqICAgICBpbmNvcnJlY3QgbGVuZ3RoIGluIHNvbWUgc2l0dWF0aW9ucy5cblxuICogV2UgZGV0ZWN0IHRoZXNlIGJ1Z2d5IGJyb3dzZXJzIGFuZCBzZXQgYEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUYCB0byBgZmFsc2VgIHNvIHRoZXlcbiAqIGdldCB0aGUgT2JqZWN0IGltcGxlbWVudGF0aW9uLCB3aGljaCBpcyBzbG93ZXIgYnV0IGJlaGF2ZXMgY29ycmVjdGx5LlxuICovXG5CdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCA9IGdsb2JhbC5UWVBFRF9BUlJBWV9TVVBQT1JUICE9PSB1bmRlZmluZWRcbiAgPyBnbG9iYWwuVFlQRURfQVJSQVlfU1VQUE9SVFxuICA6IHR5cGVkQXJyYXlTdXBwb3J0KClcblxuLypcbiAqIEV4cG9ydCBrTWF4TGVuZ3RoIGFmdGVyIHR5cGVkIGFycmF5IHN1cHBvcnQgaXMgZGV0ZXJtaW5lZC5cbiAqL1xuZXhwb3J0cy5rTWF4TGVuZ3RoID0ga01heExlbmd0aCgpXG5cbmZ1bmN0aW9uIHR5cGVkQXJyYXlTdXBwb3J0ICgpIHtcbiAgdHJ5IHtcbiAgICB2YXIgYXJyID0gbmV3IFVpbnQ4QXJyYXkoMSlcbiAgICBhcnIuX19wcm90b19fID0ge19fcHJvdG9fXzogVWludDhBcnJheS5wcm90b3R5cGUsIGZvbzogZnVuY3Rpb24gKCkgeyByZXR1cm4gNDIgfX1cbiAgICByZXR1cm4gYXJyLmZvbygpID09PSA0MiAmJiAvLyB0eXBlZCBhcnJheSBpbnN0YW5jZXMgY2FuIGJlIGF1Z21lbnRlZFxuICAgICAgICB0eXBlb2YgYXJyLnN1YmFycmF5ID09PSAnZnVuY3Rpb24nICYmIC8vIGNocm9tZSA5LTEwIGxhY2sgYHN1YmFycmF5YFxuICAgICAgICBhcnIuc3ViYXJyYXkoMSwgMSkuYnl0ZUxlbmd0aCA9PT0gMCAvLyBpZTEwIGhhcyBicm9rZW4gYHN1YmFycmF5YFxuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbn1cblxuZnVuY3Rpb24ga01heExlbmd0aCAoKSB7XG4gIHJldHVybiBCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVFxuICAgID8gMHg3ZmZmZmZmZlxuICAgIDogMHgzZmZmZmZmZlxufVxuXG5mdW5jdGlvbiBjcmVhdGVCdWZmZXIgKHRoYXQsIGxlbmd0aCkge1xuICBpZiAoa01heExlbmd0aCgpIDwgbGVuZ3RoKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0ludmFsaWQgdHlwZWQgYXJyYXkgbGVuZ3RoJylcbiAgfVxuICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICAvLyBSZXR1cm4gYW4gYXVnbWVudGVkIGBVaW50OEFycmF5YCBpbnN0YW5jZSwgZm9yIGJlc3QgcGVyZm9ybWFuY2VcbiAgICB0aGF0ID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKVxuICAgIHRoYXQuX19wcm90b19fID0gQnVmZmVyLnByb3RvdHlwZVxuICB9IGVsc2Uge1xuICAgIC8vIEZhbGxiYWNrOiBSZXR1cm4gYW4gb2JqZWN0IGluc3RhbmNlIG9mIHRoZSBCdWZmZXIgY2xhc3NcbiAgICBpZiAodGhhdCA9PT0gbnVsbCkge1xuICAgICAgdGhhdCA9IG5ldyBCdWZmZXIobGVuZ3RoKVxuICAgIH1cbiAgICB0aGF0Lmxlbmd0aCA9IGxlbmd0aFxuICB9XG5cbiAgcmV0dXJuIHRoYXRcbn1cblxuLyoqXG4gKiBUaGUgQnVmZmVyIGNvbnN0cnVjdG9yIHJldHVybnMgaW5zdGFuY2VzIG9mIGBVaW50OEFycmF5YCB0aGF0IGhhdmUgdGhlaXJcbiAqIHByb3RvdHlwZSBjaGFuZ2VkIHRvIGBCdWZmZXIucHJvdG90eXBlYC4gRnVydGhlcm1vcmUsIGBCdWZmZXJgIGlzIGEgc3ViY2xhc3Mgb2ZcbiAqIGBVaW50OEFycmF5YCwgc28gdGhlIHJldHVybmVkIGluc3RhbmNlcyB3aWxsIGhhdmUgYWxsIHRoZSBub2RlIGBCdWZmZXJgIG1ldGhvZHNcbiAqIGFuZCB0aGUgYFVpbnQ4QXJyYXlgIG1ldGhvZHMuIFNxdWFyZSBicmFja2V0IG5vdGF0aW9uIHdvcmtzIGFzIGV4cGVjdGVkIC0tIGl0XG4gKiByZXR1cm5zIGEgc2luZ2xlIG9jdGV0LlxuICpcbiAqIFRoZSBgVWludDhBcnJheWAgcHJvdG90eXBlIHJlbWFpbnMgdW5tb2RpZmllZC5cbiAqL1xuXG5mdW5jdGlvbiBCdWZmZXIgKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7XG4gIGlmICghQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQgJiYgISh0aGlzIGluc3RhbmNlb2YgQnVmZmVyKSkge1xuICAgIHJldHVybiBuZXcgQnVmZmVyKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKVxuICB9XG5cbiAgLy8gQ29tbW9uIGNhc2UuXG4gIGlmICh0eXBlb2YgYXJnID09PSAnbnVtYmVyJykge1xuICAgIGlmICh0eXBlb2YgZW5jb2RpbmdPck9mZnNldCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0lmIGVuY29kaW5nIGlzIHNwZWNpZmllZCB0aGVuIHRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nJ1xuICAgICAgKVxuICAgIH1cbiAgICByZXR1cm4gYWxsb2NVbnNhZmUodGhpcywgYXJnKVxuICB9XG4gIHJldHVybiBmcm9tKHRoaXMsIGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKVxufVxuXG5CdWZmZXIucG9vbFNpemUgPSA4MTkyIC8vIG5vdCB1c2VkIGJ5IHRoaXMgaW1wbGVtZW50YXRpb25cblxuLy8gVE9ETzogTGVnYWN5LCBub3QgbmVlZGVkIGFueW1vcmUuIFJlbW92ZSBpbiBuZXh0IG1ham9yIHZlcnNpb24uXG5CdWZmZXIuX2F1Z21lbnQgPSBmdW5jdGlvbiAoYXJyKSB7XG4gIGFyci5fX3Byb3RvX18gPSBCdWZmZXIucHJvdG90eXBlXG4gIHJldHVybiBhcnJcbn1cblxuZnVuY3Rpb24gZnJvbSAodGhhdCwgdmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1widmFsdWVcIiBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIG51bWJlcicpXG4gIH1cblxuICBpZiAodHlwZW9mIEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7XG4gICAgcmV0dXJuIGZyb21BcnJheUJ1ZmZlcih0aGF0LCB2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKVxuICB9XG5cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZnJvbVN0cmluZyh0aGF0LCB2YWx1ZSwgZW5jb2RpbmdPck9mZnNldClcbiAgfVxuXG4gIHJldHVybiBmcm9tT2JqZWN0KHRoYXQsIHZhbHVlKVxufVxuXG4vKipcbiAqIEZ1bmN0aW9uYWxseSBlcXVpdmFsZW50IHRvIEJ1ZmZlcihhcmcsIGVuY29kaW5nKSBidXQgdGhyb3dzIGEgVHlwZUVycm9yXG4gKiBpZiB2YWx1ZSBpcyBhIG51bWJlci5cbiAqIEJ1ZmZlci5mcm9tKHN0clssIGVuY29kaW5nXSlcbiAqIEJ1ZmZlci5mcm9tKGFycmF5KVxuICogQnVmZmVyLmZyb20oYnVmZmVyKVxuICogQnVmZmVyLmZyb20oYXJyYXlCdWZmZXJbLCBieXRlT2Zmc2V0WywgbGVuZ3RoXV0pXG4gKiovXG5CdWZmZXIuZnJvbSA9IGZ1bmN0aW9uICh2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7XG4gIHJldHVybiBmcm9tKG51bGwsIHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpXG59XG5cbmlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICBCdWZmZXIucHJvdG90eXBlLl9fcHJvdG9fXyA9IFVpbnQ4QXJyYXkucHJvdG90eXBlXG4gIEJ1ZmZlci5fX3Byb3RvX18gPSBVaW50OEFycmF5XG4gIGlmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wuc3BlY2llcyAmJlxuICAgICAgQnVmZmVyW1N5bWJvbC5zcGVjaWVzXSA9PT0gQnVmZmVyKSB7XG4gICAgLy8gRml4IHN1YmFycmF5KCkgaW4gRVMyMDE2LiBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9mZXJvc3MvYnVmZmVyL3B1bGwvOTdcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyLCBTeW1ib2wuc3BlY2llcywge1xuICAgICAgdmFsdWU6IG51bGwsXG4gICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KVxuICB9XG59XG5cbmZ1bmN0aW9uIGFzc2VydFNpemUgKHNpemUpIHtcbiAgaWYgKHR5cGVvZiBzaXplICE9PSAnbnVtYmVyJykge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wic2l6ZVwiIGFyZ3VtZW50IG11c3QgYmUgYSBudW1iZXInKVxuICB9IGVsc2UgaWYgKHNpemUgPCAwKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1wic2l6ZVwiIGFyZ3VtZW50IG11c3Qgbm90IGJlIG5lZ2F0aXZlJylcbiAgfVxufVxuXG5mdW5jdGlvbiBhbGxvYyAodGhhdCwgc2l6ZSwgZmlsbCwgZW5jb2RpbmcpIHtcbiAgYXNzZXJ0U2l6ZShzaXplKVxuICBpZiAoc2l6ZSA8PSAwKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUJ1ZmZlcih0aGF0LCBzaXplKVxuICB9XG4gIGlmIChmaWxsICE9PSB1bmRlZmluZWQpIHtcbiAgICAvLyBPbmx5IHBheSBhdHRlbnRpb24gdG8gZW5jb2RpbmcgaWYgaXQncyBhIHN0cmluZy4gVGhpc1xuICAgIC8vIHByZXZlbnRzIGFjY2lkZW50YWxseSBzZW5kaW5nIGluIGEgbnVtYmVyIHRoYXQgd291bGRcbiAgICAvLyBiZSBpbnRlcnByZXR0ZWQgYXMgYSBzdGFydCBvZmZzZXQuXG4gICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZydcbiAgICAgID8gY3JlYXRlQnVmZmVyKHRoYXQsIHNpemUpLmZpbGwoZmlsbCwgZW5jb2RpbmcpXG4gICAgICA6IGNyZWF0ZUJ1ZmZlcih0aGF0LCBzaXplKS5maWxsKGZpbGwpXG4gIH1cbiAgcmV0dXJuIGNyZWF0ZUJ1ZmZlcih0aGF0LCBzaXplKVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgZmlsbGVkIEJ1ZmZlciBpbnN0YW5jZS5cbiAqIGFsbG9jKHNpemVbLCBmaWxsWywgZW5jb2RpbmddXSlcbiAqKi9cbkJ1ZmZlci5hbGxvYyA9IGZ1bmN0aW9uIChzaXplLCBmaWxsLCBlbmNvZGluZykge1xuICByZXR1cm4gYWxsb2MobnVsbCwgc2l6ZSwgZmlsbCwgZW5jb2RpbmcpXG59XG5cbmZ1bmN0aW9uIGFsbG9jVW5zYWZlICh0aGF0LCBzaXplKSB7XG4gIGFzc2VydFNpemUoc2l6ZSlcbiAgdGhhdCA9IGNyZWF0ZUJ1ZmZlcih0aGF0LCBzaXplIDwgMCA/IDAgOiBjaGVja2VkKHNpemUpIHwgMClcbiAgaWYgKCFCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgKytpKSB7XG4gICAgICB0aGF0W2ldID0gMFxuICAgIH1cbiAgfVxuICByZXR1cm4gdGhhdFxufVxuXG4vKipcbiAqIEVxdWl2YWxlbnQgdG8gQnVmZmVyKG51bSksIGJ5IGRlZmF1bHQgY3JlYXRlcyBhIG5vbi16ZXJvLWZpbGxlZCBCdWZmZXIgaW5zdGFuY2UuXG4gKiAqL1xuQnVmZmVyLmFsbG9jVW5zYWZlID0gZnVuY3Rpb24gKHNpemUpIHtcbiAgcmV0dXJuIGFsbG9jVW5zYWZlKG51bGwsIHNpemUpXG59XG4vKipcbiAqIEVxdWl2YWxlbnQgdG8gU2xvd0J1ZmZlcihudW0pLCBieSBkZWZhdWx0IGNyZWF0ZXMgYSBub24temVyby1maWxsZWQgQnVmZmVyIGluc3RhbmNlLlxuICovXG5CdWZmZXIuYWxsb2NVbnNhZmVTbG93ID0gZnVuY3Rpb24gKHNpemUpIHtcbiAgcmV0dXJuIGFsbG9jVW5zYWZlKG51bGwsIHNpemUpXG59XG5cbmZ1bmN0aW9uIGZyb21TdHJpbmcgKHRoYXQsIHN0cmluZywgZW5jb2RpbmcpIHtcbiAgaWYgKHR5cGVvZiBlbmNvZGluZyAhPT0gJ3N0cmluZycgfHwgZW5jb2RpbmcgPT09ICcnKSB7XG4gICAgZW5jb2RpbmcgPSAndXRmOCdcbiAgfVxuXG4gIGlmICghQnVmZmVyLmlzRW5jb2RpbmcoZW5jb2RpbmcpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJlbmNvZGluZ1wiIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKVxuICB9XG5cbiAgdmFyIGxlbmd0aCA9IGJ5dGVMZW5ndGgoc3RyaW5nLCBlbmNvZGluZykgfCAwXG4gIHRoYXQgPSBjcmVhdGVCdWZmZXIodGhhdCwgbGVuZ3RoKVxuXG4gIHZhciBhY3R1YWwgPSB0aGF0LndyaXRlKHN0cmluZywgZW5jb2RpbmcpXG5cbiAgaWYgKGFjdHVhbCAhPT0gbGVuZ3RoKSB7XG4gICAgLy8gV3JpdGluZyBhIGhleCBzdHJpbmcsIGZvciBleGFtcGxlLCB0aGF0IGNvbnRhaW5zIGludmFsaWQgY2hhcmFjdGVycyB3aWxsXG4gICAgLy8gY2F1c2UgZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QgaW52YWxpZCBjaGFyYWN0ZXIgdG8gYmUgaWdub3JlZC4gKGUuZy5cbiAgICAvLyAnYWJ4eGNkJyB3aWxsIGJlIHRyZWF0ZWQgYXMgJ2FiJylcbiAgICB0aGF0ID0gdGhhdC5zbGljZSgwLCBhY3R1YWwpXG4gIH1cblxuICByZXR1cm4gdGhhdFxufVxuXG5mdW5jdGlvbiBmcm9tQXJyYXlMaWtlICh0aGF0LCBhcnJheSkge1xuICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoIDwgMCA/IDAgOiBjaGVja2VkKGFycmF5Lmxlbmd0aCkgfCAwXG4gIHRoYXQgPSBjcmVhdGVCdWZmZXIodGhhdCwgbGVuZ3RoKVxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7XG4gICAgdGhhdFtpXSA9IGFycmF5W2ldICYgMjU1XG4gIH1cbiAgcmV0dXJuIHRoYXRcbn1cblxuZnVuY3Rpb24gZnJvbUFycmF5QnVmZmVyICh0aGF0LCBhcnJheSwgYnl0ZU9mZnNldCwgbGVuZ3RoKSB7XG4gIGFycmF5LmJ5dGVMZW5ndGggLy8gdGhpcyB0aHJvd3MgaWYgYGFycmF5YCBpcyBub3QgYSB2YWxpZCBBcnJheUJ1ZmZlclxuXG4gIGlmIChieXRlT2Zmc2V0IDwgMCB8fCBhcnJheS5ieXRlTGVuZ3RoIDwgYnl0ZU9mZnNldCkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdcXCdvZmZzZXRcXCcgaXMgb3V0IG9mIGJvdW5kcycpXG4gIH1cblxuICBpZiAoYXJyYXkuYnl0ZUxlbmd0aCA8IGJ5dGVPZmZzZXQgKyAobGVuZ3RoIHx8IDApKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1xcJ2xlbmd0aFxcJyBpcyBvdXQgb2YgYm91bmRzJylcbiAgfVxuXG4gIGlmIChieXRlT2Zmc2V0ID09PSB1bmRlZmluZWQgJiYgbGVuZ3RoID09PSB1bmRlZmluZWQpIHtcbiAgICBhcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5KVxuICB9IGVsc2UgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgYXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheSwgYnl0ZU9mZnNldClcbiAgfSBlbHNlIHtcbiAgICBhcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5LCBieXRlT2Zmc2V0LCBsZW5ndGgpXG4gIH1cblxuICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICAvLyBSZXR1cm4gYW4gYXVnbWVudGVkIGBVaW50OEFycmF5YCBpbnN0YW5jZSwgZm9yIGJlc3QgcGVyZm9ybWFuY2VcbiAgICB0aGF0ID0gYXJyYXlcbiAgICB0aGF0Ll9fcHJvdG9fXyA9IEJ1ZmZlci5wcm90b3R5cGVcbiAgfSBlbHNlIHtcbiAgICAvLyBGYWxsYmFjazogUmV0dXJuIGFuIG9iamVjdCBpbnN0YW5jZSBvZiB0aGUgQnVmZmVyIGNsYXNzXG4gICAgdGhhdCA9IGZyb21BcnJheUxpa2UodGhhdCwgYXJyYXkpXG4gIH1cbiAgcmV0dXJuIHRoYXRcbn1cblxuZnVuY3Rpb24gZnJvbU9iamVjdCAodGhhdCwgb2JqKSB7XG4gIGlmIChCdWZmZXIuaXNCdWZmZXIob2JqKSkge1xuICAgIHZhciBsZW4gPSBjaGVja2VkKG9iai5sZW5ndGgpIHwgMFxuICAgIHRoYXQgPSBjcmVhdGVCdWZmZXIodGhhdCwgbGVuKVxuXG4gICAgaWYgKHRoYXQubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhhdFxuICAgIH1cblxuICAgIG9iai5jb3B5KHRoYXQsIDAsIDAsIGxlbilcbiAgICByZXR1cm4gdGhhdFxuICB9XG5cbiAgaWYgKG9iaikge1xuICAgIGlmICgodHlwZW9mIEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICBvYmouYnVmZmVyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHx8ICdsZW5ndGgnIGluIG9iaikge1xuICAgICAgaWYgKHR5cGVvZiBvYmoubGVuZ3RoICE9PSAnbnVtYmVyJyB8fCBpc25hbihvYmoubGVuZ3RoKSkge1xuICAgICAgICByZXR1cm4gY3JlYXRlQnVmZmVyKHRoYXQsIDApXG4gICAgICB9XG4gICAgICByZXR1cm4gZnJvbUFycmF5TGlrZSh0aGF0LCBvYmopXG4gICAgfVxuXG4gICAgaWYgKG9iai50eXBlID09PSAnQnVmZmVyJyAmJiBpc0FycmF5KG9iai5kYXRhKSkge1xuICAgICAgcmV0dXJuIGZyb21BcnJheUxpa2UodGhhdCwgb2JqLmRhdGEpXG4gICAgfVxuICB9XG5cbiAgdGhyb3cgbmV3IFR5cGVFcnJvcignRmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZywgQnVmZmVyLCBBcnJheUJ1ZmZlciwgQXJyYXksIG9yIGFycmF5LWxpa2Ugb2JqZWN0LicpXG59XG5cbmZ1bmN0aW9uIGNoZWNrZWQgKGxlbmd0aCkge1xuICAvLyBOb3RlOiBjYW5ub3QgdXNlIGBsZW5ndGggPCBrTWF4TGVuZ3RoKClgIGhlcmUgYmVjYXVzZSB0aGF0IGZhaWxzIHdoZW5cbiAgLy8gbGVuZ3RoIGlzIE5hTiAod2hpY2ggaXMgb3RoZXJ3aXNlIGNvZXJjZWQgdG8gemVyby4pXG4gIGlmIChsZW5ndGggPj0ga01heExlbmd0aCgpKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0F0dGVtcHQgdG8gYWxsb2NhdGUgQnVmZmVyIGxhcmdlciB0aGFuIG1heGltdW0gJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgJ3NpemU6IDB4JyArIGtNYXhMZW5ndGgoKS50b1N0cmluZygxNikgKyAnIGJ5dGVzJylcbiAgfVxuICByZXR1cm4gbGVuZ3RoIHwgMFxufVxuXG5mdW5jdGlvbiBTbG93QnVmZmVyIChsZW5ndGgpIHtcbiAgaWYgKCtsZW5ndGggIT0gbGVuZ3RoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxXG4gICAgbGVuZ3RoID0gMFxuICB9XG4gIHJldHVybiBCdWZmZXIuYWxsb2MoK2xlbmd0aClcbn1cblxuQnVmZmVyLmlzQnVmZmVyID0gZnVuY3Rpb24gaXNCdWZmZXIgKGIpIHtcbiAgcmV0dXJuICEhKGIgIT0gbnVsbCAmJiBiLl9pc0J1ZmZlcilcbn1cblxuQnVmZmVyLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlIChhLCBiKSB7XG4gIGlmICghQnVmZmVyLmlzQnVmZmVyKGEpIHx8ICFCdWZmZXIuaXNCdWZmZXIoYikpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcmd1bWVudHMgbXVzdCBiZSBCdWZmZXJzJylcbiAgfVxuXG4gIGlmIChhID09PSBiKSByZXR1cm4gMFxuXG4gIHZhciB4ID0gYS5sZW5ndGhcbiAgdmFyIHkgPSBiLmxlbmd0aFxuXG4gIGZvciAodmFyIGkgPSAwLCBsZW4gPSBNYXRoLm1pbih4LCB5KTsgaSA8IGxlbjsgKytpKSB7XG4gICAgaWYgKGFbaV0gIT09IGJbaV0pIHtcbiAgICAgIHggPSBhW2ldXG4gICAgICB5ID0gYltpXVxuICAgICAgYnJlYWtcbiAgICB9XG4gIH1cblxuICBpZiAoeCA8IHkpIHJldHVybiAtMVxuICBpZiAoeSA8IHgpIHJldHVybiAxXG4gIHJldHVybiAwXG59XG5cbkJ1ZmZlci5pc0VuY29kaW5nID0gZnVuY3Rpb24gaXNFbmNvZGluZyAoZW5jb2RpbmcpIHtcbiAgc3dpdGNoIChTdHJpbmcoZW5jb2RpbmcpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICBjYXNlICdoZXgnOlxuICAgIGNhc2UgJ3V0ZjgnOlxuICAgIGNhc2UgJ3V0Zi04JzpcbiAgICBjYXNlICdhc2NpaSc6XG4gICAgY2FzZSAnbGF0aW4xJzpcbiAgICBjYXNlICdiaW5hcnknOlxuICAgIGNhc2UgJ2Jhc2U2NCc6XG4gICAgY2FzZSAndWNzMic6XG4gICAgY2FzZSAndWNzLTInOlxuICAgIGNhc2UgJ3V0ZjE2bGUnOlxuICAgIGNhc2UgJ3V0Zi0xNmxlJzpcbiAgICAgIHJldHVybiB0cnVlXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBmYWxzZVxuICB9XG59XG5cbkJ1ZmZlci5jb25jYXQgPSBmdW5jdGlvbiBjb25jYXQgKGxpc3QsIGxlbmd0aCkge1xuICBpZiAoIWlzQXJyYXkobGlzdCkpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RcIiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKVxuICB9XG5cbiAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIEJ1ZmZlci5hbGxvYygwKVxuICB9XG5cbiAgdmFyIGlcbiAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgbGVuZ3RoID0gMFxuICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICBsZW5ndGggKz0gbGlzdFtpXS5sZW5ndGhcbiAgICB9XG4gIH1cblxuICB2YXIgYnVmZmVyID0gQnVmZmVyLmFsbG9jVW5zYWZlKGxlbmd0aClcbiAgdmFyIHBvcyA9IDBcbiAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgYnVmID0gbGlzdFtpXVxuICAgIGlmICghQnVmZmVyLmlzQnVmZmVyKGJ1ZikpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdFwiIGFyZ3VtZW50IG11c3QgYmUgYW4gQXJyYXkgb2YgQnVmZmVycycpXG4gICAgfVxuICAgIGJ1Zi5jb3B5KGJ1ZmZlciwgcG9zKVxuICAgIHBvcyArPSBidWYubGVuZ3RoXG4gIH1cbiAgcmV0dXJuIGJ1ZmZlclxufVxuXG5mdW5jdGlvbiBieXRlTGVuZ3RoIChzdHJpbmcsIGVuY29kaW5nKSB7XG4gIGlmIChCdWZmZXIuaXNCdWZmZXIoc3RyaW5nKSkge1xuICAgIHJldHVybiBzdHJpbmcubGVuZ3RoXG4gIH1cbiAgaWYgKHR5cGVvZiBBcnJheUJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIEFycmF5QnVmZmVyLmlzVmlldyA9PT0gJ2Z1bmN0aW9uJyAmJlxuICAgICAgKEFycmF5QnVmZmVyLmlzVmlldyhzdHJpbmcpIHx8IHN0cmluZyBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSkge1xuICAgIHJldHVybiBzdHJpbmcuYnl0ZUxlbmd0aFxuICB9XG4gIGlmICh0eXBlb2Ygc3RyaW5nICE9PSAnc3RyaW5nJykge1xuICAgIHN0cmluZyA9ICcnICsgc3RyaW5nXG4gIH1cblxuICB2YXIgbGVuID0gc3RyaW5nLmxlbmd0aFxuICBpZiAobGVuID09PSAwKSByZXR1cm4gMFxuXG4gIC8vIFVzZSBhIGZvciBsb29wIHRvIGF2b2lkIHJlY3Vyc2lvblxuICB2YXIgbG93ZXJlZENhc2UgPSBmYWxzZVxuICBmb3IgKDs7KSB7XG4gICAgc3dpdGNoIChlbmNvZGluZykge1xuICAgICAgY2FzZSAnYXNjaWknOlxuICAgICAgY2FzZSAnbGF0aW4xJzpcbiAgICAgIGNhc2UgJ2JpbmFyeSc6XG4gICAgICAgIHJldHVybiBsZW5cbiAgICAgIGNhc2UgJ3V0ZjgnOlxuICAgICAgY2FzZSAndXRmLTgnOlxuICAgICAgY2FzZSB1bmRlZmluZWQ6XG4gICAgICAgIHJldHVybiB1dGY4VG9CeXRlcyhzdHJpbmcpLmxlbmd0aFxuICAgICAgY2FzZSAndWNzMic6XG4gICAgICBjYXNlICd1Y3MtMic6XG4gICAgICBjYXNlICd1dGYxNmxlJzpcbiAgICAgIGNhc2UgJ3V0Zi0xNmxlJzpcbiAgICAgICAgcmV0dXJuIGxlbiAqIDJcbiAgICAgIGNhc2UgJ2hleCc6XG4gICAgICAgIHJldHVybiBsZW4gPj4+IDFcbiAgICAgIGNhc2UgJ2Jhc2U2NCc6XG4gICAgICAgIHJldHVybiBiYXNlNjRUb0J5dGVzKHN0cmluZykubGVuZ3RoXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBpZiAobG93ZXJlZENhc2UpIHJldHVybiB1dGY4VG9CeXRlcyhzdHJpbmcpLmxlbmd0aCAvLyBhc3N1bWUgdXRmOFxuICAgICAgICBlbmNvZGluZyA9ICgnJyArIGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGxvd2VyZWRDYXNlID0gdHJ1ZVxuICAgIH1cbiAgfVxufVxuQnVmZmVyLmJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoXG5cbmZ1bmN0aW9uIHNsb3dUb1N0cmluZyAoZW5jb2RpbmcsIHN0YXJ0LCBlbmQpIHtcbiAgdmFyIGxvd2VyZWRDYXNlID0gZmFsc2VcblxuICAvLyBObyBuZWVkIHRvIHZlcmlmeSB0aGF0IFwidGhpcy5sZW5ndGggPD0gTUFYX1VJTlQzMlwiIHNpbmNlIGl0J3MgYSByZWFkLW9ubHlcbiAgLy8gcHJvcGVydHkgb2YgYSB0eXBlZCBhcnJheS5cblxuICAvLyBUaGlzIGJlaGF2ZXMgbmVpdGhlciBsaWtlIFN0cmluZyBub3IgVWludDhBcnJheSBpbiB0aGF0IHdlIHNldCBzdGFydC9lbmRcbiAgLy8gdG8gdGhlaXIgdXBwZXIvbG93ZXIgYm91bmRzIGlmIHRoZSB2YWx1ZSBwYXNzZWQgaXMgb3V0IG9mIHJhbmdlLlxuICAvLyB1bmRlZmluZWQgaXMgaGFuZGxlZCBzcGVjaWFsbHkgYXMgcGVyIEVDTUEtMjYyIDZ0aCBFZGl0aW9uLFxuICAvLyBTZWN0aW9uIDEzLjMuMy43IFJ1bnRpbWUgU2VtYW50aWNzOiBLZXllZEJpbmRpbmdJbml0aWFsaXphdGlvbi5cbiAgaWYgKHN0YXJ0ID09PSB1bmRlZmluZWQgfHwgc3RhcnQgPCAwKSB7XG4gICAgc3RhcnQgPSAwXG4gIH1cbiAgLy8gUmV0dXJuIGVhcmx5IGlmIHN0YXJ0ID4gdGhpcy5sZW5ndGguIERvbmUgaGVyZSB0byBwcmV2ZW50IHBvdGVudGlhbCB1aW50MzJcbiAgLy8gY29lcmNpb24gZmFpbCBiZWxvdy5cbiAgaWYgKHN0YXJ0ID4gdGhpcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gJydcbiAgfVxuXG4gIGlmIChlbmQgPT09IHVuZGVmaW5lZCB8fCBlbmQgPiB0aGlzLmxlbmd0aCkge1xuICAgIGVuZCA9IHRoaXMubGVuZ3RoXG4gIH1cblxuICBpZiAoZW5kIDw9IDApIHtcbiAgICByZXR1cm4gJydcbiAgfVxuXG4gIC8vIEZvcmNlIGNvZXJzaW9uIHRvIHVpbnQzMi4gVGhpcyB3aWxsIGFsc28gY29lcmNlIGZhbHNleS9OYU4gdmFsdWVzIHRvIDAuXG4gIGVuZCA+Pj49IDBcbiAgc3RhcnQgPj4+PSAwXG5cbiAgaWYgKGVuZCA8PSBzdGFydCkge1xuICAgIHJldHVybiAnJ1xuICB9XG5cbiAgaWYgKCFlbmNvZGluZykgZW5jb2RpbmcgPSAndXRmOCdcblxuICB3aGlsZSAodHJ1ZSkge1xuICAgIHN3aXRjaCAoZW5jb2RpbmcpIHtcbiAgICAgIGNhc2UgJ2hleCc6XG4gICAgICAgIHJldHVybiBoZXhTbGljZSh0aGlzLCBzdGFydCwgZW5kKVxuXG4gICAgICBjYXNlICd1dGY4JzpcbiAgICAgIGNhc2UgJ3V0Zi04JzpcbiAgICAgICAgcmV0dXJuIHV0ZjhTbGljZSh0aGlzLCBzdGFydCwgZW5kKVxuXG4gICAgICBjYXNlICdhc2NpaSc6XG4gICAgICAgIHJldHVybiBhc2NpaVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpXG5cbiAgICAgIGNhc2UgJ2xhdGluMSc6XG4gICAgICBjYXNlICdiaW5hcnknOlxuICAgICAgICByZXR1cm4gbGF0aW4xU2xpY2UodGhpcywgc3RhcnQsIGVuZClcblxuICAgICAgY2FzZSAnYmFzZTY0JzpcbiAgICAgICAgcmV0dXJuIGJhc2U2NFNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpXG5cbiAgICAgIGNhc2UgJ3VjczInOlxuICAgICAgY2FzZSAndWNzLTInOlxuICAgICAgY2FzZSAndXRmMTZsZSc6XG4gICAgICBjYXNlICd1dGYtMTZsZSc6XG4gICAgICAgIHJldHVybiB1dGYxNmxlU2xpY2UodGhpcywgc3RhcnQsIGVuZClcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaWYgKGxvd2VyZWRDYXNlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIGVuY29kaW5nOiAnICsgZW5jb2RpbmcpXG4gICAgICAgIGVuY29kaW5nID0gKGVuY29kaW5nICsgJycpLnRvTG93ZXJDYXNlKClcbiAgICAgICAgbG93ZXJlZENhc2UgPSB0cnVlXG4gICAgfVxuICB9XG59XG5cbi8vIFRoZSBwcm9wZXJ0eSBpcyB1c2VkIGJ5IGBCdWZmZXIuaXNCdWZmZXJgIGFuZCBgaXMtYnVmZmVyYCAoaW4gU2FmYXJpIDUtNykgdG8gZGV0ZWN0XG4vLyBCdWZmZXIgaW5zdGFuY2VzLlxuQnVmZmVyLnByb3RvdHlwZS5faXNCdWZmZXIgPSB0cnVlXG5cbmZ1bmN0aW9uIHN3YXAgKGIsIG4sIG0pIHtcbiAgdmFyIGkgPSBiW25dXG4gIGJbbl0gPSBiW21dXG4gIGJbbV0gPSBpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUuc3dhcDE2ID0gZnVuY3Rpb24gc3dhcDE2ICgpIHtcbiAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoXG4gIGlmIChsZW4gJSAyICE9PSAwKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0J1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAxNi1iaXRzJylcbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSArPSAyKSB7XG4gICAgc3dhcCh0aGlzLCBpLCBpICsgMSlcbiAgfVxuICByZXR1cm4gdGhpc1xufVxuXG5CdWZmZXIucHJvdG90eXBlLnN3YXAzMiA9IGZ1bmN0aW9uIHN3YXAzMiAoKSB7XG4gIHZhciBsZW4gPSB0aGlzLmxlbmd0aFxuICBpZiAobGVuICUgNCAhPT0gMCkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgMzItYml0cycpXG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkgKz0gNCkge1xuICAgIHN3YXAodGhpcywgaSwgaSArIDMpXG4gICAgc3dhcCh0aGlzLCBpICsgMSwgaSArIDIpXG4gIH1cbiAgcmV0dXJuIHRoaXNcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5zd2FwNjQgPSBmdW5jdGlvbiBzd2FwNjQgKCkge1xuICB2YXIgbGVuID0gdGhpcy5sZW5ndGhcbiAgaWYgKGxlbiAlIDggIT09IDApIHtcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDY0LWJpdHMnKVxuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpICs9IDgpIHtcbiAgICBzd2FwKHRoaXMsIGksIGkgKyA3KVxuICAgIHN3YXAodGhpcywgaSArIDEsIGkgKyA2KVxuICAgIHN3YXAodGhpcywgaSArIDIsIGkgKyA1KVxuICAgIHN3YXAodGhpcywgaSArIDMsIGkgKyA0KVxuICB9XG4gIHJldHVybiB0aGlzXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZyAoKSB7XG4gIHZhciBsZW5ndGggPSB0aGlzLmxlbmd0aCB8IDBcbiAgaWYgKGxlbmd0aCA9PT0gMCkgcmV0dXJuICcnXG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSByZXR1cm4gdXRmOFNsaWNlKHRoaXMsIDAsIGxlbmd0aClcbiAgcmV0dXJuIHNsb3dUb1N0cmluZy5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gZXF1YWxzIChiKSB7XG4gIGlmICghQnVmZmVyLmlzQnVmZmVyKGIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyJylcbiAgaWYgKHRoaXMgPT09IGIpIHJldHVybiB0cnVlXG4gIHJldHVybiBCdWZmZXIuY29tcGFyZSh0aGlzLCBiKSA9PT0gMFxufVxuXG5CdWZmZXIucHJvdG90eXBlLmluc3BlY3QgPSBmdW5jdGlvbiBpbnNwZWN0ICgpIHtcbiAgdmFyIHN0ciA9ICcnXG4gIHZhciBtYXggPSBleHBvcnRzLklOU1BFQ1RfTUFYX0JZVEVTXG4gIGlmICh0aGlzLmxlbmd0aCA+IDApIHtcbiAgICBzdHIgPSB0aGlzLnRvU3RyaW5nKCdoZXgnLCAwLCBtYXgpLm1hdGNoKC8uezJ9L2cpLmpvaW4oJyAnKVxuICAgIGlmICh0aGlzLmxlbmd0aCA+IG1heCkgc3RyICs9ICcgLi4uICdcbiAgfVxuICByZXR1cm4gJzxCdWZmZXIgJyArIHN0ciArICc+J1xufVxuXG5CdWZmZXIucHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlICh0YXJnZXQsIHN0YXJ0LCBlbmQsIHRoaXNTdGFydCwgdGhpc0VuZCkge1xuICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcih0YXJnZXQpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlcicpXG4gIH1cblxuICBpZiAoc3RhcnQgPT09IHVuZGVmaW5lZCkge1xuICAgIHN0YXJ0ID0gMFxuICB9XG4gIGlmIChlbmQgPT09IHVuZGVmaW5lZCkge1xuICAgIGVuZCA9IHRhcmdldCA/IHRhcmdldC5sZW5ndGggOiAwXG4gIH1cbiAgaWYgKHRoaXNTdGFydCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhpc1N0YXJ0ID0gMFxuICB9XG4gIGlmICh0aGlzRW5kID09PSB1bmRlZmluZWQpIHtcbiAgICB0aGlzRW5kID0gdGhpcy5sZW5ndGhcbiAgfVxuXG4gIGlmIChzdGFydCA8IDAgfHwgZW5kID4gdGFyZ2V0Lmxlbmd0aCB8fCB0aGlzU3RhcnQgPCAwIHx8IHRoaXNFbmQgPiB0aGlzLmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdvdXQgb2YgcmFuZ2UgaW5kZXgnKVxuICB9XG5cbiAgaWYgKHRoaXNTdGFydCA+PSB0aGlzRW5kICYmIHN0YXJ0ID49IGVuZCkge1xuICAgIHJldHVybiAwXG4gIH1cbiAgaWYgKHRoaXNTdGFydCA+PSB0aGlzRW5kKSB7XG4gICAgcmV0dXJuIC0xXG4gIH1cbiAgaWYgKHN0YXJ0ID49IGVuZCkge1xuICAgIHJldHVybiAxXG4gIH1cblxuICBzdGFydCA+Pj49IDBcbiAgZW5kID4+Pj0gMFxuICB0aGlzU3RhcnQgPj4+PSAwXG4gIHRoaXNFbmQgPj4+PSAwXG5cbiAgaWYgKHRoaXMgPT09IHRhcmdldCkgcmV0dXJuIDBcblxuICB2YXIgeCA9IHRoaXNFbmQgLSB0aGlzU3RhcnRcbiAgdmFyIHkgPSBlbmQgLSBzdGFydFxuICB2YXIgbGVuID0gTWF0aC5taW4oeCwgeSlcblxuICB2YXIgdGhpc0NvcHkgPSB0aGlzLnNsaWNlKHRoaXNTdGFydCwgdGhpc0VuZClcbiAgdmFyIHRhcmdldENvcHkgPSB0YXJnZXQuc2xpY2Uoc3RhcnQsIGVuZClcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKSB7XG4gICAgaWYgKHRoaXNDb3B5W2ldICE9PSB0YXJnZXRDb3B5W2ldKSB7XG4gICAgICB4ID0gdGhpc0NvcHlbaV1cbiAgICAgIHkgPSB0YXJnZXRDb3B5W2ldXG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIGlmICh4IDwgeSkgcmV0dXJuIC0xXG4gIGlmICh5IDwgeCkgcmV0dXJuIDFcbiAgcmV0dXJuIDBcbn1cblxuLy8gRmluZHMgZWl0aGVyIHRoZSBmaXJzdCBpbmRleCBvZiBgdmFsYCBpbiBgYnVmZmVyYCBhdCBvZmZzZXQgPj0gYGJ5dGVPZmZzZXRgLFxuLy8gT1IgdGhlIGxhc3QgaW5kZXggb2YgYHZhbGAgaW4gYGJ1ZmZlcmAgYXQgb2Zmc2V0IDw9IGBieXRlT2Zmc2V0YC5cbi8vXG4vLyBBcmd1bWVudHM6XG4vLyAtIGJ1ZmZlciAtIGEgQnVmZmVyIHRvIHNlYXJjaFxuLy8gLSB2YWwgLSBhIHN0cmluZywgQnVmZmVyLCBvciBudW1iZXJcbi8vIC0gYnl0ZU9mZnNldCAtIGFuIGluZGV4IGludG8gYGJ1ZmZlcmA7IHdpbGwgYmUgY2xhbXBlZCB0byBhbiBpbnQzMlxuLy8gLSBlbmNvZGluZyAtIGFuIG9wdGlvbmFsIGVuY29kaW5nLCByZWxldmFudCBpcyB2YWwgaXMgYSBzdHJpbmdcbi8vIC0gZGlyIC0gdHJ1ZSBmb3IgaW5kZXhPZiwgZmFsc2UgZm9yIGxhc3RJbmRleE9mXG5mdW5jdGlvbiBiaWRpcmVjdGlvbmFsSW5kZXhPZiAoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpIHtcbiAgLy8gRW1wdHkgYnVmZmVyIG1lYW5zIG5vIG1hdGNoXG4gIGlmIChidWZmZXIubGVuZ3RoID09PSAwKSByZXR1cm4gLTFcblxuICAvLyBOb3JtYWxpemUgYnl0ZU9mZnNldFxuICBpZiAodHlwZW9mIGJ5dGVPZmZzZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgZW5jb2RpbmcgPSBieXRlT2Zmc2V0XG4gICAgYnl0ZU9mZnNldCA9IDBcbiAgfSBlbHNlIGlmIChieXRlT2Zmc2V0ID4gMHg3ZmZmZmZmZikge1xuICAgIGJ5dGVPZmZzZXQgPSAweDdmZmZmZmZmXG4gIH0gZWxzZSBpZiAoYnl0ZU9mZnNldCA8IC0weDgwMDAwMDAwKSB7XG4gICAgYnl0ZU9mZnNldCA9IC0weDgwMDAwMDAwXG4gIH1cbiAgYnl0ZU9mZnNldCA9ICtieXRlT2Zmc2V0ICAvLyBDb2VyY2UgdG8gTnVtYmVyLlxuICBpZiAoaXNOYU4oYnl0ZU9mZnNldCkpIHtcbiAgICAvLyBieXRlT2Zmc2V0OiBpdCBpdCdzIHVuZGVmaW5lZCwgbnVsbCwgTmFOLCBcImZvb1wiLCBldGMsIHNlYXJjaCB3aG9sZSBidWZmZXJcbiAgICBieXRlT2Zmc2V0ID0gZGlyID8gMCA6IChidWZmZXIubGVuZ3RoIC0gMSlcbiAgfVxuXG4gIC8vIE5vcm1hbGl6ZSBieXRlT2Zmc2V0OiBuZWdhdGl2ZSBvZmZzZXRzIHN0YXJ0IGZyb20gdGhlIGVuZCBvZiB0aGUgYnVmZmVyXG4gIGlmIChieXRlT2Zmc2V0IDwgMCkgYnl0ZU9mZnNldCA9IGJ1ZmZlci5sZW5ndGggKyBieXRlT2Zmc2V0XG4gIGlmIChieXRlT2Zmc2V0ID49IGJ1ZmZlci5sZW5ndGgpIHtcbiAgICBpZiAoZGlyKSByZXR1cm4gLTFcbiAgICBlbHNlIGJ5dGVPZmZzZXQgPSBidWZmZXIubGVuZ3RoIC0gMVxuICB9IGVsc2UgaWYgKGJ5dGVPZmZzZXQgPCAwKSB7XG4gICAgaWYgKGRpcikgYnl0ZU9mZnNldCA9IDBcbiAgICBlbHNlIHJldHVybiAtMVxuICB9XG5cbiAgLy8gTm9ybWFsaXplIHZhbFxuICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHtcbiAgICB2YWwgPSBCdWZmZXIuZnJvbSh2YWwsIGVuY29kaW5nKVxuICB9XG5cbiAgLy8gRmluYWxseSwgc2VhcmNoIGVpdGhlciBpbmRleE9mIChpZiBkaXIgaXMgdHJ1ZSkgb3IgbGFzdEluZGV4T2ZcbiAgaWYgKEJ1ZmZlci5pc0J1ZmZlcih2YWwpKSB7XG4gICAgLy8gU3BlY2lhbCBjYXNlOiBsb29raW5nIGZvciBlbXB0eSBzdHJpbmcvYnVmZmVyIGFsd2F5cyBmYWlsc1xuICAgIGlmICh2YWwubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gLTFcbiAgICB9XG4gICAgcmV0dXJuIGFycmF5SW5kZXhPZihidWZmZXIsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGRpcilcbiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsID09PSAnbnVtYmVyJykge1xuICAgIHZhbCA9IHZhbCAmIDB4RkYgLy8gU2VhcmNoIGZvciBhIGJ5dGUgdmFsdWUgWzAtMjU1XVxuICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCAmJlxuICAgICAgICB0eXBlb2YgVWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgaWYgKGRpcikge1xuICAgICAgICByZXR1cm4gVWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGJ1ZmZlciwgdmFsLCBieXRlT2Zmc2V0KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFVpbnQ4QXJyYXkucHJvdG90eXBlLmxhc3RJbmRleE9mLmNhbGwoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQpXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhcnJheUluZGV4T2YoYnVmZmVyLCBbIHZhbCBdLCBieXRlT2Zmc2V0LCBlbmNvZGluZywgZGlyKVxuICB9XG5cbiAgdGhyb3cgbmV3IFR5cGVFcnJvcigndmFsIG11c3QgYmUgc3RyaW5nLCBudW1iZXIgb3IgQnVmZmVyJylcbn1cblxuZnVuY3Rpb24gYXJyYXlJbmRleE9mIChhcnIsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGRpcikge1xuICB2YXIgaW5kZXhTaXplID0gMVxuICB2YXIgYXJyTGVuZ3RoID0gYXJyLmxlbmd0aFxuICB2YXIgdmFsTGVuZ3RoID0gdmFsLmxlbmd0aFxuXG4gIGlmIChlbmNvZGluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZW5jb2RpbmcgPSBTdHJpbmcoZW5jb2RpbmcpLnRvTG93ZXJDYXNlKClcbiAgICBpZiAoZW5jb2RpbmcgPT09ICd1Y3MyJyB8fCBlbmNvZGluZyA9PT0gJ3Vjcy0yJyB8fFxuICAgICAgICBlbmNvZGluZyA9PT0gJ3V0ZjE2bGUnIHx8IGVuY29kaW5nID09PSAndXRmLTE2bGUnKSB7XG4gICAgICBpZiAoYXJyLmxlbmd0aCA8IDIgfHwgdmFsLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgcmV0dXJuIC0xXG4gICAgICB9XG4gICAgICBpbmRleFNpemUgPSAyXG4gICAgICBhcnJMZW5ndGggLz0gMlxuICAgICAgdmFsTGVuZ3RoIC89IDJcbiAgICAgIGJ5dGVPZmZzZXQgLz0gMlxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWQgKGJ1ZiwgaSkge1xuICAgIGlmIChpbmRleFNpemUgPT09IDEpIHtcbiAgICAgIHJldHVybiBidWZbaV1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGJ1Zi5yZWFkVUludDE2QkUoaSAqIGluZGV4U2l6ZSlcbiAgICB9XG4gIH1cblxuICB2YXIgaVxuICBpZiAoZGlyKSB7XG4gICAgdmFyIGZvdW5kSW5kZXggPSAtMVxuICAgIGZvciAoaSA9IGJ5dGVPZmZzZXQ7IGkgPCBhcnJMZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHJlYWQoYXJyLCBpKSA9PT0gcmVhZCh2YWwsIGZvdW5kSW5kZXggPT09IC0xID8gMCA6IGkgLSBmb3VuZEluZGV4KSkge1xuICAgICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpIGZvdW5kSW5kZXggPSBpXG4gICAgICAgIGlmIChpIC0gZm91bmRJbmRleCArIDEgPT09IHZhbExlbmd0aCkgcmV0dXJuIGZvdW5kSW5kZXggKiBpbmRleFNpemVcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChmb3VuZEluZGV4ICE9PSAtMSkgaSAtPSBpIC0gZm91bmRJbmRleFxuICAgICAgICBmb3VuZEluZGV4ID0gLTFcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKGJ5dGVPZmZzZXQgKyB2YWxMZW5ndGggPiBhcnJMZW5ndGgpIGJ5dGVPZmZzZXQgPSBhcnJMZW5ndGggLSB2YWxMZW5ndGhcbiAgICBmb3IgKGkgPSBieXRlT2Zmc2V0OyBpID49IDA7IGktLSkge1xuICAgICAgdmFyIGZvdW5kID0gdHJ1ZVxuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB2YWxMZW5ndGg7IGorKykge1xuICAgICAgICBpZiAocmVhZChhcnIsIGkgKyBqKSAhPT0gcmVhZCh2YWwsIGopKSB7XG4gICAgICAgICAgZm91bmQgPSBmYWxzZVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChmb3VuZCkgcmV0dXJuIGlcbiAgICB9XG4gIH1cblxuICByZXR1cm4gLTFcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5pbmNsdWRlcyA9IGZ1bmN0aW9uIGluY2x1ZGVzICh2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nKSB7XG4gIHJldHVybiB0aGlzLmluZGV4T2YodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykgIT09IC0xXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIGluZGV4T2YgKHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcpIHtcbiAgcmV0dXJuIGJpZGlyZWN0aW9uYWxJbmRleE9mKHRoaXMsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIHRydWUpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUubGFzdEluZGV4T2YgPSBmdW5jdGlvbiBsYXN0SW5kZXhPZiAodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykge1xuICByZXR1cm4gYmlkaXJlY3Rpb25hbEluZGV4T2YodGhpcywgdmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZywgZmFsc2UpXG59XG5cbmZ1bmN0aW9uIGhleFdyaXRlIChidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHtcbiAgb2Zmc2V0ID0gTnVtYmVyKG9mZnNldCkgfHwgMFxuICB2YXIgcmVtYWluaW5nID0gYnVmLmxlbmd0aCAtIG9mZnNldFxuICBpZiAoIWxlbmd0aCkge1xuICAgIGxlbmd0aCA9IHJlbWFpbmluZ1xuICB9IGVsc2Uge1xuICAgIGxlbmd0aCA9IE51bWJlcihsZW5ndGgpXG4gICAgaWYgKGxlbmd0aCA+IHJlbWFpbmluZykge1xuICAgICAgbGVuZ3RoID0gcmVtYWluaW5nXG4gICAgfVxuICB9XG5cbiAgLy8gbXVzdCBiZSBhbiBldmVuIG51bWJlciBvZiBkaWdpdHNcbiAgdmFyIHN0ckxlbiA9IHN0cmluZy5sZW5ndGhcbiAgaWYgKHN0ckxlbiAlIDIgIT09IDApIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgaGV4IHN0cmluZycpXG5cbiAgaWYgKGxlbmd0aCA+IHN0ckxlbiAvIDIpIHtcbiAgICBsZW5ndGggPSBzdHJMZW4gLyAyXG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgIHZhciBwYXJzZWQgPSBwYXJzZUludChzdHJpbmcuc3Vic3RyKGkgKiAyLCAyKSwgMTYpXG4gICAgaWYgKGlzTmFOKHBhcnNlZCkpIHJldHVybiBpXG4gICAgYnVmW29mZnNldCArIGldID0gcGFyc2VkXG4gIH1cbiAgcmV0dXJuIGlcbn1cblxuZnVuY3Rpb24gdXRmOFdyaXRlIChidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHtcbiAgcmV0dXJuIGJsaXRCdWZmZXIodXRmOFRvQnl0ZXMoc3RyaW5nLCBidWYubGVuZ3RoIC0gb2Zmc2V0KSwgYnVmLCBvZmZzZXQsIGxlbmd0aClcbn1cblxuZnVuY3Rpb24gYXNjaWlXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIHJldHVybiBibGl0QnVmZmVyKGFzY2lpVG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKVxufVxuXG5mdW5jdGlvbiBsYXRpbjFXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIHJldHVybiBhc2NpaVdyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aClcbn1cblxuZnVuY3Rpb24gYmFzZTY0V3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkge1xuICByZXR1cm4gYmxpdEJ1ZmZlcihiYXNlNjRUb0J5dGVzKHN0cmluZyksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpXG59XG5cbmZ1bmN0aW9uIHVjczJXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIHJldHVybiBibGl0QnVmZmVyKHV0ZjE2bGVUb0J5dGVzKHN0cmluZywgYnVmLmxlbmd0aCAtIG9mZnNldCksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiB3cml0ZSAoc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCwgZW5jb2RpbmcpIHtcbiAgLy8gQnVmZmVyI3dyaXRlKHN0cmluZylcbiAgaWYgKG9mZnNldCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgZW5jb2RpbmcgPSAndXRmOCdcbiAgICBsZW5ndGggPSB0aGlzLmxlbmd0aFxuICAgIG9mZnNldCA9IDBcbiAgLy8gQnVmZmVyI3dyaXRlKHN0cmluZywgZW5jb2RpbmcpXG4gIH0gZWxzZSBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQgJiYgdHlwZW9mIG9mZnNldCA9PT0gJ3N0cmluZycpIHtcbiAgICBlbmNvZGluZyA9IG9mZnNldFxuICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoXG4gICAgb2Zmc2V0ID0gMFxuICAvLyBCdWZmZXIjd3JpdGUoc3RyaW5nLCBvZmZzZXRbLCBsZW5ndGhdWywgZW5jb2RpbmddKVxuICB9IGVsc2UgaWYgKGlzRmluaXRlKG9mZnNldCkpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gICAgaWYgKGlzRmluaXRlKGxlbmd0aCkpIHtcbiAgICAgIGxlbmd0aCA9IGxlbmd0aCB8IDBcbiAgICAgIGlmIChlbmNvZGluZyA9PT0gdW5kZWZpbmVkKSBlbmNvZGluZyA9ICd1dGY4J1xuICAgIH0gZWxzZSB7XG4gICAgICBlbmNvZGluZyA9IGxlbmd0aFxuICAgICAgbGVuZ3RoID0gdW5kZWZpbmVkXG4gICAgfVxuICAvLyBsZWdhY3kgd3JpdGUoc3RyaW5nLCBlbmNvZGluZywgb2Zmc2V0LCBsZW5ndGgpIC0gcmVtb3ZlIGluIHYwLjEzXG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0J1ZmZlci53cml0ZShzdHJpbmcsIGVuY29kaW5nLCBvZmZzZXRbLCBsZW5ndGhdKSBpcyBubyBsb25nZXIgc3VwcG9ydGVkJ1xuICAgIClcbiAgfVxuXG4gIHZhciByZW1haW5pbmcgPSB0aGlzLmxlbmd0aCAtIG9mZnNldFxuICBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQgfHwgbGVuZ3RoID4gcmVtYWluaW5nKSBsZW5ndGggPSByZW1haW5pbmdcblxuICBpZiAoKHN0cmluZy5sZW5ndGggPiAwICYmIChsZW5ndGggPCAwIHx8IG9mZnNldCA8IDApKSB8fCBvZmZzZXQgPiB0aGlzLmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdBdHRlbXB0IHRvIHdyaXRlIG91dHNpZGUgYnVmZmVyIGJvdW5kcycpXG4gIH1cblxuICBpZiAoIWVuY29kaW5nKSBlbmNvZGluZyA9ICd1dGY4J1xuXG4gIHZhciBsb3dlcmVkQ2FzZSA9IGZhbHNlXG4gIGZvciAoOzspIHtcbiAgICBzd2l0Y2ggKGVuY29kaW5nKSB7XG4gICAgICBjYXNlICdoZXgnOlxuICAgICAgICByZXR1cm4gaGV4V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aClcblxuICAgICAgY2FzZSAndXRmOCc6XG4gICAgICBjYXNlICd1dGYtOCc6XG4gICAgICAgIHJldHVybiB1dGY4V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aClcblxuICAgICAgY2FzZSAnYXNjaWknOlxuICAgICAgICByZXR1cm4gYXNjaWlXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKVxuXG4gICAgICBjYXNlICdsYXRpbjEnOlxuICAgICAgY2FzZSAnYmluYXJ5JzpcbiAgICAgICAgcmV0dXJuIGxhdGluMVdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpXG5cbiAgICAgIGNhc2UgJ2Jhc2U2NCc6XG4gICAgICAgIC8vIFdhcm5pbmc6IG1heExlbmd0aCBub3QgdGFrZW4gaW50byBhY2NvdW50IGluIGJhc2U2NFdyaXRlXG4gICAgICAgIHJldHVybiBiYXNlNjRXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKVxuXG4gICAgICBjYXNlICd1Y3MyJzpcbiAgICAgIGNhc2UgJ3Vjcy0yJzpcbiAgICAgIGNhc2UgJ3V0ZjE2bGUnOlxuICAgICAgY2FzZSAndXRmLTE2bGUnOlxuICAgICAgICByZXR1cm4gdWNzMldyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpXG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGlmIChsb3dlcmVkQ2FzZSkgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIGVuY29kaW5nKVxuICAgICAgICBlbmNvZGluZyA9ICgnJyArIGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGxvd2VyZWRDYXNlID0gdHJ1ZVxuICAgIH1cbiAgfVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIHRvSlNPTiAoKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0J1ZmZlcicsXG4gICAgZGF0YTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5fYXJyIHx8IHRoaXMsIDApXG4gIH1cbn1cblxuZnVuY3Rpb24gYmFzZTY0U2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICBpZiAoc3RhcnQgPT09IDAgJiYgZW5kID09PSBidWYubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGJhc2U2NC5mcm9tQnl0ZUFycmF5KGJ1ZilcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYmFzZTY0LmZyb21CeXRlQXJyYXkoYnVmLnNsaWNlKHN0YXJ0LCBlbmQpKVxuICB9XG59XG5cbmZ1bmN0aW9uIHV0ZjhTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7XG4gIGVuZCA9IE1hdGgubWluKGJ1Zi5sZW5ndGgsIGVuZClcbiAgdmFyIHJlcyA9IFtdXG5cbiAgdmFyIGkgPSBzdGFydFxuICB3aGlsZSAoaSA8IGVuZCkge1xuICAgIHZhciBmaXJzdEJ5dGUgPSBidWZbaV1cbiAgICB2YXIgY29kZVBvaW50ID0gbnVsbFxuICAgIHZhciBieXRlc1BlclNlcXVlbmNlID0gKGZpcnN0Qnl0ZSA+IDB4RUYpID8gNFxuICAgICAgOiAoZmlyc3RCeXRlID4gMHhERikgPyAzXG4gICAgICA6IChmaXJzdEJ5dGUgPiAweEJGKSA/IDJcbiAgICAgIDogMVxuXG4gICAgaWYgKGkgKyBieXRlc1BlclNlcXVlbmNlIDw9IGVuZCkge1xuICAgICAgdmFyIHNlY29uZEJ5dGUsIHRoaXJkQnl0ZSwgZm91cnRoQnl0ZSwgdGVtcENvZGVQb2ludFxuXG4gICAgICBzd2l0Y2ggKGJ5dGVzUGVyU2VxdWVuY2UpIHtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIGlmIChmaXJzdEJ5dGUgPCAweDgwKSB7XG4gICAgICAgICAgICBjb2RlUG9pbnQgPSBmaXJzdEJ5dGVcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgIHNlY29uZEJ5dGUgPSBidWZbaSArIDFdXG4gICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMHhDMCkgPT09IDB4ODApIHtcbiAgICAgICAgICAgIHRlbXBDb2RlUG9pbnQgPSAoZmlyc3RCeXRlICYgMHgxRikgPDwgMHg2IHwgKHNlY29uZEJ5dGUgJiAweDNGKVxuICAgICAgICAgICAgaWYgKHRlbXBDb2RlUG9pbnQgPiAweDdGKSB7XG4gICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSAzOlxuICAgICAgICAgIHNlY29uZEJ5dGUgPSBidWZbaSArIDFdXG4gICAgICAgICAgdGhpcmRCeXRlID0gYnVmW2kgKyAyXVxuICAgICAgICAgIGlmICgoc2Vjb25kQnl0ZSAmIDB4QzApID09PSAweDgwICYmICh0aGlyZEJ5dGUgJiAweEMwKSA9PT0gMHg4MCkge1xuICAgICAgICAgICAgdGVtcENvZGVQb2ludCA9IChmaXJzdEJ5dGUgJiAweEYpIDw8IDB4QyB8IChzZWNvbmRCeXRlICYgMHgzRikgPDwgMHg2IHwgKHRoaXJkQnl0ZSAmIDB4M0YpXG4gICAgICAgICAgICBpZiAodGVtcENvZGVQb2ludCA+IDB4N0ZGICYmICh0ZW1wQ29kZVBvaW50IDwgMHhEODAwIHx8IHRlbXBDb2RlUG9pbnQgPiAweERGRkYpKSB7XG4gICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSA0OlxuICAgICAgICAgIHNlY29uZEJ5dGUgPSBidWZbaSArIDFdXG4gICAgICAgICAgdGhpcmRCeXRlID0gYnVmW2kgKyAyXVxuICAgICAgICAgIGZvdXJ0aEJ5dGUgPSBidWZbaSArIDNdXG4gICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMHhDMCkgPT09IDB4ODAgJiYgKHRoaXJkQnl0ZSAmIDB4QzApID09PSAweDgwICYmIChmb3VydGhCeXRlICYgMHhDMCkgPT09IDB4ODApIHtcbiAgICAgICAgICAgIHRlbXBDb2RlUG9pbnQgPSAoZmlyc3RCeXRlICYgMHhGKSA8PCAweDEyIHwgKHNlY29uZEJ5dGUgJiAweDNGKSA8PCAweEMgfCAodGhpcmRCeXRlICYgMHgzRikgPDwgMHg2IHwgKGZvdXJ0aEJ5dGUgJiAweDNGKVxuICAgICAgICAgICAgaWYgKHRlbXBDb2RlUG9pbnQgPiAweEZGRkYgJiYgdGVtcENvZGVQb2ludCA8IDB4MTEwMDAwKSB7XG4gICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNvZGVQb2ludCA9PT0gbnVsbCkge1xuICAgICAgLy8gd2UgZGlkIG5vdCBnZW5lcmF0ZSBhIHZhbGlkIGNvZGVQb2ludCBzbyBpbnNlcnQgYVxuICAgICAgLy8gcmVwbGFjZW1lbnQgY2hhciAoVStGRkZEKSBhbmQgYWR2YW5jZSBvbmx5IDEgYnl0ZVxuICAgICAgY29kZVBvaW50ID0gMHhGRkZEXG4gICAgICBieXRlc1BlclNlcXVlbmNlID0gMVxuICAgIH0gZWxzZSBpZiAoY29kZVBvaW50ID4gMHhGRkZGKSB7XG4gICAgICAvLyBlbmNvZGUgdG8gdXRmMTYgKHN1cnJvZ2F0ZSBwYWlyIGRhbmNlKVxuICAgICAgY29kZVBvaW50IC09IDB4MTAwMDBcbiAgICAgIHJlcy5wdXNoKGNvZGVQb2ludCA+Pj4gMTAgJiAweDNGRiB8IDB4RDgwMClcbiAgICAgIGNvZGVQb2ludCA9IDB4REMwMCB8IGNvZGVQb2ludCAmIDB4M0ZGXG4gICAgfVxuXG4gICAgcmVzLnB1c2goY29kZVBvaW50KVxuICAgIGkgKz0gYnl0ZXNQZXJTZXF1ZW5jZVxuICB9XG5cbiAgcmV0dXJuIGRlY29kZUNvZGVQb2ludHNBcnJheShyZXMpXG59XG5cbi8vIEJhc2VkIG9uIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzIyNzQ3MjcyLzY4MDc0MiwgdGhlIGJyb3dzZXIgd2l0aFxuLy8gdGhlIGxvd2VzdCBsaW1pdCBpcyBDaHJvbWUsIHdpdGggMHgxMDAwMCBhcmdzLlxuLy8gV2UgZ28gMSBtYWduaXR1ZGUgbGVzcywgZm9yIHNhZmV0eVxudmFyIE1BWF9BUkdVTUVOVFNfTEVOR1RIID0gMHgxMDAwXG5cbmZ1bmN0aW9uIGRlY29kZUNvZGVQb2ludHNBcnJheSAoY29kZVBvaW50cykge1xuICB2YXIgbGVuID0gY29kZVBvaW50cy5sZW5ndGhcbiAgaWYgKGxlbiA8PSBNQVhfQVJHVU1FTlRTX0xFTkdUSCkge1xuICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgY29kZVBvaW50cykgLy8gYXZvaWQgZXh0cmEgc2xpY2UoKVxuICB9XG5cbiAgLy8gRGVjb2RlIGluIGNodW5rcyB0byBhdm9pZCBcImNhbGwgc3RhY2sgc2l6ZSBleGNlZWRlZFwiLlxuICB2YXIgcmVzID0gJydcbiAgdmFyIGkgPSAwXG4gIHdoaWxlIChpIDwgbGVuKSB7XG4gICAgcmVzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoXG4gICAgICBTdHJpbmcsXG4gICAgICBjb2RlUG9pbnRzLnNsaWNlKGksIGkgKz0gTUFYX0FSR1VNRU5UU19MRU5HVEgpXG4gICAgKVxuICB9XG4gIHJldHVybiByZXNcbn1cblxuZnVuY3Rpb24gYXNjaWlTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7XG4gIHZhciByZXQgPSAnJ1xuICBlbmQgPSBNYXRoLm1pbihidWYubGVuZ3RoLCBlbmQpXG5cbiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHtcbiAgICByZXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShidWZbaV0gJiAweDdGKVxuICB9XG4gIHJldHVybiByZXRcbn1cblxuZnVuY3Rpb24gbGF0aW4xU2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICB2YXIgcmV0ID0gJydcbiAgZW5kID0gTWF0aC5taW4oYnVmLmxlbmd0aCwgZW5kKVxuXG4gIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7XG4gICAgcmV0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2ldKVxuICB9XG4gIHJldHVybiByZXRcbn1cblxuZnVuY3Rpb24gaGV4U2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICB2YXIgbGVuID0gYnVmLmxlbmd0aFxuXG4gIGlmICghc3RhcnQgfHwgc3RhcnQgPCAwKSBzdGFydCA9IDBcbiAgaWYgKCFlbmQgfHwgZW5kIDwgMCB8fCBlbmQgPiBsZW4pIGVuZCA9IGxlblxuXG4gIHZhciBvdXQgPSAnJ1xuICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7ICsraSkge1xuICAgIG91dCArPSB0b0hleChidWZbaV0pXG4gIH1cbiAgcmV0dXJuIG91dFxufVxuXG5mdW5jdGlvbiB1dGYxNmxlU2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICB2YXIgYnl0ZXMgPSBidWYuc2xpY2Uoc3RhcnQsIGVuZClcbiAgdmFyIHJlcyA9ICcnXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYnl0ZXMubGVuZ3RoOyBpICs9IDIpIHtcbiAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSArIGJ5dGVzW2kgKyAxXSAqIDI1NilcbiAgfVxuICByZXR1cm4gcmVzXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUuc2xpY2UgPSBmdW5jdGlvbiBzbGljZSAoc3RhcnQsIGVuZCkge1xuICB2YXIgbGVuID0gdGhpcy5sZW5ndGhcbiAgc3RhcnQgPSB+fnN0YXJ0XG4gIGVuZCA9IGVuZCA9PT0gdW5kZWZpbmVkID8gbGVuIDogfn5lbmRcblxuICBpZiAoc3RhcnQgPCAwKSB7XG4gICAgc3RhcnQgKz0gbGVuXG4gICAgaWYgKHN0YXJ0IDwgMCkgc3RhcnQgPSAwXG4gIH0gZWxzZSBpZiAoc3RhcnQgPiBsZW4pIHtcbiAgICBzdGFydCA9IGxlblxuICB9XG5cbiAgaWYgKGVuZCA8IDApIHtcbiAgICBlbmQgKz0gbGVuXG4gICAgaWYgKGVuZCA8IDApIGVuZCA9IDBcbiAgfSBlbHNlIGlmIChlbmQgPiBsZW4pIHtcbiAgICBlbmQgPSBsZW5cbiAgfVxuXG4gIGlmIChlbmQgPCBzdGFydCkgZW5kID0gc3RhcnRcblxuICB2YXIgbmV3QnVmXG4gIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgIG5ld0J1ZiA9IHRoaXMuc3ViYXJyYXkoc3RhcnQsIGVuZClcbiAgICBuZXdCdWYuX19wcm90b19fID0gQnVmZmVyLnByb3RvdHlwZVxuICB9IGVsc2Uge1xuICAgIHZhciBzbGljZUxlbiA9IGVuZCAtIHN0YXJ0XG4gICAgbmV3QnVmID0gbmV3IEJ1ZmZlcihzbGljZUxlbiwgdW5kZWZpbmVkKVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpY2VMZW47ICsraSkge1xuICAgICAgbmV3QnVmW2ldID0gdGhpc1tpICsgc3RhcnRdXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5ld0J1ZlxufVxuXG4vKlxuICogTmVlZCB0byBtYWtlIHN1cmUgdGhhdCBidWZmZXIgaXNuJ3QgdHJ5aW5nIHRvIHdyaXRlIG91dCBvZiBib3VuZHMuXG4gKi9cbmZ1bmN0aW9uIGNoZWNrT2Zmc2V0IChvZmZzZXQsIGV4dCwgbGVuZ3RoKSB7XG4gIGlmICgob2Zmc2V0ICUgMSkgIT09IDAgfHwgb2Zmc2V0IDwgMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ29mZnNldCBpcyBub3QgdWludCcpXG4gIGlmIChvZmZzZXQgKyBleHQgPiBsZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCdUcnlpbmcgdG8gYWNjZXNzIGJleW9uZCBidWZmZXIgbGVuZ3RoJylcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludExFID0gZnVuY3Rpb24gcmVhZFVJbnRMRSAob2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkge1xuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMFxuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIGJ5dGVMZW5ndGgsIHRoaXMubGVuZ3RoKVxuXG4gIHZhciB2YWwgPSB0aGlzW29mZnNldF1cbiAgdmFyIG11bCA9IDFcbiAgdmFyIGkgPSAwXG4gIHdoaWxlICgrK2kgPCBieXRlTGVuZ3RoICYmIChtdWwgKj0gMHgxMDApKSB7XG4gICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgaV0gKiBtdWxcbiAgfVxuXG4gIHJldHVybiB2YWxcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludEJFID0gZnVuY3Rpb24gcmVhZFVJbnRCRSAob2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkge1xuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMFxuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoLCB0aGlzLmxlbmd0aClcbiAgfVxuXG4gIHZhciB2YWwgPSB0aGlzW29mZnNldCArIC0tYnl0ZUxlbmd0aF1cbiAgdmFyIG11bCA9IDFcbiAgd2hpbGUgKGJ5dGVMZW5ndGggPiAwICYmIChtdWwgKj0gMHgxMDApKSB7XG4gICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgLS1ieXRlTGVuZ3RoXSAqIG11bFxuICB9XG5cbiAgcmV0dXJuIHZhbFxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50OCA9IGZ1bmN0aW9uIHJlYWRVSW50OCAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDEsIHRoaXMubGVuZ3RoKVxuICByZXR1cm4gdGhpc1tvZmZzZXRdXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnQxNkxFID0gZnVuY3Rpb24gcmVhZFVJbnQxNkxFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpXG4gIHJldHVybiB0aGlzW29mZnNldF0gfCAodGhpc1tvZmZzZXQgKyAxXSA8PCA4KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MTZCRSA9IGZ1bmN0aW9uIHJlYWRVSW50MTZCRSAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKVxuICByZXR1cm4gKHRoaXNbb2Zmc2V0XSA8PCA4KSB8IHRoaXNbb2Zmc2V0ICsgMV1cbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDMyTEUgPSBmdW5jdGlvbiByZWFkVUludDMyTEUgKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aClcblxuICByZXR1cm4gKCh0aGlzW29mZnNldF0pIHxcbiAgICAgICh0aGlzW29mZnNldCArIDFdIDw8IDgpIHxcbiAgICAgICh0aGlzW29mZnNldCArIDJdIDw8IDE2KSkgK1xuICAgICAgKHRoaXNbb2Zmc2V0ICsgM10gKiAweDEwMDAwMDApXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnQzMkJFID0gZnVuY3Rpb24gcmVhZFVJbnQzMkJFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpXG5cbiAgcmV0dXJuICh0aGlzW29mZnNldF0gKiAweDEwMDAwMDApICtcbiAgICAoKHRoaXNbb2Zmc2V0ICsgMV0gPDwgMTYpIHxcbiAgICAodGhpc1tvZmZzZXQgKyAyXSA8PCA4KSB8XG4gICAgdGhpc1tvZmZzZXQgKyAzXSlcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50TEUgPSBmdW5jdGlvbiByZWFkSW50TEUgKG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHtcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDBcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoLCB0aGlzLmxlbmd0aClcblxuICB2YXIgdmFsID0gdGhpc1tvZmZzZXRdXG4gIHZhciBtdWwgPSAxXG4gIHZhciBpID0gMFxuICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgIHZhbCArPSB0aGlzW29mZnNldCArIGldICogbXVsXG4gIH1cbiAgbXVsICo9IDB4ODBcblxuICBpZiAodmFsID49IG11bCkgdmFsIC09IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoKVxuXG4gIHJldHVybiB2YWxcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50QkUgPSBmdW5jdGlvbiByZWFkSW50QkUgKG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHtcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDBcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoLCB0aGlzLmxlbmd0aClcblxuICB2YXIgaSA9IGJ5dGVMZW5ndGhcbiAgdmFyIG11bCA9IDFcbiAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0ICsgLS1pXVxuICB3aGlsZSAoaSA+IDAgJiYgKG11bCAqPSAweDEwMCkpIHtcbiAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyAtLWldICogbXVsXG4gIH1cbiAgbXVsICo9IDB4ODBcblxuICBpZiAodmFsID49IG11bCkgdmFsIC09IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoKVxuXG4gIHJldHVybiB2YWxcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50OCA9IGZ1bmN0aW9uIHJlYWRJbnQ4IChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgMSwgdGhpcy5sZW5ndGgpXG4gIGlmICghKHRoaXNbb2Zmc2V0XSAmIDB4ODApKSByZXR1cm4gKHRoaXNbb2Zmc2V0XSlcbiAgcmV0dXJuICgoMHhmZiAtIHRoaXNbb2Zmc2V0XSArIDEpICogLTEpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDE2TEUgPSBmdW5jdGlvbiByZWFkSW50MTZMRSAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKVxuICB2YXIgdmFsID0gdGhpc1tvZmZzZXRdIHwgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgOClcbiAgcmV0dXJuICh2YWwgJiAweDgwMDApID8gdmFsIHwgMHhGRkZGMDAwMCA6IHZhbFxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRJbnQxNkJFID0gZnVuY3Rpb24gcmVhZEludDE2QkUgKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCAyLCB0aGlzLmxlbmd0aClcbiAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0ICsgMV0gfCAodGhpc1tvZmZzZXRdIDw8IDgpXG4gIHJldHVybiAodmFsICYgMHg4MDAwKSA/IHZhbCB8IDB4RkZGRjAwMDAgOiB2YWxcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MzJMRSA9IGZ1bmN0aW9uIHJlYWRJbnQzMkxFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpXG5cbiAgcmV0dXJuICh0aGlzW29mZnNldF0pIHxcbiAgICAodGhpc1tvZmZzZXQgKyAxXSA8PCA4KSB8XG4gICAgKHRoaXNbb2Zmc2V0ICsgMl0gPDwgMTYpIHxcbiAgICAodGhpc1tvZmZzZXQgKyAzXSA8PCAyNClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MzJCRSA9IGZ1bmN0aW9uIHJlYWRJbnQzMkJFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpXG5cbiAgcmV0dXJuICh0aGlzW29mZnNldF0gPDwgMjQpIHxcbiAgICAodGhpc1tvZmZzZXQgKyAxXSA8PCAxNikgfFxuICAgICh0aGlzW29mZnNldCArIDJdIDw8IDgpIHxcbiAgICAodGhpc1tvZmZzZXQgKyAzXSlcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkRmxvYXRMRSA9IGZ1bmN0aW9uIHJlYWRGbG9hdExFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpXG4gIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCB0cnVlLCAyMywgNClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkRmxvYXRCRSA9IGZ1bmN0aW9uIHJlYWRGbG9hdEJFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpXG4gIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCBmYWxzZSwgMjMsIDQpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZERvdWJsZUxFID0gZnVuY3Rpb24gcmVhZERvdWJsZUxFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgOCwgdGhpcy5sZW5ndGgpXG4gIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCB0cnVlLCA1MiwgOClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkRG91YmxlQkUgPSBmdW5jdGlvbiByZWFkRG91YmxlQkUgKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCA4LCB0aGlzLmxlbmd0aClcbiAgcmV0dXJuIGllZWU3NTQucmVhZCh0aGlzLCBvZmZzZXQsIGZhbHNlLCA1MiwgOClcbn1cblxuZnVuY3Rpb24gY2hlY2tJbnQgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgZXh0LCBtYXgsIG1pbikge1xuICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihidWYpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImJ1ZmZlclwiIGFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIgaW5zdGFuY2UnKVxuICBpZiAodmFsdWUgPiBtYXggfHwgdmFsdWUgPCBtaW4pIHRocm93IG5ldyBSYW5nZUVycm9yKCdcInZhbHVlXCIgYXJndW1lbnQgaXMgb3V0IG9mIGJvdW5kcycpXG4gIGlmIChvZmZzZXQgKyBleHQgPiBidWYubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW5kZXggb3V0IG9mIHJhbmdlJylcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnRMRSA9IGZ1bmN0aW9uIHdyaXRlVUludExFICh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMFxuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgdmFyIG1heEJ5dGVzID0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgpIC0gMVxuICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG1heEJ5dGVzLCAwKVxuICB9XG5cbiAgdmFyIG11bCA9IDFcbiAgdmFyIGkgPSAwXG4gIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMHhGRlxuICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSAodmFsdWUgLyBtdWwpICYgMHhGRlxuICB9XG5cbiAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGhcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnRCRSA9IGZ1bmN0aW9uIHdyaXRlVUludEJFICh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMFxuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgdmFyIG1heEJ5dGVzID0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgpIC0gMVxuICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG1heEJ5dGVzLCAwKVxuICB9XG5cbiAgdmFyIGkgPSBieXRlTGVuZ3RoIC0gMVxuICB2YXIgbXVsID0gMVxuICB0aGlzW29mZnNldCArIGldID0gdmFsdWUgJiAweEZGXG4gIHdoaWxlICgtLWkgPj0gMCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSAodmFsdWUgLyBtdWwpICYgMHhGRlxuICB9XG5cbiAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGhcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQ4ID0gZnVuY3Rpb24gd3JpdGVVSW50OCAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBpZiAoIW5vQXNzZXJ0KSBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAxLCAweGZmLCAwKVxuICBpZiAoIUJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB2YWx1ZSA9IE1hdGguZmxvb3IodmFsdWUpXG4gIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpXG4gIHJldHVybiBvZmZzZXQgKyAxXG59XG5cbmZ1bmN0aW9uIG9iamVjdFdyaXRlVUludDE2IChidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbikge1xuICBpZiAodmFsdWUgPCAwKSB2YWx1ZSA9IDB4ZmZmZiArIHZhbHVlICsgMVxuICBmb3IgKHZhciBpID0gMCwgaiA9IE1hdGgubWluKGJ1Zi5sZW5ndGggLSBvZmZzZXQsIDIpOyBpIDwgajsgKytpKSB7XG4gICAgYnVmW29mZnNldCArIGldID0gKHZhbHVlICYgKDB4ZmYgPDwgKDggKiAobGl0dGxlRW5kaWFuID8gaSA6IDEgLSBpKSkpKSA+Pj5cbiAgICAgIChsaXR0bGVFbmRpYW4gPyBpIDogMSAtIGkpICogOFxuICB9XG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MTZMRSA9IGZ1bmN0aW9uIHdyaXRlVUludDE2TEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHZhbHVlID0gK3ZhbHVlXG4gIG9mZnNldCA9IG9mZnNldCB8IDBcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHhmZmZmLCAwKVxuICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgJiAweGZmKVxuICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpXG4gIH0gZWxzZSB7XG4gICAgb2JqZWN0V3JpdGVVSW50MTYodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSlcbiAgfVxuICByZXR1cm4gb2Zmc2V0ICsgMlxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlVUludDE2QkUgPSBmdW5jdGlvbiB3cml0ZVVJbnQxNkJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDIsIDB4ZmZmZiwgMClcbiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlID4+PiA4KVxuICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgJiAweGZmKVxuICB9IGVsc2Uge1xuICAgIG9iamVjdFdyaXRlVUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlKVxuICB9XG4gIHJldHVybiBvZmZzZXQgKyAyXG59XG5cbmZ1bmN0aW9uIG9iamVjdFdyaXRlVUludDMyIChidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbikge1xuICBpZiAodmFsdWUgPCAwKSB2YWx1ZSA9IDB4ZmZmZmZmZmYgKyB2YWx1ZSArIDFcbiAgZm9yICh2YXIgaSA9IDAsIGogPSBNYXRoLm1pbihidWYubGVuZ3RoIC0gb2Zmc2V0LCA0KTsgaSA8IGo7ICsraSkge1xuICAgIGJ1ZltvZmZzZXQgKyBpXSA9ICh2YWx1ZSA+Pj4gKGxpdHRsZUVuZGlhbiA/IGkgOiAzIC0gaSkgKiA4KSAmIDB4ZmZcbiAgfVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlVUludDMyTEUgPSBmdW5jdGlvbiB3cml0ZVVJbnQzMkxFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4ZmZmZmZmZmYsIDApXG4gIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgIHRoaXNbb2Zmc2V0ICsgM10gPSAodmFsdWUgPj4+IDI0KVxuICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSAodmFsdWUgPj4+IDE2KVxuICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpXG4gICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZilcbiAgfSBlbHNlIHtcbiAgICBvYmplY3RXcml0ZVVJbnQzMih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlKVxuICB9XG4gIHJldHVybiBvZmZzZXQgKyA0XG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MzJCRSA9IGZ1bmN0aW9uIHdyaXRlVUludDMyQkUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHZhbHVlID0gK3ZhbHVlXG4gIG9mZnNldCA9IG9mZnNldCB8IDBcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgMHhmZmZmZmZmZiwgMClcbiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlID4+PiAyNClcbiAgICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiAxNilcbiAgICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiA4KVxuICAgIHRoaXNbb2Zmc2V0ICsgM10gPSAodmFsdWUgJiAweGZmKVxuICB9IGVsc2Uge1xuICAgIG9iamVjdFdyaXRlVUludDMyKHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlKVxuICB9XG4gIHJldHVybiBvZmZzZXQgKyA0XG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnRMRSA9IGZ1bmN0aW9uIHdyaXRlSW50TEUgKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7XG4gIHZhbHVlID0gK3ZhbHVlXG4gIG9mZnNldCA9IG9mZnNldCB8IDBcbiAgaWYgKCFub0Fzc2VydCkge1xuICAgIHZhciBsaW1pdCA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoIC0gMSlcblxuICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIGxpbWl0IC0gMSwgLWxpbWl0KVxuICB9XG5cbiAgdmFyIGkgPSAwXG4gIHZhciBtdWwgPSAxXG4gIHZhciBzdWIgPSAwXG4gIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMHhGRlxuICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgIGlmICh2YWx1ZSA8IDAgJiYgc3ViID09PSAwICYmIHRoaXNbb2Zmc2V0ICsgaSAtIDFdICE9PSAwKSB7XG4gICAgICBzdWIgPSAxXG4gICAgfVxuICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSAoKHZhbHVlIC8gbXVsKSA+PiAwKSAtIHN1YiAmIDB4RkZcbiAgfVxuXG4gIHJldHVybiBvZmZzZXQgKyBieXRlTGVuZ3RoXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnRCRSA9IGZ1bmN0aW9uIHdyaXRlSW50QkUgKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7XG4gIHZhbHVlID0gK3ZhbHVlXG4gIG9mZnNldCA9IG9mZnNldCB8IDBcbiAgaWYgKCFub0Fzc2VydCkge1xuICAgIHZhciBsaW1pdCA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoIC0gMSlcblxuICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIGxpbWl0IC0gMSwgLWxpbWl0KVxuICB9XG5cbiAgdmFyIGkgPSBieXRlTGVuZ3RoIC0gMVxuICB2YXIgbXVsID0gMVxuICB2YXIgc3ViID0gMFxuICB0aGlzW29mZnNldCArIGldID0gdmFsdWUgJiAweEZGXG4gIHdoaWxlICgtLWkgPj0gMCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgIGlmICh2YWx1ZSA8IDAgJiYgc3ViID09PSAwICYmIHRoaXNbb2Zmc2V0ICsgaSArIDFdICE9PSAwKSB7XG4gICAgICBzdWIgPSAxXG4gICAgfVxuICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSAoKHZhbHVlIC8gbXVsKSA+PiAwKSAtIHN1YiAmIDB4RkZcbiAgfVxuXG4gIHJldHVybiBvZmZzZXQgKyBieXRlTGVuZ3RoXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQ4ID0gZnVuY3Rpb24gd3JpdGVJbnQ4ICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDEsIDB4N2YsIC0weDgwKVxuICBpZiAoIUJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB2YWx1ZSA9IE1hdGguZmxvb3IodmFsdWUpXG4gIGlmICh2YWx1ZSA8IDApIHZhbHVlID0gMHhmZiArIHZhbHVlICsgMVxuICB0aGlzW29mZnNldF0gPSAodmFsdWUgJiAweGZmKVxuICByZXR1cm4gb2Zmc2V0ICsgMVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50MTZMRSA9IGZ1bmN0aW9uIHdyaXRlSW50MTZMRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBpZiAoIW5vQXNzZXJ0KSBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAyLCAweDdmZmYsIC0weDgwMDApXG4gIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpXG4gICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gOClcbiAgfSBlbHNlIHtcbiAgICBvYmplY3RXcml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlKVxuICB9XG4gIHJldHVybiBvZmZzZXQgKyAyXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQxNkJFID0gZnVuY3Rpb24gd3JpdGVJbnQxNkJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDIsIDB4N2ZmZiwgLTB4ODAwMClcbiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlID4+PiA4KVxuICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgJiAweGZmKVxuICB9IGVsc2Uge1xuICAgIG9iamVjdFdyaXRlVUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlKVxuICB9XG4gIHJldHVybiBvZmZzZXQgKyAyXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQzMkxFID0gZnVuY3Rpb24gd3JpdGVJbnQzMkxFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4N2ZmZmZmZmYsIC0weDgwMDAwMDAwKVxuICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgJiAweGZmKVxuICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpXG4gICAgdGhpc1tvZmZzZXQgKyAyXSA9ICh2YWx1ZSA+Pj4gMTYpXG4gICAgdGhpc1tvZmZzZXQgKyAzXSA9ICh2YWx1ZSA+Pj4gMjQpXG4gIH0gZWxzZSB7XG4gICAgb2JqZWN0V3JpdGVVSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSlcbiAgfVxuICByZXR1cm4gb2Zmc2V0ICsgNFxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50MzJCRSA9IGZ1bmN0aW9uIHdyaXRlSW50MzJCRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBpZiAoIW5vQXNzZXJ0KSBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCA0LCAweDdmZmZmZmZmLCAtMHg4MDAwMDAwMClcbiAgaWYgKHZhbHVlIDwgMCkgdmFsdWUgPSAweGZmZmZmZmZmICsgdmFsdWUgKyAxXG4gIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gMjQpXG4gICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gMTYpXG4gICAgdGhpc1tvZmZzZXQgKyAyXSA9ICh2YWx1ZSA+Pj4gOClcbiAgICB0aGlzW29mZnNldCArIDNdID0gKHZhbHVlICYgMHhmZilcbiAgfSBlbHNlIHtcbiAgICBvYmplY3RXcml0ZVVJbnQzMih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSlcbiAgfVxuICByZXR1cm4gb2Zmc2V0ICsgNFxufVxuXG5mdW5jdGlvbiBjaGVja0lFRUU3NTQgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgZXh0LCBtYXgsIG1pbikge1xuICBpZiAob2Zmc2V0ICsgZXh0ID4gYnVmLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0luZGV4IG91dCBvZiByYW5nZScpXG4gIGlmIChvZmZzZXQgPCAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW5kZXggb3V0IG9mIHJhbmdlJylcbn1cblxuZnVuY3Rpb24gd3JpdGVGbG9hdCAoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICBjaGVja0lFRUU3NTQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCA0LCAzLjQwMjgyMzQ2NjM4NTI4ODZlKzM4LCAtMy40MDI4MjM0NjYzODUyODg2ZSszOClcbiAgfVxuICBpZWVlNzU0LndyaXRlKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCAyMywgNClcbiAgcmV0dXJuIG9mZnNldCArIDRcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZUZsb2F0TEUgPSBmdW5jdGlvbiB3cml0ZUZsb2F0TEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHJldHVybiB3cml0ZUZsb2F0KHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlRmxvYXRCRSA9IGZ1bmN0aW9uIHdyaXRlRmxvYXRCRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgcmV0dXJuIHdyaXRlRmxvYXQodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KVxufVxuXG5mdW5jdGlvbiB3cml0ZURvdWJsZSAoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICBjaGVja0lFRUU3NTQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCA4LCAxLjc5NzY5MzEzNDg2MjMxNTdFKzMwOCwgLTEuNzk3NjkzMTM0ODYyMzE1N0UrMzA4KVxuICB9XG4gIGllZWU3NTQud3JpdGUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIDUyLCA4KVxuICByZXR1cm4gb2Zmc2V0ICsgOFxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlRG91YmxlTEUgPSBmdW5jdGlvbiB3cml0ZURvdWJsZUxFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICByZXR1cm4gd3JpdGVEb3VibGUodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSwgbm9Bc3NlcnQpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVEb3VibGVCRSA9IGZ1bmN0aW9uIHdyaXRlRG91YmxlQkUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHJldHVybiB3cml0ZURvdWJsZSh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSwgbm9Bc3NlcnQpXG59XG5cbi8vIGNvcHkodGFyZ2V0QnVmZmVyLCB0YXJnZXRTdGFydD0wLCBzb3VyY2VTdGFydD0wLCBzb3VyY2VFbmQ9YnVmZmVyLmxlbmd0aClcbkJ1ZmZlci5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uIGNvcHkgKHRhcmdldCwgdGFyZ2V0U3RhcnQsIHN0YXJ0LCBlbmQpIHtcbiAgaWYgKCFzdGFydCkgc3RhcnQgPSAwXG4gIGlmICghZW5kICYmIGVuZCAhPT0gMCkgZW5kID0gdGhpcy5sZW5ndGhcbiAgaWYgKHRhcmdldFN0YXJ0ID49IHRhcmdldC5sZW5ndGgpIHRhcmdldFN0YXJ0ID0gdGFyZ2V0Lmxlbmd0aFxuICBpZiAoIXRhcmdldFN0YXJ0KSB0YXJnZXRTdGFydCA9IDBcbiAgaWYgKGVuZCA+IDAgJiYgZW5kIDwgc3RhcnQpIGVuZCA9IHN0YXJ0XG5cbiAgLy8gQ29weSAwIGJ5dGVzOyB3ZSdyZSBkb25lXG4gIGlmIChlbmQgPT09IHN0YXJ0KSByZXR1cm4gMFxuICBpZiAodGFyZ2V0Lmxlbmd0aCA9PT0gMCB8fCB0aGlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDBcblxuICAvLyBGYXRhbCBlcnJvciBjb25kaXRpb25zXG4gIGlmICh0YXJnZXRTdGFydCA8IDApIHtcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigndGFyZ2V0U3RhcnQgb3V0IG9mIGJvdW5kcycpXG4gIH1cbiAgaWYgKHN0YXJ0IDwgMCB8fCBzdGFydCA+PSB0aGlzLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3NvdXJjZVN0YXJ0IG91dCBvZiBib3VuZHMnKVxuICBpZiAoZW5kIDwgMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3NvdXJjZUVuZCBvdXQgb2YgYm91bmRzJylcblxuICAvLyBBcmUgd2Ugb29iP1xuICBpZiAoZW5kID4gdGhpcy5sZW5ndGgpIGVuZCA9IHRoaXMubGVuZ3RoXG4gIGlmICh0YXJnZXQubGVuZ3RoIC0gdGFyZ2V0U3RhcnQgPCBlbmQgLSBzdGFydCkge1xuICAgIGVuZCA9IHRhcmdldC5sZW5ndGggLSB0YXJnZXRTdGFydCArIHN0YXJ0XG4gIH1cblxuICB2YXIgbGVuID0gZW5kIC0gc3RhcnRcbiAgdmFyIGlcblxuICBpZiAodGhpcyA9PT0gdGFyZ2V0ICYmIHN0YXJ0IDwgdGFyZ2V0U3RhcnQgJiYgdGFyZ2V0U3RhcnQgPCBlbmQpIHtcbiAgICAvLyBkZXNjZW5kaW5nIGNvcHkgZnJvbSBlbmRcbiAgICBmb3IgKGkgPSBsZW4gLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgdGFyZ2V0W2kgKyB0YXJnZXRTdGFydF0gPSB0aGlzW2kgKyBzdGFydF1cbiAgICB9XG4gIH0gZWxzZSBpZiAobGVuIDwgMTAwMCB8fCAhQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICAvLyBhc2NlbmRpbmcgY29weSBmcm9tIHN0YXJ0XG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICB0YXJnZXRbaSArIHRhcmdldFN0YXJ0XSA9IHRoaXNbaSArIHN0YXJ0XVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBVaW50OEFycmF5LnByb3RvdHlwZS5zZXQuY2FsbChcbiAgICAgIHRhcmdldCxcbiAgICAgIHRoaXMuc3ViYXJyYXkoc3RhcnQsIHN0YXJ0ICsgbGVuKSxcbiAgICAgIHRhcmdldFN0YXJ0XG4gICAgKVxuICB9XG5cbiAgcmV0dXJuIGxlblxufVxuXG4vLyBVc2FnZTpcbi8vICAgIGJ1ZmZlci5maWxsKG51bWJlclssIG9mZnNldFssIGVuZF1dKVxuLy8gICAgYnVmZmVyLmZpbGwoYnVmZmVyWywgb2Zmc2V0WywgZW5kXV0pXG4vLyAgICBidWZmZXIuZmlsbChzdHJpbmdbLCBvZmZzZXRbLCBlbmRdXVssIGVuY29kaW5nXSlcbkJ1ZmZlci5wcm90b3R5cGUuZmlsbCA9IGZ1bmN0aW9uIGZpbGwgKHZhbCwgc3RhcnQsIGVuZCwgZW5jb2RpbmcpIHtcbiAgLy8gSGFuZGxlIHN0cmluZyBjYXNlczpcbiAgaWYgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnKSB7XG4gICAgaWYgKHR5cGVvZiBzdGFydCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGVuY29kaW5nID0gc3RhcnRcbiAgICAgIHN0YXJ0ID0gMFxuICAgICAgZW5kID0gdGhpcy5sZW5ndGhcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbmQgPT09ICdzdHJpbmcnKSB7XG4gICAgICBlbmNvZGluZyA9IGVuZFxuICAgICAgZW5kID0gdGhpcy5sZW5ndGhcbiAgICB9XG4gICAgaWYgKHZhbC5sZW5ndGggPT09IDEpIHtcbiAgICAgIHZhciBjb2RlID0gdmFsLmNoYXJDb2RlQXQoMClcbiAgICAgIGlmIChjb2RlIDwgMjU2KSB7XG4gICAgICAgIHZhbCA9IGNvZGVcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGVuY29kaW5nICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGVuY29kaW5nICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignZW5jb2RpbmcgbXVzdCBiZSBhIHN0cmluZycpXG4gICAgfVxuICAgIGlmICh0eXBlb2YgZW5jb2RpbmcgPT09ICdzdHJpbmcnICYmICFCdWZmZXIuaXNFbmNvZGluZyhlbmNvZGluZykpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Vua25vd24gZW5jb2Rpbmc6ICcgKyBlbmNvZGluZylcbiAgICB9XG4gIH0gZWxzZSBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicpIHtcbiAgICB2YWwgPSB2YWwgJiAyNTVcbiAgfVxuXG4gIC8vIEludmFsaWQgcmFuZ2VzIGFyZSBub3Qgc2V0IHRvIGEgZGVmYXVsdCwgc28gY2FuIHJhbmdlIGNoZWNrIGVhcmx5LlxuICBpZiAoc3RhcnQgPCAwIHx8IHRoaXMubGVuZ3RoIDwgc3RhcnQgfHwgdGhpcy5sZW5ndGggPCBlbmQpIHtcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignT3V0IG9mIHJhbmdlIGluZGV4JylcbiAgfVxuXG4gIGlmIChlbmQgPD0gc3RhcnQpIHtcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgc3RhcnQgPSBzdGFydCA+Pj4gMFxuICBlbmQgPSBlbmQgPT09IHVuZGVmaW5lZCA/IHRoaXMubGVuZ3RoIDogZW5kID4+PiAwXG5cbiAgaWYgKCF2YWwpIHZhbCA9IDBcblxuICB2YXIgaVxuICBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicpIHtcbiAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7XG4gICAgICB0aGlzW2ldID0gdmFsXG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHZhciBieXRlcyA9IEJ1ZmZlci5pc0J1ZmZlcih2YWwpXG4gICAgICA/IHZhbFxuICAgICAgOiB1dGY4VG9CeXRlcyhuZXcgQnVmZmVyKHZhbCwgZW5jb2RpbmcpLnRvU3RyaW5nKCkpXG4gICAgdmFyIGxlbiA9IGJ5dGVzLmxlbmd0aFxuICAgIGZvciAoaSA9IDA7IGkgPCBlbmQgLSBzdGFydDsgKytpKSB7XG4gICAgICB0aGlzW2kgKyBzdGFydF0gPSBieXRlc1tpICUgbGVuXVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0aGlzXG59XG5cbi8vIEhFTFBFUiBGVU5DVElPTlNcbi8vID09PT09PT09PT09PT09PT1cblxudmFyIElOVkFMSURfQkFTRTY0X1JFID0gL1teK1xcLzAtOUEtWmEtei1fXS9nXG5cbmZ1bmN0aW9uIGJhc2U2NGNsZWFuIChzdHIpIHtcbiAgLy8gTm9kZSBzdHJpcHMgb3V0IGludmFsaWQgY2hhcmFjdGVycyBsaWtlIFxcbiBhbmQgXFx0IGZyb20gdGhlIHN0cmluZywgYmFzZTY0LWpzIGRvZXMgbm90XG4gIHN0ciA9IHN0cmluZ3RyaW0oc3RyKS5yZXBsYWNlKElOVkFMSURfQkFTRTY0X1JFLCAnJylcbiAgLy8gTm9kZSBjb252ZXJ0cyBzdHJpbmdzIHdpdGggbGVuZ3RoIDwgMiB0byAnJ1xuICBpZiAoc3RyLmxlbmd0aCA8IDIpIHJldHVybiAnJ1xuICAvLyBOb2RlIGFsbG93cyBmb3Igbm9uLXBhZGRlZCBiYXNlNjQgc3RyaW5ncyAobWlzc2luZyB0cmFpbGluZyA9PT0pLCBiYXNlNjQtanMgZG9lcyBub3RcbiAgd2hpbGUgKHN0ci5sZW5ndGggJSA0ICE9PSAwKSB7XG4gICAgc3RyID0gc3RyICsgJz0nXG4gIH1cbiAgcmV0dXJuIHN0clxufVxuXG5mdW5jdGlvbiBzdHJpbmd0cmltIChzdHIpIHtcbiAgaWYgKHN0ci50cmltKSByZXR1cm4gc3RyLnRyaW0oKVxuICByZXR1cm4gc3RyLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKVxufVxuXG5mdW5jdGlvbiB0b0hleCAobikge1xuICBpZiAobiA8IDE2KSByZXR1cm4gJzAnICsgbi50b1N0cmluZygxNilcbiAgcmV0dXJuIG4udG9TdHJpbmcoMTYpXG59XG5cbmZ1bmN0aW9uIHV0ZjhUb0J5dGVzIChzdHJpbmcsIHVuaXRzKSB7XG4gIHVuaXRzID0gdW5pdHMgfHwgSW5maW5pdHlcbiAgdmFyIGNvZGVQb2ludFxuICB2YXIgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aFxuICB2YXIgbGVhZFN1cnJvZ2F0ZSA9IG51bGxcbiAgdmFyIGJ5dGVzID0gW11cblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgY29kZVBvaW50ID0gc3RyaW5nLmNoYXJDb2RlQXQoaSlcblxuICAgIC8vIGlzIHN1cnJvZ2F0ZSBjb21wb25lbnRcbiAgICBpZiAoY29kZVBvaW50ID4gMHhEN0ZGICYmIGNvZGVQb2ludCA8IDB4RTAwMCkge1xuICAgICAgLy8gbGFzdCBjaGFyIHdhcyBhIGxlYWRcbiAgICAgIGlmICghbGVhZFN1cnJvZ2F0ZSkge1xuICAgICAgICAvLyBubyBsZWFkIHlldFxuICAgICAgICBpZiAoY29kZVBvaW50ID4gMHhEQkZGKSB7XG4gICAgICAgICAgLy8gdW5leHBlY3RlZCB0cmFpbFxuICAgICAgICAgIGlmICgodW5pdHMgLT0gMykgPiAtMSkgYnl0ZXMucHVzaCgweEVGLCAweEJGLCAweEJEKVxuICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgIH0gZWxzZSBpZiAoaSArIDEgPT09IGxlbmd0aCkge1xuICAgICAgICAgIC8vIHVucGFpcmVkIGxlYWRcbiAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRClcbiAgICAgICAgICBjb250aW51ZVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gdmFsaWQgbGVhZFxuICAgICAgICBsZWFkU3Vycm9nYXRlID0gY29kZVBvaW50XG5cbiAgICAgICAgY29udGludWVcbiAgICAgIH1cblxuICAgICAgLy8gMiBsZWFkcyBpbiBhIHJvd1xuICAgICAgaWYgKGNvZGVQb2ludCA8IDB4REMwMCkge1xuICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRClcbiAgICAgICAgbGVhZFN1cnJvZ2F0ZSA9IGNvZGVQb2ludFxuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuXG4gICAgICAvLyB2YWxpZCBzdXJyb2dhdGUgcGFpclxuICAgICAgY29kZVBvaW50ID0gKGxlYWRTdXJyb2dhdGUgLSAweEQ4MDAgPDwgMTAgfCBjb2RlUG9pbnQgLSAweERDMDApICsgMHgxMDAwMFxuICAgIH0gZWxzZSBpZiAobGVhZFN1cnJvZ2F0ZSkge1xuICAgICAgLy8gdmFsaWQgYm1wIGNoYXIsIGJ1dCBsYXN0IGNoYXIgd2FzIGEgbGVhZFxuICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKSBieXRlcy5wdXNoKDB4RUYsIDB4QkYsIDB4QkQpXG4gICAgfVxuXG4gICAgbGVhZFN1cnJvZ2F0ZSA9IG51bGxcblxuICAgIC8vIGVuY29kZSB1dGY4XG4gICAgaWYgKGNvZGVQb2ludCA8IDB4ODApIHtcbiAgICAgIGlmICgodW5pdHMgLT0gMSkgPCAwKSBicmVha1xuICAgICAgYnl0ZXMucHVzaChjb2RlUG9pbnQpXG4gICAgfSBlbHNlIGlmIChjb2RlUG9pbnQgPCAweDgwMCkge1xuICAgICAgaWYgKCh1bml0cyAtPSAyKSA8IDApIGJyZWFrXG4gICAgICBieXRlcy5wdXNoKFxuICAgICAgICBjb2RlUG9pbnQgPj4gMHg2IHwgMHhDMCxcbiAgICAgICAgY29kZVBvaW50ICYgMHgzRiB8IDB4ODBcbiAgICAgIClcbiAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA8IDB4MTAwMDApIHtcbiAgICAgIGlmICgodW5pdHMgLT0gMykgPCAwKSBicmVha1xuICAgICAgYnl0ZXMucHVzaChcbiAgICAgICAgY29kZVBvaW50ID4+IDB4QyB8IDB4RTAsXG4gICAgICAgIGNvZGVQb2ludCA+PiAweDYgJiAweDNGIHwgMHg4MCxcbiAgICAgICAgY29kZVBvaW50ICYgMHgzRiB8IDB4ODBcbiAgICAgIClcbiAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA8IDB4MTEwMDAwKSB7XG4gICAgICBpZiAoKHVuaXRzIC09IDQpIDwgMCkgYnJlYWtcbiAgICAgIGJ5dGVzLnB1c2goXG4gICAgICAgIGNvZGVQb2ludCA+PiAweDEyIHwgMHhGMCxcbiAgICAgICAgY29kZVBvaW50ID4+IDB4QyAmIDB4M0YgfCAweDgwLFxuICAgICAgICBjb2RlUG9pbnQgPj4gMHg2ICYgMHgzRiB8IDB4ODAsXG4gICAgICAgIGNvZGVQb2ludCAmIDB4M0YgfCAweDgwXG4gICAgICApXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjb2RlIHBvaW50JylcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYnl0ZXNcbn1cblxuZnVuY3Rpb24gYXNjaWlUb0J5dGVzIChzdHIpIHtcbiAgdmFyIGJ5dGVBcnJheSA9IFtdXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7XG4gICAgLy8gTm9kZSdzIGNvZGUgc2VlbXMgdG8gYmUgZG9pbmcgdGhpcyBhbmQgbm90ICYgMHg3Ri4uXG4gICAgYnl0ZUFycmF5LnB1c2goc3RyLmNoYXJDb2RlQXQoaSkgJiAweEZGKVxuICB9XG4gIHJldHVybiBieXRlQXJyYXlcbn1cblxuZnVuY3Rpb24gdXRmMTZsZVRvQnl0ZXMgKHN0ciwgdW5pdHMpIHtcbiAgdmFyIGMsIGhpLCBsb1xuICB2YXIgYnl0ZUFycmF5ID0gW11cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyArK2kpIHtcbiAgICBpZiAoKHVuaXRzIC09IDIpIDwgMCkgYnJlYWtcblxuICAgIGMgPSBzdHIuY2hhckNvZGVBdChpKVxuICAgIGhpID0gYyA+PiA4XG4gICAgbG8gPSBjICUgMjU2XG4gICAgYnl0ZUFycmF5LnB1c2gobG8pXG4gICAgYnl0ZUFycmF5LnB1c2goaGkpXG4gIH1cblxuICByZXR1cm4gYnl0ZUFycmF5XG59XG5cbmZ1bmN0aW9uIGJhc2U2NFRvQnl0ZXMgKHN0cikge1xuICByZXR1cm4gYmFzZTY0LnRvQnl0ZUFycmF5KGJhc2U2NGNsZWFuKHN0cikpXG59XG5cbmZ1bmN0aW9uIGJsaXRCdWZmZXIgKHNyYywgZHN0LCBvZmZzZXQsIGxlbmd0aCkge1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgaWYgKChpICsgb2Zmc2V0ID49IGRzdC5sZW5ndGgpIHx8IChpID49IHNyYy5sZW5ndGgpKSBicmVha1xuICAgIGRzdFtpICsgb2Zmc2V0XSA9IHNyY1tpXVxuICB9XG4gIHJldHVybiBpXG59XG5cbmZ1bmN0aW9uIGlzbmFuICh2YWwpIHtcbiAgcmV0dXJuIHZhbCAhPT0gdmFsIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2VsZi1jb21wYXJlXG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/buffer/index.js\n");

/***/ }),

/***/ "./node_modules/ieee754/index.js":
/*!***************************************!*\
  !*** ./node_modules/ieee754/index.js ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nexports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvaWVlZTc1NC9pbmRleC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9pZWVlNzU0L2luZGV4LmpzPzkxNTIiXSwic291cmNlc0NvbnRlbnQiOlsiLyohIGllZWU3NTQuIEJTRC0zLUNsYXVzZSBMaWNlbnNlLiBGZXJvc3MgQWJvdWtoYWRpamVoIDxodHRwczovL2Zlcm9zcy5vcmcvb3BlbnNvdXJjZT4gKi9cbmV4cG9ydHMucmVhZCA9IGZ1bmN0aW9uIChidWZmZXIsIG9mZnNldCwgaXNMRSwgbUxlbiwgbkJ5dGVzKSB7XG4gIHZhciBlLCBtXG4gIHZhciBlTGVuID0gKG5CeXRlcyAqIDgpIC0gbUxlbiAtIDFcbiAgdmFyIGVNYXggPSAoMSA8PCBlTGVuKSAtIDFcbiAgdmFyIGVCaWFzID0gZU1heCA+PiAxXG4gIHZhciBuQml0cyA9IC03XG4gIHZhciBpID0gaXNMRSA/IChuQnl0ZXMgLSAxKSA6IDBcbiAgdmFyIGQgPSBpc0xFID8gLTEgOiAxXG4gIHZhciBzID0gYnVmZmVyW29mZnNldCArIGldXG5cbiAgaSArPSBkXG5cbiAgZSA9IHMgJiAoKDEgPDwgKC1uQml0cykpIC0gMSlcbiAgcyA+Pj0gKC1uQml0cylcbiAgbkJpdHMgKz0gZUxlblxuICBmb3IgKDsgbkJpdHMgPiAwOyBlID0gKGUgKiAyNTYpICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHt9XG5cbiAgbSA9IGUgJiAoKDEgPDwgKC1uQml0cykpIC0gMSlcbiAgZSA+Pj0gKC1uQml0cylcbiAgbkJpdHMgKz0gbUxlblxuICBmb3IgKDsgbkJpdHMgPiAwOyBtID0gKG0gKiAyNTYpICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHt9XG5cbiAgaWYgKGUgPT09IDApIHtcbiAgICBlID0gMSAtIGVCaWFzXG4gIH0gZWxzZSBpZiAoZSA9PT0gZU1heCkge1xuICAgIHJldHVybiBtID8gTmFOIDogKChzID8gLTEgOiAxKSAqIEluZmluaXR5KVxuICB9IGVsc2Uge1xuICAgIG0gPSBtICsgTWF0aC5wb3coMiwgbUxlbilcbiAgICBlID0gZSAtIGVCaWFzXG4gIH1cbiAgcmV0dXJuIChzID8gLTEgOiAxKSAqIG0gKiBNYXRoLnBvdygyLCBlIC0gbUxlbilcbn1cblxuZXhwb3J0cy53cml0ZSA9IGZ1bmN0aW9uIChidWZmZXIsIHZhbHVlLCBvZmZzZXQsIGlzTEUsIG1MZW4sIG5CeXRlcykge1xuICB2YXIgZSwgbSwgY1xuICB2YXIgZUxlbiA9IChuQnl0ZXMgKiA4KSAtIG1MZW4gLSAxXG4gIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxXG4gIHZhciBlQmlhcyA9IGVNYXggPj4gMVxuICB2YXIgcnQgPSAobUxlbiA9PT0gMjMgPyBNYXRoLnBvdygyLCAtMjQpIC0gTWF0aC5wb3coMiwgLTc3KSA6IDApXG4gIHZhciBpID0gaXNMRSA/IDAgOiAobkJ5dGVzIC0gMSlcbiAgdmFyIGQgPSBpc0xFID8gMSA6IC0xXG4gIHZhciBzID0gdmFsdWUgPCAwIHx8ICh2YWx1ZSA9PT0gMCAmJiAxIC8gdmFsdWUgPCAwKSA/IDEgOiAwXG5cbiAgdmFsdWUgPSBNYXRoLmFicyh2YWx1ZSlcblxuICBpZiAoaXNOYU4odmFsdWUpIHx8IHZhbHVlID09PSBJbmZpbml0eSkge1xuICAgIG0gPSBpc05hTih2YWx1ZSkgPyAxIDogMFxuICAgIGUgPSBlTWF4XG4gIH0gZWxzZSB7XG4gICAgZSA9IE1hdGguZmxvb3IoTWF0aC5sb2codmFsdWUpIC8gTWF0aC5MTjIpXG4gICAgaWYgKHZhbHVlICogKGMgPSBNYXRoLnBvdygyLCAtZSkpIDwgMSkge1xuICAgICAgZS0tXG4gICAgICBjICo9IDJcbiAgICB9XG4gICAgaWYgKGUgKyBlQmlhcyA+PSAxKSB7XG4gICAgICB2YWx1ZSArPSBydCAvIGNcbiAgICB9IGVsc2Uge1xuICAgICAgdmFsdWUgKz0gcnQgKiBNYXRoLnBvdygyLCAxIC0gZUJpYXMpXG4gICAgfVxuICAgIGlmICh2YWx1ZSAqIGMgPj0gMikge1xuICAgICAgZSsrXG4gICAgICBjIC89IDJcbiAgICB9XG5cbiAgICBpZiAoZSArIGVCaWFzID49IGVNYXgpIHtcbiAgICAgIG0gPSAwXG4gICAgICBlID0gZU1heFxuICAgIH0gZWxzZSBpZiAoZSArIGVCaWFzID49IDEpIHtcbiAgICAgIG0gPSAoKHZhbHVlICogYykgLSAxKSAqIE1hdGgucG93KDIsIG1MZW4pXG4gICAgICBlID0gZSArIGVCaWFzXG4gICAgfSBlbHNlIHtcbiAgICAgIG0gPSB2YWx1ZSAqIE1hdGgucG93KDIsIGVCaWFzIC0gMSkgKiBNYXRoLnBvdygyLCBtTGVuKVxuICAgICAgZSA9IDBcbiAgICB9XG4gIH1cblxuICBmb3IgKDsgbUxlbiA+PSA4OyBidWZmZXJbb2Zmc2V0ICsgaV0gPSBtICYgMHhmZiwgaSArPSBkLCBtIC89IDI1NiwgbUxlbiAtPSA4KSB7fVxuXG4gIGUgPSAoZSA8PCBtTGVuKSB8IG1cbiAgZUxlbiArPSBtTGVuXG4gIGZvciAoOyBlTGVuID4gMDsgYnVmZmVyW29mZnNldCArIGldID0gZSAmIDB4ZmYsIGkgKz0gZCwgZSAvPSAyNTYsIGVMZW4gLT0gOCkge31cblxuICBidWZmZXJbb2Zmc2V0ICsgaSAtIGRdIHw9IHMgKiAxMjhcbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/ieee754/index.js\n");

/***/ }),

/***/ "./node_modules/isarray/index.js":
/*!***************************************!*\
  !*** ./node_modules/isarray/index.js ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvaXNhcnJheS9pbmRleC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9pc2FycmF5L2luZGV4LmpzP2UzZGIiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIHRvU3RyaW5nID0ge30udG9TdHJpbmc7XG5cbm1vZHVsZS5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAoYXJyKSB7XG4gIHJldHVybiB0b1N0cmluZy5jYWxsKGFycikgPT0gJ1tvYmplY3QgQXJyYXldJztcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/isarray/index.js\n");

/***/ }),

/***/ "./node_modules/process/browser.js":
/*!*****************************************!*\
  !*** ./node_modules/process/browser.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvcHJvY2Vzcy9icm93c2VyLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcz9mMjhjIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3NlclxudmFyIHByb2Nlc3MgPSBtb2R1bGUuZXhwb3J0cyA9IHt9O1xuXG4vLyBjYWNoZWQgZnJvbSB3aGF0ZXZlciBnbG9iYWwgaXMgcHJlc2VudCBzbyB0aGF0IHRlc3QgcnVubmVycyB0aGF0IHN0dWIgaXRcbi8vIGRvbid0IGJyZWFrIHRoaW5ncy4gIEJ1dCB3ZSBuZWVkIHRvIHdyYXAgaXQgaW4gYSB0cnkgY2F0Y2ggaW4gY2FzZSBpdCBpc1xuLy8gd3JhcHBlZCBpbiBzdHJpY3QgbW9kZSBjb2RlIHdoaWNoIGRvZXNuJ3QgZGVmaW5lIGFueSBnbG9iYWxzLiAgSXQncyBpbnNpZGUgYVxuLy8gZnVuY3Rpb24gYmVjYXVzZSB0cnkvY2F0Y2hlcyBkZW9wdGltaXplIGluIGNlcnRhaW4gZW5naW5lcy5cblxudmFyIGNhY2hlZFNldFRpbWVvdXQ7XG52YXIgY2FjaGVkQ2xlYXJUaW1lb3V0O1xuXG5mdW5jdGlvbiBkZWZhdWx0U2V0VGltb3V0KCkge1xuICAgIHRocm93IG5ldyBFcnJvcignc2V0VGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xufVxuZnVuY3Rpb24gZGVmYXVsdENsZWFyVGltZW91dCAoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKTtcbn1cbihmdW5jdGlvbiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzZXRUaW1lb3V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gc2V0VGltZW91dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0O1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBjbGVhclRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgfVxufSAoKSlcbmZ1bmN0aW9uIHJ1blRpbWVvdXQoZnVuKSB7XG4gICAgaWYgKGNhY2hlZFNldFRpbWVvdXQgPT09IHNldFRpbWVvdXQpIHtcbiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zXG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfVxuICAgIC8vIGlmIHNldFRpbWVvdXQgd2Fzbid0IGF2YWlsYWJsZSBidXQgd2FzIGxhdHRlciBkZWZpbmVkXG4gICAgaWYgKChjYWNoZWRTZXRUaW1lb3V0ID09PSBkZWZhdWx0U2V0VGltb3V0IHx8ICFjYWNoZWRTZXRUaW1lb3V0KSAmJiBzZXRUaW1lb3V0KSB7XG4gICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0O1xuICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICAvLyB3aGVuIHdoZW4gc29tZWJvZHkgaGFzIHNjcmV3ZWQgd2l0aCBzZXRUaW1lb3V0IGJ1dCBubyBJLkUuIG1hZGRuZXNzXG4gICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfSBjYXRjaChlKXtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFdoZW4gd2UgYXJlIGluIEkuRS4gYnV0IHRoZSBzY3JpcHQgaGFzIGJlZW4gZXZhbGVkIHNvIEkuRS4gZG9lc24ndCB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseVxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbChudWxsLCBmdW4sIDApO1xuICAgICAgICB9IGNhdGNoKGUpe1xuICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3JcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwodGhpcywgZnVuLCAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG59XG5mdW5jdGlvbiBydW5DbGVhclRpbWVvdXQobWFya2VyKSB7XG4gICAgaWYgKGNhY2hlZENsZWFyVGltZW91dCA9PT0gY2xlYXJUaW1lb3V0KSB7XG4gICAgICAgIC8vbm9ybWFsIGVudmlyb21lbnRzIGluIHNhbmUgc2l0dWF0aW9uc1xuICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfVxuICAgIC8vIGlmIGNsZWFyVGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWRcbiAgICBpZiAoKGNhY2hlZENsZWFyVGltZW91dCA9PT0gZGVmYXVsdENsZWFyVGltZW91dCB8fCAhY2FjaGVkQ2xlYXJUaW1lb3V0KSAmJiBjbGVhclRpbWVvdXQpIHtcbiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gY2xlYXJUaW1lb3V0O1xuICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3NcbiAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dChtYXJrZXIpO1xuICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0ICB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseVxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dC5jYWxsKG51bGwsIG1hcmtlcik7XG4gICAgICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3IuXG4gICAgICAgICAgICAvLyBTb21lIHZlcnNpb25zIG9mIEkuRS4gaGF2ZSBkaWZmZXJlbnQgcnVsZXMgZm9yIGNsZWFyVGltZW91dCB2cyBzZXRUaW1lb3V0XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwodGhpcywgbWFya2VyKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG5cbn1cbnZhciBxdWV1ZSA9IFtdO1xudmFyIGRyYWluaW5nID0gZmFsc2U7XG52YXIgY3VycmVudFF1ZXVlO1xudmFyIHF1ZXVlSW5kZXggPSAtMTtcblxuZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkge1xuICAgIGlmICghZHJhaW5pbmcgfHwgIWN1cnJlbnRRdWV1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgaWYgKGN1cnJlbnRRdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgfVxuICAgIGlmIChxdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgZHJhaW5RdWV1ZSgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHtcbiAgICBpZiAoZHJhaW5pbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgdGltZW91dCA9IHJ1blRpbWVvdXQoY2xlYW5VcE5leHRUaWNrKTtcbiAgICBkcmFpbmluZyA9IHRydWU7XG5cbiAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIHdoaWxlKGxlbikge1xuICAgICAgICBjdXJyZW50UXVldWUgPSBxdWV1ZTtcbiAgICAgICAgcXVldWUgPSBbXTtcbiAgICAgICAgd2hpbGUgKCsrcXVldWVJbmRleCA8IGxlbikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRRdWV1ZSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgICAgIGxlbiA9IHF1ZXVlLmxlbmd0aDtcbiAgICB9XG4gICAgY3VycmVudFF1ZXVlID0gbnVsbDtcbiAgICBkcmFpbmluZyA9IGZhbHNlO1xuICAgIHJ1bkNsZWFyVGltZW91dCh0aW1lb3V0KTtcbn1cblxucHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpO1xuICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDEgJiYgIWRyYWluaW5nKSB7XG4gICAgICAgIHJ1blRpbWVvdXQoZHJhaW5RdWV1ZSk7XG4gICAgfVxufTtcblxuLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0c1xuZnVuY3Rpb24gSXRlbShmdW4sIGFycmF5KSB7XG4gICAgdGhpcy5mdW4gPSBmdW47XG4gICAgdGhpcy5hcnJheSA9IGFycmF5O1xufVxuSXRlbS5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpO1xufTtcbnByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7XG5wcm9jZXNzLmJyb3dzZXIgPSB0cnVlO1xucHJvY2Vzcy5lbnYgPSB7fTtcbnByb2Nlc3MuYXJndiA9IFtdO1xucHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzXG5wcm9jZXNzLnZlcnNpb25zID0ge307XG5cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG5wcm9jZXNzLm9uID0gbm9vcDtcbnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5vbmNlID0gbm9vcDtcbnByb2Nlc3Mub2ZmID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBub29wO1xucHJvY2Vzcy5lbWl0ID0gbm9vcDtcbnByb2Nlc3MucHJlcGVuZExpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3MucHJlcGVuZE9uY2VMaXN0ZW5lciA9IG5vb3A7XG5cbnByb2Nlc3MubGlzdGVuZXJzID0gZnVuY3Rpb24gKG5hbWUpIHsgcmV0dXJuIFtdIH1cblxucHJvY2Vzcy5iaW5kaW5nID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuXG5wcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICcvJyB9O1xucHJvY2Vzcy5jaGRpciA9IGZ1bmN0aW9uIChkaXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZCcpO1xufTtcbnByb2Nlc3MudW1hc2sgPSBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/process/browser.js\n");

/***/ }),

/***/ "./node_modules/punycode/punycode.js":
/*!*******************************************!*\
  !*** ./node_modules/punycode/punycode.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(module, global) {var __WEBPACK_AMD_DEFINE_RESULT__;/*! https://mths.be/punycode v1.4.1 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports =  true && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule =  true && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.4.1',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttrue\n\t) {\n\t\t!(__WEBPACK_AMD_DEFINE_RESULT__ = (function() {\n\t\t\treturn punycode;\n\t\t}).call(exports, __webpack_require__, exports, module),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t} else {}\n\n}(this));\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../webpack/buildin/module.js */ \"./node_modules/webpack/buildin/module.js\")(module), __webpack_require__(/*! ./../webpack/buildin/global.js */ \"./node_modules/webpack/buildin/global.js\")))//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvcHVueWNvZGUvcHVueWNvZGUuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcHVueWNvZGUvcHVueWNvZGUuanM/OWQ4OCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgaHR0cHM6Ly9tdGhzLmJlL3B1bnljb2RlIHYxLjQuMSBieSBAbWF0aGlhcyAqL1xuOyhmdW5jdGlvbihyb290KSB7XG5cblx0LyoqIERldGVjdCBmcmVlIHZhcmlhYmxlcyAqL1xuXHR2YXIgZnJlZUV4cG9ydHMgPSB0eXBlb2YgZXhwb3J0cyA9PSAnb2JqZWN0JyAmJiBleHBvcnRzICYmXG5cdFx0IWV4cG9ydHMubm9kZVR5cGUgJiYgZXhwb3J0cztcblx0dmFyIGZyZWVNb2R1bGUgPSB0eXBlb2YgbW9kdWxlID09ICdvYmplY3QnICYmIG1vZHVsZSAmJlxuXHRcdCFtb2R1bGUubm9kZVR5cGUgJiYgbW9kdWxlO1xuXHR2YXIgZnJlZUdsb2JhbCA9IHR5cGVvZiBnbG9iYWwgPT0gJ29iamVjdCcgJiYgZ2xvYmFsO1xuXHRpZiAoXG5cdFx0ZnJlZUdsb2JhbC5nbG9iYWwgPT09IGZyZWVHbG9iYWwgfHxcblx0XHRmcmVlR2xvYmFsLndpbmRvdyA9PT0gZnJlZUdsb2JhbCB8fFxuXHRcdGZyZWVHbG9iYWwuc2VsZiA9PT0gZnJlZUdsb2JhbFxuXHQpIHtcblx0XHRyb290ID0gZnJlZUdsb2JhbDtcblx0fVxuXG5cdC8qKlxuXHQgKiBUaGUgYHB1bnljb2RlYCBvYmplY3QuXG5cdCAqIEBuYW1lIHB1bnljb2RlXG5cdCAqIEB0eXBlIE9iamVjdFxuXHQgKi9cblx0dmFyIHB1bnljb2RlLFxuXG5cdC8qKiBIaWdoZXN0IHBvc2l0aXZlIHNpZ25lZCAzMi1iaXQgZmxvYXQgdmFsdWUgKi9cblx0bWF4SW50ID0gMjE0NzQ4MzY0NywgLy8gYWthLiAweDdGRkZGRkZGIG9yIDJeMzEtMVxuXG5cdC8qKiBCb290c3RyaW5nIHBhcmFtZXRlcnMgKi9cblx0YmFzZSA9IDM2LFxuXHR0TWluID0gMSxcblx0dE1heCA9IDI2LFxuXHRza2V3ID0gMzgsXG5cdGRhbXAgPSA3MDAsXG5cdGluaXRpYWxCaWFzID0gNzIsXG5cdGluaXRpYWxOID0gMTI4LCAvLyAweDgwXG5cdGRlbGltaXRlciA9ICctJywgLy8gJ1xceDJEJ1xuXG5cdC8qKiBSZWd1bGFyIGV4cHJlc3Npb25zICovXG5cdHJlZ2V4UHVueWNvZGUgPSAvXnhuLS0vLFxuXHRyZWdleE5vbkFTQ0lJID0gL1teXFx4MjAtXFx4N0VdLywgLy8gdW5wcmludGFibGUgQVNDSUkgY2hhcnMgKyBub24tQVNDSUkgY2hhcnNcblx0cmVnZXhTZXBhcmF0b3JzID0gL1tcXHgyRVxcdTMwMDJcXHVGRjBFXFx1RkY2MV0vZywgLy8gUkZDIDM0OTAgc2VwYXJhdG9yc1xuXG5cdC8qKiBFcnJvciBtZXNzYWdlcyAqL1xuXHRlcnJvcnMgPSB7XG5cdFx0J292ZXJmbG93JzogJ092ZXJmbG93OiBpbnB1dCBuZWVkcyB3aWRlciBpbnRlZ2VycyB0byBwcm9jZXNzJyxcblx0XHQnbm90LWJhc2ljJzogJ0lsbGVnYWwgaW5wdXQgPj0gMHg4MCAobm90IGEgYmFzaWMgY29kZSBwb2ludCknLFxuXHRcdCdpbnZhbGlkLWlucHV0JzogJ0ludmFsaWQgaW5wdXQnXG5cdH0sXG5cblx0LyoqIENvbnZlbmllbmNlIHNob3J0Y3V0cyAqL1xuXHRiYXNlTWludXNUTWluID0gYmFzZSAtIHRNaW4sXG5cdGZsb29yID0gTWF0aC5mbG9vcixcblx0c3RyaW5nRnJvbUNoYXJDb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZSxcblxuXHQvKiogVGVtcG9yYXJ5IHZhcmlhYmxlICovXG5cdGtleTtcblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQvKipcblx0ICogQSBnZW5lcmljIGVycm9yIHV0aWxpdHkgZnVuY3Rpb24uXG5cdCAqIEBwcml2YXRlXG5cdCAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBlcnJvciB0eXBlLlxuXHQgKiBAcmV0dXJucyB7RXJyb3J9IFRocm93cyBhIGBSYW5nZUVycm9yYCB3aXRoIHRoZSBhcHBsaWNhYmxlIGVycm9yIG1lc3NhZ2UuXG5cdCAqL1xuXHRmdW5jdGlvbiBlcnJvcih0eXBlKSB7XG5cdFx0dGhyb3cgbmV3IFJhbmdlRXJyb3IoZXJyb3JzW3R5cGVdKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBBIGdlbmVyaWMgYEFycmF5I21hcGAgdXRpbGl0eSBmdW5jdGlvbi5cblx0ICogQHByaXZhdGVcblx0ICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cblx0ICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRoYXQgZ2V0cyBjYWxsZWQgZm9yIGV2ZXJ5IGFycmF5XG5cdCAqIGl0ZW0uXG5cdCAqIEByZXR1cm5zIHtBcnJheX0gQSBuZXcgYXJyYXkgb2YgdmFsdWVzIHJldHVybmVkIGJ5IHRoZSBjYWxsYmFjayBmdW5jdGlvbi5cblx0ICovXG5cdGZ1bmN0aW9uIG1hcChhcnJheSwgZm4pIHtcblx0XHR2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuXHRcdHZhciByZXN1bHQgPSBbXTtcblx0XHR3aGlsZSAobGVuZ3RoLS0pIHtcblx0XHRcdHJlc3VsdFtsZW5ndGhdID0gZm4oYXJyYXlbbGVuZ3RoXSk7XG5cdFx0fVxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH1cblxuXHQvKipcblx0ICogQSBzaW1wbGUgYEFycmF5I21hcGAtbGlrZSB3cmFwcGVyIHRvIHdvcmsgd2l0aCBkb21haW4gbmFtZSBzdHJpbmdzIG9yIGVtYWlsXG5cdCAqIGFkZHJlc3Nlcy5cblx0ICogQHByaXZhdGVcblx0ICogQHBhcmFtIHtTdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG5hbWUgb3IgZW1haWwgYWRkcmVzcy5cblx0ICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRoYXQgZ2V0cyBjYWxsZWQgZm9yIGV2ZXJ5XG5cdCAqIGNoYXJhY3Rlci5cblx0ICogQHJldHVybnMge0FycmF5fSBBIG5ldyBzdHJpbmcgb2YgY2hhcmFjdGVycyByZXR1cm5lZCBieSB0aGUgY2FsbGJhY2tcblx0ICogZnVuY3Rpb24uXG5cdCAqL1xuXHRmdW5jdGlvbiBtYXBEb21haW4oc3RyaW5nLCBmbikge1xuXHRcdHZhciBwYXJ0cyA9IHN0cmluZy5zcGxpdCgnQCcpO1xuXHRcdHZhciByZXN1bHQgPSAnJztcblx0XHRpZiAocGFydHMubGVuZ3RoID4gMSkge1xuXHRcdFx0Ly8gSW4gZW1haWwgYWRkcmVzc2VzLCBvbmx5IHRoZSBkb21haW4gbmFtZSBzaG91bGQgYmUgcHVueWNvZGVkLiBMZWF2ZVxuXHRcdFx0Ly8gdGhlIGxvY2FsIHBhcnQgKGkuZS4gZXZlcnl0aGluZyB1cCB0byBgQGApIGludGFjdC5cblx0XHRcdHJlc3VsdCA9IHBhcnRzWzBdICsgJ0AnO1xuXHRcdFx0c3RyaW5nID0gcGFydHNbMV07XG5cdFx0fVxuXHRcdC8vIEF2b2lkIGBzcGxpdChyZWdleClgIGZvciBJRTggY29tcGF0aWJpbGl0eS4gU2VlICMxNy5cblx0XHRzdHJpbmcgPSBzdHJpbmcucmVwbGFjZShyZWdleFNlcGFyYXRvcnMsICdcXHgyRScpO1xuXHRcdHZhciBsYWJlbHMgPSBzdHJpbmcuc3BsaXQoJy4nKTtcblx0XHR2YXIgZW5jb2RlZCA9IG1hcChsYWJlbHMsIGZuKS5qb2luKCcuJyk7XG5cdFx0cmV0dXJuIHJlc3VsdCArIGVuY29kZWQ7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhbiBhcnJheSBjb250YWluaW5nIHRoZSBudW1lcmljIGNvZGUgcG9pbnRzIG9mIGVhY2ggVW5pY29kZVxuXHQgKiBjaGFyYWN0ZXIgaW4gdGhlIHN0cmluZy4gV2hpbGUgSmF2YVNjcmlwdCB1c2VzIFVDUy0yIGludGVybmFsbHksXG5cdCAqIHRoaXMgZnVuY3Rpb24gd2lsbCBjb252ZXJ0IGEgcGFpciBvZiBzdXJyb2dhdGUgaGFsdmVzIChlYWNoIG9mIHdoaWNoXG5cdCAqIFVDUy0yIGV4cG9zZXMgYXMgc2VwYXJhdGUgY2hhcmFjdGVycykgaW50byBhIHNpbmdsZSBjb2RlIHBvaW50LFxuXHQgKiBtYXRjaGluZyBVVEYtMTYuXG5cdCAqIEBzZWUgYHB1bnljb2RlLnVjczIuZW5jb2RlYFxuXHQgKiBAc2VlIDxodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvamF2YXNjcmlwdC1lbmNvZGluZz5cblx0ICogQG1lbWJlck9mIHB1bnljb2RlLnVjczJcblx0ICogQG5hbWUgZGVjb2RlXG5cdCAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgVGhlIFVuaWNvZGUgaW5wdXQgc3RyaW5nIChVQ1MtMikuXG5cdCAqIEByZXR1cm5zIHtBcnJheX0gVGhlIG5ldyBhcnJheSBvZiBjb2RlIHBvaW50cy5cblx0ICovXG5cdGZ1bmN0aW9uIHVjczJkZWNvZGUoc3RyaW5nKSB7XG5cdFx0dmFyIG91dHB1dCA9IFtdLFxuXHRcdCAgICBjb3VudGVyID0gMCxcblx0XHQgICAgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aCxcblx0XHQgICAgdmFsdWUsXG5cdFx0ICAgIGV4dHJhO1xuXHRcdHdoaWxlIChjb3VudGVyIDwgbGVuZ3RoKSB7XG5cdFx0XHR2YWx1ZSA9IHN0cmluZy5jaGFyQ29kZUF0KGNvdW50ZXIrKyk7XG5cdFx0XHRpZiAodmFsdWUgPj0gMHhEODAwICYmIHZhbHVlIDw9IDB4REJGRiAmJiBjb3VudGVyIDwgbGVuZ3RoKSB7XG5cdFx0XHRcdC8vIGhpZ2ggc3Vycm9nYXRlLCBhbmQgdGhlcmUgaXMgYSBuZXh0IGNoYXJhY3RlclxuXHRcdFx0XHRleHRyYSA9IHN0cmluZy5jaGFyQ29kZUF0KGNvdW50ZXIrKyk7XG5cdFx0XHRcdGlmICgoZXh0cmEgJiAweEZDMDApID09IDB4REMwMCkgeyAvLyBsb3cgc3Vycm9nYXRlXG5cdFx0XHRcdFx0b3V0cHV0LnB1c2goKCh2YWx1ZSAmIDB4M0ZGKSA8PCAxMCkgKyAoZXh0cmEgJiAweDNGRikgKyAweDEwMDAwKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyB1bm1hdGNoZWQgc3Vycm9nYXRlOyBvbmx5IGFwcGVuZCB0aGlzIGNvZGUgdW5pdCwgaW4gY2FzZSB0aGUgbmV4dFxuXHRcdFx0XHRcdC8vIGNvZGUgdW5pdCBpcyB0aGUgaGlnaCBzdXJyb2dhdGUgb2YgYSBzdXJyb2dhdGUgcGFpclxuXHRcdFx0XHRcdG91dHB1dC5wdXNoKHZhbHVlKTtcblx0XHRcdFx0XHRjb3VudGVyLS07XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG91dHB1dC5wdXNoKHZhbHVlKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgc3RyaW5nIGJhc2VkIG9uIGFuIGFycmF5IG9mIG51bWVyaWMgY29kZSBwb2ludHMuXG5cdCAqIEBzZWUgYHB1bnljb2RlLnVjczIuZGVjb2RlYFxuXHQgKiBAbWVtYmVyT2YgcHVueWNvZGUudWNzMlxuXHQgKiBAbmFtZSBlbmNvZGVcblx0ICogQHBhcmFtIHtBcnJheX0gY29kZVBvaW50cyBUaGUgYXJyYXkgb2YgbnVtZXJpYyBjb2RlIHBvaW50cy5cblx0ICogQHJldHVybnMge1N0cmluZ30gVGhlIG5ldyBVbmljb2RlIHN0cmluZyAoVUNTLTIpLlxuXHQgKi9cblx0ZnVuY3Rpb24gdWNzMmVuY29kZShhcnJheSkge1xuXHRcdHJldHVybiBtYXAoYXJyYXksIGZ1bmN0aW9uKHZhbHVlKSB7XG5cdFx0XHR2YXIgb3V0cHV0ID0gJyc7XG5cdFx0XHRpZiAodmFsdWUgPiAweEZGRkYpIHtcblx0XHRcdFx0dmFsdWUgLT0gMHgxMDAwMDtcblx0XHRcdFx0b3V0cHV0ICs9IHN0cmluZ0Zyb21DaGFyQ29kZSh2YWx1ZSA+Pj4gMTAgJiAweDNGRiB8IDB4RDgwMCk7XG5cdFx0XHRcdHZhbHVlID0gMHhEQzAwIHwgdmFsdWUgJiAweDNGRjtcblx0XHRcdH1cblx0XHRcdG91dHB1dCArPSBzdHJpbmdGcm9tQ2hhckNvZGUodmFsdWUpO1xuXHRcdFx0cmV0dXJuIG91dHB1dDtcblx0XHR9KS5qb2luKCcnKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDb252ZXJ0cyBhIGJhc2ljIGNvZGUgcG9pbnQgaW50byBhIGRpZ2l0L2ludGVnZXIuXG5cdCAqIEBzZWUgYGRpZ2l0VG9CYXNpYygpYFxuXHQgKiBAcHJpdmF0ZVxuXHQgKiBAcGFyYW0ge051bWJlcn0gY29kZVBvaW50IFRoZSBiYXNpYyBudW1lcmljIGNvZGUgcG9pbnQgdmFsdWUuXG5cdCAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBudW1lcmljIHZhbHVlIG9mIGEgYmFzaWMgY29kZSBwb2ludCAoZm9yIHVzZSBpblxuXHQgKiByZXByZXNlbnRpbmcgaW50ZWdlcnMpIGluIHRoZSByYW5nZSBgMGAgdG8gYGJhc2UgLSAxYCwgb3IgYGJhc2VgIGlmXG5cdCAqIHRoZSBjb2RlIHBvaW50IGRvZXMgbm90IHJlcHJlc2VudCBhIHZhbHVlLlxuXHQgKi9cblx0ZnVuY3Rpb24gYmFzaWNUb0RpZ2l0KGNvZGVQb2ludCkge1xuXHRcdGlmIChjb2RlUG9pbnQgLSA0OCA8IDEwKSB7XG5cdFx0XHRyZXR1cm4gY29kZVBvaW50IC0gMjI7XG5cdFx0fVxuXHRcdGlmIChjb2RlUG9pbnQgLSA2NSA8IDI2KSB7XG5cdFx0XHRyZXR1cm4gY29kZVBvaW50IC0gNjU7XG5cdFx0fVxuXHRcdGlmIChjb2RlUG9pbnQgLSA5NyA8IDI2KSB7XG5cdFx0XHRyZXR1cm4gY29kZVBvaW50IC0gOTc7XG5cdFx0fVxuXHRcdHJldHVybiBiYXNlO1xuXHR9XG5cblx0LyoqXG5cdCAqIENvbnZlcnRzIGEgZGlnaXQvaW50ZWdlciBpbnRvIGEgYmFzaWMgY29kZSBwb2ludC5cblx0ICogQHNlZSBgYmFzaWNUb0RpZ2l0KClgXG5cdCAqIEBwcml2YXRlXG5cdCAqIEBwYXJhbSB7TnVtYmVyfSBkaWdpdCBUaGUgbnVtZXJpYyB2YWx1ZSBvZiBhIGJhc2ljIGNvZGUgcG9pbnQuXG5cdCAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBiYXNpYyBjb2RlIHBvaW50IHdob3NlIHZhbHVlICh3aGVuIHVzZWQgZm9yXG5cdCAqIHJlcHJlc2VudGluZyBpbnRlZ2VycykgaXMgYGRpZ2l0YCwgd2hpY2ggbmVlZHMgdG8gYmUgaW4gdGhlIHJhbmdlXG5cdCAqIGAwYCB0byBgYmFzZSAtIDFgLiBJZiBgZmxhZ2AgaXMgbm9uLXplcm8sIHRoZSB1cHBlcmNhc2UgZm9ybSBpc1xuXHQgKiB1c2VkOyBlbHNlLCB0aGUgbG93ZXJjYXNlIGZvcm0gaXMgdXNlZC4gVGhlIGJlaGF2aW9yIGlzIHVuZGVmaW5lZFxuXHQgKiBpZiBgZmxhZ2AgaXMgbm9uLXplcm8gYW5kIGBkaWdpdGAgaGFzIG5vIHVwcGVyY2FzZSBmb3JtLlxuXHQgKi9cblx0ZnVuY3Rpb24gZGlnaXRUb0Jhc2ljKGRpZ2l0LCBmbGFnKSB7XG5cdFx0Ly8gIDAuLjI1IG1hcCB0byBBU0NJSSBhLi56IG9yIEEuLlpcblx0XHQvLyAyNi4uMzUgbWFwIHRvIEFTQ0lJIDAuLjlcblx0XHRyZXR1cm4gZGlnaXQgKyAyMiArIDc1ICogKGRpZ2l0IDwgMjYpIC0gKChmbGFnICE9IDApIDw8IDUpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEJpYXMgYWRhcHRhdGlvbiBmdW5jdGlvbiBhcyBwZXIgc2VjdGlvbiAzLjQgb2YgUkZDIDM0OTIuXG5cdCAqIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzNDkyI3NlY3Rpb24tMy40XG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRmdW5jdGlvbiBhZGFwdChkZWx0YSwgbnVtUG9pbnRzLCBmaXJzdFRpbWUpIHtcblx0XHR2YXIgayA9IDA7XG5cdFx0ZGVsdGEgPSBmaXJzdFRpbWUgPyBmbG9vcihkZWx0YSAvIGRhbXApIDogZGVsdGEgPj4gMTtcblx0XHRkZWx0YSArPSBmbG9vcihkZWx0YSAvIG51bVBvaW50cyk7XG5cdFx0Zm9yICgvKiBubyBpbml0aWFsaXphdGlvbiAqLzsgZGVsdGEgPiBiYXNlTWludXNUTWluICogdE1heCA+PiAxOyBrICs9IGJhc2UpIHtcblx0XHRcdGRlbHRhID0gZmxvb3IoZGVsdGEgLyBiYXNlTWludXNUTWluKTtcblx0XHR9XG5cdFx0cmV0dXJuIGZsb29yKGsgKyAoYmFzZU1pbnVzVE1pbiArIDEpICogZGVsdGEgLyAoZGVsdGEgKyBza2V3KSk7XG5cdH1cblxuXHQvKipcblx0ICogQ29udmVydHMgYSBQdW55Y29kZSBzdHJpbmcgb2YgQVNDSUktb25seSBzeW1ib2xzIHRvIGEgc3RyaW5nIG9mIFVuaWNvZGVcblx0ICogc3ltYm9scy5cblx0ICogQG1lbWJlck9mIHB1bnljb2RlXG5cdCAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgUHVueWNvZGUgc3RyaW5nIG9mIEFTQ0lJLW9ubHkgc3ltYm9scy5cblx0ICogQHJldHVybnMge1N0cmluZ30gVGhlIHJlc3VsdGluZyBzdHJpbmcgb2YgVW5pY29kZSBzeW1ib2xzLlxuXHQgKi9cblx0ZnVuY3Rpb24gZGVjb2RlKGlucHV0KSB7XG5cdFx0Ly8gRG9uJ3QgdXNlIFVDUy0yXG5cdFx0dmFyIG91dHB1dCA9IFtdLFxuXHRcdCAgICBpbnB1dExlbmd0aCA9IGlucHV0Lmxlbmd0aCxcblx0XHQgICAgb3V0LFxuXHRcdCAgICBpID0gMCxcblx0XHQgICAgbiA9IGluaXRpYWxOLFxuXHRcdCAgICBiaWFzID0gaW5pdGlhbEJpYXMsXG5cdFx0ICAgIGJhc2ljLFxuXHRcdCAgICBqLFxuXHRcdCAgICBpbmRleCxcblx0XHQgICAgb2xkaSxcblx0XHQgICAgdyxcblx0XHQgICAgayxcblx0XHQgICAgZGlnaXQsXG5cdFx0ICAgIHQsXG5cdFx0ICAgIC8qKiBDYWNoZWQgY2FsY3VsYXRpb24gcmVzdWx0cyAqL1xuXHRcdCAgICBiYXNlTWludXNUO1xuXG5cdFx0Ly8gSGFuZGxlIHRoZSBiYXNpYyBjb2RlIHBvaW50czogbGV0IGBiYXNpY2AgYmUgdGhlIG51bWJlciBvZiBpbnB1dCBjb2RlXG5cdFx0Ly8gcG9pbnRzIGJlZm9yZSB0aGUgbGFzdCBkZWxpbWl0ZXIsIG9yIGAwYCBpZiB0aGVyZSBpcyBub25lLCB0aGVuIGNvcHlcblx0XHQvLyB0aGUgZmlyc3QgYmFzaWMgY29kZSBwb2ludHMgdG8gdGhlIG91dHB1dC5cblxuXHRcdGJhc2ljID0gaW5wdXQubGFzdEluZGV4T2YoZGVsaW1pdGVyKTtcblx0XHRpZiAoYmFzaWMgPCAwKSB7XG5cdFx0XHRiYXNpYyA9IDA7XG5cdFx0fVxuXG5cdFx0Zm9yIChqID0gMDsgaiA8IGJhc2ljOyArK2opIHtcblx0XHRcdC8vIGlmIGl0J3Mgbm90IGEgYmFzaWMgY29kZSBwb2ludFxuXHRcdFx0aWYgKGlucHV0LmNoYXJDb2RlQXQoaikgPj0gMHg4MCkge1xuXHRcdFx0XHRlcnJvcignbm90LWJhc2ljJyk7XG5cdFx0XHR9XG5cdFx0XHRvdXRwdXQucHVzaChpbnB1dC5jaGFyQ29kZUF0KGopKTtcblx0XHR9XG5cblx0XHQvLyBNYWluIGRlY29kaW5nIGxvb3A6IHN0YXJ0IGp1c3QgYWZ0ZXIgdGhlIGxhc3QgZGVsaW1pdGVyIGlmIGFueSBiYXNpYyBjb2RlXG5cdFx0Ly8gcG9pbnRzIHdlcmUgY29waWVkOyBzdGFydCBhdCB0aGUgYmVnaW5uaW5nIG90aGVyd2lzZS5cblxuXHRcdGZvciAoaW5kZXggPSBiYXNpYyA+IDAgPyBiYXNpYyArIDEgOiAwOyBpbmRleCA8IGlucHV0TGVuZ3RoOyAvKiBubyBmaW5hbCBleHByZXNzaW9uICovKSB7XG5cblx0XHRcdC8vIGBpbmRleGAgaXMgdGhlIGluZGV4IG9mIHRoZSBuZXh0IGNoYXJhY3RlciB0byBiZSBjb25zdW1lZC5cblx0XHRcdC8vIERlY29kZSBhIGdlbmVyYWxpemVkIHZhcmlhYmxlLWxlbmd0aCBpbnRlZ2VyIGludG8gYGRlbHRhYCxcblx0XHRcdC8vIHdoaWNoIGdldHMgYWRkZWQgdG8gYGlgLiBUaGUgb3ZlcmZsb3cgY2hlY2tpbmcgaXMgZWFzaWVyXG5cdFx0XHQvLyBpZiB3ZSBpbmNyZWFzZSBgaWAgYXMgd2UgZ28sIHRoZW4gc3VidHJhY3Qgb2ZmIGl0cyBzdGFydGluZ1xuXHRcdFx0Ly8gdmFsdWUgYXQgdGhlIGVuZCB0byBvYnRhaW4gYGRlbHRhYC5cblx0XHRcdGZvciAob2xkaSA9IGksIHcgPSAxLCBrID0gYmFzZTsgLyogbm8gY29uZGl0aW9uICovOyBrICs9IGJhc2UpIHtcblxuXHRcdFx0XHRpZiAoaW5kZXggPj0gaW5wdXRMZW5ndGgpIHtcblx0XHRcdFx0XHRlcnJvcignaW52YWxpZC1pbnB1dCcpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZGlnaXQgPSBiYXNpY1RvRGlnaXQoaW5wdXQuY2hhckNvZGVBdChpbmRleCsrKSk7XG5cblx0XHRcdFx0aWYgKGRpZ2l0ID49IGJhc2UgfHwgZGlnaXQgPiBmbG9vcigobWF4SW50IC0gaSkgLyB3KSkge1xuXHRcdFx0XHRcdGVycm9yKCdvdmVyZmxvdycpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aSArPSBkaWdpdCAqIHc7XG5cdFx0XHRcdHQgPSBrIDw9IGJpYXMgPyB0TWluIDogKGsgPj0gYmlhcyArIHRNYXggPyB0TWF4IDogayAtIGJpYXMpO1xuXG5cdFx0XHRcdGlmIChkaWdpdCA8IHQpIHtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGJhc2VNaW51c1QgPSBiYXNlIC0gdDtcblx0XHRcdFx0aWYgKHcgPiBmbG9vcihtYXhJbnQgLyBiYXNlTWludXNUKSkge1xuXHRcdFx0XHRcdGVycm9yKCdvdmVyZmxvdycpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dyAqPSBiYXNlTWludXNUO1xuXG5cdFx0XHR9XG5cblx0XHRcdG91dCA9IG91dHB1dC5sZW5ndGggKyAxO1xuXHRcdFx0YmlhcyA9IGFkYXB0KGkgLSBvbGRpLCBvdXQsIG9sZGkgPT0gMCk7XG5cblx0XHRcdC8vIGBpYCB3YXMgc3VwcG9zZWQgdG8gd3JhcCBhcm91bmQgZnJvbSBgb3V0YCB0byBgMGAsXG5cdFx0XHQvLyBpbmNyZW1lbnRpbmcgYG5gIGVhY2ggdGltZSwgc28gd2UnbGwgZml4IHRoYXQgbm93OlxuXHRcdFx0aWYgKGZsb29yKGkgLyBvdXQpID4gbWF4SW50IC0gbikge1xuXHRcdFx0XHRlcnJvcignb3ZlcmZsb3cnKTtcblx0XHRcdH1cblxuXHRcdFx0biArPSBmbG9vcihpIC8gb3V0KTtcblx0XHRcdGkgJT0gb3V0O1xuXG5cdFx0XHQvLyBJbnNlcnQgYG5gIGF0IHBvc2l0aW9uIGBpYCBvZiB0aGUgb3V0cHV0XG5cdFx0XHRvdXRwdXQuc3BsaWNlKGkrKywgMCwgbik7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gdWNzMmVuY29kZShvdXRwdXQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENvbnZlcnRzIGEgc3RyaW5nIG9mIFVuaWNvZGUgc3ltYm9scyAoZS5nLiBhIGRvbWFpbiBuYW1lIGxhYmVsKSB0byBhXG5cdCAqIFB1bnljb2RlIHN0cmluZyBvZiBBU0NJSS1vbmx5IHN5bWJvbHMuXG5cdCAqIEBtZW1iZXJPZiBwdW55Y29kZVxuXHQgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIHN0cmluZyBvZiBVbmljb2RlIHN5bWJvbHMuXG5cdCAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSByZXN1bHRpbmcgUHVueWNvZGUgc3RyaW5nIG9mIEFTQ0lJLW9ubHkgc3ltYm9scy5cblx0ICovXG5cdGZ1bmN0aW9uIGVuY29kZShpbnB1dCkge1xuXHRcdHZhciBuLFxuXHRcdCAgICBkZWx0YSxcblx0XHQgICAgaGFuZGxlZENQQ291bnQsXG5cdFx0ICAgIGJhc2ljTGVuZ3RoLFxuXHRcdCAgICBiaWFzLFxuXHRcdCAgICBqLFxuXHRcdCAgICBtLFxuXHRcdCAgICBxLFxuXHRcdCAgICBrLFxuXHRcdCAgICB0LFxuXHRcdCAgICBjdXJyZW50VmFsdWUsXG5cdFx0ICAgIG91dHB1dCA9IFtdLFxuXHRcdCAgICAvKiogYGlucHV0TGVuZ3RoYCB3aWxsIGhvbGQgdGhlIG51bWJlciBvZiBjb2RlIHBvaW50cyBpbiBgaW5wdXRgLiAqL1xuXHRcdCAgICBpbnB1dExlbmd0aCxcblx0XHQgICAgLyoqIENhY2hlZCBjYWxjdWxhdGlvbiByZXN1bHRzICovXG5cdFx0ICAgIGhhbmRsZWRDUENvdW50UGx1c09uZSxcblx0XHQgICAgYmFzZU1pbnVzVCxcblx0XHQgICAgcU1pbnVzVDtcblxuXHRcdC8vIENvbnZlcnQgdGhlIGlucHV0IGluIFVDUy0yIHRvIFVuaWNvZGVcblx0XHRpbnB1dCA9IHVjczJkZWNvZGUoaW5wdXQpO1xuXG5cdFx0Ly8gQ2FjaGUgdGhlIGxlbmd0aFxuXHRcdGlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoO1xuXG5cdFx0Ly8gSW5pdGlhbGl6ZSB0aGUgc3RhdGVcblx0XHRuID0gaW5pdGlhbE47XG5cdFx0ZGVsdGEgPSAwO1xuXHRcdGJpYXMgPSBpbml0aWFsQmlhcztcblxuXHRcdC8vIEhhbmRsZSB0aGUgYmFzaWMgY29kZSBwb2ludHNcblx0XHRmb3IgKGogPSAwOyBqIDwgaW5wdXRMZW5ndGg7ICsraikge1xuXHRcdFx0Y3VycmVudFZhbHVlID0gaW5wdXRbal07XG5cdFx0XHRpZiAoY3VycmVudFZhbHVlIDwgMHg4MCkge1xuXHRcdFx0XHRvdXRwdXQucHVzaChzdHJpbmdGcm9tQ2hhckNvZGUoY3VycmVudFZhbHVlKSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aGFuZGxlZENQQ291bnQgPSBiYXNpY0xlbmd0aCA9IG91dHB1dC5sZW5ndGg7XG5cblx0XHQvLyBgaGFuZGxlZENQQ291bnRgIGlzIHRoZSBudW1iZXIgb2YgY29kZSBwb2ludHMgdGhhdCBoYXZlIGJlZW4gaGFuZGxlZDtcblx0XHQvLyBgYmFzaWNMZW5ndGhgIGlzIHRoZSBudW1iZXIgb2YgYmFzaWMgY29kZSBwb2ludHMuXG5cblx0XHQvLyBGaW5pc2ggdGhlIGJhc2ljIHN0cmluZyAtIGlmIGl0IGlzIG5vdCBlbXB0eSAtIHdpdGggYSBkZWxpbWl0ZXJcblx0XHRpZiAoYmFzaWNMZW5ndGgpIHtcblx0XHRcdG91dHB1dC5wdXNoKGRlbGltaXRlcik7XG5cdFx0fVxuXG5cdFx0Ly8gTWFpbiBlbmNvZGluZyBsb29wOlxuXHRcdHdoaWxlIChoYW5kbGVkQ1BDb3VudCA8IGlucHV0TGVuZ3RoKSB7XG5cblx0XHRcdC8vIEFsbCBub24tYmFzaWMgY29kZSBwb2ludHMgPCBuIGhhdmUgYmVlbiBoYW5kbGVkIGFscmVhZHkuIEZpbmQgdGhlIG5leHRcblx0XHRcdC8vIGxhcmdlciBvbmU6XG5cdFx0XHRmb3IgKG0gPSBtYXhJbnQsIGogPSAwOyBqIDwgaW5wdXRMZW5ndGg7ICsraikge1xuXHRcdFx0XHRjdXJyZW50VmFsdWUgPSBpbnB1dFtqXTtcblx0XHRcdFx0aWYgKGN1cnJlbnRWYWx1ZSA+PSBuICYmIGN1cnJlbnRWYWx1ZSA8IG0pIHtcblx0XHRcdFx0XHRtID0gY3VycmVudFZhbHVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIEluY3JlYXNlIGBkZWx0YWAgZW5vdWdoIHRvIGFkdmFuY2UgdGhlIGRlY29kZXIncyA8bixpPiBzdGF0ZSB0byA8bSwwPixcblx0XHRcdC8vIGJ1dCBndWFyZCBhZ2FpbnN0IG92ZXJmbG93XG5cdFx0XHRoYW5kbGVkQ1BDb3VudFBsdXNPbmUgPSBoYW5kbGVkQ1BDb3VudCArIDE7XG5cdFx0XHRpZiAobSAtIG4gPiBmbG9vcigobWF4SW50IC0gZGVsdGEpIC8gaGFuZGxlZENQQ291bnRQbHVzT25lKSkge1xuXHRcdFx0XHRlcnJvcignb3ZlcmZsb3cnKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVsdGEgKz0gKG0gLSBuKSAqIGhhbmRsZWRDUENvdW50UGx1c09uZTtcblx0XHRcdG4gPSBtO1xuXG5cdFx0XHRmb3IgKGogPSAwOyBqIDwgaW5wdXRMZW5ndGg7ICsraikge1xuXHRcdFx0XHRjdXJyZW50VmFsdWUgPSBpbnB1dFtqXTtcblxuXHRcdFx0XHRpZiAoY3VycmVudFZhbHVlIDwgbiAmJiArK2RlbHRhID4gbWF4SW50KSB7XG5cdFx0XHRcdFx0ZXJyb3IoJ292ZXJmbG93Jyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoY3VycmVudFZhbHVlID09IG4pIHtcblx0XHRcdFx0XHQvLyBSZXByZXNlbnQgZGVsdGEgYXMgYSBnZW5lcmFsaXplZCB2YXJpYWJsZS1sZW5ndGggaW50ZWdlclxuXHRcdFx0XHRcdGZvciAocSA9IGRlbHRhLCBrID0gYmFzZTsgLyogbm8gY29uZGl0aW9uICovOyBrICs9IGJhc2UpIHtcblx0XHRcdFx0XHRcdHQgPSBrIDw9IGJpYXMgPyB0TWluIDogKGsgPj0gYmlhcyArIHRNYXggPyB0TWF4IDogayAtIGJpYXMpO1xuXHRcdFx0XHRcdFx0aWYgKHEgPCB0KSB7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cU1pbnVzVCA9IHEgLSB0O1xuXHRcdFx0XHRcdFx0YmFzZU1pbnVzVCA9IGJhc2UgLSB0O1xuXHRcdFx0XHRcdFx0b3V0cHV0LnB1c2goXG5cdFx0XHRcdFx0XHRcdHN0cmluZ0Zyb21DaGFyQ29kZShkaWdpdFRvQmFzaWModCArIHFNaW51c1QgJSBiYXNlTWludXNULCAwKSlcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHRxID0gZmxvb3IocU1pbnVzVCAvIGJhc2VNaW51c1QpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdG91dHB1dC5wdXNoKHN0cmluZ0Zyb21DaGFyQ29kZShkaWdpdFRvQmFzaWMocSwgMCkpKTtcblx0XHRcdFx0XHRiaWFzID0gYWRhcHQoZGVsdGEsIGhhbmRsZWRDUENvdW50UGx1c09uZSwgaGFuZGxlZENQQ291bnQgPT0gYmFzaWNMZW5ndGgpO1xuXHRcdFx0XHRcdGRlbHRhID0gMDtcblx0XHRcdFx0XHQrK2hhbmRsZWRDUENvdW50O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdCsrZGVsdGE7XG5cdFx0XHQrK247XG5cblx0XHR9XG5cdFx0cmV0dXJuIG91dHB1dC5qb2luKCcnKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDb252ZXJ0cyBhIFB1bnljb2RlIHN0cmluZyByZXByZXNlbnRpbmcgYSBkb21haW4gbmFtZSBvciBhbiBlbWFpbCBhZGRyZXNzXG5cdCAqIHRvIFVuaWNvZGUuIE9ubHkgdGhlIFB1bnljb2RlZCBwYXJ0cyBvZiB0aGUgaW5wdXQgd2lsbCBiZSBjb252ZXJ0ZWQsIGkuZS5cblx0ICogaXQgZG9lc24ndCBtYXR0ZXIgaWYgeW91IGNhbGwgaXQgb24gYSBzdHJpbmcgdGhhdCBoYXMgYWxyZWFkeSBiZWVuXG5cdCAqIGNvbnZlcnRlZCB0byBVbmljb2RlLlxuXHQgKiBAbWVtYmVyT2YgcHVueWNvZGVcblx0ICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBQdW55Y29kZWQgZG9tYWluIG5hbWUgb3IgZW1haWwgYWRkcmVzcyB0b1xuXHQgKiBjb252ZXJ0IHRvIFVuaWNvZGUuXG5cdCAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBVbmljb2RlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZlbiBQdW55Y29kZVxuXHQgKiBzdHJpbmcuXG5cdCAqL1xuXHRmdW5jdGlvbiB0b1VuaWNvZGUoaW5wdXQpIHtcblx0XHRyZXR1cm4gbWFwRG9tYWluKGlucHV0LCBmdW5jdGlvbihzdHJpbmcpIHtcblx0XHRcdHJldHVybiByZWdleFB1bnljb2RlLnRlc3Qoc3RyaW5nKVxuXHRcdFx0XHQ/IGRlY29kZShzdHJpbmcuc2xpY2UoNCkudG9Mb3dlckNhc2UoKSlcblx0XHRcdFx0OiBzdHJpbmc7XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogQ29udmVydHMgYSBVbmljb2RlIHN0cmluZyByZXByZXNlbnRpbmcgYSBkb21haW4gbmFtZSBvciBhbiBlbWFpbCBhZGRyZXNzIHRvXG5cdCAqIFB1bnljb2RlLiBPbmx5IHRoZSBub24tQVNDSUkgcGFydHMgb2YgdGhlIGRvbWFpbiBuYW1lIHdpbGwgYmUgY29udmVydGVkLFxuXHQgKiBpLmUuIGl0IGRvZXNuJ3QgbWF0dGVyIGlmIHlvdSBjYWxsIGl0IHdpdGggYSBkb21haW4gdGhhdCdzIGFscmVhZHkgaW5cblx0ICogQVNDSUkuXG5cdCAqIEBtZW1iZXJPZiBwdW55Y29kZVxuXHQgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIGRvbWFpbiBuYW1lIG9yIGVtYWlsIGFkZHJlc3MgdG8gY29udmVydCwgYXMgYVxuXHQgKiBVbmljb2RlIHN0cmluZy5cblx0ICogQHJldHVybnMge1N0cmluZ30gVGhlIFB1bnljb2RlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZlbiBkb21haW4gbmFtZSBvclxuXHQgKiBlbWFpbCBhZGRyZXNzLlxuXHQgKi9cblx0ZnVuY3Rpb24gdG9BU0NJSShpbnB1dCkge1xuXHRcdHJldHVybiBtYXBEb21haW4oaW5wdXQsIGZ1bmN0aW9uKHN0cmluZykge1xuXHRcdFx0cmV0dXJuIHJlZ2V4Tm9uQVNDSUkudGVzdChzdHJpbmcpXG5cdFx0XHRcdD8gJ3huLS0nICsgZW5jb2RlKHN0cmluZylcblx0XHRcdFx0OiBzdHJpbmc7XG5cdFx0fSk7XG5cdH1cblxuXHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQvKiogRGVmaW5lIHRoZSBwdWJsaWMgQVBJICovXG5cdHB1bnljb2RlID0ge1xuXHRcdC8qKlxuXHRcdCAqIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBQdW55Y29kZS5qcyB2ZXJzaW9uIG51bWJlci5cblx0XHQgKiBAbWVtYmVyT2YgcHVueWNvZGVcblx0XHQgKiBAdHlwZSBTdHJpbmdcblx0XHQgKi9cblx0XHQndmVyc2lvbic6ICcxLjQuMScsXG5cdFx0LyoqXG5cdFx0ICogQW4gb2JqZWN0IG9mIG1ldGhvZHMgdG8gY29udmVydCBmcm9tIEphdmFTY3JpcHQncyBpbnRlcm5hbCBjaGFyYWN0ZXJcblx0XHQgKiByZXByZXNlbnRhdGlvbiAoVUNTLTIpIHRvIFVuaWNvZGUgY29kZSBwb2ludHMsIGFuZCBiYWNrLlxuXHRcdCAqIEBzZWUgPGh0dHBzOi8vbWF0aGlhc2J5bmVucy5iZS9ub3Rlcy9qYXZhc2NyaXB0LWVuY29kaW5nPlxuXHRcdCAqIEBtZW1iZXJPZiBwdW55Y29kZVxuXHRcdCAqIEB0eXBlIE9iamVjdFxuXHRcdCAqL1xuXHRcdCd1Y3MyJzoge1xuXHRcdFx0J2RlY29kZSc6IHVjczJkZWNvZGUsXG5cdFx0XHQnZW5jb2RlJzogdWNzMmVuY29kZVxuXHRcdH0sXG5cdFx0J2RlY29kZSc6IGRlY29kZSxcblx0XHQnZW5jb2RlJzogZW5jb2RlLFxuXHRcdCd0b0FTQ0lJJzogdG9BU0NJSSxcblx0XHQndG9Vbmljb2RlJzogdG9Vbmljb2RlXG5cdH07XG5cblx0LyoqIEV4cG9zZSBgcHVueWNvZGVgICovXG5cdC8vIFNvbWUgQU1EIGJ1aWxkIG9wdGltaXplcnMsIGxpa2Ugci5qcywgY2hlY2sgZm9yIHNwZWNpZmljIGNvbmRpdGlvbiBwYXR0ZXJuc1xuXHQvLyBsaWtlIHRoZSBmb2xsb3dpbmc6XG5cdGlmIChcblx0XHR0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiZcblx0XHR0eXBlb2YgZGVmaW5lLmFtZCA9PSAnb2JqZWN0JyAmJlxuXHRcdGRlZmluZS5hbWRcblx0KSB7XG5cdFx0ZGVmaW5lKCdwdW55Y29kZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHB1bnljb2RlO1xuXHRcdH0pO1xuXHR9IGVsc2UgaWYgKGZyZWVFeHBvcnRzICYmIGZyZWVNb2R1bGUpIHtcblx0XHRpZiAobW9kdWxlLmV4cG9ydHMgPT0gZnJlZUV4cG9ydHMpIHtcblx0XHRcdC8vIGluIE5vZGUuanMsIGlvLmpzLCBvciBSaW5nb0pTIHYwLjguMCtcblx0XHRcdGZyZWVNb2R1bGUuZXhwb3J0cyA9IHB1bnljb2RlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBpbiBOYXJ3aGFsIG9yIFJpbmdvSlMgdjAuNy4wLVxuXHRcdFx0Zm9yIChrZXkgaW4gcHVueWNvZGUpIHtcblx0XHRcdFx0cHVueWNvZGUuaGFzT3duUHJvcGVydHkoa2V5KSAmJiAoZnJlZUV4cG9ydHNba2V5XSA9IHB1bnljb2RlW2tleV0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQvLyBpbiBSaGlubyBvciBhIHdlYiBicm93c2VyXG5cdFx0cm9vdC5wdW55Y29kZSA9IHB1bnljb2RlO1xuXHR9XG5cbn0odGhpcykpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBLFVBYUE7QUFDQTtBQUNBOztBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/punycode/punycode.js\n");

/***/ }),

/***/ "./node_modules/querystring-es3/decode.js":
/*!************************************************!*\
  !*** ./node_modules/querystring-es3/decode.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvcXVlcnlzdHJpbmctZXMzL2RlY29kZS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9xdWVyeXN0cmluZy1lczMvZGVjb2RlLmpzPzkxZGQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGFcbi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbi8vIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxuLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdFxuLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlXG4vLyBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZFxuLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTlxuLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sXG4vLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Jcbi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEVcbi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbid1c2Ugc3RyaWN0JztcblxuLy8gSWYgb2JqLmhhc093blByb3BlcnR5IGhhcyBiZWVuIG92ZXJyaWRkZW4sIHRoZW4gY2FsbGluZ1xuLy8gb2JqLmhhc093blByb3BlcnR5KHByb3ApIHdpbGwgYnJlYWsuXG4vLyBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9qb3llbnQvbm9kZS9pc3N1ZXMvMTcwN1xuZnVuY3Rpb24gaGFzT3duUHJvcGVydHkob2JqLCBwcm9wKSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihxcywgc2VwLCBlcSwgb3B0aW9ucykge1xuICBzZXAgPSBzZXAgfHwgJyYnO1xuICBlcSA9IGVxIHx8ICc9JztcbiAgdmFyIG9iaiA9IHt9O1xuXG4gIGlmICh0eXBlb2YgcXMgIT09ICdzdHJpbmcnIHx8IHFzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBvYmo7XG4gIH1cblxuICB2YXIgcmVnZXhwID0gL1xcKy9nO1xuICBxcyA9IHFzLnNwbGl0KHNlcCk7XG5cbiAgdmFyIG1heEtleXMgPSAxMDAwO1xuICBpZiAob3B0aW9ucyAmJiB0eXBlb2Ygb3B0aW9ucy5tYXhLZXlzID09PSAnbnVtYmVyJykge1xuICAgIG1heEtleXMgPSBvcHRpb25zLm1heEtleXM7XG4gIH1cblxuICB2YXIgbGVuID0gcXMubGVuZ3RoO1xuICAvLyBtYXhLZXlzIDw9IDAgbWVhbnMgdGhhdCB3ZSBzaG91bGQgbm90IGxpbWl0IGtleXMgY291bnRcbiAgaWYgKG1heEtleXMgPiAwICYmIGxlbiA+IG1heEtleXMpIHtcbiAgICBsZW4gPSBtYXhLZXlzO1xuICB9XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSkge1xuICAgIHZhciB4ID0gcXNbaV0ucmVwbGFjZShyZWdleHAsICclMjAnKSxcbiAgICAgICAgaWR4ID0geC5pbmRleE9mKGVxKSxcbiAgICAgICAga3N0ciwgdnN0ciwgaywgdjtcblxuICAgIGlmIChpZHggPj0gMCkge1xuICAgICAga3N0ciA9IHguc3Vic3RyKDAsIGlkeCk7XG4gICAgICB2c3RyID0geC5zdWJzdHIoaWR4ICsgMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGtzdHIgPSB4O1xuICAgICAgdnN0ciA9ICcnO1xuICAgIH1cblxuICAgIGsgPSBkZWNvZGVVUklDb21wb25lbnQoa3N0cik7XG4gICAgdiA9IGRlY29kZVVSSUNvbXBvbmVudCh2c3RyKTtcblxuICAgIGlmICghaGFzT3duUHJvcGVydHkob2JqLCBrKSkge1xuICAgICAgb2JqW2tdID0gdjtcbiAgICB9IGVsc2UgaWYgKGlzQXJyYXkob2JqW2tdKSkge1xuICAgICAgb2JqW2tdLnB1c2godik7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9ialtrXSA9IFtvYmpba10sIHZdO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvYmo7XG59O1xuXG52YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKHhzKSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoeHMpID09PSAnW29iamVjdCBBcnJheV0nO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/querystring-es3/decode.js\n");

/***/ }),

/***/ "./node_modules/querystring-es3/encode.js":
/*!************************************************!*\
  !*** ./node_modules/querystring-es3/encode.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvcXVlcnlzdHJpbmctZXMzL2VuY29kZS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9xdWVyeXN0cmluZy1lczMvZW5jb2RlLmpzP2UwOTkiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGFcbi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbi8vIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxuLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdFxuLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlXG4vLyBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZFxuLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTlxuLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sXG4vLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Jcbi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEVcbi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbid1c2Ugc3RyaWN0JztcblxudmFyIHN0cmluZ2lmeVByaW1pdGl2ZSA9IGZ1bmN0aW9uKHYpIHtcbiAgc3dpdGNoICh0eXBlb2Ygdikge1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICByZXR1cm4gdjtcblxuICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgcmV0dXJuIHYgPyAndHJ1ZScgOiAnZmFsc2UnO1xuXG4gICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgIHJldHVybiBpc0Zpbml0ZSh2KSA/IHYgOiAnJztcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJyc7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob2JqLCBzZXAsIGVxLCBuYW1lKSB7XG4gIHNlcCA9IHNlcCB8fCAnJic7XG4gIGVxID0gZXEgfHwgJz0nO1xuICBpZiAob2JqID09PSBudWxsKSB7XG4gICAgb2JqID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBvYmogPT09ICdvYmplY3QnKSB7XG4gICAgcmV0dXJuIG1hcChvYmplY3RLZXlzKG9iaiksIGZ1bmN0aW9uKGspIHtcbiAgICAgIHZhciBrcyA9IGVuY29kZVVSSUNvbXBvbmVudChzdHJpbmdpZnlQcmltaXRpdmUoaykpICsgZXE7XG4gICAgICBpZiAoaXNBcnJheShvYmpba10pKSB7XG4gICAgICAgIHJldHVybiBtYXAob2JqW2tdLCBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgcmV0dXJuIGtzICsgZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZ2lmeVByaW1pdGl2ZSh2KSk7XG4gICAgICAgIH0pLmpvaW4oc2VwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBrcyArIGVuY29kZVVSSUNvbXBvbmVudChzdHJpbmdpZnlQcmltaXRpdmUob2JqW2tdKSk7XG4gICAgICB9XG4gICAgfSkuam9pbihzZXApO1xuXG4gIH1cblxuICBpZiAoIW5hbWUpIHJldHVybiAnJztcbiAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChzdHJpbmdpZnlQcmltaXRpdmUobmFtZSkpICsgZXEgK1xuICAgICAgICAgZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZ2lmeVByaW1pdGl2ZShvYmopKTtcbn07XG5cbnZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAoeHMpIHtcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh4cykgPT09ICdbb2JqZWN0IEFycmF5XSc7XG59O1xuXG5mdW5jdGlvbiBtYXAgKHhzLCBmKSB7XG4gIGlmICh4cy5tYXApIHJldHVybiB4cy5tYXAoZik7XG4gIHZhciByZXMgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB4cy5sZW5ndGg7IGkrKykge1xuICAgIHJlcy5wdXNoKGYoeHNbaV0sIGkpKTtcbiAgfVxuICByZXR1cm4gcmVzO1xufVxuXG52YXIgb2JqZWN0S2V5cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIChvYmopIHtcbiAgdmFyIHJlcyA9IFtdO1xuICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHJlcy5wdXNoKGtleSk7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/querystring-es3/encode.js\n");

/***/ }),

/***/ "./node_modules/querystring-es3/index.js":
/*!***********************************************!*\
  !*** ./node_modules/querystring-es3/index.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nexports.decode = exports.parse = __webpack_require__(/*! ./decode */ \"./node_modules/querystring-es3/decode.js\");\nexports.encode = exports.stringify = __webpack_require__(/*! ./encode */ \"./node_modules/querystring-es3/encode.js\");\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvcXVlcnlzdHJpbmctZXMzL2luZGV4LmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3F1ZXJ5c3RyaW5nLWVzMy9pbmRleC5qcz9iMzgzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5kZWNvZGUgPSBleHBvcnRzLnBhcnNlID0gcmVxdWlyZSgnLi9kZWNvZGUnKTtcbmV4cG9ydHMuZW5jb2RlID0gZXhwb3J0cy5zdHJpbmdpZnkgPSByZXF1aXJlKCcuL2VuY29kZScpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/querystring-es3/index.js\n");

/***/ }),

/***/ "./node_modules/svelte/compiler.mjs":
/*!******************************************!*\
  !*** ./node_modules/svelte/compiler.mjs ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(process, Buffer) {var _interopRequireDefault=__webpack_require__(/*! @babel/runtime/helpers/interopRequireDefault */ \"./node_modules/@babel/runtime/helpers/interopRequireDefault.js\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.VERSION=void 0;exports.compile=compile;exports.parse=parse$3;exports.preprocess=preprocess;exports.walk=walk;var _regenerator=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/regenerator */ \"./node_modules/@babel/runtime/regenerator/index.js\"));var _asyncToGenerator2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"./node_modules/@babel/runtime/helpers/asyncToGenerator.js\"));var _get2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/get */ \"./node_modules/@babel/runtime/helpers/get.js\"));var _assertThisInitialized2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/assertThisInitialized */ \"./node_modules/@babel/runtime/helpers/assertThisInitialized.js\"));var _taggedTemplateLiteral2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/taggedTemplateLiteral */ \"./node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js\"));var _wrapNativeSuper2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/wrapNativeSuper */ \"./node_modules/@babel/runtime/helpers/wrapNativeSuper.js\"));var _toArray2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/toArray */ \"./node_modules/@babel/runtime/helpers/toArray.js\"));var _defineProperty2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/defineProperty */ \"./node_modules/@babel/runtime/helpers/defineProperty.js\"));var _toConsumableArray2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/toConsumableArray */ \"./node_modules/@babel/runtime/helpers/toConsumableArray.js\"));var _slicedToArray2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/slicedToArray */ \"./node_modules/@babel/runtime/helpers/slicedToArray.js\"));var _inherits2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/inherits */ \"./node_modules/@babel/runtime/helpers/inherits.js\"));var _possibleConstructorReturn2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/possibleConstructorReturn */ \"./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js\"));var _getPrototypeOf2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/getPrototypeOf */ \"./node_modules/@babel/runtime/helpers/getPrototypeOf.js\"));var _typeof2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/typeof */ \"./node_modules/@babel/runtime/helpers/typeof.js\"));var _classCallCheck2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/classCallCheck */ \"./node_modules/@babel/runtime/helpers/classCallCheck.js\"));var _createClass2=_interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/createClass */ \"./node_modules/@babel/runtime/helpers/createClass.js\"));var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10,_templateObject11,_templateObject12,_templateObject13,_templateObject14,_templateObject15,_templateObject16,_templateObject17,_templateObject18,_templateObject19,_templateObject20,_templateObject21,_templateObject22,_templateObject23,_templateObject24,_templateObject25,_templateObject26,_templateObject27,_templateObject28,_templateObject29,_templateObject30,_templateObject31,_templateObject32,_templateObject33,_templateObject34,_templateObject35,_templateObject36,_templateObject37,_templateObject38,_templateObject39,_templateObject40,_templateObject41,_templateObject42,_templateObject43,_templateObject44,_templateObject45,_templateObject46,_templateObject47,_templateObject48,_templateObject49,_templateObject50,_templateObject51,_templateObject52,_templateObject53,_templateObject54,_templateObject55,_templateObject56,_templateObject57,_templateObject58,_templateObject59,_templateObject60,_templateObject61,_templateObject62,_templateObject63,_templateObject64,_templateObject65,_templateObject66,_templateObject67,_templateObject68,_templateObject69,_templateObject70,_templateObject71,_templateObject72,_templateObject73,_templateObject74,_templateObject75,_templateObject76,_templateObject77,_templateObject78,_templateObject79,_templateObject80,_templateObject81,_templateObject82,_templateObject83,_templateObject84,_templateObject85,_templateObject86,_templateObject87,_templateObject88,_templateObject89,_templateObject90,_templateObject91,_templateObject92,_templateObject93,_templateObject94,_templateObject95,_templateObject96,_templateObject97,_templateObject98,_templateObject99,_templateObject100,_templateObject101,_templateObject102,_templateObject103,_templateObject104,_templateObject105,_templateObject106,_templateObject107,_templateObject108,_templateObject109,_templateObject110,_templateObject111,_templateObject112,_templateObject113,_templateObject114,_templateObject115,_templateObject116,_templateObject117,_templateObject118,_templateObject119,_templateObject120,_templateObject121,_templateObject122,_templateObject123,_templateObject124,_templateObject125,_templateObject126,_templateObject127,_templateObject128,_templateObject129,_templateObject130,_templateObject131,_templateObject132,_templateObject133,_templateObject134,_templateObject135,_templateObject136,_templateObject137,_templateObject138,_templateObject139,_templateObject140,_templateObject141,_templateObject142,_templateObject143,_templateObject144,_templateObject145,_templateObject146,_templateObject147,_templateObject148,_templateObject149,_templateObject150,_templateObject151,_templateObject152,_templateObject153,_templateObject154,_templateObject155,_templateObject156,_templateObject157,_templateObject158,_templateObject159,_templateObject160,_templateObject161,_templateObject162,_templateObject163,_templateObject164,_templateObject165,_templateObject166,_templateObject167,_templateObject168,_templateObject169,_templateObject170,_templateObject171,_templateObject172,_templateObject173,_templateObject174,_templateObject175,_templateObject176,_templateObject177,_templateObject178,_templateObject179,_templateObject180,_templateObject181,_templateObject182,_templateObject183,_templateObject184,_templateObject185,_templateObject186,_templateObject187,_templateObject188,_templateObject189,_templateObject190,_templateObject191,_templateObject192,_templateObject193,_templateObject194,_templateObject195,_templateObject196,_templateObject197,_templateObject198,_templateObject199,_templateObject200,_templateObject201,_templateObject202,_templateObject203,_templateObject204,_templateObject205,_templateObject206,_templateObject207,_templateObject208,_templateObject209,_templateObject210,_templateObject211,_templateObject212,_templateObject213,_templateObject214,_templateObject215,_templateObject216,_templateObject217,_templateObject218,_templateObject219,_templateObject220,_templateObject221,_templateObject222,_templateObject223,_templateObject224,_templateObject225,_templateObject226,_templateObject227,_templateObject228,_templateObject229,_templateObject230,_templateObject231,_templateObject232,_templateObject233,_templateObject234,_templateObject235,_templateObject236,_templateObject237,_templateObject238,_templateObject239,_templateObject240,_templateObject241,_templateObject242,_templateObject243,_templateObject244,_templateObject245,_templateObject246,_templateObject247,_templateObject248,_templateObject249,_templateObject250,_templateObject251,_templateObject252,_templateObject253,_templateObject254,_templateObject255,_templateObject256,_templateObject257,_templateObject258,_templateObject259,_templateObject260,_templateObject261,_templateObject262,_templateObject263,_templateObject264,_templateObject265,_templateObject266,_templateObject267,_templateObject268,_templateObject269,_templateObject270,_templateObject271,_templateObject272,_templateObject273,_templateObject274,_templateObject275,_templateObject276,_templateObject277,_templateObject278,_templateObject279,_templateObject280,_templateObject281,_templateObject282,_templateObject283,_templateObject284,_templateObject285,_templateObject286,_templateObject287,_templateObject288,_templateObject289,_templateObject290,_templateObject291,_templateObject292,_templateObject293,_templateObject294,_templateObject295,_templateObject296,_templateObject297,_templateObject298,_templateObject299,_templateObject300,_templateObject301,_templateObject302,_templateObject303,_templateObject304,_templateObject305,_templateObject306,_templateObject307,_templateObject308,_templateObject309,_templateObject310,_templateObject311,_templateObject312,_templateObject313,_templateObject314,_templateObject315,_templateObject316,_templateObject317,_templateObject318,_templateObject319,_templateObject320,_templateObject321,_templateObject322,_templateObject323,_templateObject324,_templateObject325,_templateObject326,_templateObject327,_templateObject328,_templateObject329,_templateObject330,_templateObject331,_templateObject332,_templateObject333,_templateObject334,_templateObject335,_templateObject336,_templateObject337,_templateObject338,_templateObject339,_templateObject340,_templateObject341,_templateObject342,_templateObject343,_templateObject344,_templateObject345,_templateObject346,_templateObject347,_templateObject348,_templateObject349,_templateObject350,_templateObject351,_templateObject352,_templateObject353,_templateObject354,_templateObject355,_templateObject356,_templateObject357,_templateObject358,_templateObject359,_templateObject360,_templateObject361,_templateObject362,_templateObject363,_templateObject364,_templateObject365,_templateObject366,_templateObject367,_templateObject368,_templateObject369,_templateObject370,_templateObject371,_templateObject372,_templateObject373,_templateObject374,_templateObject375,_templateObject376,_templateObject377,_templateObject378,_templateObject379,_templateObject380,_templateObject381,_templateObject382,_templateObject383,_templateObject384,_templateObject385,_templateObject386,_templateObject387,_templateObject388,_templateObject389,_templateObject390,_templateObject391,_templateObject392,_templateObject393,_templateObject394,_templateObject395,_templateObject396,_templateObject397,_templateObject398,_templateObject399,_templateObject400,_templateObject401,_templateObject402,_templateObject403,_templateObject404,_templateObject405,_templateObject406,_templateObject407,_templateObject408,_templateObject409,_templateObject410,_templateObject411,_templateObject412,_templateObject413,_templateObject414,_templateObject415,_templateObject416,_templateObject417,_templateObject418,_templateObject419,_templateObject420,_templateObject421,_templateObject422,_templateObject423,_templateObject424,_templateObject425,_templateObject426,_templateObject427,_templateObject428,_templateObject429,_templateObject430,_templateObject431,_templateObject432,_templateObject433,_templateObject434,_templateObject435,_templateObject436,_templateObject437,_templateObject438,_templateObject439,_templateObject440,_templateObject441,_templateObject442,_templateObject443,_templateObject444,_templateObject445,_templateObject446,_templateObject447,_templateObject448,_templateObject449,_templateObject450,_templateObject451,_templateObject452,_templateObject453,_templateObject454,_templateObject455,_templateObject456,_templateObject457,_templateObject458,_templateObject459,_templateObject460,_templateObject461,_templateObject462,_templateObject463,_templateObject464,_templateObject465,_templateObject466,_templateObject467,_templateObject468,_templateObject469,_templateObject470,_templateObject471,_templateObject472,_templateObject473,_templateObject474,_templateObject475,_templateObject476,_templateObject477,_templateObject478,_templateObject479,_templateObject480,_templateObject481,_templateObject482,_templateObject483,_templateObject484,_templateObject485,_templateObject486,_templateObject487,_templateObject488,_templateObject489,_templateObject490,_templateObject491,_templateObject492,_templateObject493,_templateObject494,_templateObject495,_templateObject496,_templateObject497,_templateObject498,_templateObject499,_templateObject500,_templateObject501,_templateObject502,_templateObject503,_templateObject504,_templateObject505,_templateObject506,_templateObject507,_templateObject508,_templateObject509,_templateObject510,_templateObject511,_templateObject512,_templateObject513,_templateObject514,_templateObject515,_templateObject516,_templateObject517,_templateObject518,_templateObject519,_templateObject520,_templateObject521,_templateObject522,_templateObject523,_templateObject524,_templateObject525,_templateObject526,_templateObject527,_templateObject528,_templateObject529,_templateObject530,_templateObject531,_templateObject532,_templateObject533,_templateObject534,_templateObject535,_templateObject536,_templateObject537,_templateObject538,_templateObject539,_templateObject540,_templateObject541,_templateObject542,_templateObject543,_templateObject544,_templateObject545,_templateObject546,_templateObject547,_templateObject548,_templateObject549,_templateObject550,_templateObject551,_templateObject552,_templateObject553,_templateObject554,_templateObject555,_templateObject556,_templateObject557,_templateObject558,_templateObject559,_templateObject560,_templateObject561,_templateObject562,_templateObject563,_templateObject564,_templateObject565,_templateObject566,_templateObject567,_templateObject568,_templateObject569,_templateObject570,_templateObject571,_templateObject572,_templateObject573,_templateObject574,_templateObject575,_templateObject576,_templateObject577,_templateObject578,_templateObject579,_templateObject580,_templateObject581,_templateObject582,_templateObject583,_templateObject584,_templateObject585,_templateObject586,_templateObject587,_templateObject588,_templateObject589,_templateObject590,_templateObject591,_templateObject592,_templateObject593,_templateObject594,_templateObject595,_templateObject596,_templateObject597,_templateObject598,_templateObject599,_templateObject600,_templateObject601,_templateObject602,_templateObject603,_templateObject604,_templateObject605,_templateObject606,_templateObject607,_templateObject608,_templateObject609,_templateObject610,_templateObject611,_templateObject612,_templateObject613,_templateObject614,_templateObject615,_templateObject616,_templateObject617,_templateObject618,_templateObject619,_templateObject620,_templateObject621,_templateObject622,_templateObject623,_templateObject624,_templateObject625,_templateObject626,_templateObject627,_templateObject628,_templateObject629,_templateObject630,_templateObject631,_templateObject632,_templateObject633,_templateObject634,_templateObject635,_templateObject636,_templateObject637,_templateObject638,_templateObject639,_templateObject640,_templateObject641,_templateObject642,_templateObject643,_templateObject644,_templateObject645,_templateObject646,_templateObject647,_templateObject648,_templateObject649,_templateObject650,_templateObject651,_templateObject652,_templateObject653,_templateObject654,_templateObject655,_templateObject656,_templateObject657,_templateObject658,_templateObject659,_templateObject660,_templateObject661,_templateObject662,_templateObject663,_templateObject664,_templateObject665,_templateObject666,_templateObject667,_templateObject668,_templateObject669,_templateObject670,_templateObject671,_templateObject672,_templateObject673,_templateObject674,_templateObject675,_templateObject676,_templateObject677,_templateObject678,_templateObject679,_templateObject680,_templateObject681,_templateObject682,_templateObject683,_templateObject684,_templateObject685,_templateObject686,_templateObject687,_templateObject688,_templateObject689,_templateObject690,_templateObject691,_templateObject692,_templateObject693,_templateObject694,_templateObject695,_templateObject696,_templateObject697,_templateObject698,_templateObject699,_templateObject700,_templateObject701,_templateObject702,_templateObject703,_templateObject704,_templateObject705,_templateObject706,_templateObject707,_templateObject708,_templateObject709,_templateObject710,_templateObject711,_templateObject712,_templateObject713,_templateObject714,_templateObject715,_templateObject716,_templateObject717,_templateObject718,_templateObject719,_templateObject720,_templateObject721,_templateObject722,_templateObject723,_templateObject724,_templateObject725,_templateObject726,_templateObject727,_templateObject728,_templateObject729,_templateObject730,_templateObject731,_templateObject732,_templateObject733,_templateObject734,_templateObject735,_templateObject736,_templateObject737,_templateObject738,_templateObject739,_templateObject740,_templateObject741,_templateObject742,_templateObject743,_templateObject744,_templateObject745,_templateObject746,_templateObject747,_templateObject748,_templateObject749,_templateObject750,_templateObject751,_templateObject752,_templateObject753,_templateObject754,_templateObject755,_templateObject756,_templateObject757,_templateObject758,_templateObject759,_templateObject760,_templateObject761,_templateObject762,_templateObject763,_templateObject764,_templateObject765,_templateObject766,_templateObject767,_templateObject768,_templateObject769,_templateObject770,_templateObject771,_templateObject772,_templateObject773,_templateObject774,_templateObject775,_templateObject776,_templateObject777,_templateObject778,_templateObject779,_templateObject780,_templateObject781,_templateObject782,_templateObject783,_templateObject784,_templateObject785,_templateObject786,_templateObject787,_templateObject788,_templateObject789,_templateObject790,_templateObject791,_templateObject792,_templateObject793,_templateObject794,_templateObject795,_templateObject796,_templateObject797,_templateObject798;function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!==\"undefined\"&&o[Symbol.iterator]||o[\"@@iterator\"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var now=typeof process!=='undefined'&&process.hrtime?function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6;}:function(){return self.performance.now();};function collapse_timings(timings){var result={};timings.forEach(function(timing){result[timing.label]=Object.assign({total:timing.end-timing.start},timing.children&&collapse_timings(timing.children));});return result;}var Stats=/*#__PURE__*/function(){function Stats(){(0,_classCallCheck2.default)(this,Stats);this.start_time=now();this.stack=[];this.current_children=this.timings=[];}(0,_createClass2.default)(Stats,[{key:\"start\",value:function start(label){var timing={label:label,start:now(),end:null,children:[]};this.current_children.push(timing);this.stack.push(timing);this.current_timing=timing;this.current_children=timing.children;}},{key:\"stop\",value:function stop(label){if(label!==this.current_timing.label){throw new Error(\"Mismatched timing labels (expected \".concat(this.current_timing.label,\", got \").concat(label,\")\"));}this.current_timing.end=now();this.stack.pop();this.current_timing=this.stack[this.stack.length-1];this.current_children=this.current_timing?this.current_timing.children:this.timings;}},{key:\"render\",value:function render(){var timings=Object.assign({total:now()-this.start_time},collapse_timings(this.timings));return{timings:timings};}}]);return Stats;}();// Reserved word lists for various dialects of the language\nvar reservedWords={3:\"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile\",5:\"class enum extends super const export import\",6:\"enum\",strict:\"implements interface let package private protected public static yield\",strictBind:\"eval arguments\"};// And the keywords\nvar ecma5AndLessKeywords=\"break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this\";var keywords={5:ecma5AndLessKeywords,\"5module\":ecma5AndLessKeywords+\" export import\",6:ecma5AndLessKeywords+\" const class extends export import super\"};var keywordRelationalOperator=/^in(stanceof)?$/;// ## Character categories\n// Big ugly regular expressions that match characters in the\n// whitespace, identifier, and identifier-start categories. These\n// are only applied when a character is found to actually have a\n// code point above 128.\n// Generated by `bin/generate-identifier-regex.js`.\nvar nonASCIIidentifierStartChars=\"\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0560-\\u0588\\u05D0-\\u05EA\\u05EF-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u0860-\\u086A\\u08A0-\\u08B4\\u08B6-\\u08C7\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u09FC\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C60\\u0C61\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D04-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D5F-\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E86-\\u0E8A\\u0E8C-\\u0EA3\\u0EA5\\u0EA7-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1878\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1C80-\\u1C88\\u1C90-\\u1CBA\\u1CBD-\\u1CBF\\u1CE9-\\u1CEC\\u1CEE-\\u1CF3\\u1CF5\\u1CF6\\u1CFA\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2118-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309B-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312F\\u3131-\\u318E\\u31A0-\\u31BF\\u31F0-\\u31FF\\u3400-\\u4DBF\\u4E00-\\u9FFC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7BF\\uA7C2-\\uA7CA\\uA7F5-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA8FE\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB69\\uAB70-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC\";var nonASCIIidentifierChars=\"\\u200C\\u200D\\xB7\\u0300-\\u036F\\u0387\\u0483-\\u0487\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u0610-\\u061A\\u064B-\\u0669\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7\\u06E8\\u06EA-\\u06ED\\u06F0-\\u06F9\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\\u07C0-\\u07C9\\u07EB-\\u07F3\\u07FD\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0859-\\u085B\\u08D3-\\u08E1\\u08E3-\\u0903\\u093A-\\u093C\\u093E-\\u094F\\u0951-\\u0957\\u0962\\u0963\\u0966-\\u096F\\u0981-\\u0983\\u09BC\\u09BE-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CD\\u09D7\\u09E2\\u09E3\\u09E6-\\u09EF\\u09FE\\u0A01-\\u0A03\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A66-\\u0A71\\u0A75\\u0A81-\\u0A83\\u0ABC\\u0ABE-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AE2\\u0AE3\\u0AE6-\\u0AEF\\u0AFA-\\u0AFF\\u0B01-\\u0B03\\u0B3C\\u0B3E-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B55-\\u0B57\\u0B62\\u0B63\\u0B66-\\u0B6F\\u0B82\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C04\\u0C3E-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C62\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0CBC\\u0CBE-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CE2\\u0CE3\\u0CE6-\\u0CEF\\u0D00-\\u0D03\\u0D3B\\u0D3C\\u0D3E-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4D\\u0D57\\u0D62\\u0D63\\u0D66-\\u0D6F\\u0D81-\\u0D83\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E\\u0E50-\\u0E59\\u0EB1\\u0EB4-\\u0EBC\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E\\u0F3F\\u0F71-\\u0F84\\u0F86\\u0F87\\u0F8D-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u102B-\\u103E\\u1040-\\u1049\\u1056-\\u1059\\u105E-\\u1060\\u1062-\\u1064\\u1067-\\u106D\\u1071-\\u1074\\u1082-\\u108D\\u108F-\\u109D\\u135D-\\u135F\\u1369-\\u1371\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17B4-\\u17D3\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u18A9\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u194F\\u19D0-\\u19DA\\u1A17-\\u1A1B\\u1A55-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AB0-\\u1ABD\\u1ABF\\u1AC0\\u1B00-\\u1B04\\u1B34-\\u1B44\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1B82\\u1BA1-\\u1BAD\\u1BB0-\\u1BB9\\u1BE6-\\u1BF3\\u1C24-\\u1C37\\u1C40-\\u1C49\\u1C50-\\u1C59\\u1CD0-\\u1CD2\\u1CD4-\\u1CE8\\u1CED\\u1CF4\\u1CF7-\\u1CF9\\u1DC0-\\u1DF9\\u1DFB-\\u1DFF\\u203F\\u2040\\u2054\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2CEF-\\u2CF1\\u2D7F\\u2DE0-\\u2DFF\\u302A-\\u302F\\u3099\\u309A\\uA620-\\uA629\\uA66F\\uA674-\\uA67D\\uA69E\\uA69F\\uA6F0\\uA6F1\\uA802\\uA806\\uA80B\\uA823-\\uA827\\uA82C\\uA880\\uA881\\uA8B4-\\uA8C5\\uA8D0-\\uA8D9\\uA8E0-\\uA8F1\\uA8FF-\\uA909\\uA926-\\uA92D\\uA947-\\uA953\\uA980-\\uA983\\uA9B3-\\uA9C0\\uA9D0-\\uA9D9\\uA9E5\\uA9F0-\\uA9F9\\uAA29-\\uAA36\\uAA43\\uAA4C\\uAA4D\\uAA50-\\uAA59\\uAA7B-\\uAA7D\\uAAB0\\uAAB2-\\uAAB4\\uAAB7\\uAAB8\\uAABE\\uAABF\\uAAC1\\uAAEB-\\uAAEF\\uAAF5\\uAAF6\\uABE3-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFF10-\\uFF19\\uFF3F\";var nonASCIIidentifierStart=new RegExp(\"[\"+nonASCIIidentifierStartChars+\"]\");var nonASCIIidentifier=new RegExp(\"[\"+nonASCIIidentifierStartChars+nonASCIIidentifierChars+\"]\");nonASCIIidentifierStartChars=nonASCIIidentifierChars=null;// These are a run-length and offset encoded representation of the\n// >0xffff code points that are a valid part of identifiers. The\n// offset starts at 0x10000, and each pair of numbers represents an\n// offset to the next range, and then a size of the range. They were\n// generated by bin/generate-identifier-regex.js\n// eslint-disable-next-line comma-spacing\nvar astralIdentifierStartCodes=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938];// eslint-disable-next-line comma-spacing\nvar astralIdentifierCodes=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];// This has a complexity linear to the value of the code. The\n// assumption is that looking up astral identifier characters is\n// rare.\nfunction isInAstralSet(code,set){var pos=0x10000;for(var i=0;i<set.length;i+=2){pos+=set[i];if(pos>code){return false;}pos+=set[i+1];if(pos>=code){return true;}}}// Test whether a given character code starts an identifier.\nfunction isIdentifierStart(code,astral){if(code<65){return code===36;}if(code<91){return true;}if(code<97){return code===95;}if(code<123){return true;}if(code<=0xffff){return code>=0xaa&&nonASCIIidentifierStart.test(String.fromCharCode(code));}if(astral===false){return false;}return isInAstralSet(code,astralIdentifierStartCodes);}// Test whether a given character is part of an identifier.\nfunction isIdentifierChar(code,astral){if(code<48){return code===36;}if(code<58){return true;}if(code<65){return false;}if(code<91){return true;}if(code<97){return code===95;}if(code<123){return true;}if(code<=0xffff){return code>=0xaa&&nonASCIIidentifier.test(String.fromCharCode(code));}if(astral===false){return false;}return isInAstralSet(code,astralIdentifierStartCodes)||isInAstralSet(code,astralIdentifierCodes);}// ## Token types\n// The assignment of fine-grained, information-carrying type objects\n// allows the tokenizer to store the information it has about a\n// token in a way that is very cheap for the parser to look up.\n// All token type variables start with an underscore, to make them\n// easy to recognize.\n// The `beforeExpr` property is used to disambiguate between regular\n// expressions and divisions. It is set on all token types that can\n// be followed by an expression (thus, a slash after them would be a\n// regular expression).\n//\n// The `startsExpr` property is used to check if the token ends a\n// `yield` expression. It is set on all token types that either can\n// directly start an expression (like a quotation mark) or can\n// continue an expression (like the body of a string).\n//\n// `isLoop` marks a keyword as starting a loop, which is important\n// to know when parsing a label, in order to allow or disallow\n// continue jumps to that label.\nvar TokenType=function TokenType(label,conf){if(conf===void 0)conf={};this.label=label;this.keyword=conf.keyword;this.beforeExpr=!!conf.beforeExpr;this.startsExpr=!!conf.startsExpr;this.isLoop=!!conf.isLoop;this.isAssign=!!conf.isAssign;this.prefix=!!conf.prefix;this.postfix=!!conf.postfix;this.binop=conf.binop||null;this.updateContext=null;};function binop(name,prec){return new TokenType(name,{beforeExpr:true,binop:prec});}var beforeExpr={beforeExpr:true},startsExpr={startsExpr:true};// Map keyword names to token types.\nvar keywords$1={};// Succinct definitions of keyword token types\nfunction kw(name,options){if(options===void 0)options={};options.keyword=name;return keywords$1[name]=new TokenType(name,options);}var types={num:new TokenType(\"num\",startsExpr),regexp:new TokenType(\"regexp\",startsExpr),string:new TokenType(\"string\",startsExpr),name:new TokenType(\"name\",startsExpr),privateId:new TokenType(\"privateId\",startsExpr),eof:new TokenType(\"eof\"),// Punctuation token types.\nbracketL:new TokenType(\"[\",{beforeExpr:true,startsExpr:true}),bracketR:new TokenType(\"]\"),braceL:new TokenType(\"{\",{beforeExpr:true,startsExpr:true}),braceR:new TokenType(\"}\"),parenL:new TokenType(\"(\",{beforeExpr:true,startsExpr:true}),parenR:new TokenType(\")\"),comma:new TokenType(\",\",beforeExpr),semi:new TokenType(\";\",beforeExpr),colon:new TokenType(\":\",beforeExpr),dot:new TokenType(\".\"),question:new TokenType(\"?\",beforeExpr),questionDot:new TokenType(\"?.\"),arrow:new TokenType(\"=>\",beforeExpr),template:new TokenType(\"template\"),invalidTemplate:new TokenType(\"invalidTemplate\"),ellipsis:new TokenType(\"...\",beforeExpr),backQuote:new TokenType(\"`\",startsExpr),dollarBraceL:new TokenType(\"${\",{beforeExpr:true,startsExpr:true}),// Operators. These carry several kinds of properties to help the\n// parser use them properly (the presence of these properties is\n// what categorizes them as operators).\n//\n// `binop`, when present, specifies that this operator is a binary\n// operator, and will refer to its precedence.\n//\n// `prefix` and `postfix` mark the operator as a prefix or postfix\n// unary operator.\n//\n// `isAssign` marks all of `=`, `+=`, `-=` etcetera, which act as\n// binary operators with a very low precedence, that should result\n// in AssignmentExpression nodes.\neq:new TokenType(\"=\",{beforeExpr:true,isAssign:true}),assign:new TokenType(\"_=\",{beforeExpr:true,isAssign:true}),incDec:new TokenType(\"++/--\",{prefix:true,postfix:true,startsExpr:true}),prefix:new TokenType(\"!/~\",{beforeExpr:true,prefix:true,startsExpr:true}),logicalOR:binop(\"||\",1),logicalAND:binop(\"&&\",2),bitwiseOR:binop(\"|\",3),bitwiseXOR:binop(\"^\",4),bitwiseAND:binop(\"&\",5),equality:binop(\"==/!=/===/!==\",6),relational:binop(\"</>/<=/>=\",7),bitShift:binop(\"<</>>/>>>\",8),plusMin:new TokenType(\"+/-\",{beforeExpr:true,binop:9,prefix:true,startsExpr:true}),modulo:binop(\"%\",10),star:binop(\"*\",10),slash:binop(\"/\",10),starstar:new TokenType(\"**\",{beforeExpr:true}),coalesce:binop(\"??\",1),// Keyword token types.\n_break:kw(\"break\"),_case:kw(\"case\",beforeExpr),_catch:kw(\"catch\"),_continue:kw(\"continue\"),_debugger:kw(\"debugger\"),_default:kw(\"default\",beforeExpr),_do:kw(\"do\",{isLoop:true,beforeExpr:true}),_else:kw(\"else\",beforeExpr),_finally:kw(\"finally\"),_for:kw(\"for\",{isLoop:true}),_function:kw(\"function\",startsExpr),_if:kw(\"if\"),_return:kw(\"return\",beforeExpr),_switch:kw(\"switch\"),_throw:kw(\"throw\",beforeExpr),_try:kw(\"try\"),_var:kw(\"var\"),_const:kw(\"const\"),_while:kw(\"while\",{isLoop:true}),_with:kw(\"with\"),_new:kw(\"new\",{beforeExpr:true,startsExpr:true}),_this:kw(\"this\",startsExpr),_super:kw(\"super\",startsExpr),_class:kw(\"class\",startsExpr),_extends:kw(\"extends\",beforeExpr),_export:kw(\"export\"),_import:kw(\"import\",startsExpr),_null:kw(\"null\",startsExpr),_true:kw(\"true\",startsExpr),_false:kw(\"false\",startsExpr),_in:kw(\"in\",{beforeExpr:true,binop:7}),_instanceof:kw(\"instanceof\",{beforeExpr:true,binop:7}),_typeof:kw(\"typeof\",{beforeExpr:true,prefix:true,startsExpr:true}),_void:kw(\"void\",{beforeExpr:true,prefix:true,startsExpr:true}),_delete:kw(\"delete\",{beforeExpr:true,prefix:true,startsExpr:true})};// Matches a whole line break (where CRLF is considered a single\n// line break). Used to count lines.\nvar lineBreak=/\\r\\n?|\\n|\\u2028|\\u2029/;var lineBreakG=new RegExp(lineBreak.source,\"g\");function isNewLine(code,ecma2019String){return code===10||code===13||!ecma2019String&&(code===0x2028||code===0x2029);}var nonASCIIwhitespace=/[\\u1680\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]/;var skipWhiteSpace=/(?:\\s|\\/\\/.*|\\/\\*[^]*?\\*\\/)*/g;var ref=Object.prototype;var hasOwnProperty=ref.hasOwnProperty;var toString=ref.toString;// Checks if an object has a property.\nfunction has(obj,propName){return hasOwnProperty.call(obj,propName);}var isArray=Array.isArray||function(obj){return toString.call(obj)===\"[object Array]\";};function wordsRegexp(words){return new RegExp(\"^(?:\"+words.replace(/ /g,\"|\")+\")$\");}// These are used when `options.locations` is on, for the\n// `startLoc` and `endLoc` properties.\nvar Position=function Position(line,col){this.line=line;this.column=col;};Position.prototype.offset=function offset(n){return new Position(this.line,this.column+n);};var SourceLocation=function SourceLocation(p,start,end){this.start=start;this.end=end;if(p.sourceFile!==null){this.source=p.sourceFile;}};// The `getLineInfo` function is mostly useful when the\n// `locations` option is off (for performance reasons) and you\n// want to find the line/column position for a given character\n// offset. `input` should be the code string that the offset refers\n// into.\nfunction getLineInfo(input,offset){for(var line=1,cur=0;;){lineBreakG.lastIndex=cur;var match=lineBreakG.exec(input);if(match&&match.index<offset){++line;cur=match.index+match[0].length;}else{return new Position(line,offset-cur);}}}// A second argument must be given to configure the parser process.\n// These options are recognized (only `ecmaVersion` is required):\nvar defaultOptions={// `ecmaVersion` indicates the ECMAScript version to parse. Must be\n// either 3, 5, 6 (or 2015), 7 (2016), 8 (2017), 9 (2018), 10\n// (2019), 11 (2020), 12 (2021), 13 (2022), or `\"latest\"` (the\n// latest version the library supports). This influences support\n// for strict mode, the set of reserved words, and support for\n// new syntax features.\necmaVersion:null,// `sourceType` indicates the mode the code should be parsed in.\n// Can be either `\"script\"` or `\"module\"`. This influences global\n// strict mode and parsing of `import` and `export` declarations.\nsourceType:\"script\",// `onInsertedSemicolon` can be a callback that will be called\n// when a semicolon is automatically inserted. It will be passed\n// the position of the comma as an offset, and if `locations` is\n// enabled, it is given the location as a `{line, column}` object\n// as second argument.\nonInsertedSemicolon:null,// `onTrailingComma` is similar to `onInsertedSemicolon`, but for\n// trailing commas.\nonTrailingComma:null,// By default, reserved words are only enforced if ecmaVersion >= 5.\n// Set `allowReserved` to a boolean value to explicitly turn this on\n// an off. When this option has the value \"never\", reserved words\n// and keywords can also not be used as property names.\nallowReserved:null,// When enabled, a return at the top level is not considered an\n// error.\nallowReturnOutsideFunction:false,// When enabled, import/export statements are not constrained to\n// appearing at the top of the program, and an import.meta expression\n// in a script isn't considered an error.\nallowImportExportEverywhere:false,// By default, await identifiers are allowed to appear at the top-level scope only if ecmaVersion >= 2022.\n// When enabled, await identifiers are allowed to appear at the top-level scope,\n// but they are still not allowed in non-async functions.\nallowAwaitOutsideFunction:null,// When enabled, super identifiers are not constrained to\n// appearing in methods and do not raise an error when they appear elsewhere.\nallowSuperOutsideMethod:null,// When enabled, hashbang directive in the beginning of file\n// is allowed and treated as a line comment.\nallowHashBang:false,// When `locations` is on, `loc` properties holding objects with\n// `start` and `end` properties in `{line, column}` form (with\n// line being 1-based and column 0-based) will be attached to the\n// nodes.\nlocations:false,// A function can be passed as `onToken` option, which will\n// cause Acorn to call that function with object in the same\n// format as tokens returned from `tokenizer().getToken()`. Note\n// that you are not allowed to call the parser from the\n// callback—that will corrupt its internal state.\nonToken:null,// A function can be passed as `onComment` option, which will\n// cause Acorn to call that function with `(block, text, start,\n// end)` parameters whenever a comment is skipped. `block` is a\n// boolean indicating whether this is a block (`/* */`) comment,\n// `text` is the content of the comment, and `start` and `end` are\n// character offsets that denote the start and end of the comment.\n// When the `locations` option is on, two more parameters are\n// passed, the full `{line, column}` locations of the start and\n// end of the comments. Note that you are not allowed to call the\n// parser from the callback—that will corrupt its internal state.\nonComment:null,// Nodes have their start and end characters offsets recorded in\n// `start` and `end` properties (directly on the node, rather than\n// the `loc` object, which holds line/column data. To also add a\n// [semi-standardized][range] `range` property holding a `[start,\n// end]` array with the same numbers, set the `ranges` option to\n// `true`.\n//\n// [range]: https://bugzilla.mozilla.org/show_bug.cgi?id=745678\nranges:false,// It is possible to parse multiple files into a single AST by\n// passing the tree produced by parsing the first file as\n// `program` option in subsequent parses. This will add the\n// toplevel forms of the parsed file to the `Program` (top) node\n// of an existing parse tree.\nprogram:null,// When `locations` is on, you can pass this to record the source\n// file in every node's `loc` object.\nsourceFile:null,// This value, if given, is stored in every node, whether\n// `locations` is on or off.\ndirectSourceFile:null,// When enabled, parenthesized expressions are represented by\n// (non-standard) ParenthesizedExpression nodes\npreserveParens:false};// Interpret and default an options object\nvar warnedAboutEcmaVersion=false;function getOptions(opts){var options={};for(var opt in defaultOptions){options[opt]=opts&&has(opts,opt)?opts[opt]:defaultOptions[opt];}if(options.ecmaVersion===\"latest\"){options.ecmaVersion=1e8;}else if(options.ecmaVersion==null){if(!warnedAboutEcmaVersion&&(typeof console===\"undefined\"?\"undefined\":(0,_typeof2.default)(console))===\"object\"&&console.warn){warnedAboutEcmaVersion=true;console.warn(\"Since Acorn 8.0.0, options.ecmaVersion is required.\\nDefaulting to 2020, but this will stop working in the future.\");}options.ecmaVersion=11;}else if(options.ecmaVersion>=2015){options.ecmaVersion-=2009;}if(options.allowReserved==null){options.allowReserved=options.ecmaVersion<5;}if(isArray(options.onToken)){var tokens=options.onToken;options.onToken=function(token){return tokens.push(token);};}if(isArray(options.onComment)){options.onComment=pushComment(options,options.onComment);}return options;}function pushComment(options,array){return function(block,text,start,end,startLoc,endLoc){var comment={type:block?\"Block\":\"Line\",value:text,start:start,end:end};if(options.locations){comment.loc=new SourceLocation(this,startLoc,endLoc);}if(options.ranges){comment.range=[start,end];}array.push(comment);};}// Each scope gets a bitset that may contain these flags\nvar SCOPE_TOP=1,SCOPE_FUNCTION=2,SCOPE_VAR=SCOPE_TOP|SCOPE_FUNCTION,SCOPE_ASYNC=4,SCOPE_GENERATOR=8,SCOPE_ARROW=16,SCOPE_SIMPLE_CATCH=32,SCOPE_SUPER=64,SCOPE_DIRECT_SUPER=128;function functionFlags(async,generator){return SCOPE_FUNCTION|(async?SCOPE_ASYNC:0)|(generator?SCOPE_GENERATOR:0);}// Used in checkLVal* and declareName to determine the type of a binding\nvar BIND_NONE=0,// Not a binding\nBIND_VAR=1,// Var-style binding\nBIND_LEXICAL=2,// Let- or const-style binding\nBIND_FUNCTION=3,// Function declaration\nBIND_SIMPLE_CATCH=4,// Simple (identifier pattern) catch binding\nBIND_OUTSIDE=5;// Special case for function names as bound inside the function\nvar Parser=function Parser(options,input,startPos){this.options=options=getOptions(options);this.sourceFile=options.sourceFile;this.keywords=wordsRegexp(keywords[options.ecmaVersion>=6?6:options.sourceType===\"module\"?\"5module\":5]);var reserved=\"\";if(options.allowReserved!==true){reserved=reservedWords[options.ecmaVersion>=6?6:options.ecmaVersion===5?5:3];if(options.sourceType===\"module\"){reserved+=\" await\";}}this.reservedWords=wordsRegexp(reserved);var reservedStrict=(reserved?reserved+\" \":\"\")+reservedWords.strict;this.reservedWordsStrict=wordsRegexp(reservedStrict);this.reservedWordsStrictBind=wordsRegexp(reservedStrict+\" \"+reservedWords.strictBind);this.input=String(input);// Used to signal to callers of `readWord1` whether the word\n// contained any escape sequences. This is needed because words with\n// escape sequences must not be interpreted as keywords.\nthis.containsEsc=false;// Set up token state\n// The current position of the tokenizer in the input.\nif(startPos){this.pos=startPos;this.lineStart=this.input.lastIndexOf(\"\\n\",startPos-1)+1;this.curLine=this.input.slice(0,this.lineStart).split(lineBreak).length;}else{this.pos=this.lineStart=0;this.curLine=1;}// Properties of the current token:\n// Its type\nthis.type=types.eof;// For tokens that include more information than their type, the value\nthis.value=null;// Its start and end offset\nthis.start=this.end=this.pos;// And, if locations are used, the {line, column} object\n// corresponding to those offsets\nthis.startLoc=this.endLoc=this.curPosition();// Position information for the previous token\nthis.lastTokEndLoc=this.lastTokStartLoc=null;this.lastTokStart=this.lastTokEnd=this.pos;// The context stack is used to superficially track syntactic\n// context to predict whether a regular expression is allowed in a\n// given position.\nthis.context=this.initialContext();this.exprAllowed=true;// Figure out if it's a module code.\nthis.inModule=options.sourceType===\"module\";this.strict=this.inModule||this.strictDirective(this.pos);// Used to signify the start of a potential arrow function\nthis.potentialArrowAt=-1;this.potentialArrowInForAwait=false;// Positions to delayed-check that yield/await does not exist in default parameters.\nthis.yieldPos=this.awaitPos=this.awaitIdentPos=0;// Labels in scope.\nthis.labels=[];// Thus-far undefined exports.\nthis.undefinedExports=Object.create(null);// If enabled, skip leading hashbang line.\nif(this.pos===0&&options.allowHashBang&&this.input.slice(0,2)===\"#!\"){this.skipLineComment(2);}// Scope tracking for duplicate variable names (see scope.js)\nthis.scopeStack=[];this.enterScope(SCOPE_TOP);// For RegExp validation\nthis.regexpState=null;// The stack of private names.\n// Each element has two properties: 'declared' and 'used'.\n// When it exited from the outermost class definition, all used private names must be declared.\nthis.privateNameStack=[];};var prototypeAccessors={inFunction:{configurable:true},inGenerator:{configurable:true},inAsync:{configurable:true},canAwait:{configurable:true},allowSuper:{configurable:true},allowDirectSuper:{configurable:true},treatFunctionsAsVar:{configurable:true},inNonArrowFunction:{configurable:true}};Parser.prototype.parse=function parse(){var node=this.options.program||this.startNode();this.nextToken();return this.parseTopLevel(node);};prototypeAccessors.inFunction.get=function(){return(this.currentVarScope().flags&SCOPE_FUNCTION)>0;};prototypeAccessors.inGenerator.get=function(){return(this.currentVarScope().flags&SCOPE_GENERATOR)>0&&!this.currentVarScope().inClassFieldInit;};prototypeAccessors.inAsync.get=function(){return(this.currentVarScope().flags&SCOPE_ASYNC)>0&&!this.currentVarScope().inClassFieldInit;};prototypeAccessors.canAwait.get=function(){for(var i=this.scopeStack.length-1;i>=0;i--){var scope=this.scopeStack[i];if(scope.inClassFieldInit){return false;}if(scope.flags&SCOPE_FUNCTION){return(scope.flags&SCOPE_ASYNC)>0;}}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction;};prototypeAccessors.allowSuper.get=function(){var ref=this.currentThisScope();var flags=ref.flags;var inClassFieldInit=ref.inClassFieldInit;return(flags&SCOPE_SUPER)>0||inClassFieldInit||this.options.allowSuperOutsideMethod;};prototypeAccessors.allowDirectSuper.get=function(){return(this.currentThisScope().flags&SCOPE_DIRECT_SUPER)>0;};prototypeAccessors.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope());};prototypeAccessors.inNonArrowFunction.get=function(){var ref=this.currentThisScope();var flags=ref.flags;var inClassFieldInit=ref.inClassFieldInit;return(flags&SCOPE_FUNCTION)>0||inClassFieldInit;};Parser.extend=function extend(){var plugins=[],len=arguments.length;while(len--){plugins[len]=arguments[len];}var cls=this;for(var i=0;i<plugins.length;i++){cls=plugins[i](cls);}return cls;};Parser.parse=function parse(input,options){return new this(options,input).parse();};Parser.parseExpressionAt=function parseExpressionAt(input,pos,options){var parser=new this(options,input,pos);parser.nextToken();return parser.parseExpression();};Parser.tokenizer=function tokenizer(input,options){return new this(options,input);};Object.defineProperties(Parser.prototype,prototypeAccessors);var pp=Parser.prototype;// ## Parser utilities\nvar literal=/^(?:'((?:\\\\.|[^'\\\\])*?)'|\"((?:\\\\.|[^\"\\\\])*?)\")/;pp.strictDirective=function(start){for(;;){// Try to find string literal.\nskipWhiteSpace.lastIndex=start;start+=skipWhiteSpace.exec(this.input)[0].length;var match=literal.exec(this.input.slice(start));if(!match){return false;}if((match[1]||match[2])===\"use strict\"){skipWhiteSpace.lastIndex=start+match[0].length;var spaceAfter=skipWhiteSpace.exec(this.input),end=spaceAfter.index+spaceAfter[0].length;var next=this.input.charAt(end);return next===\";\"||next===\"}\"||lineBreak.test(spaceAfter[0])&&!(/[(`.[+\\-/*%<>=,?^&]/.test(next)||next===\"!\"&&this.input.charAt(end+1)===\"=\");}start+=match[0].length;// Skip semicolon, if any.\nskipWhiteSpace.lastIndex=start;start+=skipWhiteSpace.exec(this.input)[0].length;if(this.input[start]===\";\"){start++;}}};// Predicate that tests whether the next token is of the given\n// type, and if yes, consumes it as a side effect.\npp.eat=function(type){if(this.type===type){this.next();return true;}else{return false;}};// Tests whether parsed token is a contextual keyword.\npp.isContextual=function(name){return this.type===types.name&&this.value===name&&!this.containsEsc;};// Consumes contextual keyword if possible.\npp.eatContextual=function(name){if(!this.isContextual(name)){return false;}this.next();return true;};// Asserts that following token is given contextual keyword.\npp.expectContextual=function(name){if(!this.eatContextual(name)){this.unexpected();}};// Test whether a semicolon can be inserted at the current position.\npp.canInsertSemicolon=function(){return this.type===types.eof||this.type===types.braceR||lineBreak.test(this.input.slice(this.lastTokEnd,this.start));};pp.insertSemicolon=function(){if(this.canInsertSemicolon()){if(this.options.onInsertedSemicolon){this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc);}return true;}};// Consume a semicolon, or, failing that, see if we are allowed to\n// pretend that there is a semicolon at this position.\npp.semicolon=function(){if(!this.eat(types.semi)&&!this.insertSemicolon()){this.unexpected();}};pp.afterTrailingComma=function(tokType,notNext){if(this.type===tokType){if(this.options.onTrailingComma){this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc);}if(!notNext){this.next();}return true;}};// Expect a token of a given type. If found, consume it, otherwise,\n// raise an unexpected token error.\npp.expect=function(type){this.eat(type)||this.unexpected();};// Raise an unexpected token error.\npp.unexpected=function(pos){this.raise(pos!=null?pos:this.start,\"Unexpected token\");};function DestructuringErrors(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1;}pp.checkPatternErrors=function(refDestructuringErrors,isAssign){if(!refDestructuringErrors){return;}if(refDestructuringErrors.trailingComma>-1){this.raiseRecoverable(refDestructuringErrors.trailingComma,\"Comma is not permitted after the rest element\");}var parens=isAssign?refDestructuringErrors.parenthesizedAssign:refDestructuringErrors.parenthesizedBind;if(parens>-1){this.raiseRecoverable(parens,\"Parenthesized pattern\");}};pp.checkExpressionErrors=function(refDestructuringErrors,andThrow){if(!refDestructuringErrors){return false;}var shorthandAssign=refDestructuringErrors.shorthandAssign;var doubleProto=refDestructuringErrors.doubleProto;if(!andThrow){return shorthandAssign>=0||doubleProto>=0;}if(shorthandAssign>=0){this.raise(shorthandAssign,\"Shorthand property assignments are valid only in destructuring patterns\");}if(doubleProto>=0){this.raiseRecoverable(doubleProto,\"Redefinition of __proto__ property\");}};pp.checkYieldAwaitInDefaultParams=function(){if(this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)){this.raise(this.yieldPos,\"Yield expression cannot be a default value\");}if(this.awaitPos){this.raise(this.awaitPos,\"Await expression cannot be a default value\");}};pp.isSimpleAssignTarget=function(expr){if(expr.type===\"ParenthesizedExpression\"){return this.isSimpleAssignTarget(expr.expression);}return expr.type===\"Identifier\"||expr.type===\"MemberExpression\";};var pp$1=Parser.prototype;// ### Statement parsing\n// Parse a program. Initializes the parser, reads any number of\n// statements, and wraps them in a Program node.  Optionally takes a\n// `program` argument.  If present, the statements will be appended\n// to its body instead of creating a new node.\npp$1.parseTopLevel=function(node){var exports=Object.create(null);if(!node.body){node.body=[];}while(this.type!==types.eof){var stmt=this.parseStatement(null,true,exports);node.body.push(stmt);}if(this.inModule){for(var i=0,list=Object.keys(this.undefinedExports);i<list.length;i+=1){var name=list[i];this.raiseRecoverable(this.undefinedExports[name].start,\"Export '\"+name+\"' is not defined\");}}this.adaptDirectivePrologue(node.body);this.next();node.sourceType=this.options.sourceType;return this.finishNode(node,\"Program\");};var loopLabel={kind:\"loop\"},switchLabel={kind:\"switch\"};pp$1.isLet=function(context){if(this.options.ecmaVersion<6||!this.isContextual(\"let\")){return false;}skipWhiteSpace.lastIndex=this.pos;var skip=skipWhiteSpace.exec(this.input);var next=this.pos+skip[0].length,nextCh=this.input.charCodeAt(next);// For ambiguous cases, determine if a LexicalDeclaration (or only a\n// Statement) is allowed here. If context is not empty then only a Statement\n// is allowed. However, `let [` is an explicit negative lookahead for\n// ExpressionStatement, so special-case it first.\nif(nextCh===91||nextCh===92||nextCh>0xd7ff&&nextCh<0xdc00){return true;}// '[', '/', astral\nif(context){return false;}if(nextCh===123){return true;}// '{'\nif(isIdentifierStart(nextCh,true)){var pos=next+1;while(isIdentifierChar(nextCh=this.input.charCodeAt(pos),true)){++pos;}if(nextCh===92||nextCh>0xd7ff&&nextCh<0xdc00){return true;}var ident=this.input.slice(next,pos);if(!keywordRelationalOperator.test(ident)){return true;}}return false;};// check 'async [no LineTerminator here] function'\n// - 'async /*foo*/ function' is OK.\n// - 'async /*\\n*/ function' is invalid.\npp$1.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual(\"async\")){return false;}skipWhiteSpace.lastIndex=this.pos;var skip=skipWhiteSpace.exec(this.input);var next=this.pos+skip[0].length,after;return!lineBreak.test(this.input.slice(this.pos,next))&&this.input.slice(next,next+8)===\"function\"&&(next+8===this.input.length||!(isIdentifierChar(after=this.input.charCodeAt(next+8))||after>0xd7ff&&after<0xdc00));};// Parse a single statement.\n//\n// If expecting a statement and finding a slash operator, parse a\n// regular expression literal. This is to handle cases like\n// `if (foo) /blah/.exec(foo)`, where looking at the previous token\n// does not help.\npp$1.parseStatement=function(context,topLevel,exports){var starttype=this.type,node=this.startNode(),kind;if(this.isLet(context)){starttype=types._var;kind=\"let\";}// Most types of statements are recognized by the keyword they\n// start with. Many are trivial to parse, some require a bit of\n// complexity.\nswitch(starttype){case types._break:case types._continue:return this.parseBreakContinueStatement(node,starttype.keyword);case types._debugger:return this.parseDebuggerStatement(node);case types._do:return this.parseDoStatement(node);case types._for:return this.parseForStatement(node);case types._function:// Function as sole body of either an if statement or a labeled statement\n// works, but not when it is part of a labeled statement that is the sole\n// body of an if statement.\nif(context&&(this.strict||context!==\"if\"&&context!==\"label\")&&this.options.ecmaVersion>=6){this.unexpected();}return this.parseFunctionStatement(node,false,!context);case types._class:if(context){this.unexpected();}return this.parseClass(node,true);case types._if:return this.parseIfStatement(node);case types._return:return this.parseReturnStatement(node);case types._switch:return this.parseSwitchStatement(node);case types._throw:return this.parseThrowStatement(node);case types._try:return this.parseTryStatement(node);case types._const:case types._var:kind=kind||this.value;if(context&&kind!==\"var\"){this.unexpected();}return this.parseVarStatement(node,kind);case types._while:return this.parseWhileStatement(node);case types._with:return this.parseWithStatement(node);case types.braceL:return this.parseBlock(true,node);case types.semi:return this.parseEmptyStatement(node);case types._export:case types._import:if(this.options.ecmaVersion>10&&starttype===types._import){skipWhiteSpace.lastIndex=this.pos;var skip=skipWhiteSpace.exec(this.input);var next=this.pos+skip[0].length,nextCh=this.input.charCodeAt(next);if(nextCh===40||nextCh===46)// '(' or '.'\n{return this.parseExpressionStatement(node,this.parseExpression());}}if(!this.options.allowImportExportEverywhere){if(!topLevel){this.raise(this.start,\"'import' and 'export' may only appear at the top level\");}if(!this.inModule){this.raise(this.start,\"'import' and 'export' may appear only with 'sourceType: module'\");}}return starttype===types._import?this.parseImport(node):this.parseExport(node,exports);// If the statement does not start with a statement keyword or a\n// brace, it's an ExpressionStatement or LabeledStatement. We\n// simply start parsing an expression, and afterwards, if the\n// next token is a colon and the expression was a simple\n// Identifier node, we switch to interpreting it as a label.\ndefault:if(this.isAsyncFunction()){if(context){this.unexpected();}this.next();return this.parseFunctionStatement(node,true,!context);}var maybeName=this.value,expr=this.parseExpression();if(starttype===types.name&&expr.type===\"Identifier\"&&this.eat(types.colon)){return this.parseLabeledStatement(node,maybeName,expr,context);}else{return this.parseExpressionStatement(node,expr);}}};pp$1.parseBreakContinueStatement=function(node,keyword){var isBreak=keyword===\"break\";this.next();if(this.eat(types.semi)||this.insertSemicolon()){node.label=null;}else if(this.type!==types.name){this.unexpected();}else{node.label=this.parseIdent();this.semicolon();}// Verify that there is an actual destination to break or\n// continue to.\nvar i=0;for(;i<this.labels.length;++i){var lab=this.labels[i];if(node.label==null||lab.name===node.label.name){if(lab.kind!=null&&(isBreak||lab.kind===\"loop\")){break;}if(node.label&&isBreak){break;}}}if(i===this.labels.length){this.raise(node.start,\"Unsyntactic \"+keyword);}return this.finishNode(node,isBreak?\"BreakStatement\":\"ContinueStatement\");};pp$1.parseDebuggerStatement=function(node){this.next();this.semicolon();return this.finishNode(node,\"DebuggerStatement\");};pp$1.parseDoStatement=function(node){this.next();this.labels.push(loopLabel);node.body=this.parseStatement(\"do\");this.labels.pop();this.expect(types._while);node.test=this.parseParenExpression();if(this.options.ecmaVersion>=6){this.eat(types.semi);}else{this.semicolon();}return this.finishNode(node,\"DoWhileStatement\");};// Disambiguating between a `for` and a `for`/`in` or `for`/`of`\n// loop is non-trivial. Basically, we have to parse the init `var`\n// statement or expression, disallowing the `in` operator (see\n// the second parameter to `parseExpression`), and then check\n// whether the next token is `in` or `of`. When there is no init\n// part (semicolon immediately after the opening parenthesis), it\n// is a regular `for` loop.\npp$1.parseForStatement=function(node){this.next();var awaitAt=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual(\"await\")?this.lastTokStart:-1;this.labels.push(loopLabel);this.enterScope(0);this.expect(types.parenL);if(this.type===types.semi){if(awaitAt>-1){this.unexpected(awaitAt);}return this.parseFor(node,null);}var isLet=this.isLet();if(this.type===types._var||this.type===types._const||isLet){var init$1=this.startNode(),kind=isLet?\"let\":this.value;this.next();this.parseVar(init$1,true,kind);this.finishNode(init$1,\"VariableDeclaration\");if((this.type===types._in||this.options.ecmaVersion>=6&&this.isContextual(\"of\"))&&init$1.declarations.length===1){if(this.options.ecmaVersion>=9){if(this.type===types._in){if(awaitAt>-1){this.unexpected(awaitAt);}}else{node.await=awaitAt>-1;}}return this.parseForIn(node,init$1);}if(awaitAt>-1){this.unexpected(awaitAt);}return this.parseFor(node,init$1);}var refDestructuringErrors=new DestructuringErrors();var init=this.parseExpression(awaitAt>-1?\"await\":true,refDestructuringErrors);if(this.type===types._in||this.options.ecmaVersion>=6&&this.isContextual(\"of\")){if(this.options.ecmaVersion>=9){if(this.type===types._in){if(awaitAt>-1){this.unexpected(awaitAt);}}else{node.await=awaitAt>-1;}}this.toAssignable(init,false,refDestructuringErrors);this.checkLValPattern(init);return this.parseForIn(node,init);}else{this.checkExpressionErrors(refDestructuringErrors,true);}if(awaitAt>-1){this.unexpected(awaitAt);}return this.parseFor(node,init);};pp$1.parseFunctionStatement=function(node,isAsync,declarationPosition){this.next();return this.parseFunction(node,FUNC_STATEMENT|(declarationPosition?0:FUNC_HANGING_STATEMENT),false,isAsync);};pp$1.parseIfStatement=function(node){this.next();node.test=this.parseParenExpression();// allow function declarations in branches, but only in non-strict mode\nnode.consequent=this.parseStatement(\"if\");node.alternate=this.eat(types._else)?this.parseStatement(\"if\"):null;return this.finishNode(node,\"IfStatement\");};pp$1.parseReturnStatement=function(node){if(!this.inFunction&&!this.options.allowReturnOutsideFunction){this.raise(this.start,\"'return' outside of function\");}this.next();// In `return` (and `break`/`continue`), the keywords with\n// optional arguments, we eagerly look for a semicolon or the\n// possibility to insert one.\nif(this.eat(types.semi)||this.insertSemicolon()){node.argument=null;}else{node.argument=this.parseExpression();this.semicolon();}return this.finishNode(node,\"ReturnStatement\");};pp$1.parseSwitchStatement=function(node){this.next();node.discriminant=this.parseParenExpression();node.cases=[];this.expect(types.braceL);this.labels.push(switchLabel);this.enterScope(0);// Statements under must be grouped (by label) in SwitchCase\n// nodes. `cur` is used to keep the node that we are currently\n// adding statements to.\nvar cur;for(var sawDefault=false;this.type!==types.braceR;){if(this.type===types._case||this.type===types._default){var isCase=this.type===types._case;if(cur){this.finishNode(cur,\"SwitchCase\");}node.cases.push(cur=this.startNode());cur.consequent=[];this.next();if(isCase){cur.test=this.parseExpression();}else{if(sawDefault){this.raiseRecoverable(this.lastTokStart,\"Multiple default clauses\");}sawDefault=true;cur.test=null;}this.expect(types.colon);}else{if(!cur){this.unexpected();}cur.consequent.push(this.parseStatement(null));}}this.exitScope();if(cur){this.finishNode(cur,\"SwitchCase\");}this.next();// Closing brace\nthis.labels.pop();return this.finishNode(node,\"SwitchStatement\");};pp$1.parseThrowStatement=function(node){this.next();if(lineBreak.test(this.input.slice(this.lastTokEnd,this.start))){this.raise(this.lastTokEnd,\"Illegal newline after throw\");}node.argument=this.parseExpression();this.semicolon();return this.finishNode(node,\"ThrowStatement\");};// Reused empty array added for node fields that are always empty.\nvar empty=[];pp$1.parseTryStatement=function(node){this.next();node.block=this.parseBlock();node.handler=null;if(this.type===types._catch){var clause=this.startNode();this.next();if(this.eat(types.parenL)){clause.param=this.parseBindingAtom();var simple=clause.param.type===\"Identifier\";this.enterScope(simple?SCOPE_SIMPLE_CATCH:0);this.checkLValPattern(clause.param,simple?BIND_SIMPLE_CATCH:BIND_LEXICAL);this.expect(types.parenR);}else{if(this.options.ecmaVersion<10){this.unexpected();}clause.param=null;this.enterScope(0);}clause.body=this.parseBlock(false);this.exitScope();node.handler=this.finishNode(clause,\"CatchClause\");}node.finalizer=this.eat(types._finally)?this.parseBlock():null;if(!node.handler&&!node.finalizer){this.raise(node.start,\"Missing catch or finally clause\");}return this.finishNode(node,\"TryStatement\");};pp$1.parseVarStatement=function(node,kind){this.next();this.parseVar(node,false,kind);this.semicolon();return this.finishNode(node,\"VariableDeclaration\");};pp$1.parseWhileStatement=function(node){this.next();node.test=this.parseParenExpression();this.labels.push(loopLabel);node.body=this.parseStatement(\"while\");this.labels.pop();return this.finishNode(node,\"WhileStatement\");};pp$1.parseWithStatement=function(node){if(this.strict){this.raise(this.start,\"'with' in strict mode\");}this.next();node.object=this.parseParenExpression();node.body=this.parseStatement(\"with\");return this.finishNode(node,\"WithStatement\");};pp$1.parseEmptyStatement=function(node){this.next();return this.finishNode(node,\"EmptyStatement\");};pp$1.parseLabeledStatement=function(node,maybeName,expr,context){for(var i$1=0,list=this.labels;i$1<list.length;i$1+=1){var label=list[i$1];if(label.name===maybeName){this.raise(expr.start,\"Label '\"+maybeName+\"' is already declared\");}}var kind=this.type.isLoop?\"loop\":this.type===types._switch?\"switch\":null;for(var i=this.labels.length-1;i>=0;i--){var label$1=this.labels[i];if(label$1.statementStart===node.start){// Update information about previous labels on this node\nlabel$1.statementStart=this.start;label$1.kind=kind;}else{break;}}this.labels.push({name:maybeName,kind:kind,statementStart:this.start});node.body=this.parseStatement(context?context.indexOf(\"label\")===-1?context+\"label\":context:\"label\");this.labels.pop();node.label=expr;return this.finishNode(node,\"LabeledStatement\");};pp$1.parseExpressionStatement=function(node,expr){node.expression=expr;this.semicolon();return this.finishNode(node,\"ExpressionStatement\");};// Parse a semicolon-enclosed block of statements, handling `\"use\n// strict\"` declarations when `allowStrict` is true (used for\n// function bodies).\npp$1.parseBlock=function(createNewLexicalScope,node,exitStrict){if(createNewLexicalScope===void 0)createNewLexicalScope=true;if(node===void 0)node=this.startNode();node.body=[];this.expect(types.braceL);if(createNewLexicalScope){this.enterScope(0);}while(this.type!==types.braceR){var stmt=this.parseStatement(null);node.body.push(stmt);}if(exitStrict){this.strict=false;}this.next();if(createNewLexicalScope){this.exitScope();}return this.finishNode(node,\"BlockStatement\");};// Parse a regular `for` loop. The disambiguation code in\n// `parseStatement` will already have parsed the init statement or\n// expression.\npp$1.parseFor=function(node,init){node.init=init;this.expect(types.semi);node.test=this.type===types.semi?null:this.parseExpression();this.expect(types.semi);node.update=this.type===types.parenR?null:this.parseExpression();this.expect(types.parenR);node.body=this.parseStatement(\"for\");this.exitScope();this.labels.pop();return this.finishNode(node,\"ForStatement\");};// Parse a `for`/`in` and `for`/`of` loop, which are almost\n// same from parser's perspective.\npp$1.parseForIn=function(node,init){var isForIn=this.type===types._in;this.next();if(init.type===\"VariableDeclaration\"&&init.declarations[0].init!=null&&(!isForIn||this.options.ecmaVersion<8||this.strict||init.kind!==\"var\"||init.declarations[0].id.type!==\"Identifier\")){this.raise(init.start,(isForIn?\"for-in\":\"for-of\")+\" loop variable declaration may not have an initializer\");}node.left=init;node.right=isForIn?this.parseExpression():this.parseMaybeAssign();this.expect(types.parenR);node.body=this.parseStatement(\"for\");this.exitScope();this.labels.pop();return this.finishNode(node,isForIn?\"ForInStatement\":\"ForOfStatement\");};// Parse a list of variable declarations.\npp$1.parseVar=function(node,isFor,kind){node.declarations=[];node.kind=kind;for(;;){var decl=this.startNode();this.parseVarId(decl,kind);if(this.eat(types.eq)){decl.init=this.parseMaybeAssign(isFor);}else if(kind===\"const\"&&!(this.type===types._in||this.options.ecmaVersion>=6&&this.isContextual(\"of\"))){this.unexpected();}else if(decl.id.type!==\"Identifier\"&&!(isFor&&(this.type===types._in||this.isContextual(\"of\")))){this.raise(this.lastTokEnd,\"Complex binding patterns require an initialization value\");}else{decl.init=null;}node.declarations.push(this.finishNode(decl,\"VariableDeclarator\"));if(!this.eat(types.comma)){break;}}return node;};pp$1.parseVarId=function(decl,kind){decl.id=this.parseBindingAtom();this.checkLValPattern(decl.id,kind===\"var\"?BIND_VAR:BIND_LEXICAL,false);};var FUNC_STATEMENT=1,FUNC_HANGING_STATEMENT=2,FUNC_NULLABLE_ID=4;// Parse a function declaration or literal (depending on the\n// `statement & FUNC_STATEMENT`).\n// Remove `allowExpressionBody` for 7.0.0, as it is only called with false\npp$1.parseFunction=function(node,statement,allowExpressionBody,isAsync){this.initFunction(node);if(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!isAsync){if(this.type===types.star&&statement&FUNC_HANGING_STATEMENT){this.unexpected();}node.generator=this.eat(types.star);}if(this.options.ecmaVersion>=8){node.async=!!isAsync;}if(statement&FUNC_STATEMENT){node.id=statement&FUNC_NULLABLE_ID&&this.type!==types.name?null:this.parseIdent();if(node.id&&!(statement&FUNC_HANGING_STATEMENT))// If it is a regular function declaration in sloppy mode, then it is\n// subject to Annex B semantics (BIND_FUNCTION). Otherwise, the binding\n// mode depends on properties of the current scope (see\n// treatFunctionsAsVar).\n{this.checkLValSimple(node.id,this.strict||node.generator||node.async?this.treatFunctionsAsVar?BIND_VAR:BIND_LEXICAL:BIND_FUNCTION);}}var oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;this.enterScope(functionFlags(node.async,node.generator));if(!(statement&FUNC_STATEMENT)){node.id=this.type===types.name?this.parseIdent():null;}this.parseFunctionParams(node);this.parseFunctionBody(node,allowExpressionBody,false);this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.finishNode(node,statement&FUNC_STATEMENT?\"FunctionDeclaration\":\"FunctionExpression\");};pp$1.parseFunctionParams=function(node){this.expect(types.parenL);node.params=this.parseBindingList(types.parenR,false,this.options.ecmaVersion>=8);this.checkYieldAwaitInDefaultParams();};// Parse a class declaration or literal (depending on the\n// `isStatement` parameter).\npp$1.parseClass=function(node,isStatement){this.next();// ecma-262 14.6 Class Definitions\n// A class definition is always strict mode code.\nvar oldStrict=this.strict;this.strict=true;this.parseClassId(node,isStatement);this.parseClassSuper(node);var privateNameMap=this.enterClassBody();var classBody=this.startNode();var hadConstructor=false;classBody.body=[];this.expect(types.braceL);while(this.type!==types.braceR){var element=this.parseClassElement(node.superClass!==null);if(element){classBody.body.push(element);if(element.type===\"MethodDefinition\"&&element.kind===\"constructor\"){if(hadConstructor){this.raise(element.start,\"Duplicate constructor in the same class\");}hadConstructor=true;}else if(element.key.type===\"PrivateIdentifier\"&&isPrivateNameConflicted(privateNameMap,element)){this.raiseRecoverable(element.key.start,\"Identifier '#\"+element.key.name+\"' has already been declared\");}}}this.strict=oldStrict;this.next();node.body=this.finishNode(classBody,\"ClassBody\");this.exitClassBody();return this.finishNode(node,isStatement?\"ClassDeclaration\":\"ClassExpression\");};pp$1.parseClassElement=function(constructorAllowsSuper){if(this.eat(types.semi)){return null;}var ecmaVersion=this.options.ecmaVersion;var node=this.startNode();var keyName=\"\";var isGenerator=false;var isAsync=false;var kind=\"method\";// Parse modifiers\nnode.static=false;if(this.eatContextual(\"static\")){if(this.isClassElementNameStart()||this.type===types.star){node.static=true;}else{keyName=\"static\";}}if(!keyName&&ecmaVersion>=8&&this.eatContextual(\"async\")){if((this.isClassElementNameStart()||this.type===types.star)&&!this.canInsertSemicolon()){isAsync=true;}else{keyName=\"async\";}}if(!keyName&&(ecmaVersion>=9||!isAsync)&&this.eat(types.star)){isGenerator=true;}if(!keyName&&!isAsync&&!isGenerator){var lastValue=this.value;if(this.eatContextual(\"get\")||this.eatContextual(\"set\")){if(this.isClassElementNameStart()){kind=lastValue;}else{keyName=lastValue;}}}// Parse element name\nif(keyName){// 'async', 'get', 'set', or 'static' were not a keyword contextually.\n// The last token is any of those. Make it the element name.\nnode.computed=false;node.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc);node.key.name=keyName;this.finishNode(node.key,\"Identifier\");}else{this.parseClassElementName(node);}// Parse element value\nif(ecmaVersion<13||this.type===types.parenL||kind!==\"method\"||isGenerator||isAsync){var isConstructor=!node.static&&checkKeyName(node,\"constructor\");var allowsDirectSuper=isConstructor&&constructorAllowsSuper;// Couldn't move this check into the 'parseClassMethod' method for backward compatibility.\nif(isConstructor&&kind!==\"method\"){this.raise(node.key.start,\"Constructor can't have get/set modifier\");}node.kind=isConstructor?\"constructor\":kind;this.parseClassMethod(node,isGenerator,isAsync,allowsDirectSuper);}else{this.parseClassField(node);}return node;};pp$1.isClassElementNameStart=function(){return this.type===types.name||this.type===types.privateId||this.type===types.num||this.type===types.string||this.type===types.bracketL||this.type.keyword;};pp$1.parseClassElementName=function(element){if(this.type===types.privateId){if(this.value===\"constructor\"){this.raise(this.start,\"Classes can't have an element named '#constructor'\");}element.computed=false;element.key=this.parsePrivateIdent();}else{this.parsePropertyName(element);}};pp$1.parseClassMethod=function(method,isGenerator,isAsync,allowsDirectSuper){// Check key and flags\nvar key=method.key;if(method.kind===\"constructor\"){if(isGenerator){this.raise(key.start,\"Constructor can't be a generator\");}if(isAsync){this.raise(key.start,\"Constructor can't be an async method\");}}else if(method.static&&checkKeyName(method,\"prototype\")){this.raise(key.start,\"Classes may not have a static property named prototype\");}// Parse value\nvar value=method.value=this.parseMethod(isGenerator,isAsync,allowsDirectSuper);// Check value\nif(method.kind===\"get\"&&value.params.length!==0){this.raiseRecoverable(value.start,\"getter should have no params\");}if(method.kind===\"set\"&&value.params.length!==1){this.raiseRecoverable(value.start,\"setter should have exactly one param\");}if(method.kind===\"set\"&&value.params[0].type===\"RestElement\"){this.raiseRecoverable(value.params[0].start,\"Setter cannot use rest params\");}return this.finishNode(method,\"MethodDefinition\");};pp$1.parseClassField=function(field){if(checkKeyName(field,\"constructor\")){this.raise(field.key.start,\"Classes can't have a field named 'constructor'\");}else if(field.static&&checkKeyName(field,\"prototype\")){this.raise(field.key.start,\"Classes can't have a static field named 'prototype'\");}if(this.eat(types.eq)){// To raise SyntaxError if 'arguments' exists in the initializer.\nvar scope=this.currentThisScope();var inClassFieldInit=scope.inClassFieldInit;scope.inClassFieldInit=true;field.value=this.parseMaybeAssign();scope.inClassFieldInit=inClassFieldInit;}else{field.value=null;}this.semicolon();return this.finishNode(field,\"PropertyDefinition\");};pp$1.parseClassId=function(node,isStatement){if(this.type===types.name){node.id=this.parseIdent();if(isStatement){this.checkLValSimple(node.id,BIND_LEXICAL,false);}}else{if(isStatement===true){this.unexpected();}node.id=null;}};pp$1.parseClassSuper=function(node){node.superClass=this.eat(types._extends)?this.parseExprSubscripts():null;};pp$1.enterClassBody=function(){var element={declared:Object.create(null),used:[]};this.privateNameStack.push(element);return element.declared;};pp$1.exitClassBody=function(){var ref=this.privateNameStack.pop();var declared=ref.declared;var used=ref.used;var len=this.privateNameStack.length;var parent=len===0?null:this.privateNameStack[len-1];for(var i=0;i<used.length;++i){var id=used[i];if(!has(declared,id.name)){if(parent){parent.used.push(id);}else{this.raiseRecoverable(id.start,\"Private field '#\"+id.name+\"' must be declared in an enclosing class\");}}}};function isPrivateNameConflicted(privateNameMap,element){var name=element.key.name;var curr=privateNameMap[name];var next=\"true\";if(element.type===\"MethodDefinition\"&&(element.kind===\"get\"||element.kind===\"set\")){next=(element.static?\"s\":\"i\")+element.kind;}// `class { get #a(){}; static set #a(_){} }` is also conflict.\nif(curr===\"iget\"&&next===\"iset\"||curr===\"iset\"&&next===\"iget\"||curr===\"sget\"&&next===\"sset\"||curr===\"sset\"&&next===\"sget\"){privateNameMap[name]=\"true\";return false;}else if(!curr){privateNameMap[name]=next;return false;}else{return true;}}function checkKeyName(node,name){var computed=node.computed;var key=node.key;return!computed&&(key.type===\"Identifier\"&&key.name===name||key.type===\"Literal\"&&key.value===name);}// Parses module export declaration.\npp$1.parseExport=function(node,exports){this.next();// export * from '...'\nif(this.eat(types.star)){if(this.options.ecmaVersion>=11){if(this.eatContextual(\"as\")){node.exported=this.parseIdent(true);this.checkExport(exports,node.exported.name,this.lastTokStart);}else{node.exported=null;}}this.expectContextual(\"from\");if(this.type!==types.string){this.unexpected();}node.source=this.parseExprAtom();this.semicolon();return this.finishNode(node,\"ExportAllDeclaration\");}if(this.eat(types._default)){// export default ...\nthis.checkExport(exports,\"default\",this.lastTokStart);var isAsync;if(this.type===types._function||(isAsync=this.isAsyncFunction())){var fNode=this.startNode();this.next();if(isAsync){this.next();}node.declaration=this.parseFunction(fNode,FUNC_STATEMENT|FUNC_NULLABLE_ID,false,isAsync);}else if(this.type===types._class){var cNode=this.startNode();node.declaration=this.parseClass(cNode,\"nullableID\");}else{node.declaration=this.parseMaybeAssign();this.semicolon();}return this.finishNode(node,\"ExportDefaultDeclaration\");}// export var|const|let|function|class ...\nif(this.shouldParseExportStatement()){node.declaration=this.parseStatement(null);if(node.declaration.type===\"VariableDeclaration\"){this.checkVariableExport(exports,node.declaration.declarations);}else{this.checkExport(exports,node.declaration.id.name,node.declaration.id.start);}node.specifiers=[];node.source=null;}else{// export { x, y as z } [from '...']\nnode.declaration=null;node.specifiers=this.parseExportSpecifiers(exports);if(this.eatContextual(\"from\")){if(this.type!==types.string){this.unexpected();}node.source=this.parseExprAtom();}else{for(var i=0,list=node.specifiers;i<list.length;i+=1){// check for keywords used as local names\nvar spec=list[i];this.checkUnreserved(spec.local);// check if export is defined\nthis.checkLocalExport(spec.local);}node.source=null;}this.semicolon();}return this.finishNode(node,\"ExportNamedDeclaration\");};pp$1.checkExport=function(exports,name,pos){if(!exports){return;}if(has(exports,name)){this.raiseRecoverable(pos,\"Duplicate export '\"+name+\"'\");}exports[name]=true;};pp$1.checkPatternExport=function(exports,pat){var type=pat.type;if(type===\"Identifier\"){this.checkExport(exports,pat.name,pat.start);}else if(type===\"ObjectPattern\"){for(var i=0,list=pat.properties;i<list.length;i+=1){var prop=list[i];this.checkPatternExport(exports,prop);}}else if(type===\"ArrayPattern\"){for(var i$1=0,list$1=pat.elements;i$1<list$1.length;i$1+=1){var elt=list$1[i$1];if(elt){this.checkPatternExport(exports,elt);}}}else if(type===\"Property\"){this.checkPatternExport(exports,pat.value);}else if(type===\"AssignmentPattern\"){this.checkPatternExport(exports,pat.left);}else if(type===\"RestElement\"){this.checkPatternExport(exports,pat.argument);}else if(type===\"ParenthesizedExpression\"){this.checkPatternExport(exports,pat.expression);}};pp$1.checkVariableExport=function(exports,decls){if(!exports){return;}for(var i=0,list=decls;i<list.length;i+=1){var decl=list[i];this.checkPatternExport(exports,decl.id);}};pp$1.shouldParseExportStatement=function(){return this.type.keyword===\"var\"||this.type.keyword===\"const\"||this.type.keyword===\"class\"||this.type.keyword===\"function\"||this.isLet()||this.isAsyncFunction();};// Parses a comma-separated list of module exports.\npp$1.parseExportSpecifiers=function(exports){var nodes=[],first=true;// export { x, y as z } [from '...']\nthis.expect(types.braceL);while(!this.eat(types.braceR)){if(!first){this.expect(types.comma);if(this.afterTrailingComma(types.braceR)){break;}}else{first=false;}var node=this.startNode();node.local=this.parseIdent(true);node.exported=this.eatContextual(\"as\")?this.parseIdent(true):node.local;this.checkExport(exports,node.exported.name,node.exported.start);nodes.push(this.finishNode(node,\"ExportSpecifier\"));}return nodes;};// Parses import declaration.\npp$1.parseImport=function(node){this.next();// import '...'\nif(this.type===types.string){node.specifiers=empty;node.source=this.parseExprAtom();}else{node.specifiers=this.parseImportSpecifiers();this.expectContextual(\"from\");node.source=this.type===types.string?this.parseExprAtom():this.unexpected();}this.semicolon();return this.finishNode(node,\"ImportDeclaration\");};// Parses a comma-separated list of module imports.\npp$1.parseImportSpecifiers=function(){var nodes=[],first=true;if(this.type===types.name){// import defaultObj, { x, y as z } from '...'\nvar node=this.startNode();node.local=this.parseIdent();this.checkLValSimple(node.local,BIND_LEXICAL);nodes.push(this.finishNode(node,\"ImportDefaultSpecifier\"));if(!this.eat(types.comma)){return nodes;}}if(this.type===types.star){var node$1=this.startNode();this.next();this.expectContextual(\"as\");node$1.local=this.parseIdent();this.checkLValSimple(node$1.local,BIND_LEXICAL);nodes.push(this.finishNode(node$1,\"ImportNamespaceSpecifier\"));return nodes;}this.expect(types.braceL);while(!this.eat(types.braceR)){if(!first){this.expect(types.comma);if(this.afterTrailingComma(types.braceR)){break;}}else{first=false;}var node$2=this.startNode();node$2.imported=this.parseIdent(true);if(this.eatContextual(\"as\")){node$2.local=this.parseIdent();}else{this.checkUnreserved(node$2.imported);node$2.local=node$2.imported;}this.checkLValSimple(node$2.local,BIND_LEXICAL);nodes.push(this.finishNode(node$2,\"ImportSpecifier\"));}return nodes;};// Set `ExpressionStatement#directive` property for directive prologues.\npp$1.adaptDirectivePrologue=function(statements){for(var i=0;i<statements.length&&this.isDirectiveCandidate(statements[i]);++i){statements[i].directive=statements[i].expression.raw.slice(1,-1);}};pp$1.isDirectiveCandidate=function(statement){return statement.type===\"ExpressionStatement\"&&statement.expression.type===\"Literal\"&&typeof statement.expression.value===\"string\"&&(// Reject parenthesized strings.\nthis.input[statement.start]===\"\\\"\"||this.input[statement.start]===\"'\");};var pp$2=Parser.prototype;// Convert existing expression atom to assignable pattern\n// if possible.\npp$2.toAssignable=function(node,isBinding,refDestructuringErrors){if(this.options.ecmaVersion>=6&&node){switch(node.type){case\"Identifier\":if(this.inAsync&&node.name===\"await\"){this.raise(node.start,\"Cannot use 'await' as identifier inside an async function\");}break;case\"ObjectPattern\":case\"ArrayPattern\":case\"AssignmentPattern\":case\"RestElement\":break;case\"ObjectExpression\":node.type=\"ObjectPattern\";if(refDestructuringErrors){this.checkPatternErrors(refDestructuringErrors,true);}for(var i=0,list=node.properties;i<list.length;i+=1){var prop=list[i];this.toAssignable(prop,isBinding);// Early error:\n//   AssignmentRestProperty[Yield, Await] :\n//     `...` DestructuringAssignmentTarget[Yield, Await]\n//\n//   It is a Syntax Error if |DestructuringAssignmentTarget| is an |ArrayLiteral| or an |ObjectLiteral|.\nif(prop.type===\"RestElement\"&&(prop.argument.type===\"ArrayPattern\"||prop.argument.type===\"ObjectPattern\")){this.raise(prop.argument.start,\"Unexpected token\");}}break;case\"Property\":// AssignmentProperty has type === \"Property\"\nif(node.kind!==\"init\"){this.raise(node.key.start,\"Object pattern can't contain getter or setter\");}this.toAssignable(node.value,isBinding);break;case\"ArrayExpression\":node.type=\"ArrayPattern\";if(refDestructuringErrors){this.checkPatternErrors(refDestructuringErrors,true);}this.toAssignableList(node.elements,isBinding);break;case\"SpreadElement\":node.type=\"RestElement\";this.toAssignable(node.argument,isBinding);if(node.argument.type===\"AssignmentPattern\"){this.raise(node.argument.start,\"Rest elements cannot have a default value\");}break;case\"AssignmentExpression\":if(node.operator!==\"=\"){this.raise(node.left.end,\"Only '=' operator can be used for specifying default value.\");}node.type=\"AssignmentPattern\";delete node.operator;this.toAssignable(node.left,isBinding);break;case\"ParenthesizedExpression\":this.toAssignable(node.expression,isBinding,refDestructuringErrors);break;case\"ChainExpression\":this.raiseRecoverable(node.start,\"Optional chaining cannot appear in left-hand side\");break;case\"MemberExpression\":if(!isBinding){break;}default:this.raise(node.start,\"Assigning to rvalue\");}}else if(refDestructuringErrors){this.checkPatternErrors(refDestructuringErrors,true);}return node;};// Convert list of expression atoms to binding list.\npp$2.toAssignableList=function(exprList,isBinding){var end=exprList.length;for(var i=0;i<end;i++){var elt=exprList[i];if(elt){this.toAssignable(elt,isBinding);}}if(end){var last=exprList[end-1];if(this.options.ecmaVersion===6&&isBinding&&last&&last.type===\"RestElement\"&&last.argument.type!==\"Identifier\"){this.unexpected(last.argument.start);}}return exprList;};// Parses spread element.\npp$2.parseSpread=function(refDestructuringErrors){var node=this.startNode();this.next();node.argument=this.parseMaybeAssign(false,refDestructuringErrors);return this.finishNode(node,\"SpreadElement\");};pp$2.parseRestBinding=function(){var node=this.startNode();this.next();// RestElement inside of a function parameter must be an identifier\nif(this.options.ecmaVersion===6&&this.type!==types.name){this.unexpected();}node.argument=this.parseBindingAtom();return this.finishNode(node,\"RestElement\");};// Parses lvalue (assignable) atom.\npp$2.parseBindingAtom=function(){if(this.options.ecmaVersion>=6){switch(this.type){case types.bracketL:var node=this.startNode();this.next();node.elements=this.parseBindingList(types.bracketR,true,true);return this.finishNode(node,\"ArrayPattern\");case types.braceL:return this.parseObj(true);}}return this.parseIdent();};pp$2.parseBindingList=function(close,allowEmpty,allowTrailingComma){var elts=[],first=true;while(!this.eat(close)){if(first){first=false;}else{this.expect(types.comma);}if(allowEmpty&&this.type===types.comma){elts.push(null);}else if(allowTrailingComma&&this.afterTrailingComma(close)){break;}else if(this.type===types.ellipsis){var rest=this.parseRestBinding();this.parseBindingListItem(rest);elts.push(rest);if(this.type===types.comma){this.raise(this.start,\"Comma is not permitted after the rest element\");}this.expect(close);break;}else{var elem=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(elem);elts.push(elem);}}return elts;};pp$2.parseBindingListItem=function(param){return param;};// Parses assignment pattern around given atom if possible.\npp$2.parseMaybeDefault=function(startPos,startLoc,left){left=left||this.parseBindingAtom();if(this.options.ecmaVersion<6||!this.eat(types.eq)){return left;}var node=this.startNodeAt(startPos,startLoc);node.left=left;node.right=this.parseMaybeAssign();return this.finishNode(node,\"AssignmentPattern\");};// The following three functions all verify that a node is an lvalue —\n// something that can be bound, or assigned to. In order to do so, they perform\n// a variety of checks:\n//\n// - Check that none of the bound/assigned-to identifiers are reserved words.\n// - Record name declarations for bindings in the appropriate scope.\n// - Check duplicate argument names, if checkClashes is set.\n//\n// If a complex binding pattern is encountered (e.g., object and array\n// destructuring), the entire pattern is recursively checked.\n//\n// There are three versions of checkLVal*() appropriate for different\n// circumstances:\n//\n// - checkLValSimple() shall be used if the syntactic construct supports\n//   nothing other than identifiers and member expressions. Parenthesized\n//   expressions are also correctly handled. This is generally appropriate for\n//   constructs for which the spec says\n//\n//   > It is a Syntax Error if AssignmentTargetType of [the production] is not\n//   > simple.\n//\n//   It is also appropriate for checking if an identifier is valid and not\n//   defined elsewhere, like import declarations or function/class identifiers.\n//\n//   Examples where this is used include:\n//     a += …;\n//     import a from '…';\n//   where a is the node to be checked.\n//\n// - checkLValPattern() shall be used if the syntactic construct supports\n//   anything checkLValSimple() supports, as well as object and array\n//   destructuring patterns. This is generally appropriate for constructs for\n//   which the spec says\n//\n//   > It is a Syntax Error if [the production] is neither an ObjectLiteral nor\n//   > an ArrayLiteral and AssignmentTargetType of [the production] is not\n//   > simple.\n//\n//   Examples where this is used include:\n//     (a = …);\n//     const a = …;\n//     try { … } catch (a) { … }\n//   where a is the node to be checked.\n//\n// - checkLValInnerPattern() shall be used if the syntactic construct supports\n//   anything checkLValPattern() supports, as well as default assignment\n//   patterns, rest elements, and other constructs that may appear within an\n//   object or array destructuring pattern.\n//\n//   As a special case, function parameters also use checkLValInnerPattern(),\n//   as they also support defaults and rest constructs.\n//\n// These functions deliberately support both assignment and binding constructs,\n// as the logic for both is exceedingly similar. If the node is the target of\n// an assignment, then bindingType should be set to BIND_NONE. Otherwise, it\n// should be set to the appropriate BIND_* constant, like BIND_VAR or\n// BIND_LEXICAL.\n//\n// If the function is called with a non-BIND_NONE bindingType, then\n// additionally a checkClashes object may be specified to allow checking for\n// duplicate argument names. checkClashes is ignored if the provided construct\n// is an assignment (i.e., bindingType is BIND_NONE).\npp$2.checkLValSimple=function(expr,bindingType,checkClashes){if(bindingType===void 0)bindingType=BIND_NONE;var isBind=bindingType!==BIND_NONE;switch(expr.type){case\"Identifier\":if(this.strict&&this.reservedWordsStrictBind.test(expr.name)){this.raiseRecoverable(expr.start,(isBind?\"Binding \":\"Assigning to \")+expr.name+\" in strict mode\");}if(isBind){if(bindingType===BIND_LEXICAL&&expr.name===\"let\"){this.raiseRecoverable(expr.start,\"let is disallowed as a lexically bound name\");}if(checkClashes){if(has(checkClashes,expr.name)){this.raiseRecoverable(expr.start,\"Argument name clash\");}checkClashes[expr.name]=true;}if(bindingType!==BIND_OUTSIDE){this.declareName(expr.name,bindingType,expr.start);}}break;case\"ChainExpression\":this.raiseRecoverable(expr.start,\"Optional chaining cannot appear in left-hand side\");break;case\"MemberExpression\":if(isBind){this.raiseRecoverable(expr.start,\"Binding member expression\");}break;case\"ParenthesizedExpression\":if(isBind){this.raiseRecoverable(expr.start,\"Binding parenthesized expression\");}return this.checkLValSimple(expr.expression,bindingType,checkClashes);default:this.raise(expr.start,(isBind?\"Binding\":\"Assigning to\")+\" rvalue\");}};pp$2.checkLValPattern=function(expr,bindingType,checkClashes){if(bindingType===void 0)bindingType=BIND_NONE;switch(expr.type){case\"ObjectPattern\":for(var i=0,list=expr.properties;i<list.length;i+=1){var prop=list[i];this.checkLValInnerPattern(prop,bindingType,checkClashes);}break;case\"ArrayPattern\":for(var i$1=0,list$1=expr.elements;i$1<list$1.length;i$1+=1){var elem=list$1[i$1];if(elem){this.checkLValInnerPattern(elem,bindingType,checkClashes);}}break;default:this.checkLValSimple(expr,bindingType,checkClashes);}};pp$2.checkLValInnerPattern=function(expr,bindingType,checkClashes){if(bindingType===void 0)bindingType=BIND_NONE;switch(expr.type){case\"Property\":// AssignmentProperty has type === \"Property\"\nthis.checkLValInnerPattern(expr.value,bindingType,checkClashes);break;case\"AssignmentPattern\":this.checkLValPattern(expr.left,bindingType,checkClashes);break;case\"RestElement\":this.checkLValPattern(expr.argument,bindingType,checkClashes);break;default:this.checkLValPattern(expr,bindingType,checkClashes);}};// A recursive descent parser operates by defining functions for all\nvar pp$3=Parser.prototype;// Check if property name clashes with already added.\n// Object/class getters and setters are not allowed to clash —\n// either with each other or with an init property — and in\n// strict mode, init properties are also not allowed to be repeated.\npp$3.checkPropClash=function(prop,propHash,refDestructuringErrors){if(this.options.ecmaVersion>=9&&prop.type===\"SpreadElement\"){return;}if(this.options.ecmaVersion>=6&&(prop.computed||prop.method||prop.shorthand)){return;}var key=prop.key;var name;switch(key.type){case\"Identifier\":name=key.name;break;case\"Literal\":name=String(key.value);break;default:return;}var kind=prop.kind;if(this.options.ecmaVersion>=6){if(name===\"__proto__\"&&kind===\"init\"){if(propHash.proto){if(refDestructuringErrors){if(refDestructuringErrors.doubleProto<0){refDestructuringErrors.doubleProto=key.start;}// Backwards-compat kludge. Can be removed in version 6.0\n}else{this.raiseRecoverable(key.start,\"Redefinition of __proto__ property\");}}propHash.proto=true;}return;}name=\"$\"+name;var other=propHash[name];if(other){var redefinition;if(kind===\"init\"){redefinition=this.strict&&other.init||other.get||other.set;}else{redefinition=other.init||other[kind];}if(redefinition){this.raiseRecoverable(key.start,\"Redefinition of property\");}}else{other=propHash[name]={init:false,get:false,set:false};}other[kind]=true;};// ### Expression parsing\n// These nest, from the most general expression type at the top to\n// 'atomic', nondivisible expression types at the bottom. Most of\n// the functions will simply let the function(s) below them parse,\n// and, *if* the syntactic construct they handle is present, wrap\n// the AST node that the inner parser gave them in another node.\n// Parse a full expression. The optional arguments are used to\n// forbid the `in` operator (in for loops initalization expressions)\n// and provide reference for storing '=' operator inside shorthand\n// property assignment in contexts where both object expression\n// and object pattern might appear (so it's possible to raise\n// delayed syntax error at correct position).\npp$3.parseExpression=function(forInit,refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseMaybeAssign(forInit,refDestructuringErrors);if(this.type===types.comma){var node=this.startNodeAt(startPos,startLoc);node.expressions=[expr];while(this.eat(types.comma)){node.expressions.push(this.parseMaybeAssign(forInit,refDestructuringErrors));}return this.finishNode(node,\"SequenceExpression\");}return expr;};// Parse an assignment expression. This includes applications of\n// operators like `+=`.\npp$3.parseMaybeAssign=function(forInit,refDestructuringErrors,afterLeftParse){if(this.isContextual(\"yield\")){if(this.inGenerator){return this.parseYield(forInit);}// The tokenizer will assume an expression is allowed after\n// `yield`, but this isn't that kind of yield\nelse{this.exprAllowed=false;}}var ownDestructuringErrors=false,oldParenAssign=-1,oldTrailingComma=-1;if(refDestructuringErrors){oldParenAssign=refDestructuringErrors.parenthesizedAssign;oldTrailingComma=refDestructuringErrors.trailingComma;refDestructuringErrors.parenthesizedAssign=refDestructuringErrors.trailingComma=-1;}else{refDestructuringErrors=new DestructuringErrors();ownDestructuringErrors=true;}var startPos=this.start,startLoc=this.startLoc;if(this.type===types.parenL||this.type===types.name){this.potentialArrowAt=this.start;this.potentialArrowInForAwait=forInit===\"await\";}var left=this.parseMaybeConditional(forInit,refDestructuringErrors);if(afterLeftParse){left=afterLeftParse.call(this,left,startPos,startLoc);}if(this.type.isAssign){var node=this.startNodeAt(startPos,startLoc);node.operator=this.value;if(this.type===types.eq){left=this.toAssignable(left,false,refDestructuringErrors);}if(!ownDestructuringErrors){refDestructuringErrors.parenthesizedAssign=refDestructuringErrors.trailingComma=refDestructuringErrors.doubleProto=-1;}if(refDestructuringErrors.shorthandAssign>=left.start){refDestructuringErrors.shorthandAssign=-1;}// reset because shorthand default was used correctly\nif(this.type===types.eq){this.checkLValPattern(left);}else{this.checkLValSimple(left);}node.left=left;this.next();node.right=this.parseMaybeAssign(forInit);return this.finishNode(node,\"AssignmentExpression\");}else{if(ownDestructuringErrors){this.checkExpressionErrors(refDestructuringErrors,true);}}if(oldParenAssign>-1){refDestructuringErrors.parenthesizedAssign=oldParenAssign;}if(oldTrailingComma>-1){refDestructuringErrors.trailingComma=oldTrailingComma;}return left;};// Parse a ternary conditional (`?:`) operator.\npp$3.parseMaybeConditional=function(forInit,refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseExprOps(forInit,refDestructuringErrors);if(this.checkExpressionErrors(refDestructuringErrors)){return expr;}if(this.eat(types.question)){var node=this.startNodeAt(startPos,startLoc);node.test=expr;node.consequent=this.parseMaybeAssign();this.expect(types.colon);node.alternate=this.parseMaybeAssign(forInit);return this.finishNode(node,\"ConditionalExpression\");}return expr;};// Start the precedence parser.\npp$3.parseExprOps=function(forInit,refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseMaybeUnary(refDestructuringErrors,false);if(this.checkExpressionErrors(refDestructuringErrors)){return expr;}return expr.start===startPos&&expr.type===\"ArrowFunctionExpression\"?expr:this.parseExprOp(expr,startPos,startLoc,-1,forInit);};// Parse binary operators with the operator precedence parsing\n// algorithm. `left` is the left-hand side of the operator.\n// `minPrec` provides context that allows the function to stop and\n// defer further parser to one of its callers when it encounters an\n// operator that has a lower precedence than the set it is parsing.\npp$3.parseExprOp=function(left,leftStartPos,leftStartLoc,minPrec,forInit){var prec=this.type.binop;if(prec!=null&&(!forInit||this.type!==types._in)){if(prec>minPrec){var logical=this.type===types.logicalOR||this.type===types.logicalAND;var coalesce=this.type===types.coalesce;if(coalesce){// Handle the precedence of `tt.coalesce` as equal to the range of logical expressions.\n// In other words, `node.right` shouldn't contain logical expressions in order to check the mixed error.\nprec=types.logicalAND.binop;}var op=this.value;this.next();var startPos=this.start,startLoc=this.startLoc;var right=this.parseExprOp(this.parseMaybeUnary(null,false),startPos,startLoc,prec,forInit);var node=this.buildBinary(leftStartPos,leftStartLoc,left,right,op,logical||coalesce);if(logical&&this.type===types.coalesce||coalesce&&(this.type===types.logicalOR||this.type===types.logicalAND)){this.raiseRecoverable(this.start,\"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses\");}return this.parseExprOp(node,leftStartPos,leftStartLoc,minPrec,forInit);}}return left;};pp$3.buildBinary=function(startPos,startLoc,left,right,op,logical){var node=this.startNodeAt(startPos,startLoc);node.left=left;node.operator=op;node.right=right;return this.finishNode(node,logical?\"LogicalExpression\":\"BinaryExpression\");};// Parse unary operators, both prefix and postfix.\npp$3.parseMaybeUnary=function(refDestructuringErrors,sawUnary,incDec){var startPos=this.start,startLoc=this.startLoc,expr;if(this.isContextual(\"await\")&&this.canAwait){expr=this.parseAwait();sawUnary=true;}else if(this.type.prefix){var node=this.startNode(),update=this.type===types.incDec;node.operator=this.value;node.prefix=true;this.next();node.argument=this.parseMaybeUnary(null,true,update);this.checkExpressionErrors(refDestructuringErrors,true);if(update){this.checkLValSimple(node.argument);}else if(this.strict&&node.operator===\"delete\"&&node.argument.type===\"Identifier\"){this.raiseRecoverable(node.start,\"Deleting local variable in strict mode\");}else if(node.operator===\"delete\"&&isPrivateFieldAccess(node.argument)){this.raiseRecoverable(node.start,\"Private fields can not be deleted\");}else{sawUnary=true;}expr=this.finishNode(node,update?\"UpdateExpression\":\"UnaryExpression\");}else{expr=this.parseExprSubscripts(refDestructuringErrors);if(this.checkExpressionErrors(refDestructuringErrors)){return expr;}while(this.type.postfix&&!this.canInsertSemicolon()){var node$1=this.startNodeAt(startPos,startLoc);node$1.operator=this.value;node$1.prefix=false;node$1.argument=expr;this.checkLValSimple(expr);this.next();expr=this.finishNode(node$1,\"UpdateExpression\");}}if(!incDec&&this.eat(types.starstar)){if(sawUnary){this.unexpected(this.lastTokStart);}else{return this.buildBinary(startPos,startLoc,expr,this.parseMaybeUnary(null,false),\"**\",false);}}else{return expr;}};function isPrivateFieldAccess(node){return node.type===\"MemberExpression\"&&node.property.type===\"PrivateIdentifier\"||node.type===\"ChainExpression\"&&isPrivateFieldAccess(node.expression);}// Parse call, dot, and `[]`-subscript expressions.\npp$3.parseExprSubscripts=function(refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseExprAtom(refDestructuringErrors);if(expr.type===\"ArrowFunctionExpression\"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==\")\"){return expr;}var result=this.parseSubscripts(expr,startPos,startLoc);if(refDestructuringErrors&&result.type===\"MemberExpression\"){if(refDestructuringErrors.parenthesizedAssign>=result.start){refDestructuringErrors.parenthesizedAssign=-1;}if(refDestructuringErrors.parenthesizedBind>=result.start){refDestructuringErrors.parenthesizedBind=-1;}if(refDestructuringErrors.trailingComma>=result.start){refDestructuringErrors.trailingComma=-1;}}return result;};pp$3.parseSubscripts=function(base,startPos,startLoc,noCalls){var maybeAsyncArrow=this.options.ecmaVersion>=8&&base.type===\"Identifier\"&&base.name===\"async\"&&this.lastTokEnd===base.end&&!this.canInsertSemicolon()&&base.end-base.start===5&&this.potentialArrowAt===base.start;var optionalChained=false;while(true){var element=this.parseSubscript(base,startPos,startLoc,noCalls,maybeAsyncArrow,optionalChained);if(element.optional){optionalChained=true;}if(element===base||element.type===\"ArrowFunctionExpression\"){if(optionalChained){var chainNode=this.startNodeAt(startPos,startLoc);chainNode.expression=element;element=this.finishNode(chainNode,\"ChainExpression\");}return element;}base=element;}};pp$3.parseSubscript=function(base,startPos,startLoc,noCalls,maybeAsyncArrow,optionalChained){var optionalSupported=this.options.ecmaVersion>=11;var optional=optionalSupported&&this.eat(types.questionDot);if(noCalls&&optional){this.raise(this.lastTokStart,\"Optional chaining cannot appear in the callee of new expressions\");}var computed=this.eat(types.bracketL);if(computed||optional&&this.type!==types.parenL&&this.type!==types.backQuote||this.eat(types.dot)){var node=this.startNodeAt(startPos,startLoc);node.object=base;if(computed){node.property=this.parseExpression();this.expect(types.bracketR);}else if(this.type===types.privateId&&base.type!==\"Super\"){node.property=this.parsePrivateIdent();}else{node.property=this.parseIdent(this.options.allowReserved!==\"never\");}node.computed=!!computed;if(optionalSupported){node.optional=optional;}base=this.finishNode(node,\"MemberExpression\");}else if(!noCalls&&this.eat(types.parenL)){var refDestructuringErrors=new DestructuringErrors(),oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;var exprList=this.parseExprList(types.parenR,this.options.ecmaVersion>=8,false,refDestructuringErrors);if(maybeAsyncArrow&&!optional&&!this.canInsertSemicolon()&&this.eat(types.arrow)){this.checkPatternErrors(refDestructuringErrors,false);this.checkYieldAwaitInDefaultParams();if(this.awaitIdentPos>0){this.raise(this.awaitIdentPos,\"Cannot use 'await' as identifier inside an async function\");}this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),exprList,true);}this.checkExpressionErrors(refDestructuringErrors,true);this.yieldPos=oldYieldPos||this.yieldPos;this.awaitPos=oldAwaitPos||this.awaitPos;this.awaitIdentPos=oldAwaitIdentPos||this.awaitIdentPos;var node$1=this.startNodeAt(startPos,startLoc);node$1.callee=base;node$1.arguments=exprList;if(optionalSupported){node$1.optional=optional;}base=this.finishNode(node$1,\"CallExpression\");}else if(this.type===types.backQuote){if(optional||optionalChained){this.raise(this.start,\"Optional chaining cannot appear in the tag of tagged template expressions\");}var node$2=this.startNodeAt(startPos,startLoc);node$2.tag=base;node$2.quasi=this.parseTemplate({isTagged:true});base=this.finishNode(node$2,\"TaggedTemplateExpression\");}return base;};// Parse an atomic expression — either a single token that is an\n// expression, an expression started by a keyword like `function` or\n// `new`, or an expression wrapped in punctuation like `()`, `[]`,\n// or `{}`.\npp$3.parseExprAtom=function(refDestructuringErrors){// If a division operator appears in an expression position, the\n// tokenizer got confused, and we force it to read a regexp instead.\nif(this.type===types.slash){this.readRegexp();}var node,canBeArrow=this.potentialArrowAt===this.start;switch(this.type){case types._super:if(!this.allowSuper){this.raise(this.start,\"'super' keyword outside a method\");}node=this.startNode();this.next();if(this.type===types.parenL&&!this.allowDirectSuper){this.raise(node.start,\"super() call outside constructor of a subclass\");}// The `super` keyword can appear at below:\n// SuperProperty:\n//     super [ Expression ]\n//     super . IdentifierName\n// SuperCall:\n//     super ( Arguments )\nif(this.type!==types.dot&&this.type!==types.bracketL&&this.type!==types.parenL){this.unexpected();}return this.finishNode(node,\"Super\");case types._this:node=this.startNode();this.next();return this.finishNode(node,\"ThisExpression\");case types.name:var startPos=this.start,startLoc=this.startLoc,containsEsc=this.containsEsc;var id=this.parseIdent(false);if(this.options.ecmaVersion>=8&&!containsEsc&&id.name===\"async\"&&!this.canInsertSemicolon()&&this.eat(types._function)){return this.parseFunction(this.startNodeAt(startPos,startLoc),0,false,true);}if(canBeArrow&&!this.canInsertSemicolon()){if(this.eat(types.arrow)){return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),[id],false);}if(this.options.ecmaVersion>=8&&id.name===\"async\"&&this.type===types.name&&!containsEsc&&(!this.potentialArrowInForAwait||this.value!==\"of\"||this.containsEsc)){id=this.parseIdent(false);if(this.canInsertSemicolon()||!this.eat(types.arrow)){this.unexpected();}return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),[id],true);}}return id;case types.regexp:var value=this.value;node=this.parseLiteral(value.value);node.regex={pattern:value.pattern,flags:value.flags};return node;case types.num:case types.string:return this.parseLiteral(this.value);case types._null:case types._true:case types._false:node=this.startNode();node.value=this.type===types._null?null:this.type===types._true;node.raw=this.type.keyword;this.next();return this.finishNode(node,\"Literal\");case types.parenL:var start=this.start,expr=this.parseParenAndDistinguishExpression(canBeArrow);if(refDestructuringErrors){if(refDestructuringErrors.parenthesizedAssign<0&&!this.isSimpleAssignTarget(expr)){refDestructuringErrors.parenthesizedAssign=start;}if(refDestructuringErrors.parenthesizedBind<0){refDestructuringErrors.parenthesizedBind=start;}}return expr;case types.bracketL:node=this.startNode();this.next();node.elements=this.parseExprList(types.bracketR,true,true,refDestructuringErrors);return this.finishNode(node,\"ArrayExpression\");case types.braceL:return this.parseObj(false,refDestructuringErrors);case types._function:node=this.startNode();this.next();return this.parseFunction(node,0);case types._class:return this.parseClass(this.startNode(),false);case types._new:return this.parseNew();case types.backQuote:return this.parseTemplate();case types._import:if(this.options.ecmaVersion>=11){return this.parseExprImport();}else{return this.unexpected();}default:this.unexpected();}};pp$3.parseExprImport=function(){var node=this.startNode();// Consume `import` as an identifier for `import.meta`.\n// Because `this.parseIdent(true)` doesn't check escape sequences, it needs the check of `this.containsEsc`.\nif(this.containsEsc){this.raiseRecoverable(this.start,\"Escape sequence in keyword import\");}var meta=this.parseIdent(true);switch(this.type){case types.parenL:return this.parseDynamicImport(node);case types.dot:node.meta=meta;return this.parseImportMeta(node);default:this.unexpected();}};pp$3.parseDynamicImport=function(node){this.next();// skip `(`\n// Parse node.source.\nnode.source=this.parseMaybeAssign();// Verify ending.\nif(!this.eat(types.parenR)){var errorPos=this.start;if(this.eat(types.comma)&&this.eat(types.parenR)){this.raiseRecoverable(errorPos,\"Trailing comma is not allowed in import()\");}else{this.unexpected(errorPos);}}return this.finishNode(node,\"ImportExpression\");};pp$3.parseImportMeta=function(node){this.next();// skip `.`\nvar containsEsc=this.containsEsc;node.property=this.parseIdent(true);if(node.property.name!==\"meta\"){this.raiseRecoverable(node.property.start,\"The only valid meta property for import is 'import.meta'\");}if(containsEsc){this.raiseRecoverable(node.start,\"'import.meta' must not contain escaped characters\");}if(this.options.sourceType!==\"module\"&&!this.options.allowImportExportEverywhere){this.raiseRecoverable(node.start,\"Cannot use 'import.meta' outside a module\");}return this.finishNode(node,\"MetaProperty\");};pp$3.parseLiteral=function(value){var node=this.startNode();node.value=value;node.raw=this.input.slice(this.start,this.end);if(node.raw.charCodeAt(node.raw.length-1)===110){node.bigint=node.raw.slice(0,-1).replace(/_/g,\"\");}this.next();return this.finishNode(node,\"Literal\");};pp$3.parseParenExpression=function(){this.expect(types.parenL);var val=this.parseExpression();this.expect(types.parenR);return val;};pp$3.parseParenAndDistinguishExpression=function(canBeArrow){var startPos=this.start,startLoc=this.startLoc,val,allowTrailingComma=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var innerStartPos=this.start,innerStartLoc=this.startLoc;var exprList=[],first=true,lastIsComma=false;var refDestructuringErrors=new DestructuringErrors(),oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,spreadStart;this.yieldPos=0;this.awaitPos=0;// Do not save awaitIdentPos to allow checking awaits nested in parameters\nwhile(this.type!==types.parenR){first?first=false:this.expect(types.comma);if(allowTrailingComma&&this.afterTrailingComma(types.parenR,true)){lastIsComma=true;break;}else if(this.type===types.ellipsis){spreadStart=this.start;exprList.push(this.parseParenItem(this.parseRestBinding()));if(this.type===types.comma){this.raise(this.start,\"Comma is not permitted after the rest element\");}break;}else{exprList.push(this.parseMaybeAssign(false,refDestructuringErrors,this.parseParenItem));}}var innerEndPos=this.start,innerEndLoc=this.startLoc;this.expect(types.parenR);if(canBeArrow&&!this.canInsertSemicolon()&&this.eat(types.arrow)){this.checkPatternErrors(refDestructuringErrors,false);this.checkYieldAwaitInDefaultParams();this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;return this.parseParenArrowList(startPos,startLoc,exprList);}if(!exprList.length||lastIsComma){this.unexpected(this.lastTokStart);}if(spreadStart){this.unexpected(spreadStart);}this.checkExpressionErrors(refDestructuringErrors,true);this.yieldPos=oldYieldPos||this.yieldPos;this.awaitPos=oldAwaitPos||this.awaitPos;if(exprList.length>1){val=this.startNodeAt(innerStartPos,innerStartLoc);val.expressions=exprList;this.finishNodeAt(val,\"SequenceExpression\",innerEndPos,innerEndLoc);}else{val=exprList[0];}}else{val=this.parseParenExpression();}if(this.options.preserveParens){var par=this.startNodeAt(startPos,startLoc);par.expression=val;return this.finishNode(par,\"ParenthesizedExpression\");}else{return val;}};pp$3.parseParenItem=function(item){return item;};pp$3.parseParenArrowList=function(startPos,startLoc,exprList){return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),exprList);};// New's precedence is slightly tricky. It must allow its argument to\n// be a `[]` or dot subscript expression, but not a call — at least,\n// not without wrapping it in parentheses. Thus, it uses the noCalls\n// argument to parseSubscripts to prevent it from consuming the\n// argument list.\nvar empty$1=[];pp$3.parseNew=function(){if(this.containsEsc){this.raiseRecoverable(this.start,\"Escape sequence in keyword new\");}var node=this.startNode();var meta=this.parseIdent(true);if(this.options.ecmaVersion>=6&&this.eat(types.dot)){node.meta=meta;var containsEsc=this.containsEsc;node.property=this.parseIdent(true);if(node.property.name!==\"target\"){this.raiseRecoverable(node.property.start,\"The only valid meta property for new is 'new.target'\");}if(containsEsc){this.raiseRecoverable(node.start,\"'new.target' must not contain escaped characters\");}if(!this.inNonArrowFunction){this.raiseRecoverable(node.start,\"'new.target' can only be used in functions\");}return this.finishNode(node,\"MetaProperty\");}var startPos=this.start,startLoc=this.startLoc,isImport=this.type===types._import;node.callee=this.parseSubscripts(this.parseExprAtom(),startPos,startLoc,true);if(isImport&&node.callee.type===\"ImportExpression\"){this.raise(startPos,\"Cannot use new with import()\");}if(this.eat(types.parenL)){node.arguments=this.parseExprList(types.parenR,this.options.ecmaVersion>=8,false);}else{node.arguments=empty$1;}return this.finishNode(node,\"NewExpression\");};// Parse template expression.\npp$3.parseTemplateElement=function(ref){var isTagged=ref.isTagged;var elem=this.startNode();if(this.type===types.invalidTemplate){if(!isTagged){this.raiseRecoverable(this.start,\"Bad escape sequence in untagged template literal\");}elem.value={raw:this.value,cooked:null};}else{elem.value={raw:this.input.slice(this.start,this.end).replace(/\\r\\n?/g,\"\\n\"),cooked:this.value};}this.next();elem.tail=this.type===types.backQuote;return this.finishNode(elem,\"TemplateElement\");};pp$3.parseTemplate=function(ref){if(ref===void 0)ref={};var isTagged=ref.isTagged;if(isTagged===void 0)isTagged=false;var node=this.startNode();this.next();node.expressions=[];var curElt=this.parseTemplateElement({isTagged:isTagged});node.quasis=[curElt];while(!curElt.tail){if(this.type===types.eof){this.raise(this.pos,\"Unterminated template literal\");}this.expect(types.dollarBraceL);node.expressions.push(this.parseExpression());this.expect(types.braceR);node.quasis.push(curElt=this.parseTemplateElement({isTagged:isTagged}));}this.next();return this.finishNode(node,\"TemplateLiteral\");};pp$3.isAsyncProp=function(prop){return!prop.computed&&prop.key.type===\"Identifier\"&&prop.key.name===\"async\"&&(this.type===types.name||this.type===types.num||this.type===types.string||this.type===types.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===types.star)&&!lineBreak.test(this.input.slice(this.lastTokEnd,this.start));};// Parse an object literal or binding pattern.\npp$3.parseObj=function(isPattern,refDestructuringErrors){var node=this.startNode(),first=true,propHash={};node.properties=[];this.next();while(!this.eat(types.braceR)){if(!first){this.expect(types.comma);if(this.options.ecmaVersion>=5&&this.afterTrailingComma(types.braceR)){break;}}else{first=false;}var prop=this.parseProperty(isPattern,refDestructuringErrors);if(!isPattern){this.checkPropClash(prop,propHash,refDestructuringErrors);}node.properties.push(prop);}return this.finishNode(node,isPattern?\"ObjectPattern\":\"ObjectExpression\");};pp$3.parseProperty=function(isPattern,refDestructuringErrors){var prop=this.startNode(),isGenerator,isAsync,startPos,startLoc;if(this.options.ecmaVersion>=9&&this.eat(types.ellipsis)){if(isPattern){prop.argument=this.parseIdent(false);if(this.type===types.comma){this.raise(this.start,\"Comma is not permitted after the rest element\");}return this.finishNode(prop,\"RestElement\");}// To disallow parenthesized identifier via `this.toAssignable()`.\nif(this.type===types.parenL&&refDestructuringErrors){if(refDestructuringErrors.parenthesizedAssign<0){refDestructuringErrors.parenthesizedAssign=this.start;}if(refDestructuringErrors.parenthesizedBind<0){refDestructuringErrors.parenthesizedBind=this.start;}}// Parse argument.\nprop.argument=this.parseMaybeAssign(false,refDestructuringErrors);// To disallow trailing comma via `this.toAssignable()`.\nif(this.type===types.comma&&refDestructuringErrors&&refDestructuringErrors.trailingComma<0){refDestructuringErrors.trailingComma=this.start;}// Finish\nreturn this.finishNode(prop,\"SpreadElement\");}if(this.options.ecmaVersion>=6){prop.method=false;prop.shorthand=false;if(isPattern||refDestructuringErrors){startPos=this.start;startLoc=this.startLoc;}if(!isPattern){isGenerator=this.eat(types.star);}}var containsEsc=this.containsEsc;this.parsePropertyName(prop);if(!isPattern&&!containsEsc&&this.options.ecmaVersion>=8&&!isGenerator&&this.isAsyncProp(prop)){isAsync=true;isGenerator=this.options.ecmaVersion>=9&&this.eat(types.star);this.parsePropertyName(prop,refDestructuringErrors);}else{isAsync=false;}this.parsePropertyValue(prop,isPattern,isGenerator,isAsync,startPos,startLoc,refDestructuringErrors,containsEsc);return this.finishNode(prop,\"Property\");};pp$3.parsePropertyValue=function(prop,isPattern,isGenerator,isAsync,startPos,startLoc,refDestructuringErrors,containsEsc){if((isGenerator||isAsync)&&this.type===types.colon){this.unexpected();}if(this.eat(types.colon)){prop.value=isPattern?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(false,refDestructuringErrors);prop.kind=\"init\";}else if(this.options.ecmaVersion>=6&&this.type===types.parenL){if(isPattern){this.unexpected();}prop.kind=\"init\";prop.method=true;prop.value=this.parseMethod(isGenerator,isAsync);}else if(!isPattern&&!containsEsc&&this.options.ecmaVersion>=5&&!prop.computed&&prop.key.type===\"Identifier\"&&(prop.key.name===\"get\"||prop.key.name===\"set\")&&this.type!==types.comma&&this.type!==types.braceR&&this.type!==types.eq){if(isGenerator||isAsync){this.unexpected();}prop.kind=prop.key.name;this.parsePropertyName(prop);prop.value=this.parseMethod(false);var paramCount=prop.kind===\"get\"?0:1;if(prop.value.params.length!==paramCount){var start=prop.value.start;if(prop.kind===\"get\"){this.raiseRecoverable(start,\"getter should have no params\");}else{this.raiseRecoverable(start,\"setter should have exactly one param\");}}else{if(prop.kind===\"set\"&&prop.value.params[0].type===\"RestElement\"){this.raiseRecoverable(prop.value.params[0].start,\"Setter cannot use rest params\");}}}else if(this.options.ecmaVersion>=6&&!prop.computed&&prop.key.type===\"Identifier\"){if(isGenerator||isAsync){this.unexpected();}this.checkUnreserved(prop.key);if(prop.key.name===\"await\"&&!this.awaitIdentPos){this.awaitIdentPos=startPos;}prop.kind=\"init\";if(isPattern){prop.value=this.parseMaybeDefault(startPos,startLoc,this.copyNode(prop.key));}else if(this.type===types.eq&&refDestructuringErrors){if(refDestructuringErrors.shorthandAssign<0){refDestructuringErrors.shorthandAssign=this.start;}prop.value=this.parseMaybeDefault(startPos,startLoc,this.copyNode(prop.key));}else{prop.value=this.copyNode(prop.key);}prop.shorthand=true;}else{this.unexpected();}};pp$3.parsePropertyName=function(prop){if(this.options.ecmaVersion>=6){if(this.eat(types.bracketL)){prop.computed=true;prop.key=this.parseMaybeAssign();this.expect(types.bracketR);return prop.key;}else{prop.computed=false;}}return prop.key=this.type===types.num||this.type===types.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!==\"never\");};// Initialize empty function node.\npp$3.initFunction=function(node){node.id=null;if(this.options.ecmaVersion>=6){node.generator=node.expression=false;}if(this.options.ecmaVersion>=8){node.async=false;}};// Parse object or class method.\npp$3.parseMethod=function(isGenerator,isAsync,allowDirectSuper){var node=this.startNode(),oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.initFunction(node);if(this.options.ecmaVersion>=6){node.generator=isGenerator;}if(this.options.ecmaVersion>=8){node.async=!!isAsync;}this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;this.enterScope(functionFlags(isAsync,node.generator)|SCOPE_SUPER|(allowDirectSuper?SCOPE_DIRECT_SUPER:0));this.expect(types.parenL);node.params=this.parseBindingList(types.parenR,false,this.options.ecmaVersion>=8);this.checkYieldAwaitInDefaultParams();this.parseFunctionBody(node,false,true);this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.finishNode(node,\"FunctionExpression\");};// Parse arrow function expression with given parameters.\npp$3.parseArrowExpression=function(node,params,isAsync){var oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.enterScope(functionFlags(isAsync,false)|SCOPE_ARROW);this.initFunction(node);if(this.options.ecmaVersion>=8){node.async=!!isAsync;}this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;node.params=this.toAssignableList(params,true);this.parseFunctionBody(node,true,false);this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.finishNode(node,\"ArrowFunctionExpression\");};// Parse function body and check parameters.\npp$3.parseFunctionBody=function(node,isArrowFunction,isMethod){var isExpression=isArrowFunction&&this.type!==types.braceL;var oldStrict=this.strict,useStrict=false;if(isExpression){node.body=this.parseMaybeAssign();node.expression=true;this.checkParams(node,false);}else{var nonSimple=this.options.ecmaVersion>=7&&!this.isSimpleParamList(node.params);if(!oldStrict||nonSimple){useStrict=this.strictDirective(this.end);// If this is a strict mode function, verify that argument names\n// are not repeated, and it does not try to bind the words `eval`\n// or `arguments`.\nif(useStrict&&nonSimple){this.raiseRecoverable(node.start,\"Illegal 'use strict' directive in function with non-simple parameter list\");}}// Start a new scope with regard to labels and the `inFunction`\n// flag (restore them to their old value afterwards).\nvar oldLabels=this.labels;this.labels=[];if(useStrict){this.strict=true;}// Add the params to varDeclaredNames to ensure that an error is thrown\n// if a let/const declaration in the function clashes with one of the params.\nthis.checkParams(node,!oldStrict&&!useStrict&&!isArrowFunction&&!isMethod&&this.isSimpleParamList(node.params));// Ensure the function name isn't a forbidden identifier in strict mode, e.g. 'eval'\nif(this.strict&&node.id){this.checkLValSimple(node.id,BIND_OUTSIDE);}node.body=this.parseBlock(false,undefined,useStrict&&!oldStrict);node.expression=false;this.adaptDirectivePrologue(node.body.body);this.labels=oldLabels;}this.exitScope();};pp$3.isSimpleParamList=function(params){for(var i=0,list=params;i<list.length;i+=1){var param=list[i];if(param.type!==\"Identifier\"){return false;}}return true;};// Checks function params for various disallowed patterns such as using \"eval\"\n// or \"arguments\" and duplicate parameters.\npp$3.checkParams=function(node,allowDuplicates){var nameHash=Object.create(null);for(var i=0,list=node.params;i<list.length;i+=1){var param=list[i];this.checkLValInnerPattern(param,BIND_VAR,allowDuplicates?null:nameHash);}};// Parses a comma-separated list of expressions, and returns them as\n// an array. `close` is the token type that ends the list, and\n// `allowEmpty` can be turned on to allow subsequent commas with\n// nothing in between them to be parsed as `null` (which is needed\n// for array literals).\npp$3.parseExprList=function(close,allowTrailingComma,allowEmpty,refDestructuringErrors){var elts=[],first=true;while(!this.eat(close)){if(!first){this.expect(types.comma);if(allowTrailingComma&&this.afterTrailingComma(close)){break;}}else{first=false;}var elt=void 0;if(allowEmpty&&this.type===types.comma){elt=null;}else if(this.type===types.ellipsis){elt=this.parseSpread(refDestructuringErrors);if(refDestructuringErrors&&this.type===types.comma&&refDestructuringErrors.trailingComma<0){refDestructuringErrors.trailingComma=this.start;}}else{elt=this.parseMaybeAssign(false,refDestructuringErrors);}elts.push(elt);}return elts;};pp$3.checkUnreserved=function(ref){var start=ref.start;var end=ref.end;var name=ref.name;if(this.inGenerator&&name===\"yield\"){this.raiseRecoverable(start,\"Cannot use 'yield' as identifier inside a generator\");}if(this.inAsync&&name===\"await\"){this.raiseRecoverable(start,\"Cannot use 'await' as identifier inside an async function\");}if(this.currentThisScope().inClassFieldInit&&name===\"arguments\"){this.raiseRecoverable(start,\"Cannot use 'arguments' in class field initializer\");}if(this.keywords.test(name)){this.raise(start,\"Unexpected keyword '\"+name+\"'\");}if(this.options.ecmaVersion<6&&this.input.slice(start,end).indexOf(\"\\\\\")!==-1){return;}var re=this.strict?this.reservedWordsStrict:this.reservedWords;if(re.test(name)){if(!this.inAsync&&name===\"await\"){this.raiseRecoverable(start,\"Cannot use keyword 'await' outside an async function\");}this.raiseRecoverable(start,\"The keyword '\"+name+\"' is reserved\");}};// Parse the next token as an identifier. If `liberal` is true (used\n// when parsing properties), it will also convert keywords into\n// identifiers.\npp$3.parseIdent=function(liberal,isBinding){var node=this.startNode();if(this.type===types.name){node.name=this.value;}else if(this.type.keyword){node.name=this.type.keyword;// To fix https://github.com/acornjs/acorn/issues/575\n// `class` and `function` keywords push new context into this.context.\n// But there is no chance to pop the context if the keyword is consumed as an identifier such as a property name.\n// If the previous token is a dot, this does not apply because the context-managing code already ignored the keyword\nif((node.name===\"class\"||node.name===\"function\")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)){this.context.pop();}}else{this.unexpected();}this.next(!!liberal);this.finishNode(node,\"Identifier\");if(!liberal){this.checkUnreserved(node);if(node.name===\"await\"&&!this.awaitIdentPos){this.awaitIdentPos=node.start;}}return node;};pp$3.parsePrivateIdent=function(){var node=this.startNode();if(this.type===types.privateId){node.name=this.value;}else{this.unexpected();}this.next();this.finishNode(node,\"PrivateIdentifier\");// For validating existence\nif(this.privateNameStack.length===0){this.raise(node.start,\"Private field '#\"+node.name+\"' must be declared in an enclosing class\");}else{this.privateNameStack[this.privateNameStack.length-1].used.push(node);}return node;};// Parses yield expression inside generator.\npp$3.parseYield=function(forInit){if(!this.yieldPos){this.yieldPos=this.start;}var node=this.startNode();this.next();if(this.type===types.semi||this.canInsertSemicolon()||this.type!==types.star&&!this.type.startsExpr){node.delegate=false;node.argument=null;}else{node.delegate=this.eat(types.star);node.argument=this.parseMaybeAssign(forInit);}return this.finishNode(node,\"YieldExpression\");};pp$3.parseAwait=function(){if(!this.awaitPos){this.awaitPos=this.start;}var node=this.startNode();this.next();node.argument=this.parseMaybeUnary(null,true);return this.finishNode(node,\"AwaitExpression\");};var pp$4=Parser.prototype;// This function is used to raise exceptions on parse errors. It\n// takes an offset integer (into the current `input`) to indicate\n// the location of the error, attaches the position to the end\n// of the error message, and then raises a `SyntaxError` with that\n// message.\npp$4.raise=function(pos,message){var loc=getLineInfo(this.input,pos);message+=\" (\"+loc.line+\":\"+loc.column+\")\";var err=new SyntaxError(message);err.pos=pos;err.loc=loc;err.raisedAt=this.pos;throw err;};pp$4.raiseRecoverable=pp$4.raise;pp$4.curPosition=function(){if(this.options.locations){return new Position(this.curLine,this.pos-this.lineStart);}};var pp$5=Parser.prototype;var Scope=function Scope(flags){this.flags=flags;// A list of var-declared names in the current lexical scope\nthis.var=[];// A list of lexically-declared names in the current lexical scope\nthis.lexical=[];// A list of lexically-declared FunctionDeclaration names in the current lexical scope\nthis.functions=[];// A switch to disallow the identifier reference 'arguments'\nthis.inClassFieldInit=false;};// The functions in this module keep track of declared variables in the current scope in order to detect duplicate variable names.\npp$5.enterScope=function(flags){this.scopeStack.push(new Scope(flags));};pp$5.exitScope=function(){this.scopeStack.pop();};// The spec says:\n// > At the top level of a function, or script, function declarations are\n// > treated like var declarations rather than like lexical declarations.\npp$5.treatFunctionsAsVarInScope=function(scope){return scope.flags&SCOPE_FUNCTION||!this.inModule&&scope.flags&SCOPE_TOP;};pp$5.declareName=function(name,bindingType,pos){var redeclared=false;if(bindingType===BIND_LEXICAL){var scope=this.currentScope();redeclared=scope.lexical.indexOf(name)>-1||scope.functions.indexOf(name)>-1||scope.var.indexOf(name)>-1;scope.lexical.push(name);if(this.inModule&&scope.flags&SCOPE_TOP){delete this.undefinedExports[name];}}else if(bindingType===BIND_SIMPLE_CATCH){var scope$1=this.currentScope();scope$1.lexical.push(name);}else if(bindingType===BIND_FUNCTION){var scope$2=this.currentScope();if(this.treatFunctionsAsVar){redeclared=scope$2.lexical.indexOf(name)>-1;}else{redeclared=scope$2.lexical.indexOf(name)>-1||scope$2.var.indexOf(name)>-1;}scope$2.functions.push(name);}else{for(var i=this.scopeStack.length-1;i>=0;--i){var scope$3=this.scopeStack[i];if(scope$3.lexical.indexOf(name)>-1&&!(scope$3.flags&SCOPE_SIMPLE_CATCH&&scope$3.lexical[0]===name)||!this.treatFunctionsAsVarInScope(scope$3)&&scope$3.functions.indexOf(name)>-1){redeclared=true;break;}scope$3.var.push(name);if(this.inModule&&scope$3.flags&SCOPE_TOP){delete this.undefinedExports[name];}if(scope$3.flags&SCOPE_VAR){break;}}}if(redeclared){this.raiseRecoverable(pos,\"Identifier '\"+name+\"' has already been declared\");}};pp$5.checkLocalExport=function(id){// scope.functions must be empty as Module code is always strict.\nif(this.scopeStack[0].lexical.indexOf(id.name)===-1&&this.scopeStack[0].var.indexOf(id.name)===-1){this.undefinedExports[id.name]=id;}};pp$5.currentScope=function(){return this.scopeStack[this.scopeStack.length-1];};pp$5.currentVarScope=function(){for(var i=this.scopeStack.length-1;;i--){var scope=this.scopeStack[i];if(scope.flags&SCOPE_VAR){return scope;}}};// Could be useful for `this`, `new.target`, `super()`, `super.property`, and `super[property]`.\npp$5.currentThisScope=function(){for(var i=this.scopeStack.length-1;;i--){var scope=this.scopeStack[i];if(scope.flags&SCOPE_VAR&&!(scope.flags&SCOPE_ARROW)){return scope;}}};var Node=function Node(parser,pos,loc){this.type=\"\";this.start=pos;this.end=0;if(parser.options.locations){this.loc=new SourceLocation(parser,loc);}if(parser.options.directSourceFile){this.sourceFile=parser.options.directSourceFile;}if(parser.options.ranges){this.range=[pos,0];}};// Start an AST node, attaching a start offset.\nvar pp$6=Parser.prototype;pp$6.startNode=function(){return new Node(this,this.start,this.startLoc);};pp$6.startNodeAt=function(pos,loc){return new Node(this,pos,loc);};// Finish an AST node, adding `type` and `end` properties.\nfunction finishNodeAt(node,type,pos,loc){node.type=type;node.end=pos;if(this.options.locations){node.loc.end=loc;}if(this.options.ranges){node.range[1]=pos;}return node;}pp$6.finishNode=function(node,type){return finishNodeAt.call(this,node,type,this.lastTokEnd,this.lastTokEndLoc);};// Finish node at given position\npp$6.finishNodeAt=function(node,type,pos,loc){return finishNodeAt.call(this,node,type,pos,loc);};pp$6.copyNode=function(node){var newNode=new Node(this,node.start,this.startLoc);for(var prop in node){newNode[prop]=node[prop];}return newNode;};// The algorithm used to determine whether a regexp can appear at a\nvar TokContext=function TokContext(token,isExpr,preserveSpace,override,generator){this.token=token;this.isExpr=!!isExpr;this.preserveSpace=!!preserveSpace;this.override=override;this.generator=!!generator;};var types$1={b_stat:new TokContext(\"{\",false),b_expr:new TokContext(\"{\",true),b_tmpl:new TokContext(\"${\",false),p_stat:new TokContext(\"(\",false),p_expr:new TokContext(\"(\",true),q_tmpl:new TokContext(\"`\",true,true,function(p){return p.tryReadTemplateToken();}),f_stat:new TokContext(\"function\",false),f_expr:new TokContext(\"function\",true),f_expr_gen:new TokContext(\"function\",true,false,null,true),f_gen:new TokContext(\"function\",false,false,null,true)};var pp$7=Parser.prototype;pp$7.initialContext=function(){return[types$1.b_stat];};pp$7.braceIsBlock=function(prevType){var parent=this.curContext();if(parent===types$1.f_expr||parent===types$1.f_stat){return true;}if(prevType===types.colon&&(parent===types$1.b_stat||parent===types$1.b_expr)){return!parent.isExpr;}// The check for `tt.name && exprAllowed` detects whether we are\n// after a `yield` or `of` construct. See the `updateContext` for\n// `tt.name`.\nif(prevType===types._return||prevType===types.name&&this.exprAllowed){return lineBreak.test(this.input.slice(this.lastTokEnd,this.start));}if(prevType===types._else||prevType===types.semi||prevType===types.eof||prevType===types.parenR||prevType===types.arrow){return true;}if(prevType===types.braceL){return parent===types$1.b_stat;}if(prevType===types._var||prevType===types._const||prevType===types.name){return false;}return!this.exprAllowed;};pp$7.inGeneratorContext=function(){for(var i=this.context.length-1;i>=1;i--){var context=this.context[i];if(context.token===\"function\"){return context.generator;}}return false;};pp$7.updateContext=function(prevType){var update,type=this.type;if(type.keyword&&prevType===types.dot){this.exprAllowed=false;}else if(update=type.updateContext){update.call(this,prevType);}else{this.exprAllowed=type.beforeExpr;}};// Token-specific context update code\ntypes.parenR.updateContext=types.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=true;return;}var out=this.context.pop();if(out===types$1.b_stat&&this.curContext().token===\"function\"){out=this.context.pop();}this.exprAllowed=!out.isExpr;};types.braceL.updateContext=function(prevType){this.context.push(this.braceIsBlock(prevType)?types$1.b_stat:types$1.b_expr);this.exprAllowed=true;};types.dollarBraceL.updateContext=function(){this.context.push(types$1.b_tmpl);this.exprAllowed=true;};types.parenL.updateContext=function(prevType){var statementParens=prevType===types._if||prevType===types._for||prevType===types._with||prevType===types._while;this.context.push(statementParens?types$1.p_stat:types$1.p_expr);this.exprAllowed=true;};types.incDec.updateContext=function(){// tokExprAllowed stays unchanged\n};types._function.updateContext=types._class.updateContext=function(prevType){if(prevType.beforeExpr&&prevType!==types._else&&!(prevType===types.semi&&this.curContext()!==types$1.p_stat)&&!(prevType===types._return&&lineBreak.test(this.input.slice(this.lastTokEnd,this.start)))&&!((prevType===types.colon||prevType===types.braceL)&&this.curContext()===types$1.b_stat)){this.context.push(types$1.f_expr);}else{this.context.push(types$1.f_stat);}this.exprAllowed=false;};types.backQuote.updateContext=function(){if(this.curContext()===types$1.q_tmpl){this.context.pop();}else{this.context.push(types$1.q_tmpl);}this.exprAllowed=false;};types.star.updateContext=function(prevType){if(prevType===types._function){var index=this.context.length-1;if(this.context[index]===types$1.f_expr){this.context[index]=types$1.f_expr_gen;}else{this.context[index]=types$1.f_gen;}}this.exprAllowed=true;};types.name.updateContext=function(prevType){var allowed=false;if(this.options.ecmaVersion>=6&&prevType!==types.dot){if(this.value===\"of\"&&!this.exprAllowed||this.value===\"yield\"&&this.inGeneratorContext()){allowed=true;}}this.exprAllowed=allowed;};// This file contains Unicode properties extracted from the ECMAScript\n// specification. The lists are extracted like so:\n// $$('#table-binary-unicode-properties > figure > table > tbody > tr > td:nth-child(1) code').map(el => el.innerText)\n// #table-binary-unicode-properties\nvar ecma9BinaryProperties=\"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS\";var ecma10BinaryProperties=ecma9BinaryProperties+\" Extended_Pictographic\";var ecma11BinaryProperties=ecma10BinaryProperties;var ecma12BinaryProperties=ecma11BinaryProperties+\" EBase EComp EMod EPres ExtPict\";var unicodeBinaryProperties={9:ecma9BinaryProperties,10:ecma10BinaryProperties,11:ecma11BinaryProperties,12:ecma12BinaryProperties};// #table-unicode-general-category-values\nvar unicodeGeneralCategoryValues=\"Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu\";// #table-unicode-script-values\nvar ecma9ScriptValues=\"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb\";var ecma10ScriptValues=ecma9ScriptValues+\" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd\";var ecma11ScriptValues=ecma10ScriptValues+\" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho\";var ecma12ScriptValues=ecma11ScriptValues+\" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi\";var unicodeScriptValues={9:ecma9ScriptValues,10:ecma10ScriptValues,11:ecma11ScriptValues,12:ecma12ScriptValues};var data={};function buildUnicodeData(ecmaVersion){var d=data[ecmaVersion]={binary:wordsRegexp(unicodeBinaryProperties[ecmaVersion]+\" \"+unicodeGeneralCategoryValues),nonBinary:{General_Category:wordsRegexp(unicodeGeneralCategoryValues),Script:wordsRegexp(unicodeScriptValues[ecmaVersion])}};d.nonBinary.Script_Extensions=d.nonBinary.Script;d.nonBinary.gc=d.nonBinary.General_Category;d.nonBinary.sc=d.nonBinary.Script;d.nonBinary.scx=d.nonBinary.Script_Extensions;}buildUnicodeData(9);buildUnicodeData(10);buildUnicodeData(11);buildUnicodeData(12);var pp$8=Parser.prototype;var RegExpValidationState=function RegExpValidationState(parser){this.parser=parser;this.validFlags=\"gim\"+(parser.options.ecmaVersion>=6?\"uy\":\"\")+(parser.options.ecmaVersion>=9?\"s\":\"\")+(parser.options.ecmaVersion>=13?\"d\":\"\");this.unicodeProperties=data[parser.options.ecmaVersion>=12?12:parser.options.ecmaVersion];this.source=\"\";this.flags=\"\";this.start=0;this.switchU=false;this.switchN=false;this.pos=0;this.lastIntValue=0;this.lastStringValue=\"\";this.lastAssertionIsQuantifiable=false;this.numCapturingParens=0;this.maxBackReference=0;this.groupNames=[];this.backReferenceNames=[];};RegExpValidationState.prototype.reset=function reset(start,pattern,flags){var unicode=flags.indexOf(\"u\")!==-1;this.start=start|0;this.source=pattern+\"\";this.flags=flags;this.switchU=unicode&&this.parser.options.ecmaVersion>=6;this.switchN=unicode&&this.parser.options.ecmaVersion>=9;};RegExpValidationState.prototype.raise=function raise(message){this.parser.raiseRecoverable(this.start,\"Invalid regular expression: /\"+this.source+\"/: \"+message);};// If u flag is given, this returns the code point at the index (it combines a surrogate pair).\n// Otherwise, this returns the code unit of the index (can be a part of a surrogate pair).\nRegExpValidationState.prototype.at=function at(i,forceU){if(forceU===void 0)forceU=false;var s=this.source;var l=s.length;if(i>=l){return-1;}var c=s.charCodeAt(i);if(!(forceU||this.switchU)||c<=0xD7FF||c>=0xE000||i+1>=l){return c;}var next=s.charCodeAt(i+1);return next>=0xDC00&&next<=0xDFFF?(c<<10)+next-0x35FDC00:c;};RegExpValidationState.prototype.nextIndex=function nextIndex(i,forceU){if(forceU===void 0)forceU=false;var s=this.source;var l=s.length;if(i>=l){return l;}var c=s.charCodeAt(i),next;if(!(forceU||this.switchU)||c<=0xD7FF||c>=0xE000||i+1>=l||(next=s.charCodeAt(i+1))<0xDC00||next>0xDFFF){return i+1;}return i+2;};RegExpValidationState.prototype.current=function current(forceU){if(forceU===void 0)forceU=false;return this.at(this.pos,forceU);};RegExpValidationState.prototype.lookahead=function lookahead(forceU){if(forceU===void 0)forceU=false;return this.at(this.nextIndex(this.pos,forceU),forceU);};RegExpValidationState.prototype.advance=function advance(forceU){if(forceU===void 0)forceU=false;this.pos=this.nextIndex(this.pos,forceU);};RegExpValidationState.prototype.eat=function eat(ch,forceU){if(forceU===void 0)forceU=false;if(this.current(forceU)===ch){this.advance(forceU);return true;}return false;};function codePointToString(ch){if(ch<=0xFFFF){return String.fromCharCode(ch);}ch-=0x10000;return String.fromCharCode((ch>>10)+0xD800,(ch&0x03FF)+0xDC00);}/**\n * Validate the flags part of a given RegExpLiteral.\n *\n * @param {RegExpValidationState} state The state to validate RegExp.\n * @returns {void}\n */pp$8.validateRegExpFlags=function(state){var validFlags=state.validFlags;var flags=state.flags;for(var i=0;i<flags.length;i++){var flag=flags.charAt(i);if(validFlags.indexOf(flag)===-1){this.raise(state.start,\"Invalid regular expression flag\");}if(flags.indexOf(flag,i+1)>-1){this.raise(state.start,\"Duplicate regular expression flag\");}}};/**\n * Validate the pattern part of a given RegExpLiteral.\n *\n * @param {RegExpValidationState} state The state to validate RegExp.\n * @returns {void}\n */pp$8.validateRegExpPattern=function(state){this.regexp_pattern(state);// The goal symbol for the parse is |Pattern[~U, ~N]|. If the result of\n// parsing contains a |GroupName|, reparse with the goal symbol\n// |Pattern[~U, +N]| and use this result instead. Throw a *SyntaxError*\n// exception if _P_ did not conform to the grammar, if any elements of _P_\n// were not matched by the parse, or if any Early Error conditions exist.\nif(!state.switchN&&this.options.ecmaVersion>=9&&state.groupNames.length>0){state.switchN=true;this.regexp_pattern(state);}};// https://www.ecma-international.org/ecma-262/8.0/#prod-Pattern\npp$8.regexp_pattern=function(state){state.pos=0;state.lastIntValue=0;state.lastStringValue=\"\";state.lastAssertionIsQuantifiable=false;state.numCapturingParens=0;state.maxBackReference=0;state.groupNames.length=0;state.backReferenceNames.length=0;this.regexp_disjunction(state);if(state.pos!==state.source.length){// Make the same messages as V8.\nif(state.eat(0x29/* ) */)){state.raise(\"Unmatched ')'\");}if(state.eat(0x5D/* ] */)||state.eat(0x7D/* } */)){state.raise(\"Lone quantifier brackets\");}}if(state.maxBackReference>state.numCapturingParens){state.raise(\"Invalid escape\");}for(var i=0,list=state.backReferenceNames;i<list.length;i+=1){var name=list[i];if(state.groupNames.indexOf(name)===-1){state.raise(\"Invalid named capture referenced\");}}};// https://www.ecma-international.org/ecma-262/8.0/#prod-Disjunction\npp$8.regexp_disjunction=function(state){this.regexp_alternative(state);while(state.eat(0x7C/* | */)){this.regexp_alternative(state);}// Make the same message as V8.\nif(this.regexp_eatQuantifier(state,true)){state.raise(\"Nothing to repeat\");}if(state.eat(0x7B/* { */)){state.raise(\"Lone quantifier brackets\");}};// https://www.ecma-international.org/ecma-262/8.0/#prod-Alternative\npp$8.regexp_alternative=function(state){while(state.pos<state.source.length&&this.regexp_eatTerm(state)){}};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-Term\npp$8.regexp_eatTerm=function(state){if(this.regexp_eatAssertion(state)){// Handle `QuantifiableAssertion Quantifier` alternative.\n// `state.lastAssertionIsQuantifiable` is true if the last eaten Assertion\n// is a QuantifiableAssertion.\nif(state.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(state)){// Make the same message as V8.\nif(state.switchU){state.raise(\"Invalid quantifier\");}}return true;}if(state.switchU?this.regexp_eatAtom(state):this.regexp_eatExtendedAtom(state)){this.regexp_eatQuantifier(state);return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-Assertion\npp$8.regexp_eatAssertion=function(state){var start=state.pos;state.lastAssertionIsQuantifiable=false;// ^, $\nif(state.eat(0x5E/* ^ */)||state.eat(0x24/* $ */)){return true;}// \\b \\B\nif(state.eat(0x5C/* \\ */)){if(state.eat(0x42/* B */)||state.eat(0x62/* b */)){return true;}state.pos=start;}// Lookahead / Lookbehind\nif(state.eat(0x28/* ( */)&&state.eat(0x3F/* ? */)){var lookbehind=false;if(this.options.ecmaVersion>=9){lookbehind=state.eat(0x3C/* < */);}if(state.eat(0x3D/* = */)||state.eat(0x21/* ! */)){this.regexp_disjunction(state);if(!state.eat(0x29/* ) */)){state.raise(\"Unterminated group\");}state.lastAssertionIsQuantifiable=!lookbehind;return true;}}state.pos=start;return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-Quantifier\npp$8.regexp_eatQuantifier=function(state,noError){if(noError===void 0)noError=false;if(this.regexp_eatQuantifierPrefix(state,noError)){state.eat(0x3F/* ? */);return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-QuantifierPrefix\npp$8.regexp_eatQuantifierPrefix=function(state,noError){return state.eat(0x2A/* * */)||state.eat(0x2B/* + */)||state.eat(0x3F/* ? */)||this.regexp_eatBracedQuantifier(state,noError);};pp$8.regexp_eatBracedQuantifier=function(state,noError){var start=state.pos;if(state.eat(0x7B/* { */)){var min=0,max=-1;if(this.regexp_eatDecimalDigits(state)){min=state.lastIntValue;if(state.eat(0x2C/* , */)&&this.regexp_eatDecimalDigits(state)){max=state.lastIntValue;}if(state.eat(0x7D/* } */)){// SyntaxError in https://www.ecma-international.org/ecma-262/8.0/#sec-term\nif(max!==-1&&max<min&&!noError){state.raise(\"numbers out of order in {} quantifier\");}return true;}}if(state.switchU&&!noError){state.raise(\"Incomplete quantifier\");}state.pos=start;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-Atom\npp$8.regexp_eatAtom=function(state){return this.regexp_eatPatternCharacters(state)||state.eat(0x2E/* . */)||this.regexp_eatReverseSolidusAtomEscape(state)||this.regexp_eatCharacterClass(state)||this.regexp_eatUncapturingGroup(state)||this.regexp_eatCapturingGroup(state);};pp$8.regexp_eatReverseSolidusAtomEscape=function(state){var start=state.pos;if(state.eat(0x5C/* \\ */)){if(this.regexp_eatAtomEscape(state)){return true;}state.pos=start;}return false;};pp$8.regexp_eatUncapturingGroup=function(state){var start=state.pos;if(state.eat(0x28/* ( */)){if(state.eat(0x3F/* ? */)&&state.eat(0x3A/* : */)){this.regexp_disjunction(state);if(state.eat(0x29/* ) */)){return true;}state.raise(\"Unterminated group\");}state.pos=start;}return false;};pp$8.regexp_eatCapturingGroup=function(state){if(state.eat(0x28/* ( */)){if(this.options.ecmaVersion>=9){this.regexp_groupSpecifier(state);}else if(state.current()===0x3F/* ? */){state.raise(\"Invalid group\");}this.regexp_disjunction(state);if(state.eat(0x29/* ) */)){state.numCapturingParens+=1;return true;}state.raise(\"Unterminated group\");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ExtendedAtom\npp$8.regexp_eatExtendedAtom=function(state){return state.eat(0x2E/* . */)||this.regexp_eatReverseSolidusAtomEscape(state)||this.regexp_eatCharacterClass(state)||this.regexp_eatUncapturingGroup(state)||this.regexp_eatCapturingGroup(state)||this.regexp_eatInvalidBracedQuantifier(state)||this.regexp_eatExtendedPatternCharacter(state);};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-InvalidBracedQuantifier\npp$8.regexp_eatInvalidBracedQuantifier=function(state){if(this.regexp_eatBracedQuantifier(state,true)){state.raise(\"Nothing to repeat\");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-SyntaxCharacter\npp$8.regexp_eatSyntaxCharacter=function(state){var ch=state.current();if(isSyntaxCharacter(ch)){state.lastIntValue=ch;state.advance();return true;}return false;};function isSyntaxCharacter(ch){return ch===0x24/* $ */||ch>=0x28/* ( */&&ch<=0x2B/* + */||ch===0x2E/* . */||ch===0x3F/* ? */||ch>=0x5B/* [ */&&ch<=0x5E/* ^ */||ch>=0x7B/* { */&&ch<=0x7D/* } */;}// https://www.ecma-international.org/ecma-262/8.0/#prod-PatternCharacter\n// But eat eager.\npp$8.regexp_eatPatternCharacters=function(state){var start=state.pos;var ch=0;while((ch=state.current())!==-1&&!isSyntaxCharacter(ch)){state.advance();}return state.pos!==start;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ExtendedPatternCharacter\npp$8.regexp_eatExtendedPatternCharacter=function(state){var ch=state.current();if(ch!==-1&&ch!==0x24/* $ */&&!(ch>=0x28/* ( */&&ch<=0x2B/* + */)&&ch!==0x2E/* . */&&ch!==0x3F/* ? */&&ch!==0x5B/* [ */&&ch!==0x5E/* ^ */&&ch!==0x7C/* | */){state.advance();return true;}return false;};// GroupSpecifier ::\n//   [empty]\n//   `?` GroupName\npp$8.regexp_groupSpecifier=function(state){if(state.eat(0x3F/* ? */)){if(this.regexp_eatGroupName(state)){if(state.groupNames.indexOf(state.lastStringValue)!==-1){state.raise(\"Duplicate capture group name\");}state.groupNames.push(state.lastStringValue);return;}state.raise(\"Invalid group\");}};// GroupName ::\n//   `<` RegExpIdentifierName `>`\n// Note: this updates `state.lastStringValue` property with the eaten name.\npp$8.regexp_eatGroupName=function(state){state.lastStringValue=\"\";if(state.eat(0x3C/* < */)){if(this.regexp_eatRegExpIdentifierName(state)&&state.eat(0x3E/* > */)){return true;}state.raise(\"Invalid capture group name\");}return false;};// RegExpIdentifierName ::\n//   RegExpIdentifierStart\n//   RegExpIdentifierName RegExpIdentifierPart\n// Note: this updates `state.lastStringValue` property with the eaten name.\npp$8.regexp_eatRegExpIdentifierName=function(state){state.lastStringValue=\"\";if(this.regexp_eatRegExpIdentifierStart(state)){state.lastStringValue+=codePointToString(state.lastIntValue);while(this.regexp_eatRegExpIdentifierPart(state)){state.lastStringValue+=codePointToString(state.lastIntValue);}return true;}return false;};// RegExpIdentifierStart ::\n//   UnicodeIDStart\n//   `$`\n//   `_`\n//   `\\` RegExpUnicodeEscapeSequence[+U]\npp$8.regexp_eatRegExpIdentifierStart=function(state){var start=state.pos;var forceU=this.options.ecmaVersion>=11;var ch=state.current(forceU);state.advance(forceU);if(ch===0x5C/* \\ */&&this.regexp_eatRegExpUnicodeEscapeSequence(state,forceU)){ch=state.lastIntValue;}if(isRegExpIdentifierStart(ch)){state.lastIntValue=ch;return true;}state.pos=start;return false;};function isRegExpIdentifierStart(ch){return isIdentifierStart(ch,true)||ch===0x24/* $ */||ch===0x5F;/* _ */}// RegExpIdentifierPart ::\n//   UnicodeIDContinue\n//   `$`\n//   `_`\n//   `\\` RegExpUnicodeEscapeSequence[+U]\n//   <ZWNJ>\n//   <ZWJ>\npp$8.regexp_eatRegExpIdentifierPart=function(state){var start=state.pos;var forceU=this.options.ecmaVersion>=11;var ch=state.current(forceU);state.advance(forceU);if(ch===0x5C/* \\ */&&this.regexp_eatRegExpUnicodeEscapeSequence(state,forceU)){ch=state.lastIntValue;}if(isRegExpIdentifierPart(ch)){state.lastIntValue=ch;return true;}state.pos=start;return false;};function isRegExpIdentifierPart(ch){return isIdentifierChar(ch,true)||ch===0x24/* $ */||ch===0x5F/* _ */||ch===0x200C/* <ZWNJ> */||ch===0x200D;/* <ZWJ> */}// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-AtomEscape\npp$8.regexp_eatAtomEscape=function(state){if(this.regexp_eatBackReference(state)||this.regexp_eatCharacterClassEscape(state)||this.regexp_eatCharacterEscape(state)||state.switchN&&this.regexp_eatKGroupName(state)){return true;}if(state.switchU){// Make the same message as V8.\nif(state.current()===0x63/* c */){state.raise(\"Invalid unicode escape\");}state.raise(\"Invalid escape\");}return false;};pp$8.regexp_eatBackReference=function(state){var start=state.pos;if(this.regexp_eatDecimalEscape(state)){var n=state.lastIntValue;if(state.switchU){// For SyntaxError in https://www.ecma-international.org/ecma-262/8.0/#sec-atomescape\nif(n>state.maxBackReference){state.maxBackReference=n;}return true;}if(n<=state.numCapturingParens){return true;}state.pos=start;}return false;};pp$8.regexp_eatKGroupName=function(state){if(state.eat(0x6B/* k */)){if(this.regexp_eatGroupName(state)){state.backReferenceNames.push(state.lastStringValue);return true;}state.raise(\"Invalid named reference\");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-CharacterEscape\npp$8.regexp_eatCharacterEscape=function(state){return this.regexp_eatControlEscape(state)||this.regexp_eatCControlLetter(state)||this.regexp_eatZero(state)||this.regexp_eatHexEscapeSequence(state)||this.regexp_eatRegExpUnicodeEscapeSequence(state,false)||!state.switchU&&this.regexp_eatLegacyOctalEscapeSequence(state)||this.regexp_eatIdentityEscape(state);};pp$8.regexp_eatCControlLetter=function(state){var start=state.pos;if(state.eat(0x63/* c */)){if(this.regexp_eatControlLetter(state)){return true;}state.pos=start;}return false;};pp$8.regexp_eatZero=function(state){if(state.current()===0x30/* 0 */&&!isDecimalDigit(state.lookahead())){state.lastIntValue=0;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-ControlEscape\npp$8.regexp_eatControlEscape=function(state){var ch=state.current();if(ch===0x74/* t */){state.lastIntValue=0x09;/* \\t */state.advance();return true;}if(ch===0x6E/* n */){state.lastIntValue=0x0A;/* \\n */state.advance();return true;}if(ch===0x76/* v */){state.lastIntValue=0x0B;/* \\v */state.advance();return true;}if(ch===0x66/* f */){state.lastIntValue=0x0C;/* \\f */state.advance();return true;}if(ch===0x72/* r */){state.lastIntValue=0x0D;/* \\r */state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-ControlLetter\npp$8.regexp_eatControlLetter=function(state){var ch=state.current();if(isControlLetter(ch)){state.lastIntValue=ch%0x20;state.advance();return true;}return false;};function isControlLetter(ch){return ch>=0x41/* A */&&ch<=0x5A/* Z */||ch>=0x61/* a */&&ch<=0x7A/* z */;}// https://www.ecma-international.org/ecma-262/8.0/#prod-RegExpUnicodeEscapeSequence\npp$8.regexp_eatRegExpUnicodeEscapeSequence=function(state,forceU){if(forceU===void 0)forceU=false;var start=state.pos;var switchU=forceU||state.switchU;if(state.eat(0x75/* u */)){if(this.regexp_eatFixedHexDigits(state,4)){var lead=state.lastIntValue;if(switchU&&lead>=0xD800&&lead<=0xDBFF){var leadSurrogateEnd=state.pos;if(state.eat(0x5C/* \\ */)&&state.eat(0x75/* u */)&&this.regexp_eatFixedHexDigits(state,4)){var trail=state.lastIntValue;if(trail>=0xDC00&&trail<=0xDFFF){state.lastIntValue=(lead-0xD800)*0x400+(trail-0xDC00)+0x10000;return true;}}state.pos=leadSurrogateEnd;state.lastIntValue=lead;}return true;}if(switchU&&state.eat(0x7B/* { */)&&this.regexp_eatHexDigits(state)&&state.eat(0x7D/* } */)&&isValidUnicode(state.lastIntValue)){return true;}if(switchU){state.raise(\"Invalid unicode escape\");}state.pos=start;}return false;};function isValidUnicode(ch){return ch>=0&&ch<=0x10FFFF;}// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-IdentityEscape\npp$8.regexp_eatIdentityEscape=function(state){if(state.switchU){if(this.regexp_eatSyntaxCharacter(state)){return true;}if(state.eat(0x2F/* / */)){state.lastIntValue=0x2F;/* / */return true;}return false;}var ch=state.current();if(ch!==0x63/* c */&&(!state.switchN||ch!==0x6B/* k */)){state.lastIntValue=ch;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-DecimalEscape\npp$8.regexp_eatDecimalEscape=function(state){state.lastIntValue=0;var ch=state.current();if(ch>=0x31/* 1 */&&ch<=0x39/* 9 */){do{state.lastIntValue=10*state.lastIntValue+(ch-0x30/* 0 */);state.advance();}while((ch=state.current())>=0x30/* 0 */&&ch<=0x39/* 9 */);return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-CharacterClassEscape\npp$8.regexp_eatCharacterClassEscape=function(state){var ch=state.current();if(isCharacterClassEscape(ch)){state.lastIntValue=-1;state.advance();return true;}if(state.switchU&&this.options.ecmaVersion>=9&&(ch===0x50/* P */||ch===0x70/* p */)){state.lastIntValue=-1;state.advance();if(state.eat(0x7B/* { */)&&this.regexp_eatUnicodePropertyValueExpression(state)&&state.eat(0x7D/* } */)){return true;}state.raise(\"Invalid property name\");}return false;};function isCharacterClassEscape(ch){return ch===0x64/* d */||ch===0x44/* D */||ch===0x73/* s */||ch===0x53/* S */||ch===0x77/* w */||ch===0x57/* W */;}// UnicodePropertyValueExpression ::\n//   UnicodePropertyName `=` UnicodePropertyValue\n//   LoneUnicodePropertyNameOrValue\npp$8.regexp_eatUnicodePropertyValueExpression=function(state){var start=state.pos;// UnicodePropertyName `=` UnicodePropertyValue\nif(this.regexp_eatUnicodePropertyName(state)&&state.eat(0x3D/* = */)){var name=state.lastStringValue;if(this.regexp_eatUnicodePropertyValue(state)){var value=state.lastStringValue;this.regexp_validateUnicodePropertyNameAndValue(state,name,value);return true;}}state.pos=start;// LoneUnicodePropertyNameOrValue\nif(this.regexp_eatLoneUnicodePropertyNameOrValue(state)){var nameOrValue=state.lastStringValue;this.regexp_validateUnicodePropertyNameOrValue(state,nameOrValue);return true;}return false;};pp$8.regexp_validateUnicodePropertyNameAndValue=function(state,name,value){if(!has(state.unicodeProperties.nonBinary,name)){state.raise(\"Invalid property name\");}if(!state.unicodeProperties.nonBinary[name].test(value)){state.raise(\"Invalid property value\");}};pp$8.regexp_validateUnicodePropertyNameOrValue=function(state,nameOrValue){if(!state.unicodeProperties.binary.test(nameOrValue)){state.raise(\"Invalid property name\");}};// UnicodePropertyName ::\n//   UnicodePropertyNameCharacters\npp$8.regexp_eatUnicodePropertyName=function(state){var ch=0;state.lastStringValue=\"\";while(isUnicodePropertyNameCharacter(ch=state.current())){state.lastStringValue+=codePointToString(ch);state.advance();}return state.lastStringValue!==\"\";};function isUnicodePropertyNameCharacter(ch){return isControlLetter(ch)||ch===0x5F;/* _ */}// UnicodePropertyValue ::\n//   UnicodePropertyValueCharacters\npp$8.regexp_eatUnicodePropertyValue=function(state){var ch=0;state.lastStringValue=\"\";while(isUnicodePropertyValueCharacter(ch=state.current())){state.lastStringValue+=codePointToString(ch);state.advance();}return state.lastStringValue!==\"\";};function isUnicodePropertyValueCharacter(ch){return isUnicodePropertyNameCharacter(ch)||isDecimalDigit(ch);}// LoneUnicodePropertyNameOrValue ::\n//   UnicodePropertyValueCharacters\npp$8.regexp_eatLoneUnicodePropertyNameOrValue=function(state){return this.regexp_eatUnicodePropertyValue(state);};// https://www.ecma-international.org/ecma-262/8.0/#prod-CharacterClass\npp$8.regexp_eatCharacterClass=function(state){if(state.eat(0x5B/* [ */)){state.eat(0x5E/* ^ */);this.regexp_classRanges(state);if(state.eat(0x5D/* ] */)){return true;}// Unreachable since it threw \"unterminated regular expression\" error before.\nstate.raise(\"Unterminated character class\");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-ClassRanges\n// https://www.ecma-international.org/ecma-262/8.0/#prod-NonemptyClassRanges\n// https://www.ecma-international.org/ecma-262/8.0/#prod-NonemptyClassRangesNoDash\npp$8.regexp_classRanges=function(state){while(this.regexp_eatClassAtom(state)){var left=state.lastIntValue;if(state.eat(0x2D/* - */)&&this.regexp_eatClassAtom(state)){var right=state.lastIntValue;if(state.switchU&&(left===-1||right===-1)){state.raise(\"Invalid character class\");}if(left!==-1&&right!==-1&&left>right){state.raise(\"Range out of order in character class\");}}}};// https://www.ecma-international.org/ecma-262/8.0/#prod-ClassAtom\n// https://www.ecma-international.org/ecma-262/8.0/#prod-ClassAtomNoDash\npp$8.regexp_eatClassAtom=function(state){var start=state.pos;if(state.eat(0x5C/* \\ */)){if(this.regexp_eatClassEscape(state)){return true;}if(state.switchU){// Make the same message as V8.\nvar ch$1=state.current();if(ch$1===0x63/* c */||isOctalDigit(ch$1)){state.raise(\"Invalid class escape\");}state.raise(\"Invalid escape\");}state.pos=start;}var ch=state.current();if(ch!==0x5D/* ] */){state.lastIntValue=ch;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ClassEscape\npp$8.regexp_eatClassEscape=function(state){var start=state.pos;if(state.eat(0x62/* b */)){state.lastIntValue=0x08;/* <BS> */return true;}if(state.switchU&&state.eat(0x2D/* - */)){state.lastIntValue=0x2D;/* - */return true;}if(!state.switchU&&state.eat(0x63/* c */)){if(this.regexp_eatClassControlLetter(state)){return true;}state.pos=start;}return this.regexp_eatCharacterClassEscape(state)||this.regexp_eatCharacterEscape(state);};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ClassControlLetter\npp$8.regexp_eatClassControlLetter=function(state){var ch=state.current();if(isDecimalDigit(ch)||ch===0x5F/* _ */){state.lastIntValue=ch%0x20;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-HexEscapeSequence\npp$8.regexp_eatHexEscapeSequence=function(state){var start=state.pos;if(state.eat(0x78/* x */)){if(this.regexp_eatFixedHexDigits(state,2)){return true;}if(state.switchU){state.raise(\"Invalid escape\");}state.pos=start;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-DecimalDigits\npp$8.regexp_eatDecimalDigits=function(state){var start=state.pos;var ch=0;state.lastIntValue=0;while(isDecimalDigit(ch=state.current())){state.lastIntValue=10*state.lastIntValue+(ch-0x30/* 0 */);state.advance();}return state.pos!==start;};function isDecimalDigit(ch){return ch>=0x30/* 0 */&&ch<=0x39;/* 9 */}// https://www.ecma-international.org/ecma-262/8.0/#prod-HexDigits\npp$8.regexp_eatHexDigits=function(state){var start=state.pos;var ch=0;state.lastIntValue=0;while(isHexDigit(ch=state.current())){state.lastIntValue=16*state.lastIntValue+hexToInt(ch);state.advance();}return state.pos!==start;};function isHexDigit(ch){return ch>=0x30/* 0 */&&ch<=0x39/* 9 */||ch>=0x41/* A */&&ch<=0x46/* F */||ch>=0x61/* a */&&ch<=0x66/* f */;}function hexToInt(ch){if(ch>=0x41/* A */&&ch<=0x46/* F */){return 10+(ch-0x41/* A */);}if(ch>=0x61/* a */&&ch<=0x66/* f */){return 10+(ch-0x61/* a */);}return ch-0x30;/* 0 */}// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-LegacyOctalEscapeSequence\n// Allows only 0-377(octal) i.e. 0-255(decimal).\npp$8.regexp_eatLegacyOctalEscapeSequence=function(state){if(this.regexp_eatOctalDigit(state)){var n1=state.lastIntValue;if(this.regexp_eatOctalDigit(state)){var n2=state.lastIntValue;if(n1<=3&&this.regexp_eatOctalDigit(state)){state.lastIntValue=n1*64+n2*8+state.lastIntValue;}else{state.lastIntValue=n1*8+n2;}}else{state.lastIntValue=n1;}return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-OctalDigit\npp$8.regexp_eatOctalDigit=function(state){var ch=state.current();if(isOctalDigit(ch)){state.lastIntValue=ch-0x30;/* 0 */state.advance();return true;}state.lastIntValue=0;return false;};function isOctalDigit(ch){return ch>=0x30/* 0 */&&ch<=0x37;/* 7 */}// https://www.ecma-international.org/ecma-262/8.0/#prod-Hex4Digits\n// https://www.ecma-international.org/ecma-262/8.0/#prod-HexDigit\n// And HexDigit HexDigit in https://www.ecma-international.org/ecma-262/8.0/#prod-HexEscapeSequence\npp$8.regexp_eatFixedHexDigits=function(state,length){var start=state.pos;state.lastIntValue=0;for(var i=0;i<length;++i){var ch=state.current();if(!isHexDigit(ch)){state.pos=start;return false;}state.lastIntValue=16*state.lastIntValue+hexToInt(ch);state.advance();}return true;};// Object type used to represent tokens. Note that normally, tokens\n// simply exist as properties on the parser object. This is only\n// used for the onToken callback and the external tokenizer.\nvar Token=function Token(p){this.type=p.type;this.value=p.value;this.start=p.start;this.end=p.end;if(p.options.locations){this.loc=new SourceLocation(p,p.startLoc,p.endLoc);}if(p.options.ranges){this.range=[p.start,p.end];}};// ## Tokenizer\nvar pp$9=Parser.prototype;// Move to the next token\npp$9.next=function(ignoreEscapeSequenceInKeyword){if(!ignoreEscapeSequenceInKeyword&&this.type.keyword&&this.containsEsc){this.raiseRecoverable(this.start,\"Escape sequence in keyword \"+this.type.keyword);}if(this.options.onToken){this.options.onToken(new Token(this));}this.lastTokEnd=this.end;this.lastTokStart=this.start;this.lastTokEndLoc=this.endLoc;this.lastTokStartLoc=this.startLoc;this.nextToken();};pp$9.getToken=function(){this.next();return new Token(this);};// If we're in an ES6 environment, make parsers iterable\nif(typeof Symbol!==\"undefined\"){pp$9[Symbol.iterator]=function(){var this$1=this;return{next:function next(){var token=this$1.getToken();return{done:token.type===types.eof,value:token};}};};}// Toggle strict mode. Re-reads the next number or string to please\n// pedantic tests (`\"use strict\"; 010;` should fail).\npp$9.curContext=function(){return this.context[this.context.length-1];};// Read a single token, updating the parser object's token-related\n// properties.\npp$9.nextToken=function(){var curContext=this.curContext();if(!curContext||!curContext.preserveSpace){this.skipSpace();}this.start=this.pos;if(this.options.locations){this.startLoc=this.curPosition();}if(this.pos>=this.input.length){return this.finishToken(types.eof);}if(curContext.override){return curContext.override(this);}else{this.readToken(this.fullCharCodeAtPos());}};pp$9.readToken=function(code){// Identifier or keyword. '\\uXXXX' sequences are allowed in\n// identifiers, so '\\' also dispatches to that.\nif(isIdentifierStart(code,this.options.ecmaVersion>=6)||code===92/* '\\' */){return this.readWord();}return this.getTokenFromCode(code);};pp$9.fullCharCodeAtPos=function(){var code=this.input.charCodeAt(this.pos);if(code<=0xd7ff||code>=0xdc00){return code;}var next=this.input.charCodeAt(this.pos+1);return next<=0xdbff||next>=0xe000?code:(code<<10)+next-0x35fdc00;};pp$9.skipBlockComment=function(){var startLoc=this.options.onComment&&this.curPosition();var start=this.pos,end=this.input.indexOf(\"*/\",this.pos+=2);if(end===-1){this.raise(this.pos-2,\"Unterminated comment\");}this.pos=end+2;if(this.options.locations){lineBreakG.lastIndex=start;var match;while((match=lineBreakG.exec(this.input))&&match.index<this.pos){++this.curLine;this.lineStart=match.index+match[0].length;}}if(this.options.onComment){this.options.onComment(true,this.input.slice(start+2,end),start,this.pos,startLoc,this.curPosition());}};pp$9.skipLineComment=function(startSkip){var start=this.pos;var startLoc=this.options.onComment&&this.curPosition();var ch=this.input.charCodeAt(this.pos+=startSkip);while(this.pos<this.input.length&&!isNewLine(ch)){ch=this.input.charCodeAt(++this.pos);}if(this.options.onComment){this.options.onComment(false,this.input.slice(start+startSkip,this.pos),start,this.pos,startLoc,this.curPosition());}};// Called at the start of the parse and after every token. Skips\n// whitespace and comments, and.\npp$9.skipSpace=function(){loop:while(this.pos<this.input.length){var ch=this.input.charCodeAt(this.pos);switch(ch){case 32:case 160:// ' '\n++this.pos;break;case 13:if(this.input.charCodeAt(this.pos+1)===10){++this.pos;}case 10:case 8232:case 8233:++this.pos;if(this.options.locations){++this.curLine;this.lineStart=this.pos;}break;case 47:// '/'\nswitch(this.input.charCodeAt(this.pos+1)){case 42:// '*'\nthis.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break loop;}break;default:if(ch>8&&ch<14||ch>=5760&&nonASCIIwhitespace.test(String.fromCharCode(ch))){++this.pos;}else{break loop;}}}};// Called at the end of every token. Sets `end`, `val`, and\n// maintains `context` and `exprAllowed`, and skips the space after\n// the token, so that the next one's `start` will point at the\n// right position.\npp$9.finishToken=function(type,val){this.end=this.pos;if(this.options.locations){this.endLoc=this.curPosition();}var prevType=this.type;this.type=type;this.value=val;this.updateContext(prevType);};// ### Token reading\n// This is the function that is called to fetch the next token. It\n// is somewhat obscure, because it works in character codes rather\n// than characters, and because operator parsing has been inlined\n// into it.\n//\n// All in the name of speed.\n//\npp$9.readToken_dot=function(){var next=this.input.charCodeAt(this.pos+1);if(next>=48&&next<=57){return this.readNumber(true);}var next2=this.input.charCodeAt(this.pos+2);if(this.options.ecmaVersion>=6&&next===46&&next2===46){// 46 = dot '.'\nthis.pos+=3;return this.finishToken(types.ellipsis);}else{++this.pos;return this.finishToken(types.dot);}};pp$9.readToken_slash=function(){// '/'\nvar next=this.input.charCodeAt(this.pos+1);if(this.exprAllowed){++this.pos;return this.readRegexp();}if(next===61){return this.finishOp(types.assign,2);}return this.finishOp(types.slash,1);};pp$9.readToken_mult_modulo_exp=function(code){// '%*'\nvar next=this.input.charCodeAt(this.pos+1);var size=1;var tokentype=code===42?types.star:types.modulo;// exponentiation operator ** and **=\nif(this.options.ecmaVersion>=7&&code===42&&next===42){++size;tokentype=types.starstar;next=this.input.charCodeAt(this.pos+2);}if(next===61){return this.finishOp(types.assign,size+1);}return this.finishOp(tokentype,size);};pp$9.readToken_pipe_amp=function(code){// '|&'\nvar next=this.input.charCodeAt(this.pos+1);if(next===code){if(this.options.ecmaVersion>=12){var next2=this.input.charCodeAt(this.pos+2);if(next2===61){return this.finishOp(types.assign,3);}}return this.finishOp(code===124?types.logicalOR:types.logicalAND,2);}if(next===61){return this.finishOp(types.assign,2);}return this.finishOp(code===124?types.bitwiseOR:types.bitwiseAND,1);};pp$9.readToken_caret=function(){// '^'\nvar next=this.input.charCodeAt(this.pos+1);if(next===61){return this.finishOp(types.assign,2);}return this.finishOp(types.bitwiseXOR,1);};pp$9.readToken_plus_min=function(code){// '+-'\nvar next=this.input.charCodeAt(this.pos+1);if(next===code){if(next===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||lineBreak.test(this.input.slice(this.lastTokEnd,this.pos)))){// A `-->` line comment\nthis.skipLineComment(3);this.skipSpace();return this.nextToken();}return this.finishOp(types.incDec,2);}if(next===61){return this.finishOp(types.assign,2);}return this.finishOp(types.plusMin,1);};pp$9.readToken_lt_gt=function(code){// '<>'\nvar next=this.input.charCodeAt(this.pos+1);var size=1;if(next===code){size=code===62&&this.input.charCodeAt(this.pos+2)===62?3:2;if(this.input.charCodeAt(this.pos+size)===61){return this.finishOp(types.assign,size+1);}return this.finishOp(types.bitShift,size);}if(next===33&&code===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45){// `<!--`, an XML-style comment that should be interpreted as a line comment\nthis.skipLineComment(4);this.skipSpace();return this.nextToken();}if(next===61){size=2;}return this.finishOp(types.relational,size);};pp$9.readToken_eq_excl=function(code){// '=!'\nvar next=this.input.charCodeAt(this.pos+1);if(next===61){return this.finishOp(types.equality,this.input.charCodeAt(this.pos+2)===61?3:2);}if(code===61&&next===62&&this.options.ecmaVersion>=6){// '=>'\nthis.pos+=2;return this.finishToken(types.arrow);}return this.finishOp(code===61?types.eq:types.prefix,1);};pp$9.readToken_question=function(){// '?'\nvar ecmaVersion=this.options.ecmaVersion;if(ecmaVersion>=11){var next=this.input.charCodeAt(this.pos+1);if(next===46){var next2=this.input.charCodeAt(this.pos+2);if(next2<48||next2>57){return this.finishOp(types.questionDot,2);}}if(next===63){if(ecmaVersion>=12){var next2$1=this.input.charCodeAt(this.pos+2);if(next2$1===61){return this.finishOp(types.assign,3);}}return this.finishOp(types.coalesce,2);}}return this.finishOp(types.question,1);};pp$9.readToken_numberSign=function(){// '#'\nvar ecmaVersion=this.options.ecmaVersion;var code=35;// '#'\nif(ecmaVersion>=13){++this.pos;code=this.fullCharCodeAtPos();if(isIdentifierStart(code,true)||code===92/* '\\' */){return this.finishToken(types.privateId,this.readWord1());}}this.raise(this.pos,\"Unexpected character '\"+codePointToString$1(code)+\"'\");};pp$9.getTokenFromCode=function(code){switch(code){// The interpretation of a dot depends on whether it is followed\n// by a digit or another two dots.\ncase 46:// '.'\nreturn this.readToken_dot();// Punctuation tokens.\ncase 40:++this.pos;return this.finishToken(types.parenL);case 41:++this.pos;return this.finishToken(types.parenR);case 59:++this.pos;return this.finishToken(types.semi);case 44:++this.pos;return this.finishToken(types.comma);case 91:++this.pos;return this.finishToken(types.bracketL);case 93:++this.pos;return this.finishToken(types.bracketR);case 123:++this.pos;return this.finishToken(types.braceL);case 125:++this.pos;return this.finishToken(types.braceR);case 58:++this.pos;return this.finishToken(types.colon);case 96:// '`'\nif(this.options.ecmaVersion<6){break;}++this.pos;return this.finishToken(types.backQuote);case 48:// '0'\nvar next=this.input.charCodeAt(this.pos+1);if(next===120||next===88){return this.readRadixNumber(16);}// '0x', '0X' - hex number\nif(this.options.ecmaVersion>=6){if(next===111||next===79){return this.readRadixNumber(8);}// '0o', '0O' - octal number\nif(next===98||next===66){return this.readRadixNumber(2);}// '0b', '0B' - binary number\n}// Anything else beginning with a digit is an integer, octal\n// number, or float.\ncase 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:// 1-9\nreturn this.readNumber(false);// Quotes produce strings.\ncase 34:case 39:// '\"', \"'\"\nreturn this.readString(code);// Operators are parsed inline in tiny state machines. '=' (61) is\n// often referred to. `finishOp` simply skips the amount of\n// characters it is given as second argument, and returns a token\n// of the type given by its first argument.\ncase 47:// '/'\nreturn this.readToken_slash();case 37:case 42:// '%*'\nreturn this.readToken_mult_modulo_exp(code);case 124:case 38:// '|&'\nreturn this.readToken_pipe_amp(code);case 94:// '^'\nreturn this.readToken_caret();case 43:case 45:// '+-'\nreturn this.readToken_plus_min(code);case 60:case 62:// '<>'\nreturn this.readToken_lt_gt(code);case 61:case 33:// '=!'\nreturn this.readToken_eq_excl(code);case 63:// '?'\nreturn this.readToken_question();case 126:// '~'\nreturn this.finishOp(types.prefix,1);case 35:// '#'\nreturn this.readToken_numberSign();}this.raise(this.pos,\"Unexpected character '\"+codePointToString$1(code)+\"'\");};pp$9.finishOp=function(type,size){var str=this.input.slice(this.pos,this.pos+size);this.pos+=size;return this.finishToken(type,str);};pp$9.readRegexp=function(){var escaped,inClass,start=this.pos;for(;;){if(this.pos>=this.input.length){this.raise(start,\"Unterminated regular expression\");}var ch=this.input.charAt(this.pos);if(lineBreak.test(ch)){this.raise(start,\"Unterminated regular expression\");}if(!escaped){if(ch===\"[\"){inClass=true;}else if(ch===\"]\"&&inClass){inClass=false;}else if(ch===\"/\"&&!inClass){break;}escaped=ch===\"\\\\\";}else{escaped=false;}++this.pos;}var pattern=this.input.slice(start,this.pos);++this.pos;var flagsStart=this.pos;var flags=this.readWord1();if(this.containsEsc){this.unexpected(flagsStart);}// Validate pattern\nvar state=this.regexpState||(this.regexpState=new RegExpValidationState(this));state.reset(start,pattern,flags);this.validateRegExpFlags(state);this.validateRegExpPattern(state);// Create Literal#value property value.\nvar value=null;try{value=new RegExp(pattern,flags);}catch(e){// ESTree requires null if it failed to instantiate RegExp object.\n// https://github.com/estree/estree/blob/a27003adf4fd7bfad44de9cef372a2eacd527b1c/es5.md#regexpliteral\n}return this.finishToken(types.regexp,{pattern:pattern,flags:flags,value:value});};// Read an integer in the given radix. Return null if zero digits\n// were read, the integer value otherwise. When `len` is given, this\n// will return `null` unless the integer has exactly `len` digits.\npp$9.readInt=function(radix,len,maybeLegacyOctalNumericLiteral){// `len` is used for character escape sequences. In that case, disallow separators.\nvar allowSeparators=this.options.ecmaVersion>=12&&len===undefined;// `maybeLegacyOctalNumericLiteral` is true if it doesn't have prefix (0x,0o,0b)\n// and isn't fraction part nor exponent part. In that case, if the first digit\n// is zero then disallow separators.\nvar isLegacyOctalNumericLiteral=maybeLegacyOctalNumericLiteral&&this.input.charCodeAt(this.pos)===48;var start=this.pos,total=0,lastCode=0;for(var i=0,e=len==null?Infinity:len;i<e;++i,++this.pos){var code=this.input.charCodeAt(this.pos),val=void 0;if(allowSeparators&&code===95){if(isLegacyOctalNumericLiteral){this.raiseRecoverable(this.pos,\"Numeric separator is not allowed in legacy octal numeric literals\");}if(lastCode===95){this.raiseRecoverable(this.pos,\"Numeric separator must be exactly one underscore\");}if(i===0){this.raiseRecoverable(this.pos,\"Numeric separator is not allowed at the first of digits\");}lastCode=code;continue;}if(code>=97){val=code-97+10;}// a\nelse if(code>=65){val=code-65+10;}// A\nelse if(code>=48&&code<=57){val=code-48;}// 0-9\nelse{val=Infinity;}if(val>=radix){break;}lastCode=code;total=total*radix+val;}if(allowSeparators&&lastCode===95){this.raiseRecoverable(this.pos-1,\"Numeric separator is not allowed at the last of digits\");}if(this.pos===start||len!=null&&this.pos-start!==len){return null;}return total;};function stringToNumber(str,isLegacyOctalNumericLiteral){if(isLegacyOctalNumericLiteral){return parseInt(str,8);}// `parseFloat(value)` stops parsing at the first numeric separator then returns a wrong value.\nreturn parseFloat(str.replace(/_/g,\"\"));}function stringToBigInt(str){if(typeof BigInt!==\"function\"){return null;}// `BigInt(value)` throws syntax error if the string contains numeric separators.\nreturn BigInt(str.replace(/_/g,\"\"));}pp$9.readRadixNumber=function(radix){var start=this.pos;this.pos+=2;// 0x\nvar val=this.readInt(radix);if(val==null){this.raise(this.start+2,\"Expected number in radix \"+radix);}if(this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110){val=stringToBigInt(this.input.slice(start,this.pos));++this.pos;}else if(isIdentifierStart(this.fullCharCodeAtPos())){this.raise(this.pos,\"Identifier directly after number\");}return this.finishToken(types.num,val);};// Read an integer, octal integer, or floating-point number.\npp$9.readNumber=function(startsWithDot){var start=this.pos;if(!startsWithDot&&this.readInt(10,undefined,true)===null){this.raise(start,\"Invalid number\");}var octal=this.pos-start>=2&&this.input.charCodeAt(start)===48;if(octal&&this.strict){this.raise(start,\"Invalid number\");}var next=this.input.charCodeAt(this.pos);if(!octal&&!startsWithDot&&this.options.ecmaVersion>=11&&next===110){var val$1=stringToBigInt(this.input.slice(start,this.pos));++this.pos;if(isIdentifierStart(this.fullCharCodeAtPos())){this.raise(this.pos,\"Identifier directly after number\");}return this.finishToken(types.num,val$1);}if(octal&&/[89]/.test(this.input.slice(start,this.pos))){octal=false;}if(next===46&&!octal){// '.'\n++this.pos;this.readInt(10);next=this.input.charCodeAt(this.pos);}if((next===69||next===101)&&!octal){// 'eE'\nnext=this.input.charCodeAt(++this.pos);if(next===43||next===45){++this.pos;}// '+-'\nif(this.readInt(10)===null){this.raise(start,\"Invalid number\");}}if(isIdentifierStart(this.fullCharCodeAtPos())){this.raise(this.pos,\"Identifier directly after number\");}var val=stringToNumber(this.input.slice(start,this.pos),octal);return this.finishToken(types.num,val);};// Read a string value, interpreting backslash-escapes.\npp$9.readCodePoint=function(){var ch=this.input.charCodeAt(this.pos),code;if(ch===123){// '{'\nif(this.options.ecmaVersion<6){this.unexpected();}var codePos=++this.pos;code=this.readHexChar(this.input.indexOf(\"}\",this.pos)-this.pos);++this.pos;if(code>0x10FFFF){this.invalidStringToken(codePos,\"Code point out of bounds\");}}else{code=this.readHexChar(4);}return code;};function codePointToString$1(code){// UTF-16 Decoding\nif(code<=0xFFFF){return String.fromCharCode(code);}code-=0x10000;return String.fromCharCode((code>>10)+0xD800,(code&1023)+0xDC00);}pp$9.readString=function(quote){var out=\"\",chunkStart=++this.pos;for(;;){if(this.pos>=this.input.length){this.raise(this.start,\"Unterminated string constant\");}var ch=this.input.charCodeAt(this.pos);if(ch===quote){break;}if(ch===92){// '\\'\nout+=this.input.slice(chunkStart,this.pos);out+=this.readEscapedChar(false);chunkStart=this.pos;}else{if(isNewLine(ch,this.options.ecmaVersion>=10)){this.raise(this.start,\"Unterminated string constant\");}++this.pos;}}out+=this.input.slice(chunkStart,this.pos++);return this.finishToken(types.string,out);};// Reads template string tokens.\nvar INVALID_TEMPLATE_ESCAPE_ERROR={};pp$9.tryReadTemplateToken=function(){this.inTemplateElement=true;try{this.readTmplToken();}catch(err){if(err===INVALID_TEMPLATE_ESCAPE_ERROR){this.readInvalidTemplateToken();}else{throw err;}}this.inTemplateElement=false;};pp$9.invalidStringToken=function(position,message){if(this.inTemplateElement&&this.options.ecmaVersion>=9){throw INVALID_TEMPLATE_ESCAPE_ERROR;}else{this.raise(position,message);}};pp$9.readTmplToken=function(){var out=\"\",chunkStart=this.pos;for(;;){if(this.pos>=this.input.length){this.raise(this.start,\"Unterminated template\");}var ch=this.input.charCodeAt(this.pos);if(ch===96||ch===36&&this.input.charCodeAt(this.pos+1)===123){// '`', '${'\nif(this.pos===this.start&&(this.type===types.template||this.type===types.invalidTemplate)){if(ch===36){this.pos+=2;return this.finishToken(types.dollarBraceL);}else{++this.pos;return this.finishToken(types.backQuote);}}out+=this.input.slice(chunkStart,this.pos);return this.finishToken(types.template,out);}if(ch===92){// '\\'\nout+=this.input.slice(chunkStart,this.pos);out+=this.readEscapedChar(true);chunkStart=this.pos;}else if(isNewLine(ch)){out+=this.input.slice(chunkStart,this.pos);++this.pos;switch(ch){case 13:if(this.input.charCodeAt(this.pos)===10){++this.pos;}case 10:out+=\"\\n\";break;default:out+=String.fromCharCode(ch);break;}if(this.options.locations){++this.curLine;this.lineStart=this.pos;}chunkStart=this.pos;}else{++this.pos;}}};// Reads a template token to search for the end, without validating any escape sequences\npp$9.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++){switch(this.input[this.pos]){case\"\\\\\":++this.pos;break;case\"$\":if(this.input[this.pos+1]!==\"{\"){break;}// falls through\ncase\"`\":return this.finishToken(types.invalidTemplate,this.input.slice(this.start,this.pos));// no default\n}}this.raise(this.start,\"Unterminated template\");};// Used to read escaped characters\npp$9.readEscapedChar=function(inTemplate){var ch=this.input.charCodeAt(++this.pos);++this.pos;switch(ch){case 110:return\"\\n\";// 'n' -> '\\n'\ncase 114:return\"\\r\";// 'r' -> '\\r'\ncase 120:return String.fromCharCode(this.readHexChar(2));// 'x'\ncase 117:return codePointToString$1(this.readCodePoint());// 'u'\ncase 116:return\"\\t\";// 't' -> '\\t'\ncase 98:return\"\\b\";// 'b' -> '\\b'\ncase 118:return\"\\x0B\";// 'v' -> '\\u000b'\ncase 102:return\"\\f\";// 'f' -> '\\f'\ncase 13:if(this.input.charCodeAt(this.pos)===10){++this.pos;}// '\\r\\n'\ncase 10:// ' \\n'\nif(this.options.locations){this.lineStart=this.pos;++this.curLine;}return\"\";case 56:case 57:if(this.strict){this.invalidStringToken(this.pos-1,\"Invalid escape sequence\");}if(inTemplate){var codePos=this.pos-1;this.invalidStringToken(codePos,\"Invalid escape sequence in template string\");return null;}default:if(ch>=48&&ch<=55){var octalStr=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0];var octal=parseInt(octalStr,8);if(octal>255){octalStr=octalStr.slice(0,-1);octal=parseInt(octalStr,8);}this.pos+=octalStr.length-1;ch=this.input.charCodeAt(this.pos);if((octalStr!==\"0\"||ch===56||ch===57)&&(this.strict||inTemplate)){this.invalidStringToken(this.pos-1-octalStr.length,inTemplate?\"Octal literal in template string\":\"Octal literal in strict mode\");}return String.fromCharCode(octal);}if(isNewLine(ch)){// Unicode new line characters after \\ get removed from output in both\n// template literals and strings\nreturn\"\";}return String.fromCharCode(ch);}};// Used to read character escape sequences ('\\x', '\\u', '\\U').\npp$9.readHexChar=function(len){var codePos=this.pos;var n=this.readInt(16,len);if(n===null){this.invalidStringToken(codePos,\"Bad character escape sequence\");}return n;};// Read an identifier, and return it as a string. Sets `this.containsEsc`\n// to whether the word contained a '\\u' escape.\n//\n// Incrementally adds only escaped chars, adding other chunks as-is\n// as a micro-optimization.\npp$9.readWord1=function(){this.containsEsc=false;var word=\"\",first=true,chunkStart=this.pos;var astral=this.options.ecmaVersion>=6;while(this.pos<this.input.length){var ch=this.fullCharCodeAtPos();if(isIdentifierChar(ch,astral)){this.pos+=ch<=0xffff?1:2;}else if(ch===92){// \"\\\"\nthis.containsEsc=true;word+=this.input.slice(chunkStart,this.pos);var escStart=this.pos;if(this.input.charCodeAt(++this.pos)!==117)// \"u\"\n{this.invalidStringToken(this.pos,\"Expecting Unicode escape sequence \\\\uXXXX\");}++this.pos;var esc=this.readCodePoint();if(!(first?isIdentifierStart:isIdentifierChar)(esc,astral)){this.invalidStringToken(escStart,\"Invalid Unicode escape\");}word+=codePointToString$1(esc);chunkStart=this.pos;}else{break;}first=false;}return word+this.input.slice(chunkStart,this.pos);};// Read an identifier or keyword token. Will check for reserved\n// words when necessary.\npp$9.readWord=function(){var word=this.readWord1();var type=types.name;if(this.keywords.test(word)){type=keywords$1[word];}return this.finishToken(type,word);};// Acorn is a tiny, fast JavaScript parser written in JavaScript.\nvar version=\"8.4.1\";Parser.acorn={Parser:Parser,version:version,defaultOptions:defaultOptions,Position:Position,SourceLocation:SourceLocation,getLineInfo:getLineInfo,Node:Node,TokenType:TokenType,tokTypes:types,keywordTypes:keywords$1,TokContext:TokContext,tokContexts:types$1,isIdentifierChar:isIdentifierChar,isIdentifierStart:isIdentifierStart,Token:Token,isNewLine:isNewLine,lineBreak:lineBreak,lineBreakG:lineBreakG,nonASCIIwhitespace:nonASCIIwhitespace};// The main exported interface (under `self.acorn` when in the\n// browser) is a `parse` function that takes a code string and\n// returns an abstract syntax tree as specified by [Mozilla parser\n// API][api].\n//\n// [api]: https://developer.mozilla.org/en-US/docs/SpiderMonkey/Parser_API\nfunction parse(input,options){return Parser.parse(input,options);}// This function tries to parse a single expression at a given\n// offset in a string. Useful for parsing mixed-language formats\n// that embed JavaScript expressions.\nfunction parseExpressionAt(input,pos,options){return Parser.parseExpressionAt(input,pos,options);}function flatten(nodes){var target=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];for(var _i2=0;_i2<nodes.length;_i2+=1){var _node2=nodes[_i2];if(Array.isArray(_node2)){flatten(_node2,target);}else{target.push(_node2);}}return target;}var pattern=/^\\s*svelte-ignore\\s+([\\s\\S]+)\\s*$/m;function extract_svelte_ignore(text){var match=pattern.exec(text);return match?match[1].split(/[^\\S]/).map(function(x){return x.trim();}).filter(Boolean):[];}function extract_svelte_ignore_from_comments(node){return flatten((node.leadingComments||[]).map(function(comment){return extract_svelte_ignore(comment.value);}));}function extract_ignores_above_position(position,template_nodes){var previous_node_idx=template_nodes.findIndex(function(child){return child.end===position;});if(previous_node_idx===-1){return[];}for(var _i3=previous_node_idx;_i3>=0;_i3--){var _node3=template_nodes[_i3];if(_node3.type!=='Comment'&&_node3.type!=='Text'){return[];}if(_node3.type==='Comment'){if(_node3.ignores.length){return _node3.ignores;}}}return[];}function fuzzymatch(name,names){var set=new FuzzySet(names);var matches=set.get(name);return matches&&matches[0]&&matches[0][0]>0.7?matches[0][1]:null;}// adapted from https://github.com/Glench/fuzzyset.js/blob/master/lib/fuzzyset.js\n// BSD Licensed\nvar GRAM_SIZE_LOWER=2;var GRAM_SIZE_UPPER=3;// return an edit distance from 0 to 1\nfunction _distance(str1,str2){if(str1===null&&str2===null){throw'Trying to compare two null values';}if(str1===null||str2===null)return 0;str1=String(str1);str2=String(str2);var distance=levenshtein(str1,str2);if(str1.length>str2.length){return 1-distance/str1.length;}else{return 1-distance/str2.length;}}// helper functions\nfunction levenshtein(str1,str2){var current=[];var prev;var value;for(var _i4=0;_i4<=str2.length;_i4++){for(var j=0;j<=str1.length;j++){if(_i4&&j){if(str1.charAt(j-1)===str2.charAt(_i4-1)){value=prev;}else{value=Math.min(current[j],current[j-1],prev)+1;}}else{value=_i4+j;}prev=current[j];current[j]=value;}}return current.pop();}var non_word_regex=/[^\\w, ]+/;function iterate_grams(value){var gram_size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;var simplified='-'+value.toLowerCase().replace(non_word_regex,'')+'-';var len_diff=gram_size-simplified.length;var results=[];if(len_diff>0){for(var _i5=0;_i5<len_diff;++_i5){value+='-';}}for(var _i6=0;_i6<simplified.length-gram_size+1;++_i6){results.push(simplified.slice(_i6,_i6+gram_size));}return results;}function gram_counter(value){var gram_size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;// return an object where key=gram, value=number of occurrences\nvar result={};var grams=iterate_grams(value,gram_size);var i=0;for(i;i<grams.length;++i){if(grams[i]in result){result[grams[i]]+=1;}else{result[grams[i]]=1;}}return result;}function sort_descending(a,b){return b[0]-a[0];}var FuzzySet=/*#__PURE__*/function(){function FuzzySet(arr){(0,_classCallCheck2.default)(this,FuzzySet);this.exact_set={};this.match_dict={};this.items={};// initialization\nfor(var _i7=GRAM_SIZE_LOWER;_i7<GRAM_SIZE_UPPER+1;++_i7){this.items[_i7]=[];}// add all the items to the set\nfor(var _i8=0;_i8<arr.length;++_i8){this.add(arr[_i8]);}}(0,_createClass2.default)(FuzzySet,[{key:\"add\",value:function add(value){var normalized_value=value.toLowerCase();if(normalized_value in this.exact_set){return false;}var i=GRAM_SIZE_LOWER;for(i;i<GRAM_SIZE_UPPER+1;++i){this._add(value,i);}}},{key:\"_add\",value:function _add(value,gram_size){var normalized_value=value.toLowerCase();var items=this.items[gram_size]||[];var index=items.length;items.push(0);var gram_counts=gram_counter(normalized_value,gram_size);var sum_of_square_gram_counts=0;var gram;var gram_count;for(gram in gram_counts){gram_count=gram_counts[gram];sum_of_square_gram_counts+=Math.pow(gram_count,2);if(gram in this.match_dict){this.match_dict[gram].push([index,gram_count]);}else{this.match_dict[gram]=[[index,gram_count]];}}var vector_normal=Math.sqrt(sum_of_square_gram_counts);items[index]=[vector_normal,normalized_value];this.items[gram_size]=items;this.exact_set[normalized_value]=value;}},{key:\"get\",value:function get(value){var normalized_value=value.toLowerCase();var result=this.exact_set[normalized_value];if(result){return[[1,result]];}var results=[];// start with high gram size and if there are no results, go to lower gram sizes\nfor(var gram_size=GRAM_SIZE_UPPER;gram_size>=GRAM_SIZE_LOWER;--gram_size){results=this.__get(value,gram_size);if(results){return results;}}return null;}},{key:\"__get\",value:function __get(value,gram_size){var normalized_value=value.toLowerCase();var matches={};var gram_counts=gram_counter(normalized_value,gram_size);var items=this.items[gram_size];var sum_of_square_gram_counts=0;var gram;var gram_count;var i;var index;var other_gram_count;for(gram in gram_counts){gram_count=gram_counts[gram];sum_of_square_gram_counts+=Math.pow(gram_count,2);if(gram in this.match_dict){for(i=0;i<this.match_dict[gram].length;++i){index=this.match_dict[gram][i][0];other_gram_count=this.match_dict[gram][i][1];if(index in matches){matches[index]+=gram_count*other_gram_count;}else{matches[index]=gram_count*other_gram_count;}}}}var vector_normal=Math.sqrt(sum_of_square_gram_counts);var results=[];var match_score;// build a results list of [score, str]\nfor(var match_index in matches){match_score=matches[match_index];results.push([match_score/(vector_normal*items[match_index][0]),items[match_index][1]]);}results.sort(sort_descending);var new_results=[];var end_index=Math.min(50,results.length);// truncate somewhat arbitrarily to 50\nfor(var _i9=0;_i9<end_index;++_i9){new_results.push([_distance(results[_i9][1],normalized_value),results[_i9][1]]);}results=new_results;results.sort(sort_descending);new_results=[];for(var _i10=0;_i10<results.length;++_i10){if(results[_i10][0]==results[0][0]){new_results.push([results[_i10][0],this.exact_set[results[_i10][1]]]);}}return new_results;}}]);return FuzzySet;}();// Adapted from https://github.com/acornjs/acorn/blob/6584815dca7440e00de841d1dad152302fdd7ca5/src/tokenize.js\n// Reproduced under MIT License https://github.com/acornjs/acorn/blob/master/LICENSE\nfunction full_char_code_at(str,i){var code=str.charCodeAt(i);if(code<=0xd7ff||code>=0xe000)return code;var next=str.charCodeAt(i+1);return(code<<10)+next-0x35fdc00;}var globals=new Set(['alert','Array','BigInt','Boolean','clearInterval','clearTimeout','confirm','console','Date','decodeURI','decodeURIComponent','document','Element','encodeURI','encodeURIComponent','Error','EvalError','Event','EventSource','fetch','global','globalThis','history','HTMLElement','Infinity','InternalError','Intl','isFinite','isNaN','JSON','localStorage','location','Map','Math','NaN','navigator','Node','Number','Object','parseFloat','parseInt','process','Promise','prompt','RangeError','ReferenceError','RegExp','sessionStorage','Set','setInterval','setTimeout','String','SVGElement','SyntaxError','TypeError','undefined','URIError','URL','URLSearchParams','window']);var reserved=new Set(['arguments','await','break','case','catch','class','const','continue','debugger','default','delete','do','else','enum','eval','export','extends','false','finally','for','function','if','implements','import','in','instanceof','interface','let','new','null','package','private','protected','public','return','static','super','switch','this','throw','true','try','typeof','var','void','while','with','yield']);var void_element_names=/^(?:area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/;function is_void(name){return void_element_names.test(name)||name.toLowerCase()==='!doctype';}function is_valid(str){var i=0;while(i<str.length){var code=full_char_code_at(str,i);if(!(i===0?isIdentifierStart:isIdentifierChar)(code,true))return false;i+=code<=0xffff?1:2;}return true;}function sanitize(name){return name.replace(/[^a-zA-Z0-9_]+/g,'_').replace(/^_/,'').replace(/_$/,'').replace(/^[0-9]/,'_$&');}function list(items){var conjunction=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'or';if(items.length===1)return items[0];return\"\".concat(items.slice(0,-1).join(', '),\" \").concat(conjunction,\" \").concat(items[items.length-1]);}// All parser errors should be listed and accessed from here\n/**\n * @internal\n */var parser_errors={css_syntax_error:function css_syntax_error(message){return{code:'css-syntax-error',message:message};},duplicate_attribute:{code:'duplicate-attribute',message:'Attributes need to be unique'},duplicate_element:function duplicate_element(slug,name){return{code:\"duplicate-\".concat(slug),message:\"A component can only have one <\".concat(name,\"> tag\")};},duplicate_style:{code:'duplicate-style',message:'You can only have one top-level <style> tag per component'},empty_attribute_shorthand:{code:'empty-attribute-shorthand',message:'Attribute shorthand cannot be empty'},empty_directive_name:function empty_directive_name(type){return{code:'empty-directive-name',message:\"\".concat(type,\" name cannot be empty\")};},empty_global_selector:{code:'css-syntax-error',message:':global() must contain a selector'},expected_block_type:{code:'expected-block-type',message:'Expected if, each or await'},expected_name:{code:'expected-name',message:'Expected name'},invalid_catch_placement_unclosed_block:function invalid_catch_placement_unclosed_block(block){return{code:'invalid-catch-placement',message:\"Expected to close \".concat(block,\" before seeing {:catch} block\")};},invalid_catch_placement_without_await:{code:'invalid-catch-placement',message:'Cannot have an {:catch} block outside an {#await ...} block'},invalid_component_definition:{code:'invalid-component-definition',message:'invalid component definition'},invalid_closing_tag_unopened:function invalid_closing_tag_unopened(name){return{code:'invalid-closing-tag',message:\"</\".concat(name,\"> attempted to close an element that was not open\")};},invalid_closing_tag_autoclosed:function invalid_closing_tag_autoclosed(name,reason){return{code:'invalid-closing-tag',message:\"</\".concat(name,\"> attempted to close <\").concat(name,\"> that was already automatically closed by <\").concat(reason,\">\")};},invalid_debug_args:{code:'invalid-debug-args',message:'{@debug ...} arguments must be identifiers, not arbitrary expressions'},invalid_declaration:{code:'invalid-declaration',message:'Declaration cannot be empty'},invalid_directive_value:{code:'invalid-directive-value',message:'Directive value must be a JavaScript expression enclosed in curly braces'},invalid_elseif:{code:'invalid-elseif',message:'\\'elseif\\' should be \\'else if\\''},invalid_elseif_placement_outside_if:{code:'invalid-elseif-placement',message:'Cannot have an {:else if ...} block outside an {#if ...} block'},invalid_elseif_placement_unclosed_block:function invalid_elseif_placement_unclosed_block(block){return{code:'invalid-elseif-placement',message:\"Expected to close \".concat(block,\" before seeing {:else if ...} block\")};},invalid_else_placement_outside_if:{code:'invalid-else-placement',message:'Cannot have an {:else} block outside an {#if ...} or {#each ...} block'},invalid_else_placement_unclosed_block:function invalid_else_placement_unclosed_block(block){return{code:'invalid-else-placement',message:\"Expected to close \".concat(block,\" before seeing {:else} block\")};},invalid_element_content:function invalid_element_content(slug,name){return{code:\"invalid-\".concat(slug,\"-content\"),message:\"<\".concat(name,\"> cannot have children\")};},invalid_element_placement:function invalid_element_placement(slug,name){return{code:\"invalid-\".concat(slug,\"-placement\"),message:\"<\".concat(name,\"> tags cannot be inside elements or blocks\")};},invalid_ref_directive:function invalid_ref_directive(name){return{code:'invalid-ref-directive',message:\"The ref directive is no longer supported \\u2014 use `bind:this={\".concat(name,\"}` instead\")};},invalid_ref_selector:{code:'invalid-ref-selector',message:'ref selectors are no longer supported'},invalid_self_placement:{code:'invalid-self-placement',message:'<svelte:self> components can only exist inside {#if} blocks, {#each} blocks, or slots passed to components'},invalid_script_instance:{code:'invalid-script',message:'A component can only have one instance-level <script> element'},invalid_script_module:{code:'invalid-script',message:'A component can only have one <script context=\"module\"> element'},invalid_script_context_attribute:{code:'invalid-script',message:'context attribute must be static'},invalid_script_context_value:{code:'invalid-script',message:'If the context attribute is supplied, its value must be \"module\"'},invalid_tag_name:{code:'invalid-tag-name',message:'Expected valid tag name'},invalid_tag_name_svelte_element:function invalid_tag_name_svelte_element(tags,match){return{code:'invalid-tag-name',message:\"Valid <svelte:...> tag names are \".concat(list(tags)).concat(match?' (did you mean '+match+'?)':'')};},invalid_then_placement_unclosed_block:function invalid_then_placement_unclosed_block(block){return{code:'invalid-then-placement',message:\"Expected to close \".concat(block,\" before seeing {:then} block\")};},invalid_then_placement_without_await:{code:'invalid-then-placement',message:'Cannot have an {:then} block outside an {#await ...} block'},invalid_void_content:function invalid_void_content(name){return{code:'invalid-void-content',message:\"<\".concat(name,\"> is a void element and cannot have children, or a closing tag\")};},missing_component_definition:{code:'missing-component-definition',message:'<svelte:component> must have a \\'this\\' attribute'},missing_attribute_value:{code:'missing-attribute-value',message:'Expected value for the attribute'},unclosed_script:{code:'unclosed-script',message:'<script> must have a closing tag'},unclosed_style:{code:'unclosed-style',message:'<style> must have a closing tag'},unclosed_comment:{code:'unclosed-comment',message:'comment was left open, expected -->'},unclosed_attribute_value:function unclosed_attribute_value(token){return{code:'unclosed-attribute-value',message:\"Expected to close the attribute value with \".concat(token)};},unexpected_block_close:{code:'unexpected-block-close',message:'Unexpected block closing tag'},unexpected_eof:{code:'unexpected-eof',message:'Unexpected end of input'},unexpected_eof_token:function unexpected_eof_token(token){return{code:'unexpected-eof',message:\"Unexpected \".concat(token)};},unexpected_token:function unexpected_token(token){return{code:'unexpected-token',message:\"Expected \".concat(token)};},unexpected_token_destructure:{code:'unexpected-token',message:'Expected identifier or destructure pattern'}};// @ts-check\n/** @typedef { import('estree').BaseNode} BaseNode */ /** @typedef {{\n\tskip: () => void;\n\tremove: () => void;\n\treplace: (node: BaseNode) => void;\n}} WalkerContext */var WalkerBase=/*#__PURE__*/function(){function WalkerBase(){var _this2=this;(0,_classCallCheck2.default)(this,WalkerBase);/** @type {boolean} */this.should_skip=false;/** @type {boolean} */this.should_remove=false;/** @type {BaseNode | null} */this.replacement=null;/** @type {WalkerContext} */this.context={skip:function skip(){return _this2.should_skip=true;},remove:function remove(){return _this2.should_remove=true;},replace:function replace(node){return _this2.replacement=node;}};}/**\n\t *\n\t * @param {any} parent\n\t * @param {string} prop\n\t * @param {number} index\n\t * @param {BaseNode} node\n\t */(0,_createClass2.default)(WalkerBase,[{key:\"replace\",value:function replace(parent,prop,index,node){if(parent){if(index!==null){parent[prop][index]=node;}else{parent[prop]=node;}}}/**\n\t *\n\t * @param {any} parent\n\t * @param {string} prop\n\t * @param {number} index\n\t */},{key:\"remove\",value:function remove(parent,prop,index){if(parent){if(index!==null){parent[prop].splice(index,1);}else{delete parent[prop];}}}}]);return WalkerBase;}();// @ts-check\n/** @typedef { import('estree').BaseNode} BaseNode */ /** @typedef { import('./walker.js').WalkerContext} WalkerContext */ /** @typedef {(\n *    this: WalkerContext,\n *    node: BaseNode,\n *    parent: BaseNode,\n *    key: string,\n *    index: number\n * ) => void} SyncHandler */var SyncWalker=/*#__PURE__*/function(_WalkerBase){(0,_inherits2.default)(SyncWalker,_WalkerBase);var _super=_createSuper(SyncWalker);/**\n\t *\n\t * @param {SyncHandler} enter\n\t * @param {SyncHandler} leave\n\t */function SyncWalker(enter,leave){var _this3;(0,_classCallCheck2.default)(this,SyncWalker);_this3=_super.call(this);/** @type {SyncHandler} */_this3.enter=enter;/** @type {SyncHandler} */_this3.leave=leave;return _this3;}/**\n\t *\n\t * @param {BaseNode} node\n\t * @param {BaseNode} parent\n\t * @param {string} [prop]\n\t * @param {number} [index]\n\t * @returns {BaseNode}\n\t */(0,_createClass2.default)(SyncWalker,[{key:\"visit\",value:function visit(node,parent,prop,index){if(node){if(this.enter){var _should_skip=this.should_skip;var _should_remove=this.should_remove;var _replacement=this.replacement;this.should_skip=false;this.should_remove=false;this.replacement=null;this.enter.call(this.context,node,parent,prop,index);if(this.replacement){node=this.replacement;this.replace(parent,prop,index,node);}if(this.should_remove){this.remove(parent,prop,index);}var skipped=this.should_skip;var removed=this.should_remove;this.should_skip=_should_skip;this.should_remove=_should_remove;this.replacement=_replacement;if(skipped)return node;if(removed)return null;}for(var key in node){var _value2=node[key];if((0,_typeof2.default)(_value2)!==\"object\"){continue;}else if(Array.isArray(_value2)){for(var _i11=0;_i11<_value2.length;_i11+=1){if(_value2[_i11]!==null&&typeof _value2[_i11].type==='string'){if(!this.visit(_value2[_i11],node,key,_i11)){// removed\n_i11--;}}}}else if(_value2!==null&&typeof _value2.type===\"string\"){this.visit(_value2,node,key,null);}}if(this.leave){var _replacement2=this.replacement;var _should_remove2=this.should_remove;this.replacement=null;this.should_remove=false;this.leave.call(this.context,node,parent,prop,index);if(this.replacement){node=this.replacement;this.replace(parent,prop,index,node);}if(this.should_remove){this.remove(parent,prop,index);}var _removed=this.should_remove;this.replacement=_replacement2;this.should_remove=_should_remove2;if(_removed)return null;}}return node;}}]);return SyncWalker;}(WalkerBase);// @ts-check\n/** @typedef { import('estree').BaseNode} BaseNode */ /** @typedef { import('./sync.js').SyncHandler} SyncHandler */ /** @typedef { import('./async.js').AsyncHandler} AsyncHandler */ /**\n *\n * @param {BaseNode} ast\n * @param {{\n *   enter?: SyncHandler\n *   leave?: SyncHandler\n * }} walker\n * @returns {BaseNode}\n */function walk(ast,_ref){var enter=_ref.enter,leave=_ref.leave;var instance=new SyncWalker(enter,leave);return instance.visit(ast,null);}// generate an ID that is, to all intents and purposes, unique\nvar id=Math.round(Math.random()*1e20).toString(36);var re=new RegExp(\"_\".concat(id,\"_(?:(\\\\d+)|(AT)|(HASH))_(\\\\w+)?\"),'g');/** @typedef {import('estree').Comment} Comment */ /** @typedef {import('estree').Node} Node */ /**\n * @typedef {Node & {\n *   start: number;\n *   end: number;\n *   has_trailing_newline?: boolean\n * }} NodeWithLocation\n */ /**\n * @typedef {Comment & {\n *   start: number;\n *   end: number;\n *   has_trailing_newline?: boolean\n * }} CommentWithLocation\n */ /**\n * @param {CommentWithLocation[]} comments\n * @param {string} raw\n */var get_comment_handlers=function get_comment_handlers(comments,raw){return{// pass to acorn options\n/**\n\t * @param {boolean} block\n\t * @param {string} value\n\t * @param {number} start\n\t * @param {number} end\n\t */onComment:function onComment(block,value,start,end){if(block&&/\\n/.test(value)){var a=start;while(a>0&&raw[a-1]!=='\\n'){a-=1;}var _b=a;while(/[ \\t]/.test(raw[_b])){_b+=1;}var indentation=raw.slice(a,_b);value=value.replace(new RegExp(\"^\".concat(indentation),'gm'),'');}comments.push({type:block?'Block':'Line',value:value,start:start,end:end});},// pass to estree-walker options\n/** @param {NodeWithLocation} node */enter:function enter(node){var comment;while(comments[0]&&comments[0].start<node.start){comment=comments.shift();comment.value=comment.value.replace(re,function(match,id,at,hash,value){if(hash)return\"#\".concat(value);if(at)return\"@\".concat(value);return match;});var next=comments[0]||node;comment.has_trailing_newline=comment.type==='Line'||/\\n/.test(raw.slice(comment.end,next.start));(node.leadingComments||(node.leadingComments=[])).push(comment);}},/** @param {NodeWithLocation} node */leave:function leave(node){if(comments[0]){var slice=raw.slice(node.end,comments[0].start);if(/^[,) \\t]*$/.test(slice)){node.trailingComments=[comments.shift()];}}}};};//@ts-check\n/** @typedef { import('estree').Node} Node */ /** @typedef {Node | {\n *   type: 'PropertyDefinition';\n *   computed: boolean;\n *   value: Node\n * }} NodeWithPropertyDefinition */ /**\n *\n * @param {NodeWithPropertyDefinition} node\n * @param {NodeWithPropertyDefinition} parent\n * @returns boolean\n */function is_reference(node,parent){if(node.type==='MemberExpression'){return!node.computed&&is_reference(node.object,node);}if(node.type==='Identifier'){if(!parent)return true;switch(parent.type){// disregard `bar` in `foo.bar`\ncase'MemberExpression':return parent.computed||node===parent.object;// disregard the `foo` in `class {foo(){}}` but keep it in `class {[foo](){}}`\ncase'MethodDefinition':return parent.computed;// disregard the `foo` in `class {foo=bar}` but keep it in `class {[foo]=bar}` and `class {bar=foo}`\ncase'PropertyDefinition':return parent.computed||node===parent.value;// disregard the `bar` in `{ bar: foo }`, but keep it in `{ [bar]: foo }`\ncase'Property':return parent.computed||node===parent.value;// disregard the `bar` in `export { foo as bar }` or\n// the foo in `import { foo as bar }`\ncase'ExportSpecifier':case'ImportSpecifier':return node===parent.local;// disregard the `foo` in `foo: while (...) { ... break foo; ... continue foo;}`\ncase'LabeledStatement':case'BreakStatement':case'ContinueStatement':return false;default:return true;}}return false;}/** @param {import('estree').Node} expression */function analyze(expression){/** @typedef {import('estree').Node} Node */ /** @type {WeakMap<Node, Scope>} */var map=new WeakMap();/** @type {Map<string, Node>} */var globals=new Map();var scope=new Scope$1(null,false);/** @type {[Scope, import('estree').Identifier][]} */var references=[];var current_scope=scope;walk(expression,{/**\n\t\t * @param {Node} node\n\t\t * @param {any} parent\n\t\t */enter:function enter(node,parent){switch(node.type){case'Identifier':if(is_reference(node,parent)){references.push([current_scope,node]);}break;case'ImportDeclaration':node.specifiers.forEach(function(specifier){current_scope.declarations.set(specifier.local.name,specifier);});break;case'FunctionExpression':case'FunctionDeclaration':case'ArrowFunctionExpression':if(node.type==='FunctionDeclaration'){if(node.id){current_scope.declarations.set(node.id.name,node);}map.set(node,current_scope=new Scope$1(current_scope,false));}else{map.set(node,current_scope=new Scope$1(current_scope,false));if(node.type==='FunctionExpression'&&node.id){current_scope.declarations.set(node.id.name,node);}}node.params.forEach(function(param){extract_names(param).forEach(function(name){current_scope.declarations.set(name,node);});});break;case'ForStatement':case'ForInStatement':case'ForOfStatement':map.set(node,current_scope=new Scope$1(current_scope,true));break;case'BlockStatement':map.set(node,current_scope=new Scope$1(current_scope,true));break;case'ClassDeclaration':case'VariableDeclaration':current_scope.add_declaration(node);break;case'CatchClause':map.set(node,current_scope=new Scope$1(current_scope,true));if(node.param){extract_names(node.param).forEach(function(name){current_scope.declarations.set(name,node.param);});}break;}},/** @param {Node} node */leave:function leave(node){if(map.has(node)){current_scope=current_scope.parent;}}});for(var _i12=references.length-1;_i12>=0;--_i12){var _references$_i=(0,_slicedToArray2.default)(references[_i12],2),_scope2=_references$_i[0],reference=_references$_i[1];if(!_scope2.references.has(reference.name)){add_reference(_scope2,reference.name);}if(!_scope2.find_owner(reference.name)){globals.set(reference.name,reference);}}return{map:map,scope:scope,globals:globals};}/**\n *\n * @param {Scope} scope\n * @param {string} name\n */function add_reference(scope,name){scope.references.add(name);if(scope.parent)add_reference(scope.parent,name);}var Scope$1=/*#__PURE__*/function(){function Scope$1(parent,block){(0,_classCallCheck2.default)(this,Scope$1);/** @type {Scope | null} */this.parent=parent;/** @type {boolean} */this.block=block;/** @type {Map<string, import('estree').Node>} */this.declarations=new Map();/** @type {Set<string>} */this.initialised_declarations=new Set();/** @type {Set<string>} */this.references=new Set();}/** @param {import('estree').VariableDeclaration | import('estree').ClassDeclaration} node */(0,_createClass2.default)(Scope$1,[{key:\"add_declaration\",value:function add_declaration(node){var _this4=this;if(node.type==='VariableDeclaration'){if(node.kind==='var'&&this.block&&this.parent){this.parent.add_declaration(node);}else{/** @param {import('estree').VariableDeclarator} declarator */var handle_declarator=function handle_declarator(declarator){extract_names(declarator.id).forEach(function(name){_this4.declarations.set(name,node);if(declarator.init)_this4.initialised_declarations.add(name);});};node.declarations.forEach(handle_declarator);}}else if(node.id){this.declarations.set(node.id.name,node);}}/**\n\t * @param {string} name\n\t * @returns {Scope | null}\n\t */},{key:\"find_owner\",value:function find_owner(name){if(this.declarations.has(name))return this;return this.parent&&this.parent.find_owner(name);}/**\n\t * @param {string} name\n\t * @returns {boolean}\n\t */},{key:\"has\",value:function has(name){return this.declarations.has(name)||!!this.parent&&this.parent.has(name);}}]);return Scope$1;}();/**\n * @param {import('estree').Node} param\n * @returns {string[]}\n */function extract_names(param){return extract_identifiers(param).map(function(node){return node.name;});}/**\n * @param {import('estree').Node} param\n * @param {import('estree').Identifier[]} nodes\n * @returns {import('estree').Identifier[]}\n */function extract_identifiers(param){var nodes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];switch(param.type){case'Identifier':nodes.push(param);break;case'MemberExpression':var object=param;while(object.type==='MemberExpression'){object=/** @type {any} */object.object;}nodes.push(/** @type {any} */object);break;case'ObjectPattern':/** @param {import('estree').Property | import('estree').RestElement} prop */var handle_prop=function handle_prop(prop){if(prop.type==='RestElement'){extract_identifiers(prop.argument,nodes);}else{extract_identifiers(prop.value,nodes);}};param.properties.forEach(handle_prop);break;case'ArrayPattern':/** @param {import('estree').Node} element */var handle_element=function handle_element(element){if(element)extract_identifiers(element,nodes);};param.elements.forEach(handle_element);break;case'RestElement':extract_identifiers(param.argument,nodes);break;case'AssignmentPattern':extract_identifiers(param.left,nodes);break;}return nodes;}// heavily based on https://github.com/davidbonnet/astring\n/** @typedef {import('estree').ArrowFunctionExpression} ArrowFunctionExpression */ /** @typedef {import('estree').BinaryExpression} BinaryExpression */ /** @typedef {import('estree').CallExpression} CallExpression */ /** @typedef {import('estree').Comment} Comment */ /** @typedef {import('estree').ExportSpecifier} ExportSpecifier */ /** @typedef {import('estree').Expression} Expression */ /** @typedef {import('estree').FunctionDeclaration} FunctionDeclaration */ /** @typedef {import('estree').ImportDeclaration} ImportDeclaration */ /** @typedef {import('estree').ImportSpecifier} ImportSpecifier */ /** @typedef {import('estree').Literal} Literal */ /** @typedef {import('estree').LogicalExpression} LogicalExpression */ /** @typedef {import('estree').NewExpression} NewExpression */ /** @typedef {import('estree').Node} Node */ /** @typedef {import('estree').ObjectExpression} ObjectExpression */ /** @typedef {import('estree').Pattern} Pattern */ /** @typedef {import('estree').SequenceExpression} SequenceExpression */ /** @typedef {import('estree').SimpleCallExpression} SimpleCallExpression */ /** @typedef {import('estree').SwitchStatement} SwitchStatement */ /** @typedef {import('estree').VariableDeclaration} VariableDeclaration */ /**\n * @typedef {{\n *   content: string;\n *   loc?: {\n *     start: { line: number; column: number; };\n *     end: { line: number; column: number; };\n *   };\n *   has_newline: boolean;\n * }} Chunk\n */ /**\n * @typedef {(node: any, state: State) => Chunk[]} Handler\n */ /**\n * @typedef {{\n *   indent: string;\n *   scope: any; // TODO import from periscopic\n *   scope_map: WeakMap<Node, any>;\n *   getName: (name: string) => string;\n *   deconflicted: WeakMap<Node, Map<string, string>>;\n *   comments: Comment[];\n * }} State\n */ /**\n * @param {Node} node\n * @param {State} state\n * @returns {Chunk[]}\n */function handle(node,state){var handler=handlers[node.type];if(!handler){throw new Error(\"Not implemented \".concat(node.type));}var result=handler(node,state);if(node.leadingComments){result.unshift(c(node.leadingComments.map(function(comment){return comment.type==='Block'?\"/*\".concat(comment.value,\"*/\").concat(/** @type {any} */comment.has_trailing_newline?\"\\n\".concat(state.indent):\" \"):\"//\".concat(comment.value).concat(/** @type {any} */comment.has_trailing_newline?\"\\n\".concat(state.indent):\" \");}).join(\"\")));}if(node.trailingComments){state.comments.push(node.trailingComments[0]);// there is only ever one\n}return result;}/**\n * @param {string} content\n * @param {Node} [node]\n * @returns {Chunk}\n */function c(content,node){return{content:content,loc:node&&node.loc,has_newline:/\\n/.test(content)};}var OPERATOR_PRECEDENCE={'||':2,'&&':3,'??':4,'|':5,'^':6,'&':7,'==':8,'!=':8,'===':8,'!==':8,'<':9,'>':9,'<=':9,'>=':9,in:9,instanceof:9,'<<':10,'>>':10,'>>>':10,'+':11,'-':11,'*':12,'%':12,'/':12,'**':13};/** @type {Record<string, number>} */var EXPRESSIONS_PRECEDENCE={ArrayExpression:20,TaggedTemplateExpression:20,ThisExpression:20,Identifier:20,Literal:18,TemplateLiteral:20,Super:20,SequenceExpression:20,MemberExpression:19,CallExpression:19,NewExpression:19,AwaitExpression:17,ClassExpression:17,FunctionExpression:17,ObjectExpression:17,UpdateExpression:16,UnaryExpression:15,BinaryExpression:14,LogicalExpression:13,ConditionalExpression:4,ArrowFunctionExpression:3,AssignmentExpression:3,YieldExpression:2,RestElement:1};/**\n *\n * @param {Expression} node\n * @param {BinaryExpression | LogicalExpression} parent\n * @param {boolean} is_right\n * @returns\n */function needs_parens(node,parent,is_right){// special case where logical expressions and coalesce expressions cannot be mixed,\n// either of them need to be wrapped with parentheses\nif(node.type==='LogicalExpression'&&parent.type==='LogicalExpression'&&(parent.operator==='??'&&node.operator!=='??'||parent.operator!=='??'&&node.operator==='??')){return true;}var precedence=EXPRESSIONS_PRECEDENCE[node.type];var parent_precedence=EXPRESSIONS_PRECEDENCE[parent.type];if(precedence!==parent_precedence){// Different node types\nreturn!is_right&&precedence===15&&parent_precedence===14&&parent.operator==='**'||precedence<parent_precedence;}if(precedence!==13&&precedence!==14){// Not a `LogicalExpression` or `BinaryExpression`\nreturn false;}if(/** @type {BinaryExpression} */node.operator==='**'&&parent.operator==='**'){// Exponentiation operator has right-to-left associativity\nreturn!is_right;}if(is_right){// Parenthesis are used if both operators have the same precedence\nreturn OPERATOR_PRECEDENCE[/** @type {BinaryExpression} */node.operator]<=OPERATOR_PRECEDENCE[parent.operator];}return OPERATOR_PRECEDENCE[/** @type {BinaryExpression} */node.operator]<OPERATOR_PRECEDENCE[parent.operator];}/** @param {Node} node */function has_call_expression(node){while(node){if(node.type[0]==='CallExpression'){return true;}else if(node.type==='MemberExpression'){node=node.object;}else{return false;}}}/** @param {Chunk[]} chunks */var has_newline=function has_newline(chunks){for(var _i13=0;_i13<chunks.length;_i13+=1){if(chunks[_i13].has_newline)return true;}return false;};/** @param {Chunk[]} chunks */var get_length=function get_length(chunks){var total=0;for(var _i14=0;_i14<chunks.length;_i14+=1){total+=chunks[_i14].content.length;}return total;};/**\n * @param {number} a\n * @param {number} b\n */var sum=function sum(a,b){return a+b;};/**\n * @param {Chunk[][]} nodes\n * @param {Chunk} separator\n * @returns {Chunk[]}\n */var join=function join(nodes,separator){if(nodes.length===0)return[];var joined=(0,_toConsumableArray2.default)(nodes[0]);for(var _i15=1;_i15<nodes.length;_i15+=1){joined.push.apply(joined,[separator].concat((0,_toConsumableArray2.default)(nodes[_i15])));}return joined;};/**\n * @param {(node: any, state: State) => Chunk[]} fn\n */var scoped=function scoped(fn){/**\n\t * @param {any} node\n\t * @param {State} state\n\t */var scoped_fn=function scoped_fn(node,state){return fn(node,_objectSpread(_objectSpread({},state),{},{scope:state.scope_map.get(node)}));};return scoped_fn;};/**\n * @param {string} name\n * @param {Set<string>} names\n */var deconflict=function deconflict(name,names){var original=name;var i=1;while(names.has(name)){name=\"\".concat(original,\"$\").concat(i++);}return name;};/**\n * @param {Node[]} nodes\n * @param {State} state\n */var handle_body=function handle_body(nodes,state){var chunks=[];var body=nodes.map(function(statement){var chunks=handle(statement,_objectSpread(_objectSpread({},state),{},{indent:state.indent}));var add_newline=false;while(state.comments.length){var comment=state.comments.shift();var prefix=add_newline?\"\\n\".concat(state.indent):\" \";chunks.push(c(comment.type==='Block'?\"\".concat(prefix,\"/*\").concat(comment.value,\"*/\"):\"\".concat(prefix,\"//\").concat(comment.value)));add_newline=comment.type==='Line';}return chunks;});var needed_padding=false;for(var _i16=0;_i16<body.length;_i16+=1){var needs_padding=has_newline(body[_i16]);if(_i16>0){chunks.push(c(needs_padding||needed_padding?\"\\n\\n\".concat(state.indent):\"\\n\".concat(state.indent)));}chunks.push.apply(chunks,(0,_toConsumableArray2.default)(body[_i16]));needed_padding=needs_padding;}return chunks;};/**\n * @param {VariableDeclaration} node\n * @param {State} state\n */var handle_var_declaration=function handle_var_declaration(node,state){var chunks=[c(\"\".concat(node.kind,\" \"))];var declarators=node.declarations.map(function(d){return handle(d,_objectSpread(_objectSpread({},state),{},{indent:state.indent+(node.declarations.length===1?'':'\\t')}));});var multiple_lines=declarators.some(has_newline)||declarators.map(get_length).reduce(sum,0)+(state.indent.length+declarators.length-1)*2>80;var separator=c(multiple_lines?\",\\n\".concat(state.indent,\"\\t\"):', ');if(multiple_lines){chunks.push.apply(chunks,(0,_toConsumableArray2.default)(join(declarators,separator)));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(join(declarators,separator)));}return chunks;};/** @type {Record<string, Handler>} */var handlers={Program:function Program(node,state){return handle_body(node.body,state);},BlockStatement:scoped(function(node,state){return[c(\"{\\n\".concat(state.indent,\"\\t\"))].concat((0,_toConsumableArray2.default)(handle_body(node.body,_objectSpread(_objectSpread({},state),{},{indent:state.indent+'\\t'}))),[c(\"\\n\".concat(state.indent,\"}\"))]);}),EmptyStatement:function EmptyStatement(node,state){return[c(';')];},ParenthesizedExpression:function ParenthesizedExpression(node,state){return handle(node.expression,state);},ExpressionStatement:function ExpressionStatement(node,state){if(node.expression.type==='AssignmentExpression'&&node.expression.left.type==='ObjectPattern'){// is an AssignmentExpression to an ObjectPattern\nreturn[c('(')].concat((0,_toConsumableArray2.default)(handle(node.expression,state)),[c(');')]);}return[].concat((0,_toConsumableArray2.default)(handle(node.expression,state)),[c(';')]);},IfStatement:function IfStatement(node,state){var chunks=[c('if (')].concat((0,_toConsumableArray2.default)(handle(node.test,state)),[c(') ')],(0,_toConsumableArray2.default)(handle(node.consequent,state)));if(node.alternate){chunks.push.apply(chunks,[c(' else ')].concat((0,_toConsumableArray2.default)(handle(node.alternate,state))));}return chunks;},LabeledStatement:function LabeledStatement(node,state){return[].concat((0,_toConsumableArray2.default)(handle(node.label,state)),[c(': ')],(0,_toConsumableArray2.default)(handle(node.body,state)));},BreakStatement:function BreakStatement(node,state){return node.label?[c('break ')].concat((0,_toConsumableArray2.default)(handle(node.label,state)),[c(';')]):[c('break;')];},ContinueStatement:function ContinueStatement(node,state){return node.label?[c('continue ')].concat((0,_toConsumableArray2.default)(handle(node.label,state)),[c(';')]):[c('continue;')];},WithStatement:function WithStatement(node,state){return[c('with (')].concat((0,_toConsumableArray2.default)(handle(node.object,state)),[c(') ')],(0,_toConsumableArray2.default)(handle(node.body,state)));},SwitchStatement:function SwitchStatement(/** @type {SwitchStatement} */node,state){var chunks=[c('switch (')].concat((0,_toConsumableArray2.default)(handle(node.discriminant,state)),[c(') {')]);node.cases.forEach(function(block){if(block.test){chunks.push.apply(chunks,[c(\"\\n\".concat(state.indent,\"\\tcase \"))].concat((0,_toConsumableArray2.default)(handle(block.test,_objectSpread(_objectSpread({},state),{},{indent:\"\".concat(state.indent,\"\\t\")}))),[c(':')]));}else{chunks.push(c(\"\\n\".concat(state.indent,\"\\tdefault:\")));}block.consequent.forEach(function(statement){chunks.push.apply(chunks,[c(\"\\n\".concat(state.indent,\"\\t\\t\"))].concat((0,_toConsumableArray2.default)(handle(statement,_objectSpread(_objectSpread({},state),{},{indent:\"\".concat(state.indent,\"\\t\\t\")})))));});});chunks.push(c(\"\\n\".concat(state.indent,\"}\")));return chunks;},ReturnStatement:function ReturnStatement(node,state){if(node.argument){var contains_comment=node.argument.leadingComments&&node.argument.leadingComments.some(function(/** @type import('../utils/comments.js').CommentWithLocation */comment){return comment.has_trailing_newline;});return[c(contains_comment?'return (':'return ')].concat((0,_toConsumableArray2.default)(handle(node.argument,state)),[c(contains_comment?');':';')]);}else{return[c('return;')];}},ThrowStatement:function ThrowStatement(node,state){return[c('throw ')].concat((0,_toConsumableArray2.default)(handle(node.argument,state)),[c(';')]);},TryStatement:function TryStatement(node,state){var chunks=[c('try ')].concat((0,_toConsumableArray2.default)(handle(node.block,state)));if(node.handler){if(node.handler.param){chunks.push.apply(chunks,[c(' catch(')].concat((0,_toConsumableArray2.default)(handle(node.handler.param,state)),[c(') ')]));}else{chunks.push(c(' catch '));}chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.handler.body,state)));}if(node.finalizer){chunks.push.apply(chunks,[c(' finally ')].concat((0,_toConsumableArray2.default)(handle(node.finalizer,state))));}return chunks;},WhileStatement:function WhileStatement(node,state){return[c('while (')].concat((0,_toConsumableArray2.default)(handle(node.test,state)),[c(') ')],(0,_toConsumableArray2.default)(handle(node.body,state)));},DoWhileStatement:function DoWhileStatement(node,state){return[c('do ')].concat((0,_toConsumableArray2.default)(handle(node.body,state)),[c(' while (')],(0,_toConsumableArray2.default)(handle(node.test,state)),[c(');')]);},ForStatement:scoped(function(node,state){var chunks=[c('for (')];if(node.init){if(node.init.type==='VariableDeclaration'){chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle_var_declaration(node.init,state)));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.init,state)));}}chunks.push(c('; '));if(node.test)chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.test,state)));chunks.push(c('; '));if(node.update)chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.update,state)));chunks.push.apply(chunks,[c(') ')].concat((0,_toConsumableArray2.default)(handle(node.body,state))));return chunks;}),ForInStatement:scoped(function(node,state){var chunks=[c(\"for \".concat(node.await?'await ':'',\"(\"))];if(node.left.type==='VariableDeclaration'){chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle_var_declaration(node.left,state)));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.left,state)));}chunks.push.apply(chunks,[c(node.type==='ForInStatement'?\" in \":\" of \")].concat((0,_toConsumableArray2.default)(handle(node.right,state)),[c(') ')],(0,_toConsumableArray2.default)(handle(node.body,state))));return chunks;}),DebuggerStatement:function DebuggerStatement(node,state){return[c('debugger',node),c(';')];},FunctionDeclaration:scoped(function(/** @type {FunctionDeclaration} */node,state){var chunks=[];if(node.async)chunks.push(c('async '));chunks.push(c(node.generator?'function* ':'function '));if(node.id)chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.id,state)));chunks.push(c('('));var params=node.params.map(function(p){return handle(p,_objectSpread(_objectSpread({},state),{},{indent:state.indent+'\\t'}));});var multiple_lines=params.some(has_newline)||params.map(get_length).reduce(sum,0)+(state.indent.length+params.length-1)*2>80;var separator=c(multiple_lines?\",\\n\".concat(state.indent):', ');if(multiple_lines){chunks.push.apply(chunks,[c(\"\\n\".concat(state.indent,\"\\t\"))].concat((0,_toConsumableArray2.default)(join(params,separator)),[c(\"\\n\".concat(state.indent))]));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(join(params,separator)));}chunks.push.apply(chunks,[c(') ')].concat((0,_toConsumableArray2.default)(handle(node.body,state))));return chunks;}),VariableDeclaration:function VariableDeclaration(node,state){return handle_var_declaration(node,state).concat(c(';'));},VariableDeclarator:function VariableDeclarator(node,state){if(node.init){return[].concat((0,_toConsumableArray2.default)(handle(node.id,state)),[c(' = ')],(0,_toConsumableArray2.default)(handle(node.init,state)));}else{return handle(node.id,state);}},ClassDeclaration:function ClassDeclaration(node,state){var chunks=[c('class ')];if(node.id)chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.id,state)).concat([c(' ')]));if(node.superClass){chunks.push.apply(chunks,[c('extends ')].concat((0,_toConsumableArray2.default)(handle(node.superClass,state)),[c(' ')]));}chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.body,state)));return chunks;},ImportDeclaration:function ImportDeclaration(/** @type {ImportDeclaration} */node,state){var chunks=[c('import ')];var length=node.specifiers.length;var source=handle(node.source,state);if(length>0){var _i17=0;while(_i17<length){if(_i17>0){chunks.push(c(', '));}var specifier=node.specifiers[_i17];if(specifier.type==='ImportDefaultSpecifier'){chunks.push(c(specifier.local.name,specifier));_i17+=1;}else if(specifier.type==='ImportNamespaceSpecifier'){chunks.push(c('* as '+specifier.local.name,specifier));_i17+=1;}else{break;}}if(_i17<length){// we have named specifiers\nvar specifiers=node.specifiers.slice(_i17).map(function(/** @type {ImportSpecifier} */specifier){var name=handle(specifier.imported,state)[0];var as=handle(specifier.local,state)[0];if(name.content===as.content){return[as];}return[name,c(' as '),as];});var width=get_length(chunks)+specifiers.map(get_length).reduce(sum,0)+2*specifiers.length+6+get_length(source);if(width>80){chunks.push.apply(chunks,[c(\"{\\n\\t\")].concat((0,_toConsumableArray2.default)(join(specifiers,c(',\\n\\t'))),[c('\\n}')]));}else{chunks.push.apply(chunks,[c(\"{ \")].concat((0,_toConsumableArray2.default)(join(specifiers,c(', '))),[c(' }')]));}}chunks.push(c(' from '));}chunks.push.apply(chunks,(0,_toConsumableArray2.default)(source).concat([c(';')]));return chunks;},ImportExpression:function ImportExpression(node,state){return[c('import(')].concat((0,_toConsumableArray2.default)(handle(node.source,state)),[c(')')]);},ExportDefaultDeclaration:function ExportDefaultDeclaration(node,state){var chunks=[c(\"export default \")].concat((0,_toConsumableArray2.default)(handle(node.declaration,state)));if(node.declaration.type!=='FunctionDeclaration'){chunks.push(c(';'));}return chunks;},ExportNamedDeclaration:function ExportNamedDeclaration(node,state){var chunks=[c('export ')];if(node.declaration){chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.declaration,state)));}else{var specifiers=node.specifiers.map(function(/** @type {ExportSpecifier} */specifier){var name=handle(specifier.local,state)[0];var as=handle(specifier.exported,state)[0];if(name.content===as.content){return[name];}return[name,c(' as '),as];});var width=7+specifiers.map(get_length).reduce(sum,0)+2*specifiers.length;if(width>80){chunks.push.apply(chunks,[c('{\\n\\t')].concat((0,_toConsumableArray2.default)(join(specifiers,c(',\\n\\t'))),[c('\\n}')]));}else{chunks.push.apply(chunks,[c('{ ')].concat((0,_toConsumableArray2.default)(join(specifiers,c(', '))),[c(' }')]));}if(node.source){chunks.push.apply(chunks,[c(' from ')].concat((0,_toConsumableArray2.default)(handle(node.source,state))));}}chunks.push(c(';'));return chunks;},ExportAllDeclaration:function ExportAllDeclaration(node,state){return[c(\"export * from \")].concat((0,_toConsumableArray2.default)(handle(node.source,state)),[c(\";\")]);},MethodDefinition:function MethodDefinition(node,state){var chunks=[];if(node.static){chunks.push(c('static '));}if(node.kind==='get'||node.kind==='set'){// Getter or setter\nchunks.push(c(node.kind+' '));}if(node.value.async){chunks.push(c('async '));}if(node.value.generator){chunks.push(c('*'));}if(node.computed){chunks.push.apply(chunks,[c('[')].concat((0,_toConsumableArray2.default)(handle(node.key,state)),[c(']')]));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.key,state)));}chunks.push(c('('));var params=node.value.params;for(var _i18=0;_i18<params.length;_i18+=1){chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(params[_i18],state)));if(_i18<params.length-1)chunks.push(c(', '));}chunks.push.apply(chunks,[c(') ')].concat((0,_toConsumableArray2.default)(handle(node.value.body,state))));return chunks;},ArrowFunctionExpression:scoped(function(/** @type {ArrowFunctionExpression} */node,state){var chunks=[];if(node.async)chunks.push(c('async '));if(node.params.length===1&&node.params[0].type==='Identifier'){chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.params[0],state)));}else{var params=node.params.map(function(param){return handle(param,_objectSpread(_objectSpread({},state),{},{indent:state.indent+'\\t'}));});chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(join(params,c(', '))),[c(')')]));}chunks.push(c(' => '));if(node.body.type==='ObjectExpression'||node.body.type==='AssignmentExpression'&&node.body.left.type==='ObjectPattern'){chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(handle(node.body,state)),[c(')')]));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.body,state)));}return chunks;}),ThisExpression:function ThisExpression(node,state){return[c('this',node)];},Super:function Super(node,state){return[c('super',node)];},RestElement:function RestElement(node,state){return[c('...')].concat((0,_toConsumableArray2.default)(handle(node.argument,state)));},YieldExpression:function YieldExpression(node,state){if(node.argument){return[c(node.delegate?\"yield* \":\"yield \")].concat((0,_toConsumableArray2.default)(handle(node.argument,state)));}return[c(node.delegate?\"yield*\":\"yield\")];},AwaitExpression:function AwaitExpression(node,state){if(node.argument){var precedence=EXPRESSIONS_PRECEDENCE[node.argument.type];if(precedence&&precedence<EXPRESSIONS_PRECEDENCE.AwaitExpression){return[c('await (')].concat((0,_toConsumableArray2.default)(handle(node.argument,state)),[c(')')]);}else{return[c('await ')].concat((0,_toConsumableArray2.default)(handle(node.argument,state)));}}return[c('await')];},TemplateLiteral:function TemplateLiteral(node,state){var chunks=[c('`')];var quasis=node.quasis,expressions=node.expressions;for(var _i19=0;_i19<expressions.length;_i19++){chunks.push.apply(chunks,[c(quasis[_i19].value.raw),c('${')].concat((0,_toConsumableArray2.default)(handle(expressions[_i19],state)),[c('}')]));}chunks.push(c(quasis[quasis.length-1].value.raw),c('`'));return chunks;},TaggedTemplateExpression:function TaggedTemplateExpression(node,state){return handle(node.tag,state).concat(handle(node.quasi,state));},ArrayExpression:function ArrayExpression(node,state){var chunks=[c('[')];/** @type {Chunk[][]} */var elements=[];/** @type {Chunk[]} */var sparse_commas=[];for(var _i20=0;_i20<node.elements.length;_i20+=1){// can't use map/forEach because of sparse arrays\nvar element=node.elements[_i20];if(element){elements.push([].concat((0,_toConsumableArray2.default)(sparse_commas),(0,_toConsumableArray2.default)(handle(element,_objectSpread(_objectSpread({},state),{},{indent:state.indent+'\\t'})))));sparse_commas=[];}else{sparse_commas.push(c(','));}}var multiple_lines=elements.some(has_newline)||elements.map(get_length).reduce(sum,0)+(state.indent.length+elements.length-1)*2>80;if(multiple_lines){chunks.push.apply(chunks,[c(\"\\n\".concat(state.indent,\"\\t\"))].concat((0,_toConsumableArray2.default)(join(elements,c(\",\\n\".concat(state.indent,\"\\t\")))),[c(\"\\n\".concat(state.indent))],(0,_toConsumableArray2.default)(sparse_commas)));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(join(elements,c(', '))).concat((0,_toConsumableArray2.default)(sparse_commas)));}chunks.push(c(']'));return chunks;},ObjectExpression:function ObjectExpression(/** @type {ObjectExpression} */node,state){if(node.properties.length===0){return[c('{}')];}var has_inline_comment=false;/** @type {Chunk[]} */var chunks=[];var separator=c(', ');node.properties.forEach(function(p,i){chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(p,_objectSpread(_objectSpread({},state),{},{indent:state.indent+'\\t'}))));if(state.comments.length){// TODO generalise this, so it works with ArrayExpressions and other things.\n// At present, stuff will just get appended to the closest statement/declaration\nchunks.push(c(', '));while(state.comments.length){var comment=state.comments.shift();chunks.push(c(comment.type==='Block'?\"/*\".concat(comment.value,\"*/\\n\").concat(state.indent,\"\\t\"):\"//\".concat(comment.value,\"\\n\").concat(state.indent,\"\\t\")));if(comment.type==='Line'){has_inline_comment=true;}}}else{if(i<node.properties.length-1){chunks.push(separator);}}});var multiple_lines=has_inline_comment||has_newline(chunks)||get_length(chunks)>40;if(multiple_lines){separator.content=\",\\n\".concat(state.indent,\"\\t\");}return[c(multiple_lines?\"{\\n\".concat(state.indent,\"\\t\"):\"{ \")].concat(chunks,[c(multiple_lines?\"\\n\".concat(state.indent,\"}\"):\" }\")]);},Property:function Property(node,state){var value=handle(node.value,state);if(node.key===node.value){return value;}// special case\nif(!node.computed&&node.value.type==='AssignmentPattern'&&node.value.left.type==='Identifier'&&node.value.left.name===node.key.name){return value;}if(!node.computed&&node.value.type==='Identifier'&&(node.key.type==='Identifier'&&node.key.name===value[0].content||node.key.type==='Literal'&&node.key.value===value[0].content)){return value;}var key=handle(node.key,state);if(node.value.type==='FunctionExpression'&&!node.value.id){state=_objectSpread(_objectSpread({},state),{},{scope:state.scope_map.get(node.value)});var chunks=node.kind!=='init'?[c(\"\".concat(node.kind,\" \"))]:[];if(node.value.async){chunks.push(c('async '));}if(node.value.generator){chunks.push(c('*'));}chunks.push.apply(chunks,(0,_toConsumableArray2.default)(node.computed?[c('[')].concat((0,_toConsumableArray2.default)(key),[c(']')]):key).concat([c('(')],(0,_toConsumableArray2.default)(join(node.value.params.map(function(/** @type {Pattern} */param){return handle(param,state);}),c(', '))),[c(') ')],(0,_toConsumableArray2.default)(handle(node.value.body,state))));return chunks;}if(node.computed){return[c('[')].concat((0,_toConsumableArray2.default)(key),[c(']: ')],(0,_toConsumableArray2.default)(value));}return[].concat((0,_toConsumableArray2.default)(key),[c(': ')],(0,_toConsumableArray2.default)(value));},ObjectPattern:function ObjectPattern(node,state){var chunks=[c('{ ')];for(var _i21=0;_i21<node.properties.length;_i21+=1){chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.properties[_i21],state)));if(_i21<node.properties.length-1)chunks.push(c(', '));}chunks.push(c(' }'));return chunks;},SequenceExpression:function SequenceExpression(/** @type {SequenceExpression} */node,state){var expressions=node.expressions.map(function(e){return handle(e,state);});return[c('(')].concat((0,_toConsumableArray2.default)(join(expressions,c(', '))),[c(')')]);},UnaryExpression:function UnaryExpression(node,state){var chunks=[c(node.operator)];if(node.operator.length>1){chunks.push(c(' '));}if(EXPRESSIONS_PRECEDENCE[node.argument.type]<EXPRESSIONS_PRECEDENCE.UnaryExpression){chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(handle(node.argument,state)),[c(')')]));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.argument,state)));}return chunks;},UpdateExpression:function UpdateExpression(node,state){return node.prefix?[c(node.operator)].concat((0,_toConsumableArray2.default)(handle(node.argument,state))):[].concat((0,_toConsumableArray2.default)(handle(node.argument,state)),[c(node.operator)]);},AssignmentExpression:function AssignmentExpression(node,state){return[].concat((0,_toConsumableArray2.default)(handle(node.left,state)),[c(\" \".concat(node.operator||'=',\" \"))],(0,_toConsumableArray2.default)(handle(node.right,state)));},BinaryExpression:function BinaryExpression(node,state){var chunks=[];// TODO\n// const is_in = node.operator === 'in';\n// if (is_in) {\n// \t// Avoids confusion in `for` loops initializers\n// \tchunks.push(c('('));\n// }\nif(needs_parens(node.left,node,false)){chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(handle(node.left,state)),[c(')')]));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.left,state)));}chunks.push(c(\" \".concat(node.operator,\" \")));if(needs_parens(node.right,node,true)){chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(handle(node.right,state)),[c(')')]));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.right,state)));}return chunks;},ConditionalExpression:function ConditionalExpression(node,state){var chunks=[];if(EXPRESSIONS_PRECEDENCE[node.test.type]>EXPRESSIONS_PRECEDENCE.ConditionalExpression){chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.test,state)));}else{chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(handle(node.test,state)),[c(')')]));}var child_state=_objectSpread(_objectSpread({},state),{},{indent:state.indent+'\\t'});var consequent=handle(node.consequent,child_state);var alternate=handle(node.alternate,child_state);var multiple_lines=has_newline(consequent)||has_newline(alternate)||get_length(chunks)+get_length(consequent)+get_length(alternate)>50;if(multiple_lines){chunks.push.apply(chunks,[c(\"\\n\".concat(state.indent,\"? \"))].concat((0,_toConsumableArray2.default)(consequent),[c(\"\\n\".concat(state.indent,\": \"))],(0,_toConsumableArray2.default)(alternate)));}else{chunks.push.apply(chunks,[c(\" ? \")].concat((0,_toConsumableArray2.default)(consequent),[c(\" : \")],(0,_toConsumableArray2.default)(alternate)));}return chunks;},NewExpression:function NewExpression(/** @type {NewExpression} */node,state){var chunks=[c('new ')];if(EXPRESSIONS_PRECEDENCE[node.callee.type]<EXPRESSIONS_PRECEDENCE.CallExpression||has_call_expression(node.callee)){chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(handle(node.callee,state)),[c(')')]));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.callee,state)));}// TODO this is copied from CallExpression — DRY it out\nvar args=node.arguments.map(function(arg){return handle(arg,_objectSpread(_objectSpread({},state),{},{indent:state.indent+'\\t'}));});var separator=args.some(has_newline)// TODO or length exceeds 80\n?c(',\\n'+state.indent):c(', ');chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(join(args,separator)),[c(')')]));return chunks;},ChainExpression:function ChainExpression(node,state){return handle(node.expression,state);},CallExpression:function CallExpression(/** @type {CallExpression} */node,state){var chunks=[];if(EXPRESSIONS_PRECEDENCE[node.callee.type]<EXPRESSIONS_PRECEDENCE.CallExpression){chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(handle(node.callee,state)),[c(')')]));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.callee,state)));}if(/** @type {SimpleCallExpression} */node.optional){chunks.push(c('?.'));}var args=node.arguments.map(function(arg){return handle(arg,state);});var multiple_lines=args.slice(0,-1).some(has_newline);// TODO or length exceeds 80\nif(multiple_lines){// need to handle args again. TODO find alternative approach?\nvar _args=node.arguments.map(function(arg){return handle(arg,_objectSpread(_objectSpread({},state),{},{indent:\"\".concat(state.indent,\"\\t\")}));});chunks.push.apply(chunks,[c(\"(\\n\".concat(state.indent,\"\\t\"))].concat((0,_toConsumableArray2.default)(join(_args,c(\",\\n\".concat(state.indent,\"\\t\")))),[c(\"\\n\".concat(state.indent,\")\"))]));}else{chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(join(args,c(', '))),[c(')')]));}return chunks;},MemberExpression:function MemberExpression(node,state){var chunks=[];if(EXPRESSIONS_PRECEDENCE[node.object.type]<EXPRESSIONS_PRECEDENCE.MemberExpression){chunks.push.apply(chunks,[c('(')].concat((0,_toConsumableArray2.default)(handle(node.object,state)),[c(')')]));}else{chunks.push.apply(chunks,(0,_toConsumableArray2.default)(handle(node.object,state)));}if(node.computed){if(node.optional){chunks.push(c('?.'));}chunks.push.apply(chunks,[c('[')].concat((0,_toConsumableArray2.default)(handle(node.property,state)),[c(']')]));}else{chunks.push.apply(chunks,[c(node.optional?'?.':'.')].concat((0,_toConsumableArray2.default)(handle(node.property,state))));}return chunks;},MetaProperty:function MetaProperty(node,state){return[].concat((0,_toConsumableArray2.default)(handle(node.meta,state)),[c('.')],(0,_toConsumableArray2.default)(handle(node.property,state)));},Identifier:function Identifier(node,state){var name=node.name;if(name[0]==='@'){name=state.getName(name.slice(1));}else if(node.name[0]==='#'){var owner=state.scope.find_owner(node.name);if(!owner){throw new Error(\"Could not find owner for node\");}if(!state.deconflicted.has(owner)){state.deconflicted.set(owner,new Map());}var deconflict_map=state.deconflicted.get(owner);if(!deconflict_map.has(node.name)){deconflict_map.set(node.name,deconflict(node.name.slice(1),owner.references));}name=deconflict_map.get(node.name);}return[c(name,node)];},Literal:function Literal(/** @type {Literal} */node,state){if(typeof node.value==='string'){return[// TODO do we need to handle weird unicode characters somehow?\n// str.replace(/\\\\u(\\d{4})/g, (m, n) => String.fromCharCode(+n))\nc((node.raw||JSON.stringify(node.value)).replace(re,function(_m,_i,at,hash,name){if(at)return'@'+name;if(hash)return'#'+name;throw new Error(\"this shouldn't happen\");}),node)];}return[c(node.raw||String(node.value),node)];}};handlers.ForOfStatement=handlers.ForInStatement;handlers.FunctionExpression=handlers.FunctionDeclaration;handlers.ClassExpression=handlers.ClassDeclaration;handlers.ClassBody=handlers.BlockStatement;handlers.SpreadElement=handlers.RestElement;handlers.ArrayPattern=handlers.ArrayExpression;handlers.LogicalExpression=handlers.BinaryExpression;handlers.AssignmentPattern=handlers.AssignmentExpression;var charToInteger={};var chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';for(var i=0;i<chars.length;i++){charToInteger[chars.charCodeAt(i)]=i;}function decode(mappings){var decoded=[];var line=[];var segment=[0,0,0,0,0];var j=0;for(var i=0,shift=0,value=0;i<mappings.length;i++){var c=mappings.charCodeAt(i);if(c===44){// \",\"\nsegmentify(line,segment,j);j=0;}else if(c===59){// \";\"\nsegmentify(line,segment,j);j=0;decoded.push(line);line=[];segment[0]=0;}else{var integer=charToInteger[c];if(integer===undefined){throw new Error('Invalid character ('+String.fromCharCode(c)+')');}var hasContinuationBit=integer&32;integer&=31;value+=integer<<shift;if(hasContinuationBit){shift+=5;}else{var shouldNegate=value&1;value>>>=1;if(shouldNegate){value=value===0?-0x80000000:-value;}segment[j]+=value;j++;value=shift=0;// reset\n}}}segmentify(line,segment,j);decoded.push(line);return decoded;}function segmentify(line,segment,j){// This looks ugly, but we're creating specialized arrays with a specific\n// length. This is much faster than creating a new array (which v8 expands to\n// a capacity of 17 after pushing the first item), or slicing out a subarray\n// (which is slow). Length 4 is assumed to be the most frequent, followed by\n// length 5 (since not everything will have an associated name), followed by\n// length 1 (it's probably rare for a source substring to not have an\n// associated segment data).\nif(j===4)line.push([segment[0],segment[1],segment[2],segment[3]]);else if(j===5)line.push([segment[0],segment[1],segment[2],segment[3],segment[4]]);else if(j===1)line.push([segment[0]]);}function encode(decoded){var sourceFileIndex=0;// second field\nvar sourceCodeLine=0;// third field\nvar sourceCodeColumn=0;// fourth field\nvar nameIndex=0;// fifth field\nvar mappings='';for(var i=0;i<decoded.length;i++){var line=decoded[i];if(i>0)mappings+=';';if(line.length===0)continue;var generatedCodeColumn=0;// first field\nvar lineMappings=[];for(var _i=0,line_1=line;_i<line_1.length;_i++){var segment=line_1[_i];var segmentMappings=encodeInteger(segment[0]-generatedCodeColumn);generatedCodeColumn=segment[0];if(segment.length>1){segmentMappings+=encodeInteger(segment[1]-sourceFileIndex)+encodeInteger(segment[2]-sourceCodeLine)+encodeInteger(segment[3]-sourceCodeColumn);sourceFileIndex=segment[1];sourceCodeLine=segment[2];sourceCodeColumn=segment[3];}if(segment.length===5){segmentMappings+=encodeInteger(segment[4]-nameIndex);nameIndex=segment[4];}lineMappings.push(segmentMappings);}mappings+=lineMappings.join(',');}return mappings;}function encodeInteger(num){var result='';num=num<0?-num<<1|1:num<<1;do{var clamped=num&31;num>>>=5;if(num>0){clamped|=32;}result+=chars[clamped];}while(num>0);return result;}/** @type {(str?: string) => string} str */var btoa$1=function btoa$1(){throw new Error('Unsupported environment: `window.btoa` or `Buffer` should be supported.');};if(typeof window!=='undefined'&&typeof window.btoa==='function'){btoa$1=function btoa$1(str){return window.btoa(unescape(encodeURIComponent(str)));};}else if(typeof Buffer==='function'){btoa$1=function btoa$1(str){return Buffer.from(str,'utf-8').toString('base64');};}/** @typedef {import('estree').Node} Node */ /**\n * @typedef {{\n *   file?: string;\n *   sourceMapSource?: string;\n *   sourceMapContent?: string;\n *   sourceMapEncodeMappings?: boolean; // default true\n *   getName?: (name: string) => string;\n * }} PrintOptions\n */ /**\n * @param {Node} node\n * @param {PrintOptions} opts\n * @returns {{ code: string, map: any }} // TODO\n */function print(node){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(Array.isArray(node)){return print({type:'Program',body:node,sourceType:'module'},opts);}var _opts$getName=opts.getName,getName=_opts$getName===void 0?/** @param {string} x */function(x){throw new Error(\"Unhandled sigil @\".concat(x));}:_opts$getName;var _analyze=analyze(node),scope_map=_analyze.map,scope=_analyze.scope;var deconflicted=new WeakMap();var chunks=handle(node,{indent:'',getName:getName,scope:scope,scope_map:scope_map,deconflicted:deconflicted,comments:[]});/** @typedef {[number, number, number, number]} Segment */var code='';var current_column=0;/** @type {Segment[][]} */var mappings=[];/** @type {Segment[]} */var current_line=[];for(var _i22=0;_i22<chunks.length;_i22+=1){var chunk=chunks[_i22];code+=chunk.content;if(chunk.loc){current_line.push([current_column,0,// source index is always zero\nchunk.loc.start.line-1,chunk.loc.start.column]);}for(var _i23=0;_i23<chunk.content.length;_i23+=1){if(chunk.content[_i23]==='\\n'){mappings.push(current_line);current_line=[];current_column=0;}else{current_column+=1;}}if(chunk.loc){current_line.push([current_column,0,// source index is always zero\nchunk.loc.end.line-1,chunk.loc.end.column]);}}mappings.push(current_line);var map={version:3,/** @type {string[]} */names:[],sources:[opts.sourceMapSource||null],sourcesContent:[opts.sourceMapContent||null],mappings:opts.sourceMapEncodeMappings==undefined||opts.sourceMapEncodeMappings?encode(mappings):mappings};Object.defineProperties(map,{toString:{enumerable:false,value:function toString(){return JSON.stringify(this);}},toUrl:{enumerable:false,value:function toUrl(){return'data:application/json;charset=utf-8;base64,'+btoa$1(this.toString());}}});return{code:code,map:map};}/** @typedef {import('estree').Expression} Expression */ /** @typedef {import('estree').Node} Node */ /** @typedef {import('estree').ObjectExpression} ObjectExpression */ /** @typedef {import('estree').Property} Property */ /** @typedef {import('estree').SpreadElement} SpreadElement */ /** @typedef {import('./utils/comments').CommentWithLocation} CommentWithLocation */ /** @type {Record<string, string>} */var sigils={'@':'AT','#':'HASH'};/** @param {TemplateStringsArray} strings */var join$1=function join$1(strings){var str=strings[0];for(var _i24=1;_i24<strings.length;_i24+=1){str+=\"_\".concat(id,\"_\").concat(_i24-1,\"_\").concat(strings[_i24]);}return str.replace(/([@#])(\\w+)/g,function(_m,sigil,name){return\"_\".concat(id,\"_\").concat(sigils[sigil],\"_\").concat(name);});};/**\n * @param {any[]} array\n * @param {any[]} target\n */var flatten_body=function flatten_body(array,target){for(var _i25=0;_i25<array.length;_i25+=1){var statement=array[_i25];if(Array.isArray(statement)){flatten_body(statement,target);continue;}if(statement.type==='ExpressionStatement'){if(statement.expression===EMPTY)continue;if(Array.isArray(statement.expression)){// TODO this is hacktacular\nvar _node4=statement.expression[0];while(Array.isArray(_node4)){_node4=_node4[0];}if(_node4)_node4.leadingComments=statement.leadingComments;flatten_body(statement.expression,target);continue;}if(/(Expression|Literal)$/.test(statement.expression.type)){target.push(statement);continue;}if(statement.leadingComments)statement.expression.leadingComments=statement.leadingComments;if(statement.trailingComments)statement.expression.trailingComments=statement.trailingComments;target.push(statement.expression);continue;}target.push(statement);}return target;};/**\n * @param {any[]} array\n * @param {any[]} target\n */var flatten_properties=function flatten_properties(array,target){for(var _i26=0;_i26<array.length;_i26+=1){var property=array[_i26];if(property.value===EMPTY)continue;if(property.key===property.value&&Array.isArray(property.key)){flatten_properties(property.key,target);continue;}target.push(property);}return target;};/**\n * @param {any[]} nodes\n * @param {any[]} target\n */var flatten$1=function flatten$1(nodes,target){for(var _i27=0;_i27<nodes.length;_i27+=1){var _node5=nodes[_i27];if(_node5===EMPTY)continue;if(Array.isArray(_node5)){flatten$1(_node5,target);continue;}target.push(_node5);}return target;};var EMPTY={type:'Empty'};/**\n *\n * @param {CommentWithLocation[]} comments\n * @param {string} raw\n * @returns {any}\n */var acorn_opts=function acorn_opts(comments,raw){var _get_comment_handlers=get_comment_handlers(comments,raw),onComment=_get_comment_handlers.onComment;return{ecmaVersion:2020,sourceType:'module',allowAwaitOutsideFunction:true,allowImportExportEverywhere:true,allowReturnOutsideFunction:true,onComment:onComment};};/**\n * @param {string} raw\n * @param {Node} node\n * @param {any[]} values\n * @param {CommentWithLocation[]} comments\n */var inject=function inject(raw,node,values,comments){comments.forEach(function(comment){comment.value=comment.value.replace(re,function(m,i){return+i in values?values[+i]:m;});});var _get_comment_handlers2=get_comment_handlers(comments,raw),enter=_get_comment_handlers2.enter,_leave=_get_comment_handlers2.leave;return walk(node,{enter:enter,/** @param {any} node */leave:function leave(node){if(node.type==='Identifier'){re.lastIndex=0;var match=re.exec(node.name);if(match){if(match[1]){if(+match[1]in values){var _value3=values[+match[1]];if(typeof _value3==='string'){_value3={type:'Identifier',name:_value3,leadingComments:node.leadingComments,trailingComments:node.trailingComments};}else if(typeof _value3==='number'){_value3={type:'Literal',value:_value3,leadingComments:node.leadingComments,trailingComments:node.trailingComments};}this.replace(_value3||EMPTY);}}else{node.name=\"\".concat(match[2]?\"@\":\"#\").concat(match[4]);}}}if(node.type==='Literal'){if(typeof node.value==='string'){re.lastIndex=0;var new_value=/** @type {string} */node.value.replace(re,function(m,i){return+i in values?values[+i]:m;});var has_changed=new_value!==node.value;node.value=new_value;if(has_changed&&node.raw){// preserve the quotes\nnode.raw=\"\".concat(node.raw[0]).concat(JSON.stringify(node.value).slice(1,-1)).concat(node.raw[node.raw.length-1]);}}}if(node.type==='TemplateElement'){re.lastIndex=0;node.value.raw=/** @type {string} */node.value.raw.replace(re,function(m,i){return+i in values?values[+i]:m;});}if(node.type==='Program'||node.type==='BlockStatement'){node.body=flatten_body(node.body,[]);}if(node.type==='ObjectExpression'||node.type==='ObjectPattern'){node.properties=flatten_properties(node.properties,[]);}if(node.type==='ArrayExpression'||node.type==='ArrayPattern'){node.elements=flatten$1(node.elements,[]);}if(node.type==='FunctionExpression'||node.type==='FunctionDeclaration'||node.type==='ArrowFunctionExpression'){node.params=flatten$1(node.params,[]);}if(node.type==='CallExpression'||node.type==='NewExpression'){node.arguments=flatten$1(node.arguments,[]);}if(node.type==='ImportDeclaration'||node.type==='ExportNamedDeclaration'){node.specifiers=flatten$1(node.specifiers,[]);}if(node.type==='ForStatement'){node.init=node.init===EMPTY?null:node.init;node.test=node.test===EMPTY?null:node.test;node.update=node.update===EMPTY?null:node.update;}_leave(node);}});};/**\n *\n * @param {TemplateStringsArray} strings\n * @param  {any[]} values\n * @returns {Node[]}\n */function b(strings){var str=join$1(strings);/** @type {CommentWithLocation[]} */var comments=[];try{var ast=/** @type {any} */parse(str,acorn_opts(comments,str));for(var _len=arguments.length,values=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){values[_key-1]=arguments[_key];}ast=inject(str,ast,values,comments);return ast.body;}catch(err){handle_error(str,err);}}/**\n *\n * @param {TemplateStringsArray} strings\n * @param  {any[]} values\n * @returns {Expression & { start: Number, end: number }}\n */function x(strings){var str=join$1(strings);/** @type {CommentWithLocation[]} */var comments=[];try{var _expression=/** @type {Expression & { start: Number, end: number }} */parseExpressionAt(str,0,acorn_opts(comments,str));var match=/\\S+/.exec(str.slice(_expression.end));if(match){throw new Error(\"Unexpected token '\".concat(match[0],\"'\"));}for(var _len2=arguments.length,values=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){values[_key2-1]=arguments[_key2];}_expression=/** @type {Expression & { start: Number, end: number }} */inject(str,_expression,values,comments);return _expression;}catch(err){handle_error(str,err);}}/**\n *\n * @param {TemplateStringsArray} strings\n * @param  {any[]} values\n * @returns {(Property | SpreadElement) & { start: Number, end: number }}\n */function p(strings){var str=\"{\".concat(join$1(strings),\"}\");/** @type {CommentWithLocation[]} */var comments=[];try{var _expression2=/** @type {any} */parseExpressionAt(str,0,acorn_opts(comments,str));for(var _len3=arguments.length,values=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){values[_key3-1]=arguments[_key3];}_expression2=inject(str,_expression2,values,comments);return _expression2.properties[0];}catch(err){handle_error(str,err);}}/**\n * @param {string} str\n * @param {Error} err\n */function handle_error(str,err){// TODO location/code frame\nre.lastIndex=0;str=str.replace(re,function(m,i,at,hash,name){if(at)return\"@\".concat(name);if(hash)return\"#\".concat(name);return'${...}';});console.log(\"failed to parse:\\n\".concat(str));throw err;}/**\n * @param {string} source\n * @param {any} opts\n */var parse$1=function parse$1(source,opts){/** @type {CommentWithLocation[]} */var comments=[];var _get_comment_handlers3=get_comment_handlers(comments,source),onComment=_get_comment_handlers3.onComment,enter=_get_comment_handlers3.enter,leave=_get_comment_handlers3.leave;var ast=/** @type {any} */parse(source,_objectSpread({onComment:onComment},opts));walk(ast,{enter:enter,leave:leave});return ast;};/**\n * @param {string} source\n * @param {number} index\n * @param {any} opts\n */var parseExpressionAt$1=function parseExpressionAt$1(source,index,opts){/** @type {CommentWithLocation[]} */var comments=[];var _get_comment_handlers4=get_comment_handlers(comments,source),onComment=_get_comment_handlers4.onComment,enter=_get_comment_handlers4.enter,leave=_get_comment_handlers4.leave;var ast=/** @type {any} */parseExpressionAt(source,index,_objectSpread({onComment:onComment},opts));walk(ast,{enter:enter,leave:leave});return ast;};var parse$2=function parse$2(source){return parse$1(source,{sourceType:'module',ecmaVersion:12,locations:true});};var parse_expression_at=function parse_expression_at(source,index){return parseExpressionAt$1(source,index,{sourceType:'module',ecmaVersion:12,locations:true});};var whitespace=/[ \\t\\r\\n]/;var start_whitespace=/^[ \\t\\r\\n]*/;var end_whitespace=/[ \\t\\r\\n]*$/;var dimensions=/^(?:offset|client)(?:Width|Height)$/;function read_expression(parser){try{var _node6=parse_expression_at(parser.template,parser.index);var num_parens=0;for(var _i28=parser.index;_i28<_node6.start;_i28+=1){if(parser.template[_i28]==='(')num_parens+=1;}var index=_node6.end;while(num_parens>0){var char=parser.template[index];if(char===')'){num_parens-=1;}else if(!whitespace.test(char)){parser.error(parser_errors.unexpected_token(')'),index);}index+=1;}parser.index=index;return _node6;}catch(err){parser.acorn_error(err);}}function get_context(parser,attributes,start){var context=attributes.find(function(attribute){return attribute.name==='context';});if(!context)return'default';if(context.value.length!==1||context.value[0].type!=='Text'){parser.error(parser_errors.invalid_script_context_attribute,start);}var value=context.value[0].data;if(value!=='module'){parser.error(parser_errors.invalid_script_context_value,context.start);}return value;}function read_script(parser,start,attributes){var script_start=parser.index;var data=parser.read_until(/<\\/script\\s*>/,parser_errors.unclosed_script);if(parser.index>=parser.template.length){parser.error(parser_errors.unclosed_script);}var source=parser.template.slice(0,script_start).replace(/[^\\n]/g,' ')+data;parser.read(/<\\/script\\s*>/);var ast;try{ast=parse$2(source);}catch(err){parser.acorn_error(err);}// TODO is this necessary?\nast.start=script_start;return{type:'Script',start:start,end:parser.index,context:get_context(parser,attributes,start),content:ast};}var MIN_SIZE=16*1024;var SafeUint32Array=typeof Uint32Array!=='undefined'?Uint32Array:Array;// fallback on Array when TypedArray is not supported\nvar adoptBuffer=function adoptBuffer(buffer,size){if(buffer===null||buffer.length<size){return new SafeUint32Array(Math.max(size+1024,MIN_SIZE));}return buffer;};// CSS Syntax Module Level 3\n// https://www.w3.org/TR/css-syntax-3/\nvar TYPE={EOF:0,// <EOF-token>\nIdent:1,// <ident-token>\nFunction:2,// <function-token>\nAtKeyword:3,// <at-keyword-token>\nHash:4,// <hash-token>\nString:5,// <string-token>\nBadString:6,// <bad-string-token>\nUrl:7,// <url-token>\nBadUrl:8,// <bad-url-token>\nDelim:9,// <delim-token>\nNumber:10,// <number-token>\nPercentage:11,// <percentage-token>\nDimension:12,// <dimension-token>\nWhiteSpace:13,// <whitespace-token>\nCDO:14,// <CDO-token>\nCDC:15,// <CDC-token>\nColon:16,// <colon-token>     :\nSemicolon:17,// <semicolon-token> ;\nComma:18,// <comma-token>     ,\nLeftSquareBracket:19,// <[-token>\nRightSquareBracket:20,// <]-token>\nLeftParenthesis:21,// <(-token>\nRightParenthesis:22,// <)-token>\nLeftCurlyBracket:23,// <{-token>\nRightCurlyBracket:24,// <}-token>\nComment:25};var NAME=Object.keys(TYPE).reduce(function(result,key){result[TYPE[key]]=key;return result;},{});var _const={TYPE:TYPE,NAME:NAME};var EOF=0;// https://drafts.csswg.org/css-syntax-3/\n// § 4.2. Definitions\n// digit\n// A code point between U+0030 DIGIT ZERO (0) and U+0039 DIGIT NINE (9).\nfunction isDigit(code){return code>=0x0030&&code<=0x0039;}// hex digit\n// A digit, or a code point between U+0041 LATIN CAPITAL LETTER A (A) and U+0046 LATIN CAPITAL LETTER F (F),\n// or a code point between U+0061 LATIN SMALL LETTER A (a) and U+0066 LATIN SMALL LETTER F (f).\nfunction isHexDigit$1(code){return isDigit(code)||// 0 .. 9\ncode>=0x0041&&code<=0x0046||// A .. F\ncode>=0x0061&&code<=0x0066// a .. f\n;}// uppercase letter\n// A code point between U+0041 LATIN CAPITAL LETTER A (A) and U+005A LATIN CAPITAL LETTER Z (Z).\nfunction isUppercaseLetter(code){return code>=0x0041&&code<=0x005A;}// lowercase letter\n// A code point between U+0061 LATIN SMALL LETTER A (a) and U+007A LATIN SMALL LETTER Z (z).\nfunction isLowercaseLetter(code){return code>=0x0061&&code<=0x007A;}// letter\n// An uppercase letter or a lowercase letter.\nfunction isLetter(code){return isUppercaseLetter(code)||isLowercaseLetter(code);}// non-ASCII code point\n// A code point with a value equal to or greater than U+0080 <control>.\nfunction isNonAscii(code){return code>=0x0080;}// name-start code point\n// A letter, a non-ASCII code point, or U+005F LOW LINE (_).\nfunction isNameStart(code){return isLetter(code)||isNonAscii(code)||code===0x005F;}// name code point\n// A name-start code point, a digit, or U+002D HYPHEN-MINUS (-).\nfunction isName(code){return isNameStart(code)||isDigit(code)||code===0x002D;}// non-printable code point\n// A code point between U+0000 NULL and U+0008 BACKSPACE, or U+000B LINE TABULATION,\n// or a code point between U+000E SHIFT OUT and U+001F INFORMATION SEPARATOR ONE, or U+007F DELETE.\nfunction isNonPrintable(code){return code>=0x0000&&code<=0x0008||code===0x000B||code>=0x000E&&code<=0x001F||code===0x007F;}// newline\n// U+000A LINE FEED. Note that U+000D CARRIAGE RETURN and U+000C FORM FEED are not included in this definition,\n// as they are converted to U+000A LINE FEED during preprocessing.\n// TODO: we doesn't do a preprocessing, so check a code point for U+000D CARRIAGE RETURN and U+000C FORM FEED\nfunction isNewline(code){return code===0x000A||code===0x000D||code===0x000C;}// whitespace\n// A newline, U+0009 CHARACTER TABULATION, or U+0020 SPACE.\nfunction isWhiteSpace(code){return isNewline(code)||code===0x0020||code===0x0009;}// § 4.3.8. Check if two code points are a valid escape\nfunction isValidEscape(first,second){// If the first code point is not U+005C REVERSE SOLIDUS (\\), return false.\nif(first!==0x005C){return false;}// Otherwise, if the second code point is a newline or EOF, return false.\nif(isNewline(second)||second===EOF){return false;}// Otherwise, return true.\nreturn true;}// § 4.3.9. Check if three code points would start an identifier\nfunction isIdentifierStart$1(first,second,third){// Look at the first code point:\n// U+002D HYPHEN-MINUS\nif(first===0x002D){// If the second code point is a name-start code point or a U+002D HYPHEN-MINUS,\n// or the second and third code points are a valid escape, return true. Otherwise, return false.\nreturn isNameStart(second)||second===0x002D||isValidEscape(second,third);}// name-start code point\nif(isNameStart(first)){// Return true.\nreturn true;}// U+005C REVERSE SOLIDUS (\\)\nif(first===0x005C){// If the first and second code points are a valid escape, return true. Otherwise, return false.\nreturn isValidEscape(first,second);}// anything else\n// Return false.\nreturn false;}// § 4.3.10. Check if three code points would start a number\nfunction isNumberStart(first,second,third){// Look at the first code point:\n// U+002B PLUS SIGN (+)\n// U+002D HYPHEN-MINUS (-)\nif(first===0x002B||first===0x002D){// If the second code point is a digit, return true.\nif(isDigit(second)){return 2;}// Otherwise, if the second code point is a U+002E FULL STOP (.)\n// and the third code point is a digit, return true.\n// Otherwise, return false.\nreturn second===0x002E&&isDigit(third)?3:0;}// U+002E FULL STOP (.)\nif(first===0x002E){// If the second code point is a digit, return true. Otherwise, return false.\nreturn isDigit(second)?2:0;}// digit\nif(isDigit(first)){// Return true.\nreturn 1;}// anything else\n// Return false.\nreturn 0;}//\n// Misc\n//\n// detect BOM (https://en.wikipedia.org/wiki/Byte_order_mark)\nfunction isBOM(code){// UTF-16BE\nif(code===0xFEFF){return 1;}// UTF-16LE\nif(code===0xFFFE){return 1;}return 0;}// Fast code category\n//\n// https://drafts.csswg.org/css-syntax/#tokenizer-definitions\n// > non-ASCII code point\n// >   A code point with a value equal to or greater than U+0080 <control>\n// > name-start code point\n// >   A letter, a non-ASCII code point, or U+005F LOW LINE (_).\n// > name code point\n// >   A name-start code point, a digit, or U+002D HYPHEN-MINUS (-)\n// That means only ASCII code points has a special meaning and we define a maps for 0..127 codes only\nvar CATEGORY=new Array(0x80);charCodeCategory.Eof=0x80;charCodeCategory.WhiteSpace=0x82;charCodeCategory.Digit=0x83;charCodeCategory.NameStart=0x84;charCodeCategory.NonPrintable=0x85;for(var i$1=0;i$1<CATEGORY.length;i$1++){switch(true){case isWhiteSpace(i$1):CATEGORY[i$1]=charCodeCategory.WhiteSpace;break;case isDigit(i$1):CATEGORY[i$1]=charCodeCategory.Digit;break;case isNameStart(i$1):CATEGORY[i$1]=charCodeCategory.NameStart;break;case isNonPrintable(i$1):CATEGORY[i$1]=charCodeCategory.NonPrintable;break;default:CATEGORY[i$1]=i$1||charCodeCategory.Eof;}}function charCodeCategory(code){return code<0x80?CATEGORY[code]:charCodeCategory.NameStart;}var charCodeDefinitions={isDigit:isDigit,isHexDigit:isHexDigit$1,isUppercaseLetter:isUppercaseLetter,isLowercaseLetter:isLowercaseLetter,isLetter:isLetter,isNonAscii:isNonAscii,isNameStart:isNameStart,isName:isName,isNonPrintable:isNonPrintable,isNewline:isNewline,isWhiteSpace:isWhiteSpace,isValidEscape:isValidEscape,isIdentifierStart:isIdentifierStart$1,isNumberStart:isNumberStart,isBOM:isBOM,charCodeCategory:charCodeCategory};var isDigit$1=charCodeDefinitions.isDigit;var isHexDigit$2=charCodeDefinitions.isHexDigit;var isUppercaseLetter$1=charCodeDefinitions.isUppercaseLetter;var isName$1=charCodeDefinitions.isName;var isWhiteSpace$1=charCodeDefinitions.isWhiteSpace;var isValidEscape$1=charCodeDefinitions.isValidEscape;function getCharCode(source,offset){return offset<source.length?source.charCodeAt(offset):0;}function getNewlineLength(source,offset,code){if(code===13/* \\r */&&getCharCode(source,offset+1)===10/* \\n */){return 2;}return 1;}function cmpChar(testStr,offset,referenceCode){var code=testStr.charCodeAt(offset);// code.toLowerCase() for A..Z\nif(isUppercaseLetter$1(code)){code=code|32;}return code===referenceCode;}function cmpStr(testStr,start,end,referenceStr){if(end-start!==referenceStr.length){return false;}if(start<0||end>testStr.length){return false;}for(var i=start;i<end;i++){var testCode=testStr.charCodeAt(i);var referenceCode=referenceStr.charCodeAt(i-start);// testCode.toLowerCase() for A..Z\nif(isUppercaseLetter$1(testCode)){testCode=testCode|32;}if(testCode!==referenceCode){return false;}}return true;}function findWhiteSpaceStart(source,offset){for(;offset>=0;offset--){if(!isWhiteSpace$1(source.charCodeAt(offset))){break;}}return offset+1;}function findWhiteSpaceEnd(source,offset){for(;offset<source.length;offset++){if(!isWhiteSpace$1(source.charCodeAt(offset))){break;}}return offset;}function findDecimalNumberEnd(source,offset){for(;offset<source.length;offset++){if(!isDigit$1(source.charCodeAt(offset))){break;}}return offset;}// § 4.3.7. Consume an escaped code point\nfunction consumeEscaped(source,offset){// It assumes that the U+005C REVERSE SOLIDUS (\\) has already been consumed and\n// that the next input code point has already been verified to be part of a valid escape.\noffset+=2;// hex digit\nif(isHexDigit$2(getCharCode(source,offset-1))){// Consume as many hex digits as possible, but no more than 5.\n// Note that this means 1-6 hex digits have been consumed in total.\nfor(var maxOffset=Math.min(source.length,offset+5);offset<maxOffset;offset++){if(!isHexDigit$2(getCharCode(source,offset))){break;}}// If the next input code point is whitespace, consume it as well.\nvar code=getCharCode(source,offset);if(isWhiteSpace$1(code)){offset+=getNewlineLength(source,offset,code);}}return offset;}// §4.3.11. Consume a name\n// Note: This algorithm does not do the verification of the first few code points that are necessary\n// to ensure the returned code points would constitute an <ident-token>. If that is the intended use,\n// ensure that the stream starts with an identifier before calling this algorithm.\nfunction consumeName(source,offset){// Let result initially be an empty string.\n// Repeatedly consume the next input code point from the stream:\nfor(;offset<source.length;offset++){var code=source.charCodeAt(offset);// name code point\nif(isName$1(code)){// Append the code point to result.\ncontinue;}// the stream starts with a valid escape\nif(isValidEscape$1(code,getCharCode(source,offset+1))){// Consume an escaped code point. Append the returned code point to result.\noffset=consumeEscaped(source,offset)-1;continue;}// anything else\n// Reconsume the current input code point. Return result.\nbreak;}return offset;}// §4.3.12. Consume a number\nfunction consumeNumber(source,offset){var code=source.charCodeAt(offset);// 2. If the next input code point is U+002B PLUS SIGN (+) or U+002D HYPHEN-MINUS (-),\n// consume it and append it to repr.\nif(code===0x002B||code===0x002D){code=source.charCodeAt(offset+=1);}// 3. While the next input code point is a digit, consume it and append it to repr.\nif(isDigit$1(code)){offset=findDecimalNumberEnd(source,offset+1);code=source.charCodeAt(offset);}// 4. If the next 2 input code points are U+002E FULL STOP (.) followed by a digit, then:\nif(code===0x002E&&isDigit$1(source.charCodeAt(offset+1))){// 4.1 Consume them.\n// 4.2 Append them to repr.\ncode=source.charCodeAt(offset+=2);// 4.3 Set type to \"number\".\n// TODO\n// 4.4 While the next input code point is a digit, consume it and append it to repr.\noffset=findDecimalNumberEnd(source,offset);}// 5. If the next 2 or 3 input code points are U+0045 LATIN CAPITAL LETTER E (E)\n// or U+0065 LATIN SMALL LETTER E (e), ... , followed by a digit, then:\nif(cmpChar(source,offset,101/* e */)){var sign=0;code=source.charCodeAt(offset+1);// ... optionally followed by U+002D HYPHEN-MINUS (-) or U+002B PLUS SIGN (+) ...\nif(code===0x002D||code===0x002B){sign=1;code=source.charCodeAt(offset+2);}// ... followed by a digit\nif(isDigit$1(code)){// 5.1 Consume them.\n// 5.2 Append them to repr.\n// 5.3 Set type to \"number\".\n// TODO\n// 5.4 While the next input code point is a digit, consume it and append it to repr.\noffset=findDecimalNumberEnd(source,offset+1+sign+1);}}return offset;}// § 4.3.14. Consume the remnants of a bad url\n// ... its sole use is to consume enough of the input stream to reach a recovery point\n// where normal tokenizing can resume.\nfunction consumeBadUrlRemnants(source,offset){// Repeatedly consume the next input code point from the stream:\nfor(;offset<source.length;offset++){var code=source.charCodeAt(offset);// U+0029 RIGHT PARENTHESIS ())\n// EOF\nif(code===0x0029){// Return.\noffset++;break;}if(isValidEscape$1(code,getCharCode(source,offset+1))){// Consume an escaped code point.\n// Note: This allows an escaped right parenthesis (\"\\)\") to be encountered\n// without ending the <bad-url-token>. This is otherwise identical to\n// the \"anything else\" clause.\noffset=consumeEscaped(source,offset);}}return offset;}var utils={consumeEscaped:consumeEscaped,consumeName:consumeName,consumeNumber:consumeNumber,consumeBadUrlRemnants:consumeBadUrlRemnants,cmpChar:cmpChar,cmpStr:cmpStr,getNewlineLength:getNewlineLength,findWhiteSpaceStart:findWhiteSpaceStart,findWhiteSpaceEnd:findWhiteSpaceEnd};var TYPE$1=_const.TYPE;var NAME$1=_const.NAME;var cmpStr$1=utils.cmpStr;var EOF$1=TYPE$1.EOF;var WHITESPACE=TYPE$1.WhiteSpace;var COMMENT=TYPE$1.Comment;var OFFSET_MASK=0x00FFFFFF;var TYPE_SHIFT=24;var TokenStream=function TokenStream(){this.offsetAndType=null;this.balance=null;this.reset();};TokenStream.prototype={reset:function reset(){this.eof=false;this.tokenIndex=-1;this.tokenType=0;this.tokenStart=this.firstCharOffset;this.tokenEnd=this.firstCharOffset;},lookupType:function lookupType(offset){offset+=this.tokenIndex;if(offset<this.tokenCount){return this.offsetAndType[offset]>>TYPE_SHIFT;}return EOF$1;},lookupOffset:function lookupOffset(offset){offset+=this.tokenIndex;if(offset<this.tokenCount){return this.offsetAndType[offset-1]&OFFSET_MASK;}return this.source.length;},lookupValue:function lookupValue(offset,referenceStr){offset+=this.tokenIndex;if(offset<this.tokenCount){return cmpStr$1(this.source,this.offsetAndType[offset-1]&OFFSET_MASK,this.offsetAndType[offset]&OFFSET_MASK,referenceStr);}return false;},getTokenStart:function getTokenStart(tokenIndex){if(tokenIndex===this.tokenIndex){return this.tokenStart;}if(tokenIndex>0){return tokenIndex<this.tokenCount?this.offsetAndType[tokenIndex-1]&OFFSET_MASK:this.offsetAndType[this.tokenCount]&OFFSET_MASK;}return this.firstCharOffset;},// TODO: -> skipUntilBalanced\ngetRawLength:function getRawLength(startToken,mode){var cursor=startToken;var balanceEnd;var offset=this.offsetAndType[Math.max(cursor-1,0)]&OFFSET_MASK;var type;loop:for(;cursor<this.tokenCount;cursor++){balanceEnd=this.balance[cursor];// stop scanning on balance edge that points to offset before start token\nif(balanceEnd<startToken){break loop;}type=this.offsetAndType[cursor]>>TYPE_SHIFT;// check token is stop type\nswitch(mode(type,this.source,offset)){case 1:break loop;case 2:cursor++;break loop;default:offset=this.offsetAndType[cursor]&OFFSET_MASK;// fast forward to the end of balanced block\nif(this.balance[balanceEnd]===cursor){cursor=balanceEnd;}}}return cursor-this.tokenIndex;},isBalanceEdge:function isBalanceEdge(pos){return this.balance[this.tokenIndex]<pos;},isDelim:function isDelim(code,offset){if(offset){return this.lookupType(offset)===TYPE$1.Delim&&this.source.charCodeAt(this.lookupOffset(offset))===code;}return this.tokenType===TYPE$1.Delim&&this.source.charCodeAt(this.tokenStart)===code;},getTokenValue:function getTokenValue(){return this.source.substring(this.tokenStart,this.tokenEnd);},getTokenLength:function getTokenLength(){return this.tokenEnd-this.tokenStart;},substrToCursor:function substrToCursor(start){return this.source.substring(start,this.tokenStart);},skipWS:function skipWS(){for(var i=this.tokenIndex,skipTokenCount=0;i<this.tokenCount;i++,skipTokenCount++){if(this.offsetAndType[i]>>TYPE_SHIFT!==WHITESPACE){break;}}if(skipTokenCount>0){this.skip(skipTokenCount);}},skipSC:function skipSC(){while(this.tokenType===WHITESPACE||this.tokenType===COMMENT){this.next();}},skip:function skip(tokenCount){var next=this.tokenIndex+tokenCount;if(next<this.tokenCount){this.tokenIndex=next;this.tokenStart=this.offsetAndType[next-1]&OFFSET_MASK;next=this.offsetAndType[next];this.tokenType=next>>TYPE_SHIFT;this.tokenEnd=next&OFFSET_MASK;}else{this.tokenIndex=this.tokenCount;this.next();}},next:function next(){var next=this.tokenIndex+1;if(next<this.tokenCount){this.tokenIndex=next;this.tokenStart=this.tokenEnd;next=this.offsetAndType[next];this.tokenType=next>>TYPE_SHIFT;this.tokenEnd=next&OFFSET_MASK;}else{this.tokenIndex=this.tokenCount;this.eof=true;this.tokenType=EOF$1;this.tokenStart=this.tokenEnd=this.source.length;}},forEachToken:function forEachToken(fn){for(var i=0,offset=this.firstCharOffset;i<this.tokenCount;i++){var start=offset;var item=this.offsetAndType[i];var end=item&OFFSET_MASK;var type=item>>TYPE_SHIFT;offset=end;fn(type,start,end,i);}},dump:function dump(){var _this5=this;var tokens=new Array(this.tokenCount);this.forEachToken(function(type,start,end,index){tokens[index]={idx:index,type:NAME$1[type],chunk:_this5.source.substring(start,end),balance:_this5.balance[index]};});return tokens;}};var TokenStream_1=TokenStream;var TYPE$2=_const.TYPE;var isNewline$1=charCodeDefinitions.isNewline;var isName$2=charCodeDefinitions.isName;var isValidEscape$2=charCodeDefinitions.isValidEscape;var isNumberStart$1=charCodeDefinitions.isNumberStart;var isIdentifierStart$2=charCodeDefinitions.isIdentifierStart;var charCodeCategory$1=charCodeDefinitions.charCodeCategory;var isBOM$1=charCodeDefinitions.isBOM;var cmpStr$2=utils.cmpStr;var getNewlineLength$1=utils.getNewlineLength;var findWhiteSpaceEnd$1=utils.findWhiteSpaceEnd;var consumeEscaped$1=utils.consumeEscaped;var consumeName$1=utils.consumeName;var consumeNumber$1=utils.consumeNumber;var consumeBadUrlRemnants$1=utils.consumeBadUrlRemnants;var OFFSET_MASK$1=0x00FFFFFF;var TYPE_SHIFT$1=24;function tokenize(source,stream){function getCharCode(offset){return offset<sourceLength?source.charCodeAt(offset):0;}// § 4.3.3. Consume a numeric token\nfunction consumeNumericToken(){// Consume a number and let number be the result.\noffset=consumeNumber$1(source,offset);// If the next 3 input code points would start an identifier, then:\nif(isIdentifierStart$2(getCharCode(offset),getCharCode(offset+1),getCharCode(offset+2))){// Create a <dimension-token> with the same value and type flag as number, and a unit set initially to the empty string.\n// Consume a name. Set the <dimension-token>’s unit to the returned value.\n// Return the <dimension-token>.\ntype=TYPE$2.Dimension;offset=consumeName$1(source,offset);return;}// Otherwise, if the next input code point is U+0025 PERCENTAGE SIGN (%), consume it.\nif(getCharCode(offset)===0x0025){// Create a <percentage-token> with the same value as number, and return it.\ntype=TYPE$2.Percentage;offset++;return;}// Otherwise, create a <number-token> with the same value and type flag as number, and return it.\ntype=TYPE$2.Number;}// § 4.3.4. Consume an ident-like token\nfunction consumeIdentLikeToken(){var nameStartOffset=offset;// Consume a name, and let string be the result.\noffset=consumeName$1(source,offset);// If string’s value is an ASCII case-insensitive match for \"url\",\n// and the next input code point is U+0028 LEFT PARENTHESIS ((), consume it.\nif(cmpStr$2(source,nameStartOffset,offset,'url')&&getCharCode(offset)===0x0028){// While the next two input code points are whitespace, consume the next input code point.\noffset=findWhiteSpaceEnd$1(source,offset+1);// If the next one or two input code points are U+0022 QUOTATION MARK (\"), U+0027 APOSTROPHE ('),\n// or whitespace followed by U+0022 QUOTATION MARK (\") or U+0027 APOSTROPHE ('),\n// then create a <function-token> with its value set to string and return it.\nif(getCharCode(offset)===0x0022||getCharCode(offset)===0x0027){type=TYPE$2.Function;offset=nameStartOffset+4;return;}// Otherwise, consume a url token, and return it.\nconsumeUrlToken();return;}// Otherwise, if the next input code point is U+0028 LEFT PARENTHESIS ((), consume it.\n// Create a <function-token> with its value set to string and return it.\nif(getCharCode(offset)===0x0028){type=TYPE$2.Function;offset++;return;}// Otherwise, create an <ident-token> with its value set to string and return it.\ntype=TYPE$2.Ident;}// § 4.3.5. Consume a string token\nfunction consumeStringToken(endingCodePoint){// This algorithm may be called with an ending code point, which denotes the code point\n// that ends the string. If an ending code point is not specified,\n// the current input code point is used.\nif(!endingCodePoint){endingCodePoint=getCharCode(offset++);}// Initially create a <string-token> with its value set to the empty string.\ntype=TYPE$2.String;// Repeatedly consume the next input code point from the stream:\nfor(;offset<source.length;offset++){var code=source.charCodeAt(offset);switch(charCodeCategory$1(code)){// ending code point\ncase endingCodePoint:// Return the <string-token>.\noffset++;return;// EOF\ncase charCodeCategory$1.Eof:// This is a parse error. Return the <string-token>.\nreturn;// newline\ncase charCodeCategory$1.WhiteSpace:if(isNewline$1(code)){// This is a parse error. Reconsume the current input code point,\n// create a <bad-string-token>, and return it.\noffset+=getNewlineLength$1(source,offset,code);type=TYPE$2.BadString;return;}break;// U+005C REVERSE SOLIDUS (\\)\ncase 0x005C:// If the next input code point is EOF, do nothing.\nif(offset===source.length-1){break;}var nextCode=getCharCode(offset+1);// Otherwise, if the next input code point is a newline, consume it.\nif(isNewline$1(nextCode)){offset+=getNewlineLength$1(source,offset+1,nextCode);}else if(isValidEscape$2(code,nextCode)){// Otherwise, (the stream starts with a valid escape) consume\n// an escaped code point and append the returned code point to\n// the <string-token>’s value.\noffset=consumeEscaped$1(source,offset)-1;}break;// anything else\n// Append the current input code point to the <string-token>’s value.\n}}}// § 4.3.6. Consume a url token\n// Note: This algorithm assumes that the initial \"url(\" has already been consumed.\n// This algorithm also assumes that it’s being called to consume an \"unquoted\" value, like url(foo).\n// A quoted value, like url(\"foo\"), is parsed as a <function-token>. Consume an ident-like token\n// automatically handles this distinction; this algorithm shouldn’t be called directly otherwise.\nfunction consumeUrlToken(){// Initially create a <url-token> with its value set to the empty string.\ntype=TYPE$2.Url;// Consume as much whitespace as possible.\noffset=findWhiteSpaceEnd$1(source,offset);// Repeatedly consume the next input code point from the stream:\nfor(;offset<source.length;offset++){var code=source.charCodeAt(offset);switch(charCodeCategory$1(code)){// U+0029 RIGHT PARENTHESIS ())\ncase 0x0029:// Return the <url-token>.\noffset++;return;// EOF\ncase charCodeCategory$1.Eof:// This is a parse error. Return the <url-token>.\nreturn;// whitespace\ncase charCodeCategory$1.WhiteSpace:// Consume as much whitespace as possible.\noffset=findWhiteSpaceEnd$1(source,offset);// If the next input code point is U+0029 RIGHT PARENTHESIS ()) or EOF,\n// consume it and return the <url-token>\n// (if EOF was encountered, this is a parse error);\nif(getCharCode(offset)===0x0029||offset>=source.length){if(offset<source.length){offset++;}return;}// otherwise, consume the remnants of a bad url, create a <bad-url-token>,\n// and return it.\noffset=consumeBadUrlRemnants$1(source,offset);type=TYPE$2.BadUrl;return;// U+0022 QUOTATION MARK (\")\n// U+0027 APOSTROPHE (')\n// U+0028 LEFT PARENTHESIS (()\n// non-printable code point\ncase 0x0022:case 0x0027:case 0x0028:case charCodeCategory$1.NonPrintable:// This is a parse error. Consume the remnants of a bad url,\n// create a <bad-url-token>, and return it.\noffset=consumeBadUrlRemnants$1(source,offset);type=TYPE$2.BadUrl;return;// U+005C REVERSE SOLIDUS (\\)\ncase 0x005C:// If the stream starts with a valid escape, consume an escaped code point and\n// append the returned code point to the <url-token>’s value.\nif(isValidEscape$2(code,getCharCode(offset+1))){offset=consumeEscaped$1(source,offset)-1;break;}// Otherwise, this is a parse error. Consume the remnants of a bad url,\n// create a <bad-url-token>, and return it.\noffset=consumeBadUrlRemnants$1(source,offset);type=TYPE$2.BadUrl;return;// anything else\n// Append the current input code point to the <url-token>’s value.\n}}}if(!stream){stream=new TokenStream_1();}// ensure source is a string\nsource=String(source||'');var sourceLength=source.length;var offsetAndType=adoptBuffer(stream.offsetAndType,sourceLength+1);// +1 because of eof-token\nvar balance=adoptBuffer(stream.balance,sourceLength+1);var tokenCount=0;var start=isBOM$1(getCharCode(0));var offset=start;var balanceCloseType=0;var balanceStart=0;var balancePrev=0;// https://drafts.csswg.org/css-syntax-3/#consume-token\n// § 4.3.1. Consume a token\nwhile(offset<sourceLength){var code=source.charCodeAt(offset);var type=0;balance[tokenCount]=sourceLength;switch(charCodeCategory$1(code)){// whitespace\ncase charCodeCategory$1.WhiteSpace:// Consume as much whitespace as possible. Return a <whitespace-token>.\ntype=TYPE$2.WhiteSpace;offset=findWhiteSpaceEnd$1(source,offset+1);break;// U+0022 QUOTATION MARK (\")\ncase 0x0022:// Consume a string token and return it.\nconsumeStringToken();break;// U+0023 NUMBER SIGN (#)\ncase 0x0023:// If the next input code point is a name code point or the next two input code points are a valid escape, then:\nif(isName$2(getCharCode(offset+1))||isValidEscape$2(getCharCode(offset+1),getCharCode(offset+2))){// Create a <hash-token>.\ntype=TYPE$2.Hash;// If the next 3 input code points would start an identifier, set the <hash-token>’s type flag to \"id\".\n// if (isIdentifierStart(getCharCode(offset + 1), getCharCode(offset + 2), getCharCode(offset + 3))) {\n//     // TODO: set id flag\n// }\n// Consume a name, and set the <hash-token>’s value to the returned string.\noffset=consumeName$1(source,offset+1);// Return the <hash-token>.\n}else{// Otherwise, return a <delim-token> with its value set to the current input code point.\ntype=TYPE$2.Delim;offset++;}break;// U+0027 APOSTROPHE (')\ncase 0x0027:// Consume a string token and return it.\nconsumeStringToken();break;// U+0028 LEFT PARENTHESIS (()\ncase 0x0028:// Return a <(-token>.\ntype=TYPE$2.LeftParenthesis;offset++;break;// U+0029 RIGHT PARENTHESIS ())\ncase 0x0029:// Return a <)-token>.\ntype=TYPE$2.RightParenthesis;offset++;break;// U+002B PLUS SIGN (+)\ncase 0x002B:// If the input stream starts with a number, ...\nif(isNumberStart$1(code,getCharCode(offset+1),getCharCode(offset+2))){// ... reconsume the current input code point, consume a numeric token, and return it.\nconsumeNumericToken();}else{// Otherwise, return a <delim-token> with its value set to the current input code point.\ntype=TYPE$2.Delim;offset++;}break;// U+002C COMMA (,)\ncase 0x002C:// Return a <comma-token>.\ntype=TYPE$2.Comma;offset++;break;// U+002D HYPHEN-MINUS (-)\ncase 0x002D:// If the input stream starts with a number, reconsume the current input code point, consume a numeric token, and return it.\nif(isNumberStart$1(code,getCharCode(offset+1),getCharCode(offset+2))){consumeNumericToken();}else{// Otherwise, if the next 2 input code points are U+002D HYPHEN-MINUS U+003E GREATER-THAN SIGN (->), consume them and return a <CDC-token>.\nif(getCharCode(offset+1)===0x002D&&getCharCode(offset+2)===0x003E){type=TYPE$2.CDC;offset=offset+3;}else{// Otherwise, if the input stream starts with an identifier, ...\nif(isIdentifierStart$2(code,getCharCode(offset+1),getCharCode(offset+2))){// ... reconsume the current input code point, consume an ident-like token, and return it.\nconsumeIdentLikeToken();}else{// Otherwise, return a <delim-token> with its value set to the current input code point.\ntype=TYPE$2.Delim;offset++;}}}break;// U+002E FULL STOP (.)\ncase 0x002E:// If the input stream starts with a number, ...\nif(isNumberStart$1(code,getCharCode(offset+1),getCharCode(offset+2))){// ... reconsume the current input code point, consume a numeric token, and return it.\nconsumeNumericToken();}else{// Otherwise, return a <delim-token> with its value set to the current input code point.\ntype=TYPE$2.Delim;offset++;}break;// U+002F SOLIDUS (/)\ncase 0x002F:// If the next two input code point are U+002F SOLIDUS (/) followed by a U+002A ASTERISK (*),\nif(getCharCode(offset+1)===0x002A){// ... consume them and all following code points up to and including the first U+002A ASTERISK (*)\n// followed by a U+002F SOLIDUS (/), or up to an EOF code point.\ntype=TYPE$2.Comment;offset=source.indexOf('*/',offset+2)+2;if(offset===1){offset=source.length;}}else{type=TYPE$2.Delim;offset++;}break;// U+003A COLON (:)\ncase 0x003A:// Return a <colon-token>.\ntype=TYPE$2.Colon;offset++;break;// U+003B SEMICOLON (;)\ncase 0x003B:// Return a <semicolon-token>.\ntype=TYPE$2.Semicolon;offset++;break;// U+003C LESS-THAN SIGN (<)\ncase 0x003C:// If the next 3 input code points are U+0021 EXCLAMATION MARK U+002D HYPHEN-MINUS U+002D HYPHEN-MINUS (!--), ...\nif(getCharCode(offset+1)===0x0021&&getCharCode(offset+2)===0x002D&&getCharCode(offset+3)===0x002D){// ... consume them and return a <CDO-token>.\ntype=TYPE$2.CDO;offset=offset+4;}else{// Otherwise, return a <delim-token> with its value set to the current input code point.\ntype=TYPE$2.Delim;offset++;}break;// U+0040 COMMERCIAL AT (@)\ncase 0x0040:// If the next 3 input code points would start an identifier, ...\nif(isIdentifierStart$2(getCharCode(offset+1),getCharCode(offset+2),getCharCode(offset+3))){// ... consume a name, create an <at-keyword-token> with its value set to the returned value, and return it.\ntype=TYPE$2.AtKeyword;offset=consumeName$1(source,offset+1);}else{// Otherwise, return a <delim-token> with its value set to the current input code point.\ntype=TYPE$2.Delim;offset++;}break;// U+005B LEFT SQUARE BRACKET ([)\ncase 0x005B:// Return a <[-token>.\ntype=TYPE$2.LeftSquareBracket;offset++;break;// U+005C REVERSE SOLIDUS (\\)\ncase 0x005C:// If the input stream starts with a valid escape, ...\nif(isValidEscape$2(code,getCharCode(offset+1))){// ... reconsume the current input code point, consume an ident-like token, and return it.\nconsumeIdentLikeToken();}else{// Otherwise, this is a parse error. Return a <delim-token> with its value set to the current input code point.\ntype=TYPE$2.Delim;offset++;}break;// U+005D RIGHT SQUARE BRACKET (])\ncase 0x005D:// Return a <]-token>.\ntype=TYPE$2.RightSquareBracket;offset++;break;// U+007B LEFT CURLY BRACKET ({)\ncase 0x007B:// Return a <{-token>.\ntype=TYPE$2.LeftCurlyBracket;offset++;break;// U+007D RIGHT CURLY BRACKET (})\ncase 0x007D:// Return a <}-token>.\ntype=TYPE$2.RightCurlyBracket;offset++;break;// digit\ncase charCodeCategory$1.Digit:// Reconsume the current input code point, consume a numeric token, and return it.\nconsumeNumericToken();break;// name-start code point\ncase charCodeCategory$1.NameStart:// Reconsume the current input code point, consume an ident-like token, and return it.\nconsumeIdentLikeToken();break;// EOF\ncase charCodeCategory$1.Eof:// Return an <EOF-token>.\nbreak;// anything else\ndefault:// Return a <delim-token> with its value set to the current input code point.\ntype=TYPE$2.Delim;offset++;}switch(type){case balanceCloseType:balancePrev=balanceStart&OFFSET_MASK$1;balanceStart=balance[balancePrev];balanceCloseType=balanceStart>>TYPE_SHIFT$1;balance[tokenCount]=balancePrev;balance[balancePrev++]=tokenCount;for(;balancePrev<tokenCount;balancePrev++){if(balance[balancePrev]===sourceLength){balance[balancePrev]=tokenCount;}}break;case TYPE$2.LeftParenthesis:case TYPE$2.Function:balance[tokenCount]=balanceStart;balanceCloseType=TYPE$2.RightParenthesis;balanceStart=balanceCloseType<<TYPE_SHIFT$1|tokenCount;break;case TYPE$2.LeftSquareBracket:balance[tokenCount]=balanceStart;balanceCloseType=TYPE$2.RightSquareBracket;balanceStart=balanceCloseType<<TYPE_SHIFT$1|tokenCount;break;case TYPE$2.LeftCurlyBracket:balance[tokenCount]=balanceStart;balanceCloseType=TYPE$2.RightCurlyBracket;balanceStart=balanceCloseType<<TYPE_SHIFT$1|tokenCount;break;}offsetAndType[tokenCount++]=type<<TYPE_SHIFT$1|offset;}// finalize buffers\noffsetAndType[tokenCount]=TYPE$2.EOF<<TYPE_SHIFT$1|offset;// <EOF-token>\nbalance[tokenCount]=sourceLength;balance[sourceLength]=sourceLength;// prevents false positive balance match with any token\nwhile(balanceStart!==0){balancePrev=balanceStart&OFFSET_MASK$1;balanceStart=balance[balancePrev];balance[balancePrev]=sourceLength;}// update stream\nstream.source=source;stream.firstCharOffset=start;stream.offsetAndType=offsetAndType;stream.tokenCount=tokenCount;stream.balance=balance;stream.reset();stream.next();return stream;}// extend tokenizer with constants\nObject.keys(_const).forEach(function(key){tokenize[key]=_const[key];});// extend tokenizer with static methods from utils\nObject.keys(charCodeDefinitions).forEach(function(key){tokenize[key]=charCodeDefinitions[key];});Object.keys(utils).forEach(function(key){tokenize[key]=utils[key];});var tokenizer=tokenize;var isBOM$2=tokenizer.isBOM;var N=10;var F=12;var R=13;function computeLinesAndColumns(host,source){var sourceLength=source.length;var lines=adoptBuffer(host.lines,sourceLength);// +1\nvar line=host.startLine;var columns=adoptBuffer(host.columns,sourceLength);var column=host.startColumn;var startOffset=source.length>0?isBOM$2(source.charCodeAt(0)):0;for(var i=startOffset;i<sourceLength;i++){// -1\nvar code=source.charCodeAt(i);lines[i]=line;columns[i]=column++;if(code===N||code===R||code===F){if(code===R&&i+1<sourceLength&&source.charCodeAt(i+1)===N){i++;lines[i]=line;columns[i]=column;}line++;column=1;}}lines[i]=line;columns[i]=column;host.lines=lines;host.columns=columns;}var OffsetToLocation=function OffsetToLocation(){this.lines=null;this.columns=null;this.linesAndColumnsComputed=false;};OffsetToLocation.prototype={setSource:function setSource(source,startOffset,startLine,startColumn){this.source=source;this.startOffset=typeof startOffset==='undefined'?0:startOffset;this.startLine=typeof startLine==='undefined'?1:startLine;this.startColumn=typeof startColumn==='undefined'?1:startColumn;this.linesAndColumnsComputed=false;},ensureLinesAndColumnsComputed:function ensureLinesAndColumnsComputed(){if(!this.linesAndColumnsComputed){computeLinesAndColumns(this,this.source);this.linesAndColumnsComputed=true;}},getLocation:function getLocation(offset,filename){this.ensureLinesAndColumnsComputed();return{source:filename,offset:this.startOffset+offset,line:this.lines[offset],column:this.columns[offset]};},getLocationRange:function getLocationRange(start,end,filename){this.ensureLinesAndColumnsComputed();return{source:filename,start:{offset:this.startOffset+start,line:this.lines[start],column:this.columns[start]},end:{offset:this.startOffset+end,line:this.lines[end],column:this.columns[end]}};}};var OffsetToLocation_1=OffsetToLocation;var createCustomError=function createCustomError(name,message){// use Object.create(), because some VMs prevent setting line/column otherwise\n// (iOS Safari 10 even throws an exception)\nvar error=Object.create(SyntaxError.prototype);var errorStack=new Error();error.name=name;error.message=message;Object.defineProperty(error,'stack',{get:function get(){return(errorStack.stack||'').replace(/^(.+\\n){1,3}/,name+': '+message+'\\n');}});return error;};var MAX_LINE_LENGTH=100;var OFFSET_CORRECTION=60;var TAB_REPLACEMENT='    ';function sourceFragment(error,extraLines){function processLines(start,end){return lines.slice(start,end).map(function(line,idx){var num=String(start+idx+1);while(num.length<maxNumLength){num=' '+num;}return num+' |'+line;}).join('\\n');}var lines=error.source.split(/\\r\\n?|\\n|\\f/);var line=error.line;var column=error.column;var startLine=Math.max(1,line-extraLines)-1;var endLine=Math.min(line+extraLines,lines.length+1);var maxNumLength=Math.max(4,String(endLine).length)+1;var cutLeft=0;// column correction according to replaced tab before column\ncolumn+=(TAB_REPLACEMENT.length-1)*(lines[line-1].substr(0,column-1).match(/\\t/g)||[]).length;if(column>MAX_LINE_LENGTH){cutLeft=column-OFFSET_CORRECTION+3;column=OFFSET_CORRECTION-2;}for(var i=startLine;i<=endLine;i++){if(i>=0&&i<lines.length){lines[i]=lines[i].replace(/\\t/g,TAB_REPLACEMENT);lines[i]=(cutLeft>0&&lines[i].length>cutLeft?\"\\u2026\":'')+lines[i].substr(cutLeft,MAX_LINE_LENGTH-2)+(lines[i].length>cutLeft+MAX_LINE_LENGTH-1?\"\\u2026\":'');}}return[processLines(startLine,line),new Array(column+maxNumLength+2).join('-')+'^',processLines(line,endLine)].filter(Boolean).join('\\n');}var SyntaxError$1=function SyntaxError$1(message,source,offset,line,column){var error=createCustomError('SyntaxError',message);error.source=source;error.offset=offset;error.line=line;error.column=column;error.sourceFragment=function(extraLines){return sourceFragment(error,isNaN(extraLines)?0:extraLines);};Object.defineProperty(error,'formattedMessage',{get:function get(){return'Parse error: '+error.message+'\\n'+sourceFragment(error,2);}});// for backward capability\nerror.parseError={offset:offset,line:line,column:column};return error;};var _SyntaxError=SyntaxError$1;//\n//                              list\n//                            ┌──────┐\n//             ┌──────────────┼─head │\n//             │              │ tail─┼──────────────┐\n//             │              └──────┘              │\n//             ▼                                    ▼\n//            item        item        item        item\n//          ┌──────┐    ┌──────┐    ┌──────┐    ┌──────┐\n//  null ◀──┼─prev │◀───┼─prev │◀───┼─prev │◀───┼─prev │\n//          │ next─┼───▶│ next─┼───▶│ next─┼───▶│ next─┼──▶ null\n//          ├──────┤    ├──────┤    ├──────┤    ├──────┤\n//          │ data │    │ data │    │ data │    │ data │\n//          └──────┘    └──────┘    └──────┘    └──────┘\n//\nfunction createItem(data){return{prev:null,next:null,data:data};}function allocateCursor(node,prev,next){var cursor;if(cursors!==null){cursor=cursors;cursors=cursors.cursor;cursor.prev=prev;cursor.next=next;cursor.cursor=node.cursor;}else{cursor={prev:prev,next:next,cursor:node.cursor};}node.cursor=cursor;return cursor;}function releaseCursor(node){var cursor=node.cursor;node.cursor=cursor.cursor;cursor.prev=null;cursor.next=null;cursor.cursor=cursors;cursors=cursor;}var cursors=null;var List=function List(){this.cursor=null;this.head=null;this.tail=null;};List.createItem=createItem;List.prototype.createItem=createItem;List.prototype.updateCursors=function(prevOld,prevNew,nextOld,nextNew){var cursor=this.cursor;while(cursor!==null){if(cursor.prev===prevOld){cursor.prev=prevNew;}if(cursor.next===nextOld){cursor.next=nextNew;}cursor=cursor.cursor;}};List.prototype.getSize=function(){var size=0;var cursor=this.head;while(cursor){size++;cursor=cursor.next;}return size;};List.prototype.fromArray=function(array){var cursor=null;this.head=null;for(var i=0;i<array.length;i++){var item=createItem(array[i]);if(cursor!==null){cursor.next=item;}else{this.head=item;}item.prev=cursor;cursor=item;}this.tail=cursor;return this;};List.prototype.toArray=function(){var cursor=this.head;var result=[];while(cursor){result.push(cursor.data);cursor=cursor.next;}return result;};List.prototype.toJSON=List.prototype.toArray;List.prototype.isEmpty=function(){return this.head===null;};List.prototype.first=function(){return this.head&&this.head.data;};List.prototype.last=function(){return this.tail&&this.tail.data;};List.prototype.each=function(fn,context){var item;if(context===undefined){context=this;}// push cursor\nvar cursor=allocateCursor(this,null,this.head);while(cursor.next!==null){item=cursor.next;cursor.next=item.next;fn.call(context,item.data,item,this);}// pop cursor\nreleaseCursor(this);};List.prototype.forEach=List.prototype.each;List.prototype.eachRight=function(fn,context){var item;if(context===undefined){context=this;}// push cursor\nvar cursor=allocateCursor(this,this.tail,null);while(cursor.prev!==null){item=cursor.prev;cursor.prev=item.prev;fn.call(context,item.data,item,this);}// pop cursor\nreleaseCursor(this);};List.prototype.forEachRight=List.prototype.eachRight;List.prototype.reduce=function(fn,initialValue,context){var item;if(context===undefined){context=this;}// push cursor\nvar cursor=allocateCursor(this,null,this.head);var acc=initialValue;while(cursor.next!==null){item=cursor.next;cursor.next=item.next;acc=fn.call(context,acc,item.data,item,this);}// pop cursor\nreleaseCursor(this);return acc;};List.prototype.reduceRight=function(fn,initialValue,context){var item;if(context===undefined){context=this;}// push cursor\nvar cursor=allocateCursor(this,this.tail,null);var acc=initialValue;while(cursor.prev!==null){item=cursor.prev;cursor.prev=item.prev;acc=fn.call(context,acc,item.data,item,this);}// pop cursor\nreleaseCursor(this);return acc;};List.prototype.nextUntil=function(start,fn,context){if(start===null){return;}var item;if(context===undefined){context=this;}// push cursor\nvar cursor=allocateCursor(this,null,start);while(cursor.next!==null){item=cursor.next;cursor.next=item.next;if(fn.call(context,item.data,item,this)){break;}}// pop cursor\nreleaseCursor(this);};List.prototype.prevUntil=function(start,fn,context){if(start===null){return;}var item;if(context===undefined){context=this;}// push cursor\nvar cursor=allocateCursor(this,start,null);while(cursor.prev!==null){item=cursor.prev;cursor.prev=item.prev;if(fn.call(context,item.data,item,this)){break;}}// pop cursor\nreleaseCursor(this);};List.prototype.some=function(fn,context){var cursor=this.head;if(context===undefined){context=this;}while(cursor!==null){if(fn.call(context,cursor.data,cursor,this)){return true;}cursor=cursor.next;}return false;};List.prototype.map=function(fn,context){var result=new List();var cursor=this.head;if(context===undefined){context=this;}while(cursor!==null){result.appendData(fn.call(context,cursor.data,cursor,this));cursor=cursor.next;}return result;};List.prototype.filter=function(fn,context){var result=new List();var cursor=this.head;if(context===undefined){context=this;}while(cursor!==null){if(fn.call(context,cursor.data,cursor,this)){result.appendData(cursor.data);}cursor=cursor.next;}return result;};List.prototype.clear=function(){this.head=null;this.tail=null;};List.prototype.copy=function(){var result=new List();var cursor=this.head;while(cursor!==null){result.insert(createItem(cursor.data));cursor=cursor.next;}return result;};List.prototype.prepend=function(item){//      head\n//    ^\n// item\nthis.updateCursors(null,item,this.head,item);// insert to the beginning of the list\nif(this.head!==null){// new item <- first item\nthis.head.prev=item;// new item -> first item\nitem.next=this.head;}else{// if list has no head, then it also has no tail\n// in this case tail points to the new item\nthis.tail=item;}// head always points to new item\nthis.head=item;return this;};List.prototype.prependData=function(data){return this.prepend(createItem(data));};List.prototype.append=function(item){return this.insert(item);};List.prototype.appendData=function(data){return this.insert(createItem(data));};List.prototype.insert=function(item,before){if(before!==undefined&&before!==null){// prev   before\n//      ^\n//     item\nthis.updateCursors(before.prev,item,before,item);if(before.prev===null){// insert to the beginning of list\nif(this.head!==before){throw new Error('before doesn\\'t belong to list');}// since head points to before therefore list doesn't empty\n// no need to check tail\nthis.head=item;before.prev=item;item.next=before;this.updateCursors(null,item);}else{// insert between two items\nbefore.prev.next=item;item.prev=before.prev;before.prev=item;item.next=before;}}else{// tail\n//      ^\n//      item\nthis.updateCursors(this.tail,item,null,item);// insert to the ending of the list\nif(this.tail!==null){// last item -> new item\nthis.tail.next=item;// last item <- new item\nitem.prev=this.tail;}else{// if list has no tail, then it also has no head\n// in this case head points to new item\nthis.head=item;}// tail always points to new item\nthis.tail=item;}return this;};List.prototype.insertData=function(data,before){return this.insert(createItem(data),before);};List.prototype.remove=function(item){//      item\n//       ^\n// prev     next\nthis.updateCursors(item,item.prev,item,item.next);if(item.prev!==null){item.prev.next=item.next;}else{if(this.head!==item){throw new Error('item doesn\\'t belong to list');}this.head=item.next;}if(item.next!==null){item.next.prev=item.prev;}else{if(this.tail!==item){throw new Error('item doesn\\'t belong to list');}this.tail=item.prev;}item.prev=null;item.next=null;return item;};List.prototype.push=function(data){this.insert(createItem(data));};List.prototype.pop=function(){if(this.tail!==null){return this.remove(this.tail);}};List.prototype.unshift=function(data){this.prepend(createItem(data));};List.prototype.shift=function(){if(this.head!==null){return this.remove(this.head);}};List.prototype.prependList=function(list){return this.insertList(list,this.head);};List.prototype.appendList=function(list){return this.insertList(list);};List.prototype.insertList=function(list,before){// ignore empty lists\nif(list.head===null){return this;}if(before!==undefined&&before!==null){this.updateCursors(before.prev,list.tail,before,list.head);// insert in the middle of dist list\nif(before.prev!==null){// before.prev <-> list.head\nbefore.prev.next=list.head;list.head.prev=before.prev;}else{this.head=list.head;}before.prev=list.tail;list.tail.next=before;}else{this.updateCursors(this.tail,list.tail,null,list.head);// insert to end of the list\nif(this.tail!==null){// if destination list has a tail, then it also has a head,\n// but head doesn't change\n// dest tail -> source head\nthis.tail.next=list.head;// dest tail <- source head\nlist.head.prev=this.tail;}else{// if list has no a tail, then it also has no a head\n// in this case points head to new item\nthis.head=list.head;}// tail always start point to new item\nthis.tail=list.tail;}list.head=null;list.tail=null;return this;};List.prototype.replace=function(oldItem,newItemOrList){if('head'in newItemOrList){this.insertList(newItemOrList,oldItem);}else{this.insert(newItemOrList,oldItem);}this.remove(oldItem);};var List_1=List;var TYPE$3=tokenizer.TYPE;var WHITESPACE$1=TYPE$3.WhiteSpace;var COMMENT$1=TYPE$3.Comment;var sequence=function readSequence(recognizer){var children=this.createList();var child=null;var context={recognizer:recognizer,space:null,ignoreWS:false,ignoreWSAfter:false};this.scanner.skipSC();while(!this.scanner.eof){switch(this.scanner.tokenType){case COMMENT$1:this.scanner.next();continue;case WHITESPACE$1:if(context.ignoreWS){this.scanner.next();}else{context.space=this.WhiteSpace();}continue;}child=recognizer.getNode.call(this,context);if(child===undefined){break;}if(context.space!==null){children.push(context.space);context.space=null;}children.push(child);if(context.ignoreWSAfter){context.ignoreWSAfter=false;context.ignoreWS=true;}else{context.ignoreWS=false;}}return children;};var findWhiteSpaceStart$1=utils.findWhiteSpaceStart,cmpStr$3=utils.cmpStr;var noop=function noop(){};var TYPE$4=_const.TYPE;var NAME$2=_const.NAME;var WHITESPACE$2=TYPE$4.WhiteSpace;var COMMENT$2=TYPE$4.Comment;var IDENT=TYPE$4.Ident;var FUNCTION=TYPE$4.Function;var URL$1=TYPE$4.Url;var HASH=TYPE$4.Hash;var PERCENTAGE=TYPE$4.Percentage;var NUMBER=TYPE$4.Number;var NUMBERSIGN=0x0023;// U+0023 NUMBER SIGN (#)\nvar NULL=0;function createParseContext(name){return function(){return this[name]();};}function processConfig(config){var parserConfig={context:{},scope:{},atrule:{},pseudo:{}};if(config.parseContext){for(var name in config.parseContext){switch((0,_typeof2.default)(config.parseContext[name])){case'function':parserConfig.context[name]=config.parseContext[name];break;case'string':parserConfig.context[name]=createParseContext(config.parseContext[name]);break;}}}if(config.scope){for(var name in config.scope){parserConfig.scope[name]=config.scope[name];}}if(config.atrule){for(var name in config.atrule){var atrule=config.atrule[name];if(atrule.parse){parserConfig.atrule[name]=atrule.parse;}}}if(config.pseudo){for(var name in config.pseudo){var pseudo=config.pseudo[name];if(pseudo.parse){parserConfig.pseudo[name]=pseudo.parse;}}}if(config.node){for(var name in config.node){parserConfig[name]=config.node[name].parse;}}return parserConfig;}var create=function createParser(config){var parser={scanner:new TokenStream_1(),locationMap:new OffsetToLocation_1(),filename:'<unknown>',needPositions:false,onParseError:noop,onParseErrorThrow:false,parseAtrulePrelude:true,parseRulePrelude:true,parseValue:true,parseCustomProperty:false,readSequence:sequence,createList:function createList(){return new List_1();},createSingleNodeList:function createSingleNodeList(node){return new List_1().appendData(node);},getFirstListNode:function getFirstListNode(list){return list&&list.first();},getLastListNode:function getLastListNode(list){return list.last();},parseWithFallback:function parseWithFallback(consumer,fallback){var startToken=this.scanner.tokenIndex;try{return consumer.call(this);}catch(e){if(this.onParseErrorThrow){throw e;}var fallbackNode=fallback.call(this,startToken);this.onParseErrorThrow=true;this.onParseError(e,fallbackNode);this.onParseErrorThrow=false;return fallbackNode;}},lookupNonWSType:function lookupNonWSType(offset){do{var type=this.scanner.lookupType(offset++);if(type!==WHITESPACE$2){return type;}}while(type!==NULL);return NULL;},eat:function eat(tokenType){if(this.scanner.tokenType!==tokenType){var offset=this.scanner.tokenStart;var message=NAME$2[tokenType]+' is expected';// tweak message and offset\nswitch(tokenType){case IDENT:// when identifier is expected but there is a function or url\nif(this.scanner.tokenType===FUNCTION||this.scanner.tokenType===URL$1){offset=this.scanner.tokenEnd-1;message='Identifier is expected but function found';}else{message='Identifier is expected';}break;case HASH:if(this.scanner.isDelim(NUMBERSIGN)){this.scanner.next();offset++;message='Name is expected';}break;case PERCENTAGE:if(this.scanner.tokenType===NUMBER){offset=this.scanner.tokenEnd;message='Percent sign is expected';}break;default:// when test type is part of another token show error for current position + 1\n// e.g. eat(HYPHENMINUS) will fail on \"-foo\", but pointing on \"-\" is odd\nif(this.scanner.source.charCodeAt(this.scanner.tokenStart)===tokenType){offset=offset+1;}}this.error(message,offset);}this.scanner.next();},consume:function consume(tokenType){var value=this.scanner.getTokenValue();this.eat(tokenType);return value;},consumeFunctionName:function consumeFunctionName(){var name=this.scanner.source.substring(this.scanner.tokenStart,this.scanner.tokenEnd-1);this.eat(FUNCTION);return name;},getLocation:function getLocation(start,end){if(this.needPositions){return this.locationMap.getLocationRange(start,end,this.filename);}return null;},getLocationFromList:function getLocationFromList(list){if(this.needPositions){var head=this.getFirstListNode(list);var tail=this.getLastListNode(list);return this.locationMap.getLocationRange(head!==null?head.loc.start.offset-this.locationMap.startOffset:this.scanner.tokenStart,tail!==null?tail.loc.end.offset-this.locationMap.startOffset:this.scanner.tokenStart,this.filename);}return null;},error:function error(message,offset){var location=typeof offset!=='undefined'&&offset<this.scanner.source.length?this.locationMap.getLocation(offset):this.scanner.eof?this.locationMap.getLocation(findWhiteSpaceStart$1(this.scanner.source,this.scanner.source.length-1)):this.locationMap.getLocation(this.scanner.tokenStart);throw new _SyntaxError(message||'Unexpected input',this.scanner.source,location.offset,location.line,location.column);}};config=processConfig(config||{});for(var key in config){parser[key]=config[key];}return function(source,options){options=options||{};var context=options.context||'default';var onComment=options.onComment;var ast;tokenizer(source,parser.scanner);parser.locationMap.setSource(source,options.offset,options.line,options.column);parser.filename=options.filename||'<unknown>';parser.needPositions=Boolean(options.positions);parser.onParseError=typeof options.onParseError==='function'?options.onParseError:noop;parser.onParseErrorThrow=false;parser.parseAtrulePrelude='parseAtrulePrelude'in options?Boolean(options.parseAtrulePrelude):true;parser.parseRulePrelude='parseRulePrelude'in options?Boolean(options.parseRulePrelude):true;parser.parseValue='parseValue'in options?Boolean(options.parseValue):true;parser.parseCustomProperty='parseCustomProperty'in options?Boolean(options.parseCustomProperty):false;if(!parser.context.hasOwnProperty(context)){throw new Error('Unknown context `'+context+'`');}if(typeof onComment==='function'){parser.scanner.forEachToken(function(type,start,end){if(type===COMMENT$2){var loc=parser.getLocation(start,end);var _value4=cmpStr$3(source,end-2,end,'*/')?source.slice(start+2,end-2):source.slice(start+2,end);onComment(_value4,loc);}});}ast=parser.context[context].call(parser,options);if(!parser.scanner.eof){parser.error();}return ast;};};var cmpChar$1=tokenizer.cmpChar;var cmpStr$4=tokenizer.cmpStr;var TYPE$5=tokenizer.TYPE;var IDENT$1=TYPE$5.Ident;var STRING=TYPE$5.String;var NUMBER$1=TYPE$5.Number;var FUNCTION$1=TYPE$5.Function;var URL$2=TYPE$5.Url;var HASH$1=TYPE$5.Hash;var DIMENSION=TYPE$5.Dimension;var PERCENTAGE$1=TYPE$5.Percentage;var LEFTPARENTHESIS=TYPE$5.LeftParenthesis;var LEFTSQUAREBRACKET=TYPE$5.LeftSquareBracket;var COMMA=TYPE$5.Comma;var DELIM=TYPE$5.Delim;var NUMBERSIGN$1=0x0023;// U+0023 NUMBER SIGN (#)\nvar ASTERISK=0x002A;// U+002A ASTERISK (*)\nvar PLUSSIGN=0x002B;// U+002B PLUS SIGN (+)\nvar HYPHENMINUS=0x002D;// U+002D HYPHEN-MINUS (-)\nvar SOLIDUS=0x002F;// U+002F SOLIDUS (/)\nvar U=0x0075;// U+0075 LATIN SMALL LETTER U (u)\nvar _default=function defaultRecognizer(context){switch(this.scanner.tokenType){case HASH$1:return this.Hash();case COMMA:context.space=null;context.ignoreWSAfter=true;return this.Operator();case LEFTPARENTHESIS:return this.Parentheses(this.readSequence,context.recognizer);case LEFTSQUAREBRACKET:return this.Brackets(this.readSequence,context.recognizer);case STRING:return this.String();case DIMENSION:return this.Dimension();case PERCENTAGE$1:return this.Percentage();case NUMBER$1:return this.Number();case FUNCTION$1:return cmpStr$4(this.scanner.source,this.scanner.tokenStart,this.scanner.tokenEnd,'url(')?this.Url():this.Function(this.readSequence,context.recognizer);case URL$2:return this.Url();case IDENT$1:// check for unicode range, it should start with u+ or U+\nif(cmpChar$1(this.scanner.source,this.scanner.tokenStart,U)&&cmpChar$1(this.scanner.source,this.scanner.tokenStart+1,PLUSSIGN)){return this.UnicodeRange();}else{return this.Identifier();}case DELIM:var code=this.scanner.source.charCodeAt(this.scanner.tokenStart);if(code===SOLIDUS||code===ASTERISK||code===PLUSSIGN||code===HYPHENMINUS){return this.Operator();// TODO: replace with Delim\n}// TODO: produce a node with Delim node type\nif(code===NUMBERSIGN$1){this.error('Hex or identifier is expected',this.scanner.tokenStart+1);}break;}};var atrulePrelude={getNode:_default};var TYPE$6=tokenizer.TYPE;var DELIM$1=TYPE$6.Delim;var IDENT$2=TYPE$6.Ident;var DIMENSION$1=TYPE$6.Dimension;var PERCENTAGE$2=TYPE$6.Percentage;var NUMBER$2=TYPE$6.Number;var HASH$2=TYPE$6.Hash;var COLON=TYPE$6.Colon;var LEFTSQUAREBRACKET$1=TYPE$6.LeftSquareBracket;var NUMBERSIGN$2=0x0023;// U+0023 NUMBER SIGN (#)\nvar ASTERISK$1=0x002A;// U+002A ASTERISK (*)\nvar PLUSSIGN$1=0x002B;// U+002B PLUS SIGN (+)\nvar SOLIDUS$1=0x002F;// U+002F SOLIDUS (/)\nvar FULLSTOP=0x002E;// U+002E FULL STOP (.)\nvar GREATERTHANSIGN=0x003E;// U+003E GREATER-THAN SIGN (>)\nvar VERTICALLINE=0x007C;// U+007C VERTICAL LINE (|)\nvar TILDE=0x007E;// U+007E TILDE (~)\nfunction getNode(context){switch(this.scanner.tokenType){case LEFTSQUAREBRACKET$1:return this.AttributeSelector();case HASH$2:return this.IdSelector();case COLON:if(this.scanner.lookupType(1)===COLON){return this.PseudoElementSelector();}else{return this.PseudoClassSelector();}case IDENT$2:return this.TypeSelector();case NUMBER$2:case PERCENTAGE$2:return this.Percentage();case DIMENSION$1:// throws when .123ident\nif(this.scanner.source.charCodeAt(this.scanner.tokenStart)===FULLSTOP){this.error('Identifier is expected',this.scanner.tokenStart+1);}break;case DELIM$1:var code=this.scanner.source.charCodeAt(this.scanner.tokenStart);switch(code){case PLUSSIGN$1:case GREATERTHANSIGN:case TILDE:context.space=null;context.ignoreWSAfter=true;return this.Combinator();case SOLIDUS$1:// /deep/\nreturn this.Combinator();case FULLSTOP:return this.ClassSelector();case ASTERISK$1:case VERTICALLINE:return this.TypeSelector();case NUMBERSIGN$2:return this.IdSelector();}break;}}var selector={getNode:getNode};// legacy IE function\n// expression( <any-value> )\nvar expression=function expression(){return this.createSingleNodeList(this.Raw(this.scanner.tokenIndex,null,false));};var TYPE$7=tokenizer.TYPE;var WhiteSpace=TYPE$7.WhiteSpace;var Semicolon=TYPE$7.Semicolon;var LeftCurlyBracket=TYPE$7.LeftCurlyBracket;var Delim=TYPE$7.Delim;var EXCLAMATIONMARK=0x0021;// U+0021 EXCLAMATION MARK (!)\nfunction getOffsetExcludeWS(){if(this.scanner.tokenIndex>0){if(this.scanner.lookupType(-1)===WhiteSpace){return this.scanner.tokenIndex>1?this.scanner.getTokenStart(this.scanner.tokenIndex-1):this.scanner.firstCharOffset;}}return this.scanner.tokenStart;}// 0, 0, false\nfunction balanceEnd(){return 0;}// LEFTCURLYBRACKET, 0, false\nfunction leftCurlyBracket(tokenType){return tokenType===LeftCurlyBracket?1:0;}// LEFTCURLYBRACKET, SEMICOLON, false\nfunction leftCurlyBracketOrSemicolon(tokenType){return tokenType===LeftCurlyBracket||tokenType===Semicolon?1:0;}// EXCLAMATIONMARK, SEMICOLON, false\nfunction exclamationMarkOrSemicolon(tokenType,source,offset){if(tokenType===Delim&&source.charCodeAt(offset)===EXCLAMATIONMARK){return 1;}return tokenType===Semicolon?1:0;}// 0, SEMICOLON, true\nfunction semicolonIncluded(tokenType){return tokenType===Semicolon?2:0;}var Raw={name:'Raw',structure:{value:String},parse:function parse(startToken,mode,excludeWhiteSpace){var startOffset=this.scanner.getTokenStart(startToken);var endOffset;this.scanner.skip(this.scanner.getRawLength(startToken,mode||balanceEnd));if(excludeWhiteSpace&&this.scanner.tokenStart>startOffset){endOffset=getOffsetExcludeWS.call(this);}else{endOffset=this.scanner.tokenStart;}return{type:'Raw',loc:this.getLocation(startOffset,endOffset),value:this.scanner.source.substring(startOffset,endOffset)};},generate:function generate(node){this.chunk(node.value);},mode:{default:balanceEnd,leftCurlyBracket:leftCurlyBracket,leftCurlyBracketOrSemicolon:leftCurlyBracketOrSemicolon,exclamationMarkOrSemicolon:exclamationMarkOrSemicolon,semicolonIncluded:semicolonIncluded}};var TYPE$8=tokenizer.TYPE;var rawMode=Raw.mode;var COMMA$1=TYPE$8.Comma;var WHITESPACE$3=TYPE$8.WhiteSpace;// var( <ident> , <value>? )\nvar _var=function _var(){var children=this.createList();this.scanner.skipSC();// NOTE: Don't check more than a first argument is an ident, rest checks are for lexer\nchildren.push(this.Identifier());this.scanner.skipSC();if(this.scanner.tokenType===COMMA$1){children.push(this.Operator());var startIndex=this.scanner.tokenIndex;var _value5=this.parseCustomProperty?this.Value(null):this.Raw(this.scanner.tokenIndex,rawMode.exclamationMarkOrSemicolon,false);if(_value5.type==='Value'&&_value5.children.isEmpty()){for(var offset=startIndex-this.scanner.tokenIndex;offset<=0;offset++){if(this.scanner.lookupType(offset)===WHITESPACE$3){_value5.children.appendData({type:'WhiteSpace',loc:null,value:' '});break;}}}children.push(_value5);}return children;};var value={getNode:_default,'expression':expression,'var':_var};var scope={AtrulePrelude:atrulePrelude,Selector:selector,Value:value};var fontFace={parse:{prelude:null,block:function block(){return this.Block(true);}}};var TYPE$9=tokenizer.TYPE;var STRING$1=TYPE$9.String;var IDENT$3=TYPE$9.Ident;var URL$3=TYPE$9.Url;var FUNCTION$2=TYPE$9.Function;var LEFTPARENTHESIS$1=TYPE$9.LeftParenthesis;var _import={parse:{prelude:function prelude(){var children=this.createList();this.scanner.skipSC();switch(this.scanner.tokenType){case STRING$1:children.push(this.String());break;case URL$3:case FUNCTION$2:children.push(this.Url());break;default:this.error('String or url() is expected');}if(this.lookupNonWSType(0)===IDENT$3||this.lookupNonWSType(0)===LEFTPARENTHESIS$1){children.push(this.WhiteSpace());children.push(this.MediaQueryList());}return children;},block:null}};var media={parse:{prelude:function prelude(){return this.createSingleNodeList(this.MediaQueryList());},block:function block(){return this.Block(false);}}};var page={parse:{prelude:function prelude(){return this.createSingleNodeList(this.SelectorList());},block:function block(){return this.Block(true);}}};var TYPE$a=tokenizer.TYPE;var WHITESPACE$4=TYPE$a.WhiteSpace;var COMMENT$3=TYPE$a.Comment;var IDENT$4=TYPE$a.Ident;var FUNCTION$3=TYPE$a.Function;var COLON$1=TYPE$a.Colon;var LEFTPARENTHESIS$2=TYPE$a.LeftParenthesis;function consumeRaw(){return this.createSingleNodeList(this.Raw(this.scanner.tokenIndex,null,false));}function parentheses(){this.scanner.skipSC();if(this.scanner.tokenType===IDENT$4&&this.lookupNonWSType(1)===COLON$1){return this.createSingleNodeList(this.Declaration());}return readSequence.call(this);}function readSequence(){var children=this.createList();var space=null;var child;this.scanner.skipSC();scan:while(!this.scanner.eof){switch(this.scanner.tokenType){case WHITESPACE$4:space=this.WhiteSpace();continue;case COMMENT$3:this.scanner.next();continue;case FUNCTION$3:child=this.Function(consumeRaw,this.scope.AtrulePrelude);break;case IDENT$4:child=this.Identifier();break;case LEFTPARENTHESIS$2:child=this.Parentheses(parentheses,this.scope.AtrulePrelude);break;default:break scan;}if(space!==null){children.push(space);space=null;}children.push(child);}return children;}var supports={parse:{prelude:function prelude(){var children=readSequence.call(this);if(this.getFirstListNode(children)===null){this.error('Condition is expected');}return children;},block:function block(){return this.Block(false);}}};var atrule={'font-face':fontFace,'import':_import,'media':media,'page':page,'supports':supports};var dir={parse:function parse(){return this.createSingleNodeList(this.Identifier());}};var has$1={parse:function parse(){return this.createSingleNodeList(this.SelectorList());}};var lang={parse:function parse(){return this.createSingleNodeList(this.Identifier());}};var selectorList={parse:function selectorList(){return this.createSingleNodeList(this.SelectorList());}};var matches=selectorList;var not=selectorList;var ALLOW_OF_CLAUSE=true;var nthWithOfClause={parse:function nthWithOfClause(){return this.createSingleNodeList(this.Nth(ALLOW_OF_CLAUSE));}};var nthChild=nthWithOfClause;var nthLastChild=nthWithOfClause;var DISALLOW_OF_CLAUSE=false;var nth={parse:function nth(){return this.createSingleNodeList(this.Nth(DISALLOW_OF_CLAUSE));}};var nthLastOfType=nth;var nthOfType=nth;var slotted={parse:function compoundSelector(){return this.createSingleNodeList(this.Selector());}};var pseudo={'dir':dir,'has':has$1,'lang':lang,'matches':matches,'not':not,'nth-child':nthChild,'nth-last-child':nthLastChild,'nth-last-of-type':nthLastOfType,'nth-of-type':nthOfType,'slotted':slotted};var cmpChar$2=tokenizer.cmpChar;var isDigit$2=tokenizer.isDigit;var TYPE$b=tokenizer.TYPE;var WHITESPACE$5=TYPE$b.WhiteSpace;var COMMENT$4=TYPE$b.Comment;var IDENT$5=TYPE$b.Ident;var NUMBER$3=TYPE$b.Number;var DIMENSION$2=TYPE$b.Dimension;var PLUSSIGN$2=0x002B;// U+002B PLUS SIGN (+)\nvar HYPHENMINUS$1=0x002D;// U+002D HYPHEN-MINUS (-)\nvar N$1=0x006E;// U+006E LATIN SMALL LETTER N (n)\nvar DISALLOW_SIGN=true;var ALLOW_SIGN=false;function checkInteger(offset,disallowSign){var pos=this.scanner.tokenStart+offset;var code=this.scanner.source.charCodeAt(pos);if(code===PLUSSIGN$2||code===HYPHENMINUS$1){if(disallowSign){this.error('Number sign is not allowed');}pos++;}for(;pos<this.scanner.tokenEnd;pos++){if(!isDigit$2(this.scanner.source.charCodeAt(pos))){this.error('Integer is expected',pos);}}}function checkTokenIsInteger(disallowSign){return checkInteger.call(this,0,disallowSign);}function expectCharCode(offset,code){if(!cmpChar$2(this.scanner.source,this.scanner.tokenStart+offset,code)){var msg='';switch(code){case N$1:msg='N is expected';break;case HYPHENMINUS$1:msg='HyphenMinus is expected';break;}this.error(msg,this.scanner.tokenStart+offset);}}// ... <signed-integer>\n// ... ['+' | '-'] <signless-integer>\nfunction consumeB(){var offset=0;var sign=0;var type=this.scanner.tokenType;while(type===WHITESPACE$5||type===COMMENT$4){type=this.scanner.lookupType(++offset);}if(type!==NUMBER$3){if(this.scanner.isDelim(PLUSSIGN$2,offset)||this.scanner.isDelim(HYPHENMINUS$1,offset)){sign=this.scanner.isDelim(PLUSSIGN$2,offset)?PLUSSIGN$2:HYPHENMINUS$1;do{type=this.scanner.lookupType(++offset);}while(type===WHITESPACE$5||type===COMMENT$4);if(type!==NUMBER$3){this.scanner.skip(offset);checkTokenIsInteger.call(this,DISALLOW_SIGN);}}else{return null;}}if(offset>0){this.scanner.skip(offset);}if(sign===0){type=this.scanner.source.charCodeAt(this.scanner.tokenStart);if(type!==PLUSSIGN$2&&type!==HYPHENMINUS$1){this.error('Number sign is expected');}}checkTokenIsInteger.call(this,sign!==0);return sign===HYPHENMINUS$1?'-'+this.consume(NUMBER$3):this.consume(NUMBER$3);}// An+B microsyntax https://www.w3.org/TR/css-syntax-3/#anb\nvar AnPlusB={name:'AnPlusB',structure:{a:[String,null],b:[String,null]},parse:function parse(){/* eslint-disable brace-style*/var start=this.scanner.tokenStart;var a=null;var b=null;// <integer>\nif(this.scanner.tokenType===NUMBER$3){checkTokenIsInteger.call(this,ALLOW_SIGN);b=this.consume(NUMBER$3);}// -n\n// -n <signed-integer>\n// -n ['+' | '-'] <signless-integer>\n// -n- <signless-integer>\n// <dashndashdigit-ident>\nelse if(this.scanner.tokenType===IDENT$5&&cmpChar$2(this.scanner.source,this.scanner.tokenStart,HYPHENMINUS$1)){a='-1';expectCharCode.call(this,1,N$1);switch(this.scanner.getTokenLength()){// -n\n// -n <signed-integer>\n// -n ['+' | '-'] <signless-integer>\ncase 2:this.scanner.next();b=consumeB.call(this);break;// -n- <signless-integer>\ncase 3:expectCharCode.call(this,2,HYPHENMINUS$1);this.scanner.next();this.scanner.skipSC();checkTokenIsInteger.call(this,DISALLOW_SIGN);b='-'+this.consume(NUMBER$3);break;// <dashndashdigit-ident>\ndefault:expectCharCode.call(this,2,HYPHENMINUS$1);checkInteger.call(this,3,DISALLOW_SIGN);this.scanner.next();b=this.scanner.substrToCursor(start+2);}}// '+'? n\n// '+'? n <signed-integer>\n// '+'? n ['+' | '-'] <signless-integer>\n// '+'? n- <signless-integer>\n// '+'? <ndashdigit-ident>\nelse if(this.scanner.tokenType===IDENT$5||this.scanner.isDelim(PLUSSIGN$2)&&this.scanner.lookupType(1)===IDENT$5){var sign=0;a='1';// just ignore a plus\nif(this.scanner.isDelim(PLUSSIGN$2)){sign=1;this.scanner.next();}expectCharCode.call(this,0,N$1);switch(this.scanner.getTokenLength()){// '+'? n\n// '+'? n <signed-integer>\n// '+'? n ['+' | '-'] <signless-integer>\ncase 1:this.scanner.next();b=consumeB.call(this);break;// '+'? n- <signless-integer>\ncase 2:expectCharCode.call(this,1,HYPHENMINUS$1);this.scanner.next();this.scanner.skipSC();checkTokenIsInteger.call(this,DISALLOW_SIGN);b='-'+this.consume(NUMBER$3);break;// '+'? <ndashdigit-ident>\ndefault:expectCharCode.call(this,1,HYPHENMINUS$1);checkInteger.call(this,2,DISALLOW_SIGN);this.scanner.next();b=this.scanner.substrToCursor(start+sign+1);}}// <ndashdigit-dimension>\n// <ndash-dimension> <signless-integer>\n// <n-dimension>\n// <n-dimension> <signed-integer>\n// <n-dimension> ['+' | '-'] <signless-integer>\nelse if(this.scanner.tokenType===DIMENSION$2){var code=this.scanner.source.charCodeAt(this.scanner.tokenStart);var sign=code===PLUSSIGN$2||code===HYPHENMINUS$1;for(var i=this.scanner.tokenStart+sign;i<this.scanner.tokenEnd;i++){if(!isDigit$2(this.scanner.source.charCodeAt(i))){break;}}if(i===this.scanner.tokenStart+sign){this.error('Integer is expected',this.scanner.tokenStart+sign);}expectCharCode.call(this,i-this.scanner.tokenStart,N$1);a=this.scanner.source.substring(start,i);// <n-dimension>\n// <n-dimension> <signed-integer>\n// <n-dimension> ['+' | '-'] <signless-integer>\nif(i+1===this.scanner.tokenEnd){this.scanner.next();b=consumeB.call(this);}else{expectCharCode.call(this,i-this.scanner.tokenStart+1,HYPHENMINUS$1);// <ndash-dimension> <signless-integer>\nif(i+2===this.scanner.tokenEnd){this.scanner.next();this.scanner.skipSC();checkTokenIsInteger.call(this,DISALLOW_SIGN);b='-'+this.consume(NUMBER$3);}// <ndashdigit-dimension>\nelse{checkInteger.call(this,i-this.scanner.tokenStart+2,DISALLOW_SIGN);this.scanner.next();b=this.scanner.substrToCursor(i+1);}}}else{this.error();}if(a!==null&&a.charCodeAt(0)===PLUSSIGN$2){a=a.substr(1);}if(b!==null&&b.charCodeAt(0)===PLUSSIGN$2){b=b.substr(1);}return{type:'AnPlusB',loc:this.getLocation(start,this.scanner.tokenStart),a:a,b:b};},generate:function generate(node){var a=node.a!==null&&node.a!==undefined;var b=node.b!==null&&node.b!==undefined;if(a){this.chunk(node.a==='+1'?'+n':// eslint-disable-line operator-linebreak, indent\nnode.a==='1'?'n':// eslint-disable-line operator-linebreak, indent\nnode.a==='-1'?'-n':// eslint-disable-line operator-linebreak, indent\nnode.a+'n'// eslint-disable-line operator-linebreak, indent\n);if(b){b=String(node.b);if(b.charAt(0)==='-'||b.charAt(0)==='+'){this.chunk(b.charAt(0));this.chunk(b.substr(1));}else{this.chunk('+');this.chunk(b);}}}else{this.chunk(String(node.b));}}};var TYPE$c=tokenizer.TYPE;var rawMode$1=Raw.mode;var ATKEYWORD=TYPE$c.AtKeyword;var SEMICOLON=TYPE$c.Semicolon;var LEFTCURLYBRACKET=TYPE$c.LeftCurlyBracket;var RIGHTCURLYBRACKET=TYPE$c.RightCurlyBracket;function consumeRaw$1(startToken){return this.Raw(startToken,rawMode$1.leftCurlyBracketOrSemicolon,true);}function isDeclarationBlockAtrule(){for(var offset=1,type;type=this.scanner.lookupType(offset);offset++){if(type===RIGHTCURLYBRACKET){return true;}if(type===LEFTCURLYBRACKET||type===ATKEYWORD){return false;}}return false;}var Atrule={name:'Atrule',structure:{name:String,prelude:['AtrulePrelude','Raw',null],block:['Block',null]},parse:function parse(){var start=this.scanner.tokenStart;var name;var nameLowerCase;var prelude=null;var block=null;this.eat(ATKEYWORD);name=this.scanner.substrToCursor(start+1);nameLowerCase=name.toLowerCase();this.scanner.skipSC();// parse prelude\nif(this.scanner.eof===false&&this.scanner.tokenType!==LEFTCURLYBRACKET&&this.scanner.tokenType!==SEMICOLON){if(this.parseAtrulePrelude){prelude=this.parseWithFallback(this.AtrulePrelude.bind(this,name),consumeRaw$1);// turn empty AtrulePrelude into null\nif(prelude.type==='AtrulePrelude'&&prelude.children.head===null){prelude=null;}}else{prelude=consumeRaw$1.call(this,this.scanner.tokenIndex);}this.scanner.skipSC();}switch(this.scanner.tokenType){case SEMICOLON:this.scanner.next();break;case LEFTCURLYBRACKET:if(this.atrule.hasOwnProperty(nameLowerCase)&&typeof this.atrule[nameLowerCase].block==='function'){block=this.atrule[nameLowerCase].block.call(this);}else{// TODO: should consume block content as Raw?\nblock=this.Block(isDeclarationBlockAtrule.call(this));}break;}return{type:'Atrule',loc:this.getLocation(start,this.scanner.tokenStart),name:name,prelude:prelude,block:block};},generate:function generate(node){this.chunk('@');this.chunk(node.name);if(node.prelude!==null){this.chunk(' ');this.node(node.prelude);}if(node.block){this.node(node.block);}else{this.chunk(';');}},walkContext:'atrule'};var TYPE$d=tokenizer.TYPE;var SEMICOLON$1=TYPE$d.Semicolon;var LEFTCURLYBRACKET$1=TYPE$d.LeftCurlyBracket;var AtrulePrelude={name:'AtrulePrelude',structure:{children:[[]]},parse:function parse(name){var children=null;if(name!==null){name=name.toLowerCase();}this.scanner.skipSC();if(this.atrule.hasOwnProperty(name)&&typeof this.atrule[name].prelude==='function'){// custom consumer\nchildren=this.atrule[name].prelude.call(this);}else{// default consumer\nchildren=this.readSequence(this.scope.AtrulePrelude);}this.scanner.skipSC();if(this.scanner.eof!==true&&this.scanner.tokenType!==LEFTCURLYBRACKET$1&&this.scanner.tokenType!==SEMICOLON$1){this.error('Semicolon or block is expected');}if(children===null){children=this.createList();}return{type:'AtrulePrelude',loc:this.getLocationFromList(children),children:children};},generate:function generate(node){this.children(node);},walkContext:'atrulePrelude'};var TYPE$e=tokenizer.TYPE;var IDENT$6=TYPE$e.Ident;var STRING$2=TYPE$e.String;var COLON$2=TYPE$e.Colon;var LEFTSQUAREBRACKET$2=TYPE$e.LeftSquareBracket;var RIGHTSQUAREBRACKET=TYPE$e.RightSquareBracket;var DOLLARSIGN=0x0024;// U+0024 DOLLAR SIGN ($)\nvar ASTERISK$2=0x002A;// U+002A ASTERISK (*)\nvar EQUALSSIGN=0x003D;// U+003D EQUALS SIGN (=)\nvar CIRCUMFLEXACCENT=0x005E;// U+005E (^)\nvar VERTICALLINE$1=0x007C;// U+007C VERTICAL LINE (|)\nvar TILDE$1=0x007E;// U+007E TILDE (~)\nfunction getAttributeName(){if(this.scanner.eof){this.error('Unexpected end of input');}var start=this.scanner.tokenStart;var expectIdent=false;var checkColon=true;if(this.scanner.isDelim(ASTERISK$2)){expectIdent=true;checkColon=false;this.scanner.next();}else if(!this.scanner.isDelim(VERTICALLINE$1)){this.eat(IDENT$6);}if(this.scanner.isDelim(VERTICALLINE$1)){if(this.scanner.source.charCodeAt(this.scanner.tokenStart+1)!==EQUALSSIGN){this.scanner.next();this.eat(IDENT$6);}else if(expectIdent){this.error('Identifier is expected',this.scanner.tokenEnd);}}else if(expectIdent){this.error('Vertical line is expected');}if(checkColon&&this.scanner.tokenType===COLON$2){this.scanner.next();this.eat(IDENT$6);}return{type:'Identifier',loc:this.getLocation(start,this.scanner.tokenStart),name:this.scanner.substrToCursor(start)};}function getOperator(){var start=this.scanner.tokenStart;var code=this.scanner.source.charCodeAt(start);if(code!==EQUALSSIGN&&// =\ncode!==TILDE$1&&// ~=\ncode!==CIRCUMFLEXACCENT&&// ^=\ncode!==DOLLARSIGN&&// $=\ncode!==ASTERISK$2&&// *=\ncode!==VERTICALLINE$1// |=\n){this.error('Attribute selector (=, ~=, ^=, $=, *=, |=) is expected');}this.scanner.next();if(code!==EQUALSSIGN){if(!this.scanner.isDelim(EQUALSSIGN)){this.error('Equal sign is expected');}this.scanner.next();}return this.scanner.substrToCursor(start);}// '[' <wq-name> ']'\n// '[' <wq-name> <attr-matcher> [ <string-token> | <ident-token> ] <attr-modifier>? ']'\nvar AttributeSelector={name:'AttributeSelector',structure:{name:'Identifier',matcher:[String,null],value:['String','Identifier',null],flags:[String,null]},parse:function parse(){var start=this.scanner.tokenStart;var name;var matcher=null;var value=null;var flags=null;this.eat(LEFTSQUAREBRACKET$2);this.scanner.skipSC();name=getAttributeName.call(this);this.scanner.skipSC();if(this.scanner.tokenType!==RIGHTSQUAREBRACKET){// avoid case `[name i]`\nif(this.scanner.tokenType!==IDENT$6){matcher=getOperator.call(this);this.scanner.skipSC();value=this.scanner.tokenType===STRING$2?this.String():this.Identifier();this.scanner.skipSC();}// attribute flags\nif(this.scanner.tokenType===IDENT$6){flags=this.scanner.getTokenValue();this.scanner.next();this.scanner.skipSC();}}this.eat(RIGHTSQUAREBRACKET);return{type:'AttributeSelector',loc:this.getLocation(start,this.scanner.tokenStart),name:name,matcher:matcher,value:value,flags:flags};},generate:function generate(node){var flagsPrefix=' ';this.chunk('[');this.node(node.name);if(node.matcher!==null){this.chunk(node.matcher);if(node.value!==null){this.node(node.value);// space between string and flags is not required\nif(node.value.type==='String'){flagsPrefix='';}}}if(node.flags!==null){this.chunk(flagsPrefix);this.chunk(node.flags);}this.chunk(']');}};var TYPE$f=tokenizer.TYPE;var rawMode$2=Raw.mode;var WHITESPACE$6=TYPE$f.WhiteSpace;var COMMENT$5=TYPE$f.Comment;var SEMICOLON$2=TYPE$f.Semicolon;var ATKEYWORD$1=TYPE$f.AtKeyword;var LEFTCURLYBRACKET$2=TYPE$f.LeftCurlyBracket;var RIGHTCURLYBRACKET$1=TYPE$f.RightCurlyBracket;function consumeRaw$2(startToken){return this.Raw(startToken,null,true);}function consumeRule(){return this.parseWithFallback(this.Rule,consumeRaw$2);}function consumeRawDeclaration(startToken){return this.Raw(startToken,rawMode$2.semicolonIncluded,true);}function consumeDeclaration(){if(this.scanner.tokenType===SEMICOLON$2){return consumeRawDeclaration.call(this,this.scanner.tokenIndex);}var node=this.parseWithFallback(this.Declaration,consumeRawDeclaration);if(this.scanner.tokenType===SEMICOLON$2){this.scanner.next();}return node;}var Block={name:'Block',structure:{children:[['Atrule','Rule','Declaration']]},parse:function parse(isDeclaration){var consumer=isDeclaration?consumeDeclaration:consumeRule;var start=this.scanner.tokenStart;var children=this.createList();this.eat(LEFTCURLYBRACKET$2);scan:while(!this.scanner.eof){switch(this.scanner.tokenType){case RIGHTCURLYBRACKET$1:break scan;case WHITESPACE$6:case COMMENT$5:this.scanner.next();break;case ATKEYWORD$1:children.push(this.parseWithFallback(this.Atrule,consumeRaw$2));break;default:children.push(consumer.call(this));}}if(!this.scanner.eof){this.eat(RIGHTCURLYBRACKET$1);}return{type:'Block',loc:this.getLocation(start,this.scanner.tokenStart),children:children};},generate:function generate(node){this.chunk('{');this.children(node,function(prev){if(prev.type==='Declaration'){this.chunk(';');}});this.chunk('}');},walkContext:'block'};var TYPE$g=tokenizer.TYPE;var LEFTSQUAREBRACKET$3=TYPE$g.LeftSquareBracket;var RIGHTSQUAREBRACKET$1=TYPE$g.RightSquareBracket;var Brackets={name:'Brackets',structure:{children:[[]]},parse:function parse(readSequence,recognizer){var start=this.scanner.tokenStart;var children=null;this.eat(LEFTSQUAREBRACKET$3);children=readSequence.call(this,recognizer);if(!this.scanner.eof){this.eat(RIGHTSQUAREBRACKET$1);}return{type:'Brackets',loc:this.getLocation(start,this.scanner.tokenStart),children:children};},generate:function generate(node){this.chunk('[');this.children(node);this.chunk(']');}};var CDC=tokenizer.TYPE.CDC;var CDC_1={name:'CDC',structure:[],parse:function parse(){var start=this.scanner.tokenStart;this.eat(CDC);// -->\nreturn{type:'CDC',loc:this.getLocation(start,this.scanner.tokenStart)};},generate:function generate(){this.chunk('-->');}};var CDO=tokenizer.TYPE.CDO;var CDO_1={name:'CDO',structure:[],parse:function parse(){var start=this.scanner.tokenStart;this.eat(CDO);// <!--\nreturn{type:'CDO',loc:this.getLocation(start,this.scanner.tokenStart)};},generate:function generate(){this.chunk('<!--');}};var TYPE$h=tokenizer.TYPE;var IDENT$7=TYPE$h.Ident;var FULLSTOP$1=0x002E;// U+002E FULL STOP (.)\n// '.' ident\nvar ClassSelector={name:'ClassSelector',structure:{name:String},parse:function parse(){if(!this.scanner.isDelim(FULLSTOP$1)){this.error('Full stop is expected');}this.scanner.next();return{type:'ClassSelector',loc:this.getLocation(this.scanner.tokenStart-1,this.scanner.tokenEnd),name:this.consume(IDENT$7)};},generate:function generate(node){this.chunk('.');this.chunk(node.name);}};var TYPE$i=tokenizer.TYPE;var IDENT$8=TYPE$i.Ident;var PLUSSIGN$3=0x002B;// U+002B PLUS SIGN (+)\nvar SOLIDUS$2=0x002F;// U+002F SOLIDUS (/)\nvar GREATERTHANSIGN$1=0x003E;// U+003E GREATER-THAN SIGN (>)\nvar TILDE$2=0x007E;// U+007E TILDE (~)\n// + | > | ~ | /deep/\nvar Combinator={name:'Combinator',structure:{name:String},parse:function parse(){var start=this.scanner.tokenStart;var code=this.scanner.source.charCodeAt(this.scanner.tokenStart);switch(code){case GREATERTHANSIGN$1:case PLUSSIGN$3:case TILDE$2:this.scanner.next();break;case SOLIDUS$2:this.scanner.next();if(this.scanner.tokenType!==IDENT$8||this.scanner.lookupValue(0,'deep')===false){this.error('Identifier `deep` is expected');}this.scanner.next();if(!this.scanner.isDelim(SOLIDUS$2)){this.error('Solidus is expected');}this.scanner.next();break;default:this.error('Combinator is expected');}return{type:'Combinator',loc:this.getLocation(start,this.scanner.tokenStart),name:this.scanner.substrToCursor(start)};},generate:function generate(node){this.chunk(node.name);}};var TYPE$j=tokenizer.TYPE;var COMMENT$6=TYPE$j.Comment;var ASTERISK$3=0x002A;// U+002A ASTERISK (*)\nvar SOLIDUS$3=0x002F;// U+002F SOLIDUS (/)\n// '/*' .* '*/'\nvar Comment={name:'Comment',structure:{value:String},parse:function parse(){var start=this.scanner.tokenStart;var end=this.scanner.tokenEnd;this.eat(COMMENT$6);if(end-start+2>=2&&this.scanner.source.charCodeAt(end-2)===ASTERISK$3&&this.scanner.source.charCodeAt(end-1)===SOLIDUS$3){end-=2;}return{type:'Comment',loc:this.getLocation(start,this.scanner.tokenStart),value:this.scanner.source.substring(start+2,end)};},generate:function generate(node){this.chunk('/*');this.chunk(node.value);this.chunk('*/');}};var hasOwnProperty$1=Object.prototype.hasOwnProperty;var keywords$2=Object.create(null);var properties=Object.create(null);var HYPHENMINUS$2=45;// '-'.charCodeAt()\nfunction isCustomProperty(str,offset){offset=offset||0;return str.length-offset>=2&&str.charCodeAt(offset)===HYPHENMINUS$2&&str.charCodeAt(offset+1)===HYPHENMINUS$2;}function getVendorPrefix(str,offset){offset=offset||0;// verdor prefix should be at least 3 chars length\nif(str.length-offset>=3){// vendor prefix starts with hyper minus following non-hyper minus\nif(str.charCodeAt(offset)===HYPHENMINUS$2&&str.charCodeAt(offset+1)!==HYPHENMINUS$2){// vendor prefix should contain a hyper minus at the ending\nvar secondDashIndex=str.indexOf('-',offset+2);if(secondDashIndex!==-1){return str.substring(offset,secondDashIndex+1);}}}return'';}function getKeywordDescriptor(keyword){if(hasOwnProperty$1.call(keywords$2,keyword)){return keywords$2[keyword];}var name=keyword.toLowerCase();if(hasOwnProperty$1.call(keywords$2,name)){return keywords$2[keyword]=keywords$2[name];}var custom=isCustomProperty(name,0);var vendor=!custom?getVendorPrefix(name,0):'';return keywords$2[keyword]=Object.freeze({basename:name.substr(vendor.length),name:name,vendor:vendor,prefix:vendor,custom:custom});}function getPropertyDescriptor(property){if(hasOwnProperty$1.call(properties,property)){return properties[property];}var name=property;var hack=property[0];if(hack==='/'){hack=property[1]==='/'?'//':'/';}else if(hack!=='_'&&hack!=='*'&&hack!=='$'&&hack!=='#'&&hack!=='+'&&hack!=='&'){hack='';}var custom=isCustomProperty(name,hack.length);// re-use result when possible (the same as for lower case)\nif(!custom){name=name.toLowerCase();if(hasOwnProperty$1.call(properties,name)){return properties[property]=properties[name];}}var vendor=!custom?getVendorPrefix(name,hack.length):'';var prefix=name.substr(0,hack.length+vendor.length);return properties[property]=Object.freeze({basename:name.substr(prefix.length),name:name.substr(hack.length),hack:hack,vendor:vendor,prefix:prefix,custom:custom});}var names={keyword:getKeywordDescriptor,property:getPropertyDescriptor,isCustomProperty:isCustomProperty,vendorPrefix:getVendorPrefix};var isCustomProperty$1=names.isCustomProperty;var TYPE$k=tokenizer.TYPE;var rawMode$3=Raw.mode;var IDENT$9=TYPE$k.Ident;var HASH$3=TYPE$k.Hash;var COLON$3=TYPE$k.Colon;var SEMICOLON$3=TYPE$k.Semicolon;var DELIM$2=TYPE$k.Delim;var WHITESPACE$7=TYPE$k.WhiteSpace;var EXCLAMATIONMARK$1=0x0021;// U+0021 EXCLAMATION MARK (!)\nvar NUMBERSIGN$3=0x0023;// U+0023 NUMBER SIGN (#)\nvar DOLLARSIGN$1=0x0024;// U+0024 DOLLAR SIGN ($)\nvar AMPERSAND=0x0026;// U+0026 ANPERSAND (&)\nvar ASTERISK$4=0x002A;// U+002A ASTERISK (*)\nvar PLUSSIGN$4=0x002B;// U+002B PLUS SIGN (+)\nvar SOLIDUS$4=0x002F;// U+002F SOLIDUS (/)\nfunction consumeValueRaw(startToken){return this.Raw(startToken,rawMode$3.exclamationMarkOrSemicolon,true);}function consumeCustomPropertyRaw(startToken){return this.Raw(startToken,rawMode$3.exclamationMarkOrSemicolon,false);}function consumeValue(){var startValueToken=this.scanner.tokenIndex;var value=this.Value();if(value.type!=='Raw'&&this.scanner.eof===false&&this.scanner.tokenType!==SEMICOLON$3&&this.scanner.isDelim(EXCLAMATIONMARK$1)===false&&this.scanner.isBalanceEdge(startValueToken)===false){this.error();}return value;}var Declaration={name:'Declaration',structure:{important:[Boolean,String],property:String,value:['Value','Raw']},parse:function parse(){var start=this.scanner.tokenStart;var startToken=this.scanner.tokenIndex;var property=readProperty.call(this);var customProperty=isCustomProperty$1(property);var parseValue=customProperty?this.parseCustomProperty:this.parseValue;var consumeRaw=customProperty?consumeCustomPropertyRaw:consumeValueRaw;var important=false;var value;this.scanner.skipSC();this.eat(COLON$3);var valueStart=this.scanner.tokenIndex;if(!customProperty){this.scanner.skipSC();}if(parseValue){value=this.parseWithFallback(consumeValue,consumeRaw);}else{value=consumeRaw.call(this,this.scanner.tokenIndex);}if(customProperty&&value.type==='Value'&&value.children.isEmpty()){for(var offset=valueStart-this.scanner.tokenIndex;offset<=0;offset++){if(this.scanner.lookupType(offset)===WHITESPACE$7){value.children.appendData({type:'WhiteSpace',loc:null,value:' '});break;}}}if(this.scanner.isDelim(EXCLAMATIONMARK$1)){important=getImportant.call(this);this.scanner.skipSC();}// Do not include semicolon to range per spec\n// https://drafts.csswg.org/css-syntax/#declaration-diagram\nif(this.scanner.eof===false&&this.scanner.tokenType!==SEMICOLON$3&&this.scanner.isBalanceEdge(startToken)===false){this.error();}return{type:'Declaration',loc:this.getLocation(start,this.scanner.tokenStart),important:important,property:property,value:value};},generate:function generate(node){this.chunk(node.property);this.chunk(':');this.node(node.value);if(node.important){this.chunk(node.important===true?'!important':'!'+node.important);}},walkContext:'declaration'};function readProperty(){var start=this.scanner.tokenStart;// hacks\nif(this.scanner.tokenType===DELIM$2){switch(this.scanner.source.charCodeAt(this.scanner.tokenStart)){case ASTERISK$4:case DOLLARSIGN$1:case PLUSSIGN$4:case NUMBERSIGN$3:case AMPERSAND:this.scanner.next();break;// TODO: not sure we should support this hack\ncase SOLIDUS$4:this.scanner.next();if(this.scanner.isDelim(SOLIDUS$4)){this.scanner.next();}break;}}if(this.scanner.tokenType===HASH$3){this.eat(HASH$3);}else{this.eat(IDENT$9);}return this.scanner.substrToCursor(start);}// ! ws* important\nfunction getImportant(){this.eat(DELIM$2);this.scanner.skipSC();var important=this.consume(IDENT$9);// store original value in case it differ from `important`\n// for better original source restoring and hacks like `!ie` support\nreturn important==='important'?true:important;}var TYPE$l=tokenizer.TYPE;var rawMode$4=Raw.mode;var WHITESPACE$8=TYPE$l.WhiteSpace;var COMMENT$7=TYPE$l.Comment;var SEMICOLON$4=TYPE$l.Semicolon;function consumeRaw$3(startToken){return this.Raw(startToken,rawMode$4.semicolonIncluded,true);}var DeclarationList={name:'DeclarationList',structure:{children:[['Declaration']]},parse:function parse(){var children=this.createList();while(!this.scanner.eof){switch(this.scanner.tokenType){case WHITESPACE$8:case COMMENT$7:case SEMICOLON$4:this.scanner.next();break;default:children.push(this.parseWithFallback(this.Declaration,consumeRaw$3));}}return{type:'DeclarationList',loc:this.getLocationFromList(children),children:children};},generate:function generate(node){this.children(node,function(prev){if(prev.type==='Declaration'){this.chunk(';');}});}};var consumeNumber$2=utils.consumeNumber;var TYPE$m=tokenizer.TYPE;var DIMENSION$3=TYPE$m.Dimension;var Dimension={name:'Dimension',structure:{value:String,unit:String},parse:function parse(){var start=this.scanner.tokenStart;var numberEnd=consumeNumber$2(this.scanner.source,start);this.eat(DIMENSION$3);return{type:'Dimension',loc:this.getLocation(start,this.scanner.tokenStart),value:this.scanner.source.substring(start,numberEnd),unit:this.scanner.source.substring(numberEnd,this.scanner.tokenStart)};},generate:function generate(node){this.chunk(node.value);this.chunk(node.unit);}};var TYPE$n=tokenizer.TYPE;var RIGHTPARENTHESIS=TYPE$n.RightParenthesis;// <function-token> <sequence> )\nvar _Function={name:'Function',structure:{name:String,children:[[]]},parse:function parse(readSequence,recognizer){var start=this.scanner.tokenStart;var name=this.consumeFunctionName();var nameLowerCase=name.toLowerCase();var children;children=recognizer.hasOwnProperty(nameLowerCase)?recognizer[nameLowerCase].call(this,recognizer):readSequence.call(this,recognizer);if(!this.scanner.eof){this.eat(RIGHTPARENTHESIS);}return{type:'Function',loc:this.getLocation(start,this.scanner.tokenStart),name:name,children:children};},generate:function generate(node){this.chunk(node.name);this.chunk('(');this.children(node);this.chunk(')');},walkContext:'function'};var TYPE$o=tokenizer.TYPE;var HASH$4=TYPE$o.Hash;// '#' ident\nvar Hash={name:'Hash',structure:{value:String},parse:function parse(){var start=this.scanner.tokenStart;this.eat(HASH$4);return{type:'Hash',loc:this.getLocation(start,this.scanner.tokenStart),value:this.scanner.substrToCursor(start+1)};},generate:function generate(node){this.chunk('#');this.chunk(node.value);}};var TYPE$p=tokenizer.TYPE;var IDENT$a=TYPE$p.Ident;var Identifier={name:'Identifier',structure:{name:String},parse:function parse(){return{type:'Identifier',loc:this.getLocation(this.scanner.tokenStart,this.scanner.tokenEnd),name:this.consume(IDENT$a)};},generate:function generate(node){this.chunk(node.name);}};var TYPE$q=tokenizer.TYPE;var HASH$5=TYPE$q.Hash;// <hash-token>\nvar IdSelector={name:'IdSelector',structure:{name:String},parse:function parse(){var start=this.scanner.tokenStart;// TODO: check value is an ident\nthis.eat(HASH$5);return{type:'IdSelector',loc:this.getLocation(start,this.scanner.tokenStart),name:this.scanner.substrToCursor(start+1)};},generate:function generate(node){this.chunk('#');this.chunk(node.name);}};var TYPE$r=tokenizer.TYPE;var IDENT$b=TYPE$r.Ident;var NUMBER$4=TYPE$r.Number;var DIMENSION$4=TYPE$r.Dimension;var LEFTPARENTHESIS$3=TYPE$r.LeftParenthesis;var RIGHTPARENTHESIS$1=TYPE$r.RightParenthesis;var COLON$4=TYPE$r.Colon;var DELIM$3=TYPE$r.Delim;var MediaFeature={name:'MediaFeature',structure:{name:String,value:['Identifier','Number','Dimension','Ratio',null]},parse:function parse(){var start=this.scanner.tokenStart;var name;var value=null;this.eat(LEFTPARENTHESIS$3);this.scanner.skipSC();name=this.consume(IDENT$b);this.scanner.skipSC();if(this.scanner.tokenType!==RIGHTPARENTHESIS$1){this.eat(COLON$4);this.scanner.skipSC();switch(this.scanner.tokenType){case NUMBER$4:if(this.lookupNonWSType(1)===DELIM$3){value=this.Ratio();}else{value=this.Number();}break;case DIMENSION$4:value=this.Dimension();break;case IDENT$b:value=this.Identifier();break;default:this.error('Number, dimension, ratio or identifier is expected');}this.scanner.skipSC();}this.eat(RIGHTPARENTHESIS$1);return{type:'MediaFeature',loc:this.getLocation(start,this.scanner.tokenStart),name:name,value:value};},generate:function generate(node){this.chunk('(');this.chunk(node.name);if(node.value!==null){this.chunk(':');this.node(node.value);}this.chunk(')');}};var TYPE$s=tokenizer.TYPE;var WHITESPACE$9=TYPE$s.WhiteSpace;var COMMENT$8=TYPE$s.Comment;var IDENT$c=TYPE$s.Ident;var LEFTPARENTHESIS$4=TYPE$s.LeftParenthesis;var MediaQuery={name:'MediaQuery',structure:{children:[['Identifier','MediaFeature','WhiteSpace']]},parse:function parse(){this.scanner.skipSC();var children=this.createList();var child=null;var space=null;scan:while(!this.scanner.eof){switch(this.scanner.tokenType){case COMMENT$8:this.scanner.next();continue;case WHITESPACE$9:space=this.WhiteSpace();continue;case IDENT$c:child=this.Identifier();break;case LEFTPARENTHESIS$4:child=this.MediaFeature();break;default:break scan;}if(space!==null){children.push(space);space=null;}children.push(child);}if(child===null){this.error('Identifier or parenthesis is expected');}return{type:'MediaQuery',loc:this.getLocationFromList(children),children:children};},generate:function generate(node){this.children(node);}};var COMMA$2=tokenizer.TYPE.Comma;var MediaQueryList={name:'MediaQueryList',structure:{children:[['MediaQuery']]},parse:function parse(relative){var children=this.createList();this.scanner.skipSC();while(!this.scanner.eof){children.push(this.MediaQuery(relative));if(this.scanner.tokenType!==COMMA$2){break;}this.scanner.next();}return{type:'MediaQueryList',loc:this.getLocationFromList(children),children:children};},generate:function generate(node){this.children(node,function(){this.chunk(',');});}};var Nth={name:'Nth',structure:{nth:['AnPlusB','Identifier'],selector:['SelectorList',null]},parse:function parse(allowOfClause){this.scanner.skipSC();var start=this.scanner.tokenStart;var end=start;var selector=null;var query;if(this.scanner.lookupValue(0,'odd')||this.scanner.lookupValue(0,'even')){query=this.Identifier();}else{query=this.AnPlusB();}this.scanner.skipSC();if(allowOfClause&&this.scanner.lookupValue(0,'of')){this.scanner.next();selector=this.SelectorList();if(this.needPositions){end=this.getLastListNode(selector.children).loc.end.offset;}}else{if(this.needPositions){end=query.loc.end.offset;}}return{type:'Nth',loc:this.getLocation(start,end),nth:query,selector:selector};},generate:function generate(node){this.node(node.nth);if(node.selector!==null){this.chunk(' of ');this.node(node.selector);}}};var NUMBER$5=tokenizer.TYPE.Number;var _Number={name:'Number',structure:{value:String},parse:function parse(){return{type:'Number',loc:this.getLocation(this.scanner.tokenStart,this.scanner.tokenEnd),value:this.consume(NUMBER$5)};},generate:function generate(node){this.chunk(node.value);}};// '/' | '*' | ',' | ':' | '+' | '-'\nvar Operator={name:'Operator',structure:{value:String},parse:function parse(){var start=this.scanner.tokenStart;this.scanner.next();return{type:'Operator',loc:this.getLocation(start,this.scanner.tokenStart),value:this.scanner.substrToCursor(start)};},generate:function generate(node){this.chunk(node.value);}};var TYPE$t=tokenizer.TYPE;var LEFTPARENTHESIS$5=TYPE$t.LeftParenthesis;var RIGHTPARENTHESIS$2=TYPE$t.RightParenthesis;var Parentheses={name:'Parentheses',structure:{children:[[]]},parse:function parse(readSequence,recognizer){var start=this.scanner.tokenStart;var children=null;this.eat(LEFTPARENTHESIS$5);children=readSequence.call(this,recognizer);if(!this.scanner.eof){this.eat(RIGHTPARENTHESIS$2);}return{type:'Parentheses',loc:this.getLocation(start,this.scanner.tokenStart),children:children};},generate:function generate(node){this.chunk('(');this.children(node);this.chunk(')');}};var consumeNumber$3=utils.consumeNumber;var TYPE$u=tokenizer.TYPE;var PERCENTAGE$3=TYPE$u.Percentage;var Percentage={name:'Percentage',structure:{value:String},parse:function parse(){var start=this.scanner.tokenStart;var numberEnd=consumeNumber$3(this.scanner.source,start);this.eat(PERCENTAGE$3);return{type:'Percentage',loc:this.getLocation(start,this.scanner.tokenStart),value:this.scanner.source.substring(start,numberEnd)};},generate:function generate(node){this.chunk(node.value);this.chunk('%');}};var TYPE$v=tokenizer.TYPE;var IDENT$d=TYPE$v.Ident;var FUNCTION$4=TYPE$v.Function;var COLON$5=TYPE$v.Colon;var RIGHTPARENTHESIS$3=TYPE$v.RightParenthesis;// : [ <ident> | <function-token> <any-value>? ) ]\nvar PseudoClassSelector={name:'PseudoClassSelector',structure:{name:String,children:[['Raw'],null]},parse:function parse(){var start=this.scanner.tokenStart;var children=null;var name;var nameLowerCase;this.eat(COLON$5);if(this.scanner.tokenType===FUNCTION$4){name=this.consumeFunctionName();nameLowerCase=name.toLowerCase();if(this.pseudo.hasOwnProperty(nameLowerCase)){this.scanner.skipSC();children=this.pseudo[nameLowerCase].call(this);this.scanner.skipSC();}else{children=this.createList();children.push(this.Raw(this.scanner.tokenIndex,null,false));}this.eat(RIGHTPARENTHESIS$3);}else{name=this.consume(IDENT$d);}return{type:'PseudoClassSelector',loc:this.getLocation(start,this.scanner.tokenStart),name:name,children:children};},generate:function generate(node){this.chunk(':');this.chunk(node.name);if(node.children!==null){this.chunk('(');this.children(node);this.chunk(')');}},walkContext:'function'};var TYPE$w=tokenizer.TYPE;var IDENT$e=TYPE$w.Ident;var FUNCTION$5=TYPE$w.Function;var COLON$6=TYPE$w.Colon;var RIGHTPARENTHESIS$4=TYPE$w.RightParenthesis;// :: [ <ident> | <function-token> <any-value>? ) ]\nvar PseudoElementSelector={name:'PseudoElementSelector',structure:{name:String,children:[['Raw'],null]},parse:function parse(){var start=this.scanner.tokenStart;var children=null;var name;var nameLowerCase;this.eat(COLON$6);this.eat(COLON$6);if(this.scanner.tokenType===FUNCTION$5){name=this.consumeFunctionName();nameLowerCase=name.toLowerCase();if(this.pseudo.hasOwnProperty(nameLowerCase)){this.scanner.skipSC();children=this.pseudo[nameLowerCase].call(this);this.scanner.skipSC();}else{children=this.createList();children.push(this.Raw(this.scanner.tokenIndex,null,false));}this.eat(RIGHTPARENTHESIS$4);}else{name=this.consume(IDENT$e);}return{type:'PseudoElementSelector',loc:this.getLocation(start,this.scanner.tokenStart),name:name,children:children};},generate:function generate(node){this.chunk('::');this.chunk(node.name);if(node.children!==null){this.chunk('(');this.children(node);this.chunk(')');}},walkContext:'function'};var isDigit$3=tokenizer.isDigit;var TYPE$x=tokenizer.TYPE;var NUMBER$6=TYPE$x.Number;var DELIM$4=TYPE$x.Delim;var SOLIDUS$5=0x002F;// U+002F SOLIDUS (/)\nvar FULLSTOP$2=0x002E;// U+002E FULL STOP (.)\n// Terms of <ratio> should be a positive numbers (not zero or negative)\n// (see https://drafts.csswg.org/mediaqueries-3/#values)\n// However, -o-min-device-pixel-ratio takes fractional values as a ratio's term\n// and this is using by various sites. Therefore we relax checking on parse\n// to test a term is unsigned number without an exponent part.\n// Additional checking may be applied on lexer validation.\nfunction consumeNumber$4(){this.scanner.skipWS();var value=this.consume(NUMBER$6);for(var i=0;i<value.length;i++){var code=value.charCodeAt(i);if(!isDigit$3(code)&&code!==FULLSTOP$2){this.error('Unsigned number is expected',this.scanner.tokenStart-value.length+i);}}if(Number(value)===0){this.error('Zero number is not allowed',this.scanner.tokenStart-value.length);}return value;}// <positive-integer> S* '/' S* <positive-integer>\nvar Ratio={name:'Ratio',structure:{left:String,right:String},parse:function parse(){var start=this.scanner.tokenStart;var left=consumeNumber$4.call(this);var right;this.scanner.skipWS();if(!this.scanner.isDelim(SOLIDUS$5)){this.error('Solidus is expected');}this.eat(DELIM$4);right=consumeNumber$4.call(this);return{type:'Ratio',loc:this.getLocation(start,this.scanner.tokenStart),left:left,right:right};},generate:function generate(node){this.chunk(node.left);this.chunk('/');this.chunk(node.right);}};var TYPE$y=tokenizer.TYPE;var rawMode$5=Raw.mode;var LEFTCURLYBRACKET$3=TYPE$y.LeftCurlyBracket;function consumeRaw$4(startToken){return this.Raw(startToken,rawMode$5.leftCurlyBracket,true);}function consumePrelude(){var prelude=this.SelectorList();if(prelude.type!=='Raw'&&this.scanner.eof===false&&this.scanner.tokenType!==LEFTCURLYBRACKET$3){this.error();}return prelude;}var Rule={name:'Rule',structure:{prelude:['SelectorList','Raw'],block:['Block']},parse:function parse(){var startToken=this.scanner.tokenIndex;var startOffset=this.scanner.tokenStart;var prelude;var block;if(this.parseRulePrelude){prelude=this.parseWithFallback(consumePrelude,consumeRaw$4);}else{prelude=consumeRaw$4.call(this,startToken);}block=this.Block(true);return{type:'Rule',loc:this.getLocation(startOffset,this.scanner.tokenStart),prelude:prelude,block:block};},generate:function generate(node){this.node(node.prelude);this.node(node.block);},walkContext:'rule'};var Selector={name:'Selector',structure:{children:[['TypeSelector','IdSelector','ClassSelector','AttributeSelector','PseudoClassSelector','PseudoElementSelector','Combinator','WhiteSpace']]},parse:function parse(){var children=this.readSequence(this.scope.Selector);// nothing were consumed\nif(this.getFirstListNode(children)===null){this.error('Selector is expected');}return{type:'Selector',loc:this.getLocationFromList(children),children:children};},generate:function generate(node){this.children(node);}};var TYPE$z=tokenizer.TYPE;var COMMA$3=TYPE$z.Comma;var SelectorList={name:'SelectorList',structure:{children:[['Selector','Raw']]},parse:function parse(){var children=this.createList();while(!this.scanner.eof){children.push(this.Selector());if(this.scanner.tokenType===COMMA$3){this.scanner.next();continue;}break;}return{type:'SelectorList',loc:this.getLocationFromList(children),children:children};},generate:function generate(node){this.children(node,function(){this.chunk(',');});},walkContext:'selector'};var STRING$3=tokenizer.TYPE.String;var _String={name:'String',structure:{value:String},parse:function parse(){return{type:'String',loc:this.getLocation(this.scanner.tokenStart,this.scanner.tokenEnd),value:this.consume(STRING$3)};},generate:function generate(node){this.chunk(node.value);}};var TYPE$A=tokenizer.TYPE;var WHITESPACE$a=TYPE$A.WhiteSpace;var COMMENT$9=TYPE$A.Comment;var ATKEYWORD$2=TYPE$A.AtKeyword;var CDO$1=TYPE$A.CDO;var CDC$1=TYPE$A.CDC;var EXCLAMATIONMARK$2=0x0021;// U+0021 EXCLAMATION MARK (!)\nfunction consumeRaw$5(startToken){return this.Raw(startToken,null,false);}var StyleSheet={name:'StyleSheet',structure:{children:[['Comment','CDO','CDC','Atrule','Rule','Raw']]},parse:function parse(){var start=this.scanner.tokenStart;var children=this.createList();var child;while(!this.scanner.eof){switch(this.scanner.tokenType){case WHITESPACE$a:this.scanner.next();continue;case COMMENT$9:// ignore comments except exclamation comments (i.e. /*! .. */) on top level\nif(this.scanner.source.charCodeAt(this.scanner.tokenStart+2)!==EXCLAMATIONMARK$2){this.scanner.next();continue;}child=this.Comment();break;case CDO$1:// <!--\nchild=this.CDO();break;case CDC$1:// -->\nchild=this.CDC();break;// CSS Syntax Module Level 3\n// §2.2 Error handling\n// At the \"top level\" of a stylesheet, an <at-keyword-token> starts an at-rule.\ncase ATKEYWORD$2:child=this.parseWithFallback(this.Atrule,consumeRaw$5);break;// Anything else starts a qualified rule ...\ndefault:child=this.parseWithFallback(this.Rule,consumeRaw$5);}children.push(child);}return{type:'StyleSheet',loc:this.getLocation(start,this.scanner.tokenStart),children:children};},generate:function generate(node){this.children(node);},walkContext:'stylesheet'};var TYPE$B=tokenizer.TYPE;var IDENT$f=TYPE$B.Ident;var ASTERISK$5=0x002A;// U+002A ASTERISK (*)\nvar VERTICALLINE$2=0x007C;// U+007C VERTICAL LINE (|)\nfunction eatIdentifierOrAsterisk(){if(this.scanner.tokenType!==IDENT$f&&this.scanner.isDelim(ASTERISK$5)===false){this.error('Identifier or asterisk is expected');}this.scanner.next();}// ident\n// ident|ident\n// ident|*\n// *\n// *|ident\n// *|*\n// |ident\n// |*\nvar TypeSelector={name:'TypeSelector',structure:{name:String},parse:function parse(){var start=this.scanner.tokenStart;if(this.scanner.isDelim(VERTICALLINE$2)){this.scanner.next();eatIdentifierOrAsterisk.call(this);}else{eatIdentifierOrAsterisk.call(this);if(this.scanner.isDelim(VERTICALLINE$2)){this.scanner.next();eatIdentifierOrAsterisk.call(this);}}return{type:'TypeSelector',loc:this.getLocation(start,this.scanner.tokenStart),name:this.scanner.substrToCursor(start)};},generate:function generate(node){this.chunk(node.name);}};var isHexDigit$3=tokenizer.isHexDigit;var cmpChar$3=tokenizer.cmpChar;var TYPE$C=tokenizer.TYPE;var NAME$3=tokenizer.NAME;var IDENT$g=TYPE$C.Ident;var NUMBER$7=TYPE$C.Number;var DIMENSION$5=TYPE$C.Dimension;var PLUSSIGN$5=0x002B;// U+002B PLUS SIGN (+)\nvar HYPHENMINUS$3=0x002D;// U+002D HYPHEN-MINUS (-)\nvar QUESTIONMARK=0x003F;// U+003F QUESTION MARK (?)\nvar U$1=0x0075;// U+0075 LATIN SMALL LETTER U (u)\nfunction eatHexSequence(offset,allowDash){for(var pos=this.scanner.tokenStart+offset,len=0;pos<this.scanner.tokenEnd;pos++){var code=this.scanner.source.charCodeAt(pos);if(code===HYPHENMINUS$3&&allowDash&&len!==0){if(eatHexSequence.call(this,offset+len+1,false)===0){this.error();}return-1;}if(!isHexDigit$3(code)){this.error(allowDash&&len!==0?'HyphenMinus'+(len<6?' or hex digit':'')+' is expected':len<6?'Hex digit is expected':'Unexpected input',pos);}if(++len>6){this.error('Too many hex digits',pos);}}this.scanner.next();return len;}function eatQuestionMarkSequence(max){var count=0;while(this.scanner.isDelim(QUESTIONMARK)){if(++count>max){this.error('Too many question marks');}this.scanner.next();}}function startsWith(code){if(this.scanner.source.charCodeAt(this.scanner.tokenStart)!==code){this.error(NAME$3[code]+' is expected');}}// https://drafts.csswg.org/css-syntax/#urange\n// Informally, the <urange> production has three forms:\n// U+0001\n//      Defines a range consisting of a single code point, in this case the code point \"1\".\n// U+0001-00ff\n//      Defines a range of codepoints between the first and the second value, in this case\n//      the range between \"1\" and \"ff\" (255 in decimal) inclusive.\n// U+00??\n//      Defines a range of codepoints where the \"?\" characters range over all hex digits,\n//      in this case defining the same as the value U+0000-00ff.\n// In each form, a maximum of 6 digits is allowed for each hexadecimal number (if you treat \"?\" as a hexadecimal digit).\n//\n// <urange> =\n//   u '+' <ident-token> '?'* |\n//   u <dimension-token> '?'* |\n//   u <number-token> '?'* |\n//   u <number-token> <dimension-token> |\n//   u <number-token> <number-token> |\n//   u '+' '?'+\nfunction scanUnicodeRange(){var hexLength=0;// u '+' <ident-token> '?'*\n// u '+' '?'+\nif(this.scanner.isDelim(PLUSSIGN$5)){this.scanner.next();if(this.scanner.tokenType===IDENT$g){hexLength=eatHexSequence.call(this,0,true);if(hexLength>0){eatQuestionMarkSequence.call(this,6-hexLength);}return;}if(this.scanner.isDelim(QUESTIONMARK)){this.scanner.next();eatQuestionMarkSequence.call(this,5);return;}this.error('Hex digit or question mark is expected');return;}// u <number-token> '?'*\n// u <number-token> <dimension-token>\n// u <number-token> <number-token>\nif(this.scanner.tokenType===NUMBER$7){startsWith.call(this,PLUSSIGN$5);hexLength=eatHexSequence.call(this,1,true);if(this.scanner.isDelim(QUESTIONMARK)){eatQuestionMarkSequence.call(this,6-hexLength);return;}if(this.scanner.tokenType===DIMENSION$5||this.scanner.tokenType===NUMBER$7){startsWith.call(this,HYPHENMINUS$3);eatHexSequence.call(this,1,false);return;}return;}// u <dimension-token> '?'*\nif(this.scanner.tokenType===DIMENSION$5){startsWith.call(this,PLUSSIGN$5);hexLength=eatHexSequence.call(this,1,true);if(hexLength>0){eatQuestionMarkSequence.call(this,6-hexLength);}return;}this.error();}var UnicodeRange={name:'UnicodeRange',structure:{value:String},parse:function parse(){var start=this.scanner.tokenStart;// U or u\nif(!cmpChar$3(this.scanner.source,start,U$1)){this.error('U is expected');}if(!cmpChar$3(this.scanner.source,start+1,PLUSSIGN$5)){this.error('Plus sign is expected');}this.scanner.next();scanUnicodeRange.call(this);return{type:'UnicodeRange',loc:this.getLocation(start,this.scanner.tokenStart),value:this.scanner.substrToCursor(start)};},generate:function generate(node){this.chunk(node.value);}};var isWhiteSpace$2=tokenizer.isWhiteSpace;var cmpStr$5=tokenizer.cmpStr;var TYPE$D=tokenizer.TYPE;var FUNCTION$6=TYPE$D.Function;var URL$4=TYPE$D.Url;var RIGHTPARENTHESIS$5=TYPE$D.RightParenthesis;// <url-token> | <function-token> <string> )\nvar Url={name:'Url',structure:{value:['String','Raw']},parse:function parse(){var start=this.scanner.tokenStart;var value;switch(this.scanner.tokenType){case URL$4:var rawStart=start+4;var rawEnd=this.scanner.tokenEnd-1;while(rawStart<rawEnd&&isWhiteSpace$2(this.scanner.source.charCodeAt(rawStart))){rawStart++;}while(rawStart<rawEnd&&isWhiteSpace$2(this.scanner.source.charCodeAt(rawEnd-1))){rawEnd--;}value={type:'Raw',loc:this.getLocation(rawStart,rawEnd),value:this.scanner.source.substring(rawStart,rawEnd)};this.eat(URL$4);break;case FUNCTION$6:if(!cmpStr$5(this.scanner.source,this.scanner.tokenStart,this.scanner.tokenEnd,'url(')){this.error('Function name must be `url`');}this.eat(FUNCTION$6);this.scanner.skipSC();value=this.String();this.scanner.skipSC();this.eat(RIGHTPARENTHESIS$5);break;default:this.error('Url or Function is expected');}return{type:'Url',loc:this.getLocation(start,this.scanner.tokenStart),value:value};},generate:function generate(node){this.chunk('url');this.chunk('(');this.node(node.value);this.chunk(')');}};var Value={name:'Value',structure:{children:[[]]},parse:function parse(){var start=this.scanner.tokenStart;var children=this.readSequence(this.scope.Value);return{type:'Value',loc:this.getLocation(start,this.scanner.tokenStart),children:children};},generate:function generate(node){this.children(node);}};var WHITESPACE$b=tokenizer.TYPE.WhiteSpace;var SPACE=Object.freeze({type:'WhiteSpace',loc:null,value:' '});var WhiteSpace$1={name:'WhiteSpace',structure:{value:String},parse:function parse(){this.eat(WHITESPACE$b);return SPACE;// return {\n//     type: 'WhiteSpace',\n//     loc: this.getLocation(this.scanner.tokenStart, this.scanner.tokenEnd),\n//     value: this.consume(WHITESPACE)\n// };\n},generate:function generate(node){this.chunk(node.value);}};var node={AnPlusB:AnPlusB,Atrule:Atrule,AtrulePrelude:AtrulePrelude,AttributeSelector:AttributeSelector,Block:Block,Brackets:Brackets,CDC:CDC_1,CDO:CDO_1,ClassSelector:ClassSelector,Combinator:Combinator,Comment:Comment,Declaration:Declaration,DeclarationList:DeclarationList,Dimension:Dimension,Function:_Function,Hash:Hash,Identifier:Identifier,IdSelector:IdSelector,MediaFeature:MediaFeature,MediaQuery:MediaQuery,MediaQueryList:MediaQueryList,Nth:Nth,Number:_Number,Operator:Operator,Parentheses:Parentheses,Percentage:Percentage,PseudoClassSelector:PseudoClassSelector,PseudoElementSelector:PseudoElementSelector,Ratio:Ratio,Raw:Raw,Rule:Rule,Selector:Selector,SelectorList:SelectorList,String:_String,StyleSheet:StyleSheet,TypeSelector:TypeSelector,UnicodeRange:UnicodeRange,Url:Url,Value:Value,WhiteSpace:WhiteSpace$1};var parser={parseContext:{default:'StyleSheet',stylesheet:'StyleSheet',atrule:'Atrule',atrulePrelude:function atrulePrelude(options){return this.AtrulePrelude(options.atrule?String(options.atrule):null);},mediaQueryList:'MediaQueryList',mediaQuery:'MediaQuery',rule:'Rule',selectorList:'SelectorList',selector:'Selector',block:function block(){return this.Block(true);},declarationList:'DeclarationList',declaration:'Declaration',value:'Value'},scope:scope,atrule:atrule,pseudo:pseudo,node:node};var parser$1=create(parser);function read_style(parser,start,attributes){var content_start=parser.index;var styles=parser.read_until(/<\\/style\\s*>/,parser_errors.unclosed_style);if(parser.index>=parser.template.length){parser.error(parser_errors.unclosed_style);}var content_end=parser.index;var ast;try{ast=parser$1(styles,{positions:true,offset:content_start,onParseError:function onParseError(error){throw error;}});}catch(err){if(err.name==='SyntaxError'){parser.error(parser_errors.css_syntax_error(err.message),err.offset);}else{throw err;}}ast=JSON.parse(JSON.stringify(ast));// tidy up AST\nwalk(ast,{enter:function enter(node){// replace `ref:a` nodes\nif(node.type==='Selector'){for(var _i29=0;_i29<node.children.length;_i29+=1){var a=node.children[_i29];var _b2=node.children[_i29+1];if(is_ref_selector(a,_b2)){parser.error(parser_errors.invalid_ref_selector,a.loc.start.offset);}}}if(node.type==='Declaration'&&node.value.type==='Value'&&node.value.children.length===0){parser.error(parser_errors.invalid_declaration,node.start);}if(node.type==='PseudoClassSelector'&&node.name==='global'&&node.children===null){parser.error(parser_errors.empty_global_selector,node.loc.start.offset);}if(node.loc){node.start=node.loc.start.offset;node.end=node.loc.end.offset;delete node.loc;}}});parser.read(/<\\/style\\s*>/);var end=parser.index;return{type:'Style',start:start,end:end,attributes:attributes,children:ast.children,content:{start:content_start,end:content_end,styles:styles}};}function is_ref_selector(a,b){if(!b)return false;return a.type==='TypeSelector'&&a.name==='ref'&&b.type==='PseudoClassSelector';}// https://dev.w3.org/html5/html-author/charref\nvar entities={CounterClockwiseContourIntegral:8755,ClockwiseContourIntegral:8754,DoubleLongLeftRightArrow:10234,DiacriticalDoubleAcute:733,NotSquareSupersetEqual:8931,CloseCurlyDoubleQuote:8221,DoubleContourIntegral:8751,FilledVerySmallSquare:9642,NegativeVeryThinSpace:8203,NotPrecedesSlantEqual:8928,NotRightTriangleEqual:8941,NotSucceedsSlantEqual:8929,CapitalDifferentialD:8517,DoubleLeftRightArrow:8660,DoubleLongRightArrow:10233,EmptyVerySmallSquare:9643,NestedGreaterGreater:8811,NotDoubleVerticalBar:8742,NotLeftTriangleEqual:8940,NotSquareSubsetEqual:8930,OpenCurlyDoubleQuote:8220,ReverseUpEquilibrium:10607,DoubleLongLeftArrow:10232,DownLeftRightVector:10576,LeftArrowRightArrow:8646,NegativeMediumSpace:8203,RightArrowLeftArrow:8644,SquareSupersetEqual:8850,leftrightsquigarrow:8621,DownRightTeeVector:10591,DownRightVectorBar:10583,LongLeftRightArrow:10231,Longleftrightarrow:10234,NegativeThickSpace:8203,PrecedesSlantEqual:8828,ReverseEquilibrium:8651,RightDoubleBracket:10215,RightDownTeeVector:10589,RightDownVectorBar:10581,RightTriangleEqual:8885,SquareIntersection:8851,SucceedsSlantEqual:8829,blacktriangleright:9656,longleftrightarrow:10231,DoubleUpDownArrow:8661,DoubleVerticalBar:8741,DownLeftTeeVector:10590,DownLeftVectorBar:10582,FilledSmallSquare:9724,GreaterSlantEqual:10878,LeftDoubleBracket:10214,LeftDownTeeVector:10593,LeftDownVectorBar:10585,LeftTriangleEqual:8884,NegativeThinSpace:8203,NotReverseElement:8716,NotTildeFullEqual:8775,RightAngleBracket:10217,RightUpDownVector:10575,SquareSubsetEqual:8849,VerticalSeparator:10072,blacktriangledown:9662,blacktriangleleft:9666,leftrightharpoons:8651,rightleftharpoons:8652,twoheadrightarrow:8608,DiacriticalAcute:180,DiacriticalGrave:96,DiacriticalTilde:732,DoubleRightArrow:8658,DownArrowUpArrow:8693,EmptySmallSquare:9723,GreaterEqualLess:8923,GreaterFullEqual:8807,LeftAngleBracket:10216,LeftUpDownVector:10577,LessEqualGreater:8922,NonBreakingSpace:160,NotRightTriangle:8939,NotSupersetEqual:8841,RightTriangleBar:10704,RightUpTeeVector:10588,RightUpVectorBar:10580,UnderParenthesis:9181,UpArrowDownArrow:8645,circlearrowright:8635,downharpoonright:8642,ntrianglerighteq:8941,rightharpoondown:8641,rightrightarrows:8649,twoheadleftarrow:8606,vartriangleright:8883,CloseCurlyQuote:8217,ContourIntegral:8750,DoubleDownArrow:8659,DoubleLeftArrow:8656,DownRightVector:8641,LeftRightVector:10574,LeftTriangleBar:10703,LeftUpTeeVector:10592,LeftUpVectorBar:10584,LowerRightArrow:8600,NotGreaterEqual:8817,NotGreaterTilde:8821,NotLeftTriangle:8938,OverParenthesis:9180,RightDownVector:8642,ShortRightArrow:8594,UpperRightArrow:8599,bigtriangledown:9661,circlearrowleft:8634,curvearrowright:8631,downharpoonleft:8643,leftharpoondown:8637,leftrightarrows:8646,nLeftrightarrow:8654,nleftrightarrow:8622,ntrianglelefteq:8940,rightleftarrows:8644,rightsquigarrow:8605,rightthreetimes:8908,straightepsilon:1013,trianglerighteq:8885,vartriangleleft:8882,DiacriticalDot:729,DoubleRightTee:8872,DownLeftVector:8637,GreaterGreater:10914,HorizontalLine:9472,InvisibleComma:8291,InvisibleTimes:8290,LeftDownVector:8643,LeftRightArrow:8596,Leftrightarrow:8660,LessSlantEqual:10877,LongRightArrow:10230,Longrightarrow:10233,LowerLeftArrow:8601,NestedLessLess:8810,NotGreaterLess:8825,NotLessGreater:8824,NotSubsetEqual:8840,NotVerticalBar:8740,OpenCurlyQuote:8216,ReverseElement:8715,RightTeeVector:10587,RightVectorBar:10579,ShortDownArrow:8595,ShortLeftArrow:8592,SquareSuperset:8848,TildeFullEqual:8773,UpperLeftArrow:8598,ZeroWidthSpace:8203,curvearrowleft:8630,doublebarwedge:8966,downdownarrows:8650,hookrightarrow:8618,leftleftarrows:8647,leftrightarrow:8596,leftthreetimes:8907,longrightarrow:10230,looparrowright:8620,nshortparallel:8742,ntriangleright:8939,rightarrowtail:8611,rightharpoonup:8640,trianglelefteq:8884,upharpoonright:8638,ApplyFunction:8289,DifferentialD:8518,DoubleLeftTee:10980,DoubleUpArrow:8657,LeftTeeVector:10586,LeftVectorBar:10578,LessFullEqual:8806,LongLeftArrow:10229,Longleftarrow:10232,NotTildeEqual:8772,NotTildeTilde:8777,Poincareplane:8460,PrecedesEqual:10927,PrecedesTilde:8830,RightArrowBar:8677,RightTeeArrow:8614,RightTriangle:8883,RightUpVector:8638,SucceedsEqual:10928,SucceedsTilde:8831,SupersetEqual:8839,UpEquilibrium:10606,VerticalTilde:8768,VeryThinSpace:8202,bigtriangleup:9651,blacktriangle:9652,divideontimes:8903,fallingdotseq:8786,hookleftarrow:8617,leftarrowtail:8610,leftharpoonup:8636,longleftarrow:10229,looparrowleft:8619,measuredangle:8737,ntriangleleft:8938,shortparallel:8741,smallsetminus:8726,triangleright:9657,upharpoonleft:8639,DownArrowBar:10515,DownTeeArrow:8615,ExponentialE:8519,GreaterEqual:8805,GreaterTilde:8819,HilbertSpace:8459,HumpDownHump:8782,Intersection:8898,LeftArrowBar:8676,LeftTeeArrow:8612,LeftTriangle:8882,LeftUpVector:8639,NotCongruent:8802,NotLessEqual:8816,NotLessTilde:8820,Proportional:8733,RightCeiling:8969,RoundImplies:10608,ShortUpArrow:8593,SquareSubset:8847,UnderBracket:9141,VerticalLine:124,blacklozenge:10731,exponentiale:8519,risingdotseq:8787,triangledown:9663,triangleleft:9667,CircleMinus:8854,CircleTimes:8855,Equilibrium:8652,GreaterLess:8823,LeftCeiling:8968,LessGreater:8822,MediumSpace:8287,NotPrecedes:8832,NotSucceeds:8833,OverBracket:9140,RightVector:8640,Rrightarrow:8667,RuleDelayed:10740,SmallCircle:8728,SquareUnion:8852,SubsetEqual:8838,UpDownArrow:8597,Updownarrow:8661,VerticalBar:8739,backepsilon:1014,blacksquare:9642,circledcirc:8858,circleddash:8861,curlyeqprec:8926,curlyeqsucc:8927,diamondsuit:9830,eqslantless:10901,expectation:8496,nRightarrow:8655,nrightarrow:8603,preccurlyeq:8828,precnapprox:10937,quaternions:8461,straightphi:981,succcurlyeq:8829,succnapprox:10938,thickapprox:8776,updownarrow:8597,Bernoullis:8492,CirclePlus:8853,EqualTilde:8770,Fouriertrf:8497,ImaginaryI:8520,Laplacetrf:8466,LeftVector:8636,Lleftarrow:8666,NotElement:8713,NotGreater:8815,Proportion:8759,RightArrow:8594,RightFloor:8971,Rightarrow:8658,TildeEqual:8771,TildeTilde:8776,UnderBrace:9183,UpArrowBar:10514,UpTeeArrow:8613,circledast:8859,complement:8705,curlywedge:8911,eqslantgtr:10902,gtreqqless:10892,lessapprox:10885,lesseqqgtr:10891,lmoustache:9136,longmapsto:10236,mapstodown:8615,mapstoleft:8612,nLeftarrow:8653,nleftarrow:8602,precapprox:10935,rightarrow:8594,rmoustache:9137,sqsubseteq:8849,sqsupseteq:8850,subsetneqq:10955,succapprox:10936,supsetneqq:10956,upuparrows:8648,varepsilon:949,varnothing:8709,Backslash:8726,CenterDot:183,CircleDot:8857,Congruent:8801,Coproduct:8720,DoubleDot:168,DownArrow:8595,DownBreve:785,Downarrow:8659,HumpEqual:8783,LeftArrow:8592,LeftFloor:8970,Leftarrow:8656,LessTilde:8818,Mellintrf:8499,MinusPlus:8723,NotCupCap:8813,NotExists:8708,OverBrace:9182,PlusMinus:177,Therefore:8756,ThinSpace:8201,TripleDot:8411,UnionPlus:8846,backprime:8245,backsimeq:8909,bigotimes:10754,centerdot:183,checkmark:10003,complexes:8450,dotsquare:8865,downarrow:8595,gtrapprox:10886,gtreqless:8923,heartsuit:9829,leftarrow:8592,lesseqgtr:8922,nparallel:8742,nshortmid:8740,nsubseteq:8840,nsupseteq:8841,pitchfork:8916,rationals:8474,spadesuit:9824,subseteqq:10949,subsetneq:8842,supseteqq:10950,supsetneq:8843,therefore:8756,triangleq:8796,varpropto:8733,DDotrahd:10513,DotEqual:8784,Integral:8747,LessLess:10913,NotEqual:8800,NotTilde:8769,PartialD:8706,Precedes:8826,RightTee:8866,Succeeds:8827,SuchThat:8715,Superset:8835,Uarrocir:10569,UnderBar:818,andslope:10840,angmsdaa:10664,angmsdab:10665,angmsdac:10666,angmsdad:10667,angmsdae:10668,angmsdaf:10669,angmsdag:10670,angmsdah:10671,angrtvbd:10653,approxeq:8778,awconint:8755,backcong:8780,barwedge:8965,bbrktbrk:9142,bigoplus:10753,bigsqcup:10758,biguplus:10756,bigwedge:8896,boxminus:8863,boxtimes:8864,capbrcup:10825,circledR:174,circledS:9416,cirfnint:10768,clubsuit:9827,cupbrcap:10824,curlyvee:8910,cwconint:8754,doteqdot:8785,dotminus:8760,drbkarow:10512,dzigrarr:10239,elinters:9191,emptyset:8709,eqvparsl:10725,fpartint:10765,geqslant:10878,gesdotol:10884,gnapprox:10890,hksearow:10533,hkswarow:10534,imagline:8464,imagpart:8465,infintie:10717,integers:8484,intercal:8890,intlarhk:10775,laemptyv:10676,ldrushar:10571,leqslant:10877,lesdotor:10883,llcorner:8990,lnapprox:10889,lrcorner:8991,lurdshar:10570,mapstoup:8613,multimap:8888,naturals:8469,otimesas:10806,parallel:8741,plusacir:10787,pointint:10773,precneqq:10933,precnsim:8936,profalar:9006,profline:8978,profsurf:8979,raemptyv:10675,realpart:8476,rppolint:10770,rtriltri:10702,scpolint:10771,setminus:8726,shortmid:8739,smeparsl:10724,sqsubset:8847,sqsupset:8848,subseteq:8838,succneqq:10934,succnsim:8937,supseteq:8839,thetasym:977,thicksim:8764,timesbar:10801,triangle:9653,triminus:10810,trpezium:9186,ulcorner:8988,urcorner:8989,varkappa:1008,varsigma:962,vartheta:977,Because:8757,Cayleys:8493,Cconint:8752,Cedilla:184,Diamond:8900,DownTee:8868,Element:8712,Epsilon:917,Implies:8658,LeftTee:8867,NewLine:10,NoBreak:8288,NotLess:8814,Omicron:927,OverBar:175,Product:8719,UpArrow:8593,Uparrow:8657,Upsilon:933,alefsym:8501,angrtvb:8894,angzarr:9084,asympeq:8781,backsim:8765,because:8757,bemptyv:10672,between:8812,bigcirc:9711,bigodot:10752,bigstar:9733,boxplus:8862,ccupssm:10832,cemptyv:10674,cirscir:10690,coloneq:8788,congdot:10861,cudarrl:10552,cudarrr:10549,cularrp:10557,curarrm:10556,dbkarow:10511,ddagger:8225,ddotseq:10871,demptyv:10673,diamond:8900,digamma:989,dotplus:8724,dwangle:10662,epsilon:949,eqcolon:8789,equivDD:10872,gesdoto:10882,gtquest:10876,gtrless:8823,harrcir:10568,intprod:10812,isindot:8949,larrbfs:10527,larrsim:10611,lbrksld:10639,lbrkslu:10637,ldrdhar:10599,lesdoto:10881,lessdot:8918,lessgtr:8822,lesssim:8818,lotimes:10804,lozenge:9674,ltquest:10875,luruhar:10598,maltese:10016,minusdu:10794,napprox:8777,natural:9838,nearrow:8599,nexists:8708,notinva:8713,notinvb:8951,notinvc:8950,notniva:8716,notnivb:8958,notnivc:8957,npolint:10772,nsqsube:8930,nsqsupe:8931,nvinfin:10718,nwarrow:8598,olcross:10683,omicron:959,orderof:8500,orslope:10839,pertenk:8241,planckh:8462,pluscir:10786,plussim:10790,plustwo:10791,precsim:8830,quatint:10774,questeq:8799,rarrbfs:10528,rarrsim:10612,rbrksld:10638,rbrkslu:10640,rdldhar:10601,realine:8475,rotimes:10805,ruluhar:10600,searrow:8600,simplus:10788,simrarr:10610,subedot:10947,submult:10945,subplus:10943,subrarr:10617,succsim:8831,supdsub:10968,supedot:10948,suphsub:10967,suplarr:10619,supmult:10946,supplus:10944,swarrow:8601,topfork:10970,triplus:10809,tritime:10811,uparrow:8593,upsilon:965,uwangle:10663,vzigzag:10650,zigrarr:8669,Aacute:193,Abreve:258,Agrave:192,Assign:8788,Atilde:195,Barwed:8966,Bumpeq:8782,Cacute:262,Ccaron:268,Ccedil:199,Colone:10868,Conint:8751,CupCap:8781,Dagger:8225,Dcaron:270,DotDot:8412,Dstrok:272,Eacute:201,Ecaron:282,Egrave:200,Exists:8707,ForAll:8704,Gammad:988,Gbreve:286,Gcedil:290,HARDcy:1066,Hstrok:294,Iacute:205,Igrave:204,Itilde:296,Jsercy:1032,Kcedil:310,Lacute:313,Lambda:923,Lcaron:317,Lcedil:315,Lmidot:319,Lstrok:321,Nacute:323,Ncaron:327,Ncedil:325,Ntilde:209,Oacute:211,Odblac:336,Ograve:210,Oslash:216,Otilde:213,Otimes:10807,Racute:340,Rarrtl:10518,Rcaron:344,Rcedil:342,SHCHcy:1065,SOFTcy:1068,Sacute:346,Scaron:352,Scedil:350,Square:9633,Subset:8912,Supset:8913,Tcaron:356,Tcedil:354,Tstrok:358,Uacute:218,Ubreve:364,Udblac:368,Ugrave:217,Utilde:360,Vdashl:10982,Verbar:8214,Vvdash:8874,Yacute:221,Zacute:377,Zcaron:381,aacute:225,abreve:259,agrave:224,andand:10837,angmsd:8737,angsph:8738,apacir:10863,approx:8776,atilde:227,barvee:8893,barwed:8965,becaus:8757,bernou:8492,bigcap:8898,bigcup:8899,bigvee:8897,bkarow:10509,bottom:8869,bowtie:8904,boxbox:10697,bprime:8245,brvbar:166,bullet:8226,bumpeq:8783,cacute:263,capand:10820,capcap:10827,capcup:10823,capdot:10816,ccaron:269,ccedil:231,circeq:8791,cirmid:10991,colone:8788,commat:64,compfn:8728,conint:8750,coprod:8720,copysr:8471,cularr:8630,cupcap:10822,cupcup:10826,cupdot:8845,curarr:8631,curren:164,cylcty:9005,dagger:8224,daleth:8504,dcaron:271,dfisht:10623,divide:247,divonx:8903,dlcorn:8990,dlcrop:8973,dollar:36,drcorn:8991,drcrop:8972,dstrok:273,eacute:233,easter:10862,ecaron:283,ecolon:8789,egrave:232,egsdot:10904,elsdot:10903,emptyv:8709,emsp13:8196,emsp14:8197,eparsl:10723,eqcirc:8790,equals:61,equest:8799,female:9792,ffilig:64259,ffllig:64260,forall:8704,frac12:189,frac13:8531,frac14:188,frac15:8533,frac16:8537,frac18:8539,frac23:8532,frac25:8534,frac34:190,frac35:8535,frac38:8540,frac45:8536,frac56:8538,frac58:8541,frac78:8542,gacute:501,gammad:989,gbreve:287,gesdot:10880,gesles:10900,gtlPar:10645,gtrarr:10616,gtrdot:8919,gtrsim:8819,hairsp:8202,hamilt:8459,hardcy:1098,hearts:9829,hellip:8230,hercon:8889,homtht:8763,horbar:8213,hslash:8463,hstrok:295,hybull:8259,hyphen:8208,iacute:237,igrave:236,iiiint:10764,iinfin:10716,incare:8453,inodot:305,intcal:8890,iquest:191,isinsv:8947,itilde:297,jsercy:1112,kappav:1008,kcedil:311,kgreen:312,lAtail:10523,lacute:314,lagran:8466,lambda:955,langle:10216,larrfs:10525,larrhk:8617,larrlp:8619,larrpl:10553,larrtl:8610,latail:10521,lbrace:123,lbrack:91,lcaron:318,lcedil:316,ldquor:8222,lesdot:10879,lesges:10899,lfisht:10620,lfloor:8970,lharul:10602,llhard:10603,lmidot:320,lmoust:9136,loplus:10797,lowast:8727,lowbar:95,lparlt:10643,lrhard:10605,lsaquo:8249,lsquor:8218,lstrok:322,lthree:8907,ltimes:8905,ltlarr:10614,ltrPar:10646,mapsto:8614,marker:9646,mcomma:10793,midast:42,midcir:10992,middot:183,minusb:8863,minusd:8760,mnplus:8723,models:8871,mstpos:8766,nVDash:8879,nVdash:8878,nacute:324,ncaron:328,ncedil:326,nearhk:10532,nequiv:8802,nesear:10536,nexist:8708,nltrie:8940,nprcue:8928,nrtrie:8941,nsccue:8929,nsimeq:8772,ntilde:241,numero:8470,nvDash:8877,nvHarr:10500,nvdash:8876,nvlArr:10498,nvrArr:10499,nwarhk:10531,nwnear:10535,oacute:243,odblac:337,odsold:10684,ograve:242,ominus:8854,origof:8886,oslash:248,otilde:245,otimes:8855,parsim:10995,percnt:37,period:46,permil:8240,phmmat:8499,planck:8463,plankv:8463,plusdo:8724,plusdu:10789,plusmn:177,preceq:10927,primes:8473,prnsim:8936,propto:8733,prurel:8880,puncsp:8200,qprime:8279,rAtail:10524,racute:341,rangle:10217,rarrap:10613,rarrfs:10526,rarrhk:8618,rarrlp:8620,rarrpl:10565,rarrtl:8611,ratail:10522,rbrace:125,rbrack:93,rcaron:345,rcedil:343,rdquor:8221,rfisht:10621,rfloor:8971,rharul:10604,rmoust:9137,roplus:10798,rpargt:10644,rsaquo:8250,rsquor:8217,rthree:8908,rtimes:8906,sacute:347,scaron:353,scedil:351,scnsim:8937,searhk:10533,seswar:10537,sfrown:8994,shchcy:1097,sigmaf:962,sigmav:962,simdot:10858,smashp:10803,softcy:1100,solbar:9023,spades:9824,sqsube:8849,sqsupe:8850,square:9633,squarf:9642,ssetmn:8726,ssmile:8995,sstarf:8902,subdot:10941,subset:8834,subsim:10951,subsub:10965,subsup:10963,succeq:10928,supdot:10942,supset:8835,supsim:10952,supsub:10964,supsup:10966,swarhk:10534,swnwar:10538,target:8982,tcaron:357,tcedil:355,telrec:8981,there4:8756,thetav:977,thinsp:8201,thksim:8764,timesb:8864,timesd:10800,topbot:9014,topcir:10993,tprime:8244,tridot:9708,tstrok:359,uacute:250,ubreve:365,udblac:369,ufisht:10622,ugrave:249,ulcorn:8988,ulcrop:8975,urcorn:8989,urcrop:8974,utilde:361,vangrt:10652,varphi:966,varrho:1009,veebar:8891,vellip:8942,verbar:124,wedbar:10847,wedgeq:8793,weierp:8472,wreath:8768,xoplus:10753,xotime:10754,xsqcup:10758,xuplus:10756,xwedge:8896,yacute:253,zacute:378,zcaron:382,zeetrf:8488,AElig:198,Acirc:194,Alpha:913,Amacr:256,Aogon:260,Aring:197,Breve:728,Ccirc:264,Colon:8759,Cross:10799,Dashv:10980,Delta:916,Ecirc:202,Emacr:274,Eogon:280,Equal:10869,Gamma:915,Gcirc:284,Hacek:711,Hcirc:292,IJlig:306,Icirc:206,Imacr:298,Iogon:302,Iukcy:1030,Jcirc:308,Jukcy:1028,Kappa:922,OElig:338,Ocirc:212,Omacr:332,Omega:937,Prime:8243,RBarr:10512,Scirc:348,Sigma:931,THORN:222,TRADE:8482,TSHcy:1035,Theta:920,Tilde:8764,Ubrcy:1038,Ucirc:219,Umacr:362,Union:8899,Uogon:370,UpTee:8869,Uring:366,VDash:8875,Vdash:8873,Wcirc:372,Wedge:8896,Ycirc:374,acirc:226,acute:180,aelig:230,aleph:8501,alpha:945,amacr:257,amalg:10815,angle:8736,angrt:8735,angst:8491,aogon:261,aring:229,asymp:8776,awint:10769,bcong:8780,bdquo:8222,bepsi:1014,blank:9251,blk12:9618,blk14:9617,blk34:9619,block:9608,boxDL:9559,boxDR:9556,boxDl:9558,boxDr:9555,boxHD:9574,boxHU:9577,boxHd:9572,boxHu:9575,boxUL:9565,boxUR:9562,boxUl:9564,boxUr:9561,boxVH:9580,boxVL:9571,boxVR:9568,boxVh:9579,boxVl:9570,boxVr:9567,boxdL:9557,boxdR:9554,boxdl:9488,boxdr:9484,boxhD:9573,boxhU:9576,boxhd:9516,boxhu:9524,boxuL:9563,boxuR:9560,boxul:9496,boxur:9492,boxvH:9578,boxvL:9569,boxvR:9566,boxvh:9532,boxvl:9508,boxvr:9500,breve:728,bsemi:8271,bsime:8909,bsolb:10693,bumpE:10926,bumpe:8783,caret:8257,caron:711,ccaps:10829,ccirc:265,ccups:10828,cedil:184,check:10003,clubs:9827,colon:58,comma:44,crarr:8629,cross:10007,csube:10961,csupe:10962,ctdot:8943,cuepr:8926,cuesc:8927,cupor:10821,cuvee:8910,cuwed:8911,cwint:8753,dashv:8867,dblac:733,ddarr:8650,delta:948,dharl:8643,dharr:8642,diams:9830,disin:8946,doteq:8784,dtdot:8945,dtrif:9662,duarr:8693,duhar:10607,eDDot:10871,ecirc:234,efDot:8786,emacr:275,empty:8709,eogon:281,eplus:10865,epsiv:949,eqsim:8770,equiv:8801,erDot:8787,erarr:10609,esdot:8784,exist:8707,fflig:64256,filig:64257,fllig:64258,fltns:9649,forkv:10969,frasl:8260,frown:8994,gamma:947,gcirc:285,gescc:10921,gimel:8503,gneqq:8809,gnsim:8935,grave:96,gsime:10894,gsiml:10896,gtcir:10874,gtdot:8919,harrw:8621,hcirc:293,hoarr:8703,icirc:238,iexcl:161,iiint:8749,iiota:8489,ijlig:307,imacr:299,image:8465,imath:305,imped:437,infin:8734,iogon:303,iprod:10812,isinE:8953,isins:8948,isinv:8712,iukcy:1110,jcirc:309,jmath:567,jukcy:1108,kappa:954,lAarr:8666,lBarr:10510,langd:10641,laquo:171,larrb:8676,lbarr:10508,lbbrk:10098,lbrke:10635,lceil:8968,ldquo:8220,lescc:10920,lhard:8637,lharu:8636,lhblk:9604,llarr:8647,lltri:9722,lneqq:8808,lnsim:8934,loang:10220,loarr:8701,lobrk:10214,lopar:10629,lrarr:8646,lrhar:8651,lrtri:8895,lsime:10893,lsimg:10895,lsquo:8216,ltcir:10873,ltdot:8918,ltrie:8884,ltrif:9666,mDDot:8762,mdash:8212,micro:181,minus:8722,mumap:8888,nabla:8711,napos:329,natur:9838,ncong:8775,ndash:8211,neArr:8663,nearr:8599,ngsim:8821,nhArr:8654,nharr:8622,nhpar:10994,nlArr:8653,nlarr:8602,nless:8814,nlsim:8820,nltri:8938,notin:8713,notni:8716,nprec:8832,nrArr:8655,nrarr:8603,nrtri:8939,nsime:8772,nsmid:8740,nspar:8742,nsube:8840,nsucc:8833,nsupe:8841,numsp:8199,nwArr:8662,nwarr:8598,ocirc:244,odash:8861,oelig:339,ofcir:10687,ohbar:10677,olarr:8634,olcir:10686,oline:8254,omacr:333,omega:969,operp:10681,oplus:8853,orarr:8635,order:8500,ovbar:9021,parsl:11005,phone:9742,plusb:8862,pluse:10866,pound:163,prcue:8828,prime:8242,prnap:10937,prsim:8830,quest:63,rAarr:8667,rBarr:10511,radic:8730,rangd:10642,range:10661,raquo:187,rarrb:8677,rarrc:10547,rarrw:8605,ratio:8758,rbarr:10509,rbbrk:10099,rbrke:10636,rceil:8969,rdquo:8221,reals:8477,rhard:8641,rharu:8640,rlarr:8644,rlhar:8652,rnmid:10990,roang:10221,roarr:8702,robrk:10215,ropar:10630,rrarr:8649,rsquo:8217,rtrie:8885,rtrif:9656,sbquo:8218,sccue:8829,scirc:349,scnap:10938,scsim:8831,sdotb:8865,sdote:10854,seArr:8664,searr:8600,setmn:8726,sharp:9839,sigma:963,simeq:8771,simgE:10912,simlE:10911,simne:8774,slarr:8592,smile:8995,sqcap:8851,sqcup:8852,sqsub:8847,sqsup:8848,srarr:8594,starf:9733,strns:175,subnE:10955,subne:8842,supnE:10956,supne:8843,swArr:8665,swarr:8601,szlig:223,theta:952,thkap:8776,thorn:254,tilde:732,times:215,trade:8482,trisb:10701,tshcy:1115,twixt:8812,ubrcy:1118,ucirc:251,udarr:8645,udhar:10606,uharl:8639,uharr:8638,uhblk:9600,ultri:9720,umacr:363,uogon:371,uplus:8846,upsih:978,uring:367,urtri:9721,utdot:8944,utrif:9652,uuarr:8648,vBarv:10985,vDash:8872,varpi:982,vdash:8866,veeeq:8794,vltri:8882,vprop:8733,vrtri:8883,wcirc:373,wedge:8743,xcirc:9711,xdtri:9661,xhArr:10234,xharr:10231,xlArr:10232,xlarr:10229,xodot:10752,xrArr:10233,xrarr:10230,xutri:9651,ycirc:375,Aopf:120120,Ascr:119964,Auml:196,Barv:10983,Beta:914,Bopf:120121,Bscr:8492,CHcy:1063,COPY:169,Cdot:266,Copf:8450,Cscr:119966,DJcy:1026,DScy:1029,DZcy:1039,Darr:8609,Dopf:120123,Dscr:119967,Edot:278,Eopf:120124,Escr:8496,Esim:10867,Euml:203,Fopf:120125,Fscr:8497,GJcy:1027,Gdot:288,Gopf:120126,Gscr:119970,Hopf:8461,Hscr:8459,IEcy:1045,IOcy:1025,Idot:304,Iopf:120128,Iota:921,Iscr:8464,Iuml:207,Jopf:120129,Jscr:119973,KHcy:1061,KJcy:1036,Kopf:120130,Kscr:119974,LJcy:1033,Lang:10218,Larr:8606,Lopf:120131,Lscr:8466,Mopf:120132,Mscr:8499,NJcy:1034,Nopf:8469,Nscr:119977,Oopf:120134,Oscr:119978,Ouml:214,Popf:8473,Pscr:119979,QUOT:34,Qopf:8474,Qscr:119980,Rang:10219,Rarr:8608,Ropf:8477,Rscr:8475,SHcy:1064,Sopf:120138,Sqrt:8730,Sscr:119982,Star:8902,TScy:1062,Topf:120139,Tscr:119983,Uarr:8607,Uopf:120140,Upsi:978,Uscr:119984,Uuml:220,Vbar:10987,Vert:8214,Vopf:120141,Vscr:119985,Wopf:120142,Wscr:119986,Xopf:120143,Xscr:119987,YAcy:1071,YIcy:1031,YUcy:1070,Yopf:120144,Yscr:119988,Yuml:376,ZHcy:1046,Zdot:379,Zeta:918,Zopf:8484,Zscr:119989,andd:10844,andv:10842,ange:10660,aopf:120146,apid:8779,apos:39,ascr:119990,auml:228,bNot:10989,bbrk:9141,beta:946,beth:8502,bnot:8976,bopf:120147,boxH:9552,boxV:9553,boxh:9472,boxv:9474,bscr:119991,bsim:8765,bsol:92,bull:8226,bump:8782,cdot:267,cent:162,chcy:1095,cirE:10691,circ:710,cire:8791,comp:8705,cong:8773,copf:120148,copy:169,cscr:119992,csub:10959,csup:10960,dArr:8659,dHar:10597,darr:8595,dash:8208,diam:8900,djcy:1106,dopf:120149,dscr:119993,dscy:1109,dsol:10742,dtri:9663,dzcy:1119,eDot:8785,ecir:8790,edot:279,emsp:8195,ensp:8194,eopf:120150,epar:8917,epsi:1013,escr:8495,esim:8770,euml:235,euro:8364,excl:33,flat:9837,fnof:402,fopf:120151,fork:8916,fscr:119995,gdot:289,geqq:8807,gjcy:1107,gnap:10890,gneq:10888,gopf:120152,gscr:8458,gsim:8819,gtcc:10919,hArr:8660,half:189,harr:8596,hbar:8463,hopf:120153,hscr:119997,iecy:1077,imof:8887,iocy:1105,iopf:120154,iota:953,iscr:119998,isin:8712,iuml:239,jopf:120155,jscr:119999,khcy:1093,kjcy:1116,kopf:120156,kscr:120000,lArr:8656,lHar:10594,lang:10216,larr:8592,late:10925,lcub:123,ldca:10550,ldsh:8626,leqq:8806,ljcy:1113,lnap:10889,lneq:10887,lopf:120157,lozf:10731,lpar:40,lscr:120001,lsim:8818,lsqb:91,ltcc:10918,ltri:9667,macr:175,male:9794,malt:10016,mlcp:10971,mldr:8230,mopf:120158,mscr:120002,nbsp:160,ncap:10819,ncup:10818,ngeq:8817,ngtr:8815,nisd:8954,njcy:1114,nldr:8229,nleq:8816,nmid:8740,nopf:120159,npar:8742,nscr:120003,nsim:8769,nsub:8836,nsup:8837,ntgl:8825,ntlg:8824,oast:8859,ocir:8858,odiv:10808,odot:8857,ogon:731,oint:8750,omid:10678,oopf:120160,opar:10679,ordf:170,ordm:186,oror:10838,oscr:8500,osol:8856,ouml:246,para:182,part:8706,perp:8869,phiv:966,plus:43,popf:120161,prap:10935,prec:8826,prnE:10933,prod:8719,prop:8733,pscr:120005,qint:10764,qopf:120162,qscr:120006,quot:34,rArr:8658,rHar:10596,race:10714,rang:10217,rarr:8594,rcub:125,rdca:10551,rdsh:8627,real:8476,rect:9645,rhov:1009,ring:730,ropf:120163,rpar:41,rscr:120007,rsqb:93,rtri:9657,scap:10936,scnE:10934,sdot:8901,sect:167,semi:59,sext:10038,shcy:1096,sime:8771,simg:10910,siml:10909,smid:8739,smte:10924,solb:10692,sopf:120164,spar:8741,squf:9642,sscr:120008,star:9734,subE:10949,sube:8838,succ:8827,sung:9834,sup1:185,sup2:178,sup3:179,supE:10950,supe:8839,tbrk:9140,tdot:8411,tint:8749,toea:10536,topf:120165,tosa:10537,trie:8796,tscr:120009,tscy:1094,uArr:8657,uHar:10595,uarr:8593,uopf:120166,upsi:965,uscr:120010,utri:9653,uuml:252,vArr:8661,vBar:10984,varr:8597,vert:124,vopf:120167,vscr:120011,wopf:120168,wscr:120012,xcap:8898,xcup:8899,xmap:10236,xnis:8955,xopf:120169,xscr:120013,xvee:8897,yacy:1103,yicy:1111,yopf:120170,yscr:120014,yucy:1102,yuml:255,zdot:380,zeta:950,zhcy:1078,zopf:120171,zscr:120015,zwnj:8204,AMP:38,Acy:1040,Afr:120068,And:10835,Bcy:1041,Bfr:120069,Cap:8914,Cfr:8493,Chi:935,Cup:8915,Dcy:1044,Del:8711,Dfr:120071,Dot:168,ENG:330,ETH:208,Ecy:1069,Efr:120072,Eta:919,Fcy:1060,Ffr:120073,Gcy:1043,Gfr:120074,Hat:94,Hfr:8460,Icy:1048,Ifr:8465,Int:8748,Jcy:1049,Jfr:120077,Kcy:1050,Kfr:120078,Lcy:1051,Lfr:120079,Lsh:8624,Map:10501,Mcy:1052,Mfr:120080,Ncy:1053,Nfr:120081,Not:10988,Ocy:1054,Ofr:120082,Pcy:1055,Pfr:120083,Phi:934,Psi:936,Qfr:120084,REG:174,Rcy:1056,Rfr:8476,Rho:929,Rsh:8625,Scy:1057,Sfr:120086,Sub:8912,Sum:8721,Sup:8913,Tab:9,Tau:932,Tcy:1058,Tfr:120087,Ucy:1059,Ufr:120088,Vcy:1042,Vee:8897,Vfr:120089,Wfr:120090,Xfr:120091,Ycy:1067,Yfr:120092,Zcy:1047,Zfr:8488,acd:8767,acy:1072,afr:120094,amp:38,and:8743,ang:8736,apE:10864,ape:8778,ast:42,bcy:1073,bfr:120095,bot:8869,cap:8745,cfr:120096,chi:967,cir:9675,cup:8746,dcy:1076,deg:176,dfr:120097,die:168,div:247,dot:729,ecy:1101,efr:120098,egs:10902,ell:8467,els:10901,eng:331,eta:951,eth:240,fcy:1092,ffr:120099,gEl:10892,gap:10886,gcy:1075,gel:8923,geq:8805,ges:10878,gfr:120100,ggg:8921,glE:10898,gla:10917,glj:10916,gnE:8809,gne:10888,hfr:120101,icy:1080,iff:8660,ifr:120102,int:8747,jcy:1081,jfr:120103,kcy:1082,kfr:120104,lEg:10891,lap:10885,lat:10923,lcy:1083,leg:8922,leq:8804,les:10877,lfr:120105,lgE:10897,lnE:8808,lne:10887,loz:9674,lrm:8206,lsh:8624,map:8614,mcy:1084,mfr:120106,mho:8487,mid:8739,nap:8777,ncy:1085,nfr:120107,nge:8817,ngt:8815,nis:8956,niv:8715,nle:8816,nlt:8814,not:172,npr:8832,nsc:8833,num:35,ocy:1086,ofr:120108,ogt:10689,ohm:8486,olt:10688,ord:10845,orv:10843,par:8741,pcy:1087,pfr:120109,phi:966,piv:982,prE:10931,pre:10927,psi:968,qfr:120110,rcy:1088,reg:174,rfr:120111,rho:961,rlm:8207,rsh:8625,scE:10932,sce:10928,scy:1089,sfr:120112,shy:173,sim:8764,smt:10922,sol:47,squ:9633,sub:8834,sum:8721,sup:8835,tau:964,tcy:1090,tfr:120113,top:8868,ucy:1091,ufr:120114,uml:168,vcy:1074,vee:8744,vfr:120115,wfr:120116,xfr:120117,ycy:1099,yen:165,yfr:120118,zcy:1079,zfr:120119,zwj:8205,DD:8517,GT:62,Gg:8921,Gt:8811,Im:8465,LT:60,Ll:8920,Lt:8810,Mu:924,Nu:925,Or:10836,Pi:928,Pr:10939,Re:8476,Sc:10940,Xi:926,ac:8766,af:8289,ap:8776,dd:8518,ee:8519,eg:10906,el:10905,gE:8807,ge:8805,gg:8811,gl:8823,gt:62,ic:8291,ii:8520,in:8712,it:8290,lE:8806,le:8804,lg:8822,ll:8810,lt:60,mp:8723,mu:956,ne:8800,ni:8715,nu:957,oS:9416,or:8744,pi:960,pm:177,pr:8826,rx:8478,sc:8827,wp:8472,wr:8768,xi:958};var windows_1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376];var entity_pattern=new RegExp(\"&(#?(?:x[\\\\w\\\\d]+|\\\\d+|\".concat(Object.keys(entities).join('|'),\"))(?:;|\\\\b)\"),'g');function decode_character_references(html){return html.replace(entity_pattern,function(match,entity){var code;// Handle named entities\nif(entity[0]!=='#'){code=entities[entity];}else if(entity[1]==='x'){code=parseInt(entity.substring(2),16);}else{code=parseInt(entity.substring(1),10);}if(!code){return match;}return String.fromCodePoint(validate_code(code));});}var NUL=0;// some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n// code points with alternatives in some cases - since we're bypassing that mechanism, we need\n// to replace them ourselves\n//\n// Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\nfunction validate_code(code){// line feed becomes generic whitespace\nif(code===10){return 32;}// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\nif(code<128){return code;}// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n// to correct the mistake or we'll end up with missing € signs and so on\nif(code<=159){return windows_1252[code-128];}// basic multilingual plane\nif(code<55296){return code;}// UTF-16 surrogate halves\nif(code<=57343){return NUL;}// rest of the basic multilingual plane\nif(code<=65535){return code;}// supplementary multilingual plane 0x10000 - 0x1ffff\nif(code>=65536&&code<=131071){return code;}// supplementary ideographic plane 0x20000 - 0x2ffff\nif(code>=131072&&code<=196607){return code;}return NUL;}// based on http://developers.whatwg.org/syntax.html#syntax-tag-omission\nvar disallowed_contents=new Map([['li',new Set(['li'])],['dt',new Set(['dt','dd'])],['dd',new Set(['dt','dd'])],['p',new Set('address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(' '))],['rt',new Set(['rt','rp'])],['rp',new Set(['rt','rp'])],['optgroup',new Set(['optgroup'])],['option',new Set(['option','optgroup'])],['thead',new Set(['tbody','tfoot'])],['tbody',new Set(['tbody','tfoot'])],['tfoot',new Set(['tbody'])],['tr',new Set(['tr','tbody'])],['td',new Set(['td','th','tr'])],['th',new Set(['td','th','tr'])]]);// can this be a child of the parent element, or does it implicitly\n// close it, like `<li>one<li>two`?\nfunction closing_tag_omitted(current,next){if(disallowed_contents.has(current)){if(!next||disallowed_contents.get(current).has(next)){return true;}}return false;}// eslint-disable-next-line no-useless-escape\nvar valid_tag_name=/^\\!?[a-zA-Z]{1,}:?[a-zA-Z0-9\\-]*/;var meta_tags=new Map([['svelte:head','Head'],['svelte:options','Options'],['svelte:window','Window'],['svelte:body','Body']]);var valid_meta_tags=Array.from(meta_tags.keys()).concat('svelte:self','svelte:component','svelte:fragment');var specials=new Map([['script',{read:read_script,property:'js'}],['style',{read:read_style,property:'css'}]]);var SELF=/^svelte:self(?=[\\s/>])/;var COMPONENT=/^svelte:component(?=[\\s/>])/;var SLOT=/^svelte:fragment(?=[\\s/>])/;function parent_is_head(stack){var i=stack.length;while(i--){var type=stack[i].type;if(type==='Head')return true;if(type==='Element'||type==='InlineComponent')return false;}return false;}function tag(parser){var start=parser.index++;var parent=parser.current();if(parser.eat('!--')){var _data=parser.read_until(/-->/);parser.eat('-->',true,parser_errors.unclosed_comment);parser.current().children.push({start:start,end:parser.index,type:'Comment',data:_data,ignores:extract_svelte_ignore(_data)});return;}var is_closing_tag=parser.eat('/');var name=read_tag_name(parser);if(meta_tags.has(name)){var slug=meta_tags.get(name).toLowerCase();if(is_closing_tag){if((name==='svelte:window'||name==='svelte:body')&&parser.current().children.length){parser.error(parser_errors.invalid_element_content(slug,name),parser.current().children[0].start);}}else{if(name in parser.meta_tags){parser.error(parser_errors.duplicate_element(slug,name),start);}if(parser.stack.length>1){parser.error(parser_errors.invalid_element_placement(slug,name),start);}parser.meta_tags[name]=true;}}var type=meta_tags.has(name)?meta_tags.get(name):/[A-Z]/.test(name[0])||name==='svelte:self'||name==='svelte:component'?'InlineComponent':name==='svelte:fragment'?'SlotTemplate':name==='title'&&parent_is_head(parser.stack)?'Title':name==='slot'&&!parser.customElement?'Slot':'Element';var element={start:start,end:null,type:type,name:name,attributes:[],children:[]};parser.allow_whitespace();if(is_closing_tag){if(is_void(name)){parser.error(parser_errors.invalid_void_content(name),start);}parser.eat('>',true);// close any elements that don't have their own closing tags, e.g. <div><p></div>\nwhile(parent.name!==name){if(parent.type!=='Element'){var _error=parser.last_auto_closed_tag&&parser.last_auto_closed_tag.tag===name?parser_errors.invalid_closing_tag_autoclosed(name,parser.last_auto_closed_tag.reason):parser_errors.invalid_closing_tag_unopened(name);parser.error(_error,start);}parent.end=start;parser.stack.pop();parent=parser.current();}parent.end=parser.index;parser.stack.pop();if(parser.last_auto_closed_tag&&parser.stack.length<parser.last_auto_closed_tag.depth){parser.last_auto_closed_tag=null;}return;}else if(closing_tag_omitted(parent.name,name)){parent.end=start;parser.stack.pop();parser.last_auto_closed_tag={tag:parent.name,reason:name,depth:parser.stack.length};}var unique_names=new Set();var attribute;while(attribute=read_attribute(parser,unique_names)){element.attributes.push(attribute);parser.allow_whitespace();}if(name==='svelte:component'){var index=element.attributes.findIndex(function(attr){return attr.type==='Attribute'&&attr.name==='this';});if(!~index){parser.error(parser_errors.missing_component_definition,start);}var definition=element.attributes.splice(index,1)[0];if(definition.value===true||definition.value.length!==1||definition.value[0].type==='Text'){parser.error(parser_errors.invalid_component_definition,definition.start);}element.expression=definition.value[0].expression;}// special cases – top-level <script> and <style>\nif(specials.has(name)&&parser.stack.length===1){var special=specials.get(name);parser.eat('>',true);var content=special.read(parser,start,element.attributes);if(content)parser[special.property].push(content);return;}parser.current().children.push(element);var self_closing=parser.eat('/')||is_void(name);parser.eat('>',true);if(self_closing){// don't push self-closing elements onto the stack\nelement.end=parser.index;}else if(name==='textarea'){// special case\nelement.children=read_sequence(parser,function(){return /^<\\/textarea(\\s[^>]*)?>/i.test(parser.template.slice(parser.index));});parser.read(/^<\\/textarea(\\s[^>]*)?>/i);element.end=parser.index;}else if(name==='script'||name==='style'){// special case\nvar _start=parser.index;var _data2=parser.read_until(new RegExp(\"</\".concat(name,\">\")));var end=parser.index;element.children.push({start:_start,end:end,type:'Text',data:_data2});parser.eat(\"</\".concat(name,\">\"),true);element.end=parser.index;}else{parser.stack.push(element);}}function read_tag_name(parser){var start=parser.index;if(parser.read(SELF)){// check we're inside a block, otherwise this\n// will cause infinite recursion\nvar _i30=parser.stack.length;var legal=false;while(_i30--){var _fragment=parser.stack[_i30];if(_fragment.type==='IfBlock'||_fragment.type==='EachBlock'||_fragment.type==='InlineComponent'){legal=true;break;}}if(!legal){parser.error(parser_errors.invalid_self_placement,start);}return'svelte:self';}if(parser.read(COMPONENT))return'svelte:component';if(parser.read(SLOT))return'svelte:fragment';var name=parser.read_until(/(\\s|\\/|>)/);if(meta_tags.has(name))return name;if(name.startsWith('svelte:')){var match=fuzzymatch(name.slice(7),valid_meta_tags);parser.error(parser_errors.invalid_tag_name_svelte_element(valid_meta_tags,match),start);}if(!valid_tag_name.test(name)){parser.error(parser_errors.invalid_tag_name,start);}return name;}function read_attribute(parser,unique_names){var start=parser.index;function check_unique(name){if(unique_names.has(name)){parser.error(parser_errors.duplicate_attribute,start);}unique_names.add(name);}if(parser.eat('{')){parser.allow_whitespace();if(parser.eat('...')){var _expression3=read_expression(parser);parser.allow_whitespace();parser.eat('}',true);return{start:start,end:parser.index,type:'Spread',expression:_expression3};}else{var value_start=parser.index;var _name2=parser.read_identifier();parser.allow_whitespace();parser.eat('}',true);if(_name2===null){parser.error(parser_errors.empty_attribute_shorthand,start);}check_unique(_name2);return{start:start,end:parser.index,type:'Attribute',name:_name2,value:[{start:value_start,end:value_start+_name2.length,type:'AttributeShorthand',expression:{start:value_start,end:value_start+_name2.length,type:'Identifier',name:_name2}}]};}}// eslint-disable-next-line no-useless-escape\nvar name=parser.read_until(/[\\s=\\/>\"']/);if(!name)return null;var end=parser.index;parser.allow_whitespace();var colon_index=name.indexOf(':');var type=colon_index!==-1&&get_directive_type(name.slice(0,colon_index));var value=true;if(parser.eat('=')){parser.allow_whitespace();value=read_attribute_value(parser);end=parser.index;}else if(parser.match_regex(/[\"']/)){parser.error(parser_errors.unexpected_token('='),parser.index);}if(type){var _name$slice$split=name.slice(colon_index+1).split('|'),_name$slice$split2=(0,_toArray2.default)(_name$slice$split),directive_name=_name$slice$split2[0],modifiers=_name$slice$split2.slice(1);if(directive_name===''){parser.error(parser_errors.empty_directive_name(type),start+colon_index+1);}if(type==='Binding'&&directive_name!=='this'){check_unique(directive_name);}else if(type!=='EventHandler'&&type!=='Action'){check_unique(name);}if(type==='Ref'){parser.error(parser_errors.invalid_ref_directive(directive_name),start);}if(type==='StyleDirective'){return{start:start,end:end,type:type,name:directive_name,value:value};}var first_value=value[0];var _expression4=null;if(first_value){var attribute_contains_text=value.length>1||first_value.type==='Text';if(attribute_contains_text){parser.error(parser_errors.invalid_directive_value,first_value.start);}else{_expression4=first_value.expression;}}var directive={start:start,end:end,type:type,name:directive_name,modifiers:modifiers,expression:_expression4};if(type==='Transition'){var direction=name.slice(0,colon_index);directive.intro=direction==='in'||direction==='transition';directive.outro=direction==='out'||direction==='transition';}// Directive name is expression, e.g. <p class:isRed />\nif(!directive.expression&&(type==='Binding'||type==='Class')){directive.expression={start:directive.start+colon_index+1,end:directive.end,type:'Identifier',name:directive.name};}return directive;}check_unique(name);return{start:start,end:end,type:'Attribute',name:name,value:value};}function get_directive_type(name){if(name==='use')return'Action';if(name==='animate')return'Animation';if(name==='bind')return'Binding';if(name==='class')return'Class';if(name==='style')return'StyleDirective';if(name==='on')return'EventHandler';if(name==='let')return'Let';if(name==='ref')return'Ref';if(name==='in'||name==='out'||name==='transition')return'Transition';}function read_attribute_value(parser){var quote_mark=parser.eat(\"'\")?\"'\":parser.eat('\"')?'\"':null;if(quote_mark&&parser.eat(quote_mark)){return[{start:parser.index-1,end:parser.index-1,type:'Text',raw:'',data:''}];}var regex=quote_mark===\"'\"?/'/:quote_mark==='\"'?/\"/:/(\\/>|[\\s\"'=<>`])/;var value;try{value=read_sequence(parser,function(){return!!parser.match_regex(regex);});}catch(error){if(error.code==='parse-error'){// if the attribute value didn't close + self-closing tag\n// eg: `<Component test={{a:1} />`\n// acorn may throw a `Unterminated regular expression` because of `/>`\nif(parser.template.slice(error.pos-1,error.pos+1)==='/>'){parser.index=error.pos;parser.error(parser_errors.unclosed_attribute_value(quote_mark||'}'));}}throw error;}if(value.length===0&&!quote_mark){parser.error(parser_errors.missing_attribute_value);}if(quote_mark)parser.index+=1;return value;}function read_sequence(parser,done){var current_chunk={start:parser.index,end:null,type:'Text',raw:'',data:null};var chunks=[];function flush(end){if(current_chunk.raw){current_chunk.data=decode_character_references(current_chunk.raw);current_chunk.end=end;chunks.push(current_chunk);}}while(parser.index<parser.template.length){var index=parser.index;if(done()){flush(parser.index);return chunks;}else if(parser.eat('{')){flush(parser.index-1);parser.allow_whitespace();var _expression5=read_expression(parser);parser.allow_whitespace();parser.eat('}',true);chunks.push({start:index,end:parser.index,type:'MustacheTag',expression:_expression5});current_chunk={start:parser.index,end:null,type:'Text',raw:'',data:null};}else{current_chunk.raw+=parser.template[parser.index++];}}parser.error(parser_errors.unexpected_eof);}var SQUARE_BRACKET_OPEN='['.charCodeAt(0);var SQUARE_BRACKET_CLOSE=']'.charCodeAt(0);var CURLY_BRACKET_OPEN='{'.charCodeAt(0);var CURLY_BRACKET_CLOSE='}'.charCodeAt(0);function is_bracket_open(code){return code===SQUARE_BRACKET_OPEN||code===CURLY_BRACKET_OPEN;}function is_bracket_close(code){return code===SQUARE_BRACKET_CLOSE||code===CURLY_BRACKET_CLOSE;}function is_bracket_pair(open,close){return open===SQUARE_BRACKET_OPEN&&close===SQUARE_BRACKET_CLOSE||open===CURLY_BRACKET_OPEN&&close===CURLY_BRACKET_CLOSE;}function get_bracket_close(open){if(open===SQUARE_BRACKET_OPEN){return SQUARE_BRACKET_CLOSE;}if(open===CURLY_BRACKET_OPEN){return CURLY_BRACKET_CLOSE;}}function read_context(parser){var start=parser.index;var i=parser.index;var code=full_char_code_at(parser.template,i);if(isIdentifierStart(code,true)){return{type:'Identifier',name:parser.read_identifier(),start:start,end:parser.index};}if(!is_bracket_open(code)){parser.error(parser_errors.unexpected_token_destructure);}var bracket_stack=[code];i+=code<=0xffff?1:2;while(i<parser.template.length){var _code=full_char_code_at(parser.template,i);if(is_bracket_open(_code)){bracket_stack.push(_code);}else if(is_bracket_close(_code)){if(!is_bracket_pair(bracket_stack[bracket_stack.length-1],_code)){parser.error(parser_errors.unexpected_token(String.fromCharCode(get_bracket_close(bracket_stack[bracket_stack.length-1]))));}bracket_stack.pop();if(bracket_stack.length===0){i+=_code<=0xffff?1:2;break;}}i+=_code<=0xffff?1:2;}parser.index=i;var pattern_string=parser.template.slice(start,i);try{// the length of the `space_with_newline` has to be start - 1\n// because we added a `(` in front of the pattern_string,\n// which shifted the entire string to right by 1\n// so we offset it by removing 1 character in the `space_with_newline`\n// to achieve that, we remove the 1st space encountered,\n// so it will not affect the `column` of the node\nvar space_with_newline=parser.template.slice(0,start).replace(/[^\\n]/g,' ');var first_space=space_with_newline.indexOf(' ');space_with_newline=space_with_newline.slice(0,first_space)+space_with_newline.slice(first_space+1);return parse_expression_at(\"\".concat(space_with_newline,\"(\").concat(pattern_string,\" = 1)\"),start-1).left;}catch(error){parser.acorn_error(error);}}function trim_start(str){return str.replace(start_whitespace,'');}function trim_end(str){return str.replace(end_whitespace,'');}function to_string(node){switch(node.type){case'IfBlock':return'{#if} block';case'ThenBlock':return'{:then} block';case'ElseBlock':return'{:else} block';case'PendingBlock':case'AwaitBlock':return'{#await} block';case'CatchBlock':return'{:catch} block';case'EachBlock':return'{#each} block';case'RawMustacheTag':return'{@html} block';case'DebugTag':return'{@debug} block';case'ConstTag':return'{@const} tag';case'Element':case'InlineComponent':case'Slot':case'Title':return\"<\".concat(node.name,\"> tag\");default:return node.type;}}function trim_whitespace(block,trim_before,trim_after){if(!block.children||block.children.length===0)return;// AwaitBlock\nvar first_child=block.children[0];var last_child=block.children[block.children.length-1];if(first_child.type==='Text'&&trim_before){first_child.data=trim_start(first_child.data);if(!first_child.data)block.children.shift();}if(last_child.type==='Text'&&trim_after){last_child.data=trim_end(last_child.data);if(!last_child.data)block.children.pop();}if(block.else){trim_whitespace(block.else,trim_before,trim_after);}if(first_child.elseif){trim_whitespace(first_child,trim_before,trim_after);}}function mustache(parser){var start=parser.index;parser.index+=1;parser.allow_whitespace();// {/if}, {/each}, {/await} or {/key}\nif(parser.eat('/')){var block=parser.current();var expected;if(closing_tag_omitted(block.name)){block.end=start;parser.stack.pop();block=parser.current();}if(block.type==='ElseBlock'||block.type==='PendingBlock'||block.type==='ThenBlock'||block.type==='CatchBlock'){block.end=start;parser.stack.pop();block=parser.current();expected='await';}if(block.type==='IfBlock'){expected='if';}else if(block.type==='EachBlock'){expected='each';}else if(block.type==='AwaitBlock'){expected='await';}else if(block.type==='KeyBlock'){expected='key';}else{parser.error(parser_errors.unexpected_block_close);}parser.eat(expected,true);parser.allow_whitespace();parser.eat('}',true);while(block.elseif){block.end=parser.index;parser.stack.pop();block=parser.current();if(block.else){block.else.end=start;}}// strip leading/trailing whitespace as necessary\nvar char_before=parser.template[block.start-1];var char_after=parser.template[parser.index];var trim_before=!char_before||whitespace.test(char_before);var trim_after=!char_after||whitespace.test(char_after);trim_whitespace(block,trim_before,trim_after);block.end=parser.index;parser.stack.pop();}else if(parser.eat(':else')){if(parser.eat('if')){parser.error(parser_errors.invalid_elseif);}parser.allow_whitespace();// :else if\nif(parser.eat('if')){var _block2=parser.current();if(_block2.type!=='IfBlock'){parser.error(parser.stack.some(function(block){return block.type==='IfBlock';})?parser_errors.invalid_elseif_placement_unclosed_block(to_string(_block2)):parser_errors.invalid_elseif_placement_outside_if);}parser.require_whitespace();var _expression6=read_expression(parser);parser.allow_whitespace();parser.eat('}',true);_block2.else={start:parser.index,end:null,type:'ElseBlock',children:[{start:parser.index,end:null,type:'IfBlock',elseif:true,expression:_expression6,children:[]}]};parser.stack.push(_block2.else.children[0]);}else{// :else\nvar _block3=parser.current();if(_block3.type!=='IfBlock'&&_block3.type!=='EachBlock'){parser.error(parser.stack.some(function(block){return block.type==='IfBlock'||block.type==='EachBlock';})?parser_errors.invalid_else_placement_unclosed_block(to_string(_block3)):parser_errors.invalid_else_placement_outside_if);}parser.allow_whitespace();parser.eat('}',true);_block3.else={start:parser.index,end:null,type:'ElseBlock',children:[]};parser.stack.push(_block3.else);}}else if(parser.match(':then')||parser.match(':catch')){var _block4=parser.current();var is_then=parser.eat(':then')||!parser.eat(':catch');if(is_then){if(_block4.type!=='PendingBlock'){parser.error(parser.stack.some(function(block){return block.type==='PendingBlock';})?parser_errors.invalid_then_placement_unclosed_block(to_string(_block4)):parser_errors.invalid_then_placement_without_await);}}else{if(_block4.type!=='ThenBlock'&&_block4.type!=='PendingBlock'){parser.error(parser.stack.some(function(block){return block.type==='ThenBlock'||block.type==='PendingBlock';})?parser_errors.invalid_catch_placement_unclosed_block(to_string(_block4)):parser_errors.invalid_catch_placement_without_await);}}_block4.end=start;parser.stack.pop();var await_block=parser.current();if(!parser.eat('}')){parser.require_whitespace();await_block[is_then?'value':'error']=read_context(parser);parser.allow_whitespace();parser.eat('}',true);}var new_block={start:start,end:null,type:is_then?'ThenBlock':'CatchBlock',children:[],skip:false};await_block[is_then?'then':'catch']=new_block;parser.stack.push(new_block);}else if(parser.eat('#')){// {#if foo}, {#each foo} or {#await foo}\nvar type;if(parser.eat('if')){type='IfBlock';}else if(parser.eat('each')){type='EachBlock';}else if(parser.eat('await')){type='AwaitBlock';}else if(parser.eat('key')){type='KeyBlock';}else{parser.error(parser_errors.expected_block_type);}parser.require_whitespace();var _expression7=read_expression(parser);var _block5=type==='AwaitBlock'?{start:start,end:null,type:type,expression:_expression7,value:null,error:null,pending:{start:null,end:null,type:'PendingBlock',children:[],skip:true},then:{start:null,end:null,type:'ThenBlock',children:[],skip:true},catch:{start:null,end:null,type:'CatchBlock',children:[],skip:true}}:{start:start,end:null,type:type,expression:_expression7,children:[]};parser.allow_whitespace();// {#each} blocks must declare a context – {#each list as item}\nif(type==='EachBlock'){parser.eat('as',true);parser.require_whitespace();_block5.context=read_context(parser);parser.allow_whitespace();if(parser.eat(',')){parser.allow_whitespace();_block5.index=parser.read_identifier();if(!_block5.index)parser.error(parser_errors.expected_name);parser.allow_whitespace();}if(parser.eat('(')){parser.allow_whitespace();_block5.key=read_expression(parser);parser.allow_whitespace();parser.eat(')',true);parser.allow_whitespace();}}var await_block_shorthand=type==='AwaitBlock'&&parser.eat('then');if(await_block_shorthand){if(parser.match_regex(/\\s*}/)){parser.allow_whitespace();}else{parser.require_whitespace();_block5.value=read_context(parser);parser.allow_whitespace();}}var await_block_catch_shorthand=!await_block_shorthand&&type==='AwaitBlock'&&parser.eat('catch');if(await_block_catch_shorthand){if(parser.match_regex(/\\s*}/)){parser.allow_whitespace();}else{parser.require_whitespace();_block5.error=read_context(parser);parser.allow_whitespace();}}parser.eat('}',true);parser.current().children.push(_block5);parser.stack.push(_block5);if(type==='AwaitBlock'){var child_block;if(await_block_shorthand){_block5.then.skip=false;child_block=_block5.then;}else if(await_block_catch_shorthand){_block5.catch.skip=false;child_block=_block5.catch;}else{_block5.pending.skip=false;child_block=_block5.pending;}child_block.start=parser.index;parser.stack.push(child_block);}}else if(parser.eat('@html')){// {@html content} tag\nparser.require_whitespace();var _expression8=read_expression(parser);parser.allow_whitespace();parser.eat('}',true);parser.current().children.push({start:start,end:parser.index,type:'RawMustacheTag',expression:_expression8});}else if(parser.eat('@debug')){var identifiers;// Implies {@debug} which indicates \"debug all\"\nif(parser.read(/\\s*}/)){identifiers=[];}else{var _expression9=read_expression(parser);identifiers=_expression9.type==='SequenceExpression'?_expression9.expressions:[_expression9];identifiers.forEach(function(node){if(node.type!=='Identifier'){parser.error(parser_errors.invalid_debug_args,node.start);}});parser.allow_whitespace();parser.eat('}',true);}parser.current().children.push({start:start,end:parser.index,type:'DebugTag',identifiers:identifiers});}else if(parser.eat('@const')){// {@const a = b}\nparser.require_whitespace();var _expression10=read_expression(parser);if(!(_expression10.type==='AssignmentExpression'&&_expression10.operator==='=')){parser.error({code:'invalid-const-args',message:'{@const ...} must be an assignment.'},start);}parser.allow_whitespace();parser.eat('}',true);parser.current().children.push({start:start,end:parser.index,type:'ConstTag',expression:_expression10});}else{var _expression11=read_expression(parser);parser.allow_whitespace();parser.eat('}',true);parser.current().children.push({start:start,end:parser.index,type:'MustacheTag',expression:_expression11});}}function text(parser){var start=parser.index;var data='';while(parser.index<parser.template.length&&!parser.match('<')&&!parser.match('{')){data+=parser.template[parser.index++];}var node={start:start,end:parser.index,type:'Text',raw:data,data:decode_character_references(data)};parser.current().children.push(node);}function fragment(parser){if(parser.match('<')){return tag;}if(parser.match('{')){return mustache;}return text;}function getLocator(source,options){if(options===void 0){options={};}var offsetLine=options.offsetLine||0;var offsetColumn=options.offsetColumn||0;var originalLines=source.split('\\n');var start=0;var lineRanges=originalLines.map(function(line,i){var end=start+line.length+1;var range={start:start,end:end,line:i};start=end;return range;});var i=0;function rangeContains(range,index){return range.start<=index&&index<range.end;}function getLocation(range,index){return{line:offsetLine+range.line,column:offsetColumn+index-range.start,character:index};}function locate(search,startIndex){if(typeof search==='string'){search=source.indexOf(search,startIndex||0);}var range=lineRanges[i];var d=search>=range.end?1:-1;while(range){if(rangeContains(range,search))return getLocation(range,search);i+=d;range=lineRanges[i];}}return locate;}function locate(source,search,options){if(typeof options==='number'){throw new Error('locate takes a { startIndex, offsetLine, offsetColumn } object as the third argument');}return getLocator(source,options)(search,options&&options.startIndex);}function tabs_to_spaces(str){return str.replace(/^\\t+/,function(match){return match.split('\\t').join('  ');});}function get_code_frame(source,line,column){var lines=source.split('\\n');var frame_start=Math.max(0,line-2);var frame_end=Math.min(line+3,lines.length);var digits=String(frame_end+1).length;return lines.slice(frame_start,frame_end).map(function(str,i){var isErrorLine=frame_start+i===line;var line_num=String(i+frame_start+1).padStart(digits,' ');if(isErrorLine){var indicator=' '.repeat(digits+2+tabs_to_spaces(str.slice(0,column)).length)+'^';return\"\".concat(line_num,\": \").concat(tabs_to_spaces(str),\"\\n\").concat(indicator);}return\"\".concat(line_num,\": \").concat(tabs_to_spaces(str));}).join('\\n');}var CompileError=/*#__PURE__*/function(_Error){(0,_inherits2.default)(CompileError,_Error);var _super2=_createSuper(CompileError);function CompileError(){(0,_classCallCheck2.default)(this,CompileError);return _super2.apply(this,arguments);}(0,_createClass2.default)(CompileError,[{key:\"toString\",value:function toString(){return\"\".concat(this.message,\" (\").concat(this.start.line,\":\").concat(this.start.column,\")\\n\").concat(this.frame);}}]);return CompileError;}(/*#__PURE__*/(0,_wrapNativeSuper2.default)(Error));function _error2(message,props){var error=new CompileError(message);error.name=props.name;var start=locate(props.source,props.start,{offsetLine:1});var end=locate(props.source,props.end||props.start,{offsetLine:1});error.code=props.code;error.start=start;error.end=end;error.pos=props.start;error.filename=props.filename;error.frame=get_code_frame(props.source,start.line-1,start.column);throw error;}var Parser$1=/*#__PURE__*/function(){function Parser$1(template,options){(0,_classCallCheck2.default)(this,Parser$1);this.index=0;this.stack=[];this.css=[];this.js=[];this.meta_tags={};if(typeof template!=='string'){throw new TypeError('Template must be a string');}this.template=template.replace(/\\s+$/,'');this.filename=options.filename;this.customElement=options.customElement;this.html={start:null,end:null,type:'Fragment',children:[]};this.stack.push(this.html);var state=fragment;while(this.index<this.template.length){state=state(this)||fragment;}if(this.stack.length>1){var current=this.current();var type=current.type==='Element'?\"<\".concat(current.name,\">\"):'Block';var slug=current.type==='Element'?'element':'block';this.error({code:\"unclosed-\".concat(slug),message:\"\".concat(type,\" was left open\")},current.start);}if(state!==fragment){this.error({code:'unexpected-eof',message:'Unexpected end of input'});}if(this.html.children.length){var start=this.html.children[0].start;while(whitespace.test(template[start])){start+=1;}var end=this.html.children[this.html.children.length-1].end;while(whitespace.test(template[end-1])){end-=1;}this.html.start=start;this.html.end=end;}else{this.html.start=this.html.end=null;}}(0,_createClass2.default)(Parser$1,[{key:\"current\",value:function current(){return this.stack[this.stack.length-1];}},{key:\"acorn_error\",value:function acorn_error(err){this.error({code:'parse-error',message:err.message.replace(/ \\(\\d+:\\d+\\)$/,'')},err.pos);}},{key:\"error\",value:function error(_ref2){var code=_ref2.code,message=_ref2.message;var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.index;_error2(message,{name:'ParseError',code:code,source:this.template,start:index,filename:this.filename});}},{key:\"eat\",value:function eat(str,required,error){if(this.match(str)){this.index+=str.length;return true;}if(required){this.error(error||(this.index===this.template.length?parser_errors.unexpected_eof_token(str):parser_errors.unexpected_token(str)));}return false;}},{key:\"match\",value:function match(str){return this.template.slice(this.index,this.index+str.length)===str;}},{key:\"match_regex\",value:function match_regex(pattern){var match=pattern.exec(this.template.slice(this.index));if(!match||match.index!==0)return null;return match[0];}},{key:\"allow_whitespace\",value:function allow_whitespace(){while(this.index<this.template.length&&whitespace.test(this.template[this.index])){this.index++;}}},{key:\"read\",value:function read(pattern){var result=this.match_regex(pattern);if(result)this.index+=result.length;return result;}},{key:\"read_identifier\",value:function read_identifier(){var allow_reserved=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var start=this.index;var i=this.index;var code=full_char_code_at(this.template,i);if(!isIdentifierStart(code,true))return null;i+=code<=0xffff?1:2;while(i<this.template.length){var _code2=full_char_code_at(this.template,i);if(!isIdentifierChar(_code2,true))break;i+=_code2<=0xffff?1:2;}var identifier=this.template.slice(this.index,this.index=i);if(!allow_reserved&&reserved.has(identifier)){this.error({code:'unexpected-reserved-word',message:\"'\".concat(identifier,\"' is a reserved word in JavaScript and cannot be used here\")},start);}return identifier;}},{key:\"read_until\",value:function read_until(pattern,error_message){if(this.index>=this.template.length){this.error(error_message||{code:'unexpected-eof',message:'Unexpected end of input'});}var start=this.index;var match=pattern.exec(this.template.slice(start));if(match){this.index=start+match.index;return this.template.slice(start,this.index);}this.index=this.template.length;return this.template.slice(start);}},{key:\"require_whitespace\",value:function require_whitespace(){if(!whitespace.test(this.template[this.index])){this.error({code:'missing-whitespace',message:'Expected whitespace'});}this.allow_whitespace();}}]);return Parser$1;}();function parse$3(template){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var parser=new Parser$1(template,options);// TODO we may want to allow multiple <style> tags —\n// one scoped, one global. for now, only allow one\nif(parser.css.length>1){parser.error(parser_errors.duplicate_style,parser.css[1].start);}var instance_scripts=parser.js.filter(function(script){return script.context==='default';});var module_scripts=parser.js.filter(function(script){return script.context==='module';});if(instance_scripts.length>1){parser.error(parser_errors.invalid_script_instance,instance_scripts[1].start);}if(module_scripts.length>1){parser.error(parser_errors.invalid_script_module,module_scripts[1].start);}return{html:parser.html,css:parser.css[0],instance:instance_scripts[0],module:module_scripts[0]};}function is_head(node){return node&&node.type==='MemberExpression'&&node.object.name==='@_document'&&node.property.name==='head';}var Block$1=/*#__PURE__*/function(){function Block$1(options){(0,_classCallCheck2.default)(this,Block$1);this.dependencies=new Set();this.binding_group_initialised=new Set();this.event_listeners=[];this.variables=new Map();this.has_update_method=false;this.parent=options.parent;this.renderer=options.renderer;this.name=options.name;this.type=options.type;this.comment=options.comment;this.wrappers=[];// for keyed each blocks\nthis.key=options.key;this.first=null;this.bindings=options.bindings;this.chunks={declarations:[],init:[],create:[],claim:[],hydrate:[],mount:[],measure:[],fix:[],animate:[],intro:[],update:[],outro:[],destroy:[]};this.has_animation=false;this.has_intro_method=false;// a block could have an intro method but not intro transitions, e.g. if a sibling block has intros\nthis.has_outro_method=false;this.outros=0;this.get_unique_name=this.renderer.component.get_unique_name_maker();this.aliases=new Map();if(this.key)this.aliases.set('key',this.get_unique_name('key'));}(0,_createClass2.default)(Block$1,[{key:\"assign_variable_names\",value:function assign_variable_names(){var seen=new Set();var dupes=new Set();var i=this.wrappers.length;while(i--){var wrapper=this.wrappers[i];if(!wrapper.var)continue;if(seen.has(wrapper.var.name)){dupes.add(wrapper.var.name);}seen.add(wrapper.var.name);}var counts=new Map();i=this.wrappers.length;while(i--){var _wrapper=this.wrappers[i];if(!_wrapper.var)continue;var suffix='';if(dupes.has(_wrapper.var.name)){var _i31=counts.get(_wrapper.var.name)||0;counts.set(_wrapper.var.name,_i31+1);suffix=_i31;}_wrapper.var.name=this.get_unique_name(_wrapper.var.name+suffix).name;}}},{key:\"add_dependencies\",value:function add_dependencies(dependencies){var _this6=this;dependencies.forEach(function(dependency){_this6.dependencies.add(dependency);});this.has_update_method=true;if(this.parent){this.parent.add_dependencies(dependencies);}}},{key:\"add_element\",value:function add_element(id,render_statement,claim_statement,parent_node,no_detach){this.add_variable(id);this.chunks.create.push(b(_templateObject||(_templateObject=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\";\"])),id,render_statement));if(this.renderer.options.hydratable){this.chunks.claim.push(b(_templateObject2||(_templateObject2=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\";\"])),id,claim_statement||render_statement));}if(parent_node){this.chunks.mount.push(b(_templateObject3||(_templateObject3=(0,_taggedTemplateLiteral2.default)([\"@append(\",\", \",\");\"])),parent_node,id));if(is_head(parent_node)&&!no_detach)this.chunks.destroy.push(b(_templateObject4||(_templateObject4=(0,_taggedTemplateLiteral2.default)([\"@detach(\",\");\"])),id));}else{this.chunks.mount.push(b(_templateObject5||(_templateObject5=(0,_taggedTemplateLiteral2.default)([\"@insert(#target, \",\", #anchor);\"])),id));if(!no_detach)this.chunks.destroy.push(b(_templateObject6||(_templateObject6=(0,_taggedTemplateLiteral2.default)([\"if (detaching) @detach(\",\");\"])),id));}}},{key:\"add_intro\",value:function add_intro(local){this.has_intros=this.has_intro_method=true;if(!local&&this.parent)this.parent.add_intro();}},{key:\"add_outro\",value:function add_outro(local){this.has_outros=this.has_outro_method=true;this.outros+=1;if(!local&&this.parent)this.parent.add_outro();}},{key:\"add_animation\",value:function add_animation(){this.has_animation=true;}},{key:\"add_variable\",value:function add_variable(id,init){if(this.variables.has(id.name)){throw new Error(\"Variable '\".concat(id.name,\"' already initialised with a different value\"));}this.variables.set(id.name,{id:id,init:init});}},{key:\"alias\",value:function alias(name){if(!this.aliases.has(name)){this.aliases.set(name,this.get_unique_name(name));}return this.aliases.get(name);}},{key:\"child\",value:function child(options){return new Block$1(Object.assign({},this,{key:null},options,{parent:this}));}},{key:\"get_contents\",value:function get_contents(key){var dev=this.renderer.options.dev;if(this.has_outros){this.add_variable({type:'Identifier',name:'#current'});if(this.chunks.intro.length>0){this.chunks.intro.push(b(_templateObject7||(_templateObject7=(0,_taggedTemplateLiteral2.default)([\"#current = true;\"]))));this.chunks.mount.push(b(_templateObject8||(_templateObject8=(0,_taggedTemplateLiteral2.default)([\"#current = true;\"]))));}if(this.chunks.outro.length>0){this.chunks.outro.push(b(_templateObject9||(_templateObject9=(0,_taggedTemplateLiteral2.default)([\"#current = false;\"]))));}}if(this.autofocus){if(this.autofocus.condition_expression){this.chunks.mount.push(b(_templateObject10||(_templateObject10=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".focus();\"])),this.autofocus.condition_expression,this.autofocus.element_var));}else{this.chunks.mount.push(b(_templateObject11||(_templateObject11=(0,_taggedTemplateLiteral2.default)([\"\",\".focus();\"])),this.autofocus.element_var));}}this.render_listeners();var properties={};var noop=x(_templateObject12||(_templateObject12=(0,_taggedTemplateLiteral2.default)([\"@noop\"])));properties.key=key;if(this.first){properties.first=x(_templateObject13||(_templateObject13=(0,_taggedTemplateLiteral2.default)([\"null\"])));this.chunks.hydrate.push(b(_templateObject14||(_templateObject14=(0,_taggedTemplateLiteral2.default)([\"this.first = \",\";\"])),this.first));}if(this.chunks.create.length===0&&this.chunks.hydrate.length===0){properties.create=noop;}else{var hydrate=this.chunks.hydrate.length>0&&(this.renderer.options.hydratable?b(_templateObject15||(_templateObject15=(0,_taggedTemplateLiteral2.default)([\"this.h();\"]))):this.chunks.hydrate);properties.create=x(_templateObject16||(_templateObject16=(0,_taggedTemplateLiteral2.default)([\"function #create() {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),this.chunks.create,hydrate);}if(this.renderer.options.hydratable||this.chunks.claim.length>0){if(this.chunks.claim.length===0&&this.chunks.hydrate.length===0){properties.claim=noop;}else{properties.claim=x(_templateObject17||(_templateObject17=(0,_taggedTemplateLiteral2.default)([\"function #claim(#nodes) {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\"])),this.chunks.claim,this.renderer.options.hydratable&&this.chunks.hydrate.length>0&&b(_templateObject18||(_templateObject18=(0,_taggedTemplateLiteral2.default)([\"this.h();\"]))));}}if(this.renderer.options.hydratable&&this.chunks.hydrate.length>0){properties.hydrate=x(_templateObject19||(_templateObject19=(0,_taggedTemplateLiteral2.default)([\"function #hydrate() {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),this.chunks.hydrate);}if(this.chunks.mount.length===0){properties.mount=noop;}else if(this.event_listeners.length===0){properties.mount=x(_templateObject20||(_templateObject20=(0,_taggedTemplateLiteral2.default)([\"function #mount(#target, #anchor) {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),this.chunks.mount);}else{properties.mount=x(_templateObject21||(_templateObject21=(0,_taggedTemplateLiteral2.default)([\"function #mount(#target, #anchor) {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),this.chunks.mount);}if(this.has_update_method||this.maintain_context){if(this.chunks.update.length===0&&!this.maintain_context){properties.update=noop;}else{var ctx=this.maintain_context?x(_templateObject22||(_templateObject22=(0,_taggedTemplateLiteral2.default)([\"#new_ctx\"]))):x(_templateObject23||(_templateObject23=(0,_taggedTemplateLiteral2.default)([\"#ctx\"])));var dirty={type:'Identifier',name:'#dirty'};if(!this.renderer.context_overflow&&!this.parent){dirty={type:'ArrayPattern',elements:[dirty]};}properties.update=x(_templateObject24||(_templateObject24=(0,_taggedTemplateLiteral2.default)([\"function #update(\",\", \",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\"])),ctx,dirty,this.maintain_context&&b(_templateObject25||(_templateObject25=(0,_taggedTemplateLiteral2.default)([\"#ctx = \",\";\"])),ctx),this.chunks.update);}}if(this.has_animation){properties.measure=x(_templateObject26||(_templateObject26=(0,_taggedTemplateLiteral2.default)([\"function #measure() {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),this.chunks.measure);properties.fix=x(_templateObject27||(_templateObject27=(0,_taggedTemplateLiteral2.default)([\"function #fix() {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),this.chunks.fix);properties.animate=x(_templateObject28||(_templateObject28=(0,_taggedTemplateLiteral2.default)([\"function #animate() {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),this.chunks.animate);}if(this.has_intro_method||this.has_outro_method){if(this.chunks.intro.length===0){properties.intro=noop;}else{properties.intro=x(_templateObject29||(_templateObject29=(0,_taggedTemplateLiteral2.default)([\"function #intro(#local) {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\"])),this.has_outros&&b(_templateObject30||(_templateObject30=(0,_taggedTemplateLiteral2.default)([\"if (#current) return;\"]))),this.chunks.intro);}if(this.chunks.outro.length===0){properties.outro=noop;}else{properties.outro=x(_templateObject31||(_templateObject31=(0,_taggedTemplateLiteral2.default)([\"function #outro(#local) {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\"])),this.chunks.outro);}}if(this.chunks.destroy.length===0){properties.destroy=noop;}else{properties.destroy=x(_templateObject32||(_templateObject32=(0,_taggedTemplateLiteral2.default)([\"function #destroy(detaching) {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),this.chunks.destroy);}if(!this.renderer.component.compile_options.dev){// allow shorthand names\nfor(var name in properties){var property=properties[name];if(property)property.id=null;}}var return_value=x(_templateObject33||(_templateObject33=(0,_taggedTemplateLiteral2.default)([\"{\\n\\t\\t\\tkey: \",\",\\n\\t\\t\\tfirst: \",\",\\n\\t\\t\\tc: \",\",\\n\\t\\t\\tl: \",\",\\n\\t\\t\\th: \",\",\\n\\t\\t\\tm: \",\",\\n\\t\\t\\tp: \",\",\\n\\t\\t\\tr: \",\",\\n\\t\\t\\tf: \",\",\\n\\t\\t\\ta: \",\",\\n\\t\\t\\ti: \",\",\\n\\t\\t\\to: \",\",\\n\\t\\t\\td: \",\"\\n\\t\\t}\"])),properties.key,properties.first,properties.create,properties.claim,properties.hydrate,properties.mount,properties.update,properties.measure,properties.fix,properties.animate,properties.intro,properties.outro,properties.destroy);var block=dev&&this.get_unique_name('block');var body=b(_templateObject34||(_templateObject34=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\"\\n\\n\\t\\t\\t\",\"\\n\\n\\t\\t\\t\",\"\\n\\n\\t\\t\\t\",\"\\n\\t\\t\"])),this.chunks.declarations,Array.from(this.variables.values()).map(function(_ref3){var id=_ref3.id,init=_ref3.init;return init?b(_templateObject35||(_templateObject35=(0,_taggedTemplateLiteral2.default)([\"let \",\" = \",\"\"])),id,init):b(_templateObject36||(_templateObject36=(0,_taggedTemplateLiteral2.default)([\"let \",\"\"])),id);}),this.chunks.init,dev?b(_templateObject37||(_templateObject37=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tconst \",\" = \",\";\\n\\t\\t\\t\\t\\t@dispatch_dev(\\\"SvelteRegisterBlock\\\", {\\n\\t\\t\\t\\t\\t\\tblock: \",\",\\n\\t\\t\\t\\t\\t\\tid: \",\".name,\\n\\t\\t\\t\\t\\t\\ttype: \\\"\",\"\\\",\\n\\t\\t\\t\\t\\t\\tsource: \\\"\",\"\\\",\\n\\t\\t\\t\\t\\t\\tctx: #ctx\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\treturn \",\";\"])),block,return_value,block,this.name||'create_fragment',this.type,this.comment?this.comment.replace(/\"/g,'\\\\\"'):'',block):b(_templateObject38||(_templateObject38=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\treturn \",\";\"])),return_value));return body;}},{key:\"has_content\",value:function has_content(){return!!this.first||this.event_listeners.length>0||this.chunks.intro.length>0||this.chunks.outro.length>0||this.chunks.create.length>0||this.chunks.hydrate.length>0||this.chunks.claim.length>0||this.chunks.mount.length>0||this.chunks.update.length>0||this.chunks.destroy.length>0||this.has_animation;}},{key:\"render\",value:function render(){var key=this.key&&this.get_unique_name('key');var args=[x(_templateObject39||(_templateObject39=(0,_taggedTemplateLiteral2.default)([\"#ctx\"])))];if(key)args.unshift(key);var fn=b(_templateObject40||(_templateObject40=(0,_taggedTemplateLiteral2.default)([\"function \",\"(\",\") {\\n\\t\\t\\t\",\"\\n\\t\\t}\"])),this.name,args,this.get_contents(key));return this.comment?b(_templateObject41||(_templateObject41=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t// \",\"\\n\\t\\t\\t\\t\",\"\"])),this.comment,fn):fn;}},{key:\"render_listeners\",value:function render_listeners(){var chunk=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';if(this.event_listeners.length>0){this.add_variable({type:'Identifier',name:'#mounted'});this.chunks.destroy.push(b(_templateObject42||(_templateObject42=(0,_taggedTemplateLiteral2.default)([\"#mounted = false\"]))));var dispose={type:'Identifier',name:\"#dispose\".concat(chunk)};this.add_variable(dispose);if(this.event_listeners.length===1){this.chunks.mount.push(b(_templateObject43||(_templateObject43=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (!#mounted) {\\n\\t\\t\\t\\t\\t\\t\\t\",\" = \",\";\\n\\t\\t\\t\\t\\t\\t\\t#mounted = true;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\"])),dispose,this.event_listeners[0]));this.chunks.destroy.push(b(_templateObject44||(_templateObject44=(0,_taggedTemplateLiteral2.default)([\"\",\"();\"])),dispose));}else{this.chunks.mount.push(b(_templateObject45||(_templateObject45=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (!#mounted) {\\n\\t\\t\\t\\t\\t\\t\",\" = [\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t];\\n\\t\\t\\t\\t\\t\\t#mounted = true;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),dispose,this.event_listeners));this.chunks.destroy.push(b(_templateObject46||(_templateObject46=(0,_taggedTemplateLiteral2.default)([\"@run_all(\",\");\"])),dispose));}}}}]);return Block$1;}();var Wrapper=/*#__PURE__*/function(){function Wrapper(renderer,block,parent,node){(0,_classCallCheck2.default)(this,Wrapper);this.node=node;// make these non-enumerable so that they can be logged sensibly\n// (TODO in dev only?)\nObject.defineProperties(this,{renderer:{value:renderer},parent:{value:parent}});this.can_use_innerhtml=!renderer.options.hydratable;this.is_static_content=!renderer.options.hydratable;block.wrappers.push(this);}(0,_createClass2.default)(Wrapper,[{key:\"cannot_use_innerhtml\",value:function cannot_use_innerhtml(){this.can_use_innerhtml=false;if(this.parent)this.parent.cannot_use_innerhtml();}},{key:\"not_static_content\",value:function not_static_content(){this.is_static_content=false;if(this.parent)this.parent.not_static_content();}},{key:\"get_or_create_anchor\",value:function get_or_create_anchor(block,parent_node,parent_nodes){// TODO use this in EachBlock and IfBlock — tricky because\n// children need to be created first\nvar needs_anchor=this.next?!this.next.is_dom_node():!parent_node||!this.parent.is_dom_node();var anchor=needs_anchor?block.get_unique_name(\"\".concat(this.var.name,\"_anchor\")):this.next&&this.next.var||{type:'Identifier',name:'null'};if(needs_anchor){block.add_element(anchor,x(_templateObject47||(_templateObject47=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),parent_nodes&&x(_templateObject48||(_templateObject48=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),parent_node);}return anchor;}},{key:\"get_update_mount_node\",value:function get_update_mount_node(anchor){return this.parent&&this.parent.is_dom_node()?this.parent.var:x(_templateObject49||(_templateObject49=(0,_taggedTemplateLiteral2.default)([\"\",\".parentNode\"])),anchor);}},{key:\"is_dom_node\",value:function is_dom_node(){return this.node.type==='Element'||this.node.type==='Text'||this.node.type==='MustacheTag';}},{key:\"render\",value:function render(_block,_parent_node,_parent_nodes){throw Error('Wrapper class is not renderable');}}]);return Wrapper;}();function create_debugging_comment(node,component){var locate=component.locate,source=component.source;var c=node.start;if(node.type==='ElseBlock'){while(source[c-1]!=='{'){c-=1;}while(source[c-1]==='{'){c-=1;}}var d;if(node.type==='InlineComponent'||node.type==='Element'||node.type==='SlotTemplate'){if(node.children.length){d=node.children[0].start;while(source[d-1]!=='>'){d-=1;}}else{d=node.start;while(source[d]!=='>'){d+=1;}d+=1;}}else if(node.type==='Text'||node.type==='Comment'){d=node.end;}else{// @ts-ignore\nd=node.expression?node.expression.node.end:c;while(source[d]!=='}'&&d<=source.length){d+=1;}while(source[d]==='}'){d+=1;}}var start=locate(c);var loc=\"(\".concat(start.line,\":\").concat(start.column,\")\");return\"\".concat(loc,\" \").concat(source.slice(c,d)).replace(/\\s/g,' ');}var Node$1=/*#__PURE__*/function(){function Node$1(component,parent,_scope,info){(0,_classCallCheck2.default)(this,Node$1);this.start=info.start;this.end=info.end;this.type=info.type;// this makes properties non-enumerable, which makes logging\n// bearable. might have a performance cost. TODO remove in prod?\nObject.defineProperties(this,{component:{value:component},parent:{value:parent}});}(0,_createClass2.default)(Node$1,[{key:\"cannot_use_innerhtml\",value:function cannot_use_innerhtml(){if(this.can_use_innerhtml!==false){this.can_use_innerhtml=false;if(this.parent)this.parent.cannot_use_innerhtml();}}},{key:\"find_nearest\",value:function find_nearest(selector){if(selector.test(this.type))return this;if(this.parent)return this.parent.find_nearest(selector);}},{key:\"get_static_attribute_value\",value:function get_static_attribute_value(name){var attribute=this.attributes&&this.attributes.find(function(attr){return attr.type==='Attribute'&&attr.name.toLowerCase()===name;});if(!attribute)return null;if(attribute.is_true)return true;if(attribute.chunks.length===0)return'';if(attribute.chunks.length===1&&attribute.chunks[0].type==='Text'){return attribute.chunks[0].data;}return null;}},{key:\"has_ancestor\",value:function has_ancestor(type){return this.parent?this.parent.type===type||this.parent.has_ancestor(type):false;}}]);return Node$1;}();// All compiler warnings should be listed and accessed from here\n/**\n * @internal\n */var compiler_warnings={custom_element_no_tag:{code:'custom-element-no-tag',message:'No custom element \\'tag\\' option was specified. To automatically register a custom element, specify a name with a hyphen in it, e.g. <svelte:options tag=\"my-thing\"/>. To hide this warning, use <svelte:options tag={null}/>'},unused_export_let:function unused_export_let(component,property){return{code:'unused-export-let',message:\"\".concat(component,\" has unused export property '\").concat(property,\"'. If it is for external reference only, please consider using `export const \").concat(property,\"`\")};},module_script_reactive_declaration:{code:'module-script-reactive-declaration',message:'$: has no effect in a module script'},non_top_level_reactive_declaration:{code:'non-top-level-reactive-declaration',message:'$: has no effect outside of the top-level'},module_script_variable_reactive_declaration:function module_script_variable_reactive_declaration(names){return{code:'module-script-reactive-declaration',message:\"\".concat(names.map(function(name){return\"\\\"\".concat(name,\"\\\"\");}).join(', '),\" \").concat(names.length>1?'are':'is',\" declared in a module script and will not be reactive\")};},missing_declaration:function missing_declaration(name,has_script){return{code:'missing-declaration',message:\"'\".concat(name,\"' is not defined\")+(has_script?'':\". Consider adding a <script> block with 'export let \".concat(name,\"' to declare a prop\"))};},missing_custom_element_compile_options:{code:'missing-custom-element-compile-options',message:\"The 'tag' option is used when generating a custom element. Did you forget the 'customElement: true' compile option?\"},css_unused_selector:function css_unused_selector(selector){return{code:'css-unused-selector',message:\"Unused CSS selector \\\"\".concat(selector,\"\\\"\")};},empty_block:{code:'empty-block',message:'Empty block'},reactive_component:function reactive_component(name){return{code:'reactive-component',message:\"<\".concat(name,\"/> will not be reactive if \").concat(name,\" changes. Use <svelte:component this={\").concat(name,\"}/> if you want this reactivity.\")};},component_name_lowercase:function component_name_lowercase(name){return{code:'component-name-lowercase',message:\"<\".concat(name,\"> will be treated as an HTML element unless it begins with a capital letter\")};},avoid_is:{code:'avoid-is',message:'The \\'is\\' attribute is not supported cross-browser and should be avoided'},invalid_html_attribute:function invalid_html_attribute(name,suggestion){return{code:'invalid-html-attribute',message:\"'\".concat(name,\"' is not a valid HTML attribute. Did you mean '\").concat(suggestion,\"'?\")};},a11y_aria_attributes:function a11y_aria_attributes(name){return{code:'a11y-aria-attributes',message:\"A11y: <\".concat(name,\"> should not have aria-* attributes\")};},a11y_unknown_aria_attribute:function a11y_unknown_aria_attribute(attribute,suggestion){return{code:'a11y-unknown-aria-attribute',message:\"A11y: Unknown aria attribute 'aria-\".concat(attribute,\"'\")+(suggestion?\" (did you mean '\".concat(suggestion,\"'?)\"):'')};},a11y_hidden:function a11y_hidden(name){return{code:'a11y-hidden',message:\"A11y: <\".concat(name,\"> element should not be hidden\")};},a11y_misplaced_role:function a11y_misplaced_role(name){return{code:'a11y-misplaced-role',message:\"A11y: <\".concat(name,\"> should not have role attribute\")};},a11y_unknown_role:function a11y_unknown_role(role,suggestion){return{code:'a11y-unknown-role',message:\"A11y: Unknown role '\".concat(role,\"'\")+(suggestion?\" (did you mean '\".concat(suggestion,\"'?)\"):'')};},a11y_no_redundant_roles:function a11y_no_redundant_roles(role){return{code:'a11y-no-redundant-roles',message:\"A11y: Redundant role '\".concat(role,\"'\")};},a11y_accesskey:{code:'a11y-accesskey',message:'A11y: Avoid using accesskey'},a11y_autofocus:{code:'a11y-autofocus',message:'A11y: Avoid using autofocus'},a11y_misplaced_scope:{code:'a11y-misplaced-scope',message:'A11y: The scope attribute should only be used with <th> elements'},a11y_positive_tabindex:{code:'a11y-positive-tabindex',message:'A11y: avoid tabindex values above zero'},a11y_invalid_attribute:function a11y_invalid_attribute(href_attribute,href_value){return{code:'a11y-invalid-attribute',message:\"A11y: '\".concat(href_value,\"' is not a valid \").concat(href_attribute,\" attribute\")};},a11y_missing_attribute:function a11y_missing_attribute(name,article,sequence){return{code:'a11y-missing-attribute',message:\"A11y: <\".concat(name,\"> element should have \").concat(article,\" \").concat(sequence,\" attribute\")};},a11y_img_redundant_alt:{code:'a11y-img-redundant-alt',message:'A11y: Screenreaders already announce <img> elements as an image.'},a11y_label_has_associated_control:{code:'a11y-label-has-associated-control',message:'A11y: A form label must be associated with a control.'},a11y_media_has_caption:{code:'a11y-media-has-caption',message:'A11y: <video> elements must have a <track kind=\"captions\">'},a11y_distracting_elements:function a11y_distracting_elements(name){return{code:'a11y-distracting-elements',message:\"A11y: Avoid <\".concat(name,\"> elements\")};},a11y_structure_immediate:{code:'a11y-structure',message:'A11y: <figcaption> must be an immediate child of <figure>'},a11y_structure_first_or_last:{code:'a11y-structure',message:'A11y: <figcaption> must be first or last child of <figure>'},a11y_mouse_events_have_key_events:function a11y_mouse_events_have_key_events(event,accompanied_by){return{code:'a11y-mouse-events-have-key-events',message:\"A11y: on:\".concat(event,\" must be accompanied by on:\").concat(accompanied_by)};},a11y_missing_content:function a11y_missing_content(name){return{code:'a11y-missing-content',message:\"A11y: <\".concat(name,\"> element should have child content\")};},redundant_event_modifier_for_touch:{code:'redundant-event-modifier',message:'Touch event handlers that don\\'t use the \\'event\\' object are passive by default'},redundant_event_modifier_passive:{code:'redundant-event-modifier',message:'The passive modifier only works with wheel and touch events'}};var AbstractBlock=/*#__PURE__*/function(_Node$){(0,_inherits2.default)(AbstractBlock,_Node$);var _super3=_createSuper(AbstractBlock);function AbstractBlock(component,parent,scope,info){(0,_classCallCheck2.default)(this,AbstractBlock);return _super3.call(this,component,parent,scope,info);}(0,_createClass2.default)(AbstractBlock,[{key:\"warn_if_empty_block\",value:function warn_if_empty_block(){if(!this.children||this.children.length>1)return;var child=this.children[0];if(!child||child.type==='Text'&&!/[^ \\r\\n\\f\\v\\t]/.test(child.data)){this.component.warn(this,compiler_warnings.empty_block);}}}]);return AbstractBlock;}(Node$1);function flatten_reference(node){var nodes=[];var parts=[];while(node.type==='MemberExpression'){nodes.unshift(node.property);if(!node.computed){parts.unshift(node.property.name);}else{var computed_property=to_string$1(node.property);if(computed_property){parts.unshift(\"[\".concat(computed_property,\"]\"));}}node=node.object;}var name=node.type==='Identifier'?node.name:node.type==='ThisExpression'?'this':null;nodes.unshift(node);parts.unshift(name);return{name:name,nodes:nodes,parts:parts};}function to_string$1(node){switch(node.type){case'Literal':return String(node.value);case'Identifier':return node.name;}}function create_scopes(expression){return analyze(expression);}function get_object(node){while(node.type==='MemberExpression'){node=node.object;}return node;}var reserved_keywords=new Set(['$$props','$$restProps','$$slots']);function is_reserved_keyword(name){return reserved_keywords.has(name);}function is_dynamic(variable){if(variable){if(variable.mutated||variable.reassigned)return true;// dynamic internal state\nif(!variable.module&&variable.writable&&variable.export_name)return true;// writable props\nif(is_reserved_keyword(variable.name))return true;}return false;}function nodes_match(a,b){if(!!a!==!!b)return false;if(Array.isArray(a)!==Array.isArray(b))return false;if(a&&(0,_typeof2.default)(a)==='object'){if(Array.isArray(a)){if(a.length!==b.length)return false;return a.every(function(child,i){return nodes_match(child,b[i]);});}var a_keys=Object.keys(a).sort();var b_keys=Object.keys(b).sort();if(a_keys.length!==b_keys.length)return false;var _i32=a_keys.length;while(_i32--){var key=a_keys[_i32];if(b_keys[_i32]!==key)return false;if(key==='start'||key==='end')continue;if(!nodes_match(a[key],b[key])){return false;}}return true;}return a===b;}function invalidate(renderer,scope,node,names){var main_execution_context=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var component=renderer.component;var _Array$from$filter$ma=Array.from(names).filter(function(name){var owner=scope.find_owner(name);return!owner||owner===component.instance_scope;}).map(function(name){return component.var_lookup.get(name);}).filter(function(variable){return variable&&!variable.hoistable&&!variable.global&&!variable.module&&(variable.referenced||variable.subscribable||variable.is_reactive_dependency||variable.export_name||variable.name[0]==='$');}),_Array$from$filter$ma2=(0,_toArray2.default)(_Array$from$filter$ma),head=_Array$from$filter$ma2[0],tail=_Array$from$filter$ma2.slice(1);function get_invalidated(variable,node){if(main_execution_context&&!variable.subscribable&&variable.name[0]!=='$'){return node;}return renderer_invalidate(renderer,variable.name,undefined,main_execution_context);}if(!head){return node;}component.has_reactive_assignments=true;if(node.type==='AssignmentExpression'&&node.operator==='='&&nodes_match(node.left,node.right)&&tail.length===0){return get_invalidated(head,node);}var is_store_value=head.name[0]==='$'&&head.name[1]!=='$';var extra_args=tail.map(function(variable){return get_invalidated(variable);}).filter(Boolean);if(is_store_value){return x(_templateObject50||(_templateObject50=(0,_taggedTemplateLiteral2.default)([\"@set_store_value(\",\", \",\", \",\", \",\")\"])),head.name.slice(1),node,head.name,extra_args);}var invalidate;if(!main_execution_context){var pass_value=extra_args.length>0||node.type==='AssignmentExpression'&&node.left.type!=='Identifier'||node.type==='UpdateExpression'&&(!node.prefix||node.argument.type!=='Identifier');if(pass_value){extra_args.unshift({type:'Identifier',name:head.name});}invalidate=x(_templateObject51||(_templateObject51=(0,_taggedTemplateLiteral2.default)([\"$$invalidate(\",\", \",\", \",\")\"])),renderer.context_lookup.get(head.name).index,node,extra_args);}else{// skip `$$invalidate` if it is in the main execution context\ninvalidate=extra_args.length?[node].concat((0,_toConsumableArray2.default)(extra_args)):node;}if(head.subscribable&&head.reassigned){var subscribe=\"$$subscribe_\".concat(head.name);invalidate=x(_templateObject52||(_templateObject52=(0,_taggedTemplateLiteral2.default)([\"\",\"(\",\")\"])),subscribe,invalidate);}return invalidate;}function renderer_invalidate(renderer,name,value){var main_execution_context=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var variable=renderer.component.var_lookup.get(name);if(variable&&variable.subscribable&&(variable.reassigned||variable.export_name)){if(main_execution_context){return x(_templateObject53||(_templateObject53=(0,_taggedTemplateLiteral2.default)([\"\",\"(\",\")\"])),\"$$subscribe_\".concat(name),value||name);}else{var member=renderer.context_lookup.get(name);return x(_templateObject54||(_templateObject54=(0,_taggedTemplateLiteral2.default)([\"\",\"($$invalidate(\",\", \",\"))\"])),\"$$subscribe_\".concat(name),member.index,value||name);}}if(name[0]==='$'&&name[1]!=='$'){return x(_templateObject55||(_templateObject55=(0,_taggedTemplateLiteral2.default)([\"\",\".set(\",\")\"])),name.slice(1),value||name);}if(variable&&(variable.module||!variable.referenced&&!variable.is_reactive_dependency&&!variable.export_name&&!name.startsWith('$$'))){return value||name;}if(value){if(main_execution_context){return x(_templateObject56||(_templateObject56=(0,_taggedTemplateLiteral2.default)([\"\",\"\"])),value);}else{var _member=renderer.context_lookup.get(name);return x(_templateObject57||(_templateObject57=(0,_taggedTemplateLiteral2.default)([\"$$invalidate(\",\", \",\")\"])),_member.index,value);}}if(main_execution_context)return;// if this is a reactive declaration, invalidate dependencies recursively\nvar deps=new Set([name]);deps.forEach(function(name){var reactive_declarations=renderer.component.reactive_declarations.filter(function(x){return x.assignees.has(name);});reactive_declarations.forEach(function(declaration){declaration.dependencies.forEach(function(name){deps.add(name);});});});// TODO ideally globals etc wouldn't be here in the first place\nvar filtered=Array.from(deps).filter(function(n){return renderer.context_lookup.has(n);});if(!filtered.length)return null;return filtered.map(function(n){return x(_templateObject58||(_templateObject58=(0,_taggedTemplateLiteral2.default)([\"$$invalidate(\",\", \",\")\"])),renderer.context_lookup.get(n).index,n);}).reduce(function(lhs,rhs){return x(_templateObject59||(_templateObject59=(0,_taggedTemplateLiteral2.default)([\"\",\", \",\"\"])),lhs,rhs);});}function replace_object(node,replacement){if(node.type==='Identifier')return replacement;var ancestor=node;var parent;while(node.type==='MemberExpression'){parent=node;node=node.object;}parent.object=replacement;return ancestor;}function is_contextual(component,scope,name){if(is_reserved_keyword(name))return true;// if it's a name below root scope, it's contextual\nif(!scope.is_top_level(name))return true;var variable=component.var_lookup.get(name);// hoistables, module declarations, and imports are non-contextual\nif(!variable||variable.hoistable)return false;// assume contextual\nreturn true;}// adapted from klona v2.0.4 - https://github.com/lukeed/klona\n// (c) Luke Edwards, under MIT License\n// The sole modification is to skip function values in objects when cloning, so we don't break tests.\nfunction clone(val){var k,out,tmp;if(Array.isArray(val)){out=Array(k=val.length);while(k--){out[k]=(tmp=val[k])&&(0,_typeof2.default)(tmp)==='object'?clone(tmp):tmp;}return out;}if(Object.prototype.toString.call(val)==='[object Object]'){out={};// null\nfor(k in val){if(k==='__proto__'){Object.defineProperty(out,k,{value:clone(val[k]),configurable:true,enumerable:true,writable:true});}else if(typeof val[k]!=='function'){// MODIFICATION: skip functions\nout[k]=(tmp=val[k])&&(0,_typeof2.default)(tmp)==='object'?clone(tmp):tmp;}}return out;}return val;}// All compiler errors should be listed and accessed from here\n/**\n * @internal\n */var compiler_errors={invalid_binding_elements:function invalid_binding_elements(element,binding){return{code:'invalid-binding',message:\"'\".concat(binding,\"' is not a valid binding on <\").concat(element,\"> elements\")};},invalid_binding_element_with:function invalid_binding_element_with(elements,binding){return{code:'invalid-binding',message:\"'\".concat(binding,\"' binding can only be used with \").concat(elements)};},invalid_binding_on:function invalid_binding_on(binding,element,post){return{code:'invalid-binding',message:\"'\".concat(binding,\"' is not a valid binding on \").concat(element)+(post||'')};},invalid_binding_foreign:function invalid_binding_foreign(binding){return{code:'invalid-binding',message:\"'\".concat(binding,\"' is not a valid binding. Foreign elements only support bind:this\")};},invalid_binding_no_checkbox:function invalid_binding_no_checkbox(binding,is_radio){return{code:'invalid-binding',message:\"'\".concat(binding,\"' binding can only be used with <input type=\\\"checkbox\\\">\")+(is_radio?' — for <input type=\"radio\">, use \\'group\\' binding':'')};},invalid_binding:function invalid_binding(binding){return{code:'invalid-binding',message:\"'\".concat(binding,\"' is not a valid binding\")};},invalid_binding_window:function invalid_binding_window(parts){return{code:'invalid-binding',message:\"Bindings on <svelte:window> must be to top-level properties, e.g. '\".concat(parts[parts.length-1],\"' rather than '\").concat(parts.join('.'),\"'\")};},invalid_binding_let:{code:'invalid-binding',message:'Cannot bind to a variable declared with the let: directive'},invalid_binding_await:{code:'invalid-binding',message:'Cannot bind to a variable declared with {#await ... then} or {:catch} blocks'},invalid_binding_const:{code:'invalid-binding',message:'Cannot bind to a variable declared with {@const ...}'},invalid_binding_writibale:{code:'invalid-binding',message:'Cannot bind to a variable which is not writable'},binding_undeclared:function binding_undeclared(name){return{code:'binding-undeclared',message:\"\".concat(name,\" is not declared\")};},invalid_type:{code:'invalid-type',message:'\\'type\\' attribute cannot be dynamic if input uses two-way binding'},missing_type:{code:'missing-type',message:'\\'type\\' attribute must be specified'},dynamic_multiple_attribute:{code:'dynamic-multiple-attribute',message:'\\'multiple\\' attribute cannot be dynamic if select uses two-way binding'},missing_contenteditable_attribute:{code:'missing-contenteditable-attribute',message:'\\'contenteditable\\' attribute is required for textContent and innerHTML two-way bindings'},dynamic_contenteditable_attribute:{code:'dynamic-contenteditable-attribute',message:'\\'contenteditable\\' attribute cannot be dynamic if element uses two-way binding'},invalid_event_modifier_combination:function invalid_event_modifier_combination(modifier1,modifier2){return{code:'invalid-event-modifier',message:\"The '\".concat(modifier1,\"' and '\").concat(modifier2,\"' modifiers cannot be used together\")};},invalid_event_modifier_legacy:function invalid_event_modifier_legacy(modifier){return{code:'invalid-event-modifier',message:\"The '\".concat(modifier,\"' modifier cannot be used in legacy mode\")};},invalid_event_modifier:function invalid_event_modifier(valid){return{code:'invalid-event-modifier',message:\"Valid event modifiers are \".concat(valid)};},invalid_event_modifier_component:{code:'invalid-event-modifier',message:\"Event modifiers other than 'once' can only be used on DOM elements\"},textarea_duplicate_value:{code:'textarea-duplicate-value',message:'A <textarea> can have either a value attribute or (equivalently) child content, but not both'},illegal_attribute:function illegal_attribute(name){return{code:'illegal-attribute',message:\"'\".concat(name,\"' is not a valid attribute name\")};},invalid_slot_attribute:{code:'invalid-slot-attribute',message:'slot attribute cannot have a dynamic value'},duplicate_slot_attribute:function duplicate_slot_attribute(name){return{code:'duplicate-slot-attribute',message:\"Duplicate '\".concat(name,\"' slot\")};},invalid_slotted_content:{code:'invalid-slotted-content',message:'Element with a slot=\\'...\\' attribute must be a child of a component or a descendant of a custom element'},invalid_attribute_head:{code:'invalid-attribute',message:'<svelte:head> should not have any attributes or directives'},invalid_action:{code:'invalid-action',message:'Actions can only be applied to DOM elements, not components'},invalid_class:{code:'invalid-class',message:'Classes can only be applied to DOM elements, not components'},invalid_transition:{code:'invalid-transition',message:'Transitions can only be applied to DOM elements, not components'},invalid_let:{code:'invalid-let',message:'let directive value must be an identifier or an object/array pattern'},invalid_slot_directive:{code:'invalid-slot-directive',message:'<slot> cannot have directives'},dynamic_slot_name:{code:'dynamic-slot-name',message:'<slot> name cannot be dynamic'},invalid_slot_name:{code:'invalid-slot-name',message:'default is a reserved word — it cannot be used as a slot name'},invalid_slot_attribute_value_missing:{code:'invalid-slot-attribute',message:'slot attribute value is missing'},invalid_slotted_content_fragment:{code:'invalid-slotted-content',message:'<svelte:fragment> must be a child of a component'},illegal_attribute_title:{code:'illegal-attribute',message:'<title> cannot have attributes'},illegal_structure_title:{code:'illegal-structure',message:'<title> can only contain text and {tags}'},duplicate_transition:function duplicate_transition(directive,parent_directive){function describe(_directive){return _directive==='transition'?\"a 'transition'\":\"an '\".concat(_directive,\"'\");}var message=directive===parent_directive?\"An element can only have one '\".concat(directive,\"' directive\"):\"An element cannot have both \".concat(describe(parent_directive),\" directive and \").concat(describe(directive),\" directive\");return{code:'duplicate-transition',message:message};},contextual_store:{code:'contextual-store',message:'Stores must be declared at the top level of the component (this may change in a future version of Svelte)'},default_export:{code:'default-export',message:'A component cannot have a default export'},illegal_declaration:{code:'illegal-declaration',message:'The $ prefix is reserved, and cannot be used for variable and import names'},illegal_subscription:{code:'illegal-subscription',message:'Cannot reference store value inside <script context=\"module\">'},illegal_global:function illegal_global(name){return{code:'illegal-global',message:\"\".concat(name,\" is an illegal variable name\")};},cyclical_reactive_declaration:function cyclical_reactive_declaration(cycle){return{code:'cyclical-reactive-declaration',message:\"Cyclical dependency detected: \".concat(cycle.join(' → '))};},invalid_tag_property:{code:'invalid-tag-property',message:\"tag name must be two or more words joined by the '-' character\"},invalid_tag_attribute:{code:'invalid-tag-attribute',message:\"'tag' must be a string literal\"},invalid_namespace_property:function invalid_namespace_property(namespace,suggestion){return{code:'invalid-namespace-property',message:\"Invalid namespace '\".concat(namespace,\"'\")+(suggestion?\" (did you mean '\".concat(suggestion,\"'?)\"):'')};},invalid_namespace_attribute:{code:'invalid-namespace-attribute',message:\"The 'namespace' attribute must be a string literal representing a valid namespace\"},invalid_attribute_value:function invalid_attribute_value(name){return{code:\"invalid-\".concat(name,\"-value\"),message:\"\".concat(name,\" attribute must be true or false\")};},invalid_options_attribute_unknown:{code:'invalid-options-attribute',message:'<svelte:options> unknown attribute'},invalid_options_attribute:{code:'invalid-options-attribute',message:\"<svelte:options> can only have static 'tag', 'namespace', 'accessors', 'immutable' and 'preserveWhitespace' attributes\"},css_invalid_global:{code:'css-invalid-global',message:':global(...) can be at the start or end of a selector sequence, but not in the middle'},css_invalid_global_selector:{code:'css-invalid-global-selector',message:':global(...) must contain a single selector'},duplicate_animation:{code:'duplicate-animation',message:\"An element can only have one 'animate' directive\"},invalid_animation_immediate:{code:'invalid-animation',message:'An element that uses the animate directive must be the immediate child of a keyed each block'},invalid_animation_sole:{code:'invalid-animation',message:'An element that uses the animate directive must be the sole child of a keyed each block'},invalid_directive_value:{code:'invalid-directive-value',message:'Can only bind to an identifier (e.g. `foo`) or a member expression (e.g. `foo.bar` or `foo[baz]`)'},invalid_const_placement:{code:'invalid-const-placement',message:'{@const} must be the immediate child of {#each}, {:then}, {:catch}, <svelte:fragment> or <Component>'},invalid_const_declaration:function invalid_const_declaration(name){return{code:'invalid-const-declaration',message:\"'\".concat(name,\"' has already been declared\")};},invalid_const_update:function invalid_const_update(name){return{code:'invalid-const-update',message:\"'\".concat(name,\"' is declared using {@const ...} and is read-only\")};},cyclical_const_tags:function cyclical_const_tags(cycle){return{code:'cyclical-const-tags',message:\"Cyclical dependency detected: \".concat(cycle.join(' → '))};}};var Expression=/*#__PURE__*/function(){function Expression(component,owner,template_scope,info,lazy){(0,_classCallCheck2.default)(this,Expression);this.type='Expression';this.references=new Set();this.dependencies=new Set();this.contextual_dependencies=new Set();this.declarations=[];this.uses_context=false;// TODO revert to direct property access in prod?\nObject.defineProperties(this,{component:{value:component}});this.node=info;this.template_scope=template_scope;this.owner=owner;var dependencies=this.dependencies,contextual_dependencies=this.contextual_dependencies,references=this.references;var _create_scopes=create_scopes(info),map=_create_scopes.map,scope=_create_scopes.scope;this.scope=scope;this.scope_map=map;var expression=this;var function_expression;// discover dependencies, but don't change the code yet\nwalk(info,{enter:function enter(node,parent,key){// don't manipulate shorthand props twice\nif(key==='key'&&parent.shorthand)return;// don't manipulate `import.meta`, `new.target`\nif(node.type==='MetaProperty')return this.skip();if(map.has(node)){scope=map.get(node);}if(!function_expression&&/FunctionExpression/.test(node.type)){function_expression=node;}if(is_reference(node,parent)){var _flatten_reference=flatten_reference(node),name=_flatten_reference.name,nodes=_flatten_reference.nodes;references.add(name);if(scope.has(name))return;if(name[0]==='$'){var store_name=name.slice(1);if(template_scope.names.has(store_name)||scope.has(store_name)){return component.error(node,compiler_errors.contextual_store);}}if(template_scope.is_let(name)){if(!function_expression){// TODO should this be `!lazy` ?\ncontextual_dependencies.add(name);dependencies.add(name);}}else if(template_scope.names.has(name)){expression.uses_context=true;contextual_dependencies.add(name);var _owner=template_scope.get_owner(name);var is_index=_owner.type==='EachBlock'&&_owner.key&&name===_owner.index;if(!lazy||is_index){template_scope.dependencies_for_name.get(name).forEach(function(name){return dependencies.add(name);});}}else{if(!lazy){dependencies.add(name);}component.add_reference(name);component.warn_if_undefined(name,nodes[0],template_scope);}this.skip();}// track any assignments from template expressions as mutable\nvar names;var deep=false;if(function_expression){if(node.type==='AssignmentExpression'){deep=node.left.type==='MemberExpression';names=extract_names(deep?get_object(node.left):node.left);}else if(node.type==='UpdateExpression'){names=extract_names(get_object(node.argument));}}if(names){names.forEach(function(name){if(template_scope.names.has(name)){if(template_scope.is_const(name)){component.error(node,compiler_errors.invalid_const_update(name));}template_scope.dependencies_for_name.get(name).forEach(function(name){var variable=component.var_lookup.get(name);if(variable)variable[deep?'mutated':'reassigned']=true;});var each_block=template_scope.get_owner(name);each_block.has_binding=true;}else{component.add_reference(name);var variable=component.var_lookup.get(name);if(variable)variable[deep?'mutated':'reassigned']=true;}});}},leave:function leave(node){if(map.has(node)){scope=scope.parent;}if(node===function_expression){function_expression=null;}}});}(0,_createClass2.default)(Expression,[{key:\"dynamic_dependencies\",value:function dynamic_dependencies(){var _this7=this;return Array.from(this.dependencies).filter(function(name){if(_this7.template_scope.is_let(name))return true;if(is_reserved_keyword(name))return true;var variable=_this7.component.var_lookup.get(name);return is_dynamic(variable);});}// TODO move this into a render-dom wrapper?\n},{key:\"manipulate\",value:function manipulate(block,ctx){// TODO ideally we wouldn't end up calling this method\n// multiple times\nif(this.manipulated)return this.manipulated;var component=this.component,declarations=this.declarations,map=this.scope_map,template_scope=this.template_scope,owner=this.owner;var scope=this.scope;var function_expression;var dependencies;var contextual_dependencies;var node=walk(this.node,{enter:function enter(node,parent){if(node.type==='Property'&&node.shorthand){node.value=clone(node.value);node.shorthand=false;}if(map.has(node)){scope=map.get(node);}if(node.type==='Identifier'&&is_reference(node,parent)){var _flatten_reference2=flatten_reference(node),name=_flatten_reference2.name;if(scope.has(name))return;if(function_expression){if(template_scope.names.has(name)){contextual_dependencies.add(name);template_scope.dependencies_for_name.get(name).forEach(function(dependency){dependencies.add(dependency);});}else{dependencies.add(name);component.add_reference(name);// TODO is this redundant/misplaced?\n}}else if(is_contextual(component,template_scope,name)){var reference=block.renderer.reference(node,ctx);this.replace(reference);}this.skip();}if(!function_expression){if(node.type==='AssignmentExpression');if(node.type==='FunctionExpression'||node.type==='ArrowFunctionExpression'){function_expression=node;dependencies=new Set();contextual_dependencies=new Set();}}},leave:function leave(node,parent){if(map.has(node))scope=scope.parent;if(node===function_expression){var _id=component.get_unique_name(sanitize(get_function_name(node,owner)));var declaration=b(_templateObject60||(_templateObject60=(0,_taggedTemplateLiteral2.default)([\"const \",\" = \",\"\"])),_id,node);if(dependencies.size===0&&contextual_dependencies.size===0){// we can hoist this out of the component completely\ncomponent.fully_hoisted.push(declaration);this.replace(_id);component.add_var({name:_id.name,internal:true,hoistable:true,referenced:true});}else if(contextual_dependencies.size===0){// function can be hoisted inside the component init\ncomponent.partly_hoisted.push(declaration);block.renderer.add_to_context(_id.name);this.replace(block.renderer.reference(_id));}else{// we need a combo block/init recipe\nvar deps=Array.from(contextual_dependencies);var _function_expression=node;var has_args=_function_expression.params.length>0;_function_expression.params=[].concat((0,_toConsumableArray2.default)(deps.map(function(name){return{type:'Identifier',name:name};})),(0,_toConsumableArray2.default)(_function_expression.params));var context_args=deps.map(function(name){return block.renderer.reference(name);});component.partly_hoisted.push(declaration);block.renderer.add_to_context(_id.name);var callee=block.renderer.reference(_id);this.replace(_id);var func_declaration=has_args?b(_templateObject61||(_templateObject61=(0,_taggedTemplateLiteral2.default)([\"function \",\"(...args) {\\n\\t\\t\\t\\t\\t\\t\\t\\treturn \",\"(\",\", ...args);\\n\\t\\t\\t\\t\\t\\t\\t}\"])),_id,callee,context_args):b(_templateObject62||(_templateObject62=(0,_taggedTemplateLiteral2.default)([\"function \",\"() {\\n\\t\\t\\t\\t\\t\\t\\t\\treturn \",\"(\",\");\\n\\t\\t\\t\\t\\t\\t\\t}\"])),_id,callee,context_args);if(owner.type==='Attribute'&&owner.parent.name==='slot'){var dep_scopes=new Set(deps.map(function(name){return template_scope.get_owner(name);}));// find the nearest scopes\nvar _node7=owner.parent;while(_node7&&!dep_scopes.has(_node7)){_node7=_node7.parent;}var func_expression=func_declaration[0];if(_node7.type==='InlineComponent'){// <Comp let:data />\nthis.replace(func_expression);}else{// {#each}, {#await}\nvar func_id=component.get_unique_name(_id.name+'_func');block.renderer.add_to_context(func_id.name,true);// rename #ctx -> child_ctx;\nwalk(func_expression,{enter:function enter(node){if(node.type==='Identifier'&&node.name==='#ctx'){node.name='child_ctx';}}});// add to get_xxx_context\n// child_ctx[x] = function () { ... }\ntemplate_scope.get_owner(deps[0]).contexts.push({key:func_id,modifier:function modifier(){return func_expression;},default_modifier:function default_modifier(node){return node;}});this.replace(block.renderer.reference(func_id));}}else{declarations.push(func_declaration);}}function_expression=null;dependencies=null;contextual_dependencies=null;if(parent&&parent.type==='Property'){parent.method=false;}}if(node.type==='AssignmentExpression'||node.type==='UpdateExpression'){var assignee=node.type==='AssignmentExpression'?node.left:node.argument;var object_name=get_object(assignee).name;if(scope.has(object_name))return;// normally (`a = 1`, `b.c = 2`), there'll be a single name\n// (a or b). In destructuring cases (`[d, e] = [e, d]`) there\n// may be more, in which case we need to tack the extra ones\n// onto the initial function call\nvar _names=new Set(extract_names(assignee));var traced=new Set();_names.forEach(function(name){var dependencies=template_scope.dependencies_for_name.get(name);if(dependencies){dependencies.forEach(function(name){return traced.add(name);});}else{traced.add(name);}});var context=block.bindings.get(object_name);if(context){// for `{#each array as item}`\n// replace `item = 1` to `each_array[each_index] = 1`, this allow us to mutate the array\n// rather than mutating the local `item` variable\nvar snippet=context.snippet,object=context.object,property=context.property;var replaced=replace_object(assignee,snippet);if(node.type==='AssignmentExpression'){node.left=replaced;}else{node.argument=replaced;}contextual_dependencies.add(object.name);contextual_dependencies.add(property.name);}this.replace(invalidate(block.renderer,scope,node,traced));}}});if(declarations.length>0){block.maintain_context=true;declarations.forEach(function(declaration){block.chunks.init.push(declaration);});}return this.manipulated=node;}}]);return Expression;}();function get_function_name(_node,parent){if(parent.type==='EventHandler'){return\"\".concat(parent.name,\"_handler\");}if(parent.type==='Action'){return\"\".concat(parent.name,\"_function\");}return'func';}function unpack_destructuring(_ref4){var contexts=_ref4.contexts,node=_ref4.node,_ref4$modifier=_ref4.modifier,_modifier=_ref4$modifier===void 0?function(node){return node;}:_ref4$modifier,_ref4$default_modifie=_ref4.default_modifier,default_modifier=_ref4$default_modifie===void 0?function(node){return node;}:_ref4$default_modifie,scope=_ref4.scope,component=_ref4.component;if(!node)return;if(node.type==='Identifier'){contexts.push({key:node,modifier:_modifier,default_modifier:default_modifier});}else if(node.type==='RestElement'){contexts.push({key:node.argument,modifier:_modifier,default_modifier:default_modifier});}else if(node.type==='ArrayPattern'){node.elements.forEach(function(element,i){if(element&&element.type==='RestElement'){unpack_destructuring({contexts:contexts,node:element,modifier:function modifier(node){return x(_templateObject63||(_templateObject63=(0,_taggedTemplateLiteral2.default)([\"\",\".slice(\",\")\"])),_modifier(node),i);},default_modifier:default_modifier,scope:scope,component:component});}else if(element&&element.type==='AssignmentPattern'){var _n=contexts.length;mark_referenced(element.right,scope,component);unpack_destructuring({contexts:contexts,node:element.left,modifier:function modifier(node){return x(_templateObject64||(_templateObject64=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),_modifier(node),i);},default_modifier:function default_modifier(node,to_ctx){return x(_templateObject65||(_templateObject65=(0,_taggedTemplateLiteral2.default)([\"\",\" !== undefined ? \",\" : \",\"\"])),node,node,update_reference(contexts,_n,element.right,to_ctx));},scope:scope,component:component});}else{unpack_destructuring({contexts:contexts,node:element,modifier:function modifier(node){return x(_templateObject66||(_templateObject66=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),_modifier(node),i);},default_modifier:default_modifier,scope:scope,component:component});}});}else if(node.type==='ObjectPattern'){var used_properties=[];node.properties.forEach(function(property){if(property.type==='RestElement'){unpack_destructuring({contexts:contexts,node:property.argument,modifier:function modifier(node){return x(_templateObject67||(_templateObject67=(0,_taggedTemplateLiteral2.default)([\"@object_without_properties(\",\", [\",\"])\"])),_modifier(node),used_properties);},default_modifier:default_modifier,scope:scope,component:component});}else{var key=property.key;var _value6=property.value;used_properties.push(x(_templateObject68||(_templateObject68=(0,_taggedTemplateLiteral2.default)([\"\\\"\",\"\\\"\"])),key.name));if(_value6.type==='AssignmentPattern'){var _n2=contexts.length;mark_referenced(_value6.right,scope,component);unpack_destructuring({contexts:contexts,node:_value6.left,modifier:function modifier(node){return x(_templateObject69||(_templateObject69=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\"\"])),_modifier(node),key.name);},default_modifier:function default_modifier(node,to_ctx){return x(_templateObject70||(_templateObject70=(0,_taggedTemplateLiteral2.default)([\"\",\" !== undefined ? \",\" : \",\"\"])),node,node,update_reference(contexts,_n2,_value6.right,to_ctx));},scope:scope,component:component});}else{unpack_destructuring({contexts:contexts,node:_value6,modifier:function modifier(node){return x(_templateObject71||(_templateObject71=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\"\"])),_modifier(node),key.name);},default_modifier:default_modifier,scope:scope,component:component});}}});}}function update_reference(contexts,n,expression,to_ctx){var find_from_context=function find_from_context(node){for(var _i33=n;_i33<contexts.length;_i33++){var key=contexts[_i33].key;if(node.name===key.name){throw new Error(\"Cannot access '\".concat(node.name,\"' before initialization\"));}}return to_ctx(node.name);};if(expression.type==='Identifier'){return find_from_context(expression);}// NOTE: avoid unnecessary deep clone?\nexpression=clone(expression);walk(expression,{enter:function enter(node,parent){if(is_reference(node,parent)){this.replace(find_from_context(node));this.skip();}}});return expression;}function mark_referenced(node,scope,component){walk(node,{enter:function enter(node,parent){if(is_reference(node,parent)){var _flatten_reference3=flatten_reference(node),name=_flatten_reference3.name;if(!scope.is_let(name)&&!scope.names.has(name)){component.add_reference(name);}}}});}var allowed_parents=new Set(['EachBlock','CatchBlock','ThenBlock','InlineComponent','SlotTemplate']);var ConstTag=/*#__PURE__*/function(_Node$2){(0,_inherits2.default)(ConstTag,_Node$2);var _super4=_createSuper(ConstTag);function ConstTag(component,parent,scope,info){var _this8;(0,_classCallCheck2.default)(this,ConstTag);_this8=_super4.call(this,component,parent,scope,info);_this8.contexts=[];_this8.assignees=new Set();_this8.dependencies=new Set();if(!allowed_parents.has(parent.type)){component.error(info,compiler_errors.invalid_const_placement);}_this8.node=info;_this8.scope=scope;var _assertThisInitialize=(0,_assertThisInitialized2.default)(_this8),assignees=_assertThisInitialize.assignees,dependencies=_assertThisInitialize.dependencies;extract_identifiers(info.expression.left).forEach(function(_ref5){var name=_ref5.name;assignees.add(name);var owner=_this8.scope.get_owner(name);if(owner===parent){component.error(info,compiler_errors.invalid_const_declaration(name));}});walk(info.expression.right,{enter:function enter(node,parent){if(is_reference(node,parent)){var identifier=get_object(node);var name=identifier.name;dependencies.add(name);}}});return _this8;}(0,_createClass2.default)(ConstTag,[{key:\"parse_expression\",value:function parse_expression(){var _this9=this;unpack_destructuring({contexts:this.contexts,node:this.node.expression.left,scope:this.scope,component:this.component});this.expression=new Expression(this.component,this,this.scope,this.node.expression.right);this.contexts.forEach(function(context){var owner=_this9.scope.get_owner(context.key.name);if(owner&&owner.type==='ConstTag'&&owner.parent===_this9.parent){_this9.component.error(_this9.node,compiler_errors.invalid_const_declaration(context.key.name));}_this9.scope.add(context.key.name,_this9.expression.dependencies,_this9);});}}]);return ConstTag;}(Node$1);var PendingBlock=/*#__PURE__*/function(_AbstractBlock){(0,_inherits2.default)(PendingBlock,_AbstractBlock);var _super5=_createSuper(PendingBlock);function PendingBlock(component,parent,scope,info){var _this10;(0,_classCallCheck2.default)(this,PendingBlock);_this10=_super5.call(this,component,parent,scope,info);_this10.children=map_children(component,parent,scope,info.children);if(!info.skip){_this10.warn_if_empty_block();}return _this10;}return(0,_createClass2.default)(PendingBlock);}(AbstractBlock);var CatchBlock=/*#__PURE__*/function(_AbstractBlock2){(0,_inherits2.default)(CatchBlock,_AbstractBlock2);var _super6=_createSuper(CatchBlock);function CatchBlock(component,parent,scope,info){var _this11;(0,_classCallCheck2.default)(this,CatchBlock);_this11=_super6.call(this,component,parent,scope,info);_this11.scope=scope.child();if(parent.catch_node){parent.catch_contexts.forEach(function(context){_this11.scope.add(context.key.name,parent.expression.dependencies,(0,_assertThisInitialized2.default)(_this11));});}var _get_const_tags=get_const_tags(info.children,component,(0,_assertThisInitialized2.default)(_this11),parent);var _get_const_tags2=(0,_slicedToArray2.default)(_get_const_tags,2);_this11.const_tags=_get_const_tags2[0];_this11.children=_get_const_tags2[1];if(!info.skip){_this11.warn_if_empty_block();}return _this11;}return(0,_createClass2.default)(CatchBlock);}(AbstractBlock);var AwaitBlock=/*#__PURE__*/function(_Node$3){(0,_inherits2.default)(AwaitBlock,_Node$3);var _super7=_createSuper(AwaitBlock);function AwaitBlock(component,parent,scope,info){var _this12;(0,_classCallCheck2.default)(this,AwaitBlock);_this12=_super7.call(this,component,parent,scope,info);_this12.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this12),scope,info.expression);_this12.then_node=info.value;_this12.catch_node=info.error;if(_this12.then_node){_this12.then_contexts=[];unpack_destructuring({contexts:_this12.then_contexts,node:info.value,scope:scope,component:component});}if(_this12.catch_node){_this12.catch_contexts=[];unpack_destructuring({contexts:_this12.catch_contexts,node:info.error,scope:scope,component:component});}_this12.pending=new PendingBlock(component,(0,_assertThisInitialized2.default)(_this12),scope,info.pending);_this12.then=new ThenBlock(component,(0,_assertThisInitialized2.default)(_this12),scope,info.then);_this12.catch=new CatchBlock(component,(0,_assertThisInitialized2.default)(_this12),scope,info.catch);return _this12;}return(0,_createClass2.default)(AwaitBlock);}(Node$1);var EventHandler=/*#__PURE__*/function(_Node$4){(0,_inherits2.default)(EventHandler,_Node$4);var _super8=_createSuper(EventHandler);function EventHandler(component,parent,template_scope,info){var _this13;(0,_classCallCheck2.default)(this,EventHandler);_this13=_super8.call(this,component,parent,template_scope,info);_this13.uses_context=false;_this13.can_make_passive=false;_this13.name=info.name;_this13.modifiers=new Set(info.modifiers);if(info.expression){_this13.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this13),template_scope,info.expression);_this13.uses_context=_this13.expression.uses_context;if(/FunctionExpression/.test(info.expression.type)&&info.expression.params.length===0){// TODO make this detection more accurate — if `event.preventDefault` isn't called, and\n// `event` is passed to another function, we can make it passive\n_this13.can_make_passive=true;}else if(info.expression.type==='Identifier'){var _node8=component.node_for_declaration.get(info.expression.name);if(_node8){if(_node8.type==='VariableDeclaration'){// for `const handleClick = () => {...}`, we want the [arrow] function expression node\nvar declarator=_node8.declarations.find(function(d){return d.id.name===info.expression.name;});_node8=declarator&&declarator.init;}if(_node8&&(_node8.type==='FunctionExpression'||_node8.type==='FunctionDeclaration'||_node8.type==='ArrowFunctionExpression')&&_node8.params.length===0){_this13.can_make_passive=true;}}}}else{_this13.handler_name=component.get_unique_name(\"\".concat(sanitize(_this13.name),\"_handler\"));}return _this13;}(0,_createClass2.default)(EventHandler,[{key:\"reassigned\",get:function get(){if(!this.expression){return false;}var node=this.expression.node;if(/FunctionExpression/.test(node.type)){return false;}return this.expression.dynamic_dependencies().length>0;}}]);return EventHandler;}(Node$1);var Action=/*#__PURE__*/function(_Node$5){(0,_inherits2.default)(Action,_Node$5);var _super9=_createSuper(Action);function Action(component,parent,scope,info){var _this14;(0,_classCallCheck2.default)(this,Action);_this14=_super9.call(this,component,parent,scope,info);var object=info.name.split('.')[0];component.warn_if_undefined(object,info,scope);_this14.name=info.name;component.add_reference(object);_this14.expression=info.expression?new Expression(component,(0,_assertThisInitialized2.default)(_this14),scope,info.expression):null;_this14.template_scope=scope;_this14.uses_context=_this14.expression&&_this14.expression.uses_context;return _this14;}return(0,_createClass2.default)(Action);}(Node$1);var Body=/*#__PURE__*/function(_Node$6){(0,_inherits2.default)(Body,_Node$6);var _super10=_createSuper(Body);function Body(component,parent,scope,info){var _this15;(0,_classCallCheck2.default)(this,Body);_this15=_super10.call(this,component,parent,scope,info);_this15.handlers=[];_this15.actions=[];info.attributes.forEach(function(node){if(node.type==='EventHandler'){_this15.handlers.push(new EventHandler(component,(0,_assertThisInitialized2.default)(_this15),scope,node));}else if(node.type==='Action'){_this15.actions.push(new Action(component,(0,_assertThisInitialized2.default)(_this15),scope,node));}});return _this15;}return(0,_createClass2.default)(Body);}(Node$1);var Comment$1=/*#__PURE__*/function(_Node$7){(0,_inherits2.default)(Comment$1,_Node$7);var _super11=_createSuper(Comment$1);function Comment$1(component,parent,scope,info){var _this16;(0,_classCallCheck2.default)(this,Comment$1);_this16=_super11.call(this,component,parent,scope,info);_this16.data=info.data;_this16.ignores=info.ignores;return _this16;}return(0,_createClass2.default)(Comment$1);}(Node$1);var ElseBlock=/*#__PURE__*/function(_AbstractBlock3){(0,_inherits2.default)(ElseBlock,_AbstractBlock3);var _super12=_createSuper(ElseBlock);function ElseBlock(component,parent,scope,info){var _this17;(0,_classCallCheck2.default)(this,ElseBlock);_this17=_super12.call(this,component,parent,scope,info);_this17.children=map_children(component,(0,_assertThisInitialized2.default)(_this17),scope,info.children);_this17.warn_if_empty_block();return _this17;}return(0,_createClass2.default)(ElseBlock);}(AbstractBlock);var EachBlock=/*#__PURE__*/function(_AbstractBlock4){(0,_inherits2.default)(EachBlock,_AbstractBlock4);var _super13=_createSuper(EachBlock);function EachBlock(component,parent,scope,info){var _this18;(0,_classCallCheck2.default)(this,EachBlock);_this18=_super13.call(this,component,parent,scope,info);_this18.has_binding=false;_this18.has_index_binding=false;_this18.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this18),scope,info.expression);_this18.context=info.context.name||'each';// TODO this is used to facilitate binding; currently fails with destructuring\n_this18.context_node=info.context;_this18.index=info.index;_this18.scope=scope.child();_this18.contexts=[];unpack_destructuring({contexts:_this18.contexts,node:info.context,scope:scope,component:component});_this18.contexts.forEach(function(context){_this18.scope.add(context.key.name,_this18.expression.dependencies,(0,_assertThisInitialized2.default)(_this18));});if(_this18.index){// index can only change if this is a keyed each block\nvar dependencies=info.key?_this18.expression.dependencies:new Set([]);_this18.scope.add(_this18.index,dependencies,(0,_assertThisInitialized2.default)(_this18));}_this18.key=info.key?new Expression(component,(0,_assertThisInitialized2.default)(_this18),_this18.scope,info.key):null;_this18.has_animation=false;var _get_const_tags3=get_const_tags(info.children,component,(0,_assertThisInitialized2.default)(_this18),(0,_assertThisInitialized2.default)(_this18));var _get_const_tags4=(0,_slicedToArray2.default)(_get_const_tags3,2);_this18.const_tags=_get_const_tags4[0];_this18.children=_get_const_tags4[1];if(_this18.has_animation){if(_this18.children.length!==1){var child=_this18.children.find(function(child){return!!child.animation;});component.error(child.animation,compiler_errors.invalid_animation_sole);return(0,_possibleConstructorReturn2.default)(_this18);}}_this18.warn_if_empty_block();_this18.else=info.else?new ElseBlock(component,(0,_assertThisInitialized2.default)(_this18),_this18.scope,info.else):null;return _this18;}return(0,_createClass2.default)(EachBlock);}(AbstractBlock);function string_literal(data){return{type:'Literal',value:data};}var escaped={'\"':'&quot;',\"'\":'&#39;','&':'&amp;','<':'&lt;','>':'&gt;'};function escape_html(html){return String(html).replace(/[\"'&<>]/g,function(match){return escaped[match];});}function escape_template(str){return str.replace(/(\\${|`|\\\\)/g,'\\\\$1');}function add_to_set(a,b){// @ts-ignore\nb.forEach(function(item){a.add(item);});}var Attribute=/*#__PURE__*/function(_Node$8){(0,_inherits2.default)(Attribute,_Node$8);var _super14=_createSuper(Attribute);function Attribute(component,parent,scope,info){var _this19;(0,_classCallCheck2.default)(this,Attribute);_this19=_super14.call(this,component,parent,scope,info);_this19.scope=scope;if(info.type==='Spread'){_this19.name=null;_this19.is_spread=true;_this19.is_true=false;_this19.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this19),scope,info.expression);_this19.dependencies=_this19.expression.dependencies;_this19.chunks=null;_this19.is_static=false;}else{_this19.name=info.name;_this19.is_true=info.value===true;_this19.is_static=true;_this19.dependencies=new Set();_this19.chunks=_this19.is_true?[]:info.value.map(function(node){if(node.type==='Text')return node;_this19.is_static=false;var expression=new Expression(component,(0,_assertThisInitialized2.default)(_this19),scope,node.expression);add_to_set(_this19.dependencies,expression.dependencies);return expression;});}return _this19;}(0,_createClass2.default)(Attribute,[{key:\"get_dependencies\",value:function get_dependencies(){if(this.is_spread)return this.expression.dynamic_dependencies();var dependencies=new Set();this.chunks.forEach(function(chunk){if(chunk.type==='Expression'){add_to_set(dependencies,chunk.dynamic_dependencies());}});return Array.from(dependencies);}},{key:\"get_value\",value:function get_value(block){if(this.is_true)return x(_templateObject72||(_templateObject72=(0,_taggedTemplateLiteral2.default)([\"true\"])));if(this.chunks.length===0)return x(_templateObject73||(_templateObject73=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\"\"])));if(this.chunks.length===1){return this.chunks[0].type==='Text'?string_literal(this.chunks[0].data):this.chunks[0].manipulate(block);}var expression=this.chunks.map(function(chunk){return chunk.type==='Text'?string_literal(chunk.data):chunk.manipulate(block);}).reduce(function(lhs,rhs){return x(_templateObject74||(_templateObject74=(0,_taggedTemplateLiteral2.default)([\"\",\" + \",\"\"])),lhs,rhs);});if(this.chunks[0].type!=='Text'){expression=x(_templateObject75||(_templateObject75=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\" + \",\"\"])),expression);}return expression;}},{key:\"get_static_value\",value:function get_static_value(){if(!this.is_static)return null;return this.is_true?true:this.chunks[0]// method should be called only when `is_static = true`\n?this.chunks[0].data:'';}},{key:\"should_cache\",value:function should_cache(){return this.is_static?false:this.chunks.length===1// @ts-ignore todo: probably error\n?this.chunks[0].node.type!=='Identifier'||this.scope.names.has(this.chunks[0].node.name):true;}}]);return Attribute;}(Node$1);// TODO this should live in a specific binding\nvar read_only_media_attributes=new Set(['duration','buffered','seekable','played','seeking','ended','videoHeight','videoWidth']);var Binding=/*#__PURE__*/function(_Node$9){(0,_inherits2.default)(Binding,_Node$9);var _super15=_createSuper(Binding);function Binding(component,parent,scope,info){var _this20;(0,_classCallCheck2.default)(this,Binding);_this20=_super15.call(this,component,parent,scope,info);if(info.expression.type!=='Identifier'&&info.expression.type!=='MemberExpression'){component.error(info,compiler_errors.invalid_directive_value);return(0,_possibleConstructorReturn2.default)(_this20);}_this20.name=info.name;_this20.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this20),scope,info.expression);_this20.raw_expression=clone(info.expression);var _get_object=get_object(_this20.expression.node),name=_get_object.name;_this20.is_contextual=Array.from(_this20.expression.references).some(function(name){return scope.names.has(name);});// make sure we track this as a mutable ref\nif(scope.is_let(name)){component.error((0,_assertThisInitialized2.default)(_this20),compiler_errors.invalid_binding_let);return(0,_possibleConstructorReturn2.default)(_this20);}else if(scope.names.has(name)){if(scope.is_await(name)){component.error((0,_assertThisInitialized2.default)(_this20),compiler_errors.invalid_binding_await);return(0,_possibleConstructorReturn2.default)(_this20);}if(scope.is_const(name)){component.error((0,_assertThisInitialized2.default)(_this20),compiler_errors.invalid_binding_const);}scope.dependencies_for_name.get(name).forEach(function(name){var variable=component.var_lookup.get(name);if(variable){variable.mutated=true;}});}else{var variable=component.var_lookup.get(name);if(!variable||variable.global){component.error(_this20.expression.node,compiler_errors.binding_undeclared(name));return(0,_possibleConstructorReturn2.default)(_this20);}variable[_this20.expression.node.type==='MemberExpression'?'mutated':'reassigned']=true;if(info.expression.type==='Identifier'&&!variable.writable){component.error(_this20.expression.node,compiler_errors.invalid_binding_writibale);return(0,_possibleConstructorReturn2.default)(_this20);}}var type=parent.get_static_attribute_value('type');_this20.is_readonly=dimensions.test(_this20.name)||isElement(parent)&&(parent.is_media_node()&&read_only_media_attributes.has(_this20.name)||parent.name==='input'&&type==='file')/* TODO others? */;return _this20;}(0,_createClass2.default)(Binding,[{key:\"is_readonly_media_attribute\",value:function is_readonly_media_attribute(){return read_only_media_attributes.has(this.name);}}]);return Binding;}(Node$1);function isElement(node){return!!node.is_media_node;}var Transition=/*#__PURE__*/function(_Node$10){(0,_inherits2.default)(Transition,_Node$10);var _super16=_createSuper(Transition);function Transition(component,parent,scope,info){var _this21;(0,_classCallCheck2.default)(this,Transition);_this21=_super16.call(this,component,parent,scope,info);component.warn_if_undefined(info.name,info,scope);_this21.name=info.name;component.add_reference(info.name.split('.')[0]);_this21.directive=info.intro&&info.outro?'transition':info.intro?'in':'out';_this21.is_local=info.modifiers.includes('local');if(info.intro&&parent.intro||info.outro&&parent.outro){var parent_transition=parent.intro||parent.outro;component.error(info,compiler_errors.duplicate_transition(_this21.directive,parent_transition.directive));return(0,_possibleConstructorReturn2.default)(_this21);}_this21.expression=info.expression?new Expression(component,(0,_assertThisInitialized2.default)(_this21),scope,info.expression):null;return _this21;}return(0,_createClass2.default)(Transition);}(Node$1);var Animation=/*#__PURE__*/function(_Node$11){(0,_inherits2.default)(Animation,_Node$11);var _super17=_createSuper(Animation);function Animation(component,parent,scope,info){var _this22;(0,_classCallCheck2.default)(this,Animation);_this22=_super17.call(this,component,parent,scope,info);component.warn_if_undefined(info.name,info,scope);_this22.name=info.name;component.add_reference(info.name.split('.')[0]);if(parent.animation){component.error((0,_assertThisInitialized2.default)(_this22),compiler_errors.duplicate_animation);return(0,_possibleConstructorReturn2.default)(_this22);}var block=parent.parent;if(!block||block.type!=='EachBlock'||!block.key){// TODO can we relax the 'immediate child' rule?\ncomponent.error((0,_assertThisInitialized2.default)(_this22),compiler_errors.invalid_animation_immediate);return(0,_possibleConstructorReturn2.default)(_this22);}block.has_animation=true;_this22.expression=info.expression?new Expression(component,(0,_assertThisInitialized2.default)(_this22),scope,info.expression,true):null;return _this22;}return(0,_createClass2.default)(Animation);}(Node$1);var Class=/*#__PURE__*/function(_Node$12){(0,_inherits2.default)(Class,_Node$12);var _super18=_createSuper(Class);function Class(component,parent,scope,info){var _this23;(0,_classCallCheck2.default)(this,Class);_this23=_super18.call(this,component,parent,scope,info);_this23.name=info.name;_this23.expression=info.expression?new Expression(component,(0,_assertThisInitialized2.default)(_this23),scope,info.expression):null;return _this23;}return(0,_createClass2.default)(Class);}(Node$1);/**\n * Transforms a list of Text and MustacheTags into a TemplateLiteral expression.\n * Start/End positions on the elements of the expression are not set.\n */function nodes_to_template_literal(value){var literal={type:'TemplateLiteral',expressions:[],quasis:[]};var quasi={type:'TemplateElement',value:{raw:'',cooked:null},tail:false};value.forEach(function(node){if(node.type==='Text'){quasi.value.raw+=node.raw;}else if(node.type==='MustacheTag'){literal.quasis.push(quasi);literal.expressions.push(node.expression);quasi={type:'TemplateElement',value:{raw:'',cooked:null},tail:false};}});quasi.tail=true;literal.quasis.push(quasi);return literal;}var StyleDirective=/*#__PURE__*/function(_Node$13){(0,_inherits2.default)(StyleDirective,_Node$13);var _super19=_createSuper(StyleDirective);function StyleDirective(component,parent,scope,info){var _this24;(0,_classCallCheck2.default)(this,StyleDirective);_this24=_super19.call(this,component,parent,scope,info);_this24.name=info.name;// Convert the value array to an expression so it's easier to handle\n// the StyleDirective going forward.\nif(info.value===true||info.value.length===1&&info.value[0].type==='MustacheTag'){var identifier=info.value===true?{type:'Identifier',start:info.end-info.name.length,end:info.end,name:info.name}:info.value[0].expression;_this24.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this24),scope,identifier);_this24.should_cache=false;}else{var raw_expression=nodes_to_template_literal(info.value);_this24.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this24),scope,raw_expression);_this24.should_cache=raw_expression.expressions.length>0;}return _this24;}return(0,_createClass2.default)(StyleDirective);}(Node$1);// Whitespace inside one of these elements will not result in\n// a whitespace node being created in any circumstances. (This\n// list is almost certainly very incomplete)\nvar elements_without_text=new Set(['audio','datalist','dl','optgroup','select','video']);var Text=/*#__PURE__*/function(_Node$14){(0,_inherits2.default)(Text,_Node$14);var _super20=_createSuper(Text);function Text(component,parent,scope,info){var _this25;(0,_classCallCheck2.default)(this,Text);_this25=_super20.call(this,component,parent,scope,info);_this25.data=info.data;_this25.synthetic=info.synthetic||false;return _this25;}(0,_createClass2.default)(Text,[{key:\"should_skip\",value:function should_skip(){if(/\\S/.test(this.data))return false;var parent_element=this.find_nearest(/(?:Element|InlineComponent|SlotTemplate|Head)/);if(!parent_element)return false;if(parent_element.type==='Head')return true;if(parent_element.type==='InlineComponent')return parent_element.children.length===1&&this===parent_element.children[0];// svg namespace exclusions\nif(/svg$/.test(parent_element.namespace)){if(this.prev&&this.prev.type==='Element'&&this.prev.name==='tspan')return false;}return parent_element.namespace||elements_without_text.has(parent_element.name);}}]);return Text;}(Node$1);// The `foreign` namespace covers all DOM implementations that aren't HTML5.\n// It opts out of HTML5-specific a11y checks and case-insensitive attribute names.\nvar foreign='https://svelte.dev/docs#template-syntax-svelte-options';var html='http://www.w3.org/1999/xhtml';var mathml='http://www.w3.org/1998/Math/MathML';var svg='http://www.w3.org/2000/svg';var xlink='http://www.w3.org/1999/xlink';var xml='http://www.w3.org/XML/1998/namespace';var xmlns='http://www.w3.org/2000/xmlns';var valid_namespaces=['foreign','html','mathml','svg','xlink','xml','xmlns',foreign,html,mathml,svg,xlink,xml,xmlns];var namespaces={foreign:foreign,html:html,mathml:mathml,svg:svg,xlink:xlink,xml:xml,xmlns:xmlns};var applicable=new Set(['Identifier','ObjectExpression','ArrayExpression','Property']);var Let=/*#__PURE__*/function(_Node$15){(0,_inherits2.default)(Let,_Node$15);var _super21=_createSuper(Let);function Let(component,parent,scope,info){var _this26;(0,_classCallCheck2.default)(this,Let);_this26=_super21.call(this,component,parent,scope,info);_this26.names=[];_this26.name={type:'Identifier',name:info.name};var _assertThisInitialize2=(0,_assertThisInitialized2.default)(_this26),names=_assertThisInitialize2.names;if(info.expression){_this26.value=info.expression;walk(info.expression,{enter:function enter(node){if(!applicable.has(node.type)){return component.error(node,compiler_errors.invalid_let);}if(node.type==='Identifier'){names.push(node.name);}// slightly unfortunate hack\nif(node.type==='ArrayExpression'){node.type='ArrayPattern';}if(node.type==='ObjectExpression'){node.type='ObjectPattern';}}});}else{names.push(_this26.name.name);}return _this26;}return(0,_createClass2.default)(Let);}(Node$1);var svg$1=/^(?:altGlyph|altGlyphDef|altGlyphItem|animate|animateColor|animateMotion|animateTransform|circle|clipPath|color-profile|cursor|defs|desc|discard|ellipse|feBlend|feColorMatrix|feComponentTransfer|feComposite|feConvolveMatrix|feDiffuseLighting|feDisplacementMap|feDistantLight|feDropShadow|feFlood|feFuncA|feFuncB|feFuncG|feFuncR|feGaussianBlur|feImage|feMerge|feMergeNode|feMorphology|feOffset|fePointLight|feSpecularLighting|feSpotLight|feTile|feTurbulence|filter|font|font-face|font-face-format|font-face-name|font-face-src|font-face-uri|foreignObject|g|glyph|glyphRef|hatch|hatchpath|hkern|image|line|linearGradient|marker|mask|mesh|meshgradient|meshpatch|meshrow|metadata|missing-glyph|mpath|path|pattern|polygon|polyline|radialGradient|rect|set|solidcolor|stop|svg|switch|symbol|text|textPath|tref|tspan|unknown|use|view|vkern)$/;var aria_attributes='activedescendant atomic autocomplete busy checked colcount colindex colspan controls current describedby details disabled dropeffect errormessage expanded flowto grabbed haspopup hidden invalid keyshortcuts label labelledby level live modal multiline multiselectable orientation owns placeholder posinset pressed readonly relevant required roledescription rowcount rowindex rowspan selected setsize sort valuemax valuemin valuenow valuetext'.split(' ');var aria_attribute_set=new Set(aria_attributes);var aria_roles='alert alertdialog application article banner blockquote button caption cell checkbox code columnheader combobox complementary contentinfo definition deletion dialog directory document emphasis feed figure form generic graphics-document graphics-object graphics-symbol grid gridcell group heading img link list listbox listitem log main marquee math meter menu menubar menuitem menuitemcheckbox menuitemradio navigation none note option paragraph presentation progressbar radio radiogroup region row rowgroup rowheader scrollbar search searchbox separator slider spinbutton status strong subscript superscript switch tab table tablist tabpanel term textbox time timer toolbar tooltip tree treegrid treeitem'.split(' ');var aria_role_set=new Set(aria_roles);var a11y_required_attributes={a:['href'],area:['alt','aria-label','aria-labelledby'],// html-has-lang\nhtml:['lang'],// iframe-has-title\niframe:['title'],img:['alt'],object:['title','aria-label','aria-labelledby']};var a11y_distracting_elements=new Set(['blink','marquee']);var a11y_required_content=new Set([// anchor-has-content\n'a',// heading-has-content\n'h1','h2','h3','h4','h5','h6']);var a11y_labelable=new Set(['button','input','keygen','meter','output','progress','select','textarea']);var a11y_nested_implicit_semantics=new Map([['header','banner'],['footer','contentinfo']]);var a11y_implicit_semantics=new Map([['a','link'],['aside','complementary'],['body','document'],['datalist','listbox'],['dd','definition'],['dfn','term'],['details','group'],['dt','term'],['fieldset','group'],['form','form'],['h1','heading'],['h2','heading'],['h3','heading'],['h4','heading'],['h5','heading'],['h6','heading'],['hr','separator'],['li','listitem'],['menu','list'],['nav','navigation'],['ol','list'],['optgroup','group'],['output','status'],['progress','progressbar'],['section','region'],['summary','button'],['tbody','rowgroup'],['textarea','textbox'],['tfoot','rowgroup'],['thead','rowgroup'],['tr','row'],['ul','list']]);var invisible_elements=new Set(['meta','html','script','style']);var valid_modifiers=new Set(['preventDefault','stopPropagation','capture','once','passive','nonpassive','self','trusted']);var passive_events=new Set(['wheel','touchstart','touchmove','touchend','touchcancel']);var react_attributes=new Map([['className','class'],['htmlFor','for']]);var attributes_to_compact_whitespace=['class','style'];function is_parent(parent,elements){var check=false;while(parent){var parent_name=parent.name;if(elements.includes(parent_name)){check=true;break;}if(parent.type==='Element'){break;}parent=parent.parent;}return check;}function get_namespace(parent,element,explicit_namespace){var parent_element=parent.find_nearest(/^Element/);if(!parent_element){return explicit_namespace||(svg$1.test(element.name)?namespaces.svg:null);}if(parent_element.namespace!==namespaces.foreign){if(svg$1.test(element.name.toLowerCase()))return namespaces.svg;if(parent_element.name.toLowerCase()==='foreignobject')return null;}return parent_element.namespace;}var Element=/*#__PURE__*/function(_Node$16){(0,_inherits2.default)(Element,_Node$16);var _super22=_createSuper(Element);function Element(component,parent,scope,info){var _this27;(0,_classCallCheck2.default)(this,Element);_this27=_super22.call(this,component,parent,scope,info);_this27.attributes=[];_this27.actions=[];_this27.bindings=[];_this27.classes=[];_this27.styles=[];_this27.handlers=[];_this27.lets=[];_this27.intro=null;_this27.outro=null;_this27.animation=null;_this27.name=info.name;_this27.namespace=get_namespace(parent,(0,_assertThisInitialized2.default)(_this27),component.namespace);if(_this27.namespace!==namespaces.foreign){if(_this27.name==='textarea'){if(info.children.length>0){var value_attribute=info.attributes.find(function(node){return node.name==='value';});if(value_attribute){component.error(value_attribute,compiler_errors.textarea_duplicate_value);return(0,_possibleConstructorReturn2.default)(_this27);}// this is an egregious hack, but it's the easiest way to get <textarea>\n// children treated the same way as a value attribute\ninfo.attributes.push({type:'Attribute',name:'value',value:info.children});info.children=[];}}if(_this27.name==='option'){// Special case — treat these the same way:\n//   <option>{foo}</option>\n//   <option value={foo}>{foo}</option>\nvar _value_attribute=info.attributes.find(function(attribute){return attribute.name==='value';});if(!_value_attribute){info.attributes.push({type:'Attribute',name:'value',value:info.children,synthetic:true});}}}var has_let=info.attributes.some(function(node){return node.type==='Let';});if(has_let){scope=scope.child();}// Binding relies on Attribute, defer its evaluation\nvar order=['Binding'];// everything else is -1\ninfo.attributes.sort(function(a,b){return order.indexOf(a.type)-order.indexOf(b.type);});info.attributes.forEach(function(node){switch(node.type){case'Action':_this27.actions.push(new Action(component,(0,_assertThisInitialized2.default)(_this27),scope,node));break;case'Attribute':case'Spread':// special case\nif(node.name==='xmlns')_this27.namespace=node.value[0].data;_this27.attributes.push(new Attribute(component,(0,_assertThisInitialized2.default)(_this27),scope,node));break;case'Binding':_this27.bindings.push(new Binding(component,(0,_assertThisInitialized2.default)(_this27),scope,node));break;case'Class':_this27.classes.push(new Class(component,(0,_assertThisInitialized2.default)(_this27),scope,node));break;case'StyleDirective':_this27.styles.push(new StyleDirective(component,(0,_assertThisInitialized2.default)(_this27),scope,node));break;case'EventHandler':_this27.handlers.push(new EventHandler(component,(0,_assertThisInitialized2.default)(_this27),scope,node));break;case'Let':{var l=new Let(component,(0,_assertThisInitialized2.default)(_this27),scope,node);_this27.lets.push(l);var dependencies=new Set([l.name.name]);l.names.forEach(function(name){scope.add(name,dependencies,(0,_assertThisInitialized2.default)(_this27));});break;}case'Transition':{var transition=new Transition(component,(0,_assertThisInitialized2.default)(_this27),scope,node);if(node.intro)_this27.intro=transition;if(node.outro)_this27.outro=transition;break;}case'Animation':_this27.animation=new Animation(component,(0,_assertThisInitialized2.default)(_this27),scope,node);break;default:throw new Error(\"Not implemented: \".concat(node.type));}});_this27.scope=scope;_this27.children=map_children(component,(0,_assertThisInitialized2.default)(_this27),_this27.scope,info.children);_this27.validate();_this27.optimise();component.apply_stylesheet((0,_assertThisInitialized2.default)(_this27));return _this27;}(0,_createClass2.default)(Element,[{key:\"validate\",value:function validate(){if(this.component.var_lookup.has(this.name)&&this.component.var_lookup.get(this.name).imported){this.component.warn(this,compiler_warnings.component_name_lowercase(this.name));}this.validate_attributes();this.validate_event_handlers();if(this.namespace===namespaces.foreign){this.validate_bindings_foreign();}else{this.validate_attributes_a11y();this.validate_special_cases();this.validate_bindings();this.validate_content();}}},{key:\"validate_attributes\",value:function validate_attributes(){var _this28=this;var component=this.component,parent=this.parent;this.attributes.forEach(function(attribute){if(attribute.is_spread)return;var name=attribute.name.toLowerCase();// Errors\nif(/(^[0-9-.])|[\\^$@%&#?!|()[\\]{}^*+~;]/.test(name)){return component.error(attribute,compiler_errors.illegal_attribute(name));}if(name==='slot'){if(!attribute.is_static){return component.error(attribute,compiler_errors.invalid_slot_attribute);}if(component.slot_outlets.has(name)){return component.error(attribute,compiler_errors.duplicate_slot_attribute(name));// this code was unreachable. Still needed?\n// component.slot_outlets.add(name);\n}if(!(parent.type==='SlotTemplate'||within_custom_element(parent))){return component.error(attribute,compiler_errors.invalid_slotted_content);}}// Warnings\nif(_this28.namespace!==namespaces.foreign){if(name==='is'){component.warn(attribute,compiler_warnings.avoid_is);}if(react_attributes.has(attribute.name)){component.warn(attribute,compiler_warnings.invalid_html_attribute(attribute.name,react_attributes.get(attribute.name)));}}});}},{key:\"validate_attributes_a11y\",value:function validate_attributes_a11y(){var _this29=this;var component=this.component;this.attributes.forEach(function(attribute){if(attribute.is_spread)return;var name=attribute.name.toLowerCase();// aria-props\nif(name.startsWith('aria-')){if(invisible_elements.has(_this29.name)){// aria-unsupported-elements\ncomponent.warn(attribute,compiler_warnings.a11y_aria_attributes(_this29.name));}var type=name.slice(5);if(!aria_attribute_set.has(type)){var match=fuzzymatch(type,aria_attributes);component.warn(attribute,compiler_warnings.a11y_unknown_aria_attribute(type,match));}if(name==='aria-hidden'&&/^h[1-6]$/.test(_this29.name)){component.warn(attribute,compiler_warnings.a11y_hidden(_this29.name));}}// aria-role\nif(name==='role'){if(invisible_elements.has(_this29.name)){// aria-unsupported-elements\ncomponent.warn(attribute,compiler_warnings.a11y_misplaced_role(_this29.name));}var _value7=attribute.get_static_value();// @ts-ignore\nif(_value7&&!aria_role_set.has(_value7)){// @ts-ignore\nvar _match=fuzzymatch(_value7,aria_roles);component.warn(attribute,compiler_warnings.a11y_unknown_role(_value7,_match));}// no-redundant-roles\nvar has_redundant_role=_value7===a11y_implicit_semantics.get(_this29.name);if(_this29.name===_value7||has_redundant_role){component.warn(attribute,compiler_warnings.a11y_no_redundant_roles(_value7));}// Footers and headers are special cases, and should not have redundant roles unless they are the children of sections or articles.\nvar is_parent_section_or_article=is_parent(_this29.parent,['section','article']);if(!is_parent_section_or_article){var has_nested_redundant_role=_value7===a11y_nested_implicit_semantics.get(_this29.name);if(has_nested_redundant_role){component.warn(attribute,compiler_warnings.a11y_no_redundant_roles(_value7));}}}// no-access-key\nif(name==='accesskey'){component.warn(attribute,compiler_warnings.a11y_accesskey);}// no-autofocus\nif(name==='autofocus'){component.warn(attribute,compiler_warnings.a11y_autofocus);}// scope\nif(name==='scope'&&_this29.name!=='th'){component.warn(attribute,compiler_warnings.a11y_misplaced_scope);}// tabindex-no-positive\nif(name==='tabindex'){var _value8=attribute.get_static_value();// @ts-ignore todo is tabindex=true correct case?\nif(!isNaN(_value8)&&+_value8>0){component.warn(attribute,compiler_warnings.a11y_positive_tabindex);}}});}},{key:\"validate_special_cases\",value:function validate_special_cases(){var component=this.component,attributes=this.attributes,handlers=this.handlers;var attribute_map=new Map();var handlers_map=new Map();attributes.forEach(function(attribute){return attribute_map.set(attribute.name,attribute);});handlers.forEach(function(handler){return handlers_map.set(handler.name,handler);});if(this.name==='a'){var href_attribute=attribute_map.get('href')||attribute_map.get('xlink:href');var id_attribute=attribute_map.get('id');var name_attribute=attribute_map.get('name');if(href_attribute){var href_value=href_attribute.get_static_value();if(href_value===''||href_value==='#'||/^\\W*javascript:/i.test(href_value)){component.warn(href_attribute,compiler_warnings.a11y_invalid_attribute(href_attribute.name,href_value));}}else{var id_attribute_valid=id_attribute&&id_attribute.get_static_value()!=='';var name_attribute_valid=name_attribute&&name_attribute.get_static_value()!=='';if(!id_attribute_valid&&!name_attribute_valid){component.warn(this,compiler_warnings.a11y_missing_attribute('a','an','href'));}}}else{var required_attributes=a11y_required_attributes[this.name];if(required_attributes){var has_attribute=required_attributes.some(function(name){return attribute_map.has(name);});if(!has_attribute){should_have_attribute(this,required_attributes);}}}if(this.name==='input'){var type=attribute_map.get('type');if(type&&type.get_static_value()==='image'){var _required_attributes=['alt','aria-label','aria-labelledby'];var _has_attribute=_required_attributes.some(function(name){return attribute_map.has(name);});if(!_has_attribute){should_have_attribute(this,_required_attributes,'input type=\"image\"');}}}if(this.name==='img'){var alt_attribute=attribute_map.get('alt');var aria_hidden_attribute=attribute_map.get('aria-hidden');var aria_hidden_exist=aria_hidden_attribute&&aria_hidden_attribute.get_static_value();if(alt_attribute&&!aria_hidden_exist){var alt_value=alt_attribute.get_static_value();if(/\\b(image|picture|photo)\\b/i.test(alt_value)){component.warn(this,compiler_warnings.a11y_img_redundant_alt);}}}if(this.name==='label'){var has_input_child=this.children.some(function(i){return i instanceof Element&&a11y_labelable.has(i.name);});if(!attribute_map.has('for')&&!has_input_child){component.warn(this,compiler_warnings.a11y_label_has_associated_control);}}if(this.name==='video'){if(attribute_map.has('muted')){return;}var has_caption;var track=this.children.find(function(i){return i.name==='track';});if(track){has_caption=track.attributes.find(function(a){return a.name==='kind'&&a.get_static_value()==='captions';});}if(!has_caption){component.warn(this,compiler_warnings.a11y_media_has_caption);}}if(a11y_distracting_elements.has(this.name)){// no-distracting-elements\ncomponent.warn(this,compiler_warnings.a11y_distracting_elements(this.name));}if(this.name==='figcaption'){var parent=this.parent;var is_figure_parent=false;while(parent){if(parent.name==='figure'){is_figure_parent=true;break;}if(parent.type==='Element'){break;}parent=parent.parent;}if(!is_figure_parent){component.warn(this,compiler_warnings.a11y_structure_immediate);}}if(this.name==='figure'){var children=this.children.filter(function(node){if(node.type==='Comment')return false;if(node.type==='Text')return /\\S/.test(node.data);return true;});var index=children.findIndex(function(child){return child.name==='figcaption';});if(index!==-1&&index!==0&&index!==children.length-1){component.warn(children[index],compiler_warnings.a11y_structure_first_or_last);}}if(handlers_map.has('mouseover')&&!handlers_map.has('focus')){component.warn(this,compiler_warnings.a11y_mouse_events_have_key_events('mouseover','focus'));}if(handlers_map.has('mouseout')&&!handlers_map.has('blur')){component.warn(this,compiler_warnings.a11y_mouse_events_have_key_events('mouseout','blur'));}}},{key:\"validate_bindings_foreign\",value:function validate_bindings_foreign(){var _this30=this;this.bindings.forEach(function(binding){if(binding.name!=='this'){return _this30.component.error(binding,compiler_errors.invalid_binding_foreign(binding.name));}});}},{key:\"validate_bindings\",value:function validate_bindings(){var _this31=this;var component=this.component;var check_type_attribute=function check_type_attribute(){var attribute=_this31.attributes.find(function(attribute){return attribute.name==='type';});if(!attribute)return null;if(!attribute.is_static){return component.error(attribute,compiler_errors.invalid_type);}var value=attribute.get_static_value();if(value===true){return component.error(attribute,compiler_errors.missing_type);}return value;};this.bindings.forEach(function(binding){var name=binding.name;if(name==='value'){if(_this31.name!=='input'&&_this31.name!=='textarea'&&_this31.name!=='select'){return component.error(binding,compiler_errors.invalid_binding_elements(_this31.name,'value'));}if(_this31.name==='select'){var attribute=_this31.attributes.find(function(attribute){return attribute.name==='multiple';});if(attribute&&!attribute.is_static){return component.error(attribute,compiler_errors.dynamic_multiple_attribute);}}else{check_type_attribute();}}else if(name==='checked'||name==='indeterminate'){if(_this31.name!=='input'){return component.error(binding,compiler_errors.invalid_binding_elements(_this31.name,name));}var type=check_type_attribute();if(type!=='checkbox'){return component.error(binding,compiler_errors.invalid_binding_no_checkbox(name,type==='radio'));}}else if(name==='group'){if(_this31.name!=='input'){return component.error(binding,compiler_errors.invalid_binding_elements(_this31.name,'group'));}var _type=check_type_attribute();if(_type!=='checkbox'&&_type!=='radio'){return component.error(binding,compiler_errors.invalid_binding_element_with('<input type=\"checkbox\"> or <input type=\"radio\">','group'));}}else if(name==='files'){if(_this31.name!=='input'){return component.error(binding,compiler_errors.invalid_binding_elements(_this31.name,'files'));}var _type2=check_type_attribute();if(_type2!=='file'){return component.error(binding,compiler_errors.invalid_binding_element_with('<input type=\"file\">','files'));}}else if(name==='open'){if(_this31.name!=='details'){return component.error(binding,compiler_errors.invalid_binding_element_with('<details>',name));}}else if(name==='currentTime'||name==='duration'||name==='paused'||name==='buffered'||name==='seekable'||name==='played'||name==='volume'||name==='muted'||name==='playbackRate'||name==='seeking'||name==='ended'){if(_this31.name!=='audio'&&_this31.name!=='video'){return component.error(binding,compiler_errors.invalid_binding_element_with('audio> or <video>',name));}}else if(name==='videoHeight'||name==='videoWidth'){if(_this31.name!=='video'){return component.error(binding,compiler_errors.invalid_binding_element_with('<video>',name));}}else if(dimensions.test(name)){if(_this31.name==='svg'&&(name==='offsetWidth'||name==='offsetHeight')){return component.error(binding,compiler_errors.invalid_binding_on(binding.name,\"<svg>. Use '\".concat(name.replace('offset','client'),\"' instead\")));}else if(svg$1.test(_this31.name)){return component.error(binding,compiler_errors.invalid_binding_on(binding.name,'SVG elements'));}else if(is_void(_this31.name)){return component.error(binding,compiler_errors.invalid_binding_on(binding.name,\"void elements like <\".concat(_this31.name,\">. Use a wrapper element instead\")));}}else if(name==='textContent'||name==='innerHTML'){var contenteditable=_this31.attributes.find(function(attribute){return attribute.name==='contenteditable';});if(!contenteditable){return component.error(binding,compiler_errors.missing_contenteditable_attribute);}else if(contenteditable&&!contenteditable.is_static){return component.error(contenteditable,compiler_errors.dynamic_contenteditable_attribute);}}else if(name!=='this'){return component.error(binding,compiler_errors.invalid_binding(binding.name));}});}},{key:\"validate_content\",value:function validate_content(){if(!a11y_required_content.has(this.name))return;if(this.bindings.some(function(binding){return['textContent','innerHTML'].includes(binding.name);}))return;if(this.children.length===0){this.component.warn(this,compiler_warnings.a11y_missing_content(this.name));}}},{key:\"validate_event_handlers\",value:function validate_event_handlers(){var component=this.component;this.handlers.forEach(function(handler){if(handler.modifiers.has('passive')&&handler.modifiers.has('preventDefault')){return component.error(handler,compiler_errors.invalid_event_modifier_combination('passive','preventDefault'));}if(handler.modifiers.has('passive')&&handler.modifiers.has('nonpassive')){return component.error(handler,compiler_errors.invalid_event_modifier_combination('passive','nonpassive'));}handler.modifiers.forEach(function(modifier){if(!valid_modifiers.has(modifier)){return component.error(handler,compiler_errors.invalid_event_modifier(list(Array.from(valid_modifiers))));}if(modifier==='passive'){if(passive_events.has(handler.name)){if(handler.can_make_passive){component.warn(handler,compiler_warnings.redundant_event_modifier_for_touch);}}else{component.warn(handler,compiler_warnings.redundant_event_modifier_passive);}}if(component.compile_options.legacy&&(modifier==='once'||modifier==='passive')){// TODO this could be supported, but it would need a few changes to\n// how event listeners work\nreturn component.error(handler,compiler_errors.invalid_event_modifier_legacy(modifier));}});if(passive_events.has(handler.name)&&handler.can_make_passive&&!handler.modifiers.has('preventDefault')&&!handler.modifiers.has('nonpassive')){// touch/wheel events should be passive by default\nhandler.modifiers.add('passive');}});}},{key:\"is_media_node\",value:function is_media_node(){return this.name==='audio'||this.name==='video';}},{key:\"add_css_class\",value:function add_css_class(){if(this.attributes.some(function(attr){return attr.is_spread;})){this.needs_manual_style_scoping=true;return;}var id=this.component.stylesheet.id;var class_attribute=this.attributes.find(function(a){return a.name==='class';});if(class_attribute&&!class_attribute.is_true){if(class_attribute.chunks.length===1&&class_attribute.chunks[0].type==='Text'){class_attribute.chunks[0].data+=\" \".concat(id);}else{class_attribute.chunks.push(new Text(this.component,this,this.scope,{type:'Text',data:\" \".concat(id),synthetic:true}));}}else{this.attributes.push(new Attribute(this.component,this,this.scope,{type:'Attribute',name:'class',value:[{type:'Text',data:id,synthetic:true}]}));}}},{key:\"slot_template_name\",get:function get(){return this.attributes.find(function(attribute){return attribute.name==='slot';}).get_static_value();}},{key:\"optimise\",value:function optimise(){var _this32=this;attributes_to_compact_whitespace.forEach(function(attribute_name){var attribute=_this32.attributes.find(function(a){return a.name===attribute_name;});if(attribute&&!attribute.is_true){attribute.chunks.forEach(function(chunk,index){if(chunk.type==='Text'){var _data3=chunk.data.replace(/[\\s\\n\\t]+/g,' ');if(index===0){_data3=_data3.trimLeft();}else if(index===attribute.chunks.length-1){_data3=_data3.trimRight();}chunk.data=_data3;}});}});}}]);return Element;}(Node$1);function should_have_attribute(node,attributes){var name=arguments.length>2&&arguments[2]!==undefined?arguments[2]:node.name;var article=/^[aeiou]/.test(attributes[0])?'an':'a';var sequence=attributes.length>1?attributes.slice(0,-1).join(', ')+\" or \".concat(attributes[attributes.length-1]):attributes[0];node.component.warn(node,compiler_warnings.a11y_missing_attribute(name,article,sequence));}function within_custom_element(parent){while(parent){if(parent.type==='InlineComponent')return false;if(parent.type==='Element'&&/-/.test(parent.name))return true;parent=parent.parent;}return false;}// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str){str=str.replace(/\\r/g,'');var hash=5381;var i=str.length;while(i--){hash=(hash<<5)-hash^str.charCodeAt(i);}return(hash>>>0).toString(36);}var Head=/*#__PURE__*/function(_Node$17){(0,_inherits2.default)(Head,_Node$17);var _super23=_createSuper(Head);function Head(component,parent,scope,info){var _this33;(0,_classCallCheck2.default)(this,Head);_this33=_super23.call(this,component,parent,scope,info);if(info.attributes.length){component.error(info.attributes[0],compiler_errors.invalid_attribute_head);return(0,_possibleConstructorReturn2.default)(_this33);}_this33.children=map_children(component,parent,scope,info.children.filter(function(child){return child.type!=='Text'||/\\S/.test(child.data);}));if(_this33.children.length>0){_this33.id=\"svelte-\".concat(hash(_this33.component.source.slice(_this33.start,_this33.end)));}return _this33;}return(0,_createClass2.default)(Head);}(Node$1);var IfBlock=/*#__PURE__*/function(_AbstractBlock5){(0,_inherits2.default)(IfBlock,_AbstractBlock5);var _super24=_createSuper(IfBlock);function IfBlock(component,parent,scope,info){var _this34;(0,_classCallCheck2.default)(this,IfBlock);_this34=_super24.call(this,component,parent,scope,info);_this34.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this34),scope,info.expression);_this34.children=map_children(component,(0,_assertThisInitialized2.default)(_this34),scope,info.children);_this34.else=info.else?new ElseBlock(component,(0,_assertThisInitialized2.default)(_this34),scope,info.else):null;_this34.warn_if_empty_block();return _this34;}return(0,_createClass2.default)(IfBlock);}(AbstractBlock);var InlineComponent=/*#__PURE__*/function(_Node$18){(0,_inherits2.default)(InlineComponent,_Node$18);var _super25=_createSuper(InlineComponent);function InlineComponent(component,parent,scope,info){var _this35;(0,_classCallCheck2.default)(this,InlineComponent);_this35=_super25.call(this,component,parent,scope,info);_this35.attributes=[];_this35.bindings=[];_this35.handlers=[];_this35.lets=[];_this35.css_custom_properties=[];if(info.name!=='svelte:component'&&info.name!=='svelte:self'){var name=info.name.split('.')[0];// accommodate namespaces\ncomponent.warn_if_undefined(name,info,scope);component.add_reference(name);}_this35.name=info.name;_this35.expression=_this35.name==='svelte:component'?new Expression(component,(0,_assertThisInitialized2.default)(_this35),scope,info.expression):null;info.attributes.forEach(function(node){/* eslint-disable no-fallthrough */switch(node.type){case'Action':return component.error(node,compiler_errors.invalid_action);case'Attribute':if(node.name.startsWith('--')){_this35.css_custom_properties.push(new Attribute(component,(0,_assertThisInitialized2.default)(_this35),scope,node));break;}// fallthrough\ncase'Spread':_this35.attributes.push(new Attribute(component,(0,_assertThisInitialized2.default)(_this35),scope,node));break;case'Binding':_this35.bindings.push(new Binding(component,(0,_assertThisInitialized2.default)(_this35),scope,node));break;case'Class':return component.error(node,compiler_errors.invalid_class);case'EventHandler':_this35.handlers.push(new EventHandler(component,(0,_assertThisInitialized2.default)(_this35),scope,node));break;case'Let':_this35.lets.push(new Let(component,(0,_assertThisInitialized2.default)(_this35),scope,node));break;case'Transition':return component.error(node,compiler_errors.invalid_transition);default:throw new Error(\"Not implemented: \".concat(node.type));}/* eslint-enable no-fallthrough */});if(_this35.lets.length>0){_this35.scope=scope.child();_this35.lets.forEach(function(l){var dependencies=new Set([l.name.name]);l.names.forEach(function(name){_this35.scope.add(name,dependencies,(0,_assertThisInitialized2.default)(_this35));});});}else{_this35.scope=scope;}_this35.handlers.forEach(function(handler){handler.modifiers.forEach(function(modifier){if(modifier!=='once'){return component.error(handler,compiler_errors.invalid_event_modifier_component);}});});var children=[];for(var _i34=info.children.length-1;_i34>=0;_i34--){var child=info.children[_i34];if(child.type==='SlotTemplate'){children.push(child);info.children.splice(_i34,1);}else if((child.type==='Element'||child.type==='InlineComponent'||child.type==='Slot')&&child.attributes.find(function(attribute){return attribute.name==='slot';})){var slot_template={start:child.start,end:child.end,type:'SlotTemplate',name:'svelte:fragment',attributes:[],children:[child]};// transfer attributes\nfor(var _i35=child.attributes.length-1;_i35>=0;_i35--){var attribute=child.attributes[_i35];if(attribute.type==='Let'){slot_template.attributes.push(attribute);child.attributes.splice(_i35,1);}else if(attribute.type==='Attribute'&&attribute.name==='slot'){slot_template.attributes.push(attribute);}}// transfer const\nfor(var _i36=child.children.length-1;_i36>=0;_i36--){var child_child=child.children[_i36];if(child_child.type==='ConstTag'){slot_template.children.push(child_child);child.children.splice(_i36,1);}}children.push(slot_template);info.children.splice(_i34,1);}}if(info.children.some(function(node){return not_whitespace_text(node);})){children.push({start:info.start,end:info.end,type:'SlotTemplate',name:'svelte:fragment',attributes:[],children:info.children});}_this35.children=map_children(component,(0,_assertThisInitialized2.default)(_this35),_this35.scope,children);return _this35;}(0,_createClass2.default)(InlineComponent,[{key:\"slot_template_name\",get:function get(){return this.attributes.find(function(attribute){return attribute.name==='slot';}).get_static_value();}}]);return InlineComponent;}(Node$1);function not_whitespace_text(node){return!(node.type==='Text'&&/^\\s+$/.test(node.data));}var KeyBlock=/*#__PURE__*/function(_AbstractBlock6){(0,_inherits2.default)(KeyBlock,_AbstractBlock6);var _super26=_createSuper(KeyBlock);function KeyBlock(component,parent,scope,info){var _this36;(0,_classCallCheck2.default)(this,KeyBlock);_this36=_super26.call(this,component,parent,scope,info);_this36.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this36),scope,info.expression);_this36.children=map_children(component,(0,_assertThisInitialized2.default)(_this36),scope,info.children);_this36.warn_if_empty_block();return _this36;}return(0,_createClass2.default)(KeyBlock);}(AbstractBlock);var Tag=/*#__PURE__*/function(_Node$19){(0,_inherits2.default)(Tag,_Node$19);var _super27=_createSuper(Tag);function Tag(component,parent,scope,info){var _this37;(0,_classCallCheck2.default)(this,Tag);_this37=_super27.call(this,component,parent,scope,info);_this37.expression=new Expression(component,(0,_assertThisInitialized2.default)(_this37),scope,info.expression);_this37.should_cache=info.expression.type!=='Identifier'||_this37.expression.dependencies.size&&scope.names.has(info.expression.name);return _this37;}return(0,_createClass2.default)(Tag);}(Node$1);var MustacheTag=/*#__PURE__*/function(_Tag){(0,_inherits2.default)(MustacheTag,_Tag);var _super28=_createSuper(MustacheTag);function MustacheTag(){(0,_classCallCheck2.default)(this,MustacheTag);return _super28.apply(this,arguments);}return(0,_createClass2.default)(MustacheTag);}(Tag);var Options=/*#__PURE__*/function(_Node$20){(0,_inherits2.default)(Options,_Node$20);var _super29=_createSuper(Options);function Options(){(0,_classCallCheck2.default)(this,Options);return _super29.apply(this,arguments);}return(0,_createClass2.default)(Options);}(Node$1);var RawMustacheTag=/*#__PURE__*/function(_Tag2){(0,_inherits2.default)(RawMustacheTag,_Tag2);var _super30=_createSuper(RawMustacheTag);function RawMustacheTag(){(0,_classCallCheck2.default)(this,RawMustacheTag);return _super30.apply(this,arguments);}return(0,_createClass2.default)(RawMustacheTag);}(Tag);var DebugTag=/*#__PURE__*/function(_Node$21){(0,_inherits2.default)(DebugTag,_Node$21);var _super31=_createSuper(DebugTag);function DebugTag(component,parent,scope,info){var _this38;(0,_classCallCheck2.default)(this,DebugTag);_this38=_super31.call(this,component,parent,scope,info);_this38.expressions=info.identifiers.map(function(node){return new Expression(component,parent,scope,node);});return _this38;}return(0,_createClass2.default)(DebugTag);}(Node$1);var Slot=/*#__PURE__*/function(_Element){(0,_inherits2.default)(Slot,_Element);var _super32=_createSuper(Slot);function Slot(component,parent,scope,info){var _this39;(0,_classCallCheck2.default)(this,Slot);_this39=_super32.call(this,component,parent,scope,info);_this39.values=new Map();info.attributes.forEach(function(attr){if(attr.type!=='Attribute'&&attr.type!=='Spread'){return component.error(attr,compiler_errors.invalid_slot_directive);}if(attr.name==='name'){if(attr.value.length!==1||attr.value[0].type!=='Text'){return component.error(attr,compiler_errors.dynamic_slot_name);}_this39.slot_name=attr.value[0].data;if(_this39.slot_name==='default'){return component.error(attr,compiler_errors.invalid_slot_name);}}_this39.values.set(attr.name,new Attribute(component,(0,_assertThisInitialized2.default)(_this39),scope,attr));});if(!_this39.slot_name)_this39.slot_name='default';if(_this39.slot_name==='default'){// if this is the default slot, add our dependencies to any\n// other slots (which inherit our slot values) that were\n// previously encountered\ncomponent.slots.forEach(function(slot){_this39.values.forEach(function(attribute,name){if(!slot.values.has(name)){slot.values.set(name,attribute);}});});}else if(component.slots.has('default')){// otherwise, go the other way — inherit values from\n// a previously encountered default slot\nvar default_slot=component.slots.get('default');default_slot.values.forEach(function(attribute,name){if(!_this39.values.has(name)){_this39.values.set(name,attribute);}});}component.slots.set(_this39.slot_name,(0,_assertThisInitialized2.default)(_this39));return _this39;}return(0,_createClass2.default)(Slot);}(Element);var SlotTemplate=/*#__PURE__*/function(_Node$22){(0,_inherits2.default)(SlotTemplate,_Node$22);var _super33=_createSuper(SlotTemplate);function SlotTemplate(component,parent,scope,info){var _this40;(0,_classCallCheck2.default)(this,SlotTemplate);_this40=_super33.call(this,component,parent,scope,info);_this40.lets=[];_this40.slot_template_name='default';_this40.validate_slot_template_placement();var has_let=info.attributes.some(function(node){return node.type==='Let';});if(has_let){scope=scope.child();}info.attributes.forEach(function(node){switch(node.type){case'Let':{var l=new Let(component,(0,_assertThisInitialized2.default)(_this40),scope,node);_this40.lets.push(l);var dependencies=new Set([l.name.name]);l.names.forEach(function(name){scope.add(name,dependencies,(0,_assertThisInitialized2.default)(_this40));});break;}case'Attribute':{if(node.name==='slot'){_this40.slot_attribute=new Attribute(component,(0,_assertThisInitialized2.default)(_this40),scope,node);if(!_this40.slot_attribute.is_static){return component.error(node,compiler_errors.invalid_slot_attribute);}var _value9=_this40.slot_attribute.get_static_value();if(typeof _value9==='boolean'){return component.error(node,compiler_errors.invalid_slot_attribute_value_missing);}_this40.slot_template_name=_value9;break;}throw new Error(\"Invalid attribute '\".concat(node.name,\"' in <svelte:fragment>\"));}default:throw new Error(\"Not implemented: \".concat(node.type));}});_this40.scope=scope;var _get_const_tags5=get_const_tags(info.children,component,(0,_assertThisInitialized2.default)(_this40),(0,_assertThisInitialized2.default)(_this40));var _get_const_tags6=(0,_slicedToArray2.default)(_get_const_tags5,2);_this40.const_tags=_get_const_tags6[0];_this40.children=_get_const_tags6[1];return _this40;}(0,_createClass2.default)(SlotTemplate,[{key:\"validate_slot_template_placement\",value:function validate_slot_template_placement(){if(this.parent.type!=='InlineComponent'){return this.component.error(this,compiler_errors.invalid_slotted_content_fragment);}}}]);return SlotTemplate;}(Node$1);var Title=/*#__PURE__*/function(_Node$23){(0,_inherits2.default)(Title,_Node$23);var _super34=_createSuper(Title);function Title(component,parent,scope,info){var _this41;(0,_classCallCheck2.default)(this,Title);_this41=_super34.call(this,component,parent,scope,info);_this41.children=map_children(component,parent,scope,info.children);if(info.attributes.length>0){component.error(info.attributes[0],compiler_errors.illegal_attribute_title);return(0,_possibleConstructorReturn2.default)(_this41);}info.children.forEach(function(child){if(child.type!=='Text'&&child.type!=='MustacheTag'){return component.error(child,compiler_errors.illegal_structure_title);}});_this41.should_cache=info.children.length===1?info.children[0].type!=='Identifier'||scope.names.has(info.children[0].name):true;return _this41;}return(0,_createClass2.default)(Title);}(Node$1);var valid_bindings=['innerWidth','innerHeight','outerWidth','outerHeight','scrollX','scrollY','online'];var Window=/*#__PURE__*/function(_Node$24){(0,_inherits2.default)(Window,_Node$24);var _super35=_createSuper(Window);function Window(component,parent,scope,info){var _this42;(0,_classCallCheck2.default)(this,Window);_this42=_super35.call(this,component,parent,scope,info);_this42.handlers=[];_this42.bindings=[];_this42.actions=[];info.attributes.forEach(function(node){if(node.type==='EventHandler'){_this42.handlers.push(new EventHandler(component,(0,_assertThisInitialized2.default)(_this42),scope,node));}else if(node.type==='Binding'){if(node.expression.type!=='Identifier'){var _flatten_reference4=flatten_reference(node.expression),parts=_flatten_reference4.parts;// TODO is this constraint necessary?\nreturn component.error(node.expression,compiler_errors.invalid_binding_window(parts));}if(!~valid_bindings.indexOf(node.name)){var match=node.name==='width'?'innerWidth':node.name==='height'?'innerHeight':fuzzymatch(node.name,valid_bindings);if(match){return component.error(node,compiler_errors.invalid_binding_on(node.name,'<svelte:window>',\" (did you mean '\".concat(match,\"'?)\")));}else{return component.error(node,compiler_errors.invalid_binding_on(node.name,'<svelte:window>',\" \\u2014 valid bindings are \".concat(list(valid_bindings))));}}_this42.bindings.push(new Binding(component,(0,_assertThisInitialized2.default)(_this42),scope,node));}else if(node.type==='Action'){_this42.actions.push(new Action(component,(0,_assertThisInitialized2.default)(_this42),scope,node));}});return _this42;}return(0,_createClass2.default)(Window);}(Node$1);function get_constructor(type){switch(type){case'AwaitBlock':return AwaitBlock;case'Body':return Body;case'Comment':return Comment$1;case'ConstTag':return ConstTag;case'EachBlock':return EachBlock;case'Element':return Element;case'Head':return Head;case'IfBlock':return IfBlock;case'InlineComponent':return InlineComponent;case'KeyBlock':return KeyBlock;case'MustacheTag':return MustacheTag;case'Options':return Options;case'RawMustacheTag':return RawMustacheTag;case'DebugTag':return DebugTag;case'Slot':return Slot;case'SlotTemplate':return SlotTemplate;case'Text':return Text;case'Title':return Title;case'Window':return Window;default:throw new Error(\"Not implemented: \".concat(type));}}function map_children(component,parent,scope,children){var last=null;var ignores=[];return children.map(function(child){var constructor=get_constructor(child.type);var use_ignores=child.type!=='Text'&&child.type!=='Comment'&&ignores.length;if(use_ignores)component.push_ignores(ignores);var node=new constructor(component,parent,scope,child);if(use_ignores)component.pop_ignores(),ignores=[];if(node.type==='Comment'&&node.ignores.length){var _ignores;(_ignores=ignores).push.apply(_ignores,(0,_toConsumableArray2.default)(node.ignores));}if(last)last.next=node;node.prev=last;last=node;return node;});}function check_graph_for_cycles(edges){var graph=edges.reduce(function(g,edge){var _edge=(0,_slicedToArray2.default)(edge,2),u=_edge[0],v=_edge[1];if(!g.has(u))g.set(u,[]);if(!g.has(v))g.set(v,[]);g.get(u).push(v);return g;},new Map());var visited=new Set();var on_stack=new Set();var cycles=[];function visit(v){visited.add(v);on_stack.add(v);graph.get(v).forEach(function(w){if(!visited.has(w)){visit(w);}else if(on_stack.has(w)){cycles.push([].concat((0,_toConsumableArray2.default)(on_stack),[w]));}});on_stack.delete(v);}graph.forEach(function(_,v){if(!visited.has(v)){visit(v);}});return cycles[0];}function get_const_tags(children,component,node,parent){var const_tags=[];var others=[];var _iterator=_createForOfIteratorHelper(children),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var child=_step.value;if(child.type==='ConstTag'){const_tags.push(child);}else{others.push(child);}}}catch(err){_iterator.e(err);}finally{_iterator.f();}var consts_nodes=const_tags.map(function(tag){return new ConstTag(component,node,node.scope,tag);});var sorted_consts_nodes=sort_consts_nodes(consts_nodes,component);sorted_consts_nodes.forEach(function(node){return node.parse_expression();});var children_nodes=map_children(component,parent,node.scope,others);return[sorted_consts_nodes,children_nodes];}function sort_consts_nodes(consts_nodes,component){var sorted_consts_nodes=[];var unsorted_consts_nodes=consts_nodes.map(function(node){return{assignees:node.assignees,dependencies:node.dependencies,node:node};});var lookup=new Map();unsorted_consts_nodes.forEach(function(node){node.assignees.forEach(function(name){if(!lookup.has(name)){lookup.set(name,[]);}lookup.get(name).push(node);});});var cycle=check_graph_for_cycles(unsorted_consts_nodes.reduce(function(acc,node){node.assignees.forEach(function(v){node.dependencies.forEach(function(w){if(!node.assignees.has(w)){acc.push([v,w]);}});});return acc;},[]));if(cycle&&cycle.length){var nodeList=lookup.get(cycle[0]);var _node9=nodeList[0];component.error(_node9.node,compiler_errors.cyclical_const_tags(cycle));}var add_node=function add_node(node){if(sorted_consts_nodes.includes(node))return;node.dependencies.forEach(function(name){if(node.assignees.has(name))return;var earlier_nodes=lookup.get(name);if(earlier_nodes){earlier_nodes.forEach(add_node);}});sorted_consts_nodes.push(node);};unsorted_consts_nodes.forEach(add_node);return sorted_consts_nodes.map(function(node){return node.node;});}var ThenBlock=/*#__PURE__*/function(_AbstractBlock7){(0,_inherits2.default)(ThenBlock,_AbstractBlock7);var _super36=_createSuper(ThenBlock);function ThenBlock(component,parent,scope,info){var _this43;(0,_classCallCheck2.default)(this,ThenBlock);_this43=_super36.call(this,component,parent,scope,info);_this43.scope=scope.child();if(parent.then_node){parent.then_contexts.forEach(function(context){_this43.scope.add(context.key.name,parent.expression.dependencies,(0,_assertThisInitialized2.default)(_this43));});}var _get_const_tags7=get_const_tags(info.children,component,(0,_assertThisInitialized2.default)(_this43),parent);var _get_const_tags8=(0,_slicedToArray2.default)(_get_const_tags7,2);_this43.const_tags=_get_const_tags8[0];_this43.children=_get_const_tags8[1];if(!info.skip){_this43.warn_if_empty_block();}return _this43;}return(0,_createClass2.default)(ThenBlock);}(AbstractBlock);function add_const_tags(block,const_tags,ctx){var const_tags_props=[];const_tags.forEach(function(const_tag,i){var name=\"#constants_\".concat(i);const_tags_props.push(b(_templateObject76||(_templateObject76=(0,_taggedTemplateLiteral2.default)([\"const \",\" = \",\"\"])),name,const_tag.expression.manipulate(block,ctx)));const_tag.contexts.forEach(function(context){const_tags_props.push(b(_templateObject77||(_templateObject77=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"] = \",\";\"])),ctx,block.renderer.context_lookup.get(context.key.name).index,context.default_modifier(context.modifier({type:'Identifier',name:name}),function(name){return block.renderer.context_lookup.has(name)?x(_templateObject78||(_templateObject78=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),ctx,block.renderer.context_lookup.get(name).index):{type:'Identifier',name:name};})));});});return const_tags_props;}function add_const_tags_context(renderer,const_tags){const_tags.forEach(function(const_tag){const_tag.contexts.forEach(function(context){renderer.add_to_context(context.key.name,true);});});}var AwaitBlockBranch=/*#__PURE__*/function(_Wrapper){(0,_inherits2.default)(AwaitBlockBranch,_Wrapper);var _super37=_createSuper(AwaitBlockBranch);function AwaitBlockBranch(status,renderer,block,parent,node,strip_whitespace,next_sibling){var _this44;(0,_classCallCheck2.default)(this,AwaitBlockBranch);_this44=_super37.call(this,renderer,block,parent,node);_this44.var=null;_this44.status=status;_this44.block=block.child({comment:create_debugging_comment(node,_this44.renderer.component),name:_this44.renderer.component.get_unique_name(\"create_\".concat(status,\"_block\")),type:status});_this44.add_context(parent.node[status+'_node'],parent.node[status+'_contexts']);_this44.fragment=new FragmentWrapper(renderer,_this44.block,_this44.node.children,parent,strip_whitespace,next_sibling);_this44.is_dynamic=_this44.block.dependencies.size>0;return _this44;}(0,_createClass2.default)(AwaitBlockBranch,[{key:\"add_context\",value:function add_context(node,contexts){var _this45=this;if(!node)return;if(node.type==='Identifier'){this.value=node.name;this.renderer.add_to_context(this.value,true);}else{contexts.forEach(function(context){_this45.renderer.add_to_context(context.key.name,true);});this.value=this.block.parent.get_unique_name('value').name;this.value_contexts=contexts;this.renderer.add_to_context(this.value,true);this.is_destructured=true;}this.value_index=this.renderer.context_lookup.get(this.value).index;if(this.has_consts(this.node)){add_const_tags_context(this.renderer,this.node.const_tags);}}},{key:\"has_consts\",value:function has_consts(node){return node instanceof ThenBlock||node instanceof CatchBlock;}},{key:\"render\",value:function render(block,parent_node,parent_nodes){this.fragment.render(block,parent_node,parent_nodes);if(this.is_destructured||this.has_consts(this.node)&&this.node.const_tags.length>0){this.render_get_context();}}},{key:\"render_get_context\",value:function render_get_context(){var _this46=this;var props=this.is_destructured?this.value_contexts.map(function(prop){return b(_templateObject79||(_templateObject79=(0,_taggedTemplateLiteral2.default)([\"#ctx[\",\"] = \",\";\"])),_this46.block.renderer.context_lookup.get(prop.key.name).index,prop.default_modifier(prop.modifier(x(_templateObject80||(_templateObject80=(0,_taggedTemplateLiteral2.default)([\"#ctx[\",\"]\"])),_this46.value_index)),function(name){return _this46.renderer.reference(name);}));}):null;var const_tags_props=this.has_consts(this.node)?add_const_tags(this.block,this.node.const_tags,'#ctx'):null;var get_context=this.block.renderer.component.get_unique_name(\"get_\".concat(this.status,\"_context\"));this.block.renderer.blocks.push(b(_templateObject81||(_templateObject81=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfunction \",\"(#ctx) {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\\n\\t\\t\"])),get_context,props,const_tags_props));this.block.chunks.declarations.push(b(_templateObject82||(_templateObject82=(0,_taggedTemplateLiteral2.default)([\"\",\"(#ctx)\"])),get_context));if(this.block.has_update_method){this.block.chunks.update.unshift(b(_templateObject83||(_templateObject83=(0,_taggedTemplateLiteral2.default)([\"\",\"(#ctx)\"])),get_context));}}}]);return AwaitBlockBranch;}(Wrapper);var AwaitBlockWrapper=/*#__PURE__*/function(_Wrapper2){(0,_inherits2.default)(AwaitBlockWrapper,_Wrapper2);var _super38=_createSuper(AwaitBlockWrapper);function AwaitBlockWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _this47;(0,_classCallCheck2.default)(this,AwaitBlockWrapper);_this47=_super38.call(this,renderer,block,parent,node);_this47.var={type:'Identifier',name:'await_block'};_this47.cannot_use_innerhtml();_this47.not_static_content();block.add_dependencies(_this47.node.expression.dependencies);var is_dynamic=false;var has_intros=false;var has_outros=false;['pending','then','catch'].forEach(function(status){var child=_this47.node[status];var branch=new AwaitBlockBranch(status,renderer,block,(0,_assertThisInitialized2.default)(_this47),child,strip_whitespace,next_sibling);renderer.blocks.push(branch.block);if(branch.is_dynamic){is_dynamic=true;// TODO should blocks update their own parents?\nblock.add_dependencies(branch.block.dependencies);}if(branch.block.has_intros)has_intros=true;if(branch.block.has_outros)has_outros=true;_this47[status]=branch;});['pending','then','catch'].forEach(function(status){_this47[status].block.has_update_method=is_dynamic;_this47[status].block.has_intro_method=has_intros;_this47[status].block.has_outro_method=has_outros;});if(has_outros){block.add_outro();}return _this47;}(0,_createClass2.default)(AwaitBlockWrapper,[{key:\"render\",value:function render(block,parent_node,parent_nodes){var anchor=this.get_or_create_anchor(block,parent_node,parent_nodes);var update_mount_node=this.get_update_mount_node(anchor);var snippet=this.node.expression.manipulate(block);var info=block.get_unique_name('info');var promise=block.get_unique_name('promise');block.add_variable(promise);block.maintain_context=true;var info_props=x(_templateObject84||(_templateObject84=(0,_taggedTemplateLiteral2.default)([\"{\\n\\t\\t\\tctx: #ctx,\\n\\t\\t\\tcurrent: null,\\n\\t\\t\\ttoken: null,\\n\\t\\t\\thasCatch: \",\",\\n\\t\\t\\tpending: \",\",\\n\\t\\t\\tthen: \",\",\\n\\t\\t\\tcatch: \",\",\\n\\t\\t\\tvalue: \",\",\\n\\t\\t\\terror: \",\",\\n\\t\\t\\tblocks: \",\"\\n\\t\\t}\"])),this.catch.node.start!==null?'true':'false',this.pending.block.name,this.then.block.name,this.catch.block.name,this.then.value_index,this.catch.value_index,this.pending.block.has_outro_method&&x(_templateObject85||(_templateObject85=(0,_taggedTemplateLiteral2.default)([\"[,,,]\"]))));block.chunks.init.push(b(_templateObject86||(_templateObject86=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tlet \",\" = \",\";\\n\\t\\t\"])),info,info_props));block.chunks.init.push(b(_templateObject87||(_templateObject87=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t@handle_promise(\",\" = \",\", \",\");\\n\\t\\t\"])),promise,snippet,info));block.chunks.create.push(b(_templateObject88||(_templateObject88=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\".block.c();\\n\\t\\t\"])),info));if(parent_nodes&&this.renderer.options.hydratable){block.chunks.claim.push(b(_templateObject89||(_templateObject89=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\".block.l(\",\");\\n\\t\\t\\t\"])),info,parent_nodes));}var initial_mount_node=parent_node||'#target';var anchor_node=parent_node?'null':'#anchor';var has_transitions=this.pending.block.has_intro_method||this.pending.block.has_outro_method;block.chunks.mount.push(b(_templateObject90||(_templateObject90=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\".block.m(\",\", \",\".anchor = \",\");\\n\\t\\t\\t\",\".mount = () => \",\";\\n\\t\\t\\t\",\".anchor = \",\";\\n\\t\\t\"])),info,initial_mount_node,info,anchor_node,info,update_mount_node,info,anchor));if(has_transitions){block.chunks.intro.push(b(_templateObject91||(_templateObject91=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\".block);\"])),info));}var dependencies=this.node.expression.dynamic_dependencies();var update_await_block_branch=b(_templateObject92||(_templateObject92=(0,_taggedTemplateLiteral2.default)([\"@update_await_block_branch(\",\", #ctx, #dirty)\"])),info);if(dependencies.length>0){var condition=x(_templateObject93||(_templateObject93=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\" &&\\n\\t\\t\\t\\t\",\" !== (\",\" = \",\") &&\\n\\t\\t\\t\\t@handle_promise(\",\", \",\")\"])),block.renderer.dirty(dependencies),promise,promise,snippet,promise,info);block.chunks.update.push(b(_templateObject94||(_templateObject94=(0,_taggedTemplateLiteral2.default)([\"\",\".ctx = #ctx;\"])),info));if(this.pending.block.has_update_method){block.chunks.update.push(b(_templateObject95||(_templateObject95=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),condition,update_await_block_branch));}else{block.chunks.update.push(b(_templateObject96||(_templateObject96=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\"])),condition));}}else{if(this.pending.block.has_update_method){block.chunks.update.push(b(_templateObject97||(_templateObject97=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\"])),update_await_block_branch));}}if(this.pending.block.has_outro_method){block.chunks.outro.push(b(_templateObject98||(_templateObject98=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfor (let #i = 0; #i < 3; #i += 1) {\\n\\t\\t\\t\\t\\tconst block = \",\".blocks[#i];\\n\\t\\t\\t\\t\\t@transition_out(block);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),info));}block.chunks.destroy.push(b(_templateObject99||(_templateObject99=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\".block.d(\",\");\\n\\t\\t\\t\",\".token = null;\\n\\t\\t\\t\",\" = null;\\n\\t\\t\"])),info,parent_node?null:'detaching',info,info));[this.pending,this.then,this.catch].forEach(function(branch){branch.render(branch.block,null,x(_templateObject100||(_templateObject100=(0,_taggedTemplateLiteral2.default)([\"#nodes\"]))));});}}]);return AwaitBlockWrapper;}(Wrapper);var TRUE=x(_templateObject101||(_templateObject101=(0,_taggedTemplateLiteral2.default)([\"true\"])));var FALSE=x(_templateObject102||(_templateObject102=(0,_taggedTemplateLiteral2.default)([\"false\"])));var EventHandlerWrapper=/*#__PURE__*/function(){function EventHandlerWrapper(node,parent){(0,_classCallCheck2.default)(this,EventHandlerWrapper);this.node=node;this.parent=parent;if(!node.expression){this.parent.renderer.add_to_context(node.handler_name.name);this.parent.renderer.component.partly_hoisted.push(b(_templateObject103||(_templateObject103=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfunction \",\"(event) {\\n\\t\\t\\t\\t\\t@bubble.call(this, $$self, event);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),node.handler_name.name));}}(0,_createClass2.default)(EventHandlerWrapper,[{key:\"get_snippet\",value:function get_snippet(block){var snippet=this.node.expression?this.node.expression.manipulate(block):block.renderer.reference(this.node.handler_name);if(this.node.reassigned){block.maintain_context=true;return x(_templateObject104||(_templateObject104=(0,_taggedTemplateLiteral2.default)([\"function () { if (@is_function(\",\")) \",\".apply(this, arguments); }\"])),snippet,snippet);}return snippet;}},{key:\"render\",value:function render(block,target){var _this48=this;var snippet=this.get_snippet(block);if(this.node.modifiers.has('preventDefault'))snippet=x(_templateObject105||(_templateObject105=(0,_taggedTemplateLiteral2.default)([\"@prevent_default(\",\")\"])),snippet);if(this.node.modifiers.has('stopPropagation'))snippet=x(_templateObject106||(_templateObject106=(0,_taggedTemplateLiteral2.default)([\"@stop_propagation(\",\")\"])),snippet);if(this.node.modifiers.has('self'))snippet=x(_templateObject107||(_templateObject107=(0,_taggedTemplateLiteral2.default)([\"@self(\",\")\"])),snippet);if(this.node.modifiers.has('trusted'))snippet=x(_templateObject108||(_templateObject108=(0,_taggedTemplateLiteral2.default)([\"@trusted(\",\")\"])),snippet);var args=[];var opts=['nonpassive','passive','once','capture'].filter(function(mod){return _this48.node.modifiers.has(mod);});if(opts.length){if(opts.length===1&&opts[0]==='capture'){args.push(TRUE);}else{args.push(x(_templateObject109||(_templateObject109=(0,_taggedTemplateLiteral2.default)([\"{ \",\" }\"])),opts.map(function(opt){return opt==='nonpassive'?p(_templateObject110||(_templateObject110=(0,_taggedTemplateLiteral2.default)([\"passive: false\"]))):p(_templateObject111||(_templateObject111=(0,_taggedTemplateLiteral2.default)([\"\",\": true\"])),opt);})));}}else if(block.renderer.options.dev){args.push(FALSE);}if(block.renderer.options.dev){args.push(this.node.modifiers.has('preventDefault')?TRUE:FALSE);args.push(this.node.modifiers.has('stopPropagation')?TRUE:FALSE);}block.event_listeners.push(x(_templateObject112||(_templateObject112=(0,_taggedTemplateLiteral2.default)([\"@listen(\",\", \\\"\",\"\\\", \",\", \",\")\"])),target,this.node.name,snippet,args));}}]);return EventHandlerWrapper;}();function add_event_handlers(block,target,handlers){handlers.forEach(function(handler){return add_event_handler(block,target,handler);});}function add_event_handler(block,target,handler){handler.render(block,target);}function add_actions(block,target,actions){actions.forEach(function(action){return add_action(block,target,action);});}function add_action(block,target,action){var expression=action.expression,template_scope=action.template_scope;var snippet;var dependencies;if(expression){snippet=expression.manipulate(block);dependencies=expression.dynamic_dependencies();}var id=block.get_unique_name(\"\".concat(action.name.replace(/[^a-zA-Z0-9_$]/g,'_'),\"_action\"));block.add_variable(id);var _action$name$split=action.name.split('.'),_action$name$split2=(0,_toArray2.default)(_action$name$split),obj=_action$name$split2[0],properties=_action$name$split2.slice(1);var fn=is_contextual(action.component,template_scope,obj)?block.renderer.reference(obj):obj;if(properties.length){var member_expression=properties.reduce(function(lhs,rhs){return x(_templateObject113||(_templateObject113=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\"\"])),lhs,rhs);},fn);block.event_listeners.push(x(_templateObject114||(_templateObject114=(0,_taggedTemplateLiteral2.default)([\"@action_destroyer(\",\" = \",\"(\",\", \",\"))\"])),id,member_expression,target,snippet));}else{block.event_listeners.push(x(_templateObject115||(_templateObject115=(0,_taggedTemplateLiteral2.default)([\"@action_destroyer(\",\" = \",\".call(null, \",\", \",\"))\"])),id,fn,target,snippet));}if(dependencies&&dependencies.length>0){var condition=x(_templateObject116||(_templateObject116=(0,_taggedTemplateLiteral2.default)([\"\",\" && @is_function(\",\".update)\"])),id,id);if(dependencies.length>0){condition=x(_templateObject117||(_templateObject117=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\"\"])),condition,block.renderer.dirty(dependencies));}block.chunks.update.push(b(_templateObject118||(_templateObject118=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".update.call(null, \",\");\"])),condition,id,snippet));}}var BodyWrapper=/*#__PURE__*/function(_Wrapper3){(0,_inherits2.default)(BodyWrapper,_Wrapper3);var _super39=_createSuper(BodyWrapper);function BodyWrapper(renderer,block,parent,node){var _this49;(0,_classCallCheck2.default)(this,BodyWrapper);_this49=_super39.call(this,renderer,block,parent,node);_this49.handlers=_this49.node.handlers.map(function(handler){return new EventHandlerWrapper(handler,(0,_assertThisInitialized2.default)(_this49));});return _this49;}(0,_createClass2.default)(BodyWrapper,[{key:\"render\",value:function render(block,_parent_node,_parent_nodes){add_event_handlers(block,x(_templateObject119||(_templateObject119=(0,_taggedTemplateLiteral2.default)([\"@_document.body\"]))),this.handlers);add_actions(block,x(_templateObject120||(_templateObject120=(0,_taggedTemplateLiteral2.default)([\"@_document.body\"]))),this.node.actions);}}]);return BodyWrapper;}(Wrapper);var DebugTagWrapper=/*#__PURE__*/function(_Wrapper4){(0,_inherits2.default)(DebugTagWrapper,_Wrapper4);var _super40=_createSuper(DebugTagWrapper);function DebugTagWrapper(renderer,block,parent,node,_strip_whitespace,_next_sibling){(0,_classCallCheck2.default)(this,DebugTagWrapper);return _super40.call(this,renderer,block,parent,node);}(0,_createClass2.default)(DebugTagWrapper,[{key:\"render\",value:function render(block,_parent_node,_parent_nodes){var renderer=this.renderer;var component=renderer.component;if(!renderer.options.dev)return;var var_lookup=component.var_lookup;var start=component.locate(this.node.start+1);var end={line:start.line,column:start.column+6};var loc={start:start,end:end};var debug={type:'DebuggerStatement',loc:loc};if(this.node.expressions.length===0){// Debug all\nblock.chunks.create.push(debug);block.chunks.update.push(debug);}else{var log={type:'Identifier',name:'log',loc:loc};var dependencies=new Set();this.node.expressions.forEach(function(expression){add_to_set(dependencies,expression.dependencies);});var contextual_identifiers=this.node.expressions.filter(function(e){var variable=var_lookup.get(e.node.name);return!(variable&&variable.hoistable);}).map(function(e){return e.node.name;});var logged_identifiers=this.node.expressions.map(function(e){return p(_templateObject121||(_templateObject121=(0,_taggedTemplateLiteral2.default)([\"\",\"\"])),e.node.name);});var debug_statements=b(_templateObject122||(_templateObject122=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t@_console.\",\"({ \",\" });\\n\\t\\t\\t\\tdebugger;\"])),contextual_identifiers.map(function(name){return b(_templateObject123||(_templateObject123=(0,_taggedTemplateLiteral2.default)([\"const \",\" = \",\";\"])),name,renderer.reference(name));}),log,logged_identifiers);if(dependencies.size){var condition=renderer.dirty(Array.from(dependencies));block.chunks.update.push(b(_templateObject124||(_templateObject124=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),condition,debug_statements));}block.chunks.create.push(b(_templateObject125||(_templateObject125=(0,_taggedTemplateLiteral2.default)([\"{\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),debug_statements));}}}]);return DebugTagWrapper;}(Wrapper);var ElseBlockWrapper=/*#__PURE__*/function(_Wrapper5){(0,_inherits2.default)(ElseBlockWrapper,_Wrapper5);var _super41=_createSuper(ElseBlockWrapper);function ElseBlockWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _this50;(0,_classCallCheck2.default)(this,ElseBlockWrapper);_this50=_super41.call(this,renderer,block,parent,node);_this50.var=null;_this50.block=block.child({comment:create_debugging_comment(node,_this50.renderer.component),name:_this50.renderer.component.get_unique_name('create_else_block'),type:'else'});_this50.fragment=new FragmentWrapper(renderer,_this50.block,_this50.node.children,parent,strip_whitespace,next_sibling);_this50.is_dynamic=_this50.block.dependencies.size>0;return _this50;}return(0,_createClass2.default)(ElseBlockWrapper);}(Wrapper);var EachBlockWrapper=/*#__PURE__*/function(_Wrapper6){(0,_inherits2.default)(EachBlockWrapper,_Wrapper6);var _super42=_createSuper(EachBlockWrapper);function EachBlockWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _this51;(0,_classCallCheck2.default)(this,EachBlockWrapper);_this51=_super42.call(this,renderer,block,parent,node);_this51.updates=[];_this51.var={type:'Identifier',name:'each'};_this51.cannot_use_innerhtml();_this51.not_static_content();var dependencies=node.expression.dependencies;block.add_dependencies(dependencies);_this51.node.contexts.forEach(function(context){renderer.add_to_context(context.key.name,true);});add_const_tags_context(renderer,_this51.node.const_tags);_this51.block=block.child({comment:create_debugging_comment(_this51.node,_this51.renderer.component),name:renderer.component.get_unique_name('create_each_block'),type:'each',// @ts-ignore todo: probably error\nkey:node.key,bindings:new Map(block.bindings)});// TODO this seems messy\n_this51.block.has_animation=_this51.node.has_animation;_this51.index_name=_this51.node.index?{type:'Identifier',name:_this51.node.index}:renderer.component.get_unique_name(\"\".concat(_this51.node.context,\"_index\"));var fixed_length=node.expression.node.type==='ArrayExpression'&&node.expression.node.elements.every(function(element){return element.type!=='SpreadElement';})?node.expression.node.elements.length:null;// hack the sourcemap, so that if data is missing the bug\n// is easy to find\nvar c=_this51.node.start+2;while(renderer.component.source[c]!=='e'){c+=1;}var start=renderer.component.locate(c);var end={line:start.line,column:start.column+4};var length={type:'Identifier',name:'length',loc:{start:start,end:end}};var each_block_value=renderer.component.get_unique_name(\"\".concat(_this51.var.name,\"_value\"));var iterations=block.get_unique_name(\"\".concat(_this51.var.name,\"_blocks\"));renderer.add_to_context(each_block_value.name,true);renderer.add_to_context(_this51.index_name.name,true);_this51.vars={create_each_block:_this51.block.name,each_block_value:each_block_value,get_each_context:renderer.component.get_unique_name(\"get_\".concat(_this51.var.name,\"_context\")),iterations:iterations,// optimisation for array literal\nfixed_length:fixed_length,data_length:fixed_length===null?x(_templateObject126||(_templateObject126=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\"\"])),each_block_value,length):fixed_length,view_length:fixed_length===null?x(_templateObject127||(_templateObject127=(0,_taggedTemplateLiteral2.default)([\"\",\".length\"])),iterations):fixed_length};var object=get_object(node.expression.node);var store=object.type==='Identifier'&&object.name[0]==='$'?object.name.slice(1):null;node.contexts.forEach(function(prop){_this51.block.bindings.set(prop.key.name,{object:_this51.vars.each_block_value,property:_this51.index_name,modifier:prop.modifier,snippet:prop.modifier(x(_templateObject128||(_templateObject128=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),_this51.vars.each_block_value,_this51.index_name)),store:store});});if(_this51.node.index){_this51.block.get_unique_name(_this51.node.index);// this prevents name collisions (#1254)\n}renderer.blocks.push(_this51.block);_this51.fragment=new FragmentWrapper(renderer,_this51.block,node.children,(0,_assertThisInitialized2.default)(_this51),strip_whitespace,next_sibling);if(_this51.node.else){_this51.else=new ElseBlockWrapper(renderer,block,(0,_assertThisInitialized2.default)(_this51),_this51.node.else,strip_whitespace,next_sibling);renderer.blocks.push(_this51.else.block);if(_this51.else.is_dynamic){_this51.block.add_dependencies(_this51.else.block.dependencies);}}block.add_dependencies(_this51.block.dependencies);if(_this51.block.has_outros||_this51.else&&_this51.else.block.has_outros){block.add_outro();}return _this51;}(0,_createClass2.default)(EachBlockWrapper,[{key:\"render\",value:function render(block,parent_node,parent_nodes){if(this.fragment.nodes.length===0)return;var renderer=this.renderer;var component=renderer.component;var needs_anchor=this.next?!this.next.is_dom_node():!parent_node||!this.parent.is_dom_node();var snippet=this.node.expression.manipulate(block);block.chunks.init.push(b(_templateObject129||(_templateObject129=(0,_taggedTemplateLiteral2.default)([\"let \",\" = \",\";\"])),this.vars.each_block_value,snippet));if(this.renderer.options.dev){block.chunks.init.push(b(_templateObject130||(_templateObject130=(0,_taggedTemplateLiteral2.default)([\"@validate_each_argument(\",\");\"])),this.vars.each_block_value));}var initial_anchor_node={type:'Identifier',name:parent_node?'null':'#anchor'};var initial_mount_node=parent_node||{type:'Identifier',name:'#target'};var update_anchor_node=needs_anchor?block.get_unique_name(\"\".concat(this.var.name,\"_anchor\")):this.next&&this.next.var||{type:'Identifier',name:'null'};var update_mount_node=this.get_update_mount_node(update_anchor_node);var args={block:block,parent_node:parent_node,parent_nodes:parent_nodes,snippet:snippet,initial_anchor_node:initial_anchor_node,initial_mount_node:initial_mount_node,update_anchor_node:update_anchor_node,update_mount_node:update_mount_node};var all_dependencies=new Set(this.block.dependencies);// TODO should be dynamic deps only\nthis.node.expression.dynamic_dependencies().forEach(function(dependency){all_dependencies.add(dependency);});if(this.node.key){this.node.key.dynamic_dependencies().forEach(function(dependency){all_dependencies.add(dependency);});}this.dependencies=all_dependencies;if(this.node.key){this.render_keyed(args);}else{this.render_unkeyed(args);}if(this.block.has_intro_method||this.block.has_outro_method){block.chunks.intro.push(b(_templateObject131||(_templateObject131=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\\t@transition_in(\",\"[#i]);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),this.vars.data_length,this.vars.iterations));}if(needs_anchor){block.add_element(update_anchor_node,x(_templateObject132||(_templateObject132=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),parent_nodes&&x(_templateObject133||(_templateObject133=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),parent_node);}if(this.else){var each_block_else=component.get_unique_name(\"\".concat(this.var.name,\"_else\"));block.chunks.init.push(b(_templateObject134||(_templateObject134=(0,_taggedTemplateLiteral2.default)([\"let \",\" = null;\"])),each_block_else));// TODO neaten this up... will end up with an empty line in the block\nblock.chunks.init.push(b(_templateObject135||(_templateObject135=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (!\",\") {\\n\\t\\t\\t\\t\\t\",\" = \",\"(#ctx);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),this.vars.data_length,each_block_else,this.else.block.name));block.chunks.create.push(b(_templateObject136||(_templateObject136=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\".c();\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),each_block_else,each_block_else));if(this.renderer.options.hydratable){block.chunks.claim.push(b(_templateObject137||(_templateObject137=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\".l(\",\");\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),each_block_else,each_block_else,parent_nodes));}block.chunks.mount.push(b(_templateObject138||(_templateObject138=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\".m(\",\", \",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),each_block_else,each_block_else,initial_mount_node,initial_anchor_node));var has_transitions=!!(this.else.block.has_intro_method||this.else.block.has_outro_method);var destroy_block_else=this.else.block.has_outro_method?b(_templateObject139||(_templateObject139=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t@group_outros();\\n\\t\\t\\t\\t\\t@transition_out(\",\", 1, 1, () => {\\n\\t\\t\\t\\t\\t\\t\",\" = null;\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t@check_outros();\"])),each_block_else,each_block_else):b(_templateObject140||(_templateObject140=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\".d(1);\\n\\t\\t\\t\\t\\t\",\" = null;\"])),each_block_else,each_block_else);if(this.else.block.has_update_method){this.updates.push(b(_templateObject141||(_templateObject141=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (!\",\" && \",\") {\\n\\t\\t\\t\\t\\t\\t\",\".p(#ctx, #dirty);\\n\\t\\t\\t\\t\\t} else if (!\",\") {\\n\\t\\t\\t\\t\\t\\t\",\" = \",\"(#ctx);\\n\\t\\t\\t\\t\\t\\t\",\".c();\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\",\".m(\",\", \",\");\\n\\t\\t\\t\\t\\t} else if (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\";\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),this.vars.data_length,each_block_else,each_block_else,this.vars.data_length,each_block_else,this.else.block.name,each_block_else,has_transitions&&b(_templateObject142||(_templateObject142=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\", 1);\"])),each_block_else),each_block_else,update_mount_node,update_anchor_node,each_block_else,destroy_block_else));}else{this.updates.push(b(_templateObject143||(_templateObject143=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\\t\",\";\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t} else if (!\",\") {\\n\\t\\t\\t\\t\\t\\t\",\" = \",\"(#ctx);\\n\\t\\t\\t\\t\\t\\t\",\".c();\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\",\".m(\",\", \",\");\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),this.vars.data_length,each_block_else,destroy_block_else,each_block_else,each_block_else,this.else.block.name,each_block_else,has_transitions&&b(_templateObject144||(_templateObject144=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\", 1);\"])),each_block_else),each_block_else,update_mount_node,update_anchor_node));}block.chunks.destroy.push(b(_templateObject145||(_templateObject145=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") \",\".d(\",\");\\n\\t\\t\\t\"])),each_block_else,each_block_else,parent_node?'':'detaching'));}if(this.updates.length){block.chunks.update.push(b(_templateObject146||(_templateObject146=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),block.renderer.dirty(Array.from(all_dependencies)),this.updates));}this.fragment.render(this.block,null,x(_templateObject147||(_templateObject147=(0,_taggedTemplateLiteral2.default)([\"#nodes\"]))));if(this.else){this.else.fragment.render(this.else.block,null,x(_templateObject148||(_templateObject148=(0,_taggedTemplateLiteral2.default)([\"#nodes\"]))));}this.context_props=this.node.contexts.map(function(prop){return b(_templateObject149||(_templateObject149=(0,_taggedTemplateLiteral2.default)([\"child_ctx[\",\"] = \",\";\"])),renderer.context_lookup.get(prop.key.name).index,prop.default_modifier(prop.modifier(x(_templateObject150||(_templateObject150=(0,_taggedTemplateLiteral2.default)([\"list[i]\"])))),function(name){return renderer.context_lookup.has(name)?x(_templateObject151||(_templateObject151=(0,_taggedTemplateLiteral2.default)([\"child_ctx[\",\"]\"])),renderer.context_lookup.get(name).index):{type:'Identifier',name:name};}));});if(this.node.has_binding)this.context_props.push(b(_templateObject152||(_templateObject152=(0,_taggedTemplateLiteral2.default)([\"child_ctx[\",\"] = list;\"])),renderer.context_lookup.get(this.vars.each_block_value.name).index));if(this.node.has_binding||this.node.has_index_binding||this.node.index)this.context_props.push(b(_templateObject153||(_templateObject153=(0,_taggedTemplateLiteral2.default)([\"child_ctx[\",\"] = i;\"])),renderer.context_lookup.get(this.index_name.name).index));// TODO which is better — Object.create(array) or array.slice()?\nrenderer.blocks.push(b(_templateObject154||(_templateObject154=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfunction \",\"(#ctx, list, i) {\\n\\t\\t\\t\\tconst child_ctx = #ctx.slice();\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\treturn child_ctx;\\n\\t\\t\\t}\\n\\t\\t\"])),this.vars.get_each_context,this.context_props,add_const_tags(this.block,this.node.const_tags,'child_ctx')));}},{key:\"render_keyed\",value:function render_keyed(_ref6){var block=_ref6.block,parent_node=_ref6.parent_node,parent_nodes=_ref6.parent_nodes,snippet=_ref6.snippet,initial_anchor_node=_ref6.initial_anchor_node,initial_mount_node=_ref6.initial_mount_node,update_anchor_node=_ref6.update_anchor_node,update_mount_node=_ref6.update_mount_node;var _this$vars=this.vars,create_each_block=_this$vars.create_each_block,iterations=_this$vars.iterations,data_length=_this$vars.data_length,view_length=_this$vars.view_length;var get_key=block.get_unique_name('get_key');var lookup=block.get_unique_name(\"\".concat(this.var.name,\"_lookup\"));block.add_variable(iterations,x(_templateObject155||(_templateObject155=(0,_taggedTemplateLiteral2.default)([\"[]\"]))));block.add_variable(lookup,x(_templateObject156||(_templateObject156=(0,_taggedTemplateLiteral2.default)([\"new @_Map()\"]))));if(this.fragment.nodes[0].is_dom_node()){this.block.first=this.fragment.nodes[0].var;}else{this.block.first=this.block.get_unique_name('first');this.block.add_element(this.block.first,x(_templateObject157||(_templateObject157=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),parent_nodes&&x(_templateObject158||(_templateObject158=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),null);}block.chunks.init.push(b(_templateObject159||(_templateObject159=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tconst \",\" = #ctx => \",\";\\n\\n\\t\\t\\t\",\"\\n\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\tlet child_ctx = \",\"(#ctx, \",\", #i);\\n\\t\\t\\t\\tlet key = \",\"(child_ctx);\\n\\t\\t\\t\\t\",\".set(key, \",\"[#i] = \",\"(key, child_ctx));\\n\\t\\t\\t}\\n\\t\\t\"])),get_key,this.node.key.manipulate(block),this.renderer.options.dev&&b(_templateObject160||(_templateObject160=(0,_taggedTemplateLiteral2.default)([\"@validate_each_keys(#ctx, \",\", \",\", \",\");\"])),this.vars.each_block_value,this.vars.get_each_context,get_key),data_length,this.vars.get_each_context,this.vars.each_block_value,get_key,lookup,iterations,create_each_block));block.chunks.create.push(b(_templateObject161||(_templateObject161=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\",\"[#i].c();\\n\\t\\t\\t}\\n\\t\\t\"])),view_length,iterations));if(parent_nodes&&this.renderer.options.hydratable){block.chunks.claim.push(b(_templateObject162||(_templateObject162=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\\t\",\"[#i].l(\",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),view_length,iterations,parent_nodes));}block.chunks.mount.push(b(_templateObject163||(_templateObject163=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\",\"[#i].m(\",\", \",\");\\n\\t\\t\\t}\\n\\t\\t\"])),view_length,iterations,initial_mount_node,initial_anchor_node));var dynamic=this.block.has_update_method;var destroy=this.node.has_animation?this.block.has_outros?'@fix_and_outro_and_destroy_block':'@fix_and_destroy_block':this.block.has_outros?'@outro_and_destroy_block':'@destroy_block';if(this.dependencies.size){this.block.maintain_context=true;this.updates.push(b(_templateObject164||(_templateObject164=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\" = \",\";\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\" = @update_keyed_each(\",\", #dirty, \",\", \",\", #ctx, \",\", \",\", \",\", \",\", \",\", \",\", \",\");\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\"])),this.vars.each_block_value,snippet,this.renderer.options.dev&&b(_templateObject165||(_templateObject165=(0,_taggedTemplateLiteral2.default)([\"@validate_each_argument(\",\");\"])),this.vars.each_block_value),this.block.has_outros&&b(_templateObject166||(_templateObject166=(0,_taggedTemplateLiteral2.default)([\"@group_outros();\"]))),this.node.has_animation&&b(_templateObject167||(_templateObject167=(0,_taggedTemplateLiteral2.default)([\"for (let #i = 0; #i < \",\"; #i += 1) \",\"[#i].r();\"])),view_length,iterations),this.renderer.options.dev&&b(_templateObject168||(_templateObject168=(0,_taggedTemplateLiteral2.default)([\"@validate_each_keys(#ctx, \",\", \",\", \",\");\"])),this.vars.each_block_value,this.vars.get_each_context,get_key),iterations,iterations,get_key,dynamic?1:0,this.vars.each_block_value,lookup,update_mount_node,destroy,create_each_block,update_anchor_node,this.vars.get_each_context,this.node.has_animation&&b(_templateObject169||(_templateObject169=(0,_taggedTemplateLiteral2.default)([\"for (let #i = 0; #i < \",\"; #i += 1) \",\"[#i].a();\"])),view_length,iterations),this.block.has_outros&&b(_templateObject170||(_templateObject170=(0,_taggedTemplateLiteral2.default)([\"@check_outros();\"])))));}if(this.block.has_outros){block.chunks.outro.push(b(_templateObject171||(_templateObject171=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\\t@transition_out(\",\"[#i]);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),view_length,iterations));}block.chunks.destroy.push(b(_templateObject172||(_templateObject172=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\",\"[#i].d(\",\");\\n\\t\\t\\t}\\n\\t\\t\"])),view_length,iterations,parent_node?null:'detaching'));}},{key:\"render_unkeyed\",value:function render_unkeyed(_ref7){var block=_ref7.block,parent_nodes=_ref7.parent_nodes,snippet=_ref7.snippet,initial_anchor_node=_ref7.initial_anchor_node,initial_mount_node=_ref7.initial_mount_node,update_anchor_node=_ref7.update_anchor_node,update_mount_node=_ref7.update_mount_node;var _this$vars2=this.vars,create_each_block=_this$vars2.create_each_block,iterations=_this$vars2.iterations,fixed_length=_this$vars2.fixed_length,data_length=_this$vars2.data_length,view_length=_this$vars2.view_length;block.chunks.init.push(b(_templateObject173||(_templateObject173=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tlet \",\" = [];\\n\\n\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\",\"[#i] = \",\"(\",\"(#ctx, \",\", #i));\\n\\t\\t\\t}\\n\\t\\t\"])),iterations,data_length,iterations,create_each_block,this.vars.get_each_context,this.vars.each_block_value));block.chunks.create.push(b(_templateObject174||(_templateObject174=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\",\"[#i].c();\\n\\t\\t\\t}\\n\\t\\t\"])),view_length,iterations));if(parent_nodes&&this.renderer.options.hydratable){block.chunks.claim.push(b(_templateObject175||(_templateObject175=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\\t\",\"[#i].l(\",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),view_length,iterations,parent_nodes));}block.chunks.mount.push(b(_templateObject176||(_templateObject176=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\",\"[#i].m(\",\", \",\");\\n\\t\\t\\t}\\n\\t\\t\"])),view_length,iterations,initial_mount_node,initial_anchor_node));if(this.dependencies.size){var has_transitions=!!(this.block.has_intro_method||this.block.has_outro_method);var for_loop_body=this.block.has_update_method?b(_templateObject177||(_templateObject177=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\"[#i]) {\\n\\t\\t\\t\\t\\t\\t\",\"[#i].p(child_ctx, #dirty);\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\t\",\"[#i] = \",\"(child_ctx);\\n\\t\\t\\t\\t\\t\\t\",\"[#i].c();\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\",\"[#i].m(\",\", \",\");\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),iterations,iterations,has_transitions&&b(_templateObject178||(_templateObject178=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\"[#i], 1);\"])),this.vars.iterations),iterations,create_each_block,iterations,has_transitions&&b(_templateObject179||(_templateObject179=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\"[#i], 1);\"])),this.vars.iterations),iterations,update_mount_node,update_anchor_node):has_transitions?b(_templateObject180||(_templateObject180=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (\",\"[#i]) {\\n\\t\\t\\t\\t\\t\\t\\t@transition_in(\",\"[#i], 1);\\n\\t\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\t\\t\",\"[#i] = \",\"(child_ctx);\\n\\t\\t\\t\\t\\t\\t\\t\",\"[#i].c();\\n\\t\\t\\t\\t\\t\\t\\t@transition_in(\",\"[#i], 1);\\n\\t\\t\\t\\t\\t\\t\\t\",\"[#i].m(\",\", \",\");\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\"])),iterations,this.vars.iterations,iterations,create_each_block,iterations,this.vars.iterations,iterations,update_mount_node,update_anchor_node):b(_templateObject181||(_templateObject181=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (!\",\"[#i]) {\\n\\t\\t\\t\\t\\t\\t\\t\",\"[#i] = \",\"(child_ctx);\\n\\t\\t\\t\\t\\t\\t\\t\",\"[#i].c();\\n\\t\\t\\t\\t\\t\\t\\t\",\"[#i].m(\",\", \",\");\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\"])),iterations,iterations,create_each_block,iterations,iterations,update_mount_node,update_anchor_node);var start=this.block.has_update_method?0:'#old_length';var remove_old_blocks;if(this.block.has_outros){var out=block.get_unique_name('out');block.chunks.init.push(b(_templateObject182||(_templateObject182=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tconst \",\" = i => @transition_out(\",\"[i], 1, 1, () => {\\n\\t\\t\\t\\t\\t\\t\",\"[i] = null;\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\"])),out,iterations,iterations));remove_old_blocks=b(_templateObject183||(_templateObject183=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t@group_outros();\\n\\t\\t\\t\\t\\tfor (#i = \",\"; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\\t\\t\",\"(#i);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t@check_outros();\\n\\t\\t\\t\\t\"])),data_length,view_length,out);}else{remove_old_blocks=b(_templateObject184||(_templateObject184=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tfor (\",\"; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\\t\\t\",\"[#i].d(1);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\"])),this.block.has_update_method?null:x(_templateObject185||(_templateObject185=(0,_taggedTemplateLiteral2.default)([\"#i = \",\"\"])),data_length),this.block.has_update_method?view_length:'#old_length',iterations,!fixed_length&&b(_templateObject186||(_templateObject186=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\";\"])),view_length,data_length));}// We declare `i` as block scoped here, as the `remove_old_blocks` code\n// may rely on continuing where this iteration stopped.\nvar update=b(_templateObject187||(_templateObject187=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\" = \",\";\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\tlet #i;\\n\\t\\t\\t\\tfor (#i = \",\"; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\\tconst child_ctx = \",\"(#ctx, \",\", #i);\\n\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\"])),!this.block.has_update_method&&b(_templateObject188||(_templateObject188=(0,_taggedTemplateLiteral2.default)([\"const #old_length = \",\".length;\"])),this.vars.each_block_value),this.vars.each_block_value,snippet,this.renderer.options.dev&&b(_templateObject189||(_templateObject189=(0,_taggedTemplateLiteral2.default)([\"@validate_each_argument(\",\");\"])),this.vars.each_block_value),start,data_length,this.vars.get_each_context,this.vars.each_block_value,for_loop_body,remove_old_blocks);this.updates.push(update);}if(this.block.has_outros){block.chunks.outro.push(b(_templateObject190||(_templateObject190=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\" = \",\".filter(@_Boolean);\\n\\t\\t\\t\\tfor (let #i = 0; #i < \",\"; #i += 1) {\\n\\t\\t\\t\\t\\t@transition_out(\",\"[#i]);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),iterations,iterations,view_length,iterations));}block.chunks.destroy.push(b(_templateObject191||(_templateObject191=(0,_taggedTemplateLiteral2.default)([\"@destroy_each(\",\", detaching);\"])),iterations));}}]);return EachBlockWrapper;}(Wrapper);var TextWrapper=/*#__PURE__*/function(_Wrapper7){(0,_inherits2.default)(TextWrapper,_Wrapper7);var _super43=_createSuper(TextWrapper);function TextWrapper(renderer,block,parent,node,data){var _this52;(0,_classCallCheck2.default)(this,TextWrapper);_this52=_super43.call(this,renderer,block,parent,node);_this52.skip=_this52.node.should_skip();_this52.data=data;_this52.var=_this52.skip?null:x(_templateObject192||(_templateObject192=(0,_taggedTemplateLiteral2.default)([\"t\"])));return _this52;}(0,_createClass2.default)(TextWrapper,[{key:\"use_space\",value:function use_space(){if(this.renderer.component.component_options.preserveWhitespace)return false;if(/[\\S\\u00A0]/.test(this.data))return false;var node=this.parent&&this.parent.node;while(node){if(node.type==='Element'&&node.name==='pre'){return false;}node=node.parent;}return true;}},{key:\"render\",value:function render(block,parent_node,parent_nodes){if(this.skip)return;var use_space=this.use_space();var string_literal={type:'Literal',value:this.data,loc:{start:this.renderer.locate(this.node.start),end:this.renderer.locate(this.node.end)}};block.add_element(this.var,use_space?x(_templateObject193||(_templateObject193=(0,_taggedTemplateLiteral2.default)([\"@space()\"]))):x(_templateObject194||(_templateObject194=(0,_taggedTemplateLiteral2.default)([\"@text(\",\")\"])),string_literal),parent_nodes&&(use_space?x(_templateObject195||(_templateObject195=(0,_taggedTemplateLiteral2.default)([\"@claim_space(\",\")\"])),parent_nodes):x(_templateObject196||(_templateObject196=(0,_taggedTemplateLiteral2.default)([\"@claim_text(\",\", \",\")\"])),parent_nodes,string_literal)),parent_node);}}]);return TextWrapper;}(Wrapper);var svg_attributes='accent-height accumulate additive alignment-baseline allowReorder alphabetic amplitude arabic-form ascent attributeName attributeType autoReverse azimuth baseFrequency baseline-shift baseProfile bbox begin bias by calcMode cap-height class clip clipPathUnits clip-path clip-rule color color-interpolation color-interpolation-filters color-profile color-rendering contentScriptType contentStyleType cursor cx cy d decelerate descent diffuseConstant direction display divisor dominant-baseline dur dx dy edgeMode elevation enable-background end exponent externalResourcesRequired fill fill-opacity fill-rule filter filterRes filterUnits flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight format from fr fx fy g1 g2 glyph-name glyph-orientation-horizontal glyph-orientation-vertical glyphRef gradientTransform gradientUnits hanging height href horiz-adv-x horiz-origin-x id ideographic image-rendering in in2 intercept k k1 k2 k3 k4 kernelMatrix kernelUnitLength kerning keyPoints keySplines keyTimes lang lengthAdjust letter-spacing lighting-color limitingConeAngle local marker-end marker-mid marker-start markerHeight markerUnits markerWidth mask maskContentUnits maskUnits mathematical max media method min mode name numOctaves offset onabort onactivate onbegin onclick onend onerror onfocusin onfocusout onload onmousedown onmousemove onmouseout onmouseover onmouseup onrepeat onresize onscroll onunload opacity operator order orient orientation origin overflow overline-position overline-thickness panose-1 paint-order pathLength patternContentUnits patternTransform patternUnits pointer-events points pointsAtX pointsAtY pointsAtZ preserveAlpha preserveAspectRatio primitiveUnits r radius refX refY rendering-intent repeatCount repeatDur requiredExtensions requiredFeatures restart result rotate rx ry scale seed shape-rendering slope spacing specularConstant specularExponent speed spreadMethod startOffset stdDeviation stemh stemv stitchTiles stop-color stop-opacity strikethrough-position strikethrough-thickness string stroke stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width style surfaceScale systemLanguage tabindex tableValues target targetX targetY text-anchor text-decoration text-rendering textLength to transform type u1 u2 underline-position underline-thickness unicode unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical values version vert-adv-y vert-origin-x vert-origin-y viewBox viewTarget visibility width widths word-spacing writing-mode x x-height x1 x2 xChannelSelector xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type xml:base xml:lang xml:space y y1 y2 yChannelSelector z zoomAndPan'.split(' ');var svg_attribute_lookup=new Map();svg_attributes.forEach(function(name){svg_attribute_lookup.set(name.toLowerCase(),name);});function fix_attribute_casing(name){name=name.toLowerCase();return svg_attribute_lookup.get(name)||name;}function handle_select_value_binding(attr,dependencies){var parent=attr.parent;if(parent.node.name==='select'){parent.select_binding_dependencies=dependencies;dependencies.forEach(function(prop){parent.renderer.component.indirect_dependencies.set(prop,new Set());});}}var non_textlike_input_types=new Set(['button','checkbox','color','date','datetime-local','file','hidden','image','radio','range','reset','submit']);var BaseAttributeWrapper=/*#__PURE__*/function(){function BaseAttributeWrapper(parent,block,node){(0,_classCallCheck2.default)(this,BaseAttributeWrapper);this.node=node;this.parent=parent;if(node.dependencies.size>0){parent.cannot_use_innerhtml();parent.not_static_content();block.add_dependencies(node.dependencies);}}(0,_createClass2.default)(BaseAttributeWrapper,[{key:\"render\",value:function render(_block){}}]);return BaseAttributeWrapper;}();var AttributeWrapper=/*#__PURE__*/function(_BaseAttributeWrapper){(0,_inherits2.default)(AttributeWrapper,_BaseAttributeWrapper);var _super44=_createSuper(AttributeWrapper);function AttributeWrapper(parent,block,node){var _this53;(0,_classCallCheck2.default)(this,AttributeWrapper);_this53=_super44.call(this,parent,block,node);if(node.dependencies.size>0){// special case — <option value={foo}> — see below\nif(_this53.parent.node.name==='option'&&node.name==='value'){var select=_this53.parent;while(select&&(select.node.type!=='Element'||select.node.name!=='select')){// @ts-ignore todo: doublecheck this, but looks to be correct\nselect=select.parent;}if(select&&select.select_binding_dependencies){select.select_binding_dependencies.forEach(function(prop){_this53.node.dependencies.forEach(function(dependency){_this53.parent.renderer.component.indirect_dependencies.get(prop).add(dependency);});});}}if(node.name==='value'){handle_select_value_binding((0,_assertThisInitialized2.default)(_this53),node.dependencies);}}if(_this53.parent.node.namespace==namespaces.foreign){// leave attribute case alone for elements in the \"foreign\" namespace\n_this53.name=_this53.node.name;_this53.metadata=_this53.get_metadata();_this53.is_indirectly_bound_value=false;_this53.property_name=null;_this53.is_select_value_attribute=false;_this53.is_input_value=false;}else{_this53.name=fix_attribute_casing(_this53.node.name);_this53.metadata=_this53.get_metadata();_this53.is_indirectly_bound_value=is_indirectly_bound_value((0,_assertThisInitialized2.default)(_this53));_this53.property_name=_this53.is_indirectly_bound_value?'__value':_this53.metadata&&_this53.metadata.property_name;_this53.is_select_value_attribute=_this53.name==='value'&&_this53.parent.node.name==='select';_this53.is_input_value=_this53.name==='value'&&_this53.parent.node.name==='input';}// TODO retire this exception in favour of https://github.com/sveltejs/svelte/issues/3750\n_this53.is_src=_this53.name==='src'&&(!_this53.parent.node.namespace||_this53.parent.node.namespace===namespaces.html);_this53.should_cache=should_cache((0,_assertThisInitialized2.default)(_this53));return _this53;}(0,_createClass2.default)(AttributeWrapper,[{key:\"render\",value:function render(block){var element=this.parent;var name=this.name,property_name=this.property_name,should_cache=this.should_cache,is_indirectly_bound_value=this.is_indirectly_bound_value;// xlink is a special case... we could maybe extend this to generic\n// namespaced attributes but I'm not sure that's applicable in\n// HTML5?\nvar method=/-/.test(element.node.name)?'@set_custom_element_data':name.slice(0,6)==='xlink:'?'@xlink_attr':'@attr';var is_legacy_input_type=element.renderer.component.compile_options.legacy&&name==='type'&&this.parent.node.name==='input';var dependencies=this.get_dependencies();var value=this.get_value(block);var updater;var init=this.get_init(block,value);if(is_legacy_input_type){block.chunks.hydrate.push(b(_templateObject197||(_templateObject197=(0,_taggedTemplateLiteral2.default)([\"@set_input_type(\",\", \",\");\"])),element.var,init));updater=b(_templateObject198||(_templateObject198=(0,_taggedTemplateLiteral2.default)([\"@set_input_type(\",\", \",\");\"])),element.var,should_cache?this.last:value);}else if(this.is_select_value_attribute){// annoying special case\nvar is_multiple_select=element.node.get_static_attribute_value('multiple');if(is_multiple_select){updater=b(_templateObject199||(_templateObject199=(0,_taggedTemplateLiteral2.default)([\"@select_options(\",\", \",\");\"])),element.var,value);}else{updater=b(_templateObject200||(_templateObject200=(0,_taggedTemplateLiteral2.default)([\"@select_option(\",\", \",\");\"])),element.var,value);}block.chunks.mount.push(b(_templateObject201||(_templateObject201=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\"])),updater));}else if(this.is_src){block.chunks.hydrate.push(b(_templateObject202||(_templateObject202=(0,_taggedTemplateLiteral2.default)([\"if (!@src_url_equal(\",\".src, \",\")) \",\"(\",\", \\\"\",\"\\\", \",\");\"])),element.var,init,method,element.var,name,this.last));updater=b(_templateObject203||(_templateObject203=(0,_taggedTemplateLiteral2.default)([\"\",\"(\",\", \\\"\",\"\\\", \",\");\"])),method,element.var,name,should_cache?this.last:value);}else if(property_name){block.chunks.hydrate.push(b(_templateObject204||(_templateObject204=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\" = \",\";\"])),element.var,property_name,init));updater=block.renderer.options.dev?b(_templateObject205||(_templateObject205=(0,_taggedTemplateLiteral2.default)([\"@prop_dev(\",\", \\\"\",\"\\\", \",\");\"])),element.var,property_name,should_cache?this.last:value):b(_templateObject206||(_templateObject206=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\" = \",\";\"])),element.var,property_name,should_cache?this.last:value);}else{block.chunks.hydrate.push(b(_templateObject207||(_templateObject207=(0,_taggedTemplateLiteral2.default)([\"\",\"(\",\", \\\"\",\"\\\", \",\");\"])),method,element.var,name,init));updater=b(_templateObject208||(_templateObject208=(0,_taggedTemplateLiteral2.default)([\"\",\"(\",\", \\\"\",\"\\\", \",\");\"])),method,element.var,name,should_cache?this.last:value);}if(is_indirectly_bound_value){var update_value=b(_templateObject209||(_templateObject209=(0,_taggedTemplateLiteral2.default)([\"\",\".value = \",\".__value;\"])),element.var,element.var);block.chunks.hydrate.push(update_value);updater=b(_templateObject210||(_templateObject210=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\";\\n\\t\\t\\t\"])),updater,update_value);}if(dependencies.length>0){var condition=this.get_dom_update_conditions(block,block.renderer.dirty(dependencies));block.chunks.update.push(b(_templateObject211||(_templateObject211=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\"])),condition,updater));}// special case – autofocus. has to be handled in a bit of a weird way\nif(name==='autofocus'){block.autofocus={element_var:element.var,condition_expression:this.node.is_true?undefined:value};}}},{key:\"get_init\",value:function get_init(block,value){this.last=this.should_cache&&block.get_unique_name(\"\".concat(this.parent.var.name,\"_\").concat(this.name.replace(/[^a-zA-Z_$]/g,'_'),\"_value\"));if(this.should_cache)block.add_variable(this.last);return this.should_cache?x(_templateObject212||(_templateObject212=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\"\"])),this.last,value):value;}},{key:\"get_dom_update_conditions\",value:function get_dom_update_conditions(block,dependency_condition){var property_name=this.property_name,should_cache=this.should_cache,last=this.last;var element=this.parent;var value=this.get_value(block);var condition=dependency_condition;if(should_cache){condition=this.is_src?x(_templateObject213||(_templateObject213=(0,_taggedTemplateLiteral2.default)([\"\",\" && (!@src_url_equal(\",\".src, (\",\" = \",\")))\"])),condition,element.var,last,value):x(_templateObject214||(_templateObject214=(0,_taggedTemplateLiteral2.default)([\"\",\" && (\",\" !== (\",\" = \",\"))\"])),condition,last,last,value);}if(this.is_input_value){var type=element.node.get_static_attribute_value('type');if(type!==true&&!non_textlike_input_types.has(type)){condition=x(_templateObject215||(_templateObject215=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\".\",\" !== \",\"\"])),condition,element.var,property_name,should_cache?last:value);}}if(block.has_outros){condition=x(_templateObject216||(_templateObject216=(0,_taggedTemplateLiteral2.default)([\"!#current || \",\"\"])),condition);}return condition;}},{key:\"get_dependencies\",value:function get_dependencies(){var _this54=this;var node_dependencies=this.node.get_dependencies();var dependencies=new Set(node_dependencies);node_dependencies.forEach(function(prop){var indirect_dependencies=_this54.parent.renderer.component.indirect_dependencies.get(prop);if(indirect_dependencies){indirect_dependencies.forEach(function(indirect_dependency){dependencies.add(indirect_dependency);});}});return Array.from(dependencies);}},{key:\"get_metadata\",value:function get_metadata(){if(this.parent.node.namespace)return null;var metadata=attribute_lookup[this.name];if(metadata&&metadata.applies_to&&!metadata.applies_to.includes(this.parent.node.name))return null;return metadata;}},{key:\"get_value\",value:function get_value(block){if(this.node.is_true){if(this.metadata&&boolean_attribute.has(this.metadata.property_name.toLowerCase())){return x(_templateObject217||(_templateObject217=(0,_taggedTemplateLiteral2.default)([\"true\"])));}return x(_templateObject218||(_templateObject218=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\"\"])));}if(this.node.chunks.length===0)return x(_templateObject219||(_templateObject219=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\"\"])));// TODO some of this code is repeated in Tag.ts — would be good to\n// DRY it out if that's possible without introducing crazy indirection\nif(this.node.chunks.length===1){return this.node.chunks[0].type==='Text'?string_literal(this.node.chunks[0].data):this.node.chunks[0].manipulate(block);}var value=this.node.name==='class'?this.get_class_name_text(block):this.render_chunks(block).reduce(function(lhs,rhs){return x(_templateObject220||(_templateObject220=(0,_taggedTemplateLiteral2.default)([\"\",\" + \",\"\"])),lhs,rhs);});// '{foo} {bar}' — treat as string concatenation\nif(this.node.chunks[0].type!=='Text'){value=x(_templateObject221||(_templateObject221=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\" + \",\"\"])),value);}return value;}},{key:\"get_class_name_text\",value:function get_class_name_text(block){var scoped_css=this.node.chunks.some(function(chunk){return chunk.synthetic;});var rendered=this.render_chunks(block);if(scoped_css&&rendered.length===2){// we have a situation like class={possiblyUndefined}\nrendered[0]=x(_templateObject222||(_templateObject222=(0,_taggedTemplateLiteral2.default)([\"@null_to_empty(\",\")\"])),rendered[0]);}return rendered.reduce(function(lhs,rhs){return x(_templateObject223||(_templateObject223=(0,_taggedTemplateLiteral2.default)([\"\",\" + \",\"\"])),lhs,rhs);});}},{key:\"render_chunks\",value:function render_chunks(block){return this.node.chunks.map(function(chunk){if(chunk.type==='Text'){return string_literal(chunk.data);}return chunk.manipulate(block);});}},{key:\"stringify\",value:function stringify(){if(this.node.is_true)return'';var value=this.node.chunks;if(value.length===0)return'=\"\"';return\"=\\\"\".concat(value.map(function(chunk){return chunk.type==='Text'?chunk.data.replace(/\"/g,'\\\\\"'):\"${\".concat(chunk.manipulate(),\"}\");}).join(''),\"\\\"\");}}]);return AttributeWrapper;}(BaseAttributeWrapper);// source: https://html.spec.whatwg.org/multipage/indices.html\nvar attribute_lookup={allowfullscreen:{property_name:'allowFullscreen',applies_to:['iframe']},allowpaymentrequest:{property_name:'allowPaymentRequest',applies_to:['iframe']},async:{applies_to:['script']},autofocus:{applies_to:['button','input','keygen','select','textarea']},autoplay:{applies_to:['audio','video']},checked:{applies_to:['input']},controls:{applies_to:['audio','video']},default:{applies_to:['track']},defer:{applies_to:['script']},disabled:{applies_to:['button','fieldset','input','keygen','optgroup','option','select','textarea']},formnovalidate:{property_name:'formNoValidate',applies_to:['button','input']},hidden:{},indeterminate:{applies_to:['input']},ismap:{property_name:'isMap',applies_to:['img']},loop:{applies_to:['audio','bgsound','video']},multiple:{applies_to:['input','select']},muted:{applies_to:['audio','video']},nomodule:{property_name:'noModule',applies_to:['script']},novalidate:{property_name:'noValidate',applies_to:['form']},open:{applies_to:['details','dialog']},playsinline:{property_name:'playsInline',applies_to:['video']},readonly:{property_name:'readOnly',applies_to:['input','textarea']},required:{applies_to:['input','select','textarea']},reversed:{applies_to:['ol']},selected:{applies_to:['option']},value:{applies_to:['button','option','input','li','meter','progress','param','select','textarea']}};Object.keys(attribute_lookup).forEach(function(name){var metadata=attribute_lookup[name];if(!metadata.property_name)metadata.property_name=name;});// source: https://html.spec.whatwg.org/multipage/indices.html\nvar boolean_attribute=new Set(['allowfullscreen','allowpaymentrequest','async','autofocus','autoplay','checked','controls','default','defer','disabled','formnovalidate','hidden','ismap','itemscope','loop','multiple','muted','nomodule','novalidate','open','playsinline','readonly','required','reversed','selected']);function should_cache(attribute){return attribute.is_src||attribute.node.should_cache();}function is_indirectly_bound_value(attribute){var element=attribute.parent;return attribute.name==='value'&&(element.node.name==='option'||// TODO check it's actually bound\nelement.node.name==='input'&&element.node.bindings.some(function(binding){return /checked|group/.test(binding.name);}));}var StyleAttributeWrapper=/*#__PURE__*/function(_AttributeWrapper){(0,_inherits2.default)(StyleAttributeWrapper,_AttributeWrapper);var _super45=_createSuper(StyleAttributeWrapper);function StyleAttributeWrapper(){(0,_classCallCheck2.default)(this,StyleAttributeWrapper);return _super45.apply(this,arguments);}(0,_createClass2.default)(StyleAttributeWrapper,[{key:\"render\",value:function render(block){var _this55=this;var style_props=optimize_style(this.node.chunks);if(!style_props)return(0,_get2.default)((0,_getPrototypeOf2.default)(StyleAttributeWrapper.prototype),\"render\",this).call(this,block);style_props.forEach(function(prop){var value;if(is_dynamic$1(prop.value)){var prop_dependencies=new Set();value=prop.value.map(function(chunk){if(chunk.type==='Text'){return string_literal(chunk.data);}else{add_to_set(prop_dependencies,chunk.dynamic_dependencies());return chunk.manipulate(block);}}).reduce(function(lhs,rhs){return x(_templateObject224||(_templateObject224=(0,_taggedTemplateLiteral2.default)([\"\",\" + \",\"\"])),lhs,rhs);});// TODO is this necessary? style.setProperty always treats value as string, no?\n// if (prop.value.length === 1 || prop.value[0].type !== 'Text') {\n// \tvalue = x`\"\" + ${value}`;\n// }\nif(prop_dependencies.size){var condition=block.renderer.dirty(Array.from(prop_dependencies));if(block.has_outros){condition=x(_templateObject225||(_templateObject225=(0,_taggedTemplateLiteral2.default)([\"!#current || \",\"\"])),condition);}var update=b(_templateObject226||(_templateObject226=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\\t@set_style(\",\", \\\"\",\"\\\", \",\", \",\");\\n\\t\\t\\t\\t\\t\\t}\"])),condition,_this55.parent.var,prop.key,value,prop.important?1:null);block.chunks.update.push(update);}}else{value=string_literal(prop.value[0].data);}block.chunks.hydrate.push(b(_templateObject227||(_templateObject227=(0,_taggedTemplateLiteral2.default)([\"@set_style(\",\", \\\"\",\"\\\", \",\", \",\");\"])),_this55.parent.var,prop.key,value,prop.important?1:null));});}}]);return StyleAttributeWrapper;}(AttributeWrapper);function optimize_style(value){var props=[];var chunks=value.slice();while(chunks.length){var chunk=chunks[0];if(chunk.type!=='Text')return null;var key_match=/^\\s*([\\w-]+):\\s*/.exec(chunk.data);if(!key_match)return null;var key=key_match[1];var offset=key_match.index+key_match[0].length;var remaining_data=chunk.data.slice(offset);if(remaining_data){chunks[0]={start:chunk.start+offset,end:chunk.end,type:'Text',data:remaining_data};}else{chunks.shift();}var result=get_style_value(chunks);props.push({key:key,value:result.value,important:result.important});chunks=result.chunks;}return props;}function get_style_value(chunks){var value=[];var in_url=false;var quote_mark=null;var escaped=false;var closed=false;while(chunks.length&&!closed){var chunk=chunks.shift();if(chunk.type==='Text'){var _c=0;while(_c<chunk.data.length){var char=chunk.data[_c];if(escaped){escaped=false;}else if(char==='\\\\'){escaped=true;}else if(char===quote_mark){quote_mark=null;}else if(char==='\"'||char===\"'\"){quote_mark=char;}else if(char===')'&&in_url){in_url=false;}else if(char==='u'&&chunk.data.slice(_c,_c+4)==='url('){in_url=true;}else if(char===';'&&!in_url&&!quote_mark){closed=true;break;}_c+=1;}if(_c>0){value.push({type:'Text',start:chunk.start,end:chunk.start+_c,data:chunk.data.slice(0,_c)});}while(/[;\\s]/.test(chunk.data[_c])){_c+=1;}var remaining_data=chunk.data.slice(_c);if(remaining_data){chunks.unshift({start:chunk.start+_c,end:chunk.end,type:'Text',data:remaining_data});break;}}else{value.push(chunk);}}var important=false;var last_chunk=value[value.length-1];if(last_chunk&&last_chunk.type==='Text'&&/\\s*!important\\s*$/.test(last_chunk.data)){important=true;last_chunk.data=last_chunk.data.replace(/\\s*!important\\s*$/,'');if(!last_chunk.data)value.pop();}return{chunks:chunks,value:value,important:important};}function is_dynamic$1(value){return value.length>1||value[0].type!=='Text';}var SpreadAttributeWrapper=/*#__PURE__*/function(_BaseAttributeWrapper2){(0,_inherits2.default)(SpreadAttributeWrapper,_BaseAttributeWrapper2);var _super46=_createSuper(SpreadAttributeWrapper);function SpreadAttributeWrapper(){(0,_classCallCheck2.default)(this,SpreadAttributeWrapper);return _super46.apply(this,arguments);}return(0,_createClass2.default)(SpreadAttributeWrapper);}(BaseAttributeWrapper);function mark_each_block_bindings(parent,binding){// we need to ensure that the each block creates a context including\n// the list and the index, if they're not otherwise referenced\nbinding.expression.references.forEach(function(name){var each_block=parent.node.scope.get_owner(name);if(each_block){each_block.has_binding=true;}});if(binding.name==='group'){var add_index_binding=function add_index_binding(name){var each_block=parent.node.scope.get_owner(name);if(each_block.type==='EachBlock'){each_block.has_index_binding=true;var _iterator2=_createForOfIteratorHelper(each_block.expression.contextual_dependencies),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var dep=_step2.value;add_index_binding(dep);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}};// for `<input bind:group={} >`, we make sure that all the each blocks creates context with `index`\nvar _iterator3=_createForOfIteratorHelper(binding.expression.contextual_dependencies),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var name=_step3.value;add_index_binding(name);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}}var BindingWrapper=/*#__PURE__*/function(){function BindingWrapper(block,node,parent){(0,_classCallCheck2.default)(this,BindingWrapper);this.node=node;this.parent=parent;var dependencies=this.node.expression.dependencies;block.add_dependencies(dependencies);// TODO does this also apply to e.g. `<input type='checkbox' bind:group='foo'>`?\nhandle_select_value_binding(this,dependencies);if(node.is_contextual){mark_each_block_bindings(this.parent,this.node);}this.object=get_object(this.node.expression.node).name;// view to model\nthis.handler=get_event_handler(this,parent.renderer,block,this.object,this.node.raw_expression);this.snippet=this.node.expression.manipulate(block);this.is_readonly=this.node.is_readonly;this.needs_lock=this.node.name==='currentTime';// TODO others?\n}(0,_createClass2.default)(BindingWrapper,[{key:\"get_dependencies\",value:function get_dependencies(){var _this56=this;var dependencies=new Set(this.node.expression.dependencies);this.node.expression.dependencies.forEach(function(prop){var indirect_dependencies=_this56.parent.renderer.component.indirect_dependencies.get(prop);if(indirect_dependencies){indirect_dependencies.forEach(function(indirect_dependency){dependencies.add(indirect_dependency);});}});return dependencies;}},{key:\"get_update_dependencies\",value:function get_update_dependencies(){var _this57=this;var object=this.object;var dependencies=new Set();if(this.node.expression.template_scope.names.has(object)){this.node.expression.template_scope.dependencies_for_name.get(object).forEach(function(name){return dependencies.add(name);});}else{dependencies.add(object);}var result=new Set(dependencies);dependencies.forEach(function(dependency){var indirect_dependencies=_this57.parent.renderer.component.indirect_dependencies.get(dependency);if(indirect_dependencies){indirect_dependencies.forEach(function(indirect_dependency){result.add(indirect_dependency);});}});return result;}},{key:\"is_readonly_media_attribute\",value:function is_readonly_media_attribute(){return this.node.is_readonly_media_attribute();}},{key:\"render\",value:function render(block,lock){if(this.is_readonly)return;var parent=this.parent;var update_conditions=this.needs_lock?[x(_templateObject228||(_templateObject228=(0,_taggedTemplateLiteral2.default)([\"!\",\"\"])),lock)]:[];var mount_conditions=[];var dependency_array=Array.from(this.get_dependencies());if(dependency_array.length>0){update_conditions.push(block.renderer.dirty(dependency_array));}if(parent.node.name==='input'){var type=parent.node.get_static_attribute_value('type');if(type===null||type===''||type==='text'||type==='email'||type==='password'){update_conditions.push(x(_templateObject229||(_templateObject229=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\" !== \",\"\"])),parent.var,this.node.name,this.snippet));}else if(type==='number'){update_conditions.push(x(_templateObject230||(_templateObject230=(0,_taggedTemplateLiteral2.default)([\"@to_number(\",\".\",\") !== \",\"\"])),parent.var,this.node.name,this.snippet));}}// model to view\nvar update_dom=get_dom_updater(parent,this);var mount_dom=update_dom;// special cases\nswitch(this.node.name){case'group':{var _get_binding_group=get_binding_group(parent.renderer,this.node,block),binding_group=_get_binding_group.binding_group,is_context=_get_binding_group.is_context,contexts=_get_binding_group.contexts,index=_get_binding_group.index,keypath=_get_binding_group.keypath;block.renderer.add_to_context('$$binding_groups');if(is_context&&!block.binding_group_initialised.has(keypath)){if(contexts.length>1){var _binding_group=x(_templateObject231||(_templateObject231=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),block.renderer.reference('$$binding_groups'),index);var _iterator4=_createForOfIteratorHelper(contexts.slice(0,-1)),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var name=_step4.value;_binding_group=x(_templateObject232||(_templateObject232=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),_binding_group,block.renderer.reference(name));block.chunks.init.push(b(_templateObject233||(_templateObject233=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\" || [];\"])),_binding_group,_binding_group));}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}block.chunks.init.push(b(_templateObject234||(_templateObject234=(0,_taggedTemplateLiteral2.default)([\"\",\" = [];\"])),binding_group(true)));block.binding_group_initialised.add(keypath);}block.chunks.hydrate.push(b(_templateObject235||(_templateObject235=(0,_taggedTemplateLiteral2.default)([\"\",\".push(\",\");\"])),binding_group(true),parent.var));block.chunks.destroy.push(b(_templateObject236||(_templateObject236=(0,_taggedTemplateLiteral2.default)([\"\",\".splice(\",\".indexOf(\",\"), 1);\"])),binding_group(true),binding_group(true),parent.var));break;}case'textContent':update_conditions.push(x(_templateObject237||(_templateObject237=(0,_taggedTemplateLiteral2.default)([\"\",\" !== \",\".textContent\"])),this.snippet,parent.var));mount_conditions.push(x(_templateObject238||(_templateObject238=(0,_taggedTemplateLiteral2.default)([\"\",\" !== void 0\"])),this.snippet));break;case'innerHTML':update_conditions.push(x(_templateObject239||(_templateObject239=(0,_taggedTemplateLiteral2.default)([\"\",\" !== \",\".innerHTML\"])),this.snippet,parent.var));mount_conditions.push(x(_templateObject240||(_templateObject240=(0,_taggedTemplateLiteral2.default)([\"\",\" !== void 0\"])),this.snippet));break;case'currentTime':update_conditions.push(x(_templateObject241||(_templateObject241=(0,_taggedTemplateLiteral2.default)([\"!@_isNaN(\",\")\"])),this.snippet));mount_dom=null;break;case'playbackRate':case'volume':update_conditions.push(x(_templateObject242||(_templateObject242=(0,_taggedTemplateLiteral2.default)([\"!@_isNaN(\",\")\"])),this.snippet));mount_conditions.push(x(_templateObject243||(_templateObject243=(0,_taggedTemplateLiteral2.default)([\"!@_isNaN(\",\")\"])),this.snippet));break;case'paused':{// this is necessary to prevent audio restarting by itself\nvar last=block.get_unique_name(\"\".concat(parent.var.name,\"_is_paused\"));block.add_variable(last,x(_templateObject244||(_templateObject244=(0,_taggedTemplateLiteral2.default)([\"true\"]))));update_conditions.push(x(_templateObject245||(_templateObject245=(0,_taggedTemplateLiteral2.default)([\"\",\" !== (\",\" = \",\")\"])),last,last,this.snippet));update_dom=b(_templateObject246||(_templateObject246=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\" ? \\\"pause\\\" : \\\"play\\\"]();\"])),parent.var,last);mount_dom=null;break;}case'value':if(parent.node.get_static_attribute_value('type')==='file'){update_dom=null;mount_dom=null;}}if(update_dom){if(update_conditions.length>0){var condition=update_conditions.reduce(function(lhs,rhs){return x(_templateObject247||(_templateObject247=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\"\"])),lhs,rhs);});block.chunks.update.push(b(_templateObject248||(_templateObject248=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),condition,update_dom));}else{block.chunks.update.push(update_dom);}}if(mount_dom){if(mount_conditions.length>0){var _condition=mount_conditions.reduce(function(lhs,rhs){return x(_templateObject249||(_templateObject249=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\"\"])),lhs,rhs);});block.chunks.mount.push(b(_templateObject250||(_templateObject250=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),_condition,mount_dom));}else{block.chunks.mount.push(mount_dom);}}}}]);return BindingWrapper;}();function get_dom_updater(element,binding){var node=element.node;if(binding.is_readonly_media_attribute()){return null;}if(binding.node.name==='this'){return null;}if(node.name==='select'){return node.get_static_attribute_value('multiple')===true?b(_templateObject251||(_templateObject251=(0,_taggedTemplateLiteral2.default)([\"@select_options(\",\", \",\")\"])),element.var,binding.snippet):b(_templateObject252||(_templateObject252=(0,_taggedTemplateLiteral2.default)([\"@select_option(\",\", \",\")\"])),element.var,binding.snippet);}if(binding.node.name==='group'){var type=node.get_static_attribute_value('type');var condition=type==='checkbox'?x(_templateObject253||(_templateObject253=(0,_taggedTemplateLiteral2.default)([\"~\",\".indexOf(\",\".__value)\"])),binding.snippet,element.var):x(_templateObject254||(_templateObject254=(0,_taggedTemplateLiteral2.default)([\"\",\".__value === \",\"\"])),element.var,binding.snippet);return b(_templateObject255||(_templateObject255=(0,_taggedTemplateLiteral2.default)([\"\",\".checked = \",\";\"])),element.var,condition);}if(binding.node.name==='value'){return b(_templateObject256||(_templateObject256=(0,_taggedTemplateLiteral2.default)([\"@set_input_value(\",\", \",\");\"])),element.var,binding.snippet);}return b(_templateObject257||(_templateObject257=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\" = \",\";\"])),element.var,binding.node.name,binding.snippet);}function get_binding_group(renderer,value,block){var _flatten_reference5=flatten_reference(value.raw_expression),parts=_flatten_reference5.parts;var keypath=parts.join('.');var contexts=[];var contextual_dependencies=new Set();var template_scope=value.expression.template_scope;var add_contextual_dependency=function add_contextual_dependency(dep){contextual_dependencies.add(dep);var owner=template_scope.get_owner(dep);if(owner.type==='EachBlock'){var _iterator5=_createForOfIteratorHelper(owner.expression.contextual_dependencies),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _dep=_step5.value;add_contextual_dependency(_dep);}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}}};var _iterator6=_createForOfIteratorHelper(value.expression.contextual_dependencies),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var dep=_step6.value;add_contextual_dependency(dep);}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}var _iterator7=_createForOfIteratorHelper(contextual_dependencies),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var _dep2=_step7.value;var context=block.bindings.get(_dep2);var key=void 0;var name=void 0;if(context){key=context.object.name;name=context.property.name;}else{key=_dep2;name=_dep2;}keypath=\"\".concat(key,\"@\").concat(keypath);contexts.push(name);}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}if(!renderer.binding_groups.has(keypath)){var index=renderer.binding_groups.size;contexts.forEach(function(context){renderer.add_to_context(context,true);});renderer.binding_groups.set(keypath,{binding_group:function binding_group(){var to_reference=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var binding_group='$$binding_groups';var _secondary_indexes=contexts;if(to_reference){binding_group=block.renderer.reference(binding_group);_secondary_indexes=_secondary_indexes.map(function(name){return block.renderer.reference(name);});}if(_secondary_indexes.length>0){var obj=x(_templateObject258||(_templateObject258=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),binding_group,index);_secondary_indexes.forEach(function(secondary_index){obj=x(_templateObject259||(_templateObject259=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),obj,secondary_index);});return obj;}else{return x(_templateObject260||(_templateObject260=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),binding_group,index);}},is_context:contexts.length>0,contexts:contexts,index:index,keypath:keypath});}return renderer.binding_groups.get(keypath);}function get_event_handler(binding,renderer,block,name,lhs){var contextual_dependencies=new Set(binding.node.expression.contextual_dependencies);var context=block.bindings.get(name);var set_store;if(context){var object=context.object,property=context.property,store=context.store,snippet=context.snippet;lhs=replace_object(lhs,snippet);contextual_dependencies.add(object.name);contextual_dependencies.add(property.name);contextual_dependencies.delete(name);if(store){set_store=b(_templateObject261||(_templateObject261=(0,_taggedTemplateLiteral2.default)([\"\",\".set(\",\");\"])),store,\"$\".concat(store));}}else{var _object=get_object(lhs);if(_object.name[0]==='$'){var _store=_object.name.slice(1);set_store=b(_templateObject262||(_templateObject262=(0,_taggedTemplateLiteral2.default)([\"\",\".set(\",\");\"])),_store,_object.name);}}var value=get_value_from_dom(renderer,binding.parent,binding,block,contextual_dependencies);var mutation=b(_templateObject263||(_templateObject263=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\",\" = \",\";\\n\\t\\t\",\"\\n\\t\"])),lhs,value,set_store);return{uses_context:binding.node.is_contextual||binding.node.expression.uses_context,mutation:mutation,contextual_dependencies:contextual_dependencies,lhs:lhs};}function get_value_from_dom(renderer,element,binding,block,contextual_dependencies){var node=element.node;var name=binding.node.name;if(name==='this'){return x(_templateObject264||(_templateObject264=(0,_taggedTemplateLiteral2.default)([\"$$value\"])));}// <select bind:value='selected>\nif(node.name==='select'){return node.get_static_attribute_value('multiple')===true?x(_templateObject265||(_templateObject265=(0,_taggedTemplateLiteral2.default)([\"@select_multiple_value(this)\"]))):x(_templateObject266||(_templateObject266=(0,_taggedTemplateLiteral2.default)([\"@select_value(this)\"])));}var type=node.get_static_attribute_value('type');// <input type='checkbox' bind:group='foo'>\nif(name==='group'){if(type==='checkbox'){var _get_binding_group2=get_binding_group(renderer,binding.node,block),binding_group=_get_binding_group2.binding_group,contexts=_get_binding_group2.contexts;add_to_set(contextual_dependencies,contexts);return x(_templateObject267||(_templateObject267=(0,_taggedTemplateLiteral2.default)([\"@get_binding_group_value(\",\", this.__value, this.checked)\"])),binding_group());}return x(_templateObject268||(_templateObject268=(0,_taggedTemplateLiteral2.default)([\"this.__value\"])));}// <input type='range|number' bind:value>\nif(type==='range'||type==='number'){return x(_templateObject269||(_templateObject269=(0,_taggedTemplateLiteral2.default)([\"@to_number(this.\",\")\"])),name);}if(name==='buffered'||name==='seekable'||name==='played'){return x(_templateObject270||(_templateObject270=(0,_taggedTemplateLiteral2.default)([\"@time_ranges_to_array(this.\",\")\"])),name);}// everything else\nreturn x(_templateObject271||(_templateObject271=(0,_taggedTemplateLiteral2.default)([\"this.\",\"\"])),name);}function compare_node(a,b){if(a===b)return true;if(!a||!b)return false;if(a.type!==b.type)return false;switch(a.type){case'Identifier':return a.name===b.name;case'MemberExpression':return compare_node(a.object,b.object)&&compare_node(a.property,b.property)&&a.computed===b.computed;case'Literal':return a.value===b.value;}}function bind_this(component,block,binding,variable){var fn=component.get_unique_name(\"\".concat(variable.name,\"_binding\"));block.renderer.add_to_context(fn.name);var callee=block.renderer.reference(fn.name);var _binding$handler=binding.handler,contextual_dependencies=_binding$handler.contextual_dependencies,mutation=_binding$handler.mutation;var dependencies=binding.get_update_dependencies();var body=b(_templateObject272||(_templateObject272=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\",\"\\n\\t\\t\",\"\\n\\t\"])),mutation,Array.from(dependencies).filter(function(dep){return dep[0]!=='$';}).filter(function(dep){return!contextual_dependencies.has(dep);}).map(function(dep){return b(_templateObject273||(_templateObject273=(0,_taggedTemplateLiteral2.default)([\"\",\";\"])),block.renderer.invalidate(dep));}));if(contextual_dependencies.size){var params=Array.from(contextual_dependencies).map(function(name){return{type:'Identifier',name:name};});component.partly_hoisted.push(b(_templateObject274||(_templateObject274=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfunction \",\"($$value, \",\") {\\n\\t\\t\\t\\t@binding_callbacks[$$value ? 'unshift' : 'push'](() => {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t});\\n\\t\\t\\t}\\n\\t\\t\"])),fn,params,body));var alias_map=new Map();var args=[];var _iterator8=_createForOfIteratorHelper(params),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var _id2=_step8.value;var _value10=block.renderer.reference(_id2.name);var found=false;if(block.variables.has(_id2.name)){var alias=_id2.name;for(var _i37=1;block.variables.has(alias)&&!compare_node(block.variables.get(alias).init,_value10);alias=\"\".concat(_id2.name,\"_\").concat(_i37++)){;}alias_map.set(alias,_id2.name);_id2={type:'Identifier',name:alias};found=block.variables.has(alias);}args.push(_id2);if(!found){block.add_variable(_id2,_value10);}}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}var assign=block.get_unique_name(\"assign_\".concat(variable.name));var unassign=block.get_unique_name(\"unassign_\".concat(variable.name));block.chunks.init.push(b(_templateObject275||(_templateObject275=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tconst \",\" = () => \",\"(\",\", \",\");\\n\\t\\t\\tconst \",\" = () => \",\"(null, \",\");\\n\\t\\t\"])),assign,callee,variable,args,unassign,callee,args));var condition=Array.from(args).map(function(name){return x(_templateObject276||(_templateObject276=(0,_taggedTemplateLiteral2.default)([\"\",\" !== \",\"\"])),name,block.renderer.reference(alias_map.get(name.name)||name.name));}).reduce(function(lhs,rhs){return x(_templateObject277||(_templateObject277=(0,_taggedTemplateLiteral2.default)([\"\",\" || \",\"\"])),lhs,rhs);});// we push unassign and unshift assign so that references are\n// nulled out before they're created, to avoid glitches\n// with shifting indices\nblock.chunks.update.push(b(_templateObject278||(_templateObject278=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\",\"();\\n\\t\\t\\t\\t\",\";\\n\\t\\t\\t\\t\",\"();\\n\\t\\t\\t}\"])),condition,unassign,args.map(function(a){return b(_templateObject279||(_templateObject279=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\"\"])),a,block.renderer.reference(alias_map.get(a.name)||a.name));}),assign));block.chunks.destroy.push(b(_templateObject280||(_templateObject280=(0,_taggedTemplateLiteral2.default)([\"\",\"();\"])),unassign));return b(_templateObject281||(_templateObject281=(0,_taggedTemplateLiteral2.default)([\"\",\"();\"])),assign);}component.partly_hoisted.push(b(_templateObject282||(_templateObject282=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\tfunction \",\"($$value) {\\n\\t\\t\\t@binding_callbacks[$$value ? 'unshift' : 'push'](() => {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t});\\n\\t\\t}\\n\\t\"])),fn,body));block.chunks.destroy.push(b(_templateObject283||(_templateObject283=(0,_taggedTemplateLiteral2.default)([\"\",\"(null);\"])),callee));return b(_templateObject284||(_templateObject284=(0,_taggedTemplateLiteral2.default)([\"\",\"(\",\");\"])),callee,variable);}var Tag$1=/*#__PURE__*/function(_Wrapper8){(0,_inherits2.default)(Tag$1,_Wrapper8);var _super47=_createSuper(Tag$1);function Tag$1(renderer,block,parent,node){var _this58;(0,_classCallCheck2.default)(this,Tag$1);_this58=_super47.call(this,renderer,block,parent,node);_this58.cannot_use_innerhtml();if(!_this58.is_dependencies_static()){_this58.not_static_content();}block.add_dependencies(node.expression.dependencies);return _this58;}(0,_createClass2.default)(Tag$1,[{key:\"is_dependencies_static\",value:function is_dependencies_static(){return this.node.expression.contextual_dependencies.size===0&&this.node.expression.dynamic_dependencies().length===0;}},{key:\"rename_this_method\",value:function rename_this_method(block,update){var dependencies=this.node.expression.dynamic_dependencies();var snippet=this.node.expression.manipulate(block);var value=this.node.should_cache&&block.get_unique_name(\"\".concat(this.var.name,\"_value\"));var content=this.node.should_cache?value:snippet;snippet=x(_templateObject285||(_templateObject285=(0,_taggedTemplateLiteral2.default)([\"\",\" + \\\"\\\"\"])),snippet);if(this.node.should_cache)block.add_variable(value,snippet);// TODO may need to coerce snippet to string\nif(dependencies.length>0){var condition=block.renderer.dirty(dependencies);if(block.has_outros){condition=x(_templateObject286||(_templateObject286=(0,_taggedTemplateLiteral2.default)([\"!#current || \",\"\"])),condition);}var update_cached_value=x(_templateObject287||(_templateObject287=(0,_taggedTemplateLiteral2.default)([\"\",\" !== (\",\" = \",\")\"])),value,value,snippet);if(this.node.should_cache){condition=x(_templateObject288||(_templateObject288=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\"\"])),condition,update_cached_value);}block.chunks.update.push(b(_templateObject289||(_templateObject289=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\"\"])),condition,update(content)));}return{init:content};}}]);return Tag$1;}(Wrapper);var MustacheTagWrapper=/*#__PURE__*/function(_Tag$){(0,_inherits2.default)(MustacheTagWrapper,_Tag$);var _super48=_createSuper(MustacheTagWrapper);function MustacheTagWrapper(renderer,block,parent,node){var _this59;(0,_classCallCheck2.default)(this,MustacheTagWrapper);_this59=_super48.call(this,renderer,block,parent,node);_this59.var={type:'Identifier',name:'t'};return _this59;}(0,_createClass2.default)(MustacheTagWrapper,[{key:\"render\",value:function render(block,parent_node,parent_nodes){var _this60=this;var _this$rename_this_met=this.rename_this_method(block,function(value){return x(_templateObject290||(_templateObject290=(0,_taggedTemplateLiteral2.default)([\"@set_data(\",\", \",\")\"])),_this60.var,value);}),init=_this$rename_this_met.init;block.add_element(this.var,x(_templateObject291||(_templateObject291=(0,_taggedTemplateLiteral2.default)([\"@text(\",\")\"])),init),parent_nodes&&x(_templateObject292||(_templateObject292=(0,_taggedTemplateLiteral2.default)([\"@claim_text(\",\", \",\")\"])),parent_nodes,init),parent_node);}}]);return MustacheTagWrapper;}(Tag$1);var RawMustacheTagWrapper=/*#__PURE__*/function(_Tag$2){(0,_inherits2.default)(RawMustacheTagWrapper,_Tag$2);var _super49=_createSuper(RawMustacheTagWrapper);function RawMustacheTagWrapper(renderer,block,parent,node){var _this61;(0,_classCallCheck2.default)(this,RawMustacheTagWrapper);_this61=_super49.call(this,renderer,block,parent,node);_this61.var={type:'Identifier',name:'raw'};_this61.cannot_use_innerhtml();_this61.not_static_content();return _this61;}(0,_createClass2.default)(RawMustacheTagWrapper,[{key:\"render\",value:function render(block,parent_node,_parent_nodes){var in_head=is_head(parent_node);var can_use_innerhtml=!in_head&&parent_node&&!this.prev&&!this.next;if(can_use_innerhtml){var insert=function insert(content){return b(_templateObject293||(_templateObject293=(0,_taggedTemplateLiteral2.default)([\"\",\".innerHTML = \",\";\"])),parent_node,content)[0];};var _this$rename_this_met2=this.rename_this_method(block,function(content){return insert(content);}),init=_this$rename_this_met2.init;block.chunks.mount.push(insert(init));}else{var needs_anchor=in_head||(this.next?!this.next.is_dom_node():!this.parent||!this.parent.is_dom_node());var html_tag=block.get_unique_name('html_tag');var html_anchor=needs_anchor&&block.get_unique_name('html_anchor');block.add_variable(html_tag);var _this$rename_this_met3=this.rename_this_method(block,function(content){return x(_templateObject294||(_templateObject294=(0,_taggedTemplateLiteral2.default)([\"\",\".p(\",\")\"])),html_tag,content);}),_init=_this$rename_this_met3.init;var update_anchor=needs_anchor?html_anchor:this.next?this.next.var:'null';block.chunks.create.push(b(_templateObject295||(_templateObject295=(0,_taggedTemplateLiteral2.default)([\"\",\" = new @HtmlTag();\"])),html_tag));if(this.renderer.options.hydratable){block.chunks.claim.push(b(_templateObject296||(_templateObject296=(0,_taggedTemplateLiteral2.default)([\"\",\" = @claim_html_tag(\",\");\"])),html_tag,_parent_nodes));}block.chunks.hydrate.push(b(_templateObject297||(_templateObject297=(0,_taggedTemplateLiteral2.default)([\"\",\".a = \",\";\"])),html_tag,update_anchor));block.chunks.mount.push(b(_templateObject298||(_templateObject298=(0,_taggedTemplateLiteral2.default)([\"\",\".m(\",\", \",\", \",\");\"])),html_tag,_init,parent_node||'#target',parent_node?null:'#anchor'));if(needs_anchor){block.add_element(html_anchor,x(_templateObject299||(_templateObject299=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),x(_templateObject300||(_templateObject300=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),parent_node);}if(!parent_node||in_head){block.chunks.destroy.push(b(_templateObject301||(_templateObject301=(0,_taggedTemplateLiteral2.default)([\"if (detaching) \",\".d();\"])),html_tag));}}}}]);return RawMustacheTagWrapper;}(Tag$1);var events=[{event_names:['input'],filter:function filter(node,_name){return node.name==='textarea'||node.name==='input'&&!/radio|checkbox|range|file/.test(node.get_static_attribute_value('type'));}},{event_names:['input'],filter:function filter(node,name){return(name==='textContent'||name==='innerHTML')&&node.attributes.some(function(attribute){return attribute.name==='contenteditable';});}},{event_names:['change'],filter:function filter(node,_name){return node.name==='select'||node.name==='input'&&/radio|checkbox|file/.test(node.get_static_attribute_value('type'));}},{event_names:['change','input'],filter:function filter(node,_name){return node.name==='input'&&node.get_static_attribute_value('type')==='range';}},{event_names:['elementresize'],filter:function filter(_node,name){return dimensions.test(name);}},// media events\n{event_names:['timeupdate'],filter:function filter(node,name){return node.is_media_node()&&(name==='currentTime'||name==='played'||name==='ended');}},{event_names:['durationchange'],filter:function filter(node,name){return node.is_media_node()&&name==='duration';}},{event_names:['play','pause'],filter:function filter(node,name){return node.is_media_node()&&name==='paused';}},{event_names:['progress'],filter:function filter(node,name){return node.is_media_node()&&name==='buffered';}},{event_names:['loadedmetadata'],filter:function filter(node,name){return node.is_media_node()&&(name==='buffered'||name==='seekable');}},{event_names:['volumechange'],filter:function filter(node,name){return node.is_media_node()&&(name==='volume'||name==='muted');}},{event_names:['ratechange'],filter:function filter(node,name){return node.is_media_node()&&name==='playbackRate';}},{event_names:['seeking','seeked'],filter:function filter(node,name){return node.is_media_node()&&name==='seeking';}},{event_names:['ended'],filter:function filter(node,name){return node.is_media_node()&&name==='ended';}},{event_names:['resize'],filter:function filter(node,name){return node.is_media_node()&&(name==='videoHeight'||name==='videoWidth');}},// details event\n{event_names:['toggle'],filter:function filter(node,_name){return node.name==='details';}}];var ElementWrapper=/*#__PURE__*/function(_Wrapper9){(0,_inherits2.default)(ElementWrapper,_Wrapper9);var _super50=_createSuper(ElementWrapper);function ElementWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _this62;(0,_classCallCheck2.default)(this,ElementWrapper);_this62=_super50.call(this,renderer,block,parent,node);_this62.var={type:'Identifier',name:node.name.replace(/[^a-zA-Z0-9_$]/g,'_')};_this62.void=is_void(node.name);_this62.class_dependencies=[];if(_this62.node.children.length){_this62.node.lets.forEach(function(l){extract_names(l.value||l.name).forEach(function(name){renderer.add_to_context(name,true);});});}_this62.attributes=_this62.node.attributes.map(function(attribute){if(attribute.name==='style'){return new StyleAttributeWrapper((0,_assertThisInitialized2.default)(_this62),block,attribute);}if(attribute.type==='Spread'){return new SpreadAttributeWrapper((0,_assertThisInitialized2.default)(_this62),block,attribute);}return new AttributeWrapper((0,_assertThisInitialized2.default)(_this62),block,attribute);});// ordinarily, there'll only be one... but we need to handle\n// the rare case where an element can have multiple bindings,\n// e.g. <audio bind:paused bind:currentTime>\n_this62.bindings=_this62.node.bindings.map(function(binding){return new BindingWrapper(block,binding,(0,_assertThisInitialized2.default)(_this62));});_this62.event_handlers=_this62.node.handlers.map(function(event_handler){return new EventHandlerWrapper(event_handler,(0,_assertThisInitialized2.default)(_this62));});if(node.intro||node.outro){if(node.intro)block.add_intro(node.intro.is_local);if(node.outro)block.add_outro(node.outro.is_local);}if(node.animation){block.add_animation();}// add directive and handler dependencies\n[node.animation,node.outro].concat((0,_toConsumableArray2.default)(node.actions),(0,_toConsumableArray2.default)(node.classes),(0,_toConsumableArray2.default)(node.styles)).forEach(function(directive){if(directive&&directive.expression){block.add_dependencies(directive.expression.dependencies);}});node.handlers.forEach(function(handler){if(handler.expression){block.add_dependencies(handler.expression.dependencies);}});if(_this62.parent){if(node.actions.length>0||node.animation||node.bindings.length>0||node.classes.length>0||node.intro||node.outro||node.handlers.length>0||_this62.node.name==='option'||renderer.options.dev){_this62.parent.cannot_use_innerhtml();// need to use add_location\n_this62.parent.not_static_content();}}_this62.fragment=new FragmentWrapper(renderer,block,node.children,(0,_assertThisInitialized2.default)(_this62),strip_whitespace,next_sibling);return _this62;}(0,_createClass2.default)(ElementWrapper,[{key:\"render\",value:function render(block,parent_node,parent_nodes){var _this63=this;var renderer=this.renderer;if(this.node.name==='noscript')return;var node=this.var;var nodes=parent_nodes&&block.get_unique_name(\"\".concat(this.var.name,\"_nodes\"));// if we're in unclaimable territory, i.e. <head>, parent_nodes is null\nvar children=x(_templateObject302||(_templateObject302=(0,_taggedTemplateLiteral2.default)([\"@children(\",\")\"])),this.node.name==='template'?x(_templateObject303||(_templateObject303=(0,_taggedTemplateLiteral2.default)([\"\",\".content\"])),node):node);block.add_variable(node);var render_statement=this.get_render_statement(block);block.chunks.create.push(b(_templateObject304||(_templateObject304=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\";\"])),node,render_statement));if(renderer.options.hydratable){if(parent_nodes){block.chunks.claim.push(b(_templateObject305||(_templateObject305=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\" = \",\";\\n\\t\\t\\t\\t\"])),node,this.get_claim_statement(parent_nodes)));if(!this.void&&this.node.children.length>0){block.chunks.claim.push(b(_templateObject306||(_templateObject306=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tvar \",\" = \",\";\\n\\t\\t\\t\\t\\t\"])),nodes,children));}}else{block.chunks.claim.push(b(_templateObject307||(_templateObject307=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\";\"])),node,render_statement));}}if(parent_node){var append=b(_templateObject308||(_templateObject308=(0,_taggedTemplateLiteral2.default)([\"@append(\",\", \",\");\"])),parent_node,node);append[0].expression.callee.loc={start:this.renderer.locate(this.node.start),end:this.renderer.locate(this.node.end)};block.chunks.mount.push(append);if(is_head(parent_node)){block.chunks.destroy.push(b(_templateObject309||(_templateObject309=(0,_taggedTemplateLiteral2.default)([\"@detach(\",\");\"])),node));}}else{var insert=b(_templateObject310||(_templateObject310=(0,_taggedTemplateLiteral2.default)([\"@insert(#target, \",\", #anchor);\"])),node);insert[0].expression.callee.loc={start:this.renderer.locate(this.node.start),end:this.renderer.locate(this.node.end)};block.chunks.mount.push(insert);// TODO we eventually need to consider what happens to elements\n// that belong to the same outgroup as an outroing element...\nblock.chunks.destroy.push(b(_templateObject311||(_templateObject311=(0,_taggedTemplateLiteral2.default)([\"if (detaching) @detach(\",\");\"])),node));}// insert static children with textContent or innerHTML\nvar can_use_textcontent=this.can_use_textcontent();if(!this.node.namespace&&(this.can_use_innerhtml||can_use_textcontent)&&this.fragment.nodes.length>0){if(this.fragment.nodes.length===1&&this.fragment.nodes[0].node.type==='Text'){block.chunks.create.push(b(_templateObject312||(_templateObject312=(0,_taggedTemplateLiteral2.default)([\"\",\".textContent = \",\";\"])),node,string_literal(this.fragment.nodes[0].data)));}else{var state={quasi:{type:'TemplateElement',value:{raw:''}}};var _literal={type:'TemplateLiteral',expressions:[],quasis:[]};var can_use_raw_text=!this.can_use_innerhtml&&can_use_textcontent;to_html(this.fragment.nodes,block,_literal,state,can_use_raw_text);_literal.quasis.push(state.quasi);block.chunks.create.push(b(_templateObject313||(_templateObject313=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\" = \",\";\"])),node,this.can_use_innerhtml?'innerHTML':'textContent',_literal));}}else{this.fragment.nodes.forEach(function(child){child.render(block,_this63.node.name==='template'?x(_templateObject314||(_templateObject314=(0,_taggedTemplateLiteral2.default)([\"\",\".content\"])),node):node,nodes);});}var event_handler_or_binding_uses_context=this.bindings.some(function(binding){return binding.handler.uses_context;})||this.node.handlers.some(function(handler){return handler.uses_context;})||this.node.actions.some(function(action){return action.uses_context;});if(event_handler_or_binding_uses_context){block.maintain_context=true;}this.add_attributes(block);this.add_directives_in_order(block);this.add_transitions(block);this.add_animation(block);this.add_classes(block);this.add_styles(block);this.add_manual_style_scoping(block);if(nodes&&this.renderer.options.hydratable&&!this.void){block.chunks.claim.push(b(_templateObject315||(_templateObject315=(0,_taggedTemplateLiteral2.default)([\"\",\".forEach(@detach);\"])),this.node.children.length>0?nodes:children));}if(renderer.options.dev){var loc=renderer.locate(this.node.start);block.chunks.hydrate.push(b(_templateObject316||(_templateObject316=(0,_taggedTemplateLiteral2.default)([\"@add_location(\",\", \",\", \",\", \",\", \",\");\"])),this.var,renderer.file_var,loc.line-1,loc.column,this.node.start));}}},{key:\"can_use_textcontent\",value:function can_use_textcontent(){return this.is_static_content&&this.fragment.nodes.every(function(node){return node.node.type==='Text'||node.node.type==='MustacheTag';});}},{key:\"get_render_statement\",value:function get_render_statement(block){var _this$node=this.node,name=_this$node.name,namespace=_this$node.namespace;if(namespace===namespaces.svg){return x(_templateObject317||(_templateObject317=(0,_taggedTemplateLiteral2.default)([\"@svg_element(\\\"\",\"\\\")\"])),name);}if(namespace){return x(_templateObject318||(_templateObject318=(0,_taggedTemplateLiteral2.default)([\"@_document.createElementNS(\\\"\",\"\\\", \\\"\",\"\\\")\"])),namespace,name);}var is=this.attributes.find(function(attr){return attr.node.name==='is';});if(is){return x(_templateObject319||(_templateObject319=(0,_taggedTemplateLiteral2.default)([\"@element_is(\\\"\",\"\\\", \",\")\"])),name,is.render_chunks(block).reduce(function(lhs,rhs){return x(_templateObject320||(_templateObject320=(0,_taggedTemplateLiteral2.default)([\"\",\" + \",\"\"])),lhs,rhs);}));}return x(_templateObject321||(_templateObject321=(0,_taggedTemplateLiteral2.default)([\"@element(\\\"\",\"\\\")\"])),name);}},{key:\"get_claim_statement\",value:function get_claim_statement(nodes){var attributes=this.attributes.filter(function(attr){return!(attr instanceof SpreadAttributeWrapper)&&!attr.property_name;}).map(function(attr){return p(_templateObject322||(_templateObject322=(0,_taggedTemplateLiteral2.default)([\"\",\": true\"])),attr.name);});var name=this.node.namespace?this.node.name:this.node.name.toUpperCase();if(this.node.namespace===namespaces.svg){return x(_templateObject323||(_templateObject323=(0,_taggedTemplateLiteral2.default)([\"@claim_svg_element(\",\", \\\"\",\"\\\", { \",\" })\"])),nodes,name,attributes);}else{return x(_templateObject324||(_templateObject324=(0,_taggedTemplateLiteral2.default)([\"@claim_element(\",\", \\\"\",\"\\\", { \",\" })\"])),nodes,name,attributes);}}},{key:\"add_directives_in_order\",value:function add_directives_in_order(block){var _this64=this;var binding_groups=events.map(function(event){return{events:event.event_names,bindings:_this64.bindings.filter(function(binding){return binding.node.name!=='this';}).filter(function(binding){return event.filter(_this64.node,binding.node.name);})};}).filter(function(group){return group.bindings.length;});var this_binding=this.bindings.find(function(b){return b.node.name==='this';});function getOrder(item){if(item instanceof EventHandlerWrapper){return item.node.start;}else if(item instanceof BindingWrapper){return item.node.start;}else if(item instanceof Action){return item.start;}else{return item.bindings[0].node.start;}}[].concat((0,_toConsumableArray2.default)(binding_groups),(0,_toConsumableArray2.default)(this.event_handlers),[this_binding],(0,_toConsumableArray2.default)(this.node.actions)).filter(Boolean).sort(function(a,b){return getOrder(a)-getOrder(b);}).forEach(function(item){if(item instanceof EventHandlerWrapper){add_event_handler(block,_this64.var,item);}else if(item instanceof BindingWrapper){_this64.add_this_binding(block,item);}else if(item instanceof Action){add_action(block,_this64.var,item);}else{_this64.add_bindings(block,item);}});}},{key:\"add_bindings\",value:function add_bindings(block,binding_group){var _this65=this;var renderer=this.renderer;if(binding_group.bindings.length===0)return;renderer.component.has_reactive_assignments=true;var lock=binding_group.bindings.some(function(binding){return binding.needs_lock;})?block.get_unique_name(\"\".concat(this.var.name,\"_updating\")):null;if(lock)block.add_variable(lock,x(_templateObject325||(_templateObject325=(0,_taggedTemplateLiteral2.default)([\"false\"]))));var handler=renderer.component.get_unique_name(\"\".concat(this.var.name,\"_\").concat(binding_group.events.join('_'),\"_handler\"));renderer.add_to_context(handler.name);// TODO figure out how to handle locks\nvar needs_lock=binding_group.bindings.some(function(binding){return binding.needs_lock;});var dependencies=new Set();var contextual_dependencies=new Set();binding_group.bindings.forEach(function(binding){// TODO this is a mess\nadd_to_set(dependencies,binding.get_update_dependencies());add_to_set(contextual_dependencies,binding.handler.contextual_dependencies);binding.render(block,lock);});// media bindings — awkward special case. The native timeupdate events\n// fire too infrequently, so we need to take matters into our\n// own hands\nvar animation_frame;if(binding_group.events[0]==='timeupdate'){animation_frame=block.get_unique_name(\"\".concat(this.var.name,\"_animationframe\"));block.add_variable(animation_frame);}var has_local_function=contextual_dependencies.size>0||needs_lock||animation_frame;var callee=renderer.reference(handler);// TODO dry this out — similar code for event handlers and component bindings\nif(has_local_function){var args=Array.from(contextual_dependencies).map(function(name){return renderer.reference(name);});// need to create a block-local function that calls an instance-level function\nif(animation_frame){block.chunks.init.push(b(_templateObject326||(_templateObject326=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tfunction \",\"() {\\n\\t\\t\\t\\t\\t\\t@_cancelAnimationFrame(\",\");\\n\\t\\t\\t\\t\\t\\tif (!\",\".paused) {\\n\\t\\t\\t\\t\\t\\t\\t\",\" = @raf(\",\");\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t\",\".call(\",\", \",\");\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),handler,animation_frame,this.var,animation_frame,handler,needs_lock&&b(_templateObject327||(_templateObject327=(0,_taggedTemplateLiteral2.default)([\"\",\" = true;\"])),lock),callee,this.var,args));}else{block.chunks.init.push(b(_templateObject328||(_templateObject328=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tfunction \",\"() {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\",\".call(\",\", \",\");\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),handler,needs_lock&&b(_templateObject329||(_templateObject329=(0,_taggedTemplateLiteral2.default)([\"\",\" = true;\"])),lock),callee,this.var,args));}callee=handler;}var params=Array.from(contextual_dependencies).map(function(name){return{type:'Identifier',name:name};});this.renderer.component.partly_hoisted.push(b(_templateObject330||(_templateObject330=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfunction \",\"(\",\") {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\\n\\t\\t\"])),handler,params,binding_group.bindings.map(function(b){return b.handler.mutation;}),Array.from(dependencies).filter(function(dep){return dep[0]!=='$';}).filter(function(dep){return!contextual_dependencies.has(dep);}).map(function(dep){return b(_templateObject331||(_templateObject331=(0,_taggedTemplateLiteral2.default)([\"\",\";\"])),_this65.renderer.invalidate(dep));})));binding_group.events.forEach(function(name){if(name==='elementresize'){// special case\nvar resize_listener=block.get_unique_name(\"\".concat(_this65.var.name,\"_resize_listener\"));block.add_variable(resize_listener);block.chunks.mount.push(b(_templateObject332||(_templateObject332=(0,_taggedTemplateLiteral2.default)([\"\",\" = @add_resize_listener(\",\", \",\".bind(\",\"));\"])),resize_listener,_this65.var,callee,_this65.var));block.chunks.destroy.push(b(_templateObject333||(_templateObject333=(0,_taggedTemplateLiteral2.default)([\"\",\"();\"])),resize_listener));}else{block.event_listeners.push(x(_templateObject334||(_templateObject334=(0,_taggedTemplateLiteral2.default)([\"@listen(\",\", \\\"\",\"\\\", \",\")\"])),_this65.var,name,callee));}});var some_initial_state_is_undefined=binding_group.bindings.map(function(binding){return x(_templateObject335||(_templateObject335=(0,_taggedTemplateLiteral2.default)([\"\",\" === void 0\"])),binding.snippet);}).reduce(function(lhs,rhs){return x(_templateObject336||(_templateObject336=(0,_taggedTemplateLiteral2.default)([\"\",\" || \",\"\"])),lhs,rhs);});var should_initialise=this.node.name==='select'||binding_group.bindings.find(function(binding){return binding.node.name==='indeterminate'||binding.node.name==='textContent'||binding.node.name==='innerHTML'||binding.is_readonly_media_attribute();});if(should_initialise){var callback=has_local_function?handler:x(_templateObject337||(_templateObject337=(0,_taggedTemplateLiteral2.default)([\"() => \",\".call(\",\")\"])),callee,this.var);block.chunks.hydrate.push(b(_templateObject338||(_templateObject338=(0,_taggedTemplateLiteral2.default)([\"if (\",\") @add_render_callback(\",\");\"])),some_initial_state_is_undefined,callback));}if(binding_group.events[0]==='elementresize'){block.chunks.hydrate.push(b(_templateObject339||(_templateObject339=(0,_taggedTemplateLiteral2.default)([\"@add_render_callback(() => \",\".call(\",\"));\"])),callee,this.var));}if(lock){block.chunks.update.push(b(_templateObject340||(_templateObject340=(0,_taggedTemplateLiteral2.default)([\"\",\" = false;\"])),lock));}}},{key:\"add_this_binding\",value:function add_this_binding(block,this_binding){var renderer=this.renderer;renderer.component.has_reactive_assignments=true;var binding_callback=bind_this(renderer.component,block,this_binding,this.var);block.chunks.mount.push(binding_callback);}},{key:\"add_attributes\",value:function add_attributes(block){var _this66=this;// Get all the class dependencies first\nthis.attributes.forEach(function(attribute){if(attribute.node.name==='class'){var _this66$class_depende;var dependencies=attribute.node.get_dependencies();(_this66$class_depende=_this66.class_dependencies).push.apply(_this66$class_depende,(0,_toConsumableArray2.default)(dependencies));}});if(this.node.attributes.some(function(attr){return attr.is_spread;})){this.add_spread_attributes(block);return;}this.attributes.forEach(function(attribute){attribute.render(block);});}},{key:\"add_spread_attributes\",value:function add_spread_attributes(block){var levels=block.get_unique_name(\"\".concat(this.var.name,\"_levels\"));var data=block.get_unique_name(\"\".concat(this.var.name,\"_data\"));var initial_props=[];var updates=[];this.attributes.forEach(function(attr){var dependencies=attr.node.get_dependencies();var condition=dependencies.length>0?block.renderer.dirty(dependencies):null;if(attr instanceof SpreadAttributeWrapper){var snippet=attr.node.expression.manipulate(block);initial_props.push(snippet);updates.push(condition?x(_templateObject341||(_templateObject341=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\"\"])),condition,snippet):snippet);}else{var name=attr.property_name||attr.name;initial_props.push(x(_templateObject342||(_templateObject342=(0,_taggedTemplateLiteral2.default)([\"{ \",\": \",\" }\"])),name,attr.get_init(block,attr.get_value(block))));var _snippet=x(_templateObject343||(_templateObject343=(0,_taggedTemplateLiteral2.default)([\"{ \",\": \",\" }\"])),name,attr.should_cache?attr.last:attr.get_value(block));updates.push(condition?x(_templateObject344||(_templateObject344=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\"\"])),attr.get_dom_update_conditions(block,condition),_snippet):_snippet);}});block.chunks.init.push(b(_templateObject345||(_templateObject345=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tlet \",\" = [\",\"];\\n\\n\\t\\t\\tlet \",\" = {};\\n\\t\\t\\tfor (let #i = 0; #i < \",\".length; #i += 1) {\\n\\t\\t\\t\\t\",\" = @assign(\",\", \",\"[#i]);\\n\\t\\t\\t}\\n\\t\\t\"])),levels,initial_props,data,levels,data,data,levels));var fn=this.node.namespace===namespaces.svg?x(_templateObject346||(_templateObject346=(0,_taggedTemplateLiteral2.default)([\"@set_svg_attributes\"]))):x(_templateObject347||(_templateObject347=(0,_taggedTemplateLiteral2.default)([\"@set_attributes\"])));block.chunks.hydrate.push(b(_templateObject348||(_templateObject348=(0,_taggedTemplateLiteral2.default)([\"\",\"(\",\", \",\");\"])),fn,this.var,data));block.chunks.update.push(b(_templateObject349||(_templateObject349=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\"(\",\", \",\" = @get_spread_update(\",\", [\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t]));\\n\\t\\t\"])),fn,this.var,data,levels,updates));// handle edge cases for elements\nif(this.node.name==='select'){var dependencies=new Set();var _iterator9=_createForOfIteratorHelper(this.attributes),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var attr=_step9.value;var _iterator10=_createForOfIteratorHelper(attr.node.dependencies),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var dep=_step10.value;dependencies.add(dep);}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}block.chunks.mount.push(b(_templateObject350||(_templateObject350=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t(\",\".multiple ? @select_options : @select_option)(\",\", \",\".value);\\n\\t\\t\\t\"])),data,this.var,data));block.chunks.update.push(b(_templateObject351||(_templateObject351=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\" && 'value' in \",\") (\",\".multiple ? @select_options : @select_option)(\",\", \",\".value);;\\n\\t\\t\\t\"])),block.renderer.dirty(Array.from(dependencies)),data,data,this.var,data));}else if(this.node.name==='input'&&this.attributes.find(function(attr){return attr.node.name==='value';})){var type=this.node.get_static_attribute_value('type');if(type===null||type===''||type==='text'||type==='email'||type==='password'){block.chunks.mount.push(b(_templateObject352||(_templateObject352=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\".value = \",\".value;\\n\\t\\t\\t\\t\"])),this.var,data));block.chunks.update.push(b(_templateObject353||(_templateObject353=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif ('value' in \",\") {\\n\\t\\t\\t\\t\\t\\t\",\".value = \",\".value;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),data,this.var,data));}}if(['button','input','keygen','select','textarea'].includes(this.node.name)){block.chunks.mount.push(b(_templateObject354||(_templateObject354=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\".autofocus) \",\".focus();\\n\\t\\t\\t\"])),this.var,this.var));}}},{key:\"add_transitions\",value:function add_transitions(block){var _this$node2=this.node,intro=_this$node2.intro,outro=_this$node2.outro;if(!intro&&!outro)return;if(intro===outro){// bidirectional transition\nvar name=block.get_unique_name(\"\".concat(this.var.name,\"_transition\"));var snippet=intro.expression?intro.expression.manipulate(block):x(_templateObject355||(_templateObject355=(0,_taggedTemplateLiteral2.default)([\"{}\"])));block.add_variable(name);var fn=this.renderer.reference(intro.name);var intro_block=b(_templateObject356||(_templateObject356=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t@add_render_callback(() => {\\n\\t\\t\\t\\t\\tif (!\",\") \",\" = @create_bidirectional_transition(\",\", \",\", \",\", true);\\n\\t\\t\\t\\t\\t\",\".run(1);\\n\\t\\t\\t\\t});\\n\\t\\t\\t\"])),name,name,this.var,fn,snippet,name);var outro_block=b(_templateObject357||(_templateObject357=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (!\",\") \",\" = @create_bidirectional_transition(\",\", \",\", \",\", false);\\n\\t\\t\\t\\t\",\".run(0);\\n\\t\\t\\t\"])),name,name,this.var,fn,snippet,name);if(intro.is_local){block.chunks.intro.push(b(_templateObject358||(_templateObject358=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (#local) {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),intro_block));block.chunks.outro.push(b(_templateObject359||(_templateObject359=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (#local) {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),outro_block));}else{block.chunks.intro.push(intro_block);block.chunks.outro.push(outro_block);}block.chunks.destroy.push(b(_templateObject360||(_templateObject360=(0,_taggedTemplateLiteral2.default)([\"if (detaching && \",\") \",\".end();\"])),name,name));}else{var intro_name=intro&&block.get_unique_name(\"\".concat(this.var.name,\"_intro\"));var outro_name=outro&&block.get_unique_name(\"\".concat(this.var.name,\"_outro\"));if(intro){block.add_variable(intro_name);var _snippet2=intro.expression?intro.expression.manipulate(block):x(_templateObject361||(_templateObject361=(0,_taggedTemplateLiteral2.default)([\"{}\"])));var _fn=this.renderer.reference(intro.name);var _intro_block;if(outro){_intro_block=b(_templateObject362||(_templateObject362=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\t@add_render_callback(() => {\\n\\t\\t\\t\\t\\t\\t\\tif (\",\") \",\".end(1);\\n\\t\\t\\t\\t\\t\\t\\t\",\" = @create_in_transition(\",\", \",\", \",\");\\n\\t\\t\\t\\t\\t\\t\\t\",\".start();\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t\"])),outro_name,outro_name,intro_name,this.var,_fn,_snippet2,intro_name);block.chunks.outro.push(b(_templateObject363||(_templateObject363=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".invalidate();\"])),intro_name,intro_name));}else{_intro_block=b(_templateObject364||(_templateObject364=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (!\",\") {\\n\\t\\t\\t\\t\\t\\t\\t@add_render_callback(() => {\\n\\t\\t\\t\\t\\t\\t\\t\\t\",\" = @create_in_transition(\",\", \",\", \",\");\\n\\t\\t\\t\\t\\t\\t\\t\\t\",\".start();\\n\\t\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\"])),intro_name,intro_name,this.var,_fn,_snippet2,intro_name);}if(intro.is_local){_intro_block=b(_templateObject365||(_templateObject365=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (#local) {\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\"])),_intro_block);}block.chunks.intro.push(_intro_block);}if(outro){block.add_variable(outro_name);var _snippet3=outro.expression?outro.expression.manipulate(block):x(_templateObject366||(_templateObject366=(0,_taggedTemplateLiteral2.default)([\"{}\"])));var _fn2=this.renderer.reference(outro.name);if(!intro){block.chunks.intro.push(b(_templateObject367||(_templateObject367=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (\",\") \",\".end(1);\\n\\t\\t\\t\\t\\t\"])),outro_name,outro_name));}// TODO hide elements that have outro'd (unless they belong to a still-outroing\n// group) prior to their removal from the DOM\nvar _outro_block=b(_templateObject368||(_templateObject368=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\" = @create_out_transition(\",\", \",\", \",\");\\n\\t\\t\\t\\t\"])),outro_name,this.var,_fn2,_snippet3);if(outro.is_local){_outro_block=b(_templateObject369||(_templateObject369=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (#local) {\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\"])),_outro_block);}block.chunks.outro.push(_outro_block);block.chunks.destroy.push(b(_templateObject370||(_templateObject370=(0,_taggedTemplateLiteral2.default)([\"if (detaching && \",\") \",\".end();\"])),outro_name,outro_name));}}if(intro&&intro.expression&&intro.expression.dependencies.size||outro&&outro.expression&&outro.expression.dependencies.size){block.maintain_context=true;}}},{key:\"add_animation\",value:function add_animation(block){if(!this.node.animation)return;var outro=this.node.outro;var rect=block.get_unique_name('rect');var stop_animation=block.get_unique_name('stop_animation');block.add_variable(rect);block.add_variable(stop_animation,x(_templateObject371||(_templateObject371=(0,_taggedTemplateLiteral2.default)([\"@noop\"]))));block.chunks.measure.push(b(_templateObject372||(_templateObject372=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\" = \",\".getBoundingClientRect();\\n\\t\\t\"])),rect,this.var));block.chunks.fix.push(b(_templateObject373||(_templateObject373=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t@fix_position(\",\");\\n\\t\\t\\t\",\"();\\n\\t\\t\\t\",\"\\n\\t\\t\"])),this.var,stop_animation,outro&&b(_templateObject374||(_templateObject374=(0,_taggedTemplateLiteral2.default)([\"@add_transform(\",\", \",\");\"])),this.var,rect)));var params;if(this.node.animation.expression){params=this.node.animation.expression.manipulate(block);if(this.node.animation.expression.dynamic_dependencies().length){// if `params` is dynamic, calculate params ahead of time in the `.r()` method\nvar params_var=block.get_unique_name('params');block.add_variable(params_var);block.chunks.measure.push(b(_templateObject375||(_templateObject375=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\";\"])),params_var,params));params=params_var;}}else{params=x(_templateObject376||(_templateObject376=(0,_taggedTemplateLiteral2.default)([\"{}\"])));}var name=this.renderer.reference(this.node.animation.name);block.chunks.animate.push(b(_templateObject377||(_templateObject377=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\"();\\n\\t\\t\\t\",\" = @create_animation(\",\", \",\", \",\", \",\");\\n\\t\\t\"])),stop_animation,stop_animation,this.var,rect,name,params));}},{key:\"add_classes\",value:function add_classes(block){var _this67=this;var has_spread=this.node.attributes.some(function(attr){return attr.is_spread;});this.node.classes.forEach(function(class_directive){var expression=class_directive.expression,name=class_directive.name;var snippet;var dependencies;if(expression){snippet=expression.manipulate(block);dependencies=expression.dependencies;}else{snippet=name;dependencies=new Set([name]);}var updater=b(_templateObject378||(_templateObject378=(0,_taggedTemplateLiteral2.default)([\"@toggle_class(\",\", \\\"\",\"\\\", \",\");\"])),_this67.var,name,snippet);block.chunks.hydrate.push(updater);if(has_spread){block.chunks.update.push(updater);}else if(dependencies&&dependencies.size>0||_this67.class_dependencies.length){var _this67$class_depende;var all_dependencies=(_this67$class_depende=_this67.class_dependencies).concat.apply(_this67$class_depende,(0,_toConsumableArray2.default)(dependencies));var condition=block.renderer.dirty(all_dependencies);// If all of the dependencies are non-dynamic (don't get updated) then there is no reason\n// to add an updater for this.\nvar any_dynamic_dependencies=all_dependencies.some(function(dep){var variable=_this67.renderer.component.var_lookup.get(dep);return!variable||is_dynamic(variable);});if(any_dynamic_dependencies){block.chunks.update.push(b(_templateObject379||(_templateObject379=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\"])),condition,updater));}}});}},{key:\"add_styles\",value:function add_styles(block){var _this68=this;var has_spread=this.node.attributes.some(function(attr){return attr.is_spread;});this.node.styles.forEach(function(style_directive){var name=style_directive.name,expression=style_directive.expression,should_cache=style_directive.should_cache;var snippet=expression.manipulate(block);var cached_snippet;if(should_cache){cached_snippet=block.get_unique_name(\"style_\".concat(name.replace(/-/g,'_')));block.add_variable(cached_snippet,snippet);}var updater=b(_templateObject380||(_templateObject380=(0,_taggedTemplateLiteral2.default)([\"@set_style(\",\", \\\"\",\"\\\", \",\", false)\"])),_this68.var,name,should_cache?cached_snippet:snippet);block.chunks.hydrate.push(updater);var dependencies=expression.dynamic_dependencies();if(has_spread){block.chunks.update.push(updater);}else if(dependencies.length>0){if(should_cache){block.chunks.update.push(b(_templateObject381||(_templateObject381=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\t\\tif (\",\" && (\",\" !== (\",\" = \",\"))) {\\n\\t\\t\\t\\t\\t\\t\\t\\t\",\"\\t\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\"])),block.renderer.dirty(dependencies),cached_snippet,cached_snippet,snippet,updater));}else{block.chunks.update.push(b(_templateObject382||(_templateObject382=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\"])),block.renderer.dirty(dependencies),updater));}}});}},{key:\"add_manual_style_scoping\",value:function add_manual_style_scoping(block){if(this.node.needs_manual_style_scoping){var updater=b(_templateObject383||(_templateObject383=(0,_taggedTemplateLiteral2.default)([\"@toggle_class(\",\", \\\"\",\"\\\", true);\"])),this.var,this.node.component.stylesheet.id);block.chunks.hydrate.push(updater);block.chunks.update.push(updater);}}}]);return ElementWrapper;}(Wrapper);function to_html(wrappers,block,literal,state,can_use_raw_text){wrappers.forEach(function(wrapper){if(wrapper instanceof TextWrapper){if(wrapper.use_space())state.quasi.value.raw+=' ';var parent=wrapper.node.parent;var raw=parent&&(parent.name==='script'||parent.name==='style'||can_use_raw_text);state.quasi.value.raw+=(raw?wrapper.data:escape_html(wrapper.data)).replace(/\\\\/g,'\\\\\\\\').replace(/`/g,'\\\\`').replace(/\\$/g,'\\\\$');}else if(wrapper instanceof MustacheTagWrapper||wrapper instanceof RawMustacheTagWrapper){literal.quasis.push(state.quasi);literal.expressions.push(wrapper.node.expression.manipulate(block));state.quasi={type:'TemplateElement',value:{raw:''}};}else if(wrapper.node.name==='noscript');else{// element\nstate.quasi.value.raw+=\"<\".concat(wrapper.node.name);wrapper.attributes.forEach(function(attr){state.quasi.value.raw+=\" \".concat(fix_attribute_casing(attr.node.name),\"=\\\"\");attr.node.chunks.forEach(function(chunk){if(chunk.type==='Text'){state.quasi.value.raw+=escape_html(chunk.data);}else{literal.quasis.push(state.quasi);literal.expressions.push(chunk.manipulate(block));state.quasi={type:'TemplateElement',value:{raw:''}};}});state.quasi.value.raw+='\"';});if(!wrapper.void){state.quasi.value.raw+='>';to_html(wrapper.fragment.nodes,block,literal,state);state.quasi.value.raw+=\"</\".concat(wrapper.node.name,\">\");}else{state.quasi.value.raw+='/>';}}});}var HeadWrapper=/*#__PURE__*/function(_Wrapper10){(0,_inherits2.default)(HeadWrapper,_Wrapper10);var _super51=_createSuper(HeadWrapper);function HeadWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _this69;(0,_classCallCheck2.default)(this,HeadWrapper);_this69=_super51.call(this,renderer,block,parent,node);_this69.can_use_innerhtml=false;_this69.fragment=new FragmentWrapper(renderer,block,node.children,(0,_assertThisInitialized2.default)(_this69),strip_whitespace,next_sibling);return _this69;}(0,_createClass2.default)(HeadWrapper,[{key:\"render\",value:function render(block,_parent_node,_parent_nodes){var nodes;if(this.renderer.options.hydratable&&this.fragment.nodes.length){nodes=block.get_unique_name('head_nodes');block.chunks.claim.push(b(_templateObject384||(_templateObject384=(0,_taggedTemplateLiteral2.default)([\"const \",\" = @query_selector_all('[data-svelte=\\\"\",\"\\\"]', @_document.head);\"])),nodes,this.node.id));}this.fragment.render(block,x(_templateObject385||(_templateObject385=(0,_taggedTemplateLiteral2.default)([\"@_document.head\"]))),nodes);if(nodes&&this.renderer.options.hydratable){block.chunks.claim.push(b(_templateObject386||(_templateObject386=(0,_taggedTemplateLiteral2.default)([\"\",\".forEach(@detach);\"])),nodes));}}}]);return HeadWrapper;}(Wrapper);function is_else_if(node){return node&&node.children.length===1&&node.children[0].type==='IfBlock';}var IfBlockBranch=/*#__PURE__*/function(_Wrapper11){(0,_inherits2.default)(IfBlockBranch,_Wrapper11);var _super52=_createSuper(IfBlockBranch);function IfBlockBranch(renderer,block,parent,node,strip_whitespace,next_sibling){var _this70;(0,_classCallCheck2.default)(this,IfBlockBranch);_this70=_super52.call(this,renderer,block,parent,node);_this70.var=null;var expression=node.expression;var is_else=!expression;if(expression){_this70.dependencies=expression.dynamic_dependencies();// TODO is this the right rule? or should any non-reference count?\n// const should_cache = !is_reference(expression.node, null) && dependencies.length > 0;\nvar _should_cache=false;walk(expression.node,{enter:function enter(node){if(node.type==='CallExpression'||node.type==='NewExpression'){_should_cache=true;}}});if(_should_cache){_this70.condition=block.get_unique_name('show_if');_this70.snippet=expression.manipulate(block);}else{_this70.condition=expression.manipulate(block);}}_this70.block=block.child({comment:create_debugging_comment(node,parent.renderer.component),name:parent.renderer.component.get_unique_name(is_else?'create_else_block':'create_if_block'),type:node.expression?'if':'else'});_this70.fragment=new FragmentWrapper(renderer,_this70.block,node.children,parent,strip_whitespace,next_sibling);_this70.is_dynamic=_this70.block.dependencies.size>0;return _this70;}return(0,_createClass2.default)(IfBlockBranch);}(Wrapper);var IfBlockWrapper=/*#__PURE__*/function(_Wrapper12){(0,_inherits2.default)(IfBlockWrapper,_Wrapper12);var _super53=_createSuper(IfBlockWrapper);function IfBlockWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _renderer$blocks;var _this71;(0,_classCallCheck2.default)(this,IfBlockWrapper);_this71=_super53.call(this,renderer,block,parent,node);_this71.needs_update=false;_this71.var={type:'Identifier',name:'if_block'};_this71.cannot_use_innerhtml();_this71.not_static_content();_this71.branches=[];var blocks=[];var is_dynamic=false;var has_intros=false;var has_outros=false;var create_branches=function create_branches(node){var branch=new IfBlockBranch(renderer,block,(0,_assertThisInitialized2.default)(_this71),node,strip_whitespace,next_sibling);_this71.branches.push(branch);blocks.push(branch.block);block.add_dependencies(node.expression.dependencies);if(branch.block.dependencies.size>0){// the condition, or its contents, is dynamic\nis_dynamic=true;block.add_dependencies(branch.block.dependencies);}if(branch.dependencies&&branch.dependencies.length>0){// the condition itself is dynamic\n_this71.needs_update=true;}if(branch.block.has_intros)has_intros=true;if(branch.block.has_outros)has_outros=true;if(is_else_if(node.else)){create_branches(node.else.children[0]);}else if(node.else){var _branch=new IfBlockBranch(renderer,block,(0,_assertThisInitialized2.default)(_this71),node.else,strip_whitespace,next_sibling);_this71.branches.push(_branch);blocks.push(_branch.block);if(_branch.block.dependencies.size>0){is_dynamic=true;block.add_dependencies(_branch.block.dependencies);}if(_branch.block.has_intros)has_intros=true;if(_branch.block.has_outros)has_outros=true;}};create_branches(_this71.node);blocks.forEach(function(block){block.has_update_method=is_dynamic;block.has_intro_method=has_intros;block.has_outro_method=has_outros;});(_renderer$blocks=renderer.blocks).push.apply(_renderer$blocks,blocks);return _this71;}(0,_createClass2.default)(IfBlockWrapper,[{key:\"render\",value:function render(block,parent_node,parent_nodes){var name=this.var;var needs_anchor=this.next?!this.next.is_dom_node():!parent_node||!this.parent.is_dom_node();var anchor=needs_anchor?block.get_unique_name(\"\".concat(this.var.name,\"_anchor\")):this.next&&this.next.var||'null';var has_else=!this.branches[this.branches.length-1].condition;var if_exists_condition=has_else?null:name;var dynamic=this.branches[0].block.has_update_method;// can use [0] as proxy for all, since they necessarily have the same value\nvar has_intros=this.branches[0].block.has_intro_method;var has_outros=this.branches[0].block.has_outro_method;var has_transitions=has_intros||has_outros;var vars={name:name,anchor:anchor,if_exists_condition:if_exists_condition,has_else:has_else,has_transitions:has_transitions};var detaching=parent_node&&!is_head(parent_node)?null:'detaching';if(this.node.else){this.branches.forEach(function(branch){if(branch.snippet)block.add_variable(branch.condition);});if(has_outros){this.render_compound_with_outros(block,parent_node,parent_nodes,dynamic,vars,detaching);block.chunks.outro.push(b(_templateObject387||(_templateObject387=(0,_taggedTemplateLiteral2.default)([\"@transition_out(\",\");\"])),name));}else{this.render_compound(block,parent_node,parent_nodes,dynamic,vars,detaching);}}else{this.render_simple(block,parent_node,parent_nodes,dynamic,vars,detaching);if(has_outros){block.chunks.outro.push(b(_templateObject388||(_templateObject388=(0,_taggedTemplateLiteral2.default)([\"@transition_out(\",\");\"])),name));}}if(if_exists_condition){block.chunks.create.push(b(_templateObject389||(_templateObject389=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".c();\"])),if_exists_condition,name));}else{block.chunks.create.push(b(_templateObject390||(_templateObject390=(0,_taggedTemplateLiteral2.default)([\"\",\".c();\"])),name));}if(parent_nodes&&this.renderer.options.hydratable){if(if_exists_condition){block.chunks.claim.push(b(_templateObject391||(_templateObject391=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".l(\",\");\"])),if_exists_condition,name,parent_nodes));}else{block.chunks.claim.push(b(_templateObject392||(_templateObject392=(0,_taggedTemplateLiteral2.default)([\"\",\".l(\",\");\"])),name,parent_nodes));}}if(has_intros||has_outros){block.chunks.intro.push(b(_templateObject393||(_templateObject393=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\");\"])),name));}if(needs_anchor){block.add_element(anchor,x(_templateObject394||(_templateObject394=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),parent_nodes&&x(_templateObject395||(_templateObject395=(0,_taggedTemplateLiteral2.default)([\"@empty()\"]))),parent_node);}this.branches.forEach(function(branch){branch.fragment.render(branch.block,null,x(_templateObject396||(_templateObject396=(0,_taggedTemplateLiteral2.default)([\"#nodes\"]))));});}},{key:\"render_compound\",value:function render_compound(block,parent_node,_parent_nodes,dynamic,_ref8,detaching){var name=_ref8.name,anchor=_ref8.anchor,has_else=_ref8.has_else,if_exists_condition=_ref8.if_exists_condition,has_transitions=_ref8.has_transitions;var select_block_type=this.renderer.component.get_unique_name('select_block_type');var current_block_type=block.get_unique_name('current_block_type');var get_block=has_else?x(_templateObject397||(_templateObject397=(0,_taggedTemplateLiteral2.default)([\"\",\"(#ctx)\"])),current_block_type):x(_templateObject398||(_templateObject398=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\"(#ctx)\"])),current_block_type,current_block_type);if(this.needs_update){block.chunks.init.push(b(_templateObject399||(_templateObject399=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfunction \",\"(#ctx, #dirty) {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),select_block_type,this.branches.map(function(_ref9){var dependencies=_ref9.dependencies,condition=_ref9.condition,snippet=_ref9.snippet;return b(_templateObject400||(_templateObject400=(0,_taggedTemplateLiteral2.default)([\"\",\"\"])),snippet&&dependencies.length>0?b(_templateObject401||(_templateObject401=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\" = null;\"])),block.renderer.dirty(dependencies),condition):null);}),this.branches.map(function(_ref10){var condition=_ref10.condition,snippet=_ref10.snippet,block=_ref10.block;return condition?b(_templateObject402||(_templateObject402=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\tif (\",\") return \",\";\"])),snippet&&b(_templateObject403||(_templateObject403=(0,_taggedTemplateLiteral2.default)([\"if (\",\" == null) \",\" = !!\",\"\"])),condition,condition,snippet),condition,block.name):b(_templateObject404||(_templateObject404=(0,_taggedTemplateLiteral2.default)([\"return \",\";\"])),block.name);})));}else{block.chunks.init.push(b(_templateObject405||(_templateObject405=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfunction \",\"(#ctx, #dirty) {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),select_block_type,this.branches.map(function(_ref11){var condition=_ref11.condition,snippet=_ref11.snippet,block=_ref11.block;return condition?b(_templateObject406||(_templateObject406=(0,_taggedTemplateLiteral2.default)([\"if (\",\") return \",\";\"])),snippet||condition,block.name):b(_templateObject407||(_templateObject407=(0,_taggedTemplateLiteral2.default)([\"return \",\";\"])),block.name);})));}block.chunks.init.push(b(_templateObject408||(_templateObject408=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tlet \",\" = \",\"(#ctx, \",\");\\n\\t\\t\\tlet \",\" = \",\";\\n\\t\\t\"])),current_block_type,select_block_type,this.renderer.get_initial_dirty(),name,get_block));var initial_mount_node=parent_node||'#target';var anchor_node=parent_node?'null':'#anchor';if(if_exists_condition){block.chunks.mount.push(b(_templateObject409||(_templateObject409=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".m(\",\", \",\");\"])),if_exists_condition,name,initial_mount_node,anchor_node));}else{block.chunks.mount.push(b(_templateObject410||(_templateObject410=(0,_taggedTemplateLiteral2.default)([\"\",\".m(\",\", \",\");\"])),name,initial_mount_node,anchor_node));}if(this.needs_update){var update_mount_node=this.get_update_mount_node(anchor);var change_block=b(_templateObject411||(_templateObject411=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\";\\n\\t\\t\\t\\t\",\" = \",\";\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\".c();\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\".m(\",\", \",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),if_exists_condition?b(_templateObject412||(_templateObject412=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".d(1)\"])),if_exists_condition,name):b(_templateObject413||(_templateObject413=(0,_taggedTemplateLiteral2.default)([\"\",\".d(1)\"])),name),name,get_block,name,name,has_transitions&&b(_templateObject414||(_templateObject414=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\", 1);\"])),name),name,update_mount_node,anchor);if(dynamic){block.chunks.update.push(b(_templateObject415||(_templateObject415=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\" === (\",\" = \",\"(#ctx, #dirty)) && \",\") {\\n\\t\\t\\t\\t\\t\\t\",\".p(#ctx, #dirty);\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),current_block_type,current_block_type,select_block_type,name,name,change_block));}else{block.chunks.update.push(b(_templateObject416||(_templateObject416=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\" !== (\",\" = \",\"(#ctx, #dirty))) {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),current_block_type,current_block_type,select_block_type,change_block));}}else if(dynamic){if(if_exists_condition){block.chunks.update.push(b(_templateObject417||(_templateObject417=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".p(#ctx, #dirty);\"])),if_exists_condition,name));}else{block.chunks.update.push(b(_templateObject418||(_templateObject418=(0,_taggedTemplateLiteral2.default)([\"\",\".p(#ctx, #dirty);\"])),name));}}if(if_exists_condition){block.chunks.destroy.push(b(_templateObject419||(_templateObject419=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\".d(\",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),if_exists_condition,name,detaching));}else{block.chunks.destroy.push(b(_templateObject420||(_templateObject420=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\".d(\",\");\\n\\t\\t\\t\"])),name,detaching));}}// if any of the siblings have outros, we need to keep references to the blocks\n// (TODO does this only apply to bidi transitions?)\n},{key:\"render_compound_with_outros\",value:function render_compound_with_outros(block,parent_node,_parent_nodes,dynamic,_ref12,detaching){var name=_ref12.name,anchor=_ref12.anchor,has_else=_ref12.has_else,has_transitions=_ref12.has_transitions,if_exists_condition=_ref12.if_exists_condition;var select_block_type=this.renderer.component.get_unique_name('select_block_type');var current_block_type_index=block.get_unique_name('current_block_type_index');var previous_block_index=block.get_unique_name('previous_block_index');var if_block_creators=block.get_unique_name('if_block_creators');var if_blocks=block.get_unique_name('if_blocks');var if_current_block_type_index=has_else?function(nodes){return nodes;}:function(nodes){return b(_templateObject421||(_templateObject421=(0,_taggedTemplateLiteral2.default)([\"if (~\",\") { \",\" }\"])),current_block_type_index,nodes);};block.add_variable(current_block_type_index);block.add_variable(name);block.chunks.init.push(b(_templateObject422||(_templateObject422=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tconst \",\" = [\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t];\\n\\n\\t\\t\\tconst \",\" = [];\\n\\n\\t\\t\\t\",\"\\n\\t\\t\"])),if_block_creators,this.branches.map(function(branch){return branch.block.name;}),if_blocks,this.needs_update?b(_templateObject423||(_templateObject423=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tfunction \",\"(#ctx, #dirty) {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),select_block_type,this.branches.map(function(_ref13){var dependencies=_ref13.dependencies,condition=_ref13.condition,snippet=_ref13.snippet;return b(_templateObject424||(_templateObject424=(0,_taggedTemplateLiteral2.default)([\"\",\"\"])),snippet&&dependencies.length>0?b(_templateObject425||(_templateObject425=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\" = null;\"])),block.renderer.dirty(dependencies),condition):null);}),this.branches.map(function(_ref14,i){var condition=_ref14.condition,snippet=_ref14.snippet;return condition?b(_templateObject426||(_templateObject426=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\tif (\",\") return \",\";\"])),snippet&&b(_templateObject427||(_templateObject427=(0,_taggedTemplateLiteral2.default)([\"if (\",\" == null) \",\" = !!\",\"\"])),condition,condition,snippet),condition,i):b(_templateObject428||(_templateObject428=(0,_taggedTemplateLiteral2.default)([\"return \",\";\"])),i);}),!has_else&&b(_templateObject429||(_templateObject429=(0,_taggedTemplateLiteral2.default)([\"return -1;\"])))):b(_templateObject430||(_templateObject430=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tfunction \",\"(#ctx, #dirty) {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),select_block_type,this.branches.map(function(_ref15,i){var condition=_ref15.condition,snippet=_ref15.snippet;return condition?b(_templateObject431||(_templateObject431=(0,_taggedTemplateLiteral2.default)([\"if (\",\") return \",\";\"])),snippet||condition,i):b(_templateObject432||(_templateObject432=(0,_taggedTemplateLiteral2.default)([\"return \",\";\"])),i);}),!has_else&&b(_templateObject433||(_templateObject433=(0,_taggedTemplateLiteral2.default)([\"return -1;\"]))))));if(has_else){block.chunks.init.push(b(_templateObject434||(_templateObject434=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\" = \",\"(#ctx, \",\");\\n\\t\\t\\t\\t\",\" = \",\"[\",\"] = \",\"[\",\"](#ctx);\\n\\t\\t\\t\"])),current_block_type_index,select_block_type,this.renderer.get_initial_dirty(),name,if_blocks,current_block_type_index,if_block_creators,current_block_type_index));}else{block.chunks.init.push(b(_templateObject435||(_templateObject435=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (~(\",\" = \",\"(#ctx, \",\"))) {\\n\\t\\t\\t\\t\\t\",\" = \",\"[\",\"] = \",\"[\",\"](#ctx);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),current_block_type_index,select_block_type,this.renderer.get_initial_dirty(),name,if_blocks,current_block_type_index,if_block_creators,current_block_type_index));}var initial_mount_node=parent_node||'#target';var anchor_node=parent_node?'null':'#anchor';block.chunks.mount.push(if_current_block_type_index(b(_templateObject436||(_templateObject436=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"].m(\",\", \",\");\"])),if_blocks,current_block_type_index,initial_mount_node,anchor_node)));if(this.needs_update){var update_mount_node=this.get_update_mount_node(anchor);var destroy_old_block=b(_templateObject437||(_templateObject437=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t@group_outros();\\n\\t\\t\\t\\t@transition_out(\",\"[\",\"], 1, 1, () => {\\n\\t\\t\\t\\t\\t\",\"[\",\"] = null;\\n\\t\\t\\t\\t});\\n\\t\\t\\t\\t@check_outros();\\n\\t\\t\\t\"])),if_blocks,previous_block_index,if_blocks,previous_block_index);var create_new_block=b(_templateObject438||(_templateObject438=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\" = \",\"[\",\"];\\n\\t\\t\\t\\tif (!\",\") {\\n\\t\\t\\t\\t\\t\",\" = \",\"[\",\"] = \",\"[\",\"](#ctx);\\n\\t\\t\\t\\t\\t\",\".c();\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\".m(\",\", \",\");\\n\\t\\t\\t\"])),name,if_blocks,current_block_type_index,name,name,if_blocks,current_block_type_index,if_block_creators,current_block_type_index,name,dynamic&&b(_templateObject439||(_templateObject439=(0,_taggedTemplateLiteral2.default)([\"\",\".p(#ctx, #dirty);\"])),name),has_transitions&&b(_templateObject440||(_templateObject440=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\", 1);\"])),name),name,update_mount_node,anchor);var change_block=has_else?b(_templateObject441||(_templateObject441=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\"])),destroy_old_block,create_new_block):b(_templateObject442||(_templateObject442=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (~\",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\t\",\" = null;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),name,destroy_old_block,current_block_type_index,create_new_block,name);block.chunks.update.push(b(_templateObject443||(_templateObject443=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tlet \",\" = \",\";\\n\\t\\t\\t\\t\",\" = \",\"(#ctx, #dirty);\\n\\t\\t\\t\"])),previous_block_index,current_block_type_index,current_block_type_index,select_block_type));if(dynamic){block.chunks.update.push(b(_templateObject444||(_templateObject444=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\" === \",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),current_block_type_index,previous_block_index,if_current_block_type_index(b(_templateObject445||(_templateObject445=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"].p(#ctx, #dirty);\"])),if_blocks,current_block_type_index)),change_block));}else{block.chunks.update.push(b(_templateObject446||(_templateObject446=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\" !== \",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),current_block_type_index,previous_block_index,change_block));}}else if(dynamic){if(if_exists_condition){block.chunks.update.push(b(_templateObject447||(_templateObject447=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".p(#ctx, #dirty);\"])),if_exists_condition,name));}else{block.chunks.update.push(b(_templateObject448||(_templateObject448=(0,_taggedTemplateLiteral2.default)([\"\",\".p(#ctx, #dirty);\"])),name));}}block.chunks.destroy.push(if_current_block_type_index(b(_templateObject449||(_templateObject449=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"].d(\",\");\"])),if_blocks,current_block_type_index,detaching)));}},{key:\"render_simple\",value:function render_simple(block,parent_node,_parent_nodes,dynamic,_ref16,detaching){var name=_ref16.name,anchor=_ref16.anchor,if_exists_condition=_ref16.if_exists_condition,has_transitions=_ref16.has_transitions;var branch=this.branches[0];if(branch.snippet)block.add_variable(branch.condition,branch.snippet);block.chunks.init.push(b(_templateObject450||(_templateObject450=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tlet \",\" = \",\" && \",\"(#ctx);\\n\\t\\t\"])),name,branch.condition,branch.block.name));var initial_mount_node=parent_node||'#target';var anchor_node=parent_node?'null':'#anchor';block.chunks.mount.push(b(_templateObject451||(_templateObject451=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".m(\",\", \",\");\"])),name,name,initial_mount_node,anchor_node));if(branch.dependencies.length>0){var update_mount_node=this.get_update_mount_node(anchor);var enter=b(_templateObject452||(_templateObject452=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\",\" = \",\"(#ctx);\\n\\t\\t\\t\\t\\t\",\".c();\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\".m(\",\", \",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),name,dynamic&&b(_templateObject453||(_templateObject453=(0,_taggedTemplateLiteral2.default)([\"\",\".p(#ctx, #dirty);\"])),name),has_transitions&&b(_templateObject454||(_templateObject454=(0,_taggedTemplateLiteral2.default)([\"if (\",\") {\\n\\t\\t\\t\\t\\t\\t\\t@transition_in(\",\", 1);\\n\\t\\t\\t\\t\\t\\t}\"])),block.renderer.dirty(branch.dependencies),name),name,branch.block.name,name,has_transitions&&b(_templateObject455||(_templateObject455=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\", 1);\"])),name),name,update_mount_node,anchor);if(branch.snippet){block.chunks.update.push(b(_templateObject456||(_templateObject456=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\" = \",\"\"])),block.renderer.dirty(branch.dependencies),branch.condition,branch.snippet));}// no `p()` here — we don't want to update outroing nodes,\n// as that will typically result in glitching\nif(branch.block.has_outro_method){block.chunks.update.push(b(_templateObject457||(_templateObject457=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t} else if (\",\") {\\n\\t\\t\\t\\t\\t\\t@group_outros();\\n\\t\\t\\t\\t\\t\\t@transition_out(\",\", 1, 1, () => {\\n\\t\\t\\t\\t\\t\\t\\t\",\" = null;\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t\\t@check_outros();\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),branch.condition,enter,name,name,name));}else{block.chunks.update.push(b(_templateObject458||(_templateObject458=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t} else if (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\".d(1);\\n\\t\\t\\t\\t\\t\\t\",\" = null;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),branch.condition,enter,name,name,name));}}else if(dynamic){block.chunks.update.push(b(_templateObject459||(_templateObject459=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") \",\".p(#ctx, #dirty);\\n\\t\\t\\t\"])),branch.condition,name));}if(if_exists_condition){block.chunks.destroy.push(b(_templateObject460||(_templateObject460=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") \",\".d(\",\");\\n\\t\\t\\t\"])),if_exists_condition,name,detaching));}else{block.chunks.destroy.push(b(_templateObject461||(_templateObject461=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\".d(\",\");\\n\\t\\t\\t\"])),name,detaching));}}}]);return IfBlockWrapper;}(Wrapper);var KeyBlockWrapper=/*#__PURE__*/function(_Wrapper13){(0,_inherits2.default)(KeyBlockWrapper,_Wrapper13);var _super54=_createSuper(KeyBlockWrapper);function KeyBlockWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _this72;(0,_classCallCheck2.default)(this,KeyBlockWrapper);_this72=_super54.call(this,renderer,block,parent,node);_this72.var={type:'Identifier',name:'key_block'};_this72.cannot_use_innerhtml();_this72.not_static_content();_this72.dependencies=node.expression.dynamic_dependencies();if(_this72.dependencies.length){block=block.child({comment:create_debugging_comment(node,renderer.component),name:renderer.component.get_unique_name('create_key_block'),type:'key'});renderer.blocks.push(block);}_this72.block=block;_this72.fragment=new FragmentWrapper(renderer,_this72.block,node.children,(0,_assertThisInitialized2.default)(_this72),strip_whitespace,next_sibling);return _this72;}(0,_createClass2.default)(KeyBlockWrapper,[{key:\"render\",value:function render(block,parent_node,parent_nodes){if(this.dependencies.length===0){this.render_static_key(block,parent_node,parent_nodes);}else{this.render_dynamic_key(block,parent_node,parent_nodes);}}},{key:\"render_static_key\",value:function render_static_key(_block,parent_node,parent_nodes){this.fragment.render(this.block,parent_node,parent_nodes);}},{key:\"render_dynamic_key\",value:function render_dynamic_key(block,parent_node,parent_nodes){this.fragment.render(this.block,null,x(_templateObject462||(_templateObject462=(0,_taggedTemplateLiteral2.default)([\"#nodes\"]))));var has_transitions=!!(this.block.has_intro_method||this.block.has_outro_method);var dynamic=this.block.has_update_method;var previous_key=block.get_unique_name('previous_key');var snippet=this.node.expression.manipulate(block);block.add_variable(previous_key,snippet);var not_equal=this.renderer.component.component_options.immutable?x(_templateObject463||(_templateObject463=(0,_taggedTemplateLiteral2.default)([\"@not_equal\"]))):x(_templateObject464||(_templateObject464=(0,_taggedTemplateLiteral2.default)([\"@safe_not_equal\"])));var condition=x(_templateObject465||(_templateObject465=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\"(\",\", \",\" = \",\")\"])),this.renderer.dirty(this.dependencies),not_equal,previous_key,previous_key,snippet);block.chunks.init.push(b(_templateObject466||(_templateObject466=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tlet \",\" = \",\"(#ctx);\\n\\t\\t\"])),this.var,this.block.name));block.chunks.create.push(b(_templateObject467||(_templateObject467=(0,_taggedTemplateLiteral2.default)([\"\",\".c();\"])),this.var));if(this.renderer.options.hydratable){block.chunks.claim.push(b(_templateObject468||(_templateObject468=(0,_taggedTemplateLiteral2.default)([\"\",\".l(\",\");\"])),this.var,parent_nodes));}block.chunks.mount.push(b(_templateObject469||(_templateObject469=(0,_taggedTemplateLiteral2.default)([\"\",\".m(\",\", \",\");\"])),this.var,parent_node||'#target',parent_node?'null':'#anchor'));var anchor=this.get_or_create_anchor(block,parent_node,parent_nodes);var body=b(_templateObject470||(_templateObject470=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\"\\n\\t\\t\\t\",\" = \",\"(#ctx);\\n\\t\\t\\t\",\".c();\\n\\t\\t\\t\",\"\\n\\t\\t\\t\",\".m(\",\", \",\");\\n\\t\\t\"])),has_transitions?b(_templateObject471||(_templateObject471=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\t@group_outros();\\n\\t\\t\\t\\t\\t\\t@transition_out(\",\", 1, 1, @noop);\\n\\t\\t\\t\\t\\t\\t@check_outros();\\n\\t\\t\\t\\t\\t\"])),this.var):b(_templateObject472||(_templateObject472=(0,_taggedTemplateLiteral2.default)([\"\",\".d(1);\"])),this.var),this.var,this.block.name,this.var,has_transitions&&b(_templateObject473||(_templateObject473=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\")\"])),this.var),this.var,this.get_update_mount_node(anchor),anchor);if(dynamic){block.chunks.update.push(b(_templateObject474||(_templateObject474=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\",\".p(#ctx, #dirty);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),condition,body,this.var));}else{block.chunks.update.push(b(_templateObject475||(_templateObject475=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),condition,body));}if(has_transitions){block.chunks.intro.push(b(_templateObject476||(_templateObject476=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\")\"])),this.var));block.chunks.outro.push(b(_templateObject477||(_templateObject477=(0,_taggedTemplateLiteral2.default)([\"@transition_out(\",\")\"])),this.var));}block.chunks.destroy.push(b(_templateObject478||(_templateObject478=(0,_taggedTemplateLiteral2.default)([\"\",\".d(detaching)\"])),this.var));}}]);return KeyBlockWrapper;}(Wrapper);function get_slot_definition(block,scope,lets){if(lets.length===0)return{block:block,scope:scope};var context_input={type:'ObjectPattern',properties:lets.map(function(l){return{type:'Property',kind:'init',key:l.name,value:l.value||l.name};})};var properties=[];var value_map=new Map();lets.forEach(function(l){var value;if(l.names.length>1){// more than one, probably destructuring\nvar unique_name=block.get_unique_name(l.names.join('_')).name;value_map.set(l.value,unique_name);value={type:'Identifier',name:unique_name};}else{value=l.value||l.name;}properties.push({type:'Property',kind:'init',key:l.name,value:value});});var changes_input={type:'ObjectPattern',properties:properties};var names=new Set();var names_lookup=new Map();lets.forEach(function(l){l.names.forEach(function(name){names.add(name);if(value_map.has(l.value)){names_lookup.set(name,value_map.get(l.value));}});});var context={type:'ObjectExpression',properties:Array.from(names).map(function(name){return p(_templateObject479||(_templateObject479=(0,_taggedTemplateLiteral2.default)([\"\",\": \",\"\"])),block.renderer.context_lookup.get(name).index,name);})};var context_lookup=block.renderer.context_lookup;// i am well aware that this code is gross\n// TODO: context-overflow make it less gross\nvar changes={type:'ParenthesizedExpression',get expression(){if(block.renderer.context_overflow){var grouped=[];Array.from(names).forEach(function(name){var i=context_lookup.get(name).index.value;var g=Math.floor(i/31);var lookup_name=names_lookup.has(name)?names_lookup.get(name):name;if(!grouped[g])grouped[g]=[];grouped[g].push({name:lookup_name,n:i%31});});var elements=[];for(var g=0;g<grouped.length;g+=1){elements[g]=grouped[g]?grouped[g].map(function(_ref17){var name=_ref17.name,n=_ref17.n;return x(_templateObject480||(_templateObject480=(0,_taggedTemplateLiteral2.default)([\"\",\" ? \",\" : 0\"])),name,1<<n);}).reduce(function(lhs,rhs){return x(_templateObject481||(_templateObject481=(0,_taggedTemplateLiteral2.default)([\"\",\" | \",\"\"])),lhs,rhs);}):x(_templateObject482||(_templateObject482=(0,_taggedTemplateLiteral2.default)([\"0\"])));}return{type:'ArrayExpression',elements:elements};}return Array.from(names).map(function(name){var lookup_name=names_lookup.has(name)?names_lookup.get(name):name;var i=context_lookup.get(name).index.value;return x(_templateObject483||(_templateObject483=(0,_taggedTemplateLiteral2.default)([\"\",\" ? \",\" : 0\"])),lookup_name,1<<i);}).reduce(function(lhs,rhs){return x(_templateObject484||(_templateObject484=(0,_taggedTemplateLiteral2.default)([\"\",\" | \",\"\"])),lhs,rhs);});}};return{block:block,scope:scope,get_context:x(_templateObject485||(_templateObject485=(0,_taggedTemplateLiteral2.default)([\"\",\" => \",\"\"])),context_input,context),get_changes:x(_templateObject486||(_templateObject486=(0,_taggedTemplateLiteral2.default)([\"\",\" => \",\"\"])),changes_input,changes)};}var SlotTemplateWrapper=/*#__PURE__*/function(_Wrapper14){(0,_inherits2.default)(SlotTemplateWrapper,_Wrapper14);var _super55=_createSuper(SlotTemplateWrapper);function SlotTemplateWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _this73;(0,_classCallCheck2.default)(this,SlotTemplateWrapper);_this73=_super55.call(this,renderer,block,parent,node);var _this73$node=_this73.node,scope=_this73$node.scope,lets=_this73$node.lets,const_tags=_this73$node.const_tags,slot_template_name=_this73$node.slot_template_name;lets.forEach(function(l){extract_names(l.value||l.name).forEach(function(name){renderer.add_to_context(name,true);});});add_const_tags_context(renderer,const_tags);_this73.block=block.child({comment:create_debugging_comment(_this73.node,_this73.renderer.component),name:_this73.renderer.component.get_unique_name(\"create_\".concat(sanitize(slot_template_name),\"_slot\")),type:'slot'});_this73.renderer.blocks.push(_this73.block);var seen=new Set(lets.map(function(l){return l.name.name;}));_this73.parent.node.lets.forEach(function(l){if(!seen.has(l.name.name))lets.push(l);});_this73.parent.set_slot(slot_template_name,get_slot_definition(_this73.block,scope,lets));_this73.fragment=new FragmentWrapper(renderer,_this73.block,node.type==='SlotTemplate'?node.children:[node],(0,_assertThisInitialized2.default)(_this73),strip_whitespace,next_sibling);_this73.block.parent.add_dependencies(_this73.block.dependencies);return _this73;}(0,_createClass2.default)(SlotTemplateWrapper,[{key:\"render\",value:function render(){this.fragment.render(this.block,null,x(_templateObject487||(_templateObject487=(0,_taggedTemplateLiteral2.default)([\"#nodes\"]))));if(this.node.const_tags.length>0){this.render_get_context();}}},{key:\"render_get_context\",value:function render_get_context(){var get_context=this.block.renderer.component.get_unique_name('get_context');this.block.renderer.blocks.push(b(_templateObject488||(_templateObject488=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfunction \",\"(#ctx) {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\\n\\t\\t\"])),get_context,add_const_tags(this.block,this.node.const_tags,'#ctx')));this.block.chunks.declarations.push(b(_templateObject489||(_templateObject489=(0,_taggedTemplateLiteral2.default)([\"\",\"(#ctx)\"])),get_context));if(this.block.has_update_method){this.block.chunks.update.unshift(b(_templateObject490||(_templateObject490=(0,_taggedTemplateLiteral2.default)([\"\",\"(#ctx)\"])),get_context));}}}]);return SlotTemplateWrapper;}(Wrapper);function string_to_member_expression(name){var parts=name.split('.');var node={type:'Identifier',name:parts[0]};for(var _i38=1;_i38<parts.length;_i38++){node={type:'MemberExpression',object:node,property:{type:'Identifier',name:parts[_i38]}};}return node;}var InlineComponentWrapper=/*#__PURE__*/function(_Wrapper15){(0,_inherits2.default)(InlineComponentWrapper,_Wrapper15);var _super56=_createSuper(InlineComponentWrapper);function InlineComponentWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _this74;(0,_classCallCheck2.default)(this,InlineComponentWrapper);_this74=_super56.call(this,renderer,block,parent,node);_this74.slots=new Map();_this74.children=[];_this74.cannot_use_innerhtml();_this74.not_static_content();if(_this74.node.expression){block.add_dependencies(_this74.node.expression.dependencies);}_this74.node.attributes.forEach(function(attr){block.add_dependencies(attr.dependencies);});_this74.node.bindings.forEach(function(binding){if(binding.is_contextual){mark_each_block_bindings((0,_assertThisInitialized2.default)(_this74),binding);}block.add_dependencies(binding.expression.dependencies);});_this74.node.handlers.forEach(function(handler){if(handler.expression){block.add_dependencies(handler.expression.dependencies);}});_this74.node.css_custom_properties.forEach(function(attr){block.add_dependencies(attr.dependencies);});_this74.var={type:'Identifier',name:(_this74.node.name==='svelte:self'?renderer.component.name.name:_this74.node.name==='svelte:component'?'switch_instance':sanitize(_this74.node.name)).toLowerCase()};if(_this74.node.children.length){_this74.node.lets.forEach(function(l){extract_names(l.value||l.name).forEach(function(name){renderer.add_to_context(name,true);});});_this74.children=_this74.node.children.map(function(child){return new SlotTemplateWrapper(renderer,block,(0,_assertThisInitialized2.default)(_this74),child,strip_whitespace,next_sibling);});}block.add_outro();return _this74;}(0,_createClass2.default)(InlineComponentWrapper,[{key:\"set_slot\",value:function set_slot(name,slot_definition){if(this.slots.has(name)){if(name==='default'){throw new Error('Found elements without slot attribute when using slot=\"default\"');}throw new Error(\"Duplicate slot name \\\"\".concat(name,\"\\\" in <\").concat(this.node.name,\">\"));}this.slots.set(name,slot_definition);}},{key:\"warn_if_reactive\",value:function warn_if_reactive(){var name=this.node.name;var variable=this.renderer.component.var_lookup.get(name);if(!variable){return;}if(variable.reassigned||variable.export_name||variable.is_reactive_dependency){this.renderer.component.warn(this.node,compiler_warnings.reactive_component(name));}}},{key:\"render\",value:function render(block,parent_node,parent_nodes){var _this75=this;this.warn_if_reactive();var renderer=this.renderer;var component=renderer.component;var name=this.var;block.add_variable(name);var component_opts=x(_templateObject491||(_templateObject491=(0,_taggedTemplateLiteral2.default)([\"{}\"])));var statements=[];var updates=[];this.children.forEach(function(child){_this75.renderer.add_to_context('$$scope',true);child.render(block,null,x(_templateObject492||(_templateObject492=(0,_taggedTemplateLiteral2.default)([\"#nodes\"]))));});var props;var name_changes=block.get_unique_name(\"\".concat(name.name,\"_changes\"));var uses_spread=!!this.node.attributes.find(function(a){return a.is_spread;});// removing empty slot\nvar _iterator11=_createForOfIteratorHelper(this.slots.keys()),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var slot=_step11.value;if(!this.slots.get(slot).block.has_content()){this.renderer.remove_block(this.slots.get(slot).block);this.slots.delete(slot);}}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}var has_css_custom_properties=this.node.css_custom_properties.length>0;var css_custom_properties_wrapper=has_css_custom_properties?block.get_unique_name('div'):null;if(has_css_custom_properties){block.add_variable(css_custom_properties_wrapper);}var initial_props=this.slots.size>0?[p(_templateObject493||(_templateObject493=(0,_taggedTemplateLiteral2.default)([\"$$slots: {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\"])),Array.from(this.slots).map(function(_ref18){var _ref19=(0,_slicedToArray2.default)(_ref18,2),name=_ref19[0],slot=_ref19[1];return p(_templateObject494||(_templateObject494=(0,_taggedTemplateLiteral2.default)([\"\",\": [\",\", \",\", \",\"]\"])),name,slot.block.name,slot.get_context||null,slot.get_changes||null);})),p(_templateObject495||(_templateObject495=(0,_taggedTemplateLiteral2.default)([\"$$scope: {\\n\\t\\t\\t\\t\\tctx: #ctx\\n\\t\\t\\t\\t}\"])))]:[];var attribute_object=uses_spread?x(_templateObject496||(_templateObject496=(0,_taggedTemplateLiteral2.default)([\"{ \",\" }\"])),initial_props):x(_templateObject497||(_templateObject497=(0,_taggedTemplateLiteral2.default)([\"{\\n\\t\\t\\t\\t\",\",\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\"])),this.node.attributes.map(function(attr){return p(_templateObject498||(_templateObject498=(0,_taggedTemplateLiteral2.default)([\"\",\": \",\"\"])),attr.name,attr.get_value(block));}),initial_props);if(this.node.attributes.length||this.node.bindings.length||initial_props.length){if(!uses_spread&&this.node.bindings.length===0){component_opts.properties.push(p(_templateObject499||(_templateObject499=(0,_taggedTemplateLiteral2.default)([\"props: \",\"\"])),attribute_object));}else{props=block.get_unique_name(\"\".concat(name.name,\"_props\"));component_opts.properties.push(p(_templateObject500||(_templateObject500=(0,_taggedTemplateLiteral2.default)([\"props: \",\"\"])),props));}}if(component.compile_options.dev){// TODO this is a terrible hack, but without it the component\n// will complain that options.target is missing. This would\n// work better if components had separate public and private\n// APIs\ncomponent_opts.properties.push(p(_templateObject501||(_templateObject501=(0,_taggedTemplateLiteral2.default)([\"$$inline: true\"]))));}var fragment_dependencies=new Set(this.slots.size?['$$scope']:[]);this.slots.forEach(function(slot){slot.block.dependencies.forEach(function(name){var is_let=slot.scope.is_let(name);var variable=renderer.component.var_lookup.get(name);if(is_let||is_dynamic(variable))fragment_dependencies.add(name);});});var dynamic_attributes=this.node.attributes.filter(function(a){return a.get_dependencies().length>0;});if(!uses_spread&&(dynamic_attributes.length>0||this.node.bindings.length>0||fragment_dependencies.size>0)){updates.push(b(_templateObject502||(_templateObject502=(0,_taggedTemplateLiteral2.default)([\"const \",\" = {};\"])),name_changes));}if(this.node.attributes.length){if(uses_spread){var levels=block.get_unique_name(\"\".concat(this.var.name,\"_spread_levels\"));var _initial_props=[];var changes=[];var all_dependencies=new Set();this.node.attributes.forEach(function(attr){add_to_set(all_dependencies,attr.dependencies);});this.node.attributes.forEach(function(attr,i){var name=attr.name,dependencies=attr.dependencies;var condition=dependencies.size>0&&dependencies.size!==all_dependencies.size?renderer.dirty(Array.from(dependencies)):null;var unchanged=dependencies.size===0;var change_object;if(attr.is_spread){var _value11=attr.expression.manipulate(block);_initial_props.push(_value11);var value_object=_value11;if(attr.expression.node.type!=='ObjectExpression'){value_object=x(_templateObject503||(_templateObject503=(0,_taggedTemplateLiteral2.default)([\"@get_spread_object(\",\")\"])),_value11);}change_object=value_object;}else{var obj=x(_templateObject504||(_templateObject504=(0,_taggedTemplateLiteral2.default)([\"{ \",\": \",\" }\"])),name,attr.get_value(block));_initial_props.push(obj);change_object=obj;}changes.push(unchanged?x(_templateObject505||(_templateObject505=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"]\"])),levels,i):condition?x(_templateObject506||(_templateObject506=(0,_taggedTemplateLiteral2.default)([\"\",\" && \",\"\"])),condition,change_object):change_object);});block.chunks.init.push(b(_templateObject507||(_templateObject507=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tconst \",\" = [\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t];\\n\\t\\t\\t\\t\"])),levels,_initial_props));statements.push(b(_templateObject508||(_templateObject508=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tfor (let #i = 0; #i < \",\".length; #i += 1) {\\n\\t\\t\\t\\t\\t\\t\",\" = @assign(\",\", \",\"[#i]);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),levels,props,props,levels));if(all_dependencies.size){var condition=renderer.dirty(Array.from(all_dependencies));updates.push(b(_templateObject509||(_templateObject509=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tconst \",\" = \",\" ? @get_spread_update(\",\", [\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t]) : {}\\n\\t\\t\\t\\t\\t\"])),name_changes,condition,levels,changes));}else{updates.push(b(_templateObject510||(_templateObject510=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tconst \",\" = {};\\n\\t\\t\\t\\t\\t\"])),name_changes));}}else{dynamic_attributes.forEach(function(attribute){var dependencies=attribute.get_dependencies();if(dependencies.length>0){var _condition2=renderer.dirty(dependencies);updates.push(b(_templateObject511||(_templateObject511=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\t\\tif (\",\") \",\".\",\" = \",\";\\n\\t\\t\\t\\t\\t\\t\"])),_condition2,name_changes,attribute.name,attribute.get_value(block)));}});}}if(fragment_dependencies.size>0){updates.push(b(_templateObject512||(_templateObject512=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\".$$scope = { dirty: #dirty, ctx: #ctx };\\n\\t\\t\\t\\t}\"])),renderer.dirty(Array.from(fragment_dependencies)),name_changes));}var munged_bindings=this.node.bindings.map(function(binding){component.has_reactive_assignments=true;if(binding.name==='this'){return bind_this(component,block,new BindingWrapper(block,binding,_this75),_this75.var);}var id=component.get_unique_name(\"\".concat(_this75.var.name,\"_\").concat(binding.name,\"_binding\"));renderer.add_to_context(id.name);var callee=renderer.reference(id);var updating=block.get_unique_name(\"updating_\".concat(binding.name));block.add_variable(updating);var snippet=binding.expression.manipulate(block);statements.push(b(_templateObject513||(_templateObject513=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\" !== void 0) {\\n\\t\\t\\t\\t\\t\",\".\",\" = \",\";\\n\\t\\t\\t\\t}\"])),snippet,props,binding.name,snippet));updates.push(b(_templateObject514||(_templateObject514=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (!\",\" && \",\") {\\n\\t\\t\\t\\t\\t\",\" = true;\\n\\t\\t\\t\\t\\t\",\".\",\" = \",\";\\n\\t\\t\\t\\t\\t@add_flush_callback(() => \",\" = false);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),updating,renderer.dirty(Array.from(binding.expression.dependencies)),updating,name_changes,binding.name,snippet,updating));var contextual_dependencies=Array.from(binding.expression.contextual_dependencies);var dependencies=Array.from(binding.expression.dependencies);var lhs=binding.raw_expression;if(binding.is_contextual&&binding.expression.node.type==='Identifier'){// bind:x={y} — we can't just do `y = x`, we need to\n// to `array[index] = x;\nvar _name3=binding.expression.node.name;var _block$bindings$get=block.bindings.get(_name3),object=_block$bindings$get.object,property=_block$bindings$get.property,_snippet4=_block$bindings$get.snippet;lhs=_snippet4;contextual_dependencies.push(object.name,property.name);}var params=[x(_templateObject515||(_templateObject515=(0,_taggedTemplateLiteral2.default)([\"#value\"])))];var args=[x(_templateObject516||(_templateObject516=(0,_taggedTemplateLiteral2.default)([\"#value\"])))];if(contextual_dependencies.length>0){contextual_dependencies.forEach(function(name){params.push({type:'Identifier',name:name});renderer.add_to_context(name,true);args.push(renderer.reference(name));});block.maintain_context=true;// TODO put this somewhere more logical\n}block.chunks.init.push(b(_templateObject517||(_templateObject517=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfunction \",\"(#value) {\\n\\t\\t\\t\\t\\t\",\"(\",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),id,callee,args));var invalidate_binding=b(_templateObject518||(_templateObject518=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\" = #value;\\n\\t\\t\\t\\t\",\";\\n\\t\\t\\t\"])),lhs,renderer.invalidate(dependencies[0]));if(binding.expression.node.type==='MemberExpression'){invalidate_binding=b(_templateObject519||(_templateObject519=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif ($$self.$$.not_equal(\",\", #value)) {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\"])),lhs,invalidate_binding);}var body=b(_templateObject520||(_templateObject520=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfunction \",\"(\",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),id,params,invalidate_binding);component.partly_hoisted.push(body);return b(_templateObject521||(_templateObject521=(0,_taggedTemplateLiteral2.default)([\"@binding_callbacks.push(() => @bind(\",\", '\",\"', \",\"));\"])),_this75.var,binding.name,id);});var munged_handlers=this.node.handlers.map(function(handler){var event_handler=new EventHandlerWrapper(handler,_this75);var snippet=event_handler.get_snippet(block);if(handler.modifiers.has('once'))snippet=x(_templateObject522||(_templateObject522=(0,_taggedTemplateLiteral2.default)([\"@once(\",\")\"])),snippet);return b(_templateObject523||(_templateObject523=(0,_taggedTemplateLiteral2.default)([\"\",\".$on(\\\"\",\"\\\", \",\");\"])),name,handler.name,snippet);});if(this.node.name==='svelte:component'){var switch_value=block.get_unique_name('switch_value');var switch_props=block.get_unique_name('switch_props');var snippet=this.node.expression.manipulate(block);block.chunks.init.push(b(_templateObject524||(_templateObject524=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tvar \",\" = \",\";\\n\\n\\t\\t\\t\\tfunction \",\"(#ctx) {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\treturn \",\";\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\" = new \",\"(\",\"(#ctx));\\n\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),switch_value,snippet,switch_props,(this.node.attributes.length>0||this.node.bindings.length>0)&&b(_templateObject525||(_templateObject525=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\"\"])),props&&b(_templateObject526||(_templateObject526=(0,_taggedTemplateLiteral2.default)([\"let \",\" = \",\";\"])),props,attribute_object)),statements,component_opts,switch_value,name,switch_value,switch_props,munged_bindings,munged_handlers));block.chunks.create.push(b(_templateObject527||(_templateObject527=(0,_taggedTemplateLiteral2.default)([\"if (\",\") @create_component(\",\".$$.fragment);\"])),name,name));if(parent_nodes&&this.renderer.options.hydratable){block.chunks.claim.push(b(_templateObject528||(_templateObject528=(0,_taggedTemplateLiteral2.default)([\"if (\",\") @claim_component(\",\".$$.fragment, \",\");\"])),name,name,parent_nodes));}block.chunks.mount.push(b(_templateObject529||(_templateObject529=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t@mount_component(\",\", \",\", \",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),name,name,parent_node||'#target',parent_node?'null':'#anchor'));var anchor=this.get_or_create_anchor(block,parent_node,parent_nodes);var update_mount_node=this.get_update_mount_node(anchor);if(updates.length){block.chunks.update.push(b(_templateObject530||(_templateObject530=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\"])),updates));}block.chunks.update.push(b(_templateObject531||(_templateObject531=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\" !== (\",\" = \",\")) {\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t@group_outros();\\n\\t\\t\\t\\t\\t\\tconst old_component = \",\";\\n\\t\\t\\t\\t\\t\\t@transition_out(old_component.$$.fragment, 1, 0, () => {\\n\\t\\t\\t\\t\\t\\t\\t@destroy_component(old_component, 1);\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t\\t@check_outros();\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\" = new \",\"(\",\"(#ctx));\\n\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\\t\\t@create_component(\",\".$$.fragment);\\n\\t\\t\\t\\t\\t\\t@transition_in(\",\".$$.fragment, 1);\\n\\t\\t\\t\\t\\t\\t@mount_component(\",\", \",\", \",\");\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\t\",\" = null;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t} else if (\",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),switch_value,switch_value,snippet,name,name,switch_value,name,switch_value,switch_props,munged_bindings,munged_handlers,name,name,name,update_mount_node,anchor,name,switch_value,updates.length>0&&b(_templateObject532||(_templateObject532=(0,_taggedTemplateLiteral2.default)([\"\",\".$set(\",\");\"])),name,name_changes)));block.chunks.intro.push(b(_templateObject533||(_templateObject533=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") @transition_in(\",\".$$.fragment, #local);\\n\\t\\t\\t\"])),name,name));block.chunks.outro.push(b(_templateObject534||(_templateObject534=(0,_taggedTemplateLiteral2.default)([\"if (\",\") @transition_out(\",\".$$.fragment, #local);\"])),name,name));block.chunks.destroy.push(b(_templateObject535||(_templateObject535=(0,_taggedTemplateLiteral2.default)([\"if (\",\") @destroy_component(\",\", \",\");\"])),name,name,parent_node?null:'detaching'));}else{var _expression12=this.node.name==='svelte:self'?component.name:this.renderer.reference(string_to_member_expression(this.node.name));block.chunks.init.push(b(_templateObject536||(_templateObject536=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\" = new \",\"(\",\");\\n\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\"])),(this.node.attributes.length>0||this.node.bindings.length>0)&&b(_templateObject537||(_templateObject537=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\"\"])),props&&b(_templateObject538||(_templateObject538=(0,_taggedTemplateLiteral2.default)([\"let \",\" = \",\";\"])),props,attribute_object)),statements,name,_expression12,component_opts,munged_bindings,munged_handlers));if(has_css_custom_properties){block.chunks.create.push(b(_templateObject539||(_templateObject539=(0,_taggedTemplateLiteral2.default)([\"\",\" = @element(\\\"div\\\");\"])),css_custom_properties_wrapper));block.chunks.hydrate.push(b(_templateObject540||(_templateObject540=(0,_taggedTemplateLiteral2.default)([\"@set_style(\",\", \\\"display\\\", \\\"contents\\\");\"])),css_custom_properties_wrapper));this.node.css_custom_properties.forEach(function(attr){var dependencies=attr.get_dependencies();var should_cache=attr.should_cache();var last=should_cache&&block.get_unique_name(\"\".concat(attr.name.replace(/[^a-zA-Z_$]/g,'_'),\"_last\"));if(should_cache)block.add_variable(last);var value=attr.get_value(block);var init=should_cache?x(_templateObject541||(_templateObject541=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\"\"])),last,value):value;block.chunks.hydrate.push(b(_templateObject542||(_templateObject542=(0,_taggedTemplateLiteral2.default)([\"@set_style(\",\", \\\"\",\"\\\", \",\");\"])),css_custom_properties_wrapper,attr.name,init));if(dependencies.length>0){var _condition3=block.renderer.dirty(dependencies);if(should_cache)_condition3=x(_templateObject543||(_templateObject543=(0,_taggedTemplateLiteral2.default)([\"\",\" && (\",\" !== (\",\" = \",\"))\"])),_condition3,last,last,value);block.chunks.update.push(b(_templateObject544||(_templateObject544=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\\t\\t@set_style(\",\", \\\"\",\"\\\", \",\");\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t\"])),_condition3,css_custom_properties_wrapper,attr.name,should_cache?last:value));}});}block.chunks.create.push(b(_templateObject545||(_templateObject545=(0,_taggedTemplateLiteral2.default)([\"@create_component(\",\".$$.fragment);\"])),name));if(parent_nodes&&this.renderer.options.hydratable){var nodes=parent_nodes;if(has_css_custom_properties){nodes=block.get_unique_name(\"\".concat(css_custom_properties_wrapper.name,\"_nodes\"));block.chunks.claim.push(b(_templateObject546||(_templateObject546=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\t\",\" = @claim_element(\",\", \\\"DIV\\\", { style: true })\\n\\t\\t\\t\\t\\t\\tvar \",\" = @children(\",\");\\n\\t\\t\\t\\t\\t\"])),css_custom_properties_wrapper,parent_nodes,nodes,css_custom_properties_wrapper));}block.chunks.claim.push(b(_templateObject547||(_templateObject547=(0,_taggedTemplateLiteral2.default)([\"@claim_component(\",\".$$.fragment, \",\");\"])),name,nodes));}if(has_css_custom_properties){if(parent_node){block.chunks.mount.push(b(_templateObject548||(_templateObject548=(0,_taggedTemplateLiteral2.default)([\"@append(\",\", \",\")\"])),parent_node,css_custom_properties_wrapper));if(is_head(parent_node)){block.chunks.destroy.push(b(_templateObject549||(_templateObject549=(0,_taggedTemplateLiteral2.default)([\"@detach(\",\");\"])),css_custom_properties_wrapper));}}else{block.chunks.mount.push(b(_templateObject550||(_templateObject550=(0,_taggedTemplateLiteral2.default)([\"@insert(#target, \",\", #anchor);\"])),css_custom_properties_wrapper));// TODO we eventually need to consider what happens to elements\n// that belong to the same outgroup as an outroing element...\nblock.chunks.destroy.push(b(_templateObject551||(_templateObject551=(0,_taggedTemplateLiteral2.default)([\"if (detaching) @detach(\",\");\"])),css_custom_properties_wrapper));}block.chunks.mount.push(b(_templateObject552||(_templateObject552=(0,_taggedTemplateLiteral2.default)([\"@mount_component(\",\", \",\", null);\"])),name,css_custom_properties_wrapper));}else{block.chunks.mount.push(b(_templateObject553||(_templateObject553=(0,_taggedTemplateLiteral2.default)([\"@mount_component(\",\", \",\", \",\");\"])),name,parent_node||'#target',parent_node?'null':'#anchor'));}block.chunks.intro.push(b(_templateObject554||(_templateObject554=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t@transition_in(\",\".$$.fragment, #local);\\n\\t\\t\\t\"])),name));if(updates.length){block.chunks.update.push(b(_templateObject555||(_templateObject555=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\".$set(\",\");\\n\\t\\t\\t\\t\"])),updates,name,name_changes));}block.chunks.destroy.push(b(_templateObject556||(_templateObject556=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t@destroy_component(\",\", \",\");\\n\\t\\t\\t\"])),name,parent_node?null:'detaching'));block.chunks.outro.push(b(_templateObject557||(_templateObject557=(0,_taggedTemplateLiteral2.default)([\"@transition_out(\",\".$$.fragment, #local);\"])),name));}}}]);return InlineComponentWrapper;}(Wrapper);function get_slot_data(values){var block=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{type:'ObjectExpression',properties:Array.from(values.values()).filter(function(attribute){return attribute.name!=='name';}).map(function(attribute){if(attribute.is_spread){var argument=get_spread_value(block,attribute);return{type:'SpreadElement',argument:argument};}var value=get_value(block,attribute);return p(_templateObject558||(_templateObject558=(0,_taggedTemplateLiteral2.default)([\"\",\": \",\"\"])),attribute.name,value);})};}function get_value(block,attribute){if(attribute.is_true)return x(_templateObject559||(_templateObject559=(0,_taggedTemplateLiteral2.default)([\"true\"])));if(attribute.chunks.length===0)return x(_templateObject560||(_templateObject560=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\"\"])));var value=attribute.chunks.map(function(chunk){return chunk.type==='Text'?string_literal(chunk.data):block?chunk.manipulate(block):chunk.node;}).reduce(function(lhs,rhs){return x(_templateObject561||(_templateObject561=(0,_taggedTemplateLiteral2.default)([\"\",\" + \",\"\"])),lhs,rhs);});if(attribute.chunks.length>1&&attribute.chunks[0].type!=='Text'){value=x(_templateObject562||(_templateObject562=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\" + \",\"\"])),value);}return value;}function get_spread_value(block,attribute){return block?attribute.expression.manipulate(block):attribute.expression.node;}var SlotWrapper=/*#__PURE__*/function(_Wrapper16){(0,_inherits2.default)(SlotWrapper,_Wrapper16);var _super57=_createSuper(SlotWrapper);function SlotWrapper(renderer,block,parent,node,strip_whitespace,next_sibling){var _this76;(0,_classCallCheck2.default)(this,SlotWrapper);_this76=_super57.call(this,renderer,block,parent,node);_this76.fallback=null;_this76.var={type:'Identifier',name:'slot'};_this76.dependencies=new Set(['$$scope']);_this76.cannot_use_innerhtml();_this76.not_static_content();if(_this76.node.children.length){_this76.fallback=block.child({comment:create_debugging_comment(_this76.node.children[0],_this76.renderer.component),name:_this76.renderer.component.get_unique_name('fallback_block'),type:'fallback'});renderer.blocks.push(_this76.fallback);}_this76.fragment=new FragmentWrapper(renderer,_this76.fallback,node.children,(0,_assertThisInitialized2.default)(_this76),strip_whitespace,next_sibling);_this76.node.values.forEach(function(attribute){add_to_set(_this76.dependencies,attribute.dependencies);});block.add_dependencies(_this76.dependencies);// we have to do this, just in case\nblock.add_intro();block.add_outro();return _this76;}(0,_createClass2.default)(SlotWrapper,[{key:\"render\",value:function render(block,parent_node,parent_nodes){var _this77=this;var renderer=this.renderer;var slot_name=this.node.slot_name;if(this.slot_block){block=this.slot_block;}var get_slot_changes_fn;var get_slot_spread_changes_fn;var get_slot_context_fn;if(this.node.values.size>0){get_slot_changes_fn=renderer.component.get_unique_name(\"get_\".concat(sanitize(slot_name),\"_slot_changes\"));get_slot_context_fn=renderer.component.get_unique_name(\"get_\".concat(sanitize(slot_name),\"_slot_context\"));var changes=x(_templateObject563||(_templateObject563=(0,_taggedTemplateLiteral2.default)([\"{}\"])));var spread_dynamic_dependencies=new Set();this.node.values.forEach(function(attribute){if(attribute.type==='Spread'){add_to_set(spread_dynamic_dependencies,Array.from(attribute.dependencies).filter(function(name){return _this77.is_dependency_dynamic(name);}));}else{var _dynamic_dependencies=Array.from(attribute.dependencies).filter(function(name){return _this77.is_dependency_dynamic(name);});if(_dynamic_dependencies.length>0){changes.properties.push(p(_templateObject564||(_templateObject564=(0,_taggedTemplateLiteral2.default)([\"\",\": \",\"\"])),attribute.name,renderer.dirty(_dynamic_dependencies)));}}});renderer.blocks.push(b(_templateObject565||(_templateObject565=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tconst \",\" = #dirty => \",\";\\n\\t\\t\\t\\tconst \",\" = #ctx => \",\";\\n\\t\\t\\t\"])),get_slot_changes_fn,changes,get_slot_context_fn,get_slot_data(this.node.values,block)));if(spread_dynamic_dependencies.size){get_slot_spread_changes_fn=renderer.component.get_unique_name(\"get_\".concat(sanitize(slot_name),\"_slot_spread_changes\"));renderer.blocks.push(b(_templateObject566||(_templateObject566=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tconst \",\" = #dirty => \",\";\\n\\t\\t\\t\\t\"])),get_slot_spread_changes_fn,renderer.dirty(Array.from(spread_dynamic_dependencies))));}}else{get_slot_changes_fn='null';get_slot_context_fn='null';}var has_fallback=!!this.fallback;if(this.fallback){this.fragment.render(this.fallback,null,x(_templateObject567||(_templateObject567=(0,_taggedTemplateLiteral2.default)([\"#nodes\"]))));has_fallback=this.fallback.has_content();if(!has_fallback){renderer.remove_block(this.fallback);}}var slot=block.get_unique_name(\"\".concat(sanitize(slot_name),\"_slot\"));var slot_definition=block.get_unique_name(\"\".concat(sanitize(slot_name),\"_slot_template\"));var slot_or_fallback=has_fallback?block.get_unique_name(\"\".concat(sanitize(slot_name),\"_slot_or_fallback\")):slot;block.chunks.init.push(b(_templateObject568||(_templateObject568=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tconst \",\" = \",\".\",\";\\n\\t\\t\\tconst \",\" = @create_slot(\",\", #ctx, \",\", \",\");\\n\\t\\t\\t\",\"\\n\\t\\t\"])),slot_definition,renderer.reference('#slots'),slot_name,slot,slot_definition,renderer.reference('$$scope'),get_slot_context_fn,has_fallback?b(_templateObject569||(_templateObject569=(0,_taggedTemplateLiteral2.default)([\"const \",\" = \",\" || \",\"(#ctx);\"])),slot_or_fallback,slot,this.fallback.name):null));block.chunks.create.push(b(_templateObject570||(_templateObject570=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".c();\"])),slot_or_fallback,slot_or_fallback));if(renderer.options.hydratable){block.chunks.claim.push(b(_templateObject571||(_templateObject571=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".l(\",\");\"])),slot_or_fallback,slot_or_fallback,parent_nodes));}block.chunks.mount.push(b(_templateObject572||(_templateObject572=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\",\".m(\",\", \",\");\\n\\t\\t\\t}\\n\\t\\t\"])),slot_or_fallback,slot_or_fallback,parent_node||'#target',parent_node?'null':'#anchor'));block.chunks.intro.push(b(_templateObject573||(_templateObject573=(0,_taggedTemplateLiteral2.default)([\"@transition_in(\",\", #local);\"])),slot_or_fallback));block.chunks.outro.push(b(_templateObject574||(_templateObject574=(0,_taggedTemplateLiteral2.default)([\"@transition_out(\",\", #local);\"])),slot_or_fallback));var dynamic_dependencies=Array.from(this.dependencies).filter(function(name){return _this77.is_dependency_dynamic(name);});var fallback_dynamic_dependencies=has_fallback?Array.from(this.fallback.dependencies).filter(function(name){return _this77.is_dependency_dynamic(name);}):[];var condition=renderer.dirty(dynamic_dependencies);if(block.has_outros){condition=x(_templateObject575||(_templateObject575=(0,_taggedTemplateLiteral2.default)([\"!#current || \",\"\"])),condition);}// conditions to treat everything as dirty\nvar all_dirty_conditions=[get_slot_spread_changes_fn?x(_templateObject576||(_templateObject576=(0,_taggedTemplateLiteral2.default)([\"\",\"(#dirty)\"])),get_slot_spread_changes_fn):null,block.has_outros?x(_templateObject577||(_templateObject577=(0,_taggedTemplateLiteral2.default)([\"!#current\"]))):null].filter(Boolean);var all_dirty_condition=all_dirty_conditions.length?all_dirty_conditions.reduce(function(condition1,condition2){return x(_templateObject578||(_templateObject578=(0,_taggedTemplateLiteral2.default)([\"\",\" || \",\"\"])),condition1,condition2);}):null;var slot_update;if(all_dirty_condition){var dirty=x(_templateObject579||(_templateObject579=(0,_taggedTemplateLiteral2.default)([\"\",\" ? @get_all_dirty_from_scope(\",\") : @get_slot_changes(\",\", \",\", #dirty, \",\")\"])),all_dirty_condition,renderer.reference('$$scope'),slot_definition,renderer.reference('$$scope'),get_slot_changes_fn);slot_update=b(_templateObject580||(_templateObject580=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\".p && \",\") {\\n\\t\\t\\t\\t\\t@update_slot_base(\",\", \",\", #ctx, \",\", \",\", \",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),slot,condition,slot,slot_definition,renderer.reference('$$scope'),dirty,get_slot_context_fn);}else{slot_update=b(_templateObject581||(_templateObject581=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\".p && \",\") {\\n\\t\\t\\t\\t\\t@update_slot(\",\", \",\", #ctx, \",\", #dirty, \",\", \",\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),slot,condition,slot,slot_definition,renderer.reference('$$scope'),get_slot_changes_fn,get_slot_context_fn);}var fallback_condition=renderer.dirty(fallback_dynamic_dependencies);var fallback_dirty=x(_templateObject582||(_templateObject582=(0,_taggedTemplateLiteral2.default)([\"#dirty\"])));if(block.has_outros){fallback_condition=x(_templateObject583||(_templateObject583=(0,_taggedTemplateLiteral2.default)([\"!#current || \",\"\"])),fallback_condition);fallback_dirty=x(_templateObject584||(_templateObject584=(0,_taggedTemplateLiteral2.default)([\"!#current ? \",\" : \",\"\"])),renderer.get_initial_dirty(),fallback_dirty);}var fallback_update=has_fallback&&fallback_dynamic_dependencies.length>0&&b(_templateObject585||(_templateObject585=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tif (\",\" && \",\".p && \",\") {\\n\\t\\t\\t\\t\",\".p(#ctx, \",\");\\n\\t\\t\\t}\\n\\t\\t\"])),slot_or_fallback,slot_or_fallback,fallback_condition,slot_or_fallback,fallback_dirty);if(fallback_update){block.chunks.update.push(b(_templateObject586||(_templateObject586=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),slot,slot_update,fallback_update));}else{block.chunks.update.push(b(_templateObject587||(_templateObject587=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),slot,slot_update));}block.chunks.destroy.push(b(_templateObject588||(_templateObject588=(0,_taggedTemplateLiteral2.default)([\"if (\",\") \",\".d(detaching);\"])),slot_or_fallback,slot_or_fallback));}},{key:\"is_dependency_dynamic\",value:function is_dependency_dynamic(name){if(name==='$$scope')return true;if(this.node.scope.is_let(name))return true;if(is_reserved_keyword(name))return true;var variable=this.renderer.component.var_lookup.get(name);return is_dynamic(variable);}}]);return SlotWrapper;}(Wrapper);var TitleWrapper=/*#__PURE__*/function(_Wrapper17){(0,_inherits2.default)(TitleWrapper,_Wrapper17);var _super58=_createSuper(TitleWrapper);function TitleWrapper(renderer,block,parent,node,_strip_whitespace,_next_sibling){(0,_classCallCheck2.default)(this,TitleWrapper);return _super58.call(this,renderer,block,parent,node);}(0,_createClass2.default)(TitleWrapper,[{key:\"render\",value:function render(block,_parent_node,_parent_nodes){var is_dynamic=!!this.node.children.find(function(node){return node.type!=='Text';});if(is_dynamic){var _value12;var all_dependencies=new Set();// TODO some of this code is repeated in Tag.ts — would be good to\n// DRY it out if that's possible without introducing crazy indirection\nif(this.node.children.length===1){// single {tag} — may be a non-string\n// @ts-ignore todo: check this\nvar _expression13=this.node.children[0].expression;_value12=_expression13.manipulate(block);add_to_set(all_dependencies,_expression13.dependencies);}else{// '{foo} {bar}' — treat as string concatenation\n_value12=this.node.children.map(function(chunk){if(chunk.type==='Text')return string_literal(chunk.data);chunk.expression.dependencies.forEach(function(d){all_dependencies.add(d);});return chunk.expression.manipulate(block);}).reduce(function(lhs,rhs){return x(_templateObject589||(_templateObject589=(0,_taggedTemplateLiteral2.default)([\"\",\" + \",\"\"])),lhs,rhs);});if(this.node.children[0].type!=='Text'){_value12=x(_templateObject590||(_templateObject590=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\" + \",\"\"])),_value12);}}var last=this.node.should_cache&&block.get_unique_name('title_value');if(this.node.should_cache)block.add_variable(last);var init=this.node.should_cache?x(_templateObject591||(_templateObject591=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\"\"])),last,_value12):_value12;block.chunks.init.push(b(_templateObject592||(_templateObject592=(0,_taggedTemplateLiteral2.default)([\"@_document.title = \",\";\"])),init));var updater=b(_templateObject593||(_templateObject593=(0,_taggedTemplateLiteral2.default)([\"@_document.title = \",\";\"])),this.node.should_cache?last:_value12);if(all_dependencies.size){var dependencies=Array.from(all_dependencies);var condition=block.renderer.dirty(dependencies);if(block.has_outros){condition=x(_templateObject594||(_templateObject594=(0,_taggedTemplateLiteral2.default)([\"!#current || \",\"\"])),condition);}if(this.node.should_cache){condition=x(_templateObject595||(_templateObject595=(0,_taggedTemplateLiteral2.default)([\"\",\" && (\",\" !== (\",\" = \",\"))\"])),condition,last,last,_value12);}block.chunks.update.push(b(_templateObject596||(_templateObject596=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\"])),condition,updater));}}else{var _value13=this.node.children.length>0?string_literal(this.node.children[0].data):x(_templateObject597||(_templateObject597=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\"\"])));block.chunks.hydrate.push(b(_templateObject598||(_templateObject598=(0,_taggedTemplateLiteral2.default)([\"@_document.title = \",\";\"])),_value13));}}}]);return TitleWrapper;}(Wrapper);var associated_events={innerWidth:'resize',innerHeight:'resize',outerWidth:'resize',outerHeight:'resize',scrollX:'scroll',scrollY:'scroll'};var properties$1={scrollX:'pageXOffset',scrollY:'pageYOffset'};var readonly=new Set(['innerWidth','innerHeight','outerWidth','outerHeight','online']);var WindowWrapper=/*#__PURE__*/function(_Wrapper18){(0,_inherits2.default)(WindowWrapper,_Wrapper18);var _super59=_createSuper(WindowWrapper);function WindowWrapper(renderer,block,parent,node){var _this78;(0,_classCallCheck2.default)(this,WindowWrapper);_this78=_super59.call(this,renderer,block,parent,node);_this78.handlers=_this78.node.handlers.map(function(handler){return new EventHandlerWrapper(handler,(0,_assertThisInitialized2.default)(_this78));});return _this78;}(0,_createClass2.default)(WindowWrapper,[{key:\"render\",value:function render(block,_parent_node,_parent_nodes){var renderer=this.renderer;var component=renderer.component;var events={};var bindings={};add_actions(block,'@_window',this.node.actions);add_event_handlers(block,'@_window',this.handlers);this.node.bindings.forEach(function(binding){// TODO: what if it's a MemberExpression?\nvar binding_name=binding.expression.node.name;// in dev mode, throw if read-only values are written to\nif(readonly.has(binding.name)){renderer.readonly.add(binding_name);}bindings[binding.name]=binding_name;// bind:online is a special case, we need to listen for two separate events\nif(binding.name==='online')return;var associated_event=associated_events[binding.name];var property=properties$1[binding.name]||binding.name;if(!events[associated_event])events[associated_event]=[];events[associated_event].push({name:binding_name,value:property});});var scrolling=block.get_unique_name('scrolling');var clear_scrolling=block.get_unique_name('clear_scrolling');var scrolling_timeout=block.get_unique_name('scrolling_timeout');Object.keys(events).forEach(function(event){var id=block.get_unique_name(\"onwindow\".concat(event));var props=events[event];renderer.add_to_context(id.name);var fn=renderer.reference(id.name);if(event==='scroll'){// TODO other bidirectional bindings...\nblock.add_variable(scrolling,x(_templateObject599||(_templateObject599=(0,_taggedTemplateLiteral2.default)([\"false\"]))));block.add_variable(clear_scrolling,x(_templateObject600||(_templateObject600=(0,_taggedTemplateLiteral2.default)([\"() => { \",\" = false }\"])),scrolling));block.add_variable(scrolling_timeout);var condition=bindings.scrollX&&bindings.scrollY?x(_templateObject601||(_templateObject601=(0,_taggedTemplateLiteral2.default)([\"\\\"\",\"\\\" in this._state || \\\"\",\"\\\" in this._state\"])),bindings.scrollX,bindings.scrollY):x(_templateObject602||(_templateObject602=(0,_taggedTemplateLiteral2.default)([\"\\\"\",\"\\\" in this._state\"])),bindings.scrollX||bindings.scrollY);var scrollX=bindings.scrollX&&x(_templateObject603||(_templateObject603=(0,_taggedTemplateLiteral2.default)([\"this._state.\",\"\"])),bindings.scrollX);var scrollY=bindings.scrollY&&x(_templateObject604||(_templateObject604=(0,_taggedTemplateLiteral2.default)([\"this._state.\",\"\"])),bindings.scrollY);renderer.meta_bindings.push(b(_templateObject605||(_templateObject605=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\tif (\",\") {\\n\\t\\t\\t\\t\\t\\t@_scrollTo(\",\", \",\");\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\"])),condition,scrollX||'@_window.pageXOffset',scrollY||'@_window.pageYOffset',scrollX&&\"\".concat(scrollX,\" = @_window.pageXOffset;\"),scrollY&&\"\".concat(scrollY,\" = @_window.pageYOffset;\")));block.event_listeners.push(x(_templateObject606||(_templateObject606=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t@listen(@_window, \\\"\",\"\\\", () => {\\n\\t\\t\\t\\t\\t\\t\",\" = true;\\n\\t\\t\\t\\t\\t\\t@_clearTimeout(\",\");\\n\\t\\t\\t\\t\\t\\t\",\" = @_setTimeout(\",\", 100);\\n\\t\\t\\t\\t\\t\\t\",\"();\\n\\t\\t\\t\\t\\t})\\n\\t\\t\\t\\t\"])),event,scrolling,scrolling_timeout,scrolling_timeout,clear_scrolling,fn));}else{props.forEach(function(prop){renderer.meta_bindings.push(b(_templateObject607||(_templateObject607=(0,_taggedTemplateLiteral2.default)([\"this._state.\",\" = @_window.\",\";\"])),prop.name,prop.value));});block.event_listeners.push(x(_templateObject608||(_templateObject608=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t@listen(@_window, \\\"\",\"\\\", \",\")\\n\\t\\t\\t\\t\"])),event,fn));}component.partly_hoisted.push(b(_templateObject609||(_templateObject609=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfunction \",\"() {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),id,props.map(function(prop){return renderer.invalidate(prop.name,x(_templateObject610||(_templateObject610=(0,_taggedTemplateLiteral2.default)([\"\",\" = @_window.\",\"\"])),prop.name,prop.value));})));block.chunks.init.push(b(_templateObject611||(_templateObject611=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t@add_render_callback(\",\");\\n\\t\\t\\t\"])),fn));component.has_reactive_assignments=true;});// special case... might need to abstract this out if we add more special cases\nif(bindings.scrollX||bindings.scrollY){var condition=renderer.dirty([bindings.scrollX,bindings.scrollY].filter(Boolean));var scrollX=bindings.scrollX?renderer.reference(bindings.scrollX):x(_templateObject612||(_templateObject612=(0,_taggedTemplateLiteral2.default)([\"@_window.pageXOffset\"])));var scrollY=bindings.scrollY?renderer.reference(bindings.scrollY):x(_templateObject613||(_templateObject613=(0,_taggedTemplateLiteral2.default)([\"@_window.pageYOffset\"])));block.chunks.update.push(b(_templateObject614||(_templateObject614=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\" && !\",\") {\\n\\t\\t\\t\\t\\t\",\" = true;\\n\\t\\t\\t\\t\\t@_clearTimeout(\",\");\\n\\t\\t\\t\\t\\t@_scrollTo(\",\", \",\");\\n\\t\\t\\t\\t\\t\",\" = @_setTimeout(\",\", 100);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),condition,scrolling,scrolling,scrolling_timeout,scrollX,scrollY,scrolling_timeout,clear_scrolling));}// another special case. (I'm starting to think these are all special cases.)\nif(bindings.online){var _id3=block.get_unique_name('onlinestatuschanged');var name=bindings.online;renderer.add_to_context(_id3.name);var reference=renderer.reference(_id3.name);component.partly_hoisted.push(b(_templateObject615||(_templateObject615=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tfunction \",\"() {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),_id3,renderer.invalidate(name,x(_templateObject616||(_templateObject616=(0,_taggedTemplateLiteral2.default)([\"\",\" = @_navigator.onLine\"])),name))));block.chunks.init.push(b(_templateObject617||(_templateObject617=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t@add_render_callback(\",\");\\n\\t\\t\\t\"])),reference));block.event_listeners.push(x(_templateObject618||(_templateObject618=(0,_taggedTemplateLiteral2.default)([\"@listen(@_window, \\\"online\\\", \",\")\"])),reference),x(_templateObject619||(_templateObject619=(0,_taggedTemplateLiteral2.default)([\"@listen(@_window, \\\"offline\\\", \",\")\"])),reference));component.has_reactive_assignments=true;}}}]);return WindowWrapper;}(Wrapper);function link(next,prev){prev.next=next;if(next)next.prev=prev;}var wrappers={AwaitBlock:AwaitBlockWrapper,Body:BodyWrapper,Comment:null,DebugTag:DebugTagWrapper,EachBlock:EachBlockWrapper,Element:ElementWrapper,Head:HeadWrapper,IfBlock:IfBlockWrapper,InlineComponent:InlineComponentWrapper,KeyBlock:KeyBlockWrapper,MustacheTag:MustacheTagWrapper,Options:null,RawMustacheTag:RawMustacheTagWrapper,Slot:SlotWrapper,SlotTemplate:SlotTemplateWrapper,Text:TextWrapper,Title:TitleWrapper,Window:WindowWrapper};function trimmable_at(child,next_sibling){// Whitespace is trimmable if one of the following is true:\n// The child and its sibling share a common nearest each block (not at an each block boundary)\n// The next sibling's previous node is an each block\nreturn next_sibling.node.find_nearest(/EachBlock/)===child.find_nearest(/EachBlock/)||next_sibling.node.prev.type==='EachBlock';}var FragmentWrapper=/*#__PURE__*/function(){function FragmentWrapper(renderer,block,nodes,parent,strip_whitespace,next_sibling){(0,_classCallCheck2.default)(this,FragmentWrapper);this.nodes=[];var last_child;var window_wrapper;var i=nodes.length;while(i--){var child=nodes[i];if(!child.type){throw new Error('missing type');}if(!(child.type in wrappers)){throw new Error(\"TODO implement \".concat(child.type));}// special case — this is an easy way to remove whitespace surrounding\n// <svelte:window/>. lil hacky but it works\nif(child.type==='Window'){window_wrapper=new WindowWrapper(renderer,block,parent,child);continue;}if(child.type==='Text'){var _data4=child.data;// We want to remove trailing whitespace inside an element/component/block,\n// *unless* there is no whitespace between this node and its next sibling\nif(this.nodes.length===0){var should_trim=next_sibling?next_sibling.node.type==='Text'&&/^\\s/.test(next_sibling.node.data)&&trimmable_at(child,next_sibling):!child.has_ancestor('EachBlock');if(should_trim){_data4=trim_end(_data4);if(!_data4)continue;}}// glue text nodes (which could e.g. be separated by comments) together\nif(last_child&&last_child.node.type==='Text'){last_child.data=_data4+last_child.data;continue;}var wrapper=new TextWrapper(renderer,block,parent,child,_data4);if(wrapper.skip)continue;this.nodes.unshift(wrapper);link(last_child,last_child=wrapper);}else{var _Wrapper19=wrappers[child.type];if(!_Wrapper19)continue;var _wrapper2=new _Wrapper19(renderer,block,parent,child,strip_whitespace,last_child||next_sibling);this.nodes.unshift(_wrapper2);link(last_child,last_child=_wrapper2);}}if(strip_whitespace){var first=this.nodes[0];if(first&&first.node.type==='Text'){first.data=trim_start(first.data);if(!first.data){first.var=null;this.nodes.shift();if(this.nodes[0]){this.nodes[0].prev=null;}}}}if(window_wrapper){this.nodes.unshift(window_wrapper);link(last_child,window_wrapper);}}(0,_createClass2.default)(FragmentWrapper,[{key:\"render\",value:function render(block,parent_node,parent_nodes){for(var _i39=0;_i39<this.nodes.length;_i39+=1){this.nodes[_i39].render(block,parent_node,parent_nodes);}}}]);return FragmentWrapper;}();var Renderer=/*#__PURE__*/function(){function Renderer(component,options){var _this79=this;(0,_classCallCheck2.default)(this,Renderer);this.context=[];this.initial_context=[];this.context_lookup=new Map();this.blocks=[];this.readonly=new Set();this.meta_bindings=[];// initial values for e.g. window.innerWidth, if there's a <svelte:window> meta tag\nthis.binding_groups=new Map();this.component=component;this.options=options;this.locate=component.locate;// TODO messy\nthis.file_var=options.dev&&this.component.get_unique_name('file');component.vars.filter(function(v){return!v.hoistable||v.export_name&&!v.module;}).forEach(function(v){return _this79.add_to_context(v.name);});// ensure store values are included in context\ncomponent.vars.filter(function(v){return v.subscribable;}).forEach(function(v){return _this79.add_to_context(\"$\".concat(v.name));});reserved_keywords.forEach(function(keyword){if(component.var_lookup.has(keyword)){_this79.add_to_context(keyword);}});if(component.slots.size>0){this.add_to_context('$$scope');this.add_to_context('#slots');}if(this.binding_groups.size>0){this.add_to_context('$$binding_groups');}// main block\nthis.block=new Block$1({renderer:this,name:null,type:'component',key:null,bindings:new Map(),dependencies:new Set()});this.block.has_update_method=true;this.fragment=new FragmentWrapper(this,this.block,component.fragment.children,null,true,null);// TODO messy\nthis.blocks.forEach(function(block){if(block instanceof Block$1){block.assign_variable_names();}});this.block.assign_variable_names();this.fragment.render(this.block,null,x(_templateObject620||(_templateObject620=(0,_taggedTemplateLiteral2.default)([\"#nodes\"]))));this.context_overflow=this.context.length>31;this.context.forEach(function(member){var variable=member.variable;if(variable){member.priority+=2;if(variable.mutated||variable.reassigned)member.priority+=4;// these determine whether variable is included in initial context\n// array, so must have the highest priority\nif(variable.is_reactive_dependency&&(variable.mutated||variable.reassigned))member.priority+=16;if(variable.export_name)member.priority+=32;if(variable.referenced)member.priority+=64;}else if(member.is_non_contextual){// determine whether variable is included in initial context\n// array, so must have the highest priority\nmember.priority+=8;}if(!member.is_contextual){member.priority+=1;}});this.context.sort(function(a,b){return b.priority-a.priority||a.index.value-b.index.value;});this.context.forEach(function(member,i){return member.index.value=i;});var i=this.context.length;while(i--){var member=this.context[i];if(member.variable){if(member.variable.referenced||member.variable.export_name||member.variable.is_reactive_dependency&&(member.variable.mutated||member.variable.reassigned))break;}else if(member.is_non_contextual){break;}}this.initial_context=this.context.slice(0,i+1);}(0,_createClass2.default)(Renderer,[{key:\"add_to_context\",value:function add_to_context(name){var contextual=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!this.context_lookup.has(name)){var _member2={name:name,index:{type:'Literal',value:this.context.length},is_contextual:false,is_non_contextual:false,variable:null,priority:0};this.context_lookup.set(name,_member2);this.context.push(_member2);}var member=this.context_lookup.get(name);if(contextual){member.is_contextual=true;}else{member.is_non_contextual=true;member.variable=this.component.var_lookup.get(name);}return member;}},{key:\"invalidate\",value:function invalidate(name,value){var main_execution_context=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return renderer_invalidate(this,name,value,main_execution_context);}},{key:\"dirty\",value:function dirty(names){var is_reactive_declaration=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var renderer=this;var dirty=is_reactive_declaration?x(_templateObject621||(_templateObject621=(0,_taggedTemplateLiteral2.default)([\"$$self.$$.dirty\"]))):x(_templateObject622||(_templateObject622=(0,_taggedTemplateLiteral2.default)([\"#dirty\"])));var get_bitmask=function get_bitmask(){var bitmask=[];names.forEach(function(name){var member=renderer.context_lookup.get(name);if(!member)return;if(member.index.value===-1){throw new Error('unset index');}var value=member.index.value;var i=value/31|0;var n=1<<value%31;if(!bitmask[i])bitmask[i]={n:0,names:[]};bitmask[i].n|=n;bitmask[i].names.push(name);});return bitmask;};// TODO: context-overflow make it less gross\nreturn{// Using a ParenthesizedExpression allows us to create\n// the expression lazily. TODO would be better if\n// context was determined before rendering, so that\n// this indirection was unnecessary\ntype:'ParenthesizedExpression',get expression(){var bitmask=get_bitmask();if(!bitmask.length){return x(_templateObject623||(_templateObject623=(0,_taggedTemplateLiteral2.default)([\"\",\" & /*\",\"*/ 0\"])),dirty,names.join(', '));}if(renderer.context_overflow){return bitmask.map(function(b,i){return{b:b,i:i};}).filter(function(_ref20){var b=_ref20.b;return b;}).map(function(_ref21){var b=_ref21.b,i=_ref21.i;return x(_templateObject624||(_templateObject624=(0,_taggedTemplateLiteral2.default)([\"\",\"[\",\"] & /*\",\"*/ \",\"\"])),dirty,i,b.names.join(', '),b.n);}).reduce(function(lhs,rhs){return x(_templateObject625||(_templateObject625=(0,_taggedTemplateLiteral2.default)([\"\",\" | \",\"\"])),lhs,rhs);});}return x(_templateObject626||(_templateObject626=(0,_taggedTemplateLiteral2.default)([\"\",\" & /*\",\"*/ \",\"\"])),dirty,names.join(', '),bitmask[0].n);}};}// NOTE: this method may be called before this.context_overflow / this.context is fully defined\n// therefore, they can only be evaluated later in a getter function\n},{key:\"get_initial_dirty\",value:function get_initial_dirty(){var _this=this;// TODO: context-overflow make it less gross\nvar val=x(_templateObject627||(_templateObject627=(0,_taggedTemplateLiteral2.default)([\"-1\"])));return{get type(){return _this.context_overflow?'ArrayExpression':'UnaryExpression';},// as [-1]\nget elements(){var elements=[];for(var _i40=0;_i40<_this.context.length;_i40+=31){elements.push(val);}return elements;},// as -1\noperator:val.operator,prefix:val.prefix,argument:val.argument};}},{key:\"reference\",value:function reference(node){var ctx=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'#ctx';if(typeof node==='string'){node={type:'Identifier',name:node};}var _flatten_reference6=flatten_reference(node),name=_flatten_reference6.name,nodes=_flatten_reference6.nodes;var member=this.context_lookup.get(name);// TODO is this correct?\nif(this.component.var_lookup.get(name)){this.component.add_reference(name);}if(member!==undefined){var replacement=x(_templateObject628||(_templateObject628=(0,_taggedTemplateLiteral2.default)([\"/*\",\"*/ \",\"[\",\"]\"])),member.name,ctx,member.index);if(nodes[0].loc)replacement.object.loc=nodes[0].loc;nodes[0]=replacement;return nodes.reduce(function(lhs,rhs){return x(_templateObject629||(_templateObject629=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\"\"])),lhs,rhs);});}return node;}},{key:\"remove_block\",value:function remove_block(block){this.blocks.splice(this.blocks.indexOf(block),1);}}]);return Renderer;}();var charToInteger$1={};var chars$1='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';for(var i$2=0;i$2<chars$1.length;i$2++){charToInteger$1[chars$1.charCodeAt(i$2)]=i$2;}function decode$1(mappings){var decoded=[];var line=[];var segment=[0,0,0,0,0];var j=0;for(var i=0,shift=0,value=0;i<mappings.length;i++){var c=mappings.charCodeAt(i);if(c===44){// \",\"\nsegmentify$1(line,segment,j);j=0;}else if(c===59){// \";\"\nsegmentify$1(line,segment,j);j=0;decoded.push(line);line=[];segment[0]=0;}else{var integer=charToInteger$1[c];if(integer===undefined){throw new Error('Invalid character ('+String.fromCharCode(c)+')');}var hasContinuationBit=integer&32;integer&=31;value+=integer<<shift;if(hasContinuationBit){shift+=5;}else{var shouldNegate=value&1;value>>>=1;if(shouldNegate){value=value===0?-0x80000000:-value;}segment[j]+=value;j++;value=shift=0;// reset\n}}}segmentify$1(line,segment,j);decoded.push(line);return decoded;}function segmentify$1(line,segment,j){// This looks ugly, but we're creating specialized arrays with a specific\n// length. This is much faster than creating a new array (which v8 expands to\n// a capacity of 17 after pushing the first item), or slicing out a subarray\n// (which is slow). Length 4 is assumed to be the most frequent, followed by\n// length 5 (since not everything will have an associated name), followed by\n// length 1 (it's probably rare for a source substring to not have an\n// associated segment data).\nif(j===4)line.push([segment[0],segment[1],segment[2],segment[3]]);else if(j===5)line.push([segment[0],segment[1],segment[2],segment[3],segment[4]]);else if(j===1)line.push([segment[0]]);}function encode$1(decoded){var sourceFileIndex=0;// second field\nvar sourceCodeLine=0;// third field\nvar sourceCodeColumn=0;// fourth field\nvar nameIndex=0;// fifth field\nvar mappings='';for(var i=0;i<decoded.length;i++){var line=decoded[i];if(i>0)mappings+=';';if(line.length===0)continue;var generatedCodeColumn=0;// first field\nvar lineMappings=[];for(var _i=0,line_1=line;_i<line_1.length;_i++){var segment=line_1[_i];var segmentMappings=encodeInteger$1(segment[0]-generatedCodeColumn);generatedCodeColumn=segment[0];if(segment.length>1){segmentMappings+=encodeInteger$1(segment[1]-sourceFileIndex)+encodeInteger$1(segment[2]-sourceCodeLine)+encodeInteger$1(segment[3]-sourceCodeColumn);sourceFileIndex=segment[1];sourceCodeLine=segment[2];sourceCodeColumn=segment[3];}if(segment.length===5){segmentMappings+=encodeInteger$1(segment[4]-nameIndex);nameIndex=segment[4];}lineMappings.push(segmentMappings);}mappings+=lineMappings.join(',');}return mappings;}function encodeInteger$1(num){var result='';num=num<0?-num<<1|1:num<<1;do{var clamped=num&31;num>>>=5;if(num>0){clamped|=32;}result+=chars$1[clamped];}while(num>0);return result;}/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ /**\n * Creates a brand new (prototype-less) object with the enumerable-own\n * properties of `target`. Any enumerable-own properties from `source` which\n * are not present on `target` will be copied as well.\n */function defaults(target,source){return Object.assign(Object.create(null),source,target);}/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ /**\n * Decodes an input sourcemap into a `DecodedSourceMap` sourcemap object.\n *\n * Valid input maps include a `DecodedSourceMap`, a `RawSourceMap`, or JSON\n * representations of either type.\n */function decodeSourceMap(map){if(typeof map==='string'){map=JSON.parse(map);}var _map=map,mappings=_map.mappings;if(typeof mappings==='string'){mappings=decode$1(mappings);}else{// Clone the Line so that we can sort it. We don't want to mutate an array\n// that we don't own directly.\nmappings=mappings.map(cloneSegmentLine);}// Sort each Line's segments. There's no guarantee that segments are sorted for us,\n// and even Chrome's implementation sorts:\n// https://cs.chromium.org/chromium/src/third_party/devtools-frontend/src/front_end/sdk/SourceMap.js?l=507-508&rcl=109232bcf479c8f4ef8ead3cf56c49eb25f8c2f0\nmappings.forEach(sortSegments);return defaults({mappings:mappings},map);}function cloneSegmentLine(segments){return segments.slice();}function sortSegments(segments){segments.sort(segmentComparator);}function segmentComparator(a,b){return a[0]-b[0];}/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ /**\n * A \"leaf\" node in the sourcemap tree, representing an original, unmodified\n * source file. Recursive segment tracing ends at the `OriginalSource`.\n */var OriginalSource=/*#__PURE__*/function(){function OriginalSource(filename,content){(0,_classCallCheck2.default)(this,OriginalSource);this.filename=filename;this.content=content;}/**\n     * Tracing a `SourceMapSegment` ends when we get to an `OriginalSource`,\n     * meaning this line/column location originated from this source file.\n     */(0,_createClass2.default)(OriginalSource,[{key:\"traceSegment\",value:function traceSegment(line,column,name){return{column:column,line:line,name:name,source:this};}}]);return OriginalSource;}();/* istanbul ignore next */var Url$1=typeof URL!=='undefined'?URL:__webpack_require__(/*! url */ \"./node_modules/url/url.js\").URL;// Matches \"..\", which must be preceeded by \"/\" or the start of the string, and\n// must be followed by a \"/\". We do not eat the following \"/\", so that the next\n// iteration can match on it.\nvar parentRegex=/(^|\\/)\\.\\.(?=\\/|$)/g;function isAbsoluteUrl(url){try{return!!new Url$1(url);}catch(e){return false;}}/**\n * Creates a directory name that is guaranteed to not be in `str`.\n */function uniqInStr(str){var uniq=String(Math.random()).slice(2);while(str.indexOf(uniq)>-1){/* istanbul ignore next */uniq+=uniq;}return uniq;}/**\n * Removes the filename from the path (everything trailing the last \"/\"). This\n * is only safe to call on a path, never call with an absolute or protocol\n * relative URL.\n */function stripPathFilename(path){path=normalizePath(path);var index=path.lastIndexOf('/');return path.slice(0,index+1);}/**\n * Normalizes a protocol-relative URL, but keeps it protocol relative by\n * stripping out the protocl before returning it.\n */function normalizeProtocolRelative(input,absoluteBase){var _Url$=new Url$1(input,absoluteBase),href=_Url$.href,protocol=_Url$.protocol;return href.slice(protocol.length);}/**\n * Normalizes a simple path (one that has no \"..\"s, or is absolute so \"..\"s can\n * be normalized absolutely).\n */function normalizeSimplePath(input){var _Url$2=new Url$1(input,'https://foo.com/'),href=_Url$2.href;return href.slice('https://foo.com/'.length);}/**\n * Normalizes a path, ensuring that excess \"..\"s are preserved for relative\n * paths in the output.\n *\n * If the input is absolute, this will return an absolutey normalized path, but\n * it will not have a leading \"/\".\n *\n * If the input has a leading \"..\", the output will have a leading \"..\".\n *\n * If the input has a leading \".\", the output will not have a leading \".\"\n * unless there are too many \"..\"s, in which case there will be a leading \"..\".\n */function normalizePath(input){// If there are no \"..\"s, we can treat this as if it were an absolute path.\n// The return won't be an absolute path, so it's easy.\nif(!parentRegex.test(input))return normalizeSimplePath(input);// We already found one \"..\". Let's see how many there are.\nvar total=1;while(parentRegex.test(input)){total++;}// If there are \"..\"s, we need to prefix the the path with the same number of\n// unique directories. This is to ensure that we \"remember\" how many parent\n// directories we are accessing. Eg, \"../../..\" must keep 3, and \"foo/../..\"\n// must keep 1.\nvar uniqDirectory=\"z\".concat(uniqInStr(input),\"/\");// uniqDirectory is just a \"z\", followed by numbers, followed by a \"/\". So\n// generating a runtime regex from it is safe. We'll use this search regex to\n// strip out our uniq directory names and insert any needed \"..\"s.\nvar search=new RegExp(\"^(?:\".concat(uniqDirectory,\")*\"));// Now we can resolve the total path. If there are excess \"..\"s, they will\n// eliminate one or more of the unique directories we prefix with.\nvar relative=normalizeSimplePath(uniqDirectory.repeat(total)+input);// We can now count the number of unique directories that were eliminated. If\n// there were 3, and 1 was eliminated, we know we only need to add 1 \"..\". If\n// 2 were eliminated, we need to insert 2 \"..\"s. If all 3 were eliminated,\n// then we need 3, etc. This replace is guranteed to match (it may match 0 or\n// more times), and we can count the total match to see how many were eliminated.\nreturn relative.replace(search,function(all){var leftover=all.length/uniqDirectory.length;return'../'.repeat(total-leftover);});}/**\n * Attempts to resolve `input` URL relative to `base`.\n */function resolve(input,base){if(!base)base='';// Absolute URLs are very easy to resolve right.\nif(isAbsoluteUrl(input))return new Url$1(input).href;if(base){// Absolute URLs are easy...\nif(isAbsoluteUrl(base))return new Url$1(input,base).href;// If base is protocol relative, we'll resolve with it but keep the result\n// protocol relative.\nif(base.startsWith('//'))return normalizeProtocolRelative(input,\"https:\".concat(base));}// Normalize input, but keep it protocol relative. We know base doesn't supply\n// a protocol, because that would have been handled above.\nif(input.startsWith('//'))return normalizeProtocolRelative(input,'https://foo.com/');// We now know that base (if there is one) and input are paths. We've handled\n// both absolute and protocol-relative variations above.\n// Absolute paths don't need any special handling, because they cannot have\n// extra \".\" or \"..\"s. That'll all be stripped away. Input takes priority here,\n// because if input is an absolute path, base path won't affect it in any way.\nif(input.startsWith('/'))return'/'+normalizeSimplePath(input);// Since input and base are paths, we need to join them to do any further\n// processing. Paths are joined at the directory level, so we need to remove\n// the base's filename before joining. We also know that input does not have a\n// leading slash, and that the stripped base will have a trailing slash if\n// there are any directories (or it'll be empty).\nvar joined=stripPathFilename(base)+input;// If base is an absolute path, then input will be relative to it.\nif(base.startsWith('/'))return'/'+normalizeSimplePath(joined);// We now know both base (if there is one) and input are relative paths.\nvar relative=normalizePath(joined);// If base started with a leading \".\", or there is no base and input started\n// with a \".\", then we need to ensure that the relative path starts with a\n// \".\". We don't know if relative starts with a \"..\", though, so check before\n// prepending.\nif((base||input).startsWith('.')&&!relative.startsWith('.')){return'./'+relative;}return relative;}/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function resolve$1(input,base){// The base is always treated as a directory, if it's not empty.\n// https://github.com/mozilla/source-map/blob/8cb3ee57/lib/util.js#L327\n// https://github.com/chromium/chromium/blob/da4adbb3/third_party/blink/renderer/devtools/front_end/sdk/SourceMap.js#L400-L401\nif(base&&!base.endsWith('/'))base+='/';return resolve(input,base);}/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ /**\n * A binary search implementation that returns the index if a match is found,\n * or the negated index of where the `needle` should be inserted.\n *\n * The `comparator` callback receives both the `item` under comparison and the\n * needle we are searching for. It must return `0` if the `item` is a match,\n * any negative number if `item` is too small (and we must search after it), or\n * any positive number if the `item` is too large (and we must search before\n * it).\n *\n * If no match is found, a negated index of where to insert the `needle` is\n * returned. This negated index is guaranteed to be less than 0. To insert an\n * item, negate it (again) and splice:\n *\n * ```js\n * const array = [1, 3];\n * const needle = 2;\n * const index = binarySearch(array, needle, (item, needle) => item - needle);\n *\n * assert.equal(index, -2);\n * assert.equal(~index, 1);\n * array.splice(~index, 0, needle);\n * assert.deepEqual(array, [1, 2, 3]);\n * ```\n */function binarySearch(haystack,needle,comparator){var low=0;var high=haystack.length-1;while(low<=high){var mid=low+(high-low>>1);var cmp=comparator(haystack[mid],needle);if(cmp===0){return mid;}if(cmp<0){low=mid+1;}else{high=mid-1;}}return~low;}/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ /**\n * FastStringArray acts like a `Set` (allowing only one occurrence of a string\n * `key`), but provides the index of the `key` in the backing array.\n *\n * This is designed to allow synchronizing a second array with the contents of\n * the backing array, like how `sourcesContent[i]` is the source content\n * associated with `source[i]`, and there are never duplicates.\n */var FastStringArray=/*#__PURE__*/function(){function FastStringArray(){(0,_classCallCheck2.default)(this,FastStringArray);this.indexes=Object.create(null);this.array=[];}/**\n     * Puts `key` into the backing array, if it is not already present. Returns\n     * the index of the `key` in the backing array.\n     */(0,_createClass2.default)(FastStringArray,[{key:\"put\",value:function put(key){var array=this.array,indexes=this.indexes;// The key may or may not be present. If it is present, it's a number.\nvar index=indexes[key];// If it's not yet present, we need to insert it and track the index in the\n// indexes.\nif(index===undefined){index=indexes[key]=array.length;array.push(key);}return index;}}]);return FastStringArray;}();/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ /**\n * SourceMapTree represents a single sourcemap, with the ability to trace\n * mappings into its child nodes (which may themselves be SourceMapTrees).\n */var SourceMapTree=/*#__PURE__*/function(){function SourceMapTree(map,sources){(0,_classCallCheck2.default)(this,SourceMapTree);this.map=map;this.sources=sources;}/**\n     * traceMappings is only called on the root level SourceMapTree, and begins\n     * the process of resolving each mapping in terms of the original source\n     * files.\n     */(0,_createClass2.default)(SourceMapTree,[{key:\"traceMappings\",value:function traceMappings(){var mappings=[];var names=new FastStringArray();var sources=new FastStringArray();var sourcesContent=[];var _this$map=this.map,rootMappings=_this$map.mappings,rootNames=_this$map.names;for(var _i41=0;_i41<rootMappings.length;_i41++){var segments=rootMappings[_i41];var tracedSegments=[];for(var j=0;j<segments.length;j++){var segment=segments[j];// 1-length segments only move the current generated column, there's no\n// source information to gather from it.\nif(segment.length===1)continue;var source=this.sources[segment[1]];var traced=source.traceSegment(segment[2],segment[3],segment.length===5?rootNames[segment[4]]:'');if(!traced)continue;// So we traced a segment down into its original source file. Now push a\n// new segment pointing to this location.\nvar column=traced.column,line=traced.line,name=traced.name;var _traced$source=traced.source,content=_traced$source.content,filename=_traced$source.filename;// Store the source location, and ensure we keep sourcesContent up to\n// date with the sources array.\nvar sourceIndex=sources.put(filename);sourcesContent[sourceIndex]=content;// This looks like unnecessary duplication, but it noticeably increases\n// performance. If we were to push the nameIndex onto length-4 array, v8\n// would internally allocate 22 slots! That's 68 wasted bytes! Array\n// literals have the same capacity as their length, saving memory.\nif(name){tracedSegments.push([segment[0],sourceIndex,line,column,names.put(name)]);}else{tracedSegments.push([segment[0],sourceIndex,line,column]);}}mappings.push(tracedSegments);}// TODO: Make all sources relative to the sourceRoot.\nreturn defaults({mappings:mappings,names:names.array,sources:sources.array,sourcesContent:sourcesContent},this.map);}/**\n     * traceSegment is only called on children SourceMapTrees. It recurses down\n     * into its own child SourceMapTrees, until we find the original source map.\n     */},{key:\"traceSegment\",value:function traceSegment(line,column,name){var _this$map2=this.map,mappings=_this$map2.mappings,names=_this$map2.names;// It's common for parent sourcemaps to have pointers to lines that have no\n// mapping (like a \"//# sourceMappingURL=\") at the end of the child file.\nif(line>=mappings.length)return null;var segments=mappings[line];if(segments.length===0)return null;var index=binarySearch(segments,column,segmentComparator$1);if(index===-1)return null;// we come before any mapped segment\n// If we can't find a segment that lines up to this column, we use the\n// segment before.\nif(index<0){index=~index-1;}var segment=segments[index];// 1-length segments only move the current generated column, there's no\n// source information to gather from it.\nif(segment.length===1)return null;var source=this.sources[segment[1]];// So now we can recurse down, until we hit the original source file.\nreturn source.traceSegment(segment[2],segment[3],// A child map's recorded name for this segment takes precedence over the\n// parent's mapped name. Imagine a mangler changing the name over, etc.\nsegment.length===5?names[segment[4]]:name);}}]);return SourceMapTree;}();function segmentComparator$1(segment,column){return segment[0]-column;}/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ /**\n * Removes the filename from a path.\n */function stripFilename(path){if(!path)return'';var index=path.lastIndexOf('/');return path.slice(0,index+1);}/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function asArray(value){if(Array.isArray(value))return value;return[value];}/**\n * Recursively builds a tree structure out of sourcemap files, with each node\n * being either an `OriginalSource` \"leaf\" or a `SourceMapTree` composed of\n * `OriginalSource`s and `SourceMapTree`s.\n *\n * Every sourcemap is composed of a collection of source files and mappings\n * into locations of those source files. When we generate a `SourceMapTree` for\n * the sourcemap, we attempt to load each source file's own sourcemap. If it\n * does not have an associated sourcemap, it is considered an original,\n * unmodified source file.\n */function buildSourceMapTree(input,loader,relativeRoot){var maps=asArray(input).map(decodeSourceMap);var map=maps.pop();for(var _i42=0;_i42<maps.length;_i42++){if(maps[_i42].sources.length!==1){throw new Error(\"Transformation map \".concat(_i42,\" must have exactly one source file.\\n\")+'Did you specify these with the most recent transformation maps first?');}}var sourceRoot=map.sourceRoot,sources=map.sources,sourcesContent=map.sourcesContent;var children=sources.map(function(sourceFile,i){// Each source file is loaded relative to the sourcemap's own sourceRoot,\n// which is itself relative to the sourcemap's parent.\nvar uri=resolve$1(sourceFile||'',resolve$1(sourceRoot||'',stripFilename(relativeRoot)));// Use the provided loader callback to retrieve the file's sourcemap.\n// TODO: We should eventually support async loading of sourcemap files.\nvar sourceMap=loader(uri);// If there is no sourcemap, then it is an unmodified source file.\nif(!sourceMap){// The source file's actual contents must be included in the sourcemap\n// (done when generating the sourcemap) for it to be included as a\n// sourceContent in the output sourcemap.\nvar sourceContent=sourcesContent?sourcesContent[i]:null;return new OriginalSource(uri,sourceContent);}// Else, it's a real sourcemap, and we need to recurse into it to load its\n// source files.\nreturn buildSourceMapTree(decodeSourceMap(sourceMap),loader,uri);});var tree=new SourceMapTree(map,children);for(var _i43=maps.length-1;_i43>=0;_i43--){tree=new SourceMapTree(maps[_i43],[tree]);}return tree;}/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ /**\n * A SourceMap v3 compatible sourcemap, which only includes fields that were\n * provided to it.\n */var SourceMap=/*#__PURE__*/function(){function SourceMap(map,excludeContent){(0,_classCallCheck2.default)(this,SourceMap);this.version=3;// SourceMap spec says this should be first.\nif('file'in map)this.file=map.file;this.mappings=encode$1(map.mappings);this.names=map.names;// TODO: We first need to make all source URIs relative to the sourceRoot\n// before we can support a sourceRoot.\n// if ('sourceRoot' in map) this.sourceRoot = map.sourceRoot;\nthis.sources=map.sources;if(!excludeContent&&'sourcesContent'in map)this.sourcesContent=map.sourcesContent;}(0,_createClass2.default)(SourceMap,[{key:\"toString\",value:function toString(){return JSON.stringify(this);}}]);return SourceMap;}();/**\n * Copyright 2019 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ /**\n * Traces through all the mappings in the root sourcemap, through the sources\n * (and their sourcemaps), all the way back to the original source location.\n *\n * `loader` will be called every time we encounter a source file. If it returns\n * a sourcemap, we will recurse into that sourcemap to continue the trace. If\n * it returns a falsey value, that source file is treated as an original,\n * unmodified source file.\n *\n * Pass `excludeContent` content to exclude any self-containing source file\n * content from the output sourcemap.\n */function remapping(input,loader,excludeContent){var graph=buildSourceMapTree(input,loader);return new SourceMap(graph.traceMappings(),!!excludeContent);}function last_line_length(s){return s.length-s.lastIndexOf('\\n')-1;}// mutate map in-place\nfunction sourcemap_add_offset(map,offset,source_index){if(map.mappings.length==0)return;for(var line=0;line<map.mappings.length;line++){var segment_list=map.mappings[line];for(var segment=0;segment<segment_list.length;segment++){var seg=segment_list[segment];// shift only segments that belong to component source file\nif(seg[1]===source_index){// also ensures that seg.length >= 4\n// shift column if it points at the first line\nif(seg[2]===0){seg[3]+=offset.column;}// shift line\nseg[2]+=offset.line;}}}}function merge_tables(this_table,other_table){var new_table=this_table.slice();var idx_map=[];other_table=other_table||[];var val_changed=false;var _iterator12=_createForOfIteratorHelper(other_table.entries()),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var _step12$value=(0,_slicedToArray2.default)(_step12.value,2),other_idx=_step12$value[0],other_val=_step12$value[1];var this_idx=this_table.indexOf(other_val);if(this_idx>=0){idx_map[other_idx]=this_idx;}else{var new_idx=new_table.length;new_table[new_idx]=other_val;idx_map[other_idx]=new_idx;val_changed=true;}}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}var idx_changed=val_changed;if(val_changed){if(idx_map.find(function(val,idx){return val!=idx;})===undefined){// idx_map is identity map [0, 1, 2, 3, 4, ....]\nidx_changed=false;}}return[new_table,idx_map,val_changed,idx_changed];}function pushArray(_this,other){// We use push to mutate in place for memory and perf reasons\n// We use the for loop instead of _this.push(...other) to avoid the JS engine's function argument limit (65,535 in JavascriptCore)\nfor(var _i44=0;_i44<other.length;_i44++){_this.push(other[_i44]);}}var MappedCode=/*#__PURE__*/function(){function MappedCode(){var string=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var map=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;(0,_classCallCheck2.default)(this,MappedCode);this.string=string;if(map){this.map=map;}else{this.map={version:3,mappings:[],sources:[],names:[]};}}/**\n     * concat in-place (mutable), return this (chainable)\n     * will also mutate the `other` object\n     */(0,_createClass2.default)(MappedCode,[{key:\"concat\",value:function concat(other){// noop: if one is empty, return the other\nif(other.string=='')return this;if(this.string==''){this.string=other.string;this.map=other.map;return this;}// compute last line length before mutating\nvar column_offset=last_line_length(this.string);this.string+=other.string;var m1=this.map;var m2=other.map;if(m2.mappings.length==0)return this;// combine sources and names\nvar _merge_tables=merge_tables(m1.sources,m2.sources),_merge_tables2=(0,_slicedToArray2.default)(_merge_tables,4),sources=_merge_tables2[0],new_source_idx=_merge_tables2[1],sources_changed=_merge_tables2[2],sources_idx_changed=_merge_tables2[3];var _merge_tables3=merge_tables(m1.names,m2.names),_merge_tables4=(0,_slicedToArray2.default)(_merge_tables3,4),names=_merge_tables4[0],new_name_idx=_merge_tables4[1],names_changed=_merge_tables4[2],names_idx_changed=_merge_tables4[3];if(sources_changed)m1.sources=sources;if(names_changed)m1.names=names;// unswitched loops are faster\nif(sources_idx_changed&&names_idx_changed){for(var line=0;line<m2.mappings.length;line++){var segment_list=m2.mappings[line];for(var segment=0;segment<segment_list.length;segment++){var seg=segment_list[segment];if(seg[1]>=0)seg[1]=new_source_idx[seg[1]];if(seg[4]>=0)seg[4]=new_name_idx[seg[4]];}}}else if(sources_idx_changed){for(var _line=0;_line<m2.mappings.length;_line++){var _segment_list=m2.mappings[_line];for(var _segment=0;_segment<_segment_list.length;_segment++){var _seg=_segment_list[_segment];if(_seg[1]>=0)_seg[1]=new_source_idx[_seg[1]];}}}else if(names_idx_changed){for(var _line2=0;_line2<m2.mappings.length;_line2++){var _segment_list2=m2.mappings[_line2];for(var _segment2=0;_segment2<_segment_list2.length;_segment2++){var _seg2=_segment_list2[_segment2];if(_seg2[4]>=0)_seg2[4]=new_name_idx[_seg2[4]];}}}// combine the mappings\n// combine\n// 1. last line of first map\n// 2. first line of second map\n// columns of 2 must be shifted\nif(m2.mappings.length>0&&column_offset>0){var first_line=m2.mappings[0];for(var _i45=0;_i45<first_line.length;_i45++){first_line[_i45][0]+=column_offset;}}// combine last line + first line\npushArray(m1.mappings[m1.mappings.length-1],m2.mappings.shift());// append other lines\npushArray(m1.mappings,m2.mappings);return this;}}],[{key:\"from_processed\",value:function from_processed(string,map){var line_count=string.split('\\n').length;if(map){// ensure that count of source map mappings lines\n// is equal to count of generated code lines\n// (some tools may produce less)\nvar missing_lines=line_count-map.mappings.length;for(var _i46=0;_i46<missing_lines;_i46++){map.mappings.push([]);}return new MappedCode(string,map);}if(string=='')return new MappedCode();map={version:3,names:[],sources:[],mappings:[]};// add empty SourceMapSegment[] for every line\nfor(var _i47=0;_i47<line_count;_i47++){map.mappings.push([]);}return new MappedCode(string,map);}},{key:\"from_source\",value:function from_source(_ref22){var source=_ref22.source,file_basename=_ref22.file_basename,get_location=_ref22.get_location;var offset=get_location(0);if(!offset)offset={line:0,column:0};var map={version:3,names:[],sources:[file_basename],mappings:[]};if(source=='')return new MappedCode(source,map);// we create a high resolution identity map here,\n// we know that it will eventually be merged with svelte's map,\n// at which stage the resolution will decrease.\nvar line_list=source.split('\\n');for(var line=0;line<line_list.length;line++){map.mappings.push([]);var token_list=line_list[line].split(/([^\\d\\w\\s]|\\s+)/g);for(var token=0,column=0;token<token_list.length;token++){if(token_list[token]=='')continue;map.mappings[line].push([column,0,offset.line+line,column]);column+=token_list[token].length;}}// shift columns in first line\nvar segment_list=map.mappings[0];for(var segment=0;segment<segment_list.length;segment++){segment_list[segment][3]+=offset.column;}return new MappedCode(source,map);}}]);return MappedCode;}();function combine_sourcemaps(filename,sourcemap_list){if(sourcemap_list.length==0)return null;var map_idx=1;var map=sourcemap_list.slice(0,-1).find(function(m){return m.sources.length!==1;})===undefined?remapping(// use array interface\n// only the oldest sourcemap can have multiple sources\nsourcemap_list,function(){return null;},true// skip optional field `sourcesContent`\n):remapping(// use loader interface\nsourcemap_list[0],// last map\nfunction loader(sourcefile){if(sourcefile===filename&&sourcemap_list[map_idx]){return sourcemap_list[map_idx++];// idx 1, 2, ...\n// bundle file = branch node\n}else{return null;// source file = leaf node\n}},true);if(!map.file)delete map.file;// skip optional field `file`\n// When source maps are combined and the leading map is empty, sources is not set.\n// Add the filename to the empty array in this case. \n// Further improvements to remapping may help address this as well https://github.com/ampproject/remapping/issues/116\nif(!map.sources.length)map.sources=[filename];return map;}// browser vs node.js\nvar b64enc=typeof btoa=='function'?btoa:function(b){return Buffer.from(b).toString('base64');};var b64dec=typeof atob=='function'?atob:function(a){return Buffer.from(a,'base64').toString();};function apply_preprocessor_sourcemap(filename,svelte_map,preprocessor_map_input){if(!svelte_map||!preprocessor_map_input)return svelte_map;var preprocessor_map=typeof preprocessor_map_input==='string'?JSON.parse(preprocessor_map_input):preprocessor_map_input;var result_map=combine_sourcemaps(filename,[svelte_map,preprocessor_map]);// Svelte expects a SourceMap which includes toUrl and toString. Instead of wrapping our output in a class,\n// we just tack on the extra properties.\nObject.defineProperties(result_map,{toString:{enumerable:false,value:function toString(){return JSON.stringify(this);}},toUrl:{enumerable:false,value:function toUrl(){return'data:application/json;charset=utf-8;base64,'+b64enc(this.toString());}}});return result_map;}// parse attached sourcemap in processed.code\nfunction parse_attached_sourcemap(processed,tag_name){var r_in='[#@]\\\\s*sourceMappingURL\\\\s*=\\\\s*(\\\\S*)';var regex=tag_name=='script'?new RegExp('(?://'+r_in+')|(?:/\\\\*'+r_in+'\\\\s*\\\\*/)$'):new RegExp('/\\\\*'+r_in+'\\\\s*\\\\*/$');function log_warning(message){// code_start: help to find preprocessor\nvar code_start=processed.code.length<100?processed.code:processed.code.slice(0,100)+' [...]';console.warn(\"warning: \".concat(message,\". processed.code = \").concat(JSON.stringify(code_start)));}processed.code=processed.code.replace(regex,function(_,match1,match2){var map_url=tag_name=='script'?match1||match2:match1;var map_data=(map_url.match(/data:(?:application|text)\\/json;(?:charset[:=]\\S+?;)?base64,(\\S*)/)||[])[1];if(map_data){// sourceMappingURL is data URL\nif(processed.map){log_warning('Not implemented. '+'Found sourcemap in both processed.code and processed.map. '+'Please update your preprocessor to return only one sourcemap.');// ignore attached sourcemap\nreturn'';}processed.map=b64dec(map_data);// use attached sourcemap\nreturn'';// remove from processed.code\n}// sourceMappingURL is path or URL\nif(!processed.map){log_warning(\"Found sourcemap path \".concat(JSON.stringify(map_url),\" in processed.code, but no sourcemap data. \")+'Please update your preprocessor to return sourcemap data directly.');}// ignore sourcemap path\nreturn'';// remove from processed.code\n});}function check_enable_sourcemap(enable_sourcemap,namespace){return typeof enable_sourcemap==='boolean'?enable_sourcemap:enable_sourcemap[namespace];}function dom(component,options){var name=component.name;var renderer=new Renderer(component,options);var block=renderer.block;block.has_outro_method=true;// prevent fragment being created twice (#1063)\nif(options.customElement)block.chunks.create.push(b(_templateObject630||(_templateObject630=(0,_taggedTemplateLiteral2.default)([\"this.c = @noop;\"]))));var body=[];if(renderer.file_var){var file=component.file?x(_templateObject631||(_templateObject631=(0,_taggedTemplateLiteral2.default)([\"\\\"\",\"\\\"\"])),component.file):x(_templateObject632||(_templateObject632=(0,_taggedTemplateLiteral2.default)([\"undefined\"])));body.push(b(_templateObject633||(_templateObject633=(0,_taggedTemplateLiteral2.default)([\"const \",\" = \",\";\"])),renderer.file_var,file));}var css=component.stylesheet.render(options.filename,!options.customElement);var css_sourcemap_enabled=check_enable_sourcemap(options.enableSourcemap,'css');if(css_sourcemap_enabled){css.map=apply_preprocessor_sourcemap(options.filename,css.map,options.sourcemap);}else{css.map=null;}var styles=css_sourcemap_enabled&&component.stylesheet.has_styles&&options.dev?\"\".concat(css.code,\"\\n/*# sourceMappingURL=\").concat(css.map.toUrl(),\" */\"):css.code;var add_css=component.get_unique_name('add_css');var should_add_css=!options.customElement&&!!styles&&options.css!==false;if(should_add_css){body.push(b(_templateObject634||(_templateObject634=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfunction \",\"(target) {\\n\\t\\t\\t\\t@append_styles(target, \\\"\",\"\\\", \\\"\",\"\\\");\\n\\t\\t\\t}\\n\\t\\t\"])),add_css,component.stylesheet.id,styles));}// fix order\n// TODO the deconflicted names of blocks are reversed... should set them here\nvar blocks=renderer.blocks.slice().reverse();body.push.apply(body,(0,_toConsumableArray2.default)(blocks.map(function(block){// TODO this is a horrible mess — renderer.blocks\n// contains a mixture of Blocks and Nodes\nif(block.render)return block.render();return block;})));if(options.dev&&!options.hydratable){block.chunks.claim.push(b(_templateObject635||(_templateObject635=(0,_taggedTemplateLiteral2.default)([\"throw new @_Error(\\\"options.hydrate only works if the component was compiled with the `hydratable: true` option\\\");\"],[\"throw new @_Error(\\\"options.hydrate only works if the component was compiled with the \\\\`hydratable: true\\\\` option\\\");\"]))));}var uses_slots=component.var_lookup.has('$$slots');var compute_slots;if(uses_slots){compute_slots=b(_templateObject636||(_templateObject636=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tconst $$slots = @compute_slots(#slots);\\n\\t\\t\"])));}var uses_props=component.var_lookup.has('$$props');var uses_rest=component.var_lookup.has('$$restProps');var $$props=uses_props||uses_rest?'$$new_props':'$$props';var props=component.vars.filter(function(variable){return!variable.module&&variable.export_name;});var writable_props=props.filter(function(variable){return variable.writable;});var omit_props_names=component.get_unique_name('omit_props_names');var compute_rest=x(_templateObject637||(_templateObject637=(0,_taggedTemplateLiteral2.default)([\"@compute_rest_props($$props, \",\")\"])),omit_props_names.name);var rest=uses_rest?b(_templateObject638||(_templateObject638=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\tconst \",\" = [\",\"];\\n\\t\\tlet $$restProps = \",\";\\n\\t\"])),omit_props_names.name,props.map(function(prop){return\"\\\"\".concat(prop.export_name,\"\\\"\");}).join(','),compute_rest):null;var set=uses_props||uses_rest||writable_props.length>0||component.slots.size>0?x(_templateObject639||(_templateObject639=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\" => {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\\n\\t\\t\"])),$$props,uses_props&&renderer.invalidate('$$props',x(_templateObject640||(_templateObject640=(0,_taggedTemplateLiteral2.default)([\"$$props = @assign(@assign({}, $$props), @exclude_internal_props($$new_props))\"])))),uses_rest&&!uses_props&&x(_templateObject641||(_templateObject641=(0,_taggedTemplateLiteral2.default)([\"$$props = @assign(@assign({}, $$props), @exclude_internal_props($$new_props))\"]))),uses_rest&&renderer.invalidate('$$restProps',x(_templateObject642||(_templateObject642=(0,_taggedTemplateLiteral2.default)([\"$$restProps = \",\"\"])),compute_rest)),writable_props.map(function(prop){return b(_templateObject643||(_templateObject643=(0,_taggedTemplateLiteral2.default)([\"if ('\",\"' in \",\") \",\";\"])),prop.export_name,$$props,renderer.invalidate(prop.name,x(_templateObject644||(_templateObject644=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\".\",\"\"])),prop.name,$$props,prop.export_name)));}),component.slots.size>0&&b(_templateObject645||(_templateObject645=(0,_taggedTemplateLiteral2.default)([\"if ('$$scope' in \",\") \",\";\"])),$$props,renderer.invalidate('$$scope',x(_templateObject646||(_templateObject646=(0,_taggedTemplateLiteral2.default)([\"$$scope = \",\".$$scope\"])),$$props)))):null;var accessors=[];var not_equal=component.component_options.immutable?x(_templateObject647||(_templateObject647=(0,_taggedTemplateLiteral2.default)([\"@not_equal\"]))):x(_templateObject648||(_templateObject648=(0,_taggedTemplateLiteral2.default)([\"@safe_not_equal\"])));var dev_props_check;var inject_state;var capture_state;var props_inject;props.forEach(function(prop){var variable=component.var_lookup.get(prop.name);if(!variable.writable||component.component_options.accessors){accessors.push({type:'MethodDefinition',kind:'get',key:{type:'Identifier',name:prop.export_name},value:x(_templateObject649||(_templateObject649=(0,_taggedTemplateLiteral2.default)([\"function() {\\n\\t\\t\\t\\t\\treturn \",\"\\n\\t\\t\\t\\t}\"])),prop.hoistable?prop.name:x(_templateObject650||(_templateObject650=(0,_taggedTemplateLiteral2.default)([\"this.$$.ctx[\",\"]\"])),renderer.context_lookup.get(prop.name).index))});}else if(component.compile_options.dev){accessors.push({type:'MethodDefinition',kind:'get',key:{type:'Identifier',name:prop.export_name},value:x(_templateObject651||(_templateObject651=(0,_taggedTemplateLiteral2.default)([\"function() {\\n\\t\\t\\t\\t\\tthrow new @_Error(\\\"<\",\">: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'\\\");\\n\\t\\t\\t\\t}\"])),component.tag)});}if(component.component_options.accessors){if(variable.writable&&!renderer.readonly.has(prop.name)){accessors.push({type:'MethodDefinition',kind:'set',key:{type:'Identifier',name:prop.export_name},value:x(_templateObject652||(_templateObject652=(0,_taggedTemplateLiteral2.default)([\"function(\",\") {\\n\\t\\t\\t\\t\\t\\tthis.$$set({ \",\": \",\" });\\n\\t\\t\\t\\t\\t\\t@flush();\\n\\t\\t\\t\\t\\t}\"])),prop.name,prop.export_name,prop.name)});}else if(component.compile_options.dev){accessors.push({type:'MethodDefinition',kind:'set',key:{type:'Identifier',name:prop.export_name},value:x(_templateObject653||(_templateObject653=(0,_taggedTemplateLiteral2.default)([\"function(value) {\\n\\t\\t\\t\\t\\t\\tthrow new @_Error(\\\"<\",\">: Cannot set read-only property '\",\"'\\\");\\n\\t\\t\\t\\t\\t}\"])),component.tag,prop.export_name)});}}else if(component.compile_options.dev){accessors.push({type:'MethodDefinition',kind:'set',key:{type:'Identifier',name:prop.export_name},value:x(_templateObject654||(_templateObject654=(0,_taggedTemplateLiteral2.default)([\"function(value) {\\n\\t\\t\\t\\t\\tthrow new @_Error(\\\"<\",\">: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'\\\");\\n\\t\\t\\t\\t}\"])),component.tag)});}});component.instance_exports_from.forEach(function(exports_from){var import_declaration=Object.assign(Object.assign({},exports_from),{type:'ImportDeclaration',specifiers:[],source:exports_from.source});component.imports.push(import_declaration);exports_from.specifiers.forEach(function(specifier){if(component.component_options.accessors){var _name4=component.get_unique_name(specifier.exported.name);import_declaration.specifiers.push(Object.assign(Object.assign({},specifier),{type:'ImportSpecifier',imported:specifier.local,local:_name4}));accessors.push({type:'MethodDefinition',kind:'get',key:{type:'Identifier',name:specifier.exported.name},value:x(_templateObject655||(_templateObject655=(0,_taggedTemplateLiteral2.default)([\"function() {\\n\\t\\t\\t\\t\\t\\treturn \",\"\\n\\t\\t\\t\\t\\t}\"])),_name4)});}else if(component.compile_options.dev){accessors.push({type:'MethodDefinition',kind:'get',key:{type:'Identifier',name:specifier.exported.name},value:x(_templateObject656||(_templateObject656=(0,_taggedTemplateLiteral2.default)([\"function() {\\n\\t\\t\\t\\t\\t\\tthrow new @_Error(\\\"<\",\">: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'\\\");\\n\\t\\t\\t\\t\\t}\"])),component.tag)});}});});if(component.compile_options.dev){// checking that expected ones were passed\nvar expected=props.filter(function(prop){return prop.writable&&!prop.initialised;});if(expected.length){dev_props_check=b(_templateObject657||(_templateObject657=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tconst { ctx: #ctx } = this.$$;\\n\\t\\t\\t\\tconst props = \",\";\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\"])),options.customElement?x(_templateObject658||(_templateObject658=(0,_taggedTemplateLiteral2.default)([\"this.attributes\"]))):x(_templateObject659||(_templateObject659=(0,_taggedTemplateLiteral2.default)([\"options.props || {}\"]))),expected.map(function(prop){return b(_templateObject660||(_templateObject660=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif (\",\" === undefined && !('\",\"' in props)) {\\n\\t\\t\\t\\t\\t@_console.warn(\\\"<\",\"> was created without expected prop '\",\"'\\\");\\n\\t\\t\\t\\t}\"])),renderer.reference(prop.name),prop.export_name,component.tag,prop.export_name);}));}var capturable_vars=component.vars.filter(function(v){return!v.internal&&!v.global&&!v.name.startsWith('$$');});if(capturable_vars.length>0){capture_state=x(_templateObject661||(_templateObject661=(0,_taggedTemplateLiteral2.default)([\"() => ({ \",\" })\"])),capturable_vars.map(function(prop){return p(_templateObject662||(_templateObject662=(0,_taggedTemplateLiteral2.default)([\"\",\"\"])),prop.name);}));}var injectable_vars=capturable_vars.filter(function(v){return!v.module&&v.writable&&v.name[0]!=='$';});if(uses_props||injectable_vars.length>0){inject_state=x(_templateObject663||(_templateObject663=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\" => {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])),$$props,uses_props&&renderer.invalidate('$$props',x(_templateObject664||(_templateObject664=(0,_taggedTemplateLiteral2.default)([\"$$props = @assign(@assign({}, $$props), $$new_props)\"])))),injectable_vars.map(function(v){return b(_templateObject665||(_templateObject665=(0,_taggedTemplateLiteral2.default)([\"if ('\",\"' in $$props) \",\";\"])),v.name,renderer.invalidate(v.name,x(_templateObject666||(_templateObject666=(0,_taggedTemplateLiteral2.default)([\"\",\" = \",\".\",\"\"])),v.name,$$props,v.name)));}));props_inject=b(_templateObject667||(_templateObject667=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tif ($$props && \\\"$$inject\\\" in $$props) {\\n\\t\\t\\t\\t\\t$$self.$inject_state($$props.$$inject);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\"])));}}// instrument assignments\nif(component.ast.instance){var _scope3=component.instance_scope;var map=component.instance_scope_map;var execution_context=null;walk(component.ast.instance.content,{enter:function enter(node){if(map.has(node)){_scope3=map.get(node);if(!execution_context&&!_scope3.block){execution_context=node;}}else if(!execution_context&&node.type==='LabeledStatement'&&node.label.name==='$'){execution_context=node;}},leave:function leave(node){if(map.has(node)){_scope3=_scope3.parent;}if(execution_context===node){execution_context=null;}if(node.type==='AssignmentExpression'||node.type==='UpdateExpression'){var assignee=node.type==='AssignmentExpression'?node.left:node.argument;// normally (`a = 1`, `b.c = 2`), there'll be a single name\n// (a or b). In destructuring cases (`[d, e] = [e, d]`) there\n// may be more, in which case we need to tack the extra ones\n// onto the initial function call\nvar _names2=new Set(extract_names(assignee));this.replace(invalidate(renderer,_scope3,node,_names2,execution_context===null));}}});component.rewrite_props(function(_ref23){var name=_ref23.name,reassigned=_ref23.reassigned,export_name=_ref23.export_name;var value=\"$\".concat(name);var i=renderer.context_lookup.get(\"$\".concat(name)).index;var insert=reassigned||export_name?b(_templateObject668||(_templateObject668=(0,_taggedTemplateLiteral2.default)([\"\",\"()\"])),\"$$subscribe_\".concat(name)):b(_templateObject669||(_templateObject669=(0,_taggedTemplateLiteral2.default)([\"@component_subscribe($$self, \",\", #value => $$invalidate(\",\", \",\" = #value))\"])),name,i,value);if(component.compile_options.dev){return b(_templateObject670||(_templateObject670=(0,_taggedTemplateLiteral2.default)([\"@validate_store(\",\", '\",\"'); \",\"\"])),name,name,insert);}return insert;});}var args=[x(_templateObject671||(_templateObject671=(0,_taggedTemplateLiteral2.default)([\"$$self\"])))];var has_invalidate=props.length>0||component.has_reactive_assignments||component.slots.size>0||capture_state||inject_state;if(has_invalidate){args.push(x(_templateObject672||(_templateObject672=(0,_taggedTemplateLiteral2.default)([\"$$props\"]))),x(_templateObject673||(_templateObject673=(0,_taggedTemplateLiteral2.default)([\"$$invalidate\"]))));}else if(component.compile_options.dev){// $$props arg is still needed for unknown prop check\nargs.push(x(_templateObject674||(_templateObject674=(0,_taggedTemplateLiteral2.default)([\"$$props\"]))));}var has_create_fragment=component.compile_options.dev||block.has_content();if(has_create_fragment){body.push(b(_templateObject675||(_templateObject675=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfunction create_fragment(#ctx) {\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t}\\n\\t\\t\"])),block.get_contents()));}body.push(b(_templateObject676||(_templateObject676=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\",\"\\n\\n\\t\\t\",\"\\n\\t\"])),component.extract_javascript(component.ast.module),component.fully_hoisted));var filtered_props=props.filter(function(prop){var variable=component.var_lookup.get(prop.name);if(variable.hoistable)return false;return prop.name[0]!=='$';});var reactive_stores=component.vars.filter(function(variable){return variable.name[0]==='$'&&variable.name[1]!=='$';});var instance_javascript=component.extract_javascript(component.ast.instance);var has_definition=component.compile_options.dev||instance_javascript&&instance_javascript.length>0||filtered_props.length>0||uses_props||component.partly_hoisted.length>0||renderer.initial_context.length>0||component.reactive_declarations.length>0||capture_state||inject_state;var definition=has_definition?component.alias('instance'):{type:'Literal',value:null};var reactive_store_subscriptions=reactive_stores.filter(function(store){var variable=component.var_lookup.get(store.name.slice(1));return!variable||variable.hoistable;}).map(function(_ref24){var name=_ref24.name;return b(_templateObject677||(_templateObject677=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\"\\n\\t\\t\\t@component_subscribe($$self, \",\", $$value => $$invalidate(\",\", \",\" = $$value));\\n\\t\\t\"])),component.compile_options.dev&&b(_templateObject678||(_templateObject678=(0,_taggedTemplateLiteral2.default)([\"@validate_store(\",\", '\",\"');\"])),name.slice(1),name.slice(1)),name.slice(1),renderer.context_lookup.get(name).index,name);});var resubscribable_reactive_store_unsubscribers=reactive_stores.filter(function(store){var variable=component.var_lookup.get(store.name.slice(1));return variable&&(variable.reassigned||variable.export_name);}).map(function(_ref25){var name=_ref25.name;return b(_templateObject679||(_templateObject679=(0,_taggedTemplateLiteral2.default)([\"$$self.$$.on_destroy.push(() => \",\"());\"])),\"$$unsubscribe_\".concat(name.slice(1)));});if(has_definition){var reactive_declarations=[];var fixed_reactive_declarations=[];// not really 'reactive' but whatever\ncomponent.reactive_declarations.forEach(function(d){var dependencies=Array.from(d.dependencies);var uses_rest_or_props=!!dependencies.find(function(n){return n==='$$props'||n==='$$restProps';});var writable=dependencies.filter(function(n){var variable=component.var_lookup.get(n);return variable&&(variable.export_name||variable.mutated||variable.reassigned);});var condition=!uses_rest_or_props&&writable.length>0&&renderer.dirty(writable,true);var statement=d.node;// TODO remove label (use d.node.body) if it's not referenced\nif(condition)statement=b(_templateObject680||(_templateObject680=(0,_taggedTemplateLiteral2.default)([\"if (\",\") { \",\" }\"])),condition,statement)[0];if(condition||uses_rest_or_props){reactive_declarations.push(statement);}else{fixed_reactive_declarations.push(statement);}});var injected=Array.from(component.injected_reactive_declaration_vars).filter(function(name){var variable=component.var_lookup.get(name);return variable.injected&&variable.name[0]!=='$';});var reactive_store_declarations=reactive_stores.map(function(variable){var $name=variable.name;var name=$name.slice(1);var store=component.var_lookup.get(name);if(store&&(store.reassigned||store.export_name)){var unsubscribe=\"$$unsubscribe_\".concat(name);var subscribe=\"$$subscribe_\".concat(name);var _i48=renderer.context_lookup.get($name).index;return b(_templateObject681||(_templateObject681=(0,_taggedTemplateLiteral2.default)([\"let \",\", \",\" = @noop, \",\" = () => (\",\"(), \",\" = @subscribe(\",\", $$value => $$invalidate(\",\", \",\" = $$value)), \",\")\"])),$name,unsubscribe,subscribe,unsubscribe,unsubscribe,name,_i48,$name,name);}return b(_templateObject682||(_templateObject682=(0,_taggedTemplateLiteral2.default)([\"let \",\";\"])),$name);});var unknown_props_check;if(component.compile_options.dev&&!(uses_props||uses_rest)){unknown_props_check=b(_templateObject683||(_templateObject683=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\tconst writable_props = [\",\"];\\n\\t\\t\\t\\t@_Object.keys($$props).forEach(key => {\\n\\t\\t\\t\\t\\tif (!~writable_props.indexOf(key) && key.slice(0, 2) !== '$$' && key !== 'slot') @_console.warn(`<\",\"> was created with unknown prop '${key}'`);\\n\\t\\t\\t\\t});\\n\\t\\t\\t\"],[\"\\n\\t\\t\\t\\tconst writable_props = [\",\"];\\n\\t\\t\\t\\t@_Object.keys($$props).forEach(key => {\\n\\t\\t\\t\\t\\tif (!~writable_props.indexOf(key) && key.slice(0, 2) !== '$$' && key !== 'slot') @_console.warn(\\\\`<\",\"> was created with unknown prop '\\\\${key}'\\\\`);\\n\\t\\t\\t\\t});\\n\\t\\t\\t\"])),writable_props.map(function(prop){return x(_templateObject684||(_templateObject684=(0,_taggedTemplateLiteral2.default)([\"'\",\"'\"])),prop.export_name);}),component.tag);}var return_value={type:'ArrayExpression',elements:renderer.initial_context.map(function(member){return{type:'Identifier',name:member.name};})};body.push(b(_templateObject685||(_templateObject685=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tfunction \",\"(\",\") {\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\treturn \",\";\\n\\t\\t\\t}\\n\\t\\t\"])),definition,args,injected.map(function(name){return b(_templateObject686||(_templateObject686=(0,_taggedTemplateLiteral2.default)([\"let \",\";\"])),name);}),rest,reactive_store_declarations,reactive_store_subscriptions,resubscribable_reactive_store_unsubscribers,component.slots.size||component.compile_options.dev||uses_slots?b(_templateObject687||(_templateObject687=(0,_taggedTemplateLiteral2.default)([\"let { $$slots: #slots = {}, $$scope } = $$props;\"]))):null,component.compile_options.dev&&b(_templateObject688||(_templateObject688=(0,_taggedTemplateLiteral2.default)([\"@validate_slots('\",\"', #slots, [\",\"]);\"])),component.tag,(0,_toConsumableArray2.default)(component.slots.keys()).map(function(key){return\"'\".concat(key,\"'\");}).join(',')),compute_slots,instance_javascript,unknown_props_check,renderer.binding_groups.size>0&&b(_templateObject689||(_templateObject689=(0,_taggedTemplateLiteral2.default)([\"const $$binding_groups = [\",\"];\"])),(0,_toConsumableArray2.default)(renderer.binding_groups.keys()).map(function(_){return x(_templateObject690||(_templateObject690=(0,_taggedTemplateLiteral2.default)([\"[]\"])));})),component.partly_hoisted,set&&b(_templateObject691||(_templateObject691=(0,_taggedTemplateLiteral2.default)([\"$$self.$$set = \",\";\"])),set),capture_state&&b(_templateObject692||(_templateObject692=(0,_taggedTemplateLiteral2.default)([\"$$self.$capture_state = \",\";\"])),capture_state),inject_state&&b(_templateObject693||(_templateObject693=(0,_taggedTemplateLiteral2.default)([\"$$self.$inject_state = \",\";\"])),inject_state),/* before reactive declarations */props_inject,reactive_declarations.length>0&&b(_templateObject694||(_templateObject694=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t$$self.$$.update = () => {\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t};\\n\\t\\t\\t\\t\"])),reactive_declarations),fixed_reactive_declarations,uses_props&&b(_templateObject695||(_templateObject695=(0,_taggedTemplateLiteral2.default)([\"$$props = @exclude_internal_props($$props);\"]))),return_value));}var prop_indexes=x(_templateObject696||(_templateObject696=(0,_taggedTemplateLiteral2.default)([\"{\\n\\t\\t\",\"\\n\\t}\"])),props.filter(function(v){return v.export_name&&!v.module;}).map(function(v){return p(_templateObject697||(_templateObject697=(0,_taggedTemplateLiteral2.default)([\"\",\": \",\"\"])),v.export_name,renderer.context_lookup.get(v.name).index);}));var dirty;if(renderer.context_overflow){dirty=x(_templateObject698||(_templateObject698=(0,_taggedTemplateLiteral2.default)([\"[]\"])));for(var _i49=0;_i49<renderer.context.length;_i49+=31){dirty.elements.push(x(_templateObject699||(_templateObject699=(0,_taggedTemplateLiteral2.default)([\"-1\"]))));}}if(options.customElement){var _declaration$body$bod;var init_props=x(_templateObject700||(_templateObject700=(0,_taggedTemplateLiteral2.default)([\"@attribute_to_object(this.attributes)\"])));if(uses_slots){init_props=x(_templateObject701||(_templateObject701=(0,_taggedTemplateLiteral2.default)([\"{ ...\",\", $$slots: @get_custom_elements_slots(this) }\"])),init_props);}var declaration=b(_templateObject702||(_templateObject702=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tclass \",\" extends @SvelteElement {\\n\\t\\t\\t\\tconstructor(options) {\\n\\t\\t\\t\\t\\tsuper();\\n\\n\\t\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\\t@init(this, { target: this.shadowRoot, props: \",\", customElement: true }, \",\", \",\", \",\", \",\", null, \",\");\\n\\n\\t\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\\tif (options) {\\n\\t\\t\\t\\t\\t\\tif (options.target) {\\n\\t\\t\\t\\t\\t\\t\\t@insert(options.target, this, options.anchor);\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\"])),name,css.code&&b(_templateObject703||(_templateObject703=(0,_taggedTemplateLiteral2.default)([\"this.shadowRoot.innerHTML = `<style>\",\"\",\"</style>`;\"],[\"this.shadowRoot.innerHTML = \\\\`<style>\",\"\",\"</style>\\\\`;\"])),css.code.replace(/\\\\/g,'\\\\\\\\'),css_sourcemap_enabled&&options.dev?\"\\n/*# sourceMappingURL=\".concat(css.map.toUrl(),\" */\"):''),init_props,definition,has_create_fragment?'create_fragment':'null',not_equal,prop_indexes,dirty,dev_props_check,(props.length>0||uses_props||uses_rest)&&b(_templateObject704||(_templateObject704=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\tif (options.props) {\\n\\t\\t\\t\\t\\t\\t\\tthis.$set(options.props);\\n\\t\\t\\t\\t\\t\\t\\t@flush();\\n\\t\\t\\t\\t\\t\\t}\"]))))[0];if(props.length>0){declaration.body.body.push({type:'MethodDefinition',kind:'get',static:true,computed:false,key:{type:'Identifier',name:'observedAttributes'},value:x(_templateObject705||(_templateObject705=(0,_taggedTemplateLiteral2.default)([\"function() {\\n\\t\\t\\t\\t\\treturn [\",\"];\\n\\t\\t\\t\\t}\"])),props.map(function(prop){return x(_templateObject706||(_templateObject706=(0,_taggedTemplateLiteral2.default)([\"\\\"\",\"\\\"\"])),prop.export_name);}))});}(_declaration$body$bod=declaration.body.body).push.apply(_declaration$body$bod,accessors);body.push(declaration);if(component.tag!=null){body.push(b(_templateObject707||(_templateObject707=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t@_customElements.define(\\\"\",\"\\\", \",\");\\n\\t\\t\\t\"])),component.tag,name));}}else{var _declaration$body$bod2;var superclass={type:'Identifier',name:options.dev?'@SvelteComponentDev':'@SvelteComponent'};var optional_parameters=[];if(should_add_css){optional_parameters.push(add_css);}else if(dirty){optional_parameters.push(x(_templateObject708||(_templateObject708=(0,_taggedTemplateLiteral2.default)([\"null\"]))));}if(dirty){optional_parameters.push(dirty);}var _declaration=b(_templateObject709||(_templateObject709=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tclass \",\" extends \",\" {\\n\\t\\t\\t\\tconstructor(options) {\\n\\t\\t\\t\\t\\tsuper(\",\");\\n\\t\\t\\t\\t\\t@init(this, options, \",\", \",\", \",\", \",\", \",\");\\n\\t\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\"])),name,superclass,options.dev&&'options',definition,has_create_fragment?'create_fragment':'null',not_equal,prop_indexes,optional_parameters,options.dev&&b(_templateObject710||(_templateObject710=(0,_taggedTemplateLiteral2.default)([\"@dispatch_dev(\\\"SvelteRegisterComponent\\\", { component: this, tagName: \\\"\",\"\\\", options, id: create_fragment.name });\"])),name.name),dev_props_check)[0];(_declaration$body$bod2=_declaration.body.body).push.apply(_declaration$body$bod2,accessors);body.push(_declaration);}return{js:flatten(body),css:css};}function get_const_tags$1(const_tags){if(const_tags.length===0)return null;return{type:'VariableDeclaration',kind:'let',declarations:const_tags.map(function(const_tag){var assignment=const_tag.node.expression;return{type:'VariableDeclarator',id:assignment.left,init:assignment.right};})};}function AwaitBlock$1(node,renderer,options){renderer.push();renderer.render(node.pending.children,options);var pending=renderer.pop();renderer.push();renderer.render(node.then.children,options);var then=renderer.pop();renderer.add_expression(x(_templateObject711||(_templateObject711=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\tfunction(__value) {\\n\\t\\t\\tif (@is_promise(__value)) {\\n\\t\\t\\t\\t__value.then(null, @noop);\\n\\t\\t\\t\\treturn \",\";\\n\\t\\t\\t}\\n\\t\\t\\treturn (function(\",\") { \",\"; return \",\"; }(__value));\\n\\t\\t}(\",\")\\n\\t\"])),pending,node.then_node?node.then_node:'',get_const_tags$1(node.then.const_tags),then,node.expression.node));}function Comment$2(node,renderer,options){if(options.preserveComments){renderer.add_string(\"<!--\".concat(node.data,\"-->\"));}}function DebugTag$1(node,renderer,options){if(!options.dev)return;var filename=options.filename||null;var _options$locate=options.locate(node.start+1),line=_options$locate.line,column=_options$locate.column;var obj=x(_templateObject712||(_templateObject712=(0,_taggedTemplateLiteral2.default)([\"{\\n\\t\\t\",\"\\n\\t}\"])),node.expressions.map(function(e){return p(_templateObject713||(_templateObject713=(0,_taggedTemplateLiteral2.default)([\"\",\"\"])),e.node.name);}));renderer.add_expression(x(_templateObject714||(_templateObject714=(0,_taggedTemplateLiteral2.default)([\"@debug(\",\", \",\", \",\", \",\")\"])),filename?x(_templateObject715||(_templateObject715=(0,_taggedTemplateLiteral2.default)([\"\\\"\",\"\\\"\"])),filename):x(_templateObject716||(_templateObject716=(0,_taggedTemplateLiteral2.default)([\"null\"]))),line-1,column,obj));}function EachBlock$1(node,renderer,options){var args=[node.context_node];if(node.index)args.push({type:'Identifier',name:node.index});renderer.push();renderer.render(node.children,options);var result=renderer.pop();var consequent=x(_templateObject717||(_templateObject717=(0,_taggedTemplateLiteral2.default)([\"@each(\",\", (\",\") => { \",\"; return \",\" })\"])),node.expression.node,args,get_const_tags$1(node.const_tags),result);if(node.else){renderer.push();renderer.render(node.else.children,options);var alternate=renderer.pop();renderer.add_expression(x(_templateObject718||(_templateObject718=(0,_taggedTemplateLiteral2.default)([\"\",\".length ? \",\" : \",\"\"])),node.expression.node,consequent,alternate));}else{renderer.add_expression(consequent);}}function get_class_attribute_value(attribute){// handle special case — `class={possiblyUndefined}` with scoped CSS\nif(attribute.chunks.length===2&&attribute.chunks[1].synthetic){var _value14=attribute.chunks[0].node;return x(_templateObject719||(_templateObject719=(0,_taggedTemplateLiteral2.default)([\"@escape(@null_to_empty(\",\")) + \\\"\",\"\\\"\"])),_value14,attribute.chunks[1].data);}return get_attribute_value(attribute);}function get_attribute_value(attribute){if(attribute.chunks.length===0)return x(_templateObject720||(_templateObject720=(0,_taggedTemplateLiteral2.default)([\"\\\"\\\"\"])));return attribute.chunks.map(function(chunk){return chunk.type==='Text'?string_literal(chunk.data.replace(/\"/g,'&quot;')):x(_templateObject721||(_templateObject721=(0,_taggedTemplateLiteral2.default)([\"@escape(\",\")\"])),chunk.node);}).reduce(function(lhs,rhs){return x(_templateObject722||(_templateObject722=(0,_taggedTemplateLiteral2.default)([\"\",\" + \",\"\"])),lhs,rhs);});}function get_attribute_expression(attribute){if(attribute.chunks.length===1&&attribute.chunks[0].type==='Expression'){return attribute.chunks[0].node;}return get_attribute_value(attribute);}// source: https://html.spec.whatwg.org/multipage/indices.html\nvar boolean_attributes=new Set(['allowfullscreen','allowpaymentrequest','async','autofocus','autoplay','checked','controls','default','defer','disabled','formnovalidate','hidden','ismap','loop','multiple','muted','nomodule','novalidate','open','playsinline','readonly','required','reversed','selected']);// similar logic from `compile/render_dom/wrappers/Fragment`\n// We want to remove trailing whitespace inside an element/component/block,\n// *unless* there is no whitespace between this node and its next sibling\nfunction remove_whitespace_children(children,next){var nodes=[];var last_child;var i=children.length;while(i--){var child=children[i];if(child.type==='Text'){if(child.should_skip()){continue;}var _data5=child.data;if(nodes.length===0){var should_trim=next?next.type==='Text'&&/^\\s/.test(next.data)&&trimmable_at$1(child,next):!child.has_ancestor('EachBlock');if(should_trim){_data5=trim_end(_data5);if(!_data5)continue;}}// glue text nodes (which could e.g. be separated by comments) together\nif(last_child&&last_child.type==='Text'){last_child.data=_data5+last_child.data;continue;}nodes.unshift(child);link(last_child,last_child=child);}else{nodes.unshift(child);link(last_child,last_child=child);}}var first=nodes[0];if(first&&first.type==='Text'){first.data=trim_start(first.data);if(!first.data){first.var=null;nodes.shift();if(nodes[0]){nodes[0].prev=null;}}}return nodes;}function trimmable_at$1(child,next_sibling){// Whitespace is trimmable if one of the following is true:\n// The child and its sibling share a common nearest each block (not at an each block boundary)\n// The next sibling's previous node is an each block\nreturn next_sibling.find_nearest(/EachBlock/)===child.find_nearest(/EachBlock/)||next_sibling.prev.type==='EachBlock';}function Element$1(node,renderer,options){var children=remove_whitespace_children(node.children,node.next);// awkward special case\nvar node_contents;var contenteditable=node.name!=='textarea'&&node.name!=='input'&&node.attributes.some(function(attribute){return attribute.name==='contenteditable';});renderer.add_string(\"<\".concat(node.name));var class_expression_list=node.classes.map(function(class_directive){var expression=class_directive.expression,name=class_directive.name;var snippet=expression?expression.node:x(_templateObject723||(_templateObject723=(0,_taggedTemplateLiteral2.default)([\"#ctx.\",\"\"])),name);// TODO is this right?\nreturn x(_templateObject724||(_templateObject724=(0,_taggedTemplateLiteral2.default)([\"\",\" ? \\\"\",\"\\\" : \\\"\\\"\"])),snippet,name);});if(node.needs_manual_style_scoping){class_expression_list.push(x(_templateObject725||(_templateObject725=(0,_taggedTemplateLiteral2.default)([\"\\\"\",\"\\\"\"])),node.component.stylesheet.id));}var class_expression=class_expression_list.length>0&&class_expression_list.reduce(function(lhs,rhs){return x(_templateObject726||(_templateObject726=(0,_taggedTemplateLiteral2.default)([\"\",\" + ' ' + \",\"\"])),lhs,rhs);});var style_expression_list=node.styles.map(function(style_directive){var name=style_directive.name,expression=style_directive.expression.node;return p(_templateObject727||(_templateObject727=(0,_taggedTemplateLiteral2.default)([\"\\\"\",\"\\\": \",\"\"])),name,expression);});var style_expression=style_expression_list.length>0&&x(_templateObject728||(_templateObject728=(0,_taggedTemplateLiteral2.default)([\"{ \",\" }\"])),style_expression_list);if(node.attributes.some(function(attr){return attr.is_spread;})){// TODO dry this out\nvar args=[];node.attributes.forEach(function(attribute){if(attribute.is_spread){args.push(x(_templateObject729||(_templateObject729=(0,_taggedTemplateLiteral2.default)([\"@escape_object(\",\")\"])),attribute.expression.node));}else{var attr_name=node.namespace===namespaces.foreign?attribute.name:fix_attribute_casing(attribute.name);var name=attribute.name.toLowerCase();if(name==='value'&&node.name.toLowerCase()==='textarea'){node_contents=get_attribute_value(attribute);}else if(attribute.is_true){args.push(x(_templateObject730||(_templateObject730=(0,_taggedTemplateLiteral2.default)([\"{ \",\": true }\"])),attr_name));}else if(boolean_attributes.has(name)&&attribute.chunks.length===1&&attribute.chunks[0].type!=='Text'){// a boolean attribute with one non-Text chunk\nargs.push(x(_templateObject731||(_templateObject731=(0,_taggedTemplateLiteral2.default)([\"{ \",\": \",\" || null }\"])),attr_name,attribute.chunks[0].node));}else if(attribute.chunks.length===1&&attribute.chunks[0].type!=='Text'){var snippet=attribute.chunks[0].node;args.push(x(_templateObject732||(_templateObject732=(0,_taggedTemplateLiteral2.default)([\"{ \",\": @escape_attribute_value(\",\") }\"])),attr_name,snippet));}else{args.push(x(_templateObject733||(_templateObject733=(0,_taggedTemplateLiteral2.default)([\"{ \",\": \",\" }\"])),attr_name,get_attribute_value(attribute)));}}});renderer.add_expression(x(_templateObject734||(_templateObject734=(0,_taggedTemplateLiteral2.default)([\"@spread([\",\"], { classes: \",\", styles: \",\" })\"])),args,class_expression,style_expression));}else{var add_class_attribute=!!class_expression;var add_style_attribute=!!style_expression;node.attributes.forEach(function(attribute){var name=attribute.name.toLowerCase();var attr_name=node.namespace===namespaces.foreign?attribute.name:fix_attribute_casing(attribute.name);if(name==='value'&&node.name.toLowerCase()==='textarea'){node_contents=get_attribute_value(attribute);}else if(attribute.is_true){renderer.add_string(\" \".concat(attr_name));}else if(boolean_attributes.has(name)&&attribute.chunks.length===1&&attribute.chunks[0].type!=='Text'){// a boolean attribute with one non-Text chunk\nrenderer.add_string(' ');renderer.add_expression(x(_templateObject735||(_templateObject735=(0,_taggedTemplateLiteral2.default)([\"\",\" ? \\\"\",\"\\\" : \\\"\\\"\"])),attribute.chunks[0].node,attr_name));}else if(name==='class'&&class_expression){add_class_attribute=false;renderer.add_string(\" \".concat(attr_name,\"=\\\"\"));renderer.add_expression(x(_templateObject736||(_templateObject736=(0,_taggedTemplateLiteral2.default)([\"[\",\", \",\"].join(' ').trim()\"])),get_class_attribute_value(attribute),class_expression));renderer.add_string('\"');}else if(name==='style'&&style_expression){add_style_attribute=false;renderer.add_expression(x(_templateObject737||(_templateObject737=(0,_taggedTemplateLiteral2.default)([\"@add_styles(@merge_ssr_styles(\",\", \",\"))\"])),get_attribute_value(attribute),style_expression));}else if(attribute.chunks.length===1&&attribute.chunks[0].type!=='Text'){var snippet=attribute.chunks[0].node;renderer.add_expression(x(_templateObject738||(_templateObject738=(0,_taggedTemplateLiteral2.default)([\"@add_attribute(\\\"\",\"\\\", \",\", \",\")\"])),attr_name,snippet,boolean_attributes.has(name)?1:0));}else{renderer.add_string(\" \".concat(attr_name,\"=\\\"\"));renderer.add_expression((name==='class'?get_class_attribute_value:get_attribute_value)(attribute));renderer.add_string('\"');}});if(add_class_attribute){renderer.add_expression(x(_templateObject739||(_templateObject739=(0,_taggedTemplateLiteral2.default)([\"@add_classes((\",\").trim())\"])),class_expression));}if(add_style_attribute){renderer.add_expression(x(_templateObject740||(_templateObject740=(0,_taggedTemplateLiteral2.default)([\"@add_styles(\",\")\"])),style_expression));}}node.bindings.forEach(function(binding){var name=binding.name,expression=binding.expression;if(binding.is_readonly){return;}if(name==='group'){var value_attribute=node.attributes.find(function(_ref26){var name=_ref26.name;return name==='value';});if(value_attribute){var _value15=get_attribute_expression(value_attribute);var type=node.get_static_attribute_value('type');var bound=expression.node;var condition=type==='checkbox'?x(_templateObject741||(_templateObject741=(0,_taggedTemplateLiteral2.default)([\"~\",\".indexOf(\",\")\"])),bound,_value15):x(_templateObject742||(_templateObject742=(0,_taggedTemplateLiteral2.default)([\"\",\" === \",\"\"])),_value15,bound);renderer.add_expression(x(_templateObject743||(_templateObject743=(0,_taggedTemplateLiteral2.default)([\"\",\" ? @add_attribute(\\\"checked\\\", true, 1) : \\\"\\\"\"])),condition));}}else if(contenteditable&&(name==='textContent'||name==='innerHTML')){node_contents=expression.node;// TODO where was this used?\n// value = name === 'textContent' ? x`@escape($$value)` : x`$$value`;\n}else if(binding.name==='value'&&node.name==='textarea'){var snippet=expression.node;node_contents=x(_templateObject744||(_templateObject744=(0,_taggedTemplateLiteral2.default)([\"\",\" || \\\"\\\"\"])),snippet);}else if(binding.name==='value'&&node.name==='select');else{var _snippet5=expression.node;renderer.add_expression(x(_templateObject745||(_templateObject745=(0,_taggedTemplateLiteral2.default)([\"@add_attribute(\\\"\",\"\\\", \",\", \",\")\"])),name,_snippet5,boolean_attributes.has(name)?1:0));}});if(options.hydratable&&options.head_id){renderer.add_string(\" data-svelte=\\\"\".concat(options.head_id,\"\\\"\"));}renderer.add_string('>');if(node_contents!==undefined){if(contenteditable){renderer.push();renderer.render(children,options);var result=renderer.pop();renderer.add_expression(x(_templateObject746||(_templateObject746=(0,_taggedTemplateLiteral2.default)([\"($$value => $$value === void 0 ? \",\" : $$value)(\",\")\"])),result,node_contents));}else{renderer.add_expression(node_contents);}if(!is_void(node.name)){renderer.add_string(\"</\".concat(node.name,\">\"));}}else{renderer.render(children,options);if(!is_void(node.name)){renderer.add_string(\"</\".concat(node.name,\">\"));}}}function Head$1(node,renderer,options){var head_options=Object.assign(Object.assign({},options),{head_id:node.id});renderer.push();renderer.render(node.children,head_options);var result=renderer.pop();renderer.add_expression(x(_templateObject747||(_templateObject747=(0,_taggedTemplateLiteral2.default)([\"$$result.head += \",\", \\\"\\\"\"])),result));}function HtmlTag(node,renderer,options){if(options.hydratable)renderer.add_string('<!-- HTML_TAG_START -->');renderer.add_expression(node.expression.node);if(options.hydratable)renderer.add_string('<!-- HTML_TAG_END -->');}function IfBlock$1(node,renderer,options){var condition=node.expression.node;renderer.push();renderer.render(node.children,options);var consequent=renderer.pop();renderer.push();if(node.else)renderer.render(node.else.children,options);var alternate=renderer.pop();renderer.add_expression(x(_templateObject748||(_templateObject748=(0,_taggedTemplateLiteral2.default)([\"\",\" ? \",\" : \",\"\"])),condition,consequent,alternate));}function get_prop_value(attribute){if(attribute.is_true)return x(_templateObject749||(_templateObject749=(0,_taggedTemplateLiteral2.default)([\"true\"])));if(attribute.chunks.length===0)return x(_templateObject750||(_templateObject750=(0,_taggedTemplateLiteral2.default)([\"''\"])));return attribute.chunks.map(function(chunk){if(chunk.type==='Text')return string_literal(chunk.data);return chunk.node;}).reduce(function(lhs,rhs){return x(_templateObject751||(_templateObject751=(0,_taggedTemplateLiteral2.default)([\"\",\" + \",\"\"])),lhs,rhs);});}function InlineComponent$1(node,renderer,options){var binding_props=[];var binding_fns=[];node.bindings.forEach(function(binding){renderer.has_bindings=true;// TODO this probably won't work for contextual bindings\nvar snippet=binding.expression.node;binding_props.push(p(_templateObject752||(_templateObject752=(0,_taggedTemplateLiteral2.default)([\"\",\": \",\"\"])),binding.name,snippet));binding_fns.push(p(_templateObject753||(_templateObject753=(0,_taggedTemplateLiteral2.default)([\"\",\": $$value => { \",\" = $$value; $$settled = false }\"])),binding.name,snippet));});var uses_spread=node.attributes.find(function(attr){return attr.is_spread;});var props;if(uses_spread){props=x(_templateObject754||(_templateObject754=(0,_taggedTemplateLiteral2.default)([\"@_Object.assign(\",\")\"])),node.attributes.map(function(attribute){if(attribute.is_spread){return attribute.expression.node;}else{return x(_templateObject755||(_templateObject755=(0,_taggedTemplateLiteral2.default)([\"{ \",\": \",\" }\"])),attribute.name,get_prop_value(attribute));}}).concat(binding_props.map(function(p){return x(_templateObject756||(_templateObject756=(0,_taggedTemplateLiteral2.default)([\"{ \",\" }\"])),p);})));}else{props=x(_templateObject757||(_templateObject757=(0,_taggedTemplateLiteral2.default)([\"{\\n\\t\\t\\t\",\",\\n\\t\\t\\t\",\"\\n\\t\\t}\"])),node.attributes.map(function(attribute){return p(_templateObject758||(_templateObject758=(0,_taggedTemplateLiteral2.default)([\"\",\": \",\"\"])),attribute.name,get_prop_value(attribute));}),binding_props);}var bindings=x(_templateObject759||(_templateObject759=(0,_taggedTemplateLiteral2.default)([\"{\\n\\t\\t\",\"\\n\\t}\"])),binding_fns);var expression=node.name==='svelte:self'?renderer.name:node.name==='svelte:component'?x(_templateObject760||(_templateObject760=(0,_taggedTemplateLiteral2.default)([\"(\",\") || @missing_component\"])),node.expression.node):node.name.split('.').reduce(function(lhs,rhs){return x(_templateObject761||(_templateObject761=(0,_taggedTemplateLiteral2.default)([\"\",\".\",\"\"])),lhs,rhs);});var slot_fns=[];var children=node.children;if(children.length){var slot_scopes=new Map();renderer.render(children,Object.assign({},options,{slot_scopes:slot_scopes}));slot_scopes.forEach(function(_ref27,name){var input=_ref27.input,output=_ref27.output,statements=_ref27.statements;slot_fns.push(p(_templateObject762||(_templateObject762=(0,_taggedTemplateLiteral2.default)([\"\",\": (\",\") => { \",\"; return \",\"; }\"])),name,input,statements,output));});}var slots=x(_templateObject763||(_templateObject763=(0,_taggedTemplateLiteral2.default)([\"{\\n\\t\\t\",\"\\n\\t}\"])),slot_fns);if(node.css_custom_properties.length>0){renderer.add_string('<div style=\"display: contents;');node.css_custom_properties.forEach(function(attr){renderer.add_string(\" \".concat(attr.name,\":\"));renderer.add_expression(get_attribute_value(attr));renderer.add_string(';');});renderer.add_string('\">');}renderer.add_expression(x(_templateObject764||(_templateObject764=(0,_taggedTemplateLiteral2.default)([\"@validate_component(\",\", \\\"\",\"\\\").$$render($$result, \",\", \",\", \",\")\"])),expression,node.name,props,bindings,slots));if(node.css_custom_properties.length>0){renderer.add_string('</div>');}}function KeyBlock$1(node,renderer,options){renderer.render(node.children,options);}function get_slot_scope(lets){if(lets.length===0)return null;return{type:'ObjectPattern',properties:lets.map(function(l){return{type:'Property',kind:'init',method:false,shorthand:false,computed:false,key:l.name,value:l.value||l.name};})};}function Slot$1(node,renderer,options){var slot_data=get_slot_data(node.values);var slot=node.get_static_attribute_value('slot');var nearest_inline_component=node.find_nearest(/InlineComponent/);if(slot&&nearest_inline_component){renderer.push();}renderer.push();renderer.render(node.children,options);var result=renderer.pop();renderer.add_expression(x(_templateObject765||(_templateObject765=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t#slots.\",\"\\n\\t\\t\\t? #slots.\",\"(\",\")\\n\\t\\t\\t: \",\"\\n\\t\"])),node.slot_name,node.slot_name,slot_data,result));if(slot&&nearest_inline_component){var lets=node.lets;var seen=new Set(lets.map(function(l){return l.name.name;}));nearest_inline_component.lets.forEach(function(l){if(!seen.has(l.name.name))lets.push(l);});options.slot_scopes.set(slot,{input:get_slot_scope(node.lets),output:renderer.pop()});}}function SlotTemplate$1(node,renderer,options){var parent_inline_component=node.parent;var children=remove_whitespace_children(node instanceof SlotTemplate?node.children:[node],node.next);renderer.push();renderer.render(children,options);var lets=node.lets;var seen=new Set(lets.map(function(l){return l.name.name;}));parent_inline_component.lets.forEach(function(l){if(!seen.has(l.name.name))lets.push(l);});var slot_fragment_content=renderer.pop();if(!is_empty_template_literal(slot_fragment_content)){if(options.slot_scopes.has(node.slot_template_name)){if(node.slot_template_name==='default'){throw new Error('Found elements without slot attribute when using slot=\"default\"');}throw new Error(\"Duplicate slot name \\\"\".concat(node.slot_template_name,\"\\\" in <\").concat(parent_inline_component.name,\">\"));}options.slot_scopes.set(node.slot_template_name,{input:get_slot_scope(node.lets),output:slot_fragment_content,statements:get_const_tags$1(node.const_tags)});}}function is_empty_template_literal(template_literal){return template_literal.expressions.length===0&&template_literal.quasis.length===1&&template_literal.quasis[0].value.raw==='';}function Tag$2(node,renderer,_options){var snippet=node.expression.node;renderer.add_expression(node.parent&&node.parent.type==='Element'&&node.parent.name==='style'?snippet:x(_templateObject766||(_templateObject766=(0,_taggedTemplateLiteral2.default)([\"@escape(\",\")\"])),snippet));}function Text$1(node,renderer,_options){var text=node.data;if(!node.parent||node.parent.type!=='Element'||node.parent.name!=='script'&&node.parent.name!=='style'){// unless this Text node is inside a <script> or <style> element, escape &,<,>\ntext=escape_html(text);}renderer.add_string(text);}function Title$1(node,renderer,options){renderer.push();renderer.add_string('<title>');renderer.render(node.children,options);renderer.add_string('</title>');var result=renderer.pop();renderer.add_expression(x(_templateObject767||(_templateObject767=(0,_taggedTemplateLiteral2.default)([\"$$result.title = \",\", \\\"\\\"\"])),result));}function noop$1(){}var handlers$1={AwaitBlock:AwaitBlock$1,Body:noop$1,Comment:Comment$2,DebugTag:DebugTag$1,EachBlock:EachBlock$1,Element:Element$1,Head:Head$1,IfBlock:IfBlock$1,InlineComponent:InlineComponent$1,KeyBlock:KeyBlock$1,MustacheTag:Tag$2,Options:noop$1,RawMustacheTag:HtmlTag,Slot:Slot$1,SlotTemplate:SlotTemplate$1,Text:Text$1,Title:Title$1,Window:noop$1};var Renderer$1=/*#__PURE__*/function(){function Renderer$1(_ref28){var name=_ref28.name;(0,_classCallCheck2.default)(this,Renderer$1);this.has_bindings=false;this.stack=[];this.targets=[];this.name=name;this.push();}(0,_createClass2.default)(Renderer$1,[{key:\"add_string\",value:function add_string(str){this.current.value+=escape_template(str);}},{key:\"add_expression\",value:function add_expression(node){this.literal.quasis.push({type:'TemplateElement',value:{raw:this.current.value,cooked:null},tail:false});this.literal.expressions.push(node);this.current.value='';}},{key:\"push\",value:function push(){var current=this.current={value:''};var literal=this.literal={type:'TemplateLiteral',expressions:[],quasis:[]};this.stack.push({current:current,literal:literal});}},{key:\"pop\",value:function pop(){this.literal.quasis.push({type:'TemplateElement',value:{raw:this.current.value,cooked:null},tail:true});var popped=this.stack.pop();var last=this.stack[this.stack.length-1];if(last){this.literal=last.literal;this.current=last.current;}return popped.literal;}},{key:\"render\",value:function render(nodes,options){var _this80=this;nodes.forEach(function(node){var handler=handlers$1[node.type];if(!handler){throw new Error(\"No handler for '\".concat(node.type,\"' nodes\"));}handler(node,_this80,options);});}}]);return Renderer$1;}();function ssr(component,options){var renderer=new Renderer$1({name:component.name});var name=component.name;// create $$render function\nrenderer.render(trim(component.fragment.children),Object.assign({locate:component.locate},options));// TODO put this inside the Renderer class\nvar literal=renderer.pop();// TODO concatenate CSS maps\nvar css=options.customElement?{code:null,map:null}:component.stylesheet.render(options.filename,true);var uses_rest=component.var_lookup.has('$$restProps');var props=component.vars.filter(function(variable){return!variable.module&&variable.export_name;});var rest=uses_rest?b(_templateObject768||(_templateObject768=(0,_taggedTemplateLiteral2.default)([\"let $$restProps = @compute_rest_props($$props, [\",\"]);\"])),props.map(function(prop){return\"\\\"\".concat(prop.export_name,\"\\\"\");}).join(',')):null;var uses_slots=component.var_lookup.has('$$slots');var slots=uses_slots?b(_templateObject769||(_templateObject769=(0,_taggedTemplateLiteral2.default)([\"let $$slots = @compute_slots(#slots);\"]))):null;var reactive_stores=component.vars.filter(function(variable){return variable.name[0]==='$'&&variable.name[1]!=='$';});var reactive_store_subscriptions=reactive_stores.filter(function(store){var variable=component.var_lookup.get(store.name.slice(1));return!variable||variable.hoistable;}).map(function(_ref29){var name=_ref29.name;var store_name=name.slice(1);return b(_templateObject770||(_templateObject770=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\",\" = @subscribe(\",\", #value => \",\" = #value)\\n\\t\\t\\t\"])),component.compile_options.dev&&b(_templateObject771||(_templateObject771=(0,_taggedTemplateLiteral2.default)([\"@validate_store(\",\", '\",\"');\"])),store_name,store_name),\"$$unsubscribe_\".concat(store_name),store_name,name);});var reactive_store_unsubscriptions=reactive_stores.map(function(_ref30){var name=_ref30.name;return b(_templateObject772||(_templateObject772=(0,_taggedTemplateLiteral2.default)([\"\",\"()\"])),\"$$unsubscribe_\".concat(name.slice(1)));});var reactive_store_declarations=reactive_stores.map(function(_ref31){var name=_ref31.name;var store_name=name.slice(1);var store=component.var_lookup.get(store_name);if(store&&store.reassigned){var unsubscribe=\"$$unsubscribe_\".concat(store_name);var subscribe=\"$$subscribe_\".concat(store_name);return b(_templateObject773||(_templateObject773=(0,_taggedTemplateLiteral2.default)([\"let \",\", \",\" = @noop, \",\" = () => (\",\"(), \",\" = @subscribe(\",\", $$value => \",\" = $$value), \",\")\"])),name,unsubscribe,subscribe,unsubscribe,unsubscribe,store_name,name,store_name);}return b(_templateObject774||(_templateObject774=(0,_taggedTemplateLiteral2.default)([\"let \",\", \",\";\"])),name,\"$$unsubscribe_\".concat(store_name));});// instrument get/set store value\nif(component.ast.instance){var _scope4=component.instance_scope;var map=component.instance_scope_map;walk(component.ast.instance.content,{enter:function enter(node){if(map.has(node)){_scope4=map.get(node);}},leave:function leave(node){if(map.has(node)){_scope4=_scope4.parent;}if(node.type==='AssignmentExpression'||node.type==='UpdateExpression'){var assignee=node.type==='AssignmentExpression'?node.left:node.argument;var _names3=new Set(extract_names(assignee));var to_invalidate=new Set();var _iterator13=_createForOfIteratorHelper(_names3),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var _name5=_step13.value;var variable=component.var_lookup.get(_name5);if(variable&&!variable.hoistable&&!variable.global&&!variable.module&&(variable.subscribable||variable.name[0]==='$')){to_invalidate.add(variable.name);}}}catch(err){_iterator13.e(err);}finally{_iterator13.f();}if(to_invalidate.size){this.replace(invalidate({component:component},_scope4,node,to_invalidate,true));}}}});}component.rewrite_props(function(_ref32){var name=_ref32.name,reassigned=_ref32.reassigned;var value=\"$\".concat(name);var insert=reassigned?b(_templateObject775||(_templateObject775=(0,_taggedTemplateLiteral2.default)([\"\",\"()\"])),\"$$subscribe_\".concat(name)):b(_templateObject776||(_templateObject776=(0,_taggedTemplateLiteral2.default)([\"\",\" = @subscribe(\",\", #value => $\",\" = #value)\"])),\"$$unsubscribe_\".concat(name),name,value);if(component.compile_options.dev){insert=b(_templateObject777||(_templateObject777=(0,_taggedTemplateLiteral2.default)([\"@validate_store(\",\", '\",\"'); \",\"\"])),name,name,insert);}return insert;});var instance_javascript=component.extract_javascript(component.ast.instance);// TODO only do this for props with a default value\nvar parent_bindings=instance_javascript?component.vars.filter(function(variable){return!variable.module&&variable.export_name;}).map(function(prop){return b(_templateObject778||(_templateObject778=(0,_taggedTemplateLiteral2.default)([\"if ($$props.\",\" === void 0 && $$bindings.\",\" && \",\" !== void 0) $$bindings.\",\"(\",\");\"])),prop.export_name,prop.export_name,prop.name,prop.export_name,prop.name);}):[];var injected=Array.from(component.injected_reactive_declaration_vars).filter(function(name){var variable=component.var_lookup.get(name);return variable.injected;});var reactive_declarations=component.reactive_declarations.map(function(d){var body=d.node.body;var statement=b(_templateObject779||(_templateObject779=(0,_taggedTemplateLiteral2.default)([\"\",\"\"])),body);if(!d.declaration){// TODO do not add label if it's not referenced\nstatement=b(_templateObject780||(_templateObject780=(0,_taggedTemplateLiteral2.default)([\"$: { \",\" }\"])),statement);}return statement;});var main=renderer.has_bindings?b(_templateObject781||(_templateObject781=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\tlet $$settled;\\n\\t\\t\\tlet $$rendered;\\n\\n\\t\\t\\tdo {\\n\\t\\t\\t\\t$$settled = true;\\n\\n\\t\\t\\t\\t\",\"\\n\\n\\t\\t\\t\\t$$rendered = \",\";\\n\\t\\t\\t} while (!$$settled);\\n\\n\\t\\t\\t\",\"\\n\\n\\t\\t\\treturn $$rendered;\\n\\t\\t\"])),reactive_declarations,literal,reactive_store_unsubscriptions):b(_templateObject782||(_templateObject782=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\",\"\\n\\n\\t\\t\\t\",\"\\n\\n\\t\\t\\treturn \",\";\"])),reactive_declarations,reactive_store_unsubscriptions,literal);var blocks=[].concat((0,_toConsumableArray2.default)(injected.map(function(name){return b(_templateObject783||(_templateObject783=(0,_taggedTemplateLiteral2.default)([\"let \",\";\"])),name);})),[rest,slots],(0,_toConsumableArray2.default)(reactive_store_declarations),(0,_toConsumableArray2.default)(reactive_store_subscriptions),[instance_javascript],(0,_toConsumableArray2.default)(parent_bindings),[css.code&&b(_templateObject784||(_templateObject784=(0,_taggedTemplateLiteral2.default)([\"$$result.css.add(#css);\"]))),main]).filter(Boolean);var css_sourcemap_enabled=check_enable_sourcemap(options.enableSourcemap,'css');var js=b(_templateObject785||(_templateObject785=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\",\"\\n\\n\\t\\t\",\"\\n\\n\\t\\t\",\"\\n\\n\\t\\tconst \",\" = @create_ssr_component(($$result, $$props, $$bindings, #slots) => {\\n\\t\\t\\t\",\"\\n\\t\\t});\\n\\t\"])),css.code?b(_templateObject786||(_templateObject786=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\tconst #css = {\\n\\t\\t\\tcode: \\\"\",\"\\\",\\n\\t\\t\\tmap: \",\"\\n\\t\\t};\"])),css.code,css_sourcemap_enabled&&css.map?string_literal(css.map.toString()):'null'):null,component.extract_javascript(component.ast.module),component.fully_hoisted,name,blocks);return{js:js,css:css};}function trim(nodes){var start=0;for(;start<nodes.length;start+=1){var _node10=nodes[start];if(_node10.type!=='Text')break;_node10.data=_node10.data.replace(/^\\s+/,'');if(_node10.data)break;}var end=nodes.length;for(;end>start;end-=1){var _node11=nodes[end-1];if(_node11.type!=='Text')break;_node11.data=_node11.data.replace(/\\s+$/,'');if(_node11.data)break;}return nodes.slice(start,end);}var wrappers$1={esm:esm,cjs:cjs};function create_module(program,format,name,banner){var sveltePath=arguments.length>4&&arguments[4]!==undefined?arguments[4]:'svelte';var helpers=arguments.length>5?arguments[5]:undefined;var globals=arguments.length>6?arguments[6]:undefined;var imports=arguments.length>7?arguments[7]:undefined;var module_exports=arguments.length>8?arguments[8]:undefined;var exports_from=arguments.length>9?arguments[9]:undefined;var internal_path=\"\".concat(sveltePath,\"/internal\");helpers.sort(function(a,b){return a.name<b.name?-1:1;});globals.sort(function(a,b){return a.name<b.name?-1:1;});var formatter=wrappers$1[format];if(!formatter){throw new Error(\"options.format is invalid (must be \".concat(list(Object.keys(wrappers$1)),\")\"));}return formatter(program,name,banner,sveltePath,internal_path,helpers,globals,imports,module_exports,exports_from);}function edit_source(source,sveltePath){return source==='svelte'||source.startsWith('svelte/')?source.replace('svelte',sveltePath):source;}function get_internal_globals(globals,helpers){return globals.length>0&&{type:'VariableDeclaration',kind:'const',declarations:[{type:'VariableDeclarator',id:{type:'ObjectPattern',properties:globals.map(function(g){return{type:'Property',method:false,shorthand:false,computed:false,key:{type:'Identifier',name:g.name},value:g.alias,kind:'init'};})},init:helpers.find(function(_ref33){var name=_ref33.name;return name==='globals';}).alias}]};}function esm(program,name,banner,sveltePath,internal_path,helpers,globals,imports,module_exports,exports_from){var import_declaration={type:'ImportDeclaration',specifiers:helpers.map(function(h){return{type:'ImportSpecifier',local:h.alias,imported:{type:'Identifier',name:h.name}};}),source:{type:'Literal',value:internal_path}};var internal_globals=get_internal_globals(globals,helpers);// edit user imports\nfunction rewrite_import(node){var value=edit_source(node.source.value,sveltePath);if(node.source.value!==value){node.source.value=value;node.source.raw=null;}}imports.forEach(rewrite_import);exports_from.forEach(rewrite_import);var exports=module_exports.length>0&&{type:'ExportNamedDeclaration',specifiers:module_exports.map(function(x){return{type:'Specifier',local:{type:'Identifier',name:x.name},exported:{type:'Identifier',name:x.as}};})};program.body=b(_templateObject787||(_templateObject787=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t/* \",\" */\\n\\n\\t\\t\",\"\\n\\t\\t\",\"\\n\\t\\t\",\"\\n\\t\\t\",\"\\n\\n\\t\\t\",\"\\n\\n\\t\\texport default \",\";\\n\\t\\t\",\"\\n\\t\"])),banner,import_declaration,internal_globals,imports,exports_from,program.body,name,exports);}function cjs(program,name,banner,sveltePath,internal_path,helpers,globals,imports,module_exports,exports_from){var internal_requires={type:'VariableDeclaration',kind:'const',declarations:[{type:'VariableDeclarator',id:{type:'ObjectPattern',properties:helpers.map(function(h){return{type:'Property',method:false,shorthand:false,computed:false,key:{type:'Identifier',name:h.name},value:h.alias,kind:'init'};})},init:x(_templateObject788||(_templateObject788=(0,_taggedTemplateLiteral2.default)([\"require(\\\"\",\"\\\")\"])),internal_path)}]};var internal_globals=get_internal_globals(globals,helpers);var user_requires=imports.map(function(node){var init=x(_templateObject789||(_templateObject789=(0,_taggedTemplateLiteral2.default)([\"require(\\\"\",\"\\\")\"])),edit_source(node.source.value,sveltePath));if(node.specifiers.length===0){return b(_templateObject790||(_templateObject790=(0,_taggedTemplateLiteral2.default)([\"\",\";\"])),init);}return{type:'VariableDeclaration',kind:'const',declarations:[{type:'VariableDeclarator',id:node.specifiers[0].type==='ImportNamespaceSpecifier'?{type:'Identifier',name:node.specifiers[0].local.name}:{type:'ObjectPattern',properties:node.specifiers.map(function(s){return{type:'Property',method:false,shorthand:false,computed:false,key:s.type==='ImportSpecifier'?s.imported:{type:'Identifier',name:'default'},value:s.local,kind:'init'};})},init:init}]};});var exports=module_exports.map(function(x){return b(_templateObject791||(_templateObject791=(0,_taggedTemplateLiteral2.default)([\"exports.\",\" = \",\";\"])),{type:'Identifier',name:x.as},{type:'Identifier',name:x.name});});var user_exports_from=exports_from.map(function(node){var init=x(_templateObject792||(_templateObject792=(0,_taggedTemplateLiteral2.default)([\"require(\\\"\",\"\\\")\"])),edit_source(node.source.value,sveltePath));return node.specifiers.map(function(specifier){return b(_templateObject793||(_templateObject793=(0,_taggedTemplateLiteral2.default)([\"exports.\",\" = \",\".\",\";\"])),specifier.exported,init,specifier.local);});});program.body=b(_templateObject794||(_templateObject794=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t/* \",\" */\\n\\n\\t\\t\\\"use strict\\\";\\n\\t\\t\",\"\\n\\t\\t\",\"\\n\\t\\t\",\"\\n\\t\\t\",\"\\n\\n\\t\\t\",\"\\n\\n\\t\\texports.default = \",\";\\n\\t\\t\",\"\\n\\t\"])),banner,internal_requires,internal_globals,user_requires,user_exports_from,program.body,name,exports);}var Chunk=function Chunk(start,end,content){this.start=start;this.end=end;this.original=content;this.intro='';this.outro='';this.content=content;this.storeName=false;this.edited=false;// we make these non-enumerable, for sanity while debugging\nObject.defineProperties(this,{previous:{writable:true,value:null},next:{writable:true,value:null}});};Chunk.prototype.appendLeft=function appendLeft(content){this.outro+=content;};Chunk.prototype.appendRight=function appendRight(content){this.intro=this.intro+content;};Chunk.prototype.clone=function clone(){var chunk=new Chunk(this.start,this.end,this.original);chunk.intro=this.intro;chunk.outro=this.outro;chunk.content=this.content;chunk.storeName=this.storeName;chunk.edited=this.edited;return chunk;};Chunk.prototype.contains=function contains(index){return this.start<index&&index<this.end;};Chunk.prototype.eachNext=function eachNext(fn){var chunk=this;while(chunk){fn(chunk);chunk=chunk.next;}};Chunk.prototype.eachPrevious=function eachPrevious(fn){var chunk=this;while(chunk){fn(chunk);chunk=chunk.previous;}};Chunk.prototype.edit=function edit(content,storeName,contentOnly){this.content=content;if(!contentOnly){this.intro='';this.outro='';}this.storeName=storeName;this.edited=true;return this;};Chunk.prototype.prependLeft=function prependLeft(content){this.outro=content+this.outro;};Chunk.prototype.prependRight=function prependRight(content){this.intro=content+this.intro;};Chunk.prototype.split=function split(index){var sliceIndex=index-this.start;var originalBefore=this.original.slice(0,sliceIndex);var originalAfter=this.original.slice(sliceIndex);this.original=originalBefore;var newChunk=new Chunk(index,this.end,originalAfter);newChunk.outro=this.outro;this.outro='';this.end=index;if(this.edited){// TODO is this block necessary?...\nnewChunk.edit('',false);this.content='';}else{this.content=originalBefore;}newChunk.next=this.next;if(newChunk.next){newChunk.next.previous=newChunk;}newChunk.previous=this;this.next=newChunk;return newChunk;};Chunk.prototype.toString=function toString(){return this.intro+this.content+this.outro;};Chunk.prototype.trimEnd=function trimEnd(rx){this.outro=this.outro.replace(rx,'');if(this.outro.length){return true;}var trimmed=this.content.replace(rx,'');if(trimmed.length){if(trimmed!==this.content){this.split(this.start+trimmed.length).edit('',undefined,true);}return true;}else{this.edit('',undefined,true);this.intro=this.intro.replace(rx,'');if(this.intro.length){return true;}}};Chunk.prototype.trimStart=function trimStart(rx){this.intro=this.intro.replace(rx,'');if(this.intro.length){return true;}var trimmed=this.content.replace(rx,'');if(trimmed.length){if(trimmed!==this.content){this.split(this.end-trimmed.length);this.edit('',undefined,true);}return true;}else{this.edit('',undefined,true);this.outro=this.outro.replace(rx,'');if(this.outro.length){return true;}}};var btoa$2=function btoa$2(){throw new Error('Unsupported environment: `window.btoa` or `Buffer` should be supported.');};if(typeof window!=='undefined'&&typeof window.btoa==='function'){btoa$2=function btoa$2(str){return window.btoa(unescape(encodeURIComponent(str)));};}else if(typeof Buffer==='function'){btoa$2=function btoa$2(str){return Buffer.from(str,'utf-8').toString('base64');};}var SourceMap$1=function SourceMap(properties){this.version=3;this.file=properties.file;this.sources=properties.sources;this.sourcesContent=properties.sourcesContent;this.names=properties.names;this.mappings=encode(properties.mappings);};SourceMap$1.prototype.toString=function toString(){return JSON.stringify(this);};SourceMap$1.prototype.toUrl=function toUrl(){return'data:application/json;charset=utf-8;base64,'+btoa$2(this.toString());};function guessIndent(code){var lines=code.split('\\n');var tabbed=lines.filter(function(line){return /^\\t+/.test(line);});var spaced=lines.filter(function(line){return /^ {2,}/.test(line);});if(tabbed.length===0&&spaced.length===0){return null;}// More lines tabbed than spaced? Assume tabs, and\n// default to tabs in the case of a tie (or nothing\n// to go on)\nif(tabbed.length>=spaced.length){return'\\t';}// Otherwise, we need to guess the multiple\nvar min=spaced.reduce(function(previous,current){var numSpaces=/^ +/.exec(current)[0].length;return Math.min(numSpaces,previous);},Infinity);return new Array(min+1).join(' ');}function getRelativePath(from,to){var fromParts=from.split(/[/\\\\]/);var toParts=to.split(/[/\\\\]/);fromParts.pop();// get dirname\nwhile(fromParts[0]===toParts[0]){fromParts.shift();toParts.shift();}if(fromParts.length){var i=fromParts.length;while(i--){fromParts[i]='..';}}return fromParts.concat(toParts).join('/');}var toString$1=Object.prototype.toString;function isObject(thing){return toString$1.call(thing)==='[object Object]';}function getLocator$1(source){var originalLines=source.split('\\n');var lineOffsets=[];for(var i=0,pos=0;i<originalLines.length;i++){lineOffsets.push(pos);pos+=originalLines[i].length+1;}return function locate(index){var i=0;var j=lineOffsets.length;while(i<j){var m=i+j>>1;if(index<lineOffsets[m]){j=m;}else{i=m+1;}}var line=i-1;var column=index-lineOffsets[line];return{line:line,column:column};};}var Mappings=function Mappings(hires){this.hires=hires;this.generatedCodeLine=0;this.generatedCodeColumn=0;this.raw=[];this.rawSegments=this.raw[this.generatedCodeLine]=[];this.pending=null;};Mappings.prototype.addEdit=function addEdit(sourceIndex,content,loc,nameIndex){if(content.length){var segment=[this.generatedCodeColumn,sourceIndex,loc.line,loc.column];if(nameIndex>=0){segment.push(nameIndex);}this.rawSegments.push(segment);}else if(this.pending){this.rawSegments.push(this.pending);}this.advance(content);this.pending=null;};Mappings.prototype.addUneditedChunk=function addUneditedChunk(sourceIndex,chunk,original,loc,sourcemapLocations){var originalCharIndex=chunk.start;var first=true;while(originalCharIndex<chunk.end){if(this.hires||first||sourcemapLocations[originalCharIndex]){this.rawSegments.push([this.generatedCodeColumn,sourceIndex,loc.line,loc.column]);}if(original[originalCharIndex]==='\\n'){loc.line+=1;loc.column=0;this.generatedCodeLine+=1;this.raw[this.generatedCodeLine]=this.rawSegments=[];this.generatedCodeColumn=0;}else{loc.column+=1;this.generatedCodeColumn+=1;}originalCharIndex+=1;first=false;}this.pending=[this.generatedCodeColumn,sourceIndex,loc.line,loc.column];};Mappings.prototype.advance=function advance(str){if(!str){return;}var lines=str.split('\\n');if(lines.length>1){for(var i=0;i<lines.length-1;i++){this.generatedCodeLine++;this.raw[this.generatedCodeLine]=this.rawSegments=[];}this.generatedCodeColumn=0;}this.generatedCodeColumn+=lines[lines.length-1].length;};var n='\\n';var warned={insertLeft:false,insertRight:false,storeName:false};var MagicString=function MagicString(string,options){if(options===void 0)options={};var chunk=new Chunk(0,string.length,string);Object.defineProperties(this,{original:{writable:true,value:string},outro:{writable:true,value:''},intro:{writable:true,value:''},firstChunk:{writable:true,value:chunk},lastChunk:{writable:true,value:chunk},lastSearchedChunk:{writable:true,value:chunk},byStart:{writable:true,value:{}},byEnd:{writable:true,value:{}},filename:{writable:true,value:options.filename},indentExclusionRanges:{writable:true,value:options.indentExclusionRanges},sourcemapLocations:{writable:true,value:{}},storedNames:{writable:true,value:{}},indentStr:{writable:true,value:guessIndent(string)}});this.byStart[0]=chunk;this.byEnd[string.length]=chunk;};MagicString.prototype.addSourcemapLocation=function addSourcemapLocation(char){this.sourcemapLocations[char]=true;};MagicString.prototype.append=function append(content){if(typeof content!=='string'){throw new TypeError('outro content must be a string');}this.outro+=content;return this;};MagicString.prototype.appendLeft=function appendLeft(index,content){if(typeof content!=='string'){throw new TypeError('inserted content must be a string');}this._split(index);var chunk=this.byEnd[index];if(chunk){chunk.appendLeft(content);}else{this.intro+=content;}return this;};MagicString.prototype.appendRight=function appendRight(index,content){if(typeof content!=='string'){throw new TypeError('inserted content must be a string');}this._split(index);var chunk=this.byStart[index];if(chunk){chunk.appendRight(content);}else{this.outro+=content;}return this;};MagicString.prototype.clone=function clone(){var cloned=new MagicString(this.original,{filename:this.filename});var originalChunk=this.firstChunk;var clonedChunk=cloned.firstChunk=cloned.lastSearchedChunk=originalChunk.clone();while(originalChunk){cloned.byStart[clonedChunk.start]=clonedChunk;cloned.byEnd[clonedChunk.end]=clonedChunk;var nextOriginalChunk=originalChunk.next;var nextClonedChunk=nextOriginalChunk&&nextOriginalChunk.clone();if(nextClonedChunk){clonedChunk.next=nextClonedChunk;nextClonedChunk.previous=clonedChunk;clonedChunk=nextClonedChunk;}originalChunk=nextOriginalChunk;}cloned.lastChunk=clonedChunk;if(this.indentExclusionRanges){cloned.indentExclusionRanges=this.indentExclusionRanges.slice();}Object.keys(this.sourcemapLocations).forEach(function(loc){cloned.sourcemapLocations[loc]=true;});return cloned;};MagicString.prototype.generateDecodedMap=function generateDecodedMap(options){var this$1=this;options=options||{};var sourceIndex=0;var names=Object.keys(this.storedNames);var mappings=new Mappings(options.hires);var locate=getLocator$1(this.original);if(this.intro){mappings.advance(this.intro);}this.firstChunk.eachNext(function(chunk){var loc=locate(chunk.start);if(chunk.intro.length){mappings.advance(chunk.intro);}if(chunk.edited){mappings.addEdit(sourceIndex,chunk.content,loc,chunk.storeName?names.indexOf(chunk.original):-1);}else{mappings.addUneditedChunk(sourceIndex,chunk,this$1.original,loc,this$1.sourcemapLocations);}if(chunk.outro.length){mappings.advance(chunk.outro);}});return{file:options.file?options.file.split(/[/\\\\]/).pop():null,sources:[options.source?getRelativePath(options.file||'',options.source):null],sourcesContent:options.includeContent?[this.original]:[null],names:names,mappings:mappings.raw};};MagicString.prototype.generateMap=function generateMap(options){return new SourceMap$1(this.generateDecodedMap(options));};MagicString.prototype.getIndentString=function getIndentString(){return this.indentStr===null?'\\t':this.indentStr;};MagicString.prototype.indent=function indent(indentStr,options){var pattern=/^[^\\r\\n]/gm;if(isObject(indentStr)){options=indentStr;indentStr=undefined;}indentStr=indentStr!==undefined?indentStr:this.indentStr||'\\t';if(indentStr===''){return this;}// noop\noptions=options||{};// Process exclusion ranges\nvar isExcluded={};if(options.exclude){var exclusions=typeof options.exclude[0]==='number'?[options.exclude]:options.exclude;exclusions.forEach(function(exclusion){for(var i=exclusion[0];i<exclusion[1];i+=1){isExcluded[i]=true;}});}var shouldIndentNextCharacter=options.indentStart!==false;var replacer=function replacer(match){if(shouldIndentNextCharacter){return\"\"+indentStr+match;}shouldIndentNextCharacter=true;return match;};this.intro=this.intro.replace(pattern,replacer);var charIndex=0;var chunk=this.firstChunk;while(chunk){var end=chunk.end;if(chunk.edited){if(!isExcluded[charIndex]){chunk.content=chunk.content.replace(pattern,replacer);if(chunk.content.length){shouldIndentNextCharacter=chunk.content[chunk.content.length-1]==='\\n';}}}else{charIndex=chunk.start;while(charIndex<end){if(!isExcluded[charIndex]){var char=this.original[charIndex];if(char==='\\n'){shouldIndentNextCharacter=true;}else if(char!=='\\r'&&shouldIndentNextCharacter){shouldIndentNextCharacter=false;if(charIndex===chunk.start){chunk.prependRight(indentStr);}else{this._splitChunk(chunk,charIndex);chunk=chunk.next;chunk.prependRight(indentStr);}}}charIndex+=1;}}charIndex=chunk.end;chunk=chunk.next;}this.outro=this.outro.replace(pattern,replacer);return this;};MagicString.prototype.insert=function insert(){throw new Error('magicString.insert(...) is deprecated. Use prependRight(...) or appendLeft(...)');};MagicString.prototype.insertLeft=function insertLeft(index,content){if(!warned.insertLeft){console.warn('magicString.insertLeft(...) is deprecated. Use magicString.appendLeft(...) instead');// eslint-disable-line no-console\nwarned.insertLeft=true;}return this.appendLeft(index,content);};MagicString.prototype.insertRight=function insertRight(index,content){if(!warned.insertRight){console.warn('magicString.insertRight(...) is deprecated. Use magicString.prependRight(...) instead');// eslint-disable-line no-console\nwarned.insertRight=true;}return this.prependRight(index,content);};MagicString.prototype.move=function move(start,end,index){if(index>=start&&index<=end){throw new Error('Cannot move a selection inside itself');}this._split(start);this._split(end);this._split(index);var first=this.byStart[start];var last=this.byEnd[end];var oldLeft=first.previous;var oldRight=last.next;var newRight=this.byStart[index];if(!newRight&&last===this.lastChunk){return this;}var newLeft=newRight?newRight.previous:this.lastChunk;if(oldLeft){oldLeft.next=oldRight;}if(oldRight){oldRight.previous=oldLeft;}if(newLeft){newLeft.next=first;}if(newRight){newRight.previous=last;}if(!first.previous){this.firstChunk=last.next;}if(!last.next){this.lastChunk=first.previous;this.lastChunk.next=null;}first.previous=newLeft;last.next=newRight||null;if(!newLeft){this.firstChunk=first;}if(!newRight){this.lastChunk=last;}return this;};MagicString.prototype.overwrite=function overwrite(start,end,content,options){if(typeof content!=='string'){throw new TypeError('replacement content must be a string');}while(start<0){start+=this.original.length;}while(end<0){end+=this.original.length;}if(end>this.original.length){throw new Error('end is out of bounds');}if(start===end){throw new Error('Cannot overwrite a zero-length range – use appendLeft or prependRight instead');}this._split(start);this._split(end);if(options===true){if(!warned.storeName){console.warn('The final argument to magicString.overwrite(...) should be an options object. See https://github.com/rich-harris/magic-string');// eslint-disable-line no-console\nwarned.storeName=true;}options={storeName:true};}var storeName=options!==undefined?options.storeName:false;var contentOnly=options!==undefined?options.contentOnly:false;if(storeName){var original=this.original.slice(start,end);this.storedNames[original]=true;}var first=this.byStart[start];var last=this.byEnd[end];if(first){if(end>first.end&&first.next!==this.byStart[first.end]){throw new Error('Cannot overwrite across a split point');}first.edit(content,storeName,contentOnly);if(first!==last){var chunk=first.next;while(chunk!==last){chunk.edit('',false);chunk=chunk.next;}chunk.edit('',false);}}else{// must be inserting at the end\nvar newChunk=new Chunk(start,end,'').edit(content,storeName);// TODO last chunk in the array may not be the last chunk, if it's moved...\nlast.next=newChunk;newChunk.previous=last;}return this;};MagicString.prototype.prepend=function prepend(content){if(typeof content!=='string'){throw new TypeError('outro content must be a string');}this.intro=content+this.intro;return this;};MagicString.prototype.prependLeft=function prependLeft(index,content){if(typeof content!=='string'){throw new TypeError('inserted content must be a string');}this._split(index);var chunk=this.byEnd[index];if(chunk){chunk.prependLeft(content);}else{this.intro=content+this.intro;}return this;};MagicString.prototype.prependRight=function prependRight(index,content){if(typeof content!=='string'){throw new TypeError('inserted content must be a string');}this._split(index);var chunk=this.byStart[index];if(chunk){chunk.prependRight(content);}else{this.outro=content+this.outro;}return this;};MagicString.prototype.remove=function remove(start,end){while(start<0){start+=this.original.length;}while(end<0){end+=this.original.length;}if(start===end){return this;}if(start<0||end>this.original.length){throw new Error('Character is out of bounds');}if(start>end){throw new Error('end must be greater than start');}this._split(start);this._split(end);var chunk=this.byStart[start];while(chunk){chunk.intro='';chunk.outro='';chunk.edit('');chunk=end>chunk.end?this.byStart[chunk.end]:null;}return this;};MagicString.prototype.lastChar=function lastChar(){if(this.outro.length){return this.outro[this.outro.length-1];}var chunk=this.lastChunk;do{if(chunk.outro.length){return chunk.outro[chunk.outro.length-1];}if(chunk.content.length){return chunk.content[chunk.content.length-1];}if(chunk.intro.length){return chunk.intro[chunk.intro.length-1];}}while(chunk=chunk.previous);if(this.intro.length){return this.intro[this.intro.length-1];}return'';};MagicString.prototype.lastLine=function lastLine(){var lineIndex=this.outro.lastIndexOf(n);if(lineIndex!==-1){return this.outro.substr(lineIndex+1);}var lineStr=this.outro;var chunk=this.lastChunk;do{if(chunk.outro.length>0){lineIndex=chunk.outro.lastIndexOf(n);if(lineIndex!==-1){return chunk.outro.substr(lineIndex+1)+lineStr;}lineStr=chunk.outro+lineStr;}if(chunk.content.length>0){lineIndex=chunk.content.lastIndexOf(n);if(lineIndex!==-1){return chunk.content.substr(lineIndex+1)+lineStr;}lineStr=chunk.content+lineStr;}if(chunk.intro.length>0){lineIndex=chunk.intro.lastIndexOf(n);if(lineIndex!==-1){return chunk.intro.substr(lineIndex+1)+lineStr;}lineStr=chunk.intro+lineStr;}}while(chunk=chunk.previous);lineIndex=this.intro.lastIndexOf(n);if(lineIndex!==-1){return this.intro.substr(lineIndex+1)+lineStr;}return this.intro+lineStr;};MagicString.prototype.slice=function slice(start,end){if(start===void 0)start=0;if(end===void 0)end=this.original.length;while(start<0){start+=this.original.length;}while(end<0){end+=this.original.length;}var result='';// find start chunk\nvar chunk=this.firstChunk;while(chunk&&(chunk.start>start||chunk.end<=start)){// found end chunk before start\nif(chunk.start<end&&chunk.end>=end){return result;}chunk=chunk.next;}if(chunk&&chunk.edited&&chunk.start!==start){throw new Error(\"Cannot use replaced character \"+start+\" as slice start anchor.\");}var startChunk=chunk;while(chunk){if(chunk.intro&&(startChunk!==chunk||chunk.start===start)){result+=chunk.intro;}var containsEnd=chunk.start<end&&chunk.end>=end;if(containsEnd&&chunk.edited&&chunk.end!==end){throw new Error(\"Cannot use replaced character \"+end+\" as slice end anchor.\");}var sliceStart=startChunk===chunk?start-chunk.start:0;var sliceEnd=containsEnd?chunk.content.length+end-chunk.end:chunk.content.length;result+=chunk.content.slice(sliceStart,sliceEnd);if(chunk.outro&&(!containsEnd||chunk.end===end)){result+=chunk.outro;}if(containsEnd){break;}chunk=chunk.next;}return result;};// TODO deprecate this? not really very useful\nMagicString.prototype.snip=function snip(start,end){var clone=this.clone();clone.remove(0,start);clone.remove(end,clone.original.length);return clone;};MagicString.prototype._split=function _split(index){if(this.byStart[index]||this.byEnd[index]){return;}var chunk=this.lastSearchedChunk;var searchForward=index>chunk.end;while(chunk){if(chunk.contains(index)){return this._splitChunk(chunk,index);}chunk=searchForward?this.byStart[chunk.end]:this.byEnd[chunk.start];}};MagicString.prototype._splitChunk=function _splitChunk(chunk,index){if(chunk.edited&&chunk.content.length){// zero-length edited chunks are a special case (overlapping replacements)\nvar loc=getLocator$1(this.original)(index);throw new Error(\"Cannot split a chunk that has already been edited (\"+loc.line+\":\"+loc.column+\" – \\\"\"+chunk.original+\"\\\")\");}var newChunk=chunk.split(index);this.byEnd[index]=chunk;this.byStart[index]=newChunk;this.byEnd[newChunk.end]=newChunk;if(chunk===this.lastChunk){this.lastChunk=newChunk;}this.lastSearchedChunk=chunk;return true;};MagicString.prototype.toString=function toString(){var str=this.intro;var chunk=this.firstChunk;while(chunk){str+=chunk.toString();chunk=chunk.next;}return str+this.outro;};MagicString.prototype.isEmpty=function isEmpty(){var chunk=this.firstChunk;do{if(chunk.intro.length&&chunk.intro.trim()||chunk.content.length&&chunk.content.trim()||chunk.outro.length&&chunk.outro.trim()){return false;}}while(chunk=chunk.next);return true;};MagicString.prototype.length=function length(){var chunk=this.firstChunk;var length=0;do{length+=chunk.intro.length+chunk.content.length+chunk.outro.length;}while(chunk=chunk.next);return length;};MagicString.prototype.trimLines=function trimLines(){return this.trim('[\\\\r\\\\n]');};MagicString.prototype.trim=function trim(charType){return this.trimStart(charType).trimEnd(charType);};MagicString.prototype.trimEndAborted=function trimEndAborted(charType){var rx=new RegExp((charType||'\\\\s')+'+$');this.outro=this.outro.replace(rx,'');if(this.outro.length){return true;}var chunk=this.lastChunk;do{var end=chunk.end;var aborted=chunk.trimEnd(rx);// if chunk was trimmed, we have a new lastChunk\nif(chunk.end!==end){if(this.lastChunk===chunk){this.lastChunk=chunk.next;}this.byEnd[chunk.end]=chunk;this.byStart[chunk.next.start]=chunk.next;this.byEnd[chunk.next.end]=chunk.next;}if(aborted){return true;}chunk=chunk.previous;}while(chunk);return false;};MagicString.prototype.trimEnd=function trimEnd(charType){this.trimEndAborted(charType);return this;};MagicString.prototype.trimStartAborted=function trimStartAborted(charType){var rx=new RegExp('^'+(charType||'\\\\s')+'+');this.intro=this.intro.replace(rx,'');if(this.intro.length){return true;}var chunk=this.firstChunk;do{var end=chunk.end;var aborted=chunk.trimStart(rx);if(chunk.end!==end){// special case...\nif(chunk===this.lastChunk){this.lastChunk=chunk.next;}this.byEnd[chunk.end]=chunk;this.byStart[chunk.next.start]=chunk.next;this.byEnd[chunk.next.end]=chunk.next;}if(aborted){return true;}chunk=chunk.next;}while(chunk);return false;};MagicString.prototype.trimStart=function trimStart(charType){this.trimStartAborted(charType);return this;};var UNKNOWN={};function gather_possible_values(node,set){if(node.type==='Literal'){set.add(node.value);}else if(node.type==='ConditionalExpression'){gather_possible_values(node.consequent,set);gather_possible_values(node.alternate,set);}else{set.add(UNKNOWN);}}var BlockAppliesToNode;(function(BlockAppliesToNode){BlockAppliesToNode[BlockAppliesToNode[\"NotPossible\"]=0]=\"NotPossible\";BlockAppliesToNode[BlockAppliesToNode[\"Possible\"]=1]=\"Possible\";BlockAppliesToNode[BlockAppliesToNode[\"UnknownSelectorType\"]=2]=\"UnknownSelectorType\";})(BlockAppliesToNode||(BlockAppliesToNode={}));var NodeExist;(function(NodeExist){NodeExist[NodeExist[\"Probably\"]=1]=\"Probably\";NodeExist[NodeExist[\"Definitely\"]=2]=\"Definitely\";})(NodeExist||(NodeExist={}));var whitelist_attribute_selector=new Map([['details',new Set(['open'])]]);var Selector$1=/*#__PURE__*/function(){function Selector$1(node,stylesheet){(0,_classCallCheck2.default)(this,Selector$1);this.node=node;this.stylesheet=stylesheet;this.blocks=group_selectors(node);// take trailing :global(...) selectors out of consideration\nvar i=this.blocks.length;while(i>0){if(!this.blocks[i-1].global)break;i-=1;}this.local_blocks=this.blocks.slice(0,i);var host_only=this.blocks.length===1&&this.blocks[0].host;var root_only=this.blocks.length===1&&this.blocks[0].root;this.used=this.local_blocks.length===0||host_only||root_only;}(0,_createClass2.default)(Selector$1,[{key:\"apply\",value:function apply(node){var _this81=this;var to_encapsulate=[];apply_selector(this.local_blocks.slice(),node,to_encapsulate);if(to_encapsulate.length>0){to_encapsulate.forEach(function(_ref34){var node=_ref34.node,block=_ref34.block;_this81.stylesheet.nodes_with_css_class.add(node);block.should_encapsulate=true;});this.used=true;}}},{key:\"minify\",value:function minify(code){var c=null;this.blocks.forEach(function(block,i){if(i>0){if(block.start-c>1){code.overwrite(c,block.start,block.combinator.name||' ');}}c=block.end;});}},{key:\"transform\",value:function transform(code,attr,max_amount_class_specificity_increased){var _this82=this;var amount_class_specificity_to_increase=max_amount_class_specificity_increased-this.blocks.filter(function(block){return block.should_encapsulate;}).length;function remove_global_pseudo_class(selector){var first=selector.children[0];var last=selector.children[selector.children.length-1];code.remove(selector.start,first.start).remove(last.end,selector.end);}function encapsulate_block(block,attr){var _iterator14=_createForOfIteratorHelper(block.selectors),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var _selector2=_step14.value;if(_selector2.type==='PseudoClassSelector'&&_selector2.name==='global'){remove_global_pseudo_class(_selector2);}}}catch(err){_iterator14.e(err);}finally{_iterator14.f();}var i=block.selectors.length;while(i--){var _selector=block.selectors[i];if(_selector.type==='PseudoElementSelector'||_selector.type==='PseudoClassSelector'){if(_selector.name!=='root'&&_selector.name!=='host'){if(i===0)code.prependRight(_selector.start,attr);}continue;}if(_selector.type==='TypeSelector'&&_selector.name==='*'){code.overwrite(_selector.start,_selector.end,attr);}else{code.appendLeft(_selector.end,attr);}break;}}this.blocks.forEach(function(block,index){if(block.global){remove_global_pseudo_class(block.selectors[0]);}if(block.should_encapsulate)encapsulate_block(block,index===_this82.blocks.length-1?attr.repeat(amount_class_specificity_to_increase+1):attr);});}},{key:\"validate\",value:function validate(component){var start=0;var end=this.blocks.length;for(;start<end;start+=1){if(!this.blocks[start].global)break;}for(;end>start;end-=1){if(!this.blocks[end-1].global)break;}for(var _i50=start;_i50<end;_i50+=1){if(this.blocks[_i50].global){return component.error(this.blocks[_i50].selectors[0],compiler_errors.css_invalid_global);}}this.validate_global_with_multiple_selectors(component);}},{key:\"validate_global_with_multiple_selectors\",value:function validate_global_with_multiple_selectors(component){if(this.blocks.length===1&&this.blocks[0].selectors.length===1){// standalone :global() with multiple selectors is OK\nreturn;}var _iterator15=_createForOfIteratorHelper(this.blocks),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var block=_step15.value;var _iterator16=_createForOfIteratorHelper(block.selectors),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var _selector3=_step16.value;if(_selector3.type==='PseudoClassSelector'&&_selector3.name==='global'){if(/[^\\\\],(?!([^([]+[^\\\\]|[^([\\\\])[)\\]])/.test(_selector3.children[0].value)){component.error(_selector3,compiler_errors.css_invalid_global_selector);}}}}catch(err){_iterator16.e(err);}finally{_iterator16.f();}}}catch(err){_iterator15.e(err);}finally{_iterator15.f();}}},{key:\"get_amount_class_specificity_increased\",value:function get_amount_class_specificity_increased(){var count=0;var _iterator17=_createForOfIteratorHelper(this.blocks),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var block=_step17.value;if(block.should_encapsulate){count++;}}}catch(err){_iterator17.e(err);}finally{_iterator17.f();}return count;}}]);return Selector$1;}();function apply_selector(blocks,node,to_encapsulate){var block=blocks.pop();if(!block)return false;if(!node){return block.global&&blocks.every(function(block){return block.global;})||block.host&&blocks.length===0;}switch(block_might_apply_to_node(block,node)){case BlockAppliesToNode.NotPossible:return false;case BlockAppliesToNode.UnknownSelectorType:// bail. TODO figure out what these could be\nto_encapsulate.push({node:node,block:block});return true;}if(block.combinator){if(block.combinator.type==='WhiteSpace'){var _iterator18=_createForOfIteratorHelper(blocks),_step18;try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var ancestor_block=_step18.value;if(ancestor_block.global){continue;}if(ancestor_block.host){to_encapsulate.push({node:node,block:block});return true;}var parent=node;while(parent=get_element_parent(parent)){if(block_might_apply_to_node(ancestor_block,parent)!==BlockAppliesToNode.NotPossible){to_encapsulate.push({node:parent,block:ancestor_block});}}if(to_encapsulate.length){to_encapsulate.push({node:node,block:block});return true;}}}catch(err){_iterator18.e(err);}finally{_iterator18.f();}if(blocks.every(function(block){return block.global;})){to_encapsulate.push({node:node,block:block});return true;}return false;}else if(block.combinator.name==='>'){var has_global_parent=blocks.every(function(block){return block.global;});if(has_global_parent||apply_selector(blocks,get_element_parent(node),to_encapsulate)){to_encapsulate.push({node:node,block:block});return true;}return false;}else if(block.combinator.name==='+'||block.combinator.name==='~'){var siblings=get_possible_element_siblings(node,block.combinator.name==='+');var has_match=false;// NOTE: if we have :global(), we couldn't figure out what is selected within `:global` due to the\n// css-tree limitation that does not parse the inner selector of :global\n// so unless we are sure there will be no sibling to match, we will consider it as matched\nvar has_global=blocks.some(function(block){return block.global;});if(has_global){if(siblings.size===0&&get_element_parent(node)!==null){return false;}to_encapsulate.push({node:node,block:block});return true;}var _iterator19=_createForOfIteratorHelper(siblings.keys()),_step19;try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var possible_sibling=_step19.value;if(apply_selector(blocks.slice(),possible_sibling,to_encapsulate)){to_encapsulate.push({node:node,block:block});has_match=true;}}}catch(err){_iterator19.e(err);}finally{_iterator19.f();}return has_match;}// TODO other combinators\nto_encapsulate.push({node:node,block:block});return true;}to_encapsulate.push({node:node,block:block});return true;}function block_might_apply_to_node(block,node){var i=block.selectors.length;var _loop=function _loop(){var selector=block.selectors[i];var name=typeof selector.name==='string'&&selector.name.replace(/\\\\(.)/g,'$1');if(selector.type==='PseudoClassSelector'&&(name==='host'||name==='root')){return{v:BlockAppliesToNode.NotPossible};}if(block.selectors.length===1&&selector.type==='PseudoClassSelector'&&name==='global'){return{v:BlockAppliesToNode.NotPossible};}if(selector.type==='PseudoClassSelector'||selector.type==='PseudoElementSelector'){return\"continue\";}if(selector.type==='ClassSelector'){if(!attribute_matches(node,'class',name,'~=',false)&&!node.classes.some(function(c){return c.name===name;}))return{v:BlockAppliesToNode.NotPossible};}else if(selector.type==='IdSelector'){if(!attribute_matches(node,'id',name,'=',false))return{v:BlockAppliesToNode.NotPossible};}else if(selector.type==='AttributeSelector'){if(!(whitelist_attribute_selector.has(node.name.toLowerCase())&&whitelist_attribute_selector.get(node.name.toLowerCase()).has(selector.name.name.toLowerCase()))&&!attribute_matches(node,selector.name.name,selector.value&&unquote(selector.value),selector.matcher,selector.flags)){return{v:BlockAppliesToNode.NotPossible};}}else if(selector.type==='TypeSelector'){if(node.name.toLowerCase()!==name.toLowerCase()&&name!=='*')return{v:BlockAppliesToNode.NotPossible};}else{return{v:BlockAppliesToNode.UnknownSelectorType};}};while(i--){var _ret=_loop();if(_ret===\"continue\")continue;if((0,_typeof2.default)(_ret)===\"object\")return _ret.v;}return BlockAppliesToNode.Possible;}function test_attribute(operator,expected_value,case_insensitive,value){if(case_insensitive){expected_value=expected_value.toLowerCase();value=value.toLowerCase();}switch(operator){case'=':return value===expected_value;case'~=':return value.split(/\\s/).includes(expected_value);case'|=':return\"\".concat(value,\"-\").startsWith(\"\".concat(expected_value,\"-\"));case'^=':return value.startsWith(expected_value);case'$=':return value.endsWith(expected_value);case'*=':return value.includes(expected_value);default:throw new Error(\"this shouldn't happen\");}}function attribute_matches(node,name,expected_value,operator,case_insensitive){var spread=node.attributes.find(function(attr){return attr.type==='Spread';});if(spread)return true;if(node.bindings.some(function(binding){return binding.name===name;}))return true;var attr=node.attributes.find(function(attr){return attr.name===name;});if(!attr)return false;if(attr.is_true)return operator===null;if(!expected_value)return true;if(attr.chunks.length===1){var _value16=attr.chunks[0];if(!_value16)return false;if(_value16.type==='Text')return test_attribute(operator,expected_value,case_insensitive,_value16.data);}var possible_values=new Set();var prev_values=[];var _iterator20=_createForOfIteratorHelper(attr.chunks),_step20;try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var chunk=_step20.value;var current_possible_values=new Set();if(chunk.type==='Text'){current_possible_values.add(chunk.data);}else{gather_possible_values(chunk.node,current_possible_values);}// impossible to find out all combinations\nif(current_possible_values.has(UNKNOWN))return true;if(prev_values.length>0){var _ret2=function(){var start_with_space=[];var remaining=[];current_possible_values.forEach(function(current_possible_value){if(/^\\s/.test(current_possible_value)){start_with_space.push(current_possible_value);}else{remaining.push(current_possible_value);}});if(remaining.length>0){if(start_with_space.length>0){prev_values.forEach(function(prev_value){return possible_values.add(prev_value);});}var combined=[];prev_values.forEach(function(prev_value){remaining.forEach(function(value){combined.push(prev_value+value);});});prev_values=combined;start_with_space.forEach(function(value){if(/\\s$/.test(value)){possible_values.add(value);}else{prev_values.push(value);}});return\"continue\";}else{prev_values.forEach(function(prev_value){return possible_values.add(prev_value);});prev_values=[];}}();if(_ret2===\"continue\")continue;}current_possible_values.forEach(function(current_possible_value){if(/\\s$/.test(current_possible_value)){possible_values.add(current_possible_value);}else{prev_values.push(current_possible_value);}});if(prev_values.length<current_possible_values.size){prev_values.push(' ');}if(prev_values.length>20){// might grow exponentially, bail out\nreturn true;}}}catch(err){_iterator20.e(err);}finally{_iterator20.f();}prev_values.forEach(function(prev_value){return possible_values.add(prev_value);});if(possible_values.has(UNKNOWN))return true;var _iterator21=_createForOfIteratorHelper(possible_values),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var _value17=_step21.value;if(test_attribute(operator,expected_value,case_insensitive,_value17))return true;}}catch(err){_iterator21.e(err);}finally{_iterator21.f();}return false;}function unquote(value){if(value.type==='Identifier')return value.name;var str=value.value;if(str[0]===str[str.length-1]&&str[0]===\"'\"||str[0]==='\"'){return str.slice(1,str.length-1);}return str;}function get_element_parent(node){var parent=node;while((parent=parent.parent)&&parent.type!=='Element'){;}return parent;}function get_possible_element_siblings(node,adjacent_only){var result=new Map();var prev=node;while(prev=prev.prev){if(prev.type==='Element'){if(!prev.attributes.find(function(attr){return attr.type==='Attribute'&&attr.name.toLowerCase()==='slot';})){result.set(prev,NodeExist.Definitely);}if(adjacent_only){break;}}else if(prev.type==='EachBlock'||prev.type==='IfBlock'||prev.type==='AwaitBlock'){var possible_last_child=get_possible_last_child(prev,adjacent_only);add_to_map(possible_last_child,result);if(adjacent_only&&has_definite_elements(possible_last_child)){return result;}}}if(!prev||!adjacent_only){var parent=node;var skip_each_for_last_child=node.type==='ElseBlock';while((parent=parent.parent)&&(parent.type==='EachBlock'||parent.type==='IfBlock'||parent.type==='ElseBlock'||parent.type==='AwaitBlock')){var possible_siblings=get_possible_element_siblings(parent,adjacent_only);add_to_map(possible_siblings,result);if(parent.type==='EachBlock'){// first child of each block can select the last child of each block as previous sibling\nif(skip_each_for_last_child){skip_each_for_last_child=false;}else{add_to_map(get_possible_last_child(parent,adjacent_only),result);}}else if(parent.type==='ElseBlock'){skip_each_for_last_child=true;parent=parent.parent;}if(adjacent_only&&has_definite_elements(possible_siblings)){break;}}}return result;}function get_possible_last_child(block,adjacent_only){var result=new Map();if(block.type==='EachBlock'){var each_result=loop_child(block.children,adjacent_only);var else_result=block.else?loop_child(block.else.children,adjacent_only):new Map();var not_exhaustive=!has_definite_elements(else_result);if(not_exhaustive){mark_as_probably(each_result);mark_as_probably(else_result);}add_to_map(each_result,result);add_to_map(else_result,result);}else if(block.type==='IfBlock'){var if_result=loop_child(block.children,adjacent_only);var _else_result=block.else?loop_child(block.else.children,adjacent_only):new Map();var _not_exhaustive=!has_definite_elements(if_result)||!has_definite_elements(_else_result);if(_not_exhaustive){mark_as_probably(if_result);mark_as_probably(_else_result);}add_to_map(if_result,result);add_to_map(_else_result,result);}else if(block.type==='AwaitBlock'){var pending_result=block.pending?loop_child(block.pending.children,adjacent_only):new Map();var then_result=block.then?loop_child(block.then.children,adjacent_only):new Map();var catch_result=block.catch?loop_child(block.catch.children,adjacent_only):new Map();var _not_exhaustive2=!has_definite_elements(pending_result)||!has_definite_elements(then_result)||!has_definite_elements(catch_result);if(_not_exhaustive2){mark_as_probably(pending_result);mark_as_probably(then_result);mark_as_probably(catch_result);}add_to_map(pending_result,result);add_to_map(then_result,result);add_to_map(catch_result,result);}return result;}function has_definite_elements(result){if(result.size===0)return false;var _iterator22=_createForOfIteratorHelper(result.values()),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var exist=_step22.value;if(exist===NodeExist.Definitely){return true;}}}catch(err){_iterator22.e(err);}finally{_iterator22.f();}return false;}function add_to_map(from,to){from.forEach(function(exist,element){to.set(element,higher_existence(exist,to.get(element)));});}function higher_existence(exist1,exist2){if(exist1===undefined||exist2===undefined)return exist1||exist2;return exist1>exist2?exist1:exist2;}function mark_as_probably(result){var _iterator23=_createForOfIteratorHelper(result.keys()),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var key=_step23.value;result.set(key,NodeExist.Probably);}}catch(err){_iterator23.e(err);}finally{_iterator23.f();}}function loop_child(children,adjacent_only){var result=new Map();for(var _i51=children.length-1;_i51>=0;_i51--){var child=children[_i51];if(child.type==='Element'){result.set(child,NodeExist.Definitely);if(adjacent_only){break;}}else if(child.type==='EachBlock'||child.type==='IfBlock'||child.type==='AwaitBlock'){var child_result=get_possible_last_child(child,adjacent_only);add_to_map(child_result,result);if(adjacent_only&&has_definite_elements(child_result)){break;}}}return result;}var Block$2=/*#__PURE__*/function(){function Block$2(combinator){(0,_classCallCheck2.default)(this,Block$2);this.combinator=combinator;this.host=false;this.root=false;this.selectors=[];this.start=null;this.end=null;this.should_encapsulate=false;}(0,_createClass2.default)(Block$2,[{key:\"add\",value:function add(selector){if(this.selectors.length===0){this.start=selector.start;this.host=selector.type==='PseudoClassSelector'&&selector.name==='host';}this.root=this.root||selector.type==='PseudoClassSelector'&&selector.name==='root';this.selectors.push(selector);this.end=selector.end;}},{key:\"global\",get:function get(){return this.selectors.length>=1&&this.selectors[0].type==='PseudoClassSelector'&&this.selectors[0].name==='global'&&this.selectors.every(function(selector){return selector.type==='PseudoClassSelector'||selector.type==='PseudoElementSelector';});}}]);return Block$2;}();function group_selectors(selector){var block=new Block$2(null);var blocks=[block];selector.children.forEach(function(child){if(child.type==='WhiteSpace'||child.type==='Combinator'){block=new Block$2(child);blocks.push(block);}else{block.add(child);}});return blocks;}function remove_css_prefix(name){return name.replace(/^-((webkit)|(moz)|(o)|(ms))-/,'');}var is_keyframes_node=function is_keyframes_node(node){return remove_css_prefix(node.name)==='keyframes';};var at_rule_has_declaration=function at_rule_has_declaration(_ref35){var block=_ref35.block;return block&&block.children&&block.children.find(function(node){return node.type==='Declaration';});};function minify_declarations(code,start,declarations){var c=start;declarations.forEach(function(declaration,i){var separator=i>0?';':'';if(declaration.node.start-c>separator.length){code.overwrite(c,declaration.node.start,separator);}declaration.minify(code);c=declaration.node.end;});return c;}var Rule$1=/*#__PURE__*/function(){function Rule$1(node,stylesheet,parent){(0,_classCallCheck2.default)(this,Rule$1);this.node=node;this.parent=parent;this.selectors=node.prelude.children.map(function(node){return new Selector$1(node,stylesheet);});this.declarations=node.block.children.map(function(node){return new Declaration$1(node);});}(0,_createClass2.default)(Rule$1,[{key:\"apply\",value:function apply(node){this.selectors.forEach(function(selector){return selector.apply(node);});// TODO move the logic in here?\n}},{key:\"is_used\",value:function is_used(dev){if(this.parent&&this.parent.node.type==='Atrule'&&is_keyframes_node(this.parent.node))return true;if(this.declarations.length===0)return dev;return this.selectors.some(function(s){return s.used;});}},{key:\"minify\",value:function minify(code,_dev){var c=this.node.start;var started=false;this.selectors.forEach(function(selector){if(selector.used){var separator=started?',':'';if(selector.node.start-c>separator.length){code.overwrite(c,selector.node.start,separator);}selector.minify(code);c=selector.node.end;started=true;}});code.remove(c,this.node.block.start);c=this.node.block.start+1;c=minify_declarations(code,c,this.declarations);code.remove(c,this.node.block.end-1);}},{key:\"transform\",value:function transform(code,id,keyframes,max_amount_class_specificity_increased){if(this.parent&&this.parent.node.type==='Atrule'&&is_keyframes_node(this.parent.node))return true;var attr=\".\".concat(id);this.selectors.forEach(function(selector){return selector.transform(code,attr,max_amount_class_specificity_increased);});this.declarations.forEach(function(declaration){return declaration.transform(code,keyframes);});}},{key:\"validate\",value:function validate(component){this.selectors.forEach(function(selector){selector.validate(component);});}},{key:\"warn_on_unused_selector\",value:function warn_on_unused_selector(handler){this.selectors.forEach(function(selector){if(!selector.used)handler(selector);});}},{key:\"get_max_amount_class_specificity_increased\",value:function get_max_amount_class_specificity_increased(){return Math.max.apply(Math,(0,_toConsumableArray2.default)(this.selectors.map(function(selector){return selector.get_amount_class_specificity_increased();})));}}]);return Rule$1;}();var Declaration$1=/*#__PURE__*/function(){function Declaration$1(node){(0,_classCallCheck2.default)(this,Declaration$1);this.node=node;}(0,_createClass2.default)(Declaration$1,[{key:\"transform\",value:function transform(code,keyframes){var property=this.node.property&&remove_css_prefix(this.node.property.toLowerCase());if(property==='animation'||property==='animation-name'){this.node.value.children.forEach(function(block){if(block.type==='Identifier'){var name=block.name;if(keyframes.has(name)){code.overwrite(block.start,block.end,keyframes.get(name));}}});}}},{key:\"minify\",value:function minify(code){if(!this.node.property)return;// @apply, and possibly other weird cases?\nvar c=this.node.start+this.node.property.length;var first=this.node.value.children?this.node.value.children[0]:this.node.value;var start=first.start;while(/\\s/.test(code.original[start])){start+=1;}if(start-c>1){code.overwrite(c,start,':');}}}]);return Declaration$1;}();var Atrule$1=/*#__PURE__*/function(){function Atrule$1(node){(0,_classCallCheck2.default)(this,Atrule$1);this.node=node;this.children=[];this.declarations=[];}(0,_createClass2.default)(Atrule$1,[{key:\"apply\",value:function apply(node){if(this.node.name==='media'||this.node.name==='supports'){this.children.forEach(function(child){child.apply(node);});}else if(is_keyframes_node(this.node)){this.children.forEach(function(rule){rule.selectors.forEach(function(selector){selector.used=true;});});}}},{key:\"is_used\",value:function is_used(_dev){return true;// TODO\n}},{key:\"minify\",value:function minify(code,dev){if(this.node.name==='media'){var expression_char=code.original[this.node.prelude.start];var _c2=this.node.start+(expression_char==='('?6:7);if(this.node.prelude.start>_c2)code.remove(_c2,this.node.prelude.start);this.node.prelude.children.forEach(function(query){// TODO minify queries\n_c2=query.end;});code.remove(_c2,this.node.block.start);}else if(this.node.name==='supports'){var _c3=this.node.start+9;if(this.node.prelude.start-_c3>1)code.overwrite(_c3,this.node.prelude.start,' ');this.node.prelude.children.forEach(function(query){// TODO minify queries\n_c3=query.end;});code.remove(_c3,this.node.block.start);}else{var _c4=this.node.start+this.node.name.length+1;if(this.node.prelude){if(this.node.prelude.start-_c4>1)code.overwrite(_c4,this.node.prelude.start,' ');_c4=this.node.prelude.end;}if(this.node.block&&this.node.block.start-_c4>0){code.remove(_c4,this.node.block.start);}}// TODO other atrules\nif(this.node.block){var _c5=this.node.block.start+1;if(this.declarations.length){_c5=minify_declarations(code,_c5,this.declarations);// if the atrule has children, leave the last declaration semicolon alone\nif(this.children.length)_c5++;}this.children.forEach(function(child){if(child.is_used(dev)){code.remove(_c5,child.node.start);child.minify(code,dev);_c5=child.node.end;}});code.remove(_c5,this.node.block.end-1);}}},{key:\"transform\",value:function transform(code,id,keyframes,max_amount_class_specificity_increased){var _this83=this;if(is_keyframes_node(this.node)){this.node.prelude.children.forEach(function(_ref36){var type=_ref36.type,name=_ref36.name,start=_ref36.start,end=_ref36.end;if(type==='Identifier'){if(name.startsWith('-global-')){code.remove(start,start+8);_this83.children.forEach(function(rule){rule.selectors.forEach(function(selector){selector.used=true;});});}else{code.overwrite(start,end,keyframes.get(name));}}});}this.children.forEach(function(child){child.transform(code,id,keyframes,max_amount_class_specificity_increased);});}},{key:\"validate\",value:function validate(component){this.children.forEach(function(child){child.validate(component);});}},{key:\"warn_on_unused_selector\",value:function warn_on_unused_selector(handler){if(this.node.name!=='media')return;this.children.forEach(function(child){child.warn_on_unused_selector(handler);});}},{key:\"get_max_amount_class_specificity_increased\",value:function get_max_amount_class_specificity_increased(){return Math.max.apply(Math,(0,_toConsumableArray2.default)(this.children.map(function(rule){return rule.get_max_amount_class_specificity_increased();})));}}]);return Atrule$1;}();var get_default_css_hash=function get_default_css_hash(_ref37){var css=_ref37.css,hash=_ref37.hash;return\"svelte-\".concat(hash(css));};var Stylesheet=/*#__PURE__*/function(){function Stylesheet(_ref38){var _this84=this;var source=_ref38.source,ast=_ref38.ast,component_name=_ref38.component_name,filename=_ref38.filename,dev=_ref38.dev,_ref38$get_css_hash=_ref38.get_css_hash,get_css_hash=_ref38$get_css_hash===void 0?get_default_css_hash:_ref38$get_css_hash;(0,_classCallCheck2.default)(this,Stylesheet);this.children=[];this.keyframes=new Map();this.nodes_with_css_class=new Set();this.source=source;this.ast=ast;this.filename=filename;this.dev=dev;if(ast.css&&ast.css.children.length){this.id=get_css_hash({filename:filename,name:component_name,css:ast.css.content.styles,hash:hash});this.has_styles=true;var stack=[];var depth=0;var current_atrule=null;walk(ast.css,{enter:function enter(node){if(node.type==='Atrule'){var _atrule=new Atrule$1(node);stack.push(_atrule);if(current_atrule){current_atrule.children.push(_atrule);}else if(depth<=1){_this84.children.push(_atrule);}if(is_keyframes_node(node)){node.prelude.children.forEach(function(expression){if(expression.type==='Identifier'&&!expression.name.startsWith('-global-')){_this84.keyframes.set(expression.name,\"\".concat(_this84.id,\"-\").concat(expression.name));}});}else if(at_rule_has_declaration(node)){var _atrule$declarations;var at_rule_declarations=node.block.children.filter(function(node){return node.type==='Declaration';}).map(function(node){return new Declaration$1(node);});(_atrule$declarations=_atrule.declarations).push.apply(_atrule$declarations,(0,_toConsumableArray2.default)(at_rule_declarations));}current_atrule=_atrule;}if(node.type==='Rule'){var rule=new Rule$1(node,_this84,current_atrule);if(current_atrule){current_atrule.children.push(rule);}else if(depth<=1){_this84.children.push(rule);}}depth+=1;},leave:function leave(node){if(node.type==='Atrule'){stack.pop();current_atrule=stack[stack.length-1];}depth-=1;}});}else{this.has_styles=false;}}(0,_createClass2.default)(Stylesheet,[{key:\"apply\",value:function apply(node){if(!this.has_styles)return;for(var _i52=0;_i52<this.children.length;_i52+=1){var child=this.children[_i52];child.apply(node);}}},{key:\"reify\",value:function reify(){this.nodes_with_css_class.forEach(function(node){node.add_css_class();});}},{key:\"render\",value:function render(file,should_transform_selectors){var _this85=this;if(!this.has_styles){return{code:null,map:null};}var code=new MagicString(this.source);walk(this.ast.css,{enter:function enter(node){code.addSourcemapLocation(node.start);code.addSourcemapLocation(node.end);}});if(should_transform_selectors){var max=Math.max.apply(Math,(0,_toConsumableArray2.default)(this.children.map(function(rule){return rule.get_max_amount_class_specificity_increased();})));this.children.forEach(function(child){child.transform(code,_this85.id,_this85.keyframes,max);});}var c=0;this.children.forEach(function(child){if(child.is_used(_this85.dev)){code.remove(c,child.node.start);child.minify(code,_this85.dev);c=child.node.end;}});code.remove(c,this.source.length);return{code:code.toString(),map:code.generateMap({includeContent:true,source:this.filename,file:file})};}},{key:\"validate\",value:function validate(component){this.children.forEach(function(child){child.validate(component);});}},{key:\"warn_on_unused_selectors\",value:function warn_on_unused_selectors(component){var _this86=this;var ignores=!this.ast.css?[]:extract_ignores_above_position(this.ast.css.start,this.ast.html.children);component.push_ignores(ignores);this.children.forEach(function(child){child.warn_on_unused_selector(function(selector){component.warn(selector.node,compiler_warnings.css_unused_selector(_this86.source.slice(selector.node.start,selector.node.end)));});});component.pop_ignores();}}]);return Stylesheet;}();var test=typeof process!=='undefined'&&process.env.TEST;var TemplateScope=/*#__PURE__*/function(){function TemplateScope(parent){(0,_classCallCheck2.default)(this,TemplateScope);this.owners=new Map();this.parent=parent;this.names=new Set(parent?parent.names:[]);this.dependencies_for_name=new Map(parent?parent.dependencies_for_name:[]);}(0,_createClass2.default)(TemplateScope,[{key:\"add\",value:function add(name,dependencies,owner){this.names.add(name);this.dependencies_for_name.set(name,dependencies);this.owners.set(name,owner);return this;}},{key:\"child\",value:function child(){var child=new TemplateScope(this);return child;}},{key:\"is_top_level\",value:function is_top_level(name){return!this.parent||!this.names.has(name)&&this.parent.is_top_level(name);}},{key:\"get_owner\",value:function get_owner(name){return this.owners.get(name)||this.parent&&this.parent.get_owner(name);}},{key:\"is_let\",value:function is_let(name){var owner=this.get_owner(name);return owner&&(owner.type==='Element'||owner.type==='InlineComponent'||owner.type==='SlotTemplate');}},{key:\"is_await\",value:function is_await(name){var owner=this.get_owner(name);return owner&&(owner.type==='ThenBlock'||owner.type==='CatchBlock');}},{key:\"is_const\",value:function is_const(name){var owner=this.get_owner(name);return owner&&owner.type==='ConstTag';}}]);return TemplateScope;}();var Fragment=/*#__PURE__*/function(_Node$25){(0,_inherits2.default)(Fragment,_Node$25);var _super60=_createSuper(Fragment);function Fragment(component,info){var _this87;(0,_classCallCheck2.default)(this,Fragment);var scope=new TemplateScope();_this87=_super60.call(this,component,null,scope,info);_this87.scope=scope;_this87.children=map_children(component,(0,_assertThisInitialized2.default)(_this87),scope,info.children);return _this87;}return(0,_createClass2.default)(Fragment);}(Node$1);// This file is automatically generated\nvar internal_exports=new Set([\"HtmlTag\",\"HtmlTagHydration\",\"SvelteComponent\",\"SvelteComponentDev\",\"SvelteComponentTyped\",\"SvelteElement\",\"action_destroyer\",\"add_attribute\",\"add_classes\",\"add_flush_callback\",\"add_location\",\"add_render_callback\",\"add_resize_listener\",\"add_styles\",\"add_transform\",\"afterUpdate\",\"append\",\"append_dev\",\"append_empty_stylesheet\",\"append_hydration\",\"append_hydration_dev\",\"append_styles\",\"assign\",\"attr\",\"attr_dev\",\"attribute_to_object\",\"beforeUpdate\",\"bind\",\"binding_callbacks\",\"blank_object\",\"bubble\",\"check_outros\",\"children\",\"claim_component\",\"claim_element\",\"claim_html_tag\",\"claim_space\",\"claim_svg_element\",\"claim_text\",\"clear_loops\",\"component_subscribe\",\"compute_rest_props\",\"compute_slots\",\"createEventDispatcher\",\"create_animation\",\"create_bidirectional_transition\",\"create_component\",\"create_in_transition\",\"create_out_transition\",\"create_slot\",\"create_ssr_component\",\"current_component\",\"custom_event\",\"dataset_dev\",\"debug\",\"destroy_block\",\"destroy_component\",\"destroy_each\",\"detach\",\"detach_after_dev\",\"detach_before_dev\",\"detach_between_dev\",\"detach_dev\",\"dirty_components\",\"dispatch_dev\",\"each\",\"element\",\"element_is\",\"empty\",\"end_hydrating\",\"escape\",\"escape_attribute_value\",\"escape_object\",\"escaped\",\"exclude_internal_props\",\"fix_and_destroy_block\",\"fix_and_outro_and_destroy_block\",\"fix_position\",\"flush\",\"getAllContexts\",\"getContext\",\"get_all_dirty_from_scope\",\"get_binding_group_value\",\"get_current_component\",\"get_custom_elements_slots\",\"get_root_for_style\",\"get_slot_changes\",\"get_spread_object\",\"get_spread_update\",\"get_store_value\",\"globals\",\"group_outros\",\"handle_promise\",\"hasContext\",\"has_prop\",\"identity\",\"init\",\"insert\",\"insert_dev\",\"insert_hydration\",\"insert_hydration_dev\",\"intros\",\"invalid_attribute_name_character\",\"is_client\",\"is_crossorigin\",\"is_empty\",\"is_function\",\"is_promise\",\"listen\",\"listen_dev\",\"loop\",\"loop_guard\",\"merge_ssr_styles\",\"missing_component\",\"mount_component\",\"noop\",\"not_equal\",\"now\",\"null_to_empty\",\"object_without_properties\",\"onDestroy\",\"onMount\",\"once\",\"outro_and_destroy_block\",\"prevent_default\",\"prop_dev\",\"query_selector_all\",\"raf\",\"run\",\"run_all\",\"safe_not_equal\",\"schedule_update\",\"select_multiple_value\",\"select_option\",\"select_options\",\"select_value\",\"self\",\"setContext\",\"set_attributes\",\"set_current_component\",\"set_custom_element_data\",\"set_data\",\"set_data_dev\",\"set_input_type\",\"set_input_value\",\"set_now\",\"set_raf\",\"set_store_value\",\"set_style\",\"set_svg_attributes\",\"space\",\"spread\",\"src_url_equal\",\"start_hydrating\",\"stop_propagation\",\"subscribe\",\"svg_element\",\"text\",\"tick\",\"time_ranges_to_array\",\"to_number\",\"toggle_class\",\"transition_in\",\"transition_out\",\"trusted\",\"update_await_block_branch\",\"update_keyed_each\",\"update_slot\",\"update_slot_base\",\"validate_component\",\"validate_each_argument\",\"validate_each_keys\",\"validate_slots\",\"validate_store\",\"xlink_attr\"]);function is_used_as_reference(node,parent){if(!is_reference(node,parent)){return false;}if(!parent){return true;}/* eslint-disable no-fallthrough */switch(parent.type){// disregard the `foo` in `const foo = bar`\ncase'VariableDeclarator':return node!==parent.id;// disregard the `foo`, `bar` in `function foo(bar){}`\ncase'FunctionDeclaration':// disregard the `foo` in `import { foo } from 'foo'`\ncase'ImportSpecifier':// disregard the `foo` in `import foo from 'foo'`\ncase'ImportDefaultSpecifier':// disregard the `foo` in `import * as foo from 'foo'`\ncase'ImportNamespaceSpecifier':// disregard the `foo` in `export { foo }`\ncase'ExportSpecifier':return false;default:return true;}}var Component=/*#__PURE__*/function(){function Component(ast,source,name,compile_options,stats,warnings){var _this88=this;(0,_classCallCheck2.default)(this,Component);this.ignore_stack=[];this.vars=[];this.var_lookup=new Map();this.imports=[];this.exports_from=[];this.instance_exports_from=[];this.hoistable_nodes=new Set();this.node_for_declaration=new Map();this.partly_hoisted=[];this.fully_hoisted=[];this.reactive_declarations=[];this.reactive_declaration_nodes=new Set();this.has_reactive_assignments=false;this.injected_reactive_declaration_vars=new Set();this.helpers=new Map();this.globals=new Map();this.indirect_dependencies=new Map();this.elements=[];this.aliases=new Map();this.used_names=new Set();this.globally_used_names=new Set();this.slots=new Map();this.slot_outlets=new Set();this.name={type:'Identifier',name:name};this.stats=stats;this.warnings=warnings;this.ast=ast;this.source=source;this.compile_options=compile_options;// the instance JS gets mutated, so we park\n// a copy here for later. TODO this feels gross\nthis.original_ast=clone({html:ast.html,css:ast.css,instance:ast.instance,module:ast.module});this.file=compile_options.filename&&(typeof process!=='undefined'?compile_options.filename.replace(process.cwd(),'').replace(/^[/\\\\]/,''):compile_options.filename);this.locate=getLocator(this.source,{offsetLine:1});// styles\nthis.stylesheet=new Stylesheet({source:source,ast:ast,filename:compile_options.filename,component_name:name,dev:compile_options.dev,get_css_hash:compile_options.cssHash});this.stylesheet.validate(this);this.component_options=process_component_options(this,this.ast.html.children);this.namespace=namespaces[this.component_options.namespace]||this.component_options.namespace;if(compile_options.customElement){if(this.component_options.tag===undefined&&compile_options.tag===undefined){var svelteOptions=ast.html.children.find(function(child){return child.name==='svelte:options';})||{start:0,end:0};this.warn(svelteOptions,compiler_warnings.custom_element_no_tag);}this.tag=this.component_options.tag||compile_options.tag;}else{this.tag=this.name.name;}this.walk_module_js();this.push_ignores(this.ast.instance?extract_ignores_above_position(this.ast.instance.start,this.ast.html.children):[]);this.walk_instance_js_pre_template();this.pop_ignores();this.fragment=new Fragment(this,ast.html);this.name=this.get_unique_name(name);this.push_ignores(this.ast.instance?extract_ignores_above_position(this.ast.instance.start,this.ast.html.children):[]);this.walk_instance_js_post_template();this.pop_ignores();this.elements.forEach(function(element){return _this88.stylesheet.apply(element);});if(!compile_options.customElement)this.stylesheet.reify();this.stylesheet.warn_on_unused_selectors(this);}(0,_createClass2.default)(Component,[{key:\"add_var\",value:function add_var(variable){var add_to_lookup=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.vars.push(variable);if(add_to_lookup){this.var_lookup.set(variable.name,variable);}}},{key:\"add_reference\",value:function add_reference(name){var variable=this.var_lookup.get(name);if(variable){variable.referenced=true;}else if(is_reserved_keyword(name)){this.add_var({name:name,injected:true,referenced:true});}else if(name[0]==='$'){this.add_var({name:name,injected:true,referenced:true,mutated:true,writable:true});var subscribable_name=name.slice(1);var _variable=this.var_lookup.get(subscribable_name);if(_variable){_variable.referenced=true;_variable.subscribable=true;}}else{if(this.compile_options.varsReport==='full'){this.add_var({name:name,referenced:true},false);}this.used_names.add(name);}}},{key:\"alias\",value:function alias(name){if(!this.aliases.has(name)){this.aliases.set(name,this.get_unique_name(name));}return this.aliases.get(name);}},{key:\"apply_stylesheet\",value:function apply_stylesheet(element){this.elements.push(element);}},{key:\"global\",value:function global(name){var alias=this.alias(name);this.globals.set(name,alias);return alias;}},{key:\"generate\",value:function generate(result){var _this89=this;var js=null;var css=null;if(result){var compile_options=this.compile_options,name=this.name;var _compile_options$form=compile_options.format,format=_compile_options$form===void 0?'esm':_compile_options$form;var banner=\"\".concat(this.file?\"\".concat(this.file,\" \"):'',\"generated by Svelte v\",'3.46.2');var program={type:'Program',body:result.js};walk(program,{enter:function enter(node,parent,key){if(node.type==='Identifier'){if(node.name[0]==='@'){if(node.name[1]==='_'){var alias=_this89.global(node.name.slice(2));node.name=alias.name;}else{var _name6=node.name.slice(1);if(compile_options.hydratable){if(internal_exports.has(\"\".concat(_name6,\"_hydration\"))){_name6+='_hydration';}else if(internal_exports.has(\"\".concat(_name6,\"Hydration\"))){_name6+='Hydration';}}if(compile_options.dev){if(internal_exports.has(\"\".concat(_name6,\"_dev\"))){_name6+='_dev';}else if(internal_exports.has(\"\".concat(_name6,\"Dev\"))){_name6+='Dev';}}var _alias=_this89.alias(_name6);_this89.helpers.set(_name6,_alias);node.name=_alias.name;}}else if(node.name[0]!=='#'&&!is_valid(node.name)){// this hack allows x`foo.${bar}` where bar could be invalid\nvar _literal2={type:'Literal',value:node.name};if(parent.type==='Property'&&key==='key'){parent.key=_literal2;}else if(parent.type==='MemberExpression'&&key==='property'){parent.property=_literal2;parent.computed=true;}}}}});var referenced_globals=Array.from(this.globals,function(_ref39){var _ref40=(0,_slicedToArray2.default)(_ref39,2),name=_ref40[0],alias=_ref40[1];return name!==alias.name&&{name:name,alias:alias};}).filter(Boolean);if(referenced_globals.length){this.helpers.set('globals',this.alias('globals'));}var imported_helpers=Array.from(this.helpers,function(_ref41){var _ref42=(0,_slicedToArray2.default)(_ref41,2),name=_ref42[0],alias=_ref42[1];return{name:name,alias:alias};});create_module(program,format,name,banner,compile_options.sveltePath,imported_helpers,referenced_globals,this.imports,this.vars.filter(function(variable){return variable.module&&variable.export_name;}).map(function(variable){return{name:variable.name,as:variable.export_name};}),this.exports_from);css=compile_options.customElement?{code:null,map:null}:result.css;var js_sourcemap_enabled=check_enable_sourcemap(compile_options.enableSourcemap,'js');if(!js_sourcemap_enabled){js=print(program);js.map=null;}else{var sourcemap_source_filename=get_sourcemap_source_filename(compile_options);js=print(program,{sourceMapSource:sourcemap_source_filename});js.map.sources=[sourcemap_source_filename];js.map.sourcesContent=[this.source];js.map=apply_preprocessor_sourcemap(sourcemap_source_filename,js.map,compile_options.sourcemap);}}return{js:js,css:css,ast:this.original_ast,warnings:this.warnings,vars:this.get_vars_report(),stats:this.stats.render()};}},{key:\"get_unique_name\",value:function get_unique_name(name,scope){if(test)name=\"\".concat(name,\"$\");var alias=name;for(var _i53=1;reserved.has(alias)||this.var_lookup.has(alias)||this.used_names.has(alias)||this.globally_used_names.has(alias)||scope&&scope.has(alias);alias=\"\".concat(name,\"_\").concat(_i53++)){;}this.used_names.add(alias);return{type:'Identifier',name:alias};}},{key:\"get_unique_name_maker\",value:function get_unique_name_maker(){var _this90=this;var local_used_names=new Set();function add(name){local_used_names.add(name);}reserved.forEach(add);internal_exports.forEach(add);this.var_lookup.forEach(function(_value,key){return add(key);});return function(name){if(test)name=\"\".concat(name,\"$\");var alias=name;for(var _i54=1;_this90.used_names.has(alias)||local_used_names.has(alias);alias=\"\".concat(name,\"_\").concat(_i54++)){;}local_used_names.add(alias);_this90.globally_used_names.add(alias);return{type:'Identifier',name:alias};};}},{key:\"get_vars_report\",value:function get_vars_report(){var compile_options=this.compile_options,vars=this.vars;var vars_report=compile_options.varsReport===false?[]:compile_options.varsReport==='full'?vars:vars.filter(function(v){return!v.global&&!v.internal;});return vars_report.map(function(v){return{name:v.name,export_name:v.export_name||null,injected:v.injected||false,module:v.module||false,mutated:v.mutated||false,reassigned:v.reassigned||false,referenced:v.referenced||false,writable:v.writable||false,referenced_from_script:v.referenced_from_script||false};});}},{key:\"error\",value:function error(pos,e){if(this.compile_options.errorMode==='warn'){this.warn(pos,e);}else{_error2(e.message,{name:'ValidationError',code:e.code,source:this.source,start:pos.start,end:pos.end,filename:this.compile_options.filename});}}},{key:\"warn\",value:function warn(pos,warning){if(this.ignores&&this.ignores.has(warning.code)){return;}var start=this.locate(pos.start);var end=this.locate(pos.end);var frame=get_code_frame(this.source,start.line-1,start.column);this.warnings.push({code:warning.code,message:warning.message,frame:frame,start:start,end:end,pos:pos.start,filename:this.compile_options.filename,toString:function toString(){return\"\".concat(warning.message,\" (\").concat(start.line,\":\").concat(start.column,\")\\n\").concat(frame);}});}},{key:\"extract_imports\",value:function extract_imports(node){this.imports.push(node);}},{key:\"extract_exports\",value:function extract_exports(node){var module_script=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var ignores=extract_svelte_ignore_from_comments(node);if(ignores.length)this.push_ignores(ignores);var result=this._extract_exports(node,module_script);if(ignores.length)this.pop_ignores();return result;}},{key:\"_extract_exports\",value:function _extract_exports(node,module_script){var _this91=this;if(node.type==='ExportDefaultDeclaration'){return this.error(node,compiler_errors.default_export);}if(node.type==='ExportNamedDeclaration'){if(node.source){if(module_script){this.exports_from.push(node);}else{this.instance_exports_from.push(node);}return null;}if(node.declaration){if(node.declaration.type==='VariableDeclaration'){node.declaration.declarations.forEach(function(declarator){extract_names(declarator.id).forEach(function(name){var variable=_this91.var_lookup.get(name);variable.export_name=name;if(variable.writable&&!(variable.referenced||variable.referenced_from_script||variable.subscribable)){_this91.warn(declarator,compiler_warnings.unused_export_let(_this91.name.name,name));}});});}else{var name=node.declaration.id.name;var variable=this.var_lookup.get(name);variable.export_name=name;}return node.declaration;}else{node.specifiers.forEach(function(specifier){var variable=_this91.var_lookup.get(specifier.local.name);if(variable){variable.export_name=specifier.exported.name;if(variable.writable&&!(variable.referenced||variable.referenced_from_script||variable.subscribable)){_this91.warn(specifier,compiler_warnings.unused_export_let(_this91.name.name,specifier.exported.name));}}});return null;}}}},{key:\"extract_javascript\",value:function extract_javascript(script){var _this92=this;if(!script)return null;return script.content.body.filter(function(node){if(!node)return false;if(_this92.hoistable_nodes.has(node))return false;if(_this92.reactive_declaration_nodes.has(node))return false;if(node.type==='ImportDeclaration')return false;if(node.type==='ExportDeclaration'&&node.specifiers.length>0)return false;return true;});}},{key:\"walk_module_js\",value:function walk_module_js(){var _this93=this;var component=this;var script=this.ast.module;if(!script)return;walk(script.content,{enter:function enter(node){if(node.type==='LabeledStatement'&&node.label.name==='$'){component.warn(node,compiler_warnings.module_script_reactive_declaration);}}});var _create_scopes2=create_scopes(script.content),scope=_create_scopes2.scope,globals=_create_scopes2.globals;this.module_scope=scope;scope.declarations.forEach(function(node,name){if(name[0]==='$'){return _this93.error(node,compiler_errors.illegal_declaration);}var writable=node.type==='VariableDeclaration'&&(node.kind==='var'||node.kind==='let');_this93.add_var({name:name,module:true,hoistable:true,writable:writable});});globals.forEach(function(node,name){if(name[0]==='$'){return _this93.error(node,compiler_errors.illegal_subscription);}else{_this93.add_var({name:name,global:true,hoistable:true});}});var body=script.content.body;var i=body.length;while(--i>=0){var _node12=body[i];if(_node12.type==='ImportDeclaration'){this.extract_imports(_node12);body.splice(i,1);}if(/^Export/.test(_node12.type)){var replacement=this.extract_exports(_node12,true);if(replacement){body[i]=replacement;}else{body.splice(i,1);}}}}},{key:\"walk_instance_js_pre_template\",value:function walk_instance_js_pre_template(){var _this94=this;var script=this.ast.instance;if(!script)return;// inject vars for reactive declarations\nscript.content.body.forEach(function(node){if(node.type!=='LabeledStatement')return;if(node.body.type!=='ExpressionStatement')return;var expression=node.body.expression;if(expression.type!=='AssignmentExpression')return;if(expression.left.type==='MemberExpression')return;extract_names(expression.left).forEach(function(name){if(!_this94.var_lookup.has(name)&&name[0]!=='$'){_this94.injected_reactive_declaration_vars.add(name);}});});var _create_scopes3=create_scopes(script.content),instance_scope=_create_scopes3.scope,map=_create_scopes3.map,globals=_create_scopes3.globals;this.instance_scope=instance_scope;this.instance_scope_map=map;instance_scope.declarations.forEach(function(node,name){if(name[0]==='$'){return _this94.error(node,compiler_errors.illegal_declaration);}var writable=node.type==='VariableDeclaration'&&(node.kind==='var'||node.kind==='let');var imported=node.type.startsWith('Import');_this94.add_var({name:name,initialised:instance_scope.initialised_declarations.has(name),writable:writable,imported:imported});_this94.node_for_declaration.set(name,node);});// NOTE: add store variable first, then only $store value\n// as `$store` will mark `store` variable as referenced and subscribable\nvar global_keys=Array.from(globals.keys());var sorted_globals=[].concat((0,_toConsumableArray2.default)(global_keys.filter(function(key){return key[0]!=='$';})),(0,_toConsumableArray2.default)(global_keys.filter(function(key){return key[0]==='$';})));sorted_globals.forEach(function(name){if(_this94.var_lookup.has(name))return;var node=globals.get(name);if(_this94.injected_reactive_declaration_vars.has(name)){_this94.add_var({name:name,injected:true,writable:true,reassigned:true,initialised:true});}else if(is_reserved_keyword(name)){_this94.add_var({name:name,injected:true});}else if(name[0]==='$'){if(name==='$'||name[1]==='$'){return _this94.error(node,compiler_errors.illegal_global(name));}_this94.add_var({name:name,injected:true,mutated:true,writable:true});_this94.add_reference(name.slice(1));var variable=_this94.var_lookup.get(name.slice(1));if(variable){variable.subscribable=true;variable.referenced_from_script=true;}}else{_this94.add_var({name:name,global:true,hoistable:true});}});this.track_references_and_mutations();}},{key:\"walk_instance_js_post_template\",value:function walk_instance_js_post_template(){var script=this.ast.instance;if(!script)return;this.post_template_walk();this.hoist_instance_declarations();this.extract_reactive_declarations();}},{key:\"post_template_walk\",value:function post_template_walk(){var script=this.ast.instance;if(!script)return;var component=this;var content=script.content;var instance_scope=this.instance_scope,map=this.instance_scope_map;var scope=instance_scope;var to_remove=[];var remove=function remove(parent,prop,index){to_remove.unshift([parent,prop,index]);};var scope_updated=false;var current_function_stack=[];var current_function=null;walk(content,{enter:function enter(node,parent,prop,index){if(node.type==='FunctionDeclaration'||node.type==='FunctionExpression'){current_function_stack.push(current_function=node);}if(map.has(node)){scope=map.get(node);}if(node.type==='ImportDeclaration'){component.extract_imports(node);// TODO: to use actual remove\nremove(parent,prop,index);return this.skip();}if(/^Export/.test(node.type)){var replacement=component.extract_exports(node);if(replacement){this.replace(replacement);}else{// TODO: to use actual remove\nremove(parent,prop,index);}return this.skip();}component.warn_on_undefined_store_value_references(node,parent,prop,scope);},leave:function leave(node){if(node.type==='FunctionDeclaration'||node.type==='FunctionExpression'){current_function_stack.pop();current_function=current_function_stack[current_function_stack.length-1];}// do it on leave, to prevent infinite loop\nif(component.compile_options.dev&&component.compile_options.loopGuardTimeout>0&&(!current_function||!current_function.generator&&!current_function.async)){var to_replace_for_loop_protect=component.loop_protect(node,scope,component.compile_options.loopGuardTimeout);if(to_replace_for_loop_protect){this.replace(to_replace_for_loop_protect);scope_updated=true;}}if(map.has(node)){scope=scope.parent;}}});for(var _i55=0,_to_remove=to_remove;_i55<_to_remove.length;_i55++){var _to_remove$_i=(0,_slicedToArray2.default)(_to_remove[_i55],3),parent=_to_remove$_i[0],prop=_to_remove$_i[1],index=_to_remove$_i[2];if(parent){if(index!==null){parent[prop].splice(index,1);}else{delete parent[prop];}}}if(scope_updated){var _create_scopes4=create_scopes(script.content),_scope5=_create_scopes4.scope,_map2=_create_scopes4.map;this.instance_scope=_scope5;this.instance_scope_map=_map2;}}},{key:\"track_references_and_mutations\",value:function track_references_and_mutations(){var script=this.ast.instance;if(!script)return;var component=this;var content=script.content;var instance_scope=this.instance_scope,module_scope=this.module_scope,map=this.instance_scope_map;var scope=instance_scope;walk(content,{enter:function enter(node,parent){if(map.has(node)){scope=map.get(node);}if(node.type==='AssignmentExpression'||node.type==='UpdateExpression'){var assignee=node.type==='AssignmentExpression'?node.left:node.argument;var _names4=extract_names(assignee);var deep=assignee.type==='MemberExpression';_names4.forEach(function(name){var scope_owner=scope.find_owner(name);if(scope_owner!==null?scope_owner===instance_scope:module_scope&&module_scope.has(name)){var variable=component.var_lookup.get(name);variable[deep?'mutated':'reassigned']=true;}});}if(is_used_as_reference(node,parent)){var object=get_object(node);if(scope.find_owner(object.name)===instance_scope){var variable=component.var_lookup.get(object.name);variable.referenced_from_script=true;}}},leave:function leave(node){if(map.has(node)){scope=scope.parent;}}});}},{key:\"warn_on_undefined_store_value_references\",value:function warn_on_undefined_store_value_references(node,parent,prop,scope){if(node.type==='LabeledStatement'&&node.label.name==='$'&&parent.type!=='Program'){this.warn(node,compiler_warnings.non_top_level_reactive_declaration);}if(is_reference(node,parent)){var object=get_object(node);var name=object.name;if(name[0]==='$'){if(!scope.has(name)){this.warn_if_undefined(name,object,null);}if(name[1]!=='$'&&scope.has(name.slice(1))&&scope.find_owner(name.slice(1))!==this.instance_scope){if(!(/Function/.test(parent.type)&&prop==='params'||parent.type==='VariableDeclarator'&&prop==='id')){return this.error(node,compiler_errors.contextual_store);}}}}}},{key:\"loop_protect\",value:function loop_protect(node,scope,timeout){if(node.type==='WhileStatement'||node.type==='ForStatement'||node.type==='DoWhileStatement'){var guard=this.get_unique_name('guard',scope);this.used_names.add(guard.name);var before=b(_templateObject795||(_templateObject795=(0,_taggedTemplateLiteral2.default)([\"const \",\" = @loop_guard(\",\")\"])),guard,timeout);var inside=b(_templateObject796||(_templateObject796=(0,_taggedTemplateLiteral2.default)([\"\",\"();\"])),guard);// wrap expression statement with BlockStatement\nif(node.body.type!=='BlockStatement'){node.body={type:'BlockStatement',body:[node.body]};}node.body.body.push(inside[0]);return{type:'BlockStatement',body:[before[0],node]};}return null;}},{key:\"rewrite_props\",value:function rewrite_props(get_insert){if(!this.ast.instance)return;var component=this;var instance_scope=this.instance_scope,map=this.instance_scope_map;var scope=instance_scope;walk(this.ast.instance.content,{enter:function enter(node){var _this95=this;if(/Function/.test(node.type)){return this.skip();}if(map.has(node)){scope=map.get(node);}if(node.type==='ExportNamedDeclaration'&&node.declaration){return this.replace(node.declaration);}if(node.type==='VariableDeclaration'){// NOTE: `var` does not follow block scoping\nif(node.kind==='var'||scope===instance_scope){var _ret3=function(){var inserts=[];var props=[];function add_new_props(exported,local,default_value){props.push({type:'Property',method:false,shorthand:false,computed:false,kind:'init',key:exported,value:default_value?{type:'AssignmentPattern',left:local,right:default_value}:local});}// transform\n// ```\n// export let { x, y = 123 } = OBJ, z = 456\n// ```\n// into\n// ```\n// let { x: x$, y: y$ = 123 } = OBJ;\n// let { x = x$, y = y$, z = 456 } = $$props;\n// ```\nfor(var index=0;index<node.declarations.length;index++){var declarator=node.declarations[index];if(declarator.id.type!=='Identifier'){(function(){function get_new_name(local){var variable=component.var_lookup.get(local.name);if(variable.subscribable){inserts.push(get_insert(variable));}if(variable.export_name&&variable.writable){var alias_name=component.get_unique_name(local.name);add_new_props({type:'Identifier',name:variable.export_name},local,alias_name);return alias_name;}return local;}function rename_identifiers(param){switch(param.type){case'ObjectPattern':{var handle_prop=function handle_prop(prop){if(prop.type==='RestElement'){rename_identifiers(prop);}else if(prop.value.type==='Identifier'){prop.value=get_new_name(prop.value);}else{rename_identifiers(prop.value);}};param.properties.forEach(handle_prop);break;}case'ArrayPattern':{var handle_element=function handle_element(element,index,array){if(element){if(element.type==='Identifier'){array[index]=get_new_name(element);}else{rename_identifiers(element);}}};param.elements.forEach(handle_element);break;}case'RestElement':param.argument=get_new_name(param.argument);break;case'AssignmentPattern':if(param.left.type==='Identifier'){param.left=get_new_name(param.left);}else{rename_identifiers(param.left);}break;}}rename_identifiers(declarator.id);})();}else{var name=declarator.id.name;var variable=component.var_lookup.get(name);var is_props=variable.export_name&&variable.writable;if(is_props){add_new_props({type:'Identifier',name:variable.export_name},declarator.id,declarator.init);node.declarations.splice(index--,1);}if(variable.subscribable&&(is_props||declarator.init)){inserts.push(get_insert(variable));}}}_this95.replace(b(_templateObject797||(_templateObject797=(0,_taggedTemplateLiteral2.default)([\"\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\\t\",\"\\n\\t\\t\\t\\t\\t\\t\"])),node.declarations.length?node:null,props.length>0&&b(_templateObject798||(_templateObject798=(0,_taggedTemplateLiteral2.default)([\"let { \",\" } = $$props;\"])),props),inserts));return{v:_this95.skip()};}();if((0,_typeof2.default)(_ret3)===\"object\")return _ret3.v;}}},leave:function leave(node){if(map.has(node)){scope=scope.parent;}}});}},{key:\"hoist_instance_declarations\",value:function hoist_instance_declarations(){var _this96=this;// we can safely hoist variable declarations that are\n// initialised to literals, and functions that don't\n// reference instance variables other than other\n// hoistable functions. TODO others?\nvar hoistable_nodes=this.hoistable_nodes,var_lookup=this.var_lookup,injected_reactive_declaration_vars=this.injected_reactive_declaration_vars,imports=this.imports;var top_level_function_declarations=new Map();var body=this.ast.instance.content.body;var _loop2=function _loop2(_i57){var node=body[_i57];if(node.type==='VariableDeclaration'){var all_hoistable=node.declarations.every(function(d){if(!d.init){_i56=_i57;return false;}if(d.init.type!=='Literal'){_i56=_i57;return false;}// everything except const values can be changed by e.g. svelte devtools\n// which means we can't hoist it\nif(node.kind!=='const'&&_this96.compile_options.dev){_i56=_i57;return false;}var name=d.id.name;var v=_this96.var_lookup.get(name);if(v.reassigned){_i56=_i57;return false;}if(v.export_name){_i56=_i57;return false;}if(_this96.var_lookup.get(name).reassigned){_i56=_i57;return false;}if(_this96.vars.find(function(variable){return variable.name===name&&variable.module;})){_i56=_i57;return false;}_i56=_i57;return true;});if(all_hoistable){node.declarations.forEach(function(d){var variable=_this96.var_lookup.get(d.id.name);variable.hoistable=true;});hoistable_nodes.add(node);body.splice(_i57--,1);_this96.fully_hoisted.push(node);}}if(node.type==='ExportNamedDeclaration'&&node.declaration&&node.declaration.type==='FunctionDeclaration'){top_level_function_declarations.set(node.declaration.id.name,node);}if(node.type==='FunctionDeclaration'){top_level_function_declarations.set(node.id.name,node);}_i56=_i57;};for(var _i56=0;_i56<body.length;_i56+=1){_loop2(_i56);}var checked=new Set();var walking=new Set();var is_hoistable=function is_hoistable(fn_declaration){if(fn_declaration.type==='ExportNamedDeclaration'){fn_declaration=fn_declaration.declaration;}var instance_scope=_this96.instance_scope;var scope=_this96.instance_scope;var map=_this96.instance_scope_map;var hoistable=true;// handle cycles\nwalking.add(fn_declaration);walk(fn_declaration,{enter:function enter(node,parent){if(!hoistable)return this.skip();if(map.has(node)){scope=map.get(node);}if(is_reference(node,parent)){var _flatten_reference7=flatten_reference(node),name=_flatten_reference7.name;var owner=scope.find_owner(name);if(injected_reactive_declaration_vars.has(name)){hoistable=false;}else if(name[0]==='$'&&!owner){hoistable=false;}else if(owner===instance_scope){var variable=var_lookup.get(name);if(variable.reassigned||variable.mutated)hoistable=false;if(name===fn_declaration.id.name)return;if(variable.hoistable)return;if(top_level_function_declarations.has(name)){var other_declaration=top_level_function_declarations.get(name);if(walking.has(other_declaration)){hoistable=false;}else if(other_declaration.type==='ExportNamedDeclaration'&&walking.has(other_declaration.declaration)){hoistable=false;}else if(!is_hoistable(other_declaration)){hoistable=false;}}else{hoistable=false;}}this.skip();}},leave:function leave(node){if(map.has(node)){scope=scope.parent;}}});checked.add(fn_declaration);walking.delete(fn_declaration);return hoistable;};var _iterator24=_createForOfIteratorHelper(top_level_function_declarations),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var _step24$value=(0,_slicedToArray2.default)(_step24.value,2),name=_step24$value[0],_node13=_step24$value[1];if(is_hoistable(_node13)){var variable=this.var_lookup.get(name);variable.hoistable=true;hoistable_nodes.add(_node13);var _i58=body.indexOf(_node13);body.splice(_i58,1);this.fully_hoisted.push(_node13);}}}catch(err){_iterator24.e(err);}finally{_iterator24.f();}var _iterator25=_createForOfIteratorHelper(imports),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var specifiers=_step25.value.specifiers;var _iterator26=_createForOfIteratorHelper(specifiers),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var specifier=_step26.value;var _variable2=var_lookup.get(specifier.local.name);if(!_variable2.mutated||_variable2.subscribable){_variable2.hoistable=true;}}}catch(err){_iterator26.e(err);}finally{_iterator26.f();}}}catch(err){_iterator25.e(err);}finally{_iterator25.f();}}},{key:\"extract_reactive_declarations\",value:function extract_reactive_declarations(){var _this97=this;var component=this;var unsorted_reactive_declarations=[];this.ast.instance.content.body.forEach(function(node){var ignores=extract_svelte_ignore_from_comments(node);if(ignores.length)_this97.push_ignores(ignores);if(node.type==='LabeledStatement'&&node.label.name==='$'){_this97.reactive_declaration_nodes.add(node);var assignees=new Set();var assignee_nodes=new Set();var dependencies=new Set();var module_dependencies=new Set();var _scope6=_this97.instance_scope;var map=_this97.instance_scope_map;walk(node.body,{enter:function enter(node,parent){if(map.has(node)){_scope6=map.get(node);}if(node.type==='AssignmentExpression'){var left=get_object(node.left);extract_identifiers(left).forEach(function(node){assignee_nodes.add(node);assignees.add(node.name);});if(node.operator!=='='){dependencies.add(left.name);}}else if(node.type==='UpdateExpression'){var identifier=get_object(node.argument);assignees.add(identifier.name);}else if(is_reference(node,parent)){var _identifier=get_object(node);if(!assignee_nodes.has(_identifier)){var name=_identifier.name;var owner=_scope6.find_owner(name);var variable=component.var_lookup.get(name);var should_add_as_dependency=true;if(variable){variable.is_reactive_dependency=true;if(variable.module&&variable.writable){should_add_as_dependency=false;module_dependencies.add(name);}}var is_writable_or_mutated=variable&&(variable.writable||variable.mutated);if(should_add_as_dependency&&(!owner||owner===component.instance_scope)&&(name[0]==='$'||is_writable_or_mutated)){dependencies.add(name);}}this.skip();}},leave:function leave(node){if(map.has(node)){_scope6=_scope6.parent;}}});if(module_dependencies.size>0&&dependencies.size===0){component.warn(node.body,compiler_warnings.module_script_variable_reactive_declaration(Array.from(module_dependencies)));}var _expression14=node.body.expression;var declaration=_expression14&&_expression14.left;unsorted_reactive_declarations.push({assignees:assignees,dependencies:dependencies,node:node,declaration:declaration});}if(ignores.length)_this97.pop_ignores();});var lookup=new Map();unsorted_reactive_declarations.forEach(function(declaration){declaration.assignees.forEach(function(name){if(!lookup.has(name)){lookup.set(name,[]);}// TODO warn or error if a name is assigned to in\n// multiple reactive declarations?\nlookup.get(name).push(declaration);});});var cycle=check_graph_for_cycles(unsorted_reactive_declarations.reduce(function(acc,declaration){declaration.assignees.forEach(function(v){declaration.dependencies.forEach(function(w){if(!declaration.assignees.has(w)){acc.push([v,w]);}});});return acc;},[]));if(cycle&&cycle.length){var declarationList=lookup.get(cycle[0]);var declaration=declarationList[0];return this.error(declaration.node,compiler_errors.cyclical_reactive_declaration(cycle));}var add_declaration=function add_declaration(declaration){if(_this97.reactive_declarations.includes(declaration))return;declaration.dependencies.forEach(function(name){if(declaration.assignees.has(name))return;var earlier_declarations=lookup.get(name);if(earlier_declarations){earlier_declarations.forEach(add_declaration);}});_this97.reactive_declarations.push(declaration);};unsorted_reactive_declarations.forEach(add_declaration);}},{key:\"warn_if_undefined\",value:function warn_if_undefined(name,node,template_scope){if(name[0]==='$'){if(name==='$'||name[1]==='$'&&!is_reserved_keyword(name)){return this.error(node,compiler_errors.illegal_global(name));}this.has_reactive_assignments=true;// TODO does this belong here?\nif(is_reserved_keyword(name))return;name=name.slice(1);}if(this.var_lookup.has(name)&&!this.var_lookup.get(name).global)return;if(template_scope&&template_scope.names.has(name))return;if(globals.has(name)&&node.type!=='InlineComponent')return;this.warn(node,compiler_warnings.missing_declaration(name,!!this.ast.instance));}},{key:\"push_ignores\",value:function push_ignores(ignores){this.ignores=new Set(this.ignores||[]);add_to_set(this.ignores,ignores);this.ignore_stack.push(this.ignores);}},{key:\"pop_ignores\",value:function pop_ignores(){this.ignore_stack.pop();this.ignores=this.ignore_stack[this.ignore_stack.length-1];}}]);return Component;}();function process_component_options(component,nodes){var component_options={immutable:component.compile_options.immutable||false,accessors:'accessors'in component.compile_options?component.compile_options.accessors:!!component.compile_options.customElement,preserveWhitespace:!!component.compile_options.preserveWhitespace,namespace:component.compile_options.namespace};var node=nodes.find(function(node){return node.name==='svelte:options';});function get_value(attribute,_ref43){var code=_ref43.code,message=_ref43.message;var value=attribute.value;var chunk=value[0];if(!chunk)return true;if(value.length>1){return component.error(attribute,{code:code,message:message});}if(chunk.type==='Text')return chunk.data;if(chunk.expression.type!=='Literal'){return component.error(attribute,{code:code,message:message});}return chunk.expression.value;}if(node){node.attributes.forEach(function(attribute){if(attribute.type==='Attribute'){var name=attribute.name;switch(name){case'tag':{var _tag=get_value(attribute,compiler_errors.invalid_tag_attribute);if(typeof _tag!=='string'&&_tag!==null){return component.error(attribute,compiler_errors.invalid_tag_attribute);}if(_tag&&!/^[a-zA-Z][a-zA-Z0-9]*-[a-zA-Z0-9-]+$/.test(_tag)){return component.error(attribute,compiler_errors.invalid_tag_property);}if(_tag&&!component.compile_options.customElement){component.warn(attribute,compiler_warnings.missing_custom_element_compile_options);}component_options.tag=_tag;break;}case'namespace':{var ns=get_value(attribute,compiler_errors.invalid_namespace_attribute);if(typeof ns!=='string'){return component.error(attribute,compiler_errors.invalid_namespace_attribute);}if(valid_namespaces.indexOf(ns)===-1){var match=fuzzymatch(ns,valid_namespaces);return component.error(attribute,compiler_errors.invalid_namespace_property(ns,match));}component_options.namespace=ns;break;}case'accessors':case'immutable':case'preserveWhitespace':{var _value18=get_value(attribute,compiler_errors.invalid_attribute_value(name));if(typeof _value18!=='boolean'){return component.error(attribute,compiler_errors.invalid_attribute_value(name));}component_options[name]=_value18;break;}default:return component.error(attribute,compiler_errors.invalid_options_attribute_unknown);}}else{return component.error(attribute,compiler_errors.invalid_options_attribute);}});}return component_options;}function get_relative_path(from,to){var from_parts=from.split(/[/\\\\]/);var to_parts=to.split(/[/\\\\]/);from_parts.pop();// get dirname\nwhile(from_parts[0]===to_parts[0]){from_parts.shift();to_parts.shift();}if(from_parts.length){var _i59=from_parts.length;while(_i59--){from_parts[_i59]='..';}}return from_parts.concat(to_parts).join('/');}function get_basename(filename){return filename.split(/[/\\\\]/).pop();}function get_sourcemap_source_filename(compile_options){if(!compile_options.filename)return null;return compile_options.outputFilename?get_relative_path(compile_options.outputFilename,compile_options.filename):get_basename(compile_options.filename);}function get_name_from_filename(filename){if(!filename)return null;var parts=filename.split(/[/\\\\]/).map(encodeURI);if(parts.length>1){var index_match=parts[parts.length-1].match(/^index(\\.\\w+)/);if(index_match){parts.pop();parts[parts.length-1]+=index_match[1];}}var base=parts.pop().replace(/%/g,'u').replace(/\\.[^.]+$/,'').replace(/[^a-zA-Z_$0-9]+/g,'_').replace(/^_/,'').replace(/_$/,'').replace(/^(\\d)/,'_$1');if(!base){throw new Error(\"Could not derive component name from file \".concat(filename));}return base[0].toUpperCase()+base.slice(1);}var valid_options=['format','name','filename','sourcemap','enableSourcemap','generate','errorMode','varsReport','outputFilename','cssOutputFilename','sveltePath','dev','accessors','immutable','hydratable','legacy','customElement','namespace','tag','css','loopGuardTimeout','preserveComments','preserveWhitespace','cssHash'];function validate_options(options,warnings){var name=options.name,filename=options.filename,loopGuardTimeout=options.loopGuardTimeout,dev=options.dev,namespace=options.namespace;Object.keys(options).forEach(function(key){if(!valid_options.includes(key)){var match=fuzzymatch(key,valid_options);var message=\"Unrecognized option '\".concat(key,\"'\");if(match)message+=\" (did you mean '\".concat(match,\"'?)\");throw new Error(message);}});if(name&&!/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(name)){throw new Error(\"options.name must be a valid identifier (got '\".concat(name,\"')\"));}if(name&&/^[a-z]/.test(name)){var message='options.name should be capitalised';warnings.push({code:'options-lowercase-name',message:message,filename:filename,toString:function toString(){return message;}});}if(loopGuardTimeout&&!dev){var _message='options.loopGuardTimeout is for options.dev = true only';warnings.push({code:'options-loop-guard-timeout',message:_message,filename:filename,toString:function toString(){return _message;}});}if(namespace&&valid_namespaces.indexOf(namespace)===-1){var match=fuzzymatch(namespace,valid_namespaces);if(match){throw new Error(\"Invalid namespace '\".concat(namespace,\"' (did you mean '\").concat(match,\"'?)\"));}else{throw new Error(\"Invalid namespace '\".concat(namespace,\"'\"));}}}function compile(source){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};options=Object.assign({generate:'dom',dev:false,enableSourcemap:true},options);var stats=new Stats();var warnings=[];validate_options(options,warnings);stats.start('parse');var ast=parse$3(source,options);stats.stop('parse');stats.start('create component');var component=new Component(ast,source,options.name||get_name_from_filename(options.filename)||'Component',options,stats,warnings);stats.stop('create component');var result=options.generate===false?null:options.generate==='ssr'?ssr(component,options):dom(component,options);return component.generate(result);}/**\n * Import decoded sourcemap from mozilla/source-map/SourceMapGenerator\n * Forked from source-map/lib/source-map-generator.js\n * from methods _serializeMappings and toJSON.\n * We cannot use source-map.d.ts types, because we access hidden properties.\n */function decoded_sourcemap_from_generator(generator){var previous_generated_line=1;var converted_mappings=[[]];var result_line;var result_segment;var mapping;var source_idx=generator._sources.toArray().reduce(function(acc,val,idx){return acc[val]=idx,acc;},{});var name_idx=generator._names.toArray().reduce(function(acc,val,idx){return acc[val]=idx,acc;},{});var mappings=generator._mappings.toArray();result_line=converted_mappings[0];for(var _i60=0,len=mappings.length;_i60<len;_i60++){mapping=mappings[_i60];if(mapping.generatedLine>previous_generated_line){while(mapping.generatedLine>previous_generated_line){converted_mappings.push([]);previous_generated_line++;}result_line=converted_mappings[mapping.generatedLine-1];// line is one-based\n}else if(_i60>0){var previous_mapping=mappings[_i60-1];if(// sorted by selectivity\nmapping.generatedColumn===previous_mapping.generatedColumn&&mapping.originalColumn===previous_mapping.originalColumn&&mapping.name===previous_mapping.name&&mapping.generatedLine===previous_mapping.generatedLine&&mapping.originalLine===previous_mapping.originalLine&&mapping.source===previous_mapping.source){continue;}}result_line.push([mapping.generatedColumn]);result_segment=result_line[result_line.length-1];if(mapping.source!=null){var _result_segment;(_result_segment=result_segment).push.apply(_result_segment,[source_idx[mapping.source],mapping.originalLine-1,mapping.originalColumn]);if(mapping.name!=null){result_segment.push(name_idx[mapping.name]);}}}var map={version:generator._version,sources:generator._sources.toArray(),names:generator._names.toArray(),mappings:converted_mappings};if(generator._file!=null){map.file=generator._file;}// not needed: map.sourcesContent and map.sourceRoot\nreturn map;}function decode_map(processed){var decoded_map=typeof processed.map==='string'?JSON.parse(processed.map):processed.map;if(typeof decoded_map.mappings==='string'){decoded_map.mappings=decode(decoded_map.mappings);}if(decoded_map._mappings&&decoded_map.constructor.name==='SourceMapGenerator'){// import decoded sourcemap from mozilla/source-map/SourceMapGenerator\ndecoded_map=decoded_sourcemap_from_generator(decoded_map);}return decoded_map;}function slice_source(code_slice,offset,_ref44){var file_basename=_ref44.file_basename,filename=_ref44.filename,_get_location=_ref44.get_location;return{source:code_slice,get_location:function get_location(index){return _get_location(index+offset);},file_basename:file_basename,filename:filename};}function calculate_replacements(re,get_replacement,source){var replacements=[];source.replace(re,function(){for(var _len4=arguments.length,match=new Array(_len4),_key4=0;_key4<_len4;_key4++){match[_key4]=arguments[_key4];}replacements.push(get_replacement.apply(void 0,match).then(function(replacement){var matched_string=match[0];var offset=match[match.length-2];return{offset:offset,length:matched_string.length,replacement:replacement};}));return'';});return Promise.all(replacements);}function perform_replacements(replacements,source){var out=new MappedCode();var last_end=0;var _iterator27=_createForOfIteratorHelper(replacements),_step27;try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var _step27$value=_step27.value,offset=_step27$value.offset,length=_step27$value.length,replacement=_step27$value.replacement;var unchanged_prefix=MappedCode.from_source(slice_source(source.source.slice(last_end,offset),last_end,source));out.concat(unchanged_prefix).concat(replacement);last_end=offset+length;}}catch(err){_iterator27.e(err);}finally{_iterator27.f();}var unchanged_suffix=MappedCode.from_source(slice_source(source.source.slice(last_end),last_end,source));return out.concat(unchanged_suffix);}function replace_in_code(_x,_x2,_x3){return _replace_in_code.apply(this,arguments);}function _replace_in_code(){_replace_in_code=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function _callee(regex,get_replacement,location){var replacements;return _regenerator.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return calculate_replacements(regex,get_replacement,location.source);case 2:replacements=_context.sent;return _context.abrupt(\"return\",perform_replacements(replacements,location));case 4:case\"end\":return _context.stop();}}},_callee);}));return _replace_in_code.apply(this,arguments);}function get_file_basename(filename){return filename.split(/[/\\\\]/).pop();}/**\n * Represents intermediate states of the preprocessing.\n */var PreprocessResult=/*#__PURE__*/function(){function PreprocessResult(source,filename){(0,_classCallCheck2.default)(this,PreprocessResult);this.source=source;this.filename=filename;// sourcemap_list is sorted in reverse order from last map (index 0) to first map (index -1)\n// so we use sourcemap_list.unshift() to add new maps\n// https://github.com/ampproject/remapping#multiple-transformations-of-a-file\nthis.sourcemap_list=[];this.dependencies=[];this.update_source({string:source});// preprocess source must be relative to itself or equal null\nthis.file_basename=filename==null?null:get_file_basename(filename);}(0,_createClass2.default)(PreprocessResult,[{key:\"update_source\",value:function update_source(_ref45){var source=_ref45.string,map=_ref45.map,dependencies=_ref45.dependencies;if(source!=null){this.source=source;this.get_location=getLocator(source);}if(map){this.sourcemap_list.unshift(map);}if(dependencies){var _this$dependencies;(_this$dependencies=this.dependencies).push.apply(_this$dependencies,(0,_toConsumableArray2.default)(dependencies));}}},{key:\"to_processed\",value:function to_processed(){var _this98=this;// Combine all the source maps for each preprocessor function into one\nvar map=combine_sourcemaps(this.file_basename,this.sourcemap_list);return{// TODO return separated output, in future version where svelte.compile supports it:\n// style: { code: styleCode, map: styleMap },\n// script { code: scriptCode, map: scriptMap },\n// markup { code: markupCode, map: markupMap },\ncode:this.source,dependencies:(0,_toConsumableArray2.default)(new Set(this.dependencies)),map:map,toString:function toString(){return _this98.source;}};}}]);return PreprocessResult;}();/**\n * Convert preprocessor output for the tag content into MappedCode\n */function processed_content_to_code(processed,location,file_basename){// Convert the preprocessed code and its sourcemap to a MappedCode\nvar decoded_map;if(processed.map){decoded_map=decode_map(processed);// decoded map may not have sources for empty maps like `{ mappings: '' }`\nif(decoded_map.sources){// offset only segments pointing at original component source\nvar source_index=decoded_map.sources.indexOf(file_basename);if(source_index!==-1){sourcemap_add_offset(decoded_map,location,source_index);}}}return MappedCode.from_processed(processed.code,decoded_map);}/**\n * Given the whole tag including content, return a `MappedCode`\n * representing the tag content replaced with `processed`.\n */function processed_tag_to_code(processed,tag_name,attributes,source){var file_basename=source.file_basename,get_location=source.get_location;var build_mapped_code=function build_mapped_code(code,offset){return MappedCode.from_source(slice_source(code,offset,source));};var tag_open=\"<\".concat(tag_name).concat(attributes||'',\">\");var tag_close=\"</\".concat(tag_name,\">\");var tag_open_code=build_mapped_code(tag_open,0);var tag_close_code=build_mapped_code(tag_close,tag_open.length+source.source.length);parse_attached_sourcemap(processed,tag_name);var content_code=processed_content_to_code(processed,get_location(tag_open.length),file_basename);return tag_open_code.concat(content_code).concat(tag_close_code);}function parse_tag_attributes(str){// note: won't work with attribute values containing spaces.\nreturn str.split(/\\s+/).filter(Boolean).reduce(function(attrs,attr){var _a;var i=attr.indexOf('=');var _ref46=i>0?[attr.slice(0,i),attr.slice(i+1)]:[attr],_ref47=(0,_slicedToArray2.default)(_ref46,2),key=_ref47[0],value=_ref47[1];var _ref48=value&&value.match(/^['\"](.*)['\"]$/)||[],_ref49=(0,_slicedToArray2.default)(_ref48,2),unquoted=_ref49[1];return Object.assign(Object.assign({},attrs),(0,_defineProperty2.default)({},key,(_a=unquoted!==null&&unquoted!==void 0?unquoted:value,_a!==null&&_a!==void 0?_a:true)));},{});}/**\n * Calculate the updates required to process all instances of the specified tag.\n */function process_tag(_x4,_x5,_x6){return _process_tag.apply(this,arguments);}function _process_tag(){_process_tag=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function _callee3(tag_name,preprocessor,source){var filename,markup,tag_regex,dependencies,process_single_tag,_process_single_tag,_yield$replace_in_cod,string,map;return _regenerator.default.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_process_single_tag=function _process_single_tag3(){_process_single_tag=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function _callee2(tag_with_content){var attributes,content,tag_offset,no_change,processed,_args3=arguments;return _regenerator.default.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:attributes=_args3.length>1&&_args3[1]!==undefined?_args3[1]:'';content=_args3.length>2&&_args3[2]!==undefined?_args3[2]:'';tag_offset=_args3.length>3?_args3[3]:undefined;no_change=function no_change(){return MappedCode.from_source(slice_source(tag_with_content,tag_offset,source));};if(!(!attributes&&!content)){_context2.next=6;break;}return _context2.abrupt(\"return\",no_change());case 6:_context2.next=8;return preprocessor({content:content||'',attributes:parse_tag_attributes(attributes||''),markup:markup,filename:filename});case 8:processed=_context2.sent;if(processed){_context2.next=11;break;}return _context2.abrupt(\"return\",no_change());case 11:if(processed.dependencies)dependencies.push.apply(dependencies,(0,_toConsumableArray2.default)(processed.dependencies));if(!(!processed.map&&processed.code===content)){_context2.next=14;break;}return _context2.abrupt(\"return\",no_change());case 14:return _context2.abrupt(\"return\",processed_tag_to_code(processed,tag_name,attributes,slice_source(content,tag_offset,source)));case 15:case\"end\":return _context2.stop();}}},_callee2);}));return _process_single_tag.apply(this,arguments);};process_single_tag=function _process_single_tag2(_x12){return _process_single_tag.apply(this,arguments);};filename=source.filename,markup=source.source;tag_regex=tag_name==='style'?/<!--[^]*?-->|<style(\\s[^]*?)?(?:>([^]*?)<\\/style>|\\/>)/gi:/<!--[^]*?-->|<script(\\s[^]*?)?(?:>([^]*?)<\\/script>|\\/>)/gi;dependencies=[];_context3.next=7;return replace_in_code(tag_regex,process_single_tag,source);case 7:_yield$replace_in_cod=_context3.sent;string=_yield$replace_in_cod.string;map=_yield$replace_in_cod.map;return _context3.abrupt(\"return\",{string:string,map:map,dependencies:dependencies});case 11:case\"end\":return _context3.stop();}}},_callee3);}));return _process_tag.apply(this,arguments);}function process_markup(_x7,_x8){return _process_markup.apply(this,arguments);}function _process_markup(){_process_markup=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function _callee4(process,source){var processed;return _regenerator.default.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return process({content:source.source,filename:source.filename});case 2:processed=_context4.sent;if(!processed){_context4.next=7;break;}return _context4.abrupt(\"return\",{string:processed.code,map:processed.map?// TODO: can we use decode_sourcemap?\ntypeof processed.map==='string'?JSON.parse(processed.map):processed.map:undefined,dependencies:processed.dependencies});case 7:return _context4.abrupt(\"return\",{});case 8:case\"end\":return _context4.stop();}}},_callee4);}));return _process_markup.apply(this,arguments);}function preprocess(_x9,_x10,_x11){return _preprocess.apply(this,arguments);}function _preprocess(){_preprocess=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function _callee5(source,preprocessor,options){var filename,preprocessors,markup,script,style,result,_iterator28,_step28,_process,_iterator29,_step29,_process2,_iterator30,_step30,_preprocess2;return _regenerator.default.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:filename=options&&options.filename||preprocessor.filename;// legacy\npreprocessors=preprocessor?Array.isArray(preprocessor)?preprocessor:[preprocessor]:[];markup=preprocessors.map(function(p){return p.markup;}).filter(Boolean);script=preprocessors.map(function(p){return p.script;}).filter(Boolean);style=preprocessors.map(function(p){return p.style;}).filter(Boolean);result=new PreprocessResult(source,filename);// TODO keep track: what preprocessor generated what sourcemap?\n// to make debugging easier = detect low-resolution sourcemaps in fn combine_mappings\n_iterator28=_createForOfIteratorHelper(markup);_context5.prev=7;_iterator28.s();case 9:if((_step28=_iterator28.n()).done){_context5.next=18;break;}_process=_step28.value;_context5.t0=result;_context5.next=14;return process_markup(_process,result);case 14:_context5.t1=_context5.sent;_context5.t0.update_source.call(_context5.t0,_context5.t1);case 16:_context5.next=9;break;case 18:_context5.next=23;break;case 20:_context5.prev=20;_context5.t2=_context5[\"catch\"](7);_iterator28.e(_context5.t2);case 23:_context5.prev=23;_iterator28.f();return _context5.finish(23);case 26:_iterator29=_createForOfIteratorHelper(script);_context5.prev=27;_iterator29.s();case 29:if((_step29=_iterator29.n()).done){_context5.next=38;break;}_process2=_step29.value;_context5.t3=result;_context5.next=34;return process_tag('script',_process2,result);case 34:_context5.t4=_context5.sent;_context5.t3.update_source.call(_context5.t3,_context5.t4);case 36:_context5.next=29;break;case 38:_context5.next=43;break;case 40:_context5.prev=40;_context5.t5=_context5[\"catch\"](27);_iterator29.e(_context5.t5);case 43:_context5.prev=43;_iterator29.f();return _context5.finish(43);case 46:_iterator30=_createForOfIteratorHelper(style);_context5.prev=47;_iterator30.s();case 49:if((_step30=_iterator30.n()).done){_context5.next=58;break;}_preprocess2=_step30.value;_context5.t6=result;_context5.next=54;return process_tag('style',_preprocess2,result);case 54:_context5.t7=_context5.sent;_context5.t6.update_source.call(_context5.t6,_context5.t7);case 56:_context5.next=49;break;case 58:_context5.next=63;break;case 60:_context5.prev=60;_context5.t8=_context5[\"catch\"](47);_iterator30.e(_context5.t8);case 63:_context5.prev=63;_iterator30.f();return _context5.finish(63);case 66:return _context5.abrupt(\"return\",result.to_processed());case 67:case\"end\":return _context5.stop();}}},_callee5,null,[[7,20,23,26],[27,40,43,46],[47,60,63,66]]);}));return _preprocess.apply(this,arguments);}var VERSION='3.46.2';exports.VERSION=VERSION;\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../process/browser.js */ \"./node_modules/process/browser.js\"), __webpack_require__(/*! ./../buffer/index.js */ \"./node_modules/buffer/index.js\").Buffer))//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvc3ZlbHRlL2NvbXBpbGVyLm1qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9zdmVsdGUvY29tcGlsZXIubWpzP2FlMTgiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgbm93ID0gKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzLmhydGltZSlcbiAgICA/ICgpID0+IHtcbiAgICAgICAgY29uc3QgdCA9IHByb2Nlc3MuaHJ0aW1lKCk7XG4gICAgICAgIHJldHVybiB0WzBdICogMWUzICsgdFsxXSAvIDFlNjtcbiAgICB9XG4gICAgOiAoKSA9PiBzZWxmLnBlcmZvcm1hbmNlLm5vdygpO1xuZnVuY3Rpb24gY29sbGFwc2VfdGltaW5ncyh0aW1pbmdzKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgdGltaW5ncy5mb3JFYWNoKHRpbWluZyA9PiB7XG4gICAgICAgIHJlc3VsdFt0aW1pbmcubGFiZWxdID0gT2JqZWN0LmFzc2lnbih7XG4gICAgICAgICAgICB0b3RhbDogdGltaW5nLmVuZCAtIHRpbWluZy5zdGFydFxuICAgICAgICB9LCB0aW1pbmcuY2hpbGRyZW4gJiYgY29sbGFwc2VfdGltaW5ncyh0aW1pbmcuY2hpbGRyZW4pKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xufVxuY2xhc3MgU3RhdHMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnN0YXJ0X3RpbWUgPSBub3coKTtcbiAgICAgICAgdGhpcy5zdGFjayA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRfY2hpbGRyZW4gPSB0aGlzLnRpbWluZ3MgPSBbXTtcbiAgICB9XG4gICAgc3RhcnQobGFiZWwpIHtcbiAgICAgICAgY29uc3QgdGltaW5nID0ge1xuICAgICAgICAgICAgbGFiZWwsXG4gICAgICAgICAgICBzdGFydDogbm93KCksXG4gICAgICAgICAgICBlbmQ6IG51bGwsXG4gICAgICAgICAgICBjaGlsZHJlbjogW11cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jdXJyZW50X2NoaWxkcmVuLnB1c2godGltaW5nKTtcbiAgICAgICAgdGhpcy5zdGFjay5wdXNoKHRpbWluZyk7XG4gICAgICAgIHRoaXMuY3VycmVudF90aW1pbmcgPSB0aW1pbmc7XG4gICAgICAgIHRoaXMuY3VycmVudF9jaGlsZHJlbiA9IHRpbWluZy5jaGlsZHJlbjtcbiAgICB9XG4gICAgc3RvcChsYWJlbCkge1xuICAgICAgICBpZiAobGFiZWwgIT09IHRoaXMuY3VycmVudF90aW1pbmcubGFiZWwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTWlzbWF0Y2hlZCB0aW1pbmcgbGFiZWxzIChleHBlY3RlZCAke3RoaXMuY3VycmVudF90aW1pbmcubGFiZWx9LCBnb3QgJHtsYWJlbH0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jdXJyZW50X3RpbWluZy5lbmQgPSBub3coKTtcbiAgICAgICAgdGhpcy5zdGFjay5wb3AoKTtcbiAgICAgICAgdGhpcy5jdXJyZW50X3RpbWluZyA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXTtcbiAgICAgICAgdGhpcy5jdXJyZW50X2NoaWxkcmVuID0gdGhpcy5jdXJyZW50X3RpbWluZyA/IHRoaXMuY3VycmVudF90aW1pbmcuY2hpbGRyZW4gOiB0aGlzLnRpbWluZ3M7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgdGltaW5ncyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgICAgICAgdG90YWw6IG5vdygpIC0gdGhpcy5zdGFydF90aW1lXG4gICAgICAgIH0sIGNvbGxhcHNlX3RpbWluZ3ModGhpcy50aW1pbmdzKSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0aW1pbmdzXG4gICAgICAgIH07XG4gICAgfVxufVxuXG4vLyBSZXNlcnZlZCB3b3JkIGxpc3RzIGZvciB2YXJpb3VzIGRpYWxlY3RzIG9mIHRoZSBsYW5ndWFnZVxuXG52YXIgcmVzZXJ2ZWRXb3JkcyA9IHtcbiAgMzogXCJhYnN0cmFjdCBib29sZWFuIGJ5dGUgY2hhciBjbGFzcyBkb3VibGUgZW51bSBleHBvcnQgZXh0ZW5kcyBmaW5hbCBmbG9hdCBnb3RvIGltcGxlbWVudHMgaW1wb3J0IGludCBpbnRlcmZhY2UgbG9uZyBuYXRpdmUgcGFja2FnZSBwcml2YXRlIHByb3RlY3RlZCBwdWJsaWMgc2hvcnQgc3RhdGljIHN1cGVyIHN5bmNocm9uaXplZCB0aHJvd3MgdHJhbnNpZW50IHZvbGF0aWxlXCIsXG4gIDU6IFwiY2xhc3MgZW51bSBleHRlbmRzIHN1cGVyIGNvbnN0IGV4cG9ydCBpbXBvcnRcIixcbiAgNjogXCJlbnVtXCIsXG4gIHN0cmljdDogXCJpbXBsZW1lbnRzIGludGVyZmFjZSBsZXQgcGFja2FnZSBwcml2YXRlIHByb3RlY3RlZCBwdWJsaWMgc3RhdGljIHlpZWxkXCIsXG4gIHN0cmljdEJpbmQ6IFwiZXZhbCBhcmd1bWVudHNcIlxufTtcblxuLy8gQW5kIHRoZSBrZXl3b3Jkc1xuXG52YXIgZWNtYTVBbmRMZXNzS2V5d29yZHMgPSBcImJyZWFrIGNhc2UgY2F0Y2ggY29udGludWUgZGVidWdnZXIgZGVmYXVsdCBkbyBlbHNlIGZpbmFsbHkgZm9yIGZ1bmN0aW9uIGlmIHJldHVybiBzd2l0Y2ggdGhyb3cgdHJ5IHZhciB3aGlsZSB3aXRoIG51bGwgdHJ1ZSBmYWxzZSBpbnN0YW5jZW9mIHR5cGVvZiB2b2lkIGRlbGV0ZSBuZXcgaW4gdGhpc1wiO1xuXG52YXIga2V5d29yZHMgPSB7XG4gIDU6IGVjbWE1QW5kTGVzc0tleXdvcmRzLFxuICBcIjVtb2R1bGVcIjogZWNtYTVBbmRMZXNzS2V5d29yZHMgKyBcIiBleHBvcnQgaW1wb3J0XCIsXG4gIDY6IGVjbWE1QW5kTGVzc0tleXdvcmRzICsgXCIgY29uc3QgY2xhc3MgZXh0ZW5kcyBleHBvcnQgaW1wb3J0IHN1cGVyXCJcbn07XG5cbnZhciBrZXl3b3JkUmVsYXRpb25hbE9wZXJhdG9yID0gL15pbihzdGFuY2VvZik/JC87XG5cbi8vICMjIENoYXJhY3RlciBjYXRlZ29yaWVzXG5cbi8vIEJpZyB1Z2x5IHJlZ3VsYXIgZXhwcmVzc2lvbnMgdGhhdCBtYXRjaCBjaGFyYWN0ZXJzIGluIHRoZVxuLy8gd2hpdGVzcGFjZSwgaWRlbnRpZmllciwgYW5kIGlkZW50aWZpZXItc3RhcnQgY2F0ZWdvcmllcy4gVGhlc2Vcbi8vIGFyZSBvbmx5IGFwcGxpZWQgd2hlbiBhIGNoYXJhY3RlciBpcyBmb3VuZCB0byBhY3R1YWxseSBoYXZlIGFcbi8vIGNvZGUgcG9pbnQgYWJvdmUgMTI4LlxuLy8gR2VuZXJhdGVkIGJ5IGBiaW4vZ2VuZXJhdGUtaWRlbnRpZmllci1yZWdleC5qc2AuXG52YXIgbm9uQVNDSUlpZGVudGlmaWVyU3RhcnRDaGFycyA9IFwiXFx4YWFcXHhiNVxceGJhXFx4YzAtXFx4ZDZcXHhkOC1cXHhmNlxceGY4LVxcdTAyYzFcXHUwMmM2LVxcdTAyZDFcXHUwMmUwLVxcdTAyZTRcXHUwMmVjXFx1MDJlZVxcdTAzNzAtXFx1MDM3NFxcdTAzNzZcXHUwMzc3XFx1MDM3YS1cXHUwMzdkXFx1MDM3ZlxcdTAzODZcXHUwMzg4LVxcdTAzOGFcXHUwMzhjXFx1MDM4ZS1cXHUwM2ExXFx1MDNhMy1cXHUwM2Y1XFx1MDNmNy1cXHUwNDgxXFx1MDQ4YS1cXHUwNTJmXFx1MDUzMS1cXHUwNTU2XFx1MDU1OVxcdTA1NjAtXFx1MDU4OFxcdTA1ZDAtXFx1MDVlYVxcdTA1ZWYtXFx1MDVmMlxcdTA2MjAtXFx1MDY0YVxcdTA2NmVcXHUwNjZmXFx1MDY3MS1cXHUwNmQzXFx1MDZkNVxcdTA2ZTVcXHUwNmU2XFx1MDZlZVxcdTA2ZWZcXHUwNmZhLVxcdTA2ZmNcXHUwNmZmXFx1MDcxMFxcdTA3MTItXFx1MDcyZlxcdTA3NGQtXFx1MDdhNVxcdTA3YjFcXHUwN2NhLVxcdTA3ZWFcXHUwN2Y0XFx1MDdmNVxcdTA3ZmFcXHUwODAwLVxcdTA4MTVcXHUwODFhXFx1MDgyNFxcdTA4MjhcXHUwODQwLVxcdTA4NThcXHUwODYwLVxcdTA4NmFcXHUwOGEwLVxcdTA4YjRcXHUwOGI2LVxcdTA4YzdcXHUwOTA0LVxcdTA5MzlcXHUwOTNkXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NzEtXFx1MDk4MFxcdTA5ODUtXFx1MDk4Y1xcdTA5OGZcXHUwOTkwXFx1MDk5My1cXHUwOWE4XFx1MDlhYS1cXHUwOWIwXFx1MDliMlxcdTA5YjYtXFx1MDliOVxcdTA5YmRcXHUwOWNlXFx1MDlkY1xcdTA5ZGRcXHUwOWRmLVxcdTA5ZTFcXHUwOWYwXFx1MDlmMVxcdTA5ZmNcXHUwYTA1LVxcdTBhMGFcXHUwYTBmXFx1MGExMFxcdTBhMTMtXFx1MGEyOFxcdTBhMmEtXFx1MGEzMFxcdTBhMzJcXHUwYTMzXFx1MGEzNVxcdTBhMzZcXHUwYTM4XFx1MGEzOVxcdTBhNTktXFx1MGE1Y1xcdTBhNWVcXHUwYTcyLVxcdTBhNzRcXHUwYTg1LVxcdTBhOGRcXHUwYThmLVxcdTBhOTFcXHUwYTkzLVxcdTBhYThcXHUwYWFhLVxcdTBhYjBcXHUwYWIyXFx1MGFiM1xcdTBhYjUtXFx1MGFiOVxcdTBhYmRcXHUwYWQwXFx1MGFlMFxcdTBhZTFcXHUwYWY5XFx1MGIwNS1cXHUwYjBjXFx1MGIwZlxcdTBiMTBcXHUwYjEzLVxcdTBiMjhcXHUwYjJhLVxcdTBiMzBcXHUwYjMyXFx1MGIzM1xcdTBiMzUtXFx1MGIzOVxcdTBiM2RcXHUwYjVjXFx1MGI1ZFxcdTBiNWYtXFx1MGI2MVxcdTBiNzFcXHUwYjgzXFx1MGI4NS1cXHUwYjhhXFx1MGI4ZS1cXHUwYjkwXFx1MGI5Mi1cXHUwYjk1XFx1MGI5OVxcdTBiOWFcXHUwYjljXFx1MGI5ZVxcdTBiOWZcXHUwYmEzXFx1MGJhNFxcdTBiYTgtXFx1MGJhYVxcdTBiYWUtXFx1MGJiOVxcdTBiZDBcXHUwYzA1LVxcdTBjMGNcXHUwYzBlLVxcdTBjMTBcXHUwYzEyLVxcdTBjMjhcXHUwYzJhLVxcdTBjMzlcXHUwYzNkXFx1MGM1OC1cXHUwYzVhXFx1MGM2MFxcdTBjNjFcXHUwYzgwXFx1MGM4NS1cXHUwYzhjXFx1MGM4ZS1cXHUwYzkwXFx1MGM5Mi1cXHUwY2E4XFx1MGNhYS1cXHUwY2IzXFx1MGNiNS1cXHUwY2I5XFx1MGNiZFxcdTBjZGVcXHUwY2UwXFx1MGNlMVxcdTBjZjFcXHUwY2YyXFx1MGQwNC1cXHUwZDBjXFx1MGQwZS1cXHUwZDEwXFx1MGQxMi1cXHUwZDNhXFx1MGQzZFxcdTBkNGVcXHUwZDU0LVxcdTBkNTZcXHUwZDVmLVxcdTBkNjFcXHUwZDdhLVxcdTBkN2ZcXHUwZDg1LVxcdTBkOTZcXHUwZDlhLVxcdTBkYjFcXHUwZGIzLVxcdTBkYmJcXHUwZGJkXFx1MGRjMC1cXHUwZGM2XFx1MGUwMS1cXHUwZTMwXFx1MGUzMlxcdTBlMzNcXHUwZTQwLVxcdTBlNDZcXHUwZTgxXFx1MGU4MlxcdTBlODRcXHUwZTg2LVxcdTBlOGFcXHUwZThjLVxcdTBlYTNcXHUwZWE1XFx1MGVhNy1cXHUwZWIwXFx1MGViMlxcdTBlYjNcXHUwZWJkXFx1MGVjMC1cXHUwZWM0XFx1MGVjNlxcdTBlZGMtXFx1MGVkZlxcdTBmMDBcXHUwZjQwLVxcdTBmNDdcXHUwZjQ5LVxcdTBmNmNcXHUwZjg4LVxcdTBmOGNcXHUxMDAwLVxcdTEwMmFcXHUxMDNmXFx1MTA1MC1cXHUxMDU1XFx1MTA1YS1cXHUxMDVkXFx1MTA2MVxcdTEwNjVcXHUxMDY2XFx1MTA2ZS1cXHUxMDcwXFx1MTA3NS1cXHUxMDgxXFx1MTA4ZVxcdTEwYTAtXFx1MTBjNVxcdTEwYzdcXHUxMGNkXFx1MTBkMC1cXHUxMGZhXFx1MTBmYy1cXHUxMjQ4XFx1MTI0YS1cXHUxMjRkXFx1MTI1MC1cXHUxMjU2XFx1MTI1OFxcdTEyNWEtXFx1MTI1ZFxcdTEyNjAtXFx1MTI4OFxcdTEyOGEtXFx1MTI4ZFxcdTEyOTAtXFx1MTJiMFxcdTEyYjItXFx1MTJiNVxcdTEyYjgtXFx1MTJiZVxcdTEyYzBcXHUxMmMyLVxcdTEyYzVcXHUxMmM4LVxcdTEyZDZcXHUxMmQ4LVxcdTEzMTBcXHUxMzEyLVxcdTEzMTVcXHUxMzE4LVxcdTEzNWFcXHUxMzgwLVxcdTEzOGZcXHUxM2EwLVxcdTEzZjVcXHUxM2Y4LVxcdTEzZmRcXHUxNDAxLVxcdTE2NmNcXHUxNjZmLVxcdTE2N2ZcXHUxNjgxLVxcdTE2OWFcXHUxNmEwLVxcdTE2ZWFcXHUxNmVlLVxcdTE2ZjhcXHUxNzAwLVxcdTE3MGNcXHUxNzBlLVxcdTE3MTFcXHUxNzIwLVxcdTE3MzFcXHUxNzQwLVxcdTE3NTFcXHUxNzYwLVxcdTE3NmNcXHUxNzZlLVxcdTE3NzBcXHUxNzgwLVxcdTE3YjNcXHUxN2Q3XFx1MTdkY1xcdTE4MjAtXFx1MTg3OFxcdTE4ODAtXFx1MThhOFxcdTE4YWFcXHUxOGIwLVxcdTE4ZjVcXHUxOTAwLVxcdTE5MWVcXHUxOTUwLVxcdTE5NmRcXHUxOTcwLVxcdTE5NzRcXHUxOTgwLVxcdTE5YWJcXHUxOWIwLVxcdTE5YzlcXHUxYTAwLVxcdTFhMTZcXHUxYTIwLVxcdTFhNTRcXHUxYWE3XFx1MWIwNS1cXHUxYjMzXFx1MWI0NS1cXHUxYjRiXFx1MWI4My1cXHUxYmEwXFx1MWJhZVxcdTFiYWZcXHUxYmJhLVxcdTFiZTVcXHUxYzAwLVxcdTFjMjNcXHUxYzRkLVxcdTFjNGZcXHUxYzVhLVxcdTFjN2RcXHUxYzgwLVxcdTFjODhcXHUxYzkwLVxcdTFjYmFcXHUxY2JkLVxcdTFjYmZcXHUxY2U5LVxcdTFjZWNcXHUxY2VlLVxcdTFjZjNcXHUxY2Y1XFx1MWNmNlxcdTFjZmFcXHUxZDAwLVxcdTFkYmZcXHUxZTAwLVxcdTFmMTVcXHUxZjE4LVxcdTFmMWRcXHUxZjIwLVxcdTFmNDVcXHUxZjQ4LVxcdTFmNGRcXHUxZjUwLVxcdTFmNTdcXHUxZjU5XFx1MWY1YlxcdTFmNWRcXHUxZjVmLVxcdTFmN2RcXHUxZjgwLVxcdTFmYjRcXHUxZmI2LVxcdTFmYmNcXHUxZmJlXFx1MWZjMi1cXHUxZmM0XFx1MWZjNi1cXHUxZmNjXFx1MWZkMC1cXHUxZmQzXFx1MWZkNi1cXHUxZmRiXFx1MWZlMC1cXHUxZmVjXFx1MWZmMi1cXHUxZmY0XFx1MWZmNi1cXHUxZmZjXFx1MjA3MVxcdTIwN2ZcXHUyMDkwLVxcdTIwOWNcXHUyMTAyXFx1MjEwN1xcdTIxMGEtXFx1MjExM1xcdTIxMTVcXHUyMTE4LVxcdTIxMWRcXHUyMTI0XFx1MjEyNlxcdTIxMjhcXHUyMTJhLVxcdTIxMzlcXHUyMTNjLVxcdTIxM2ZcXHUyMTQ1LVxcdTIxNDlcXHUyMTRlXFx1MjE2MC1cXHUyMTg4XFx1MmMwMC1cXHUyYzJlXFx1MmMzMC1cXHUyYzVlXFx1MmM2MC1cXHUyY2U0XFx1MmNlYi1cXHUyY2VlXFx1MmNmMlxcdTJjZjNcXHUyZDAwLVxcdTJkMjVcXHUyZDI3XFx1MmQyZFxcdTJkMzAtXFx1MmQ2N1xcdTJkNmZcXHUyZDgwLVxcdTJkOTZcXHUyZGEwLVxcdTJkYTZcXHUyZGE4LVxcdTJkYWVcXHUyZGIwLVxcdTJkYjZcXHUyZGI4LVxcdTJkYmVcXHUyZGMwLVxcdTJkYzZcXHUyZGM4LVxcdTJkY2VcXHUyZGQwLVxcdTJkZDZcXHUyZGQ4LVxcdTJkZGVcXHUzMDA1LVxcdTMwMDdcXHUzMDIxLVxcdTMwMjlcXHUzMDMxLVxcdTMwMzVcXHUzMDM4LVxcdTMwM2NcXHUzMDQxLVxcdTMwOTZcXHUzMDliLVxcdTMwOWZcXHUzMGExLVxcdTMwZmFcXHUzMGZjLVxcdTMwZmZcXHUzMTA1LVxcdTMxMmZcXHUzMTMxLVxcdTMxOGVcXHUzMWEwLVxcdTMxYmZcXHUzMWYwLVxcdTMxZmZcXHUzNDAwLVxcdTRkYmZcXHU0ZTAwLVxcdTlmZmNcXHVhMDAwLVxcdWE0OGNcXHVhNGQwLVxcdWE0ZmRcXHVhNTAwLVxcdWE2MGNcXHVhNjEwLVxcdWE2MWZcXHVhNjJhXFx1YTYyYlxcdWE2NDAtXFx1YTY2ZVxcdWE2N2YtXFx1YTY5ZFxcdWE2YTAtXFx1YTZlZlxcdWE3MTctXFx1YTcxZlxcdWE3MjItXFx1YTc4OFxcdWE3OGItXFx1YTdiZlxcdWE3YzItXFx1YTdjYVxcdWE3ZjUtXFx1YTgwMVxcdWE4MDMtXFx1YTgwNVxcdWE4MDctXFx1YTgwYVxcdWE4MGMtXFx1YTgyMlxcdWE4NDAtXFx1YTg3M1xcdWE4ODItXFx1YThiM1xcdWE4ZjItXFx1YThmN1xcdWE4ZmJcXHVhOGZkXFx1YThmZVxcdWE5MGEtXFx1YTkyNVxcdWE5MzAtXFx1YTk0NlxcdWE5NjAtXFx1YTk3Y1xcdWE5ODQtXFx1YTliMlxcdWE5Y2ZcXHVhOWUwLVxcdWE5ZTRcXHVhOWU2LVxcdWE5ZWZcXHVhOWZhLVxcdWE5ZmVcXHVhYTAwLVxcdWFhMjhcXHVhYTQwLVxcdWFhNDJcXHVhYTQ0LVxcdWFhNGJcXHVhYTYwLVxcdWFhNzZcXHVhYTdhXFx1YWE3ZS1cXHVhYWFmXFx1YWFiMVxcdWFhYjVcXHVhYWI2XFx1YWFiOS1cXHVhYWJkXFx1YWFjMFxcdWFhYzJcXHVhYWRiLVxcdWFhZGRcXHVhYWUwLVxcdWFhZWFcXHVhYWYyLVxcdWFhZjRcXHVhYjAxLVxcdWFiMDZcXHVhYjA5LVxcdWFiMGVcXHVhYjExLVxcdWFiMTZcXHVhYjIwLVxcdWFiMjZcXHVhYjI4LVxcdWFiMmVcXHVhYjMwLVxcdWFiNWFcXHVhYjVjLVxcdWFiNjlcXHVhYjcwLVxcdWFiZTJcXHVhYzAwLVxcdWQ3YTNcXHVkN2IwLVxcdWQ3YzZcXHVkN2NiLVxcdWQ3ZmJcXHVmOTAwLVxcdWZhNmRcXHVmYTcwLVxcdWZhZDlcXHVmYjAwLVxcdWZiMDZcXHVmYjEzLVxcdWZiMTdcXHVmYjFkXFx1ZmIxZi1cXHVmYjI4XFx1ZmIyYS1cXHVmYjM2XFx1ZmIzOC1cXHVmYjNjXFx1ZmIzZVxcdWZiNDBcXHVmYjQxXFx1ZmI0M1xcdWZiNDRcXHVmYjQ2LVxcdWZiYjFcXHVmYmQzLVxcdWZkM2RcXHVmZDUwLVxcdWZkOGZcXHVmZDkyLVxcdWZkYzdcXHVmZGYwLVxcdWZkZmJcXHVmZTcwLVxcdWZlNzRcXHVmZTc2LVxcdWZlZmNcXHVmZjIxLVxcdWZmM2FcXHVmZjQxLVxcdWZmNWFcXHVmZjY2LVxcdWZmYmVcXHVmZmMyLVxcdWZmYzdcXHVmZmNhLVxcdWZmY2ZcXHVmZmQyLVxcdWZmZDdcXHVmZmRhLVxcdWZmZGNcIjtcbnZhciBub25BU0NJSWlkZW50aWZpZXJDaGFycyA9IFwiXFx1MjAwY1xcdTIwMGRcXHhiN1xcdTAzMDAtXFx1MDM2ZlxcdTAzODdcXHUwNDgzLVxcdTA0ODdcXHUwNTkxLVxcdTA1YmRcXHUwNWJmXFx1MDVjMVxcdTA1YzJcXHUwNWM0XFx1MDVjNVxcdTA1YzdcXHUwNjEwLVxcdTA2MWFcXHUwNjRiLVxcdTA2NjlcXHUwNjcwXFx1MDZkNi1cXHUwNmRjXFx1MDZkZi1cXHUwNmU0XFx1MDZlN1xcdTA2ZThcXHUwNmVhLVxcdTA2ZWRcXHUwNmYwLVxcdTA2ZjlcXHUwNzExXFx1MDczMC1cXHUwNzRhXFx1MDdhNi1cXHUwN2IwXFx1MDdjMC1cXHUwN2M5XFx1MDdlYi1cXHUwN2YzXFx1MDdmZFxcdTA4MTYtXFx1MDgxOVxcdTA4MWItXFx1MDgyM1xcdTA4MjUtXFx1MDgyN1xcdTA4MjktXFx1MDgyZFxcdTA4NTktXFx1MDg1YlxcdTA4ZDMtXFx1MDhlMVxcdTA4ZTMtXFx1MDkwM1xcdTA5M2EtXFx1MDkzY1xcdTA5M2UtXFx1MDk0ZlxcdTA5NTEtXFx1MDk1N1xcdTA5NjJcXHUwOTYzXFx1MDk2Ni1cXHUwOTZmXFx1MDk4MS1cXHUwOTgzXFx1MDliY1xcdTA5YmUtXFx1MDljNFxcdTA5YzdcXHUwOWM4XFx1MDljYi1cXHUwOWNkXFx1MDlkN1xcdTA5ZTJcXHUwOWUzXFx1MDllNi1cXHUwOWVmXFx1MDlmZVxcdTBhMDEtXFx1MGEwM1xcdTBhM2NcXHUwYTNlLVxcdTBhNDJcXHUwYTQ3XFx1MGE0OFxcdTBhNGItXFx1MGE0ZFxcdTBhNTFcXHUwYTY2LVxcdTBhNzFcXHUwYTc1XFx1MGE4MS1cXHUwYTgzXFx1MGFiY1xcdTBhYmUtXFx1MGFjNVxcdTBhYzctXFx1MGFjOVxcdTBhY2ItXFx1MGFjZFxcdTBhZTJcXHUwYWUzXFx1MGFlNi1cXHUwYWVmXFx1MGFmYS1cXHUwYWZmXFx1MGIwMS1cXHUwYjAzXFx1MGIzY1xcdTBiM2UtXFx1MGI0NFxcdTBiNDdcXHUwYjQ4XFx1MGI0Yi1cXHUwYjRkXFx1MGI1NS1cXHUwYjU3XFx1MGI2MlxcdTBiNjNcXHUwYjY2LVxcdTBiNmZcXHUwYjgyXFx1MGJiZS1cXHUwYmMyXFx1MGJjNi1cXHUwYmM4XFx1MGJjYS1cXHUwYmNkXFx1MGJkN1xcdTBiZTYtXFx1MGJlZlxcdTBjMDAtXFx1MGMwNFxcdTBjM2UtXFx1MGM0NFxcdTBjNDYtXFx1MGM0OFxcdTBjNGEtXFx1MGM0ZFxcdTBjNTVcXHUwYzU2XFx1MGM2MlxcdTBjNjNcXHUwYzY2LVxcdTBjNmZcXHUwYzgxLVxcdTBjODNcXHUwY2JjXFx1MGNiZS1cXHUwY2M0XFx1MGNjNi1cXHUwY2M4XFx1MGNjYS1cXHUwY2NkXFx1MGNkNVxcdTBjZDZcXHUwY2UyXFx1MGNlM1xcdTBjZTYtXFx1MGNlZlxcdTBkMDAtXFx1MGQwM1xcdTBkM2JcXHUwZDNjXFx1MGQzZS1cXHUwZDQ0XFx1MGQ0Ni1cXHUwZDQ4XFx1MGQ0YS1cXHUwZDRkXFx1MGQ1N1xcdTBkNjJcXHUwZDYzXFx1MGQ2Ni1cXHUwZDZmXFx1MGQ4MS1cXHUwZDgzXFx1MGRjYVxcdTBkY2YtXFx1MGRkNFxcdTBkZDZcXHUwZGQ4LVxcdTBkZGZcXHUwZGU2LVxcdTBkZWZcXHUwZGYyXFx1MGRmM1xcdTBlMzFcXHUwZTM0LVxcdTBlM2FcXHUwZTQ3LVxcdTBlNGVcXHUwZTUwLVxcdTBlNTlcXHUwZWIxXFx1MGViNC1cXHUwZWJjXFx1MGVjOC1cXHUwZWNkXFx1MGVkMC1cXHUwZWQ5XFx1MGYxOFxcdTBmMTlcXHUwZjIwLVxcdTBmMjlcXHUwZjM1XFx1MGYzN1xcdTBmMzlcXHUwZjNlXFx1MGYzZlxcdTBmNzEtXFx1MGY4NFxcdTBmODZcXHUwZjg3XFx1MGY4ZC1cXHUwZjk3XFx1MGY5OS1cXHUwZmJjXFx1MGZjNlxcdTEwMmItXFx1MTAzZVxcdTEwNDAtXFx1MTA0OVxcdTEwNTYtXFx1MTA1OVxcdTEwNWUtXFx1MTA2MFxcdTEwNjItXFx1MTA2NFxcdTEwNjctXFx1MTA2ZFxcdTEwNzEtXFx1MTA3NFxcdTEwODItXFx1MTA4ZFxcdTEwOGYtXFx1MTA5ZFxcdTEzNWQtXFx1MTM1ZlxcdTEzNjktXFx1MTM3MVxcdTE3MTItXFx1MTcxNFxcdTE3MzItXFx1MTczNFxcdTE3NTJcXHUxNzUzXFx1MTc3MlxcdTE3NzNcXHUxN2I0LVxcdTE3ZDNcXHUxN2RkXFx1MTdlMC1cXHUxN2U5XFx1MTgwYi1cXHUxODBkXFx1MTgxMC1cXHUxODE5XFx1MThhOVxcdTE5MjAtXFx1MTkyYlxcdTE5MzAtXFx1MTkzYlxcdTE5NDYtXFx1MTk0ZlxcdTE5ZDAtXFx1MTlkYVxcdTFhMTctXFx1MWExYlxcdTFhNTUtXFx1MWE1ZVxcdTFhNjAtXFx1MWE3Y1xcdTFhN2YtXFx1MWE4OVxcdTFhOTAtXFx1MWE5OVxcdTFhYjAtXFx1MWFiZFxcdTFhYmZcXHUxYWMwXFx1MWIwMC1cXHUxYjA0XFx1MWIzNC1cXHUxYjQ0XFx1MWI1MC1cXHUxYjU5XFx1MWI2Yi1cXHUxYjczXFx1MWI4MC1cXHUxYjgyXFx1MWJhMS1cXHUxYmFkXFx1MWJiMC1cXHUxYmI5XFx1MWJlNi1cXHUxYmYzXFx1MWMyNC1cXHUxYzM3XFx1MWM0MC1cXHUxYzQ5XFx1MWM1MC1cXHUxYzU5XFx1MWNkMC1cXHUxY2QyXFx1MWNkNC1cXHUxY2U4XFx1MWNlZFxcdTFjZjRcXHUxY2Y3LVxcdTFjZjlcXHUxZGMwLVxcdTFkZjlcXHUxZGZiLVxcdTFkZmZcXHUyMDNmXFx1MjA0MFxcdTIwNTRcXHUyMGQwLVxcdTIwZGNcXHUyMGUxXFx1MjBlNS1cXHUyMGYwXFx1MmNlZi1cXHUyY2YxXFx1MmQ3ZlxcdTJkZTAtXFx1MmRmZlxcdTMwMmEtXFx1MzAyZlxcdTMwOTlcXHUzMDlhXFx1YTYyMC1cXHVhNjI5XFx1YTY2ZlxcdWE2NzQtXFx1YTY3ZFxcdWE2OWVcXHVhNjlmXFx1YTZmMFxcdWE2ZjFcXHVhODAyXFx1YTgwNlxcdWE4MGJcXHVhODIzLVxcdWE4MjdcXHVhODJjXFx1YTg4MFxcdWE4ODFcXHVhOGI0LVxcdWE4YzVcXHVhOGQwLVxcdWE4ZDlcXHVhOGUwLVxcdWE4ZjFcXHVhOGZmLVxcdWE5MDlcXHVhOTI2LVxcdWE5MmRcXHVhOTQ3LVxcdWE5NTNcXHVhOTgwLVxcdWE5ODNcXHVhOWIzLVxcdWE5YzBcXHVhOWQwLVxcdWE5ZDlcXHVhOWU1XFx1YTlmMC1cXHVhOWY5XFx1YWEyOS1cXHVhYTM2XFx1YWE0M1xcdWFhNGNcXHVhYTRkXFx1YWE1MC1cXHVhYTU5XFx1YWE3Yi1cXHVhYTdkXFx1YWFiMFxcdWFhYjItXFx1YWFiNFxcdWFhYjdcXHVhYWI4XFx1YWFiZVxcdWFhYmZcXHVhYWMxXFx1YWFlYi1cXHVhYWVmXFx1YWFmNVxcdWFhZjZcXHVhYmUzLVxcdWFiZWFcXHVhYmVjXFx1YWJlZFxcdWFiZjAtXFx1YWJmOVxcdWZiMWVcXHVmZTAwLVxcdWZlMGZcXHVmZTIwLVxcdWZlMmZcXHVmZTMzXFx1ZmUzNFxcdWZlNGQtXFx1ZmU0ZlxcdWZmMTAtXFx1ZmYxOVxcdWZmM2ZcIjtcblxudmFyIG5vbkFTQ0lJaWRlbnRpZmllclN0YXJ0ID0gbmV3IFJlZ0V4cChcIltcIiArIG5vbkFTQ0lJaWRlbnRpZmllclN0YXJ0Q2hhcnMgKyBcIl1cIik7XG52YXIgbm9uQVNDSUlpZGVudGlmaWVyID0gbmV3IFJlZ0V4cChcIltcIiArIG5vbkFTQ0lJaWRlbnRpZmllclN0YXJ0Q2hhcnMgKyBub25BU0NJSWlkZW50aWZpZXJDaGFycyArIFwiXVwiKTtcblxubm9uQVNDSUlpZGVudGlmaWVyU3RhcnRDaGFycyA9IG5vbkFTQ0lJaWRlbnRpZmllckNoYXJzID0gbnVsbDtcblxuLy8gVGhlc2UgYXJlIGEgcnVuLWxlbmd0aCBhbmQgb2Zmc2V0IGVuY29kZWQgcmVwcmVzZW50YXRpb24gb2YgdGhlXG4vLyA+MHhmZmZmIGNvZGUgcG9pbnRzIHRoYXQgYXJlIGEgdmFsaWQgcGFydCBvZiBpZGVudGlmaWVycy4gVGhlXG4vLyBvZmZzZXQgc3RhcnRzIGF0IDB4MTAwMDAsIGFuZCBlYWNoIHBhaXIgb2YgbnVtYmVycyByZXByZXNlbnRzIGFuXG4vLyBvZmZzZXQgdG8gdGhlIG5leHQgcmFuZ2UsIGFuZCB0aGVuIGEgc2l6ZSBvZiB0aGUgcmFuZ2UuIFRoZXkgd2VyZVxuLy8gZ2VuZXJhdGVkIGJ5IGJpbi9nZW5lcmF0ZS1pZGVudGlmaWVyLXJlZ2V4LmpzXG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21tYS1zcGFjaW5nXG52YXIgYXN0cmFsSWRlbnRpZmllclN0YXJ0Q29kZXMgPSBbMCwxMSwyLDI1LDIsMTgsMiwxLDIsMTQsMywxMywzNSwxMjIsNzAsNTIsMjY4LDI4LDQsNDgsNDgsMzEsMTQsMjksNiwzNywxMSwyOSwzLDM1LDUsNywyLDQsNDMsMTU3LDE5LDM1LDUsMzUsNSwzOSw5LDUxLDE1NywzMTAsMTAsMjEsMTEsNywxNTMsNSwzLDAsMiw0MywyLDEsNCwwLDMsMjIsMTEsMjIsMTAsMzAsNjYsMTgsMiwxLDExLDIxLDExLDI1LDcxLDU1LDcsMSw2NSwwLDE2LDMsMiwyLDIsMjgsNDMsMjgsNCwyOCwzNiw3LDIsMjcsMjgsNTMsMTEsMjEsMTEsMTgsMTQsMTcsMTExLDcyLDU2LDUwLDE0LDUwLDE0LDM1LDM0OSw0MSw3LDEsNzksMjgsMTEsMCw5LDIxLDEwNywyMCwyOCwyMiwxMyw1Miw3Niw0NCwzMywyNCwyNywzNSwzMCwwLDMsMCw5LDM0LDQsMCwxMyw0NywxNSwzLDIyLDAsMiwwLDM2LDE3LDIsMjQsODUsNiwyLDAsMiwzLDIsMTQsMiw5LDgsNDYsMzksNywzLDEsMywyMSwyLDYsMiwxLDIsNCw0LDAsMTksMCwxMyw0LDE1OSw1MiwxOSwzLDIxLDIsMzEsNDcsMjEsMSwyLDAsMTg1LDQ2LDQyLDMsMzcsNDcsMjEsMCw2MCw0MiwxNCwwLDcyLDI2LDIzMCw0MywxMTcsNjMsMzIsNywzLDAsMyw3LDIsMSwyLDIzLDE2LDAsMiwwLDk1LDcsMywzOCwxNywwLDIsMCwyOSwwLDExLDM5LDgsMCwyMiwwLDEyLDQ1LDIwLDAsMzUsNTYsMjY0LDgsMiwzNiwxOCwwLDUwLDI5LDExMyw2LDIsMSwyLDM3LDIyLDAsMjYsNSwyLDEsMiwzMSwxNSwwLDMyOCwxOCwxOTAsMCw4MCw5MjEsMTAzLDExMCwxOCwxOTUsMjc0OSwxMDcwLDQwNTAsNTgyLDg2MzQsNTY4LDgsMzAsMTE0LDI5LDE5LDQ3LDE3LDMsMzIsMjAsNiwxOCw2ODksNjMsMTI5LDc0LDYsMCw2NywxMiw2NSwxLDIsMCwyOSw2MTM1LDksMTIzNyw0Myw4LDg5NTIsMjg2LDUwLDIsMTgsMyw5LDM5NSwyMzA5LDEwNiw2LDEyLDQsOCw4LDksNTk5MSw4NCwyLDcwLDIsMSwzLDAsMywxLDMsMywyLDExLDIsMCwyLDYsMiw2NCwyLDMsMyw3LDIsNiwyLDI3LDIsMywyLDQsMiwwLDQsNiwyLDMzOSwzLDI0LDIsMjQsMiwzMCwyLDI0LDIsMzAsMiwyNCwyLDMwLDIsMjQsMiwzMCwyLDI0LDIsNywyMzU3LDQ0LDExLDYsMTcsMCwzNzAsNDMsMTMwMSwxOTYsNjAsNjcsOCwwLDEyMDUsMywyLDI2LDIsMSwyLDAsMywwLDIsOSwyLDMsMiwwLDIsMCw3LDAsNSwwLDIsMCwyLDAsMiwyLDIsMSwyLDAsMywwLDIsMCwyLDAsMiwwLDIsMCwyLDEsMiwwLDMsMywyLDYsMiwzLDIsMywyLDAsMiw5LDIsMTYsNiwyLDIsNCwyLDE2LDQ0MjEsNDI3MTcsMzUsNDE0OCwxMiwyMjEsMyw1NzYxLDE1LDc0NzIsMzEwNCw1NDEsMTUwNyw0OTM4XTtcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbW1hLXNwYWNpbmdcbnZhciBhc3RyYWxJZGVudGlmaWVyQ29kZXMgPSBbNTA5LDAsMjI3LDAsMTUwLDQsMjk0LDksMTM2OCwyLDIsMSw2LDMsNDEsMiw1LDAsMTY2LDEsNTc0LDMsOSw5LDM3MCwxLDE1NCwxMCwxNzYsMiw1NCwxNCwzMiw5LDE2LDMsNDYsMTAsNTQsOSw3LDIsMzcsMTMsMiw5LDYsMSw0NSwwLDEzLDIsNDksMTMsOSwzLDIsMTEsODMsMTEsNywwLDE2MSwxMSw2LDksNywzLDU2LDEsMiw2LDMsMSwzLDIsMTAsMCwxMSwxLDMsNiw0LDQsMTkzLDE3LDEwLDksNSwwLDgyLDE5LDEzLDksMjE0LDYsMyw4LDI4LDEsODMsMTYsMTYsOSw4MiwxMiw5LDksODQsMTQsNSw5LDI0MywxNCwxNjYsOSw3MSw1LDIsMSwzLDMsMiwwLDIsMSwxMyw5LDEyMCw2LDMsNiw0LDAsMjksOSw0MSw2LDIsMyw5LDAsMTAsMTAsNDcsMTUsNDA2LDcsMiw3LDE3LDksNTcsMjEsMiwxMywxMjMsNSw0LDAsMiwxLDIsNiwyLDAsOSw5LDQ5LDQsMiwxLDIsNCw5LDksMzMwLDMsMTkzMDYsOSwxMzUsNCw2MCw2LDI2LDksMTAxNCwwLDIsNTQsOCwzLDgyLDAsMTIsMSwxOTYyOCwxLDUzMTksNCw0LDUsOSw3LDMsNiwzMSwzLDE0OSwyLDE0MTgsNDksNTEzLDU0LDUsNDksOSwwLDE1LDAsMjMsNCwyLDE0LDEzNjEsNiwyLDE2LDMsNiwyLDEsMiw0LDI2Miw2LDEwLDksNDE5LDEzLDE0OTUsNiwxMTAsNiw2LDksNDc1OSw5LDc4NzcxOSwyMzldO1xuXG4vLyBUaGlzIGhhcyBhIGNvbXBsZXhpdHkgbGluZWFyIHRvIHRoZSB2YWx1ZSBvZiB0aGUgY29kZS4gVGhlXG4vLyBhc3N1bXB0aW9uIGlzIHRoYXQgbG9va2luZyB1cCBhc3RyYWwgaWRlbnRpZmllciBjaGFyYWN0ZXJzIGlzXG4vLyByYXJlLlxuZnVuY3Rpb24gaXNJbkFzdHJhbFNldChjb2RlLCBzZXQpIHtcbiAgdmFyIHBvcyA9IDB4MTAwMDA7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc2V0Lmxlbmd0aDsgaSArPSAyKSB7XG4gICAgcG9zICs9IHNldFtpXTtcbiAgICBpZiAocG9zID4gY29kZSkgeyByZXR1cm4gZmFsc2UgfVxuICAgIHBvcyArPSBzZXRbaSArIDFdO1xuICAgIGlmIChwb3MgPj0gY29kZSkgeyByZXR1cm4gdHJ1ZSB9XG4gIH1cbn1cblxuLy8gVGVzdCB3aGV0aGVyIGEgZ2l2ZW4gY2hhcmFjdGVyIGNvZGUgc3RhcnRzIGFuIGlkZW50aWZpZXIuXG5cbmZ1bmN0aW9uIGlzSWRlbnRpZmllclN0YXJ0KGNvZGUsIGFzdHJhbCkge1xuICBpZiAoY29kZSA8IDY1KSB7IHJldHVybiBjb2RlID09PSAzNiB9XG4gIGlmIChjb2RlIDwgOTEpIHsgcmV0dXJuIHRydWUgfVxuICBpZiAoY29kZSA8IDk3KSB7IHJldHVybiBjb2RlID09PSA5NSB9XG4gIGlmIChjb2RlIDwgMTIzKSB7IHJldHVybiB0cnVlIH1cbiAgaWYgKGNvZGUgPD0gMHhmZmZmKSB7IHJldHVybiBjb2RlID49IDB4YWEgJiYgbm9uQVNDSUlpZGVudGlmaWVyU3RhcnQudGVzdChTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpKSB9XG4gIGlmIChhc3RyYWwgPT09IGZhbHNlKSB7IHJldHVybiBmYWxzZSB9XG4gIHJldHVybiBpc0luQXN0cmFsU2V0KGNvZGUsIGFzdHJhbElkZW50aWZpZXJTdGFydENvZGVzKVxufVxuXG4vLyBUZXN0IHdoZXRoZXIgYSBnaXZlbiBjaGFyYWN0ZXIgaXMgcGFydCBvZiBhbiBpZGVudGlmaWVyLlxuXG5mdW5jdGlvbiBpc0lkZW50aWZpZXJDaGFyKGNvZGUsIGFzdHJhbCkge1xuICBpZiAoY29kZSA8IDQ4KSB7IHJldHVybiBjb2RlID09PSAzNiB9XG4gIGlmIChjb2RlIDwgNTgpIHsgcmV0dXJuIHRydWUgfVxuICBpZiAoY29kZSA8IDY1KSB7IHJldHVybiBmYWxzZSB9XG4gIGlmIChjb2RlIDwgOTEpIHsgcmV0dXJuIHRydWUgfVxuICBpZiAoY29kZSA8IDk3KSB7IHJldHVybiBjb2RlID09PSA5NSB9XG4gIGlmIChjb2RlIDwgMTIzKSB7IHJldHVybiB0cnVlIH1cbiAgaWYgKGNvZGUgPD0gMHhmZmZmKSB7IHJldHVybiBjb2RlID49IDB4YWEgJiYgbm9uQVNDSUlpZGVudGlmaWVyLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSkgfVxuICBpZiAoYXN0cmFsID09PSBmYWxzZSkgeyByZXR1cm4gZmFsc2UgfVxuICByZXR1cm4gaXNJbkFzdHJhbFNldChjb2RlLCBhc3RyYWxJZGVudGlmaWVyU3RhcnRDb2RlcykgfHwgaXNJbkFzdHJhbFNldChjb2RlLCBhc3RyYWxJZGVudGlmaWVyQ29kZXMpXG59XG5cbi8vICMjIFRva2VuIHR5cGVzXG5cbi8vIFRoZSBhc3NpZ25tZW50IG9mIGZpbmUtZ3JhaW5lZCwgaW5mb3JtYXRpb24tY2FycnlpbmcgdHlwZSBvYmplY3RzXG4vLyBhbGxvd3MgdGhlIHRva2VuaXplciB0byBzdG9yZSB0aGUgaW5mb3JtYXRpb24gaXQgaGFzIGFib3V0IGFcbi8vIHRva2VuIGluIGEgd2F5IHRoYXQgaXMgdmVyeSBjaGVhcCBmb3IgdGhlIHBhcnNlciB0byBsb29rIHVwLlxuXG4vLyBBbGwgdG9rZW4gdHlwZSB2YXJpYWJsZXMgc3RhcnQgd2l0aCBhbiB1bmRlcnNjb3JlLCB0byBtYWtlIHRoZW1cbi8vIGVhc3kgdG8gcmVjb2duaXplLlxuXG4vLyBUaGUgYGJlZm9yZUV4cHJgIHByb3BlcnR5IGlzIHVzZWQgdG8gZGlzYW1iaWd1YXRlIGJldHdlZW4gcmVndWxhclxuLy8gZXhwcmVzc2lvbnMgYW5kIGRpdmlzaW9ucy4gSXQgaXMgc2V0IG9uIGFsbCB0b2tlbiB0eXBlcyB0aGF0IGNhblxuLy8gYmUgZm9sbG93ZWQgYnkgYW4gZXhwcmVzc2lvbiAodGh1cywgYSBzbGFzaCBhZnRlciB0aGVtIHdvdWxkIGJlIGFcbi8vIHJlZ3VsYXIgZXhwcmVzc2lvbikuXG4vL1xuLy8gVGhlIGBzdGFydHNFeHByYCBwcm9wZXJ0eSBpcyB1c2VkIHRvIGNoZWNrIGlmIHRoZSB0b2tlbiBlbmRzIGFcbi8vIGB5aWVsZGAgZXhwcmVzc2lvbi4gSXQgaXMgc2V0IG9uIGFsbCB0b2tlbiB0eXBlcyB0aGF0IGVpdGhlciBjYW5cbi8vIGRpcmVjdGx5IHN0YXJ0IGFuIGV4cHJlc3Npb24gKGxpa2UgYSBxdW90YXRpb24gbWFyaykgb3IgY2FuXG4vLyBjb250aW51ZSBhbiBleHByZXNzaW9uIChsaWtlIHRoZSBib2R5IG9mIGEgc3RyaW5nKS5cbi8vXG4vLyBgaXNMb29wYCBtYXJrcyBhIGtleXdvcmQgYXMgc3RhcnRpbmcgYSBsb29wLCB3aGljaCBpcyBpbXBvcnRhbnRcbi8vIHRvIGtub3cgd2hlbiBwYXJzaW5nIGEgbGFiZWwsIGluIG9yZGVyIHRvIGFsbG93IG9yIGRpc2FsbG93XG4vLyBjb250aW51ZSBqdW1wcyB0byB0aGF0IGxhYmVsLlxuXG52YXIgVG9rZW5UeXBlID0gZnVuY3Rpb24gVG9rZW5UeXBlKGxhYmVsLCBjb25mKSB7XG4gIGlmICggY29uZiA9PT0gdm9pZCAwICkgY29uZiA9IHt9O1xuXG4gIHRoaXMubGFiZWwgPSBsYWJlbDtcbiAgdGhpcy5rZXl3b3JkID0gY29uZi5rZXl3b3JkO1xuICB0aGlzLmJlZm9yZUV4cHIgPSAhIWNvbmYuYmVmb3JlRXhwcjtcbiAgdGhpcy5zdGFydHNFeHByID0gISFjb25mLnN0YXJ0c0V4cHI7XG4gIHRoaXMuaXNMb29wID0gISFjb25mLmlzTG9vcDtcbiAgdGhpcy5pc0Fzc2lnbiA9ICEhY29uZi5pc0Fzc2lnbjtcbiAgdGhpcy5wcmVmaXggPSAhIWNvbmYucHJlZml4O1xuICB0aGlzLnBvc3RmaXggPSAhIWNvbmYucG9zdGZpeDtcbiAgdGhpcy5iaW5vcCA9IGNvbmYuYmlub3AgfHwgbnVsbDtcbiAgdGhpcy51cGRhdGVDb250ZXh0ID0gbnVsbDtcbn07XG5cbmZ1bmN0aW9uIGJpbm9wKG5hbWUsIHByZWMpIHtcbiAgcmV0dXJuIG5ldyBUb2tlblR5cGUobmFtZSwge2JlZm9yZUV4cHI6IHRydWUsIGJpbm9wOiBwcmVjfSlcbn1cbnZhciBiZWZvcmVFeHByID0ge2JlZm9yZUV4cHI6IHRydWV9LCBzdGFydHNFeHByID0ge3N0YXJ0c0V4cHI6IHRydWV9O1xuXG4vLyBNYXAga2V5d29yZCBuYW1lcyB0byB0b2tlbiB0eXBlcy5cblxudmFyIGtleXdvcmRzJDEgPSB7fTtcblxuLy8gU3VjY2luY3QgZGVmaW5pdGlvbnMgb2Yga2V5d29yZCB0b2tlbiB0eXBlc1xuZnVuY3Rpb24ga3cobmFtZSwgb3B0aW9ucykge1xuICBpZiAoIG9wdGlvbnMgPT09IHZvaWQgMCApIG9wdGlvbnMgPSB7fTtcblxuICBvcHRpb25zLmtleXdvcmQgPSBuYW1lO1xuICByZXR1cm4ga2V5d29yZHMkMVtuYW1lXSA9IG5ldyBUb2tlblR5cGUobmFtZSwgb3B0aW9ucylcbn1cblxudmFyIHR5cGVzID0ge1xuICBudW06IG5ldyBUb2tlblR5cGUoXCJudW1cIiwgc3RhcnRzRXhwciksXG4gIHJlZ2V4cDogbmV3IFRva2VuVHlwZShcInJlZ2V4cFwiLCBzdGFydHNFeHByKSxcbiAgc3RyaW5nOiBuZXcgVG9rZW5UeXBlKFwic3RyaW5nXCIsIHN0YXJ0c0V4cHIpLFxuICBuYW1lOiBuZXcgVG9rZW5UeXBlKFwibmFtZVwiLCBzdGFydHNFeHByKSxcbiAgcHJpdmF0ZUlkOiBuZXcgVG9rZW5UeXBlKFwicHJpdmF0ZUlkXCIsIHN0YXJ0c0V4cHIpLFxuICBlb2Y6IG5ldyBUb2tlblR5cGUoXCJlb2ZcIiksXG5cbiAgLy8gUHVuY3R1YXRpb24gdG9rZW4gdHlwZXMuXG4gIGJyYWNrZXRMOiBuZXcgVG9rZW5UeXBlKFwiW1wiLCB7YmVmb3JlRXhwcjogdHJ1ZSwgc3RhcnRzRXhwcjogdHJ1ZX0pLFxuICBicmFja2V0UjogbmV3IFRva2VuVHlwZShcIl1cIiksXG4gIGJyYWNlTDogbmV3IFRva2VuVHlwZShcIntcIiwge2JlZm9yZUV4cHI6IHRydWUsIHN0YXJ0c0V4cHI6IHRydWV9KSxcbiAgYnJhY2VSOiBuZXcgVG9rZW5UeXBlKFwifVwiKSxcbiAgcGFyZW5MOiBuZXcgVG9rZW5UeXBlKFwiKFwiLCB7YmVmb3JlRXhwcjogdHJ1ZSwgc3RhcnRzRXhwcjogdHJ1ZX0pLFxuICBwYXJlblI6IG5ldyBUb2tlblR5cGUoXCIpXCIpLFxuICBjb21tYTogbmV3IFRva2VuVHlwZShcIixcIiwgYmVmb3JlRXhwciksXG4gIHNlbWk6IG5ldyBUb2tlblR5cGUoXCI7XCIsIGJlZm9yZUV4cHIpLFxuICBjb2xvbjogbmV3IFRva2VuVHlwZShcIjpcIiwgYmVmb3JlRXhwciksXG4gIGRvdDogbmV3IFRva2VuVHlwZShcIi5cIiksXG4gIHF1ZXN0aW9uOiBuZXcgVG9rZW5UeXBlKFwiP1wiLCBiZWZvcmVFeHByKSxcbiAgcXVlc3Rpb25Eb3Q6IG5ldyBUb2tlblR5cGUoXCI/LlwiKSxcbiAgYXJyb3c6IG5ldyBUb2tlblR5cGUoXCI9PlwiLCBiZWZvcmVFeHByKSxcbiAgdGVtcGxhdGU6IG5ldyBUb2tlblR5cGUoXCJ0ZW1wbGF0ZVwiKSxcbiAgaW52YWxpZFRlbXBsYXRlOiBuZXcgVG9rZW5UeXBlKFwiaW52YWxpZFRlbXBsYXRlXCIpLFxuICBlbGxpcHNpczogbmV3IFRva2VuVHlwZShcIi4uLlwiLCBiZWZvcmVFeHByKSxcbiAgYmFja1F1b3RlOiBuZXcgVG9rZW5UeXBlKFwiYFwiLCBzdGFydHNFeHByKSxcbiAgZG9sbGFyQnJhY2VMOiBuZXcgVG9rZW5UeXBlKFwiJHtcIiwge2JlZm9yZUV4cHI6IHRydWUsIHN0YXJ0c0V4cHI6IHRydWV9KSxcblxuICAvLyBPcGVyYXRvcnMuIFRoZXNlIGNhcnJ5IHNldmVyYWwga2luZHMgb2YgcHJvcGVydGllcyB0byBoZWxwIHRoZVxuICAvLyBwYXJzZXIgdXNlIHRoZW0gcHJvcGVybHkgKHRoZSBwcmVzZW5jZSBvZiB0aGVzZSBwcm9wZXJ0aWVzIGlzXG4gIC8vIHdoYXQgY2F0ZWdvcml6ZXMgdGhlbSBhcyBvcGVyYXRvcnMpLlxuICAvL1xuICAvLyBgYmlub3BgLCB3aGVuIHByZXNlbnQsIHNwZWNpZmllcyB0aGF0IHRoaXMgb3BlcmF0b3IgaXMgYSBiaW5hcnlcbiAgLy8gb3BlcmF0b3IsIGFuZCB3aWxsIHJlZmVyIHRvIGl0cyBwcmVjZWRlbmNlLlxuICAvL1xuICAvLyBgcHJlZml4YCBhbmQgYHBvc3RmaXhgIG1hcmsgdGhlIG9wZXJhdG9yIGFzIGEgcHJlZml4IG9yIHBvc3RmaXhcbiAgLy8gdW5hcnkgb3BlcmF0b3IuXG4gIC8vXG4gIC8vIGBpc0Fzc2lnbmAgbWFya3MgYWxsIG9mIGA9YCwgYCs9YCwgYC09YCBldGNldGVyYSwgd2hpY2ggYWN0IGFzXG4gIC8vIGJpbmFyeSBvcGVyYXRvcnMgd2l0aCBhIHZlcnkgbG93IHByZWNlZGVuY2UsIHRoYXQgc2hvdWxkIHJlc3VsdFxuICAvLyBpbiBBc3NpZ25tZW50RXhwcmVzc2lvbiBub2Rlcy5cblxuICBlcTogbmV3IFRva2VuVHlwZShcIj1cIiwge2JlZm9yZUV4cHI6IHRydWUsIGlzQXNzaWduOiB0cnVlfSksXG4gIGFzc2lnbjogbmV3IFRva2VuVHlwZShcIl89XCIsIHtiZWZvcmVFeHByOiB0cnVlLCBpc0Fzc2lnbjogdHJ1ZX0pLFxuICBpbmNEZWM6IG5ldyBUb2tlblR5cGUoXCIrKy8tLVwiLCB7cHJlZml4OiB0cnVlLCBwb3N0Zml4OiB0cnVlLCBzdGFydHNFeHByOiB0cnVlfSksXG4gIHByZWZpeDogbmV3IFRva2VuVHlwZShcIiEvflwiLCB7YmVmb3JlRXhwcjogdHJ1ZSwgcHJlZml4OiB0cnVlLCBzdGFydHNFeHByOiB0cnVlfSksXG4gIGxvZ2ljYWxPUjogYmlub3AoXCJ8fFwiLCAxKSxcbiAgbG9naWNhbEFORDogYmlub3AoXCImJlwiLCAyKSxcbiAgYml0d2lzZU9SOiBiaW5vcChcInxcIiwgMyksXG4gIGJpdHdpc2VYT1I6IGJpbm9wKFwiXlwiLCA0KSxcbiAgYml0d2lzZUFORDogYmlub3AoXCImXCIsIDUpLFxuICBlcXVhbGl0eTogYmlub3AoXCI9PS8hPS89PT0vIT09XCIsIDYpLFxuICByZWxhdGlvbmFsOiBiaW5vcChcIjwvPi88PS8+PVwiLCA3KSxcbiAgYml0U2hpZnQ6IGJpbm9wKFwiPDwvPj4vPj4+XCIsIDgpLFxuICBwbHVzTWluOiBuZXcgVG9rZW5UeXBlKFwiKy8tXCIsIHtiZWZvcmVFeHByOiB0cnVlLCBiaW5vcDogOSwgcHJlZml4OiB0cnVlLCBzdGFydHNFeHByOiB0cnVlfSksXG4gIG1vZHVsbzogYmlub3AoXCIlXCIsIDEwKSxcbiAgc3RhcjogYmlub3AoXCIqXCIsIDEwKSxcbiAgc2xhc2g6IGJpbm9wKFwiL1wiLCAxMCksXG4gIHN0YXJzdGFyOiBuZXcgVG9rZW5UeXBlKFwiKipcIiwge2JlZm9yZUV4cHI6IHRydWV9KSxcbiAgY29hbGVzY2U6IGJpbm9wKFwiPz9cIiwgMSksXG5cbiAgLy8gS2V5d29yZCB0b2tlbiB0eXBlcy5cbiAgX2JyZWFrOiBrdyhcImJyZWFrXCIpLFxuICBfY2FzZToga3coXCJjYXNlXCIsIGJlZm9yZUV4cHIpLFxuICBfY2F0Y2g6IGt3KFwiY2F0Y2hcIiksXG4gIF9jb250aW51ZToga3coXCJjb250aW51ZVwiKSxcbiAgX2RlYnVnZ2VyOiBrdyhcImRlYnVnZ2VyXCIpLFxuICBfZGVmYXVsdDoga3coXCJkZWZhdWx0XCIsIGJlZm9yZUV4cHIpLFxuICBfZG86IGt3KFwiZG9cIiwge2lzTG9vcDogdHJ1ZSwgYmVmb3JlRXhwcjogdHJ1ZX0pLFxuICBfZWxzZToga3coXCJlbHNlXCIsIGJlZm9yZUV4cHIpLFxuICBfZmluYWxseToga3coXCJmaW5hbGx5XCIpLFxuICBfZm9yOiBrdyhcImZvclwiLCB7aXNMb29wOiB0cnVlfSksXG4gIF9mdW5jdGlvbjoga3coXCJmdW5jdGlvblwiLCBzdGFydHNFeHByKSxcbiAgX2lmOiBrdyhcImlmXCIpLFxuICBfcmV0dXJuOiBrdyhcInJldHVyblwiLCBiZWZvcmVFeHByKSxcbiAgX3N3aXRjaDoga3coXCJzd2l0Y2hcIiksXG4gIF90aHJvdzoga3coXCJ0aHJvd1wiLCBiZWZvcmVFeHByKSxcbiAgX3RyeToga3coXCJ0cnlcIiksXG4gIF92YXI6IGt3KFwidmFyXCIpLFxuICBfY29uc3Q6IGt3KFwiY29uc3RcIiksXG4gIF93aGlsZToga3coXCJ3aGlsZVwiLCB7aXNMb29wOiB0cnVlfSksXG4gIF93aXRoOiBrdyhcIndpdGhcIiksXG4gIF9uZXc6IGt3KFwibmV3XCIsIHtiZWZvcmVFeHByOiB0cnVlLCBzdGFydHNFeHByOiB0cnVlfSksXG4gIF90aGlzOiBrdyhcInRoaXNcIiwgc3RhcnRzRXhwciksXG4gIF9zdXBlcjoga3coXCJzdXBlclwiLCBzdGFydHNFeHByKSxcbiAgX2NsYXNzOiBrdyhcImNsYXNzXCIsIHN0YXJ0c0V4cHIpLFxuICBfZXh0ZW5kczoga3coXCJleHRlbmRzXCIsIGJlZm9yZUV4cHIpLFxuICBfZXhwb3J0OiBrdyhcImV4cG9ydFwiKSxcbiAgX2ltcG9ydDoga3coXCJpbXBvcnRcIiwgc3RhcnRzRXhwciksXG4gIF9udWxsOiBrdyhcIm51bGxcIiwgc3RhcnRzRXhwciksXG4gIF90cnVlOiBrdyhcInRydWVcIiwgc3RhcnRzRXhwciksXG4gIF9mYWxzZToga3coXCJmYWxzZVwiLCBzdGFydHNFeHByKSxcbiAgX2luOiBrdyhcImluXCIsIHtiZWZvcmVFeHByOiB0cnVlLCBiaW5vcDogN30pLFxuICBfaW5zdGFuY2VvZjoga3coXCJpbnN0YW5jZW9mXCIsIHtiZWZvcmVFeHByOiB0cnVlLCBiaW5vcDogN30pLFxuICBfdHlwZW9mOiBrdyhcInR5cGVvZlwiLCB7YmVmb3JlRXhwcjogdHJ1ZSwgcHJlZml4OiB0cnVlLCBzdGFydHNFeHByOiB0cnVlfSksXG4gIF92b2lkOiBrdyhcInZvaWRcIiwge2JlZm9yZUV4cHI6IHRydWUsIHByZWZpeDogdHJ1ZSwgc3RhcnRzRXhwcjogdHJ1ZX0pLFxuICBfZGVsZXRlOiBrdyhcImRlbGV0ZVwiLCB7YmVmb3JlRXhwcjogdHJ1ZSwgcHJlZml4OiB0cnVlLCBzdGFydHNFeHByOiB0cnVlfSlcbn07XG5cbi8vIE1hdGNoZXMgYSB3aG9sZSBsaW5lIGJyZWFrICh3aGVyZSBDUkxGIGlzIGNvbnNpZGVyZWQgYSBzaW5nbGVcbi8vIGxpbmUgYnJlYWspLiBVc2VkIHRvIGNvdW50IGxpbmVzLlxuXG52YXIgbGluZUJyZWFrID0gL1xcclxcbj98XFxufFxcdTIwMjh8XFx1MjAyOS87XG52YXIgbGluZUJyZWFrRyA9IG5ldyBSZWdFeHAobGluZUJyZWFrLnNvdXJjZSwgXCJnXCIpO1xuXG5mdW5jdGlvbiBpc05ld0xpbmUoY29kZSwgZWNtYTIwMTlTdHJpbmcpIHtcbiAgcmV0dXJuIGNvZGUgPT09IDEwIHx8IGNvZGUgPT09IDEzIHx8ICghZWNtYTIwMTlTdHJpbmcgJiYgKGNvZGUgPT09IDB4MjAyOCB8fCBjb2RlID09PSAweDIwMjkpKVxufVxuXG52YXIgbm9uQVNDSUl3aGl0ZXNwYWNlID0gL1tcXHUxNjgwXFx1MjAwMC1cXHUyMDBhXFx1MjAyZlxcdTIwNWZcXHUzMDAwXFx1ZmVmZl0vO1xuXG52YXIgc2tpcFdoaXRlU3BhY2UgPSAvKD86XFxzfFxcL1xcLy4qfFxcL1xcKlteXSo/XFwqXFwvKSovZztcblxudmFyIHJlZiA9IE9iamVjdC5wcm90b3R5cGU7XG52YXIgaGFzT3duUHJvcGVydHkgPSByZWYuaGFzT3duUHJvcGVydHk7XG52YXIgdG9TdHJpbmcgPSByZWYudG9TdHJpbmc7XG5cbi8vIENoZWNrcyBpZiBhbiBvYmplY3QgaGFzIGEgcHJvcGVydHkuXG5cbmZ1bmN0aW9uIGhhcyhvYmosIHByb3BOYW1lKSB7XG4gIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcE5hbWUpXG59XG5cbnZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheSB8fCAoZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gKFxuICB0b1N0cmluZy5jYWxsKG9iaikgPT09IFwiW29iamVjdCBBcnJheV1cIlxuKTsgfSk7XG5cbmZ1bmN0aW9uIHdvcmRzUmVnZXhwKHdvcmRzKSB7XG4gIHJldHVybiBuZXcgUmVnRXhwKFwiXig/OlwiICsgd29yZHMucmVwbGFjZSgvIC9nLCBcInxcIikgKyBcIikkXCIpXG59XG5cbi8vIFRoZXNlIGFyZSB1c2VkIHdoZW4gYG9wdGlvbnMubG9jYXRpb25zYCBpcyBvbiwgZm9yIHRoZVxuLy8gYHN0YXJ0TG9jYCBhbmQgYGVuZExvY2AgcHJvcGVydGllcy5cblxudmFyIFBvc2l0aW9uID0gZnVuY3Rpb24gUG9zaXRpb24obGluZSwgY29sKSB7XG4gIHRoaXMubGluZSA9IGxpbmU7XG4gIHRoaXMuY29sdW1uID0gY29sO1xufTtcblxuUG9zaXRpb24ucHJvdG90eXBlLm9mZnNldCA9IGZ1bmN0aW9uIG9mZnNldCAobikge1xuICByZXR1cm4gbmV3IFBvc2l0aW9uKHRoaXMubGluZSwgdGhpcy5jb2x1bW4gKyBuKVxufTtcblxudmFyIFNvdXJjZUxvY2F0aW9uID0gZnVuY3Rpb24gU291cmNlTG9jYXRpb24ocCwgc3RhcnQsIGVuZCkge1xuICB0aGlzLnN0YXJ0ID0gc3RhcnQ7XG4gIHRoaXMuZW5kID0gZW5kO1xuICBpZiAocC5zb3VyY2VGaWxlICE9PSBudWxsKSB7IHRoaXMuc291cmNlID0gcC5zb3VyY2VGaWxlOyB9XG59O1xuXG4vLyBUaGUgYGdldExpbmVJbmZvYCBmdW5jdGlvbiBpcyBtb3N0bHkgdXNlZnVsIHdoZW4gdGhlXG4vLyBgbG9jYXRpb25zYCBvcHRpb24gaXMgb2ZmIChmb3IgcGVyZm9ybWFuY2UgcmVhc29ucykgYW5kIHlvdVxuLy8gd2FudCB0byBmaW5kIHRoZSBsaW5lL2NvbHVtbiBwb3NpdGlvbiBmb3IgYSBnaXZlbiBjaGFyYWN0ZXJcbi8vIG9mZnNldC4gYGlucHV0YCBzaG91bGQgYmUgdGhlIGNvZGUgc3RyaW5nIHRoYXQgdGhlIG9mZnNldCByZWZlcnNcbi8vIGludG8uXG5cbmZ1bmN0aW9uIGdldExpbmVJbmZvKGlucHV0LCBvZmZzZXQpIHtcbiAgZm9yICh2YXIgbGluZSA9IDEsIGN1ciA9IDA7Oykge1xuICAgIGxpbmVCcmVha0cubGFzdEluZGV4ID0gY3VyO1xuICAgIHZhciBtYXRjaCA9IGxpbmVCcmVha0cuZXhlYyhpbnB1dCk7XG4gICAgaWYgKG1hdGNoICYmIG1hdGNoLmluZGV4IDwgb2Zmc2V0KSB7XG4gICAgICArK2xpbmU7XG4gICAgICBjdXIgPSBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG5ldyBQb3NpdGlvbihsaW5lLCBvZmZzZXQgLSBjdXIpXG4gICAgfVxuICB9XG59XG5cbi8vIEEgc2Vjb25kIGFyZ3VtZW50IG11c3QgYmUgZ2l2ZW4gdG8gY29uZmlndXJlIHRoZSBwYXJzZXIgcHJvY2Vzcy5cbi8vIFRoZXNlIG9wdGlvbnMgYXJlIHJlY29nbml6ZWQgKG9ubHkgYGVjbWFWZXJzaW9uYCBpcyByZXF1aXJlZCk6XG5cbnZhciBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgLy8gYGVjbWFWZXJzaW9uYCBpbmRpY2F0ZXMgdGhlIEVDTUFTY3JpcHQgdmVyc2lvbiB0byBwYXJzZS4gTXVzdCBiZVxuICAvLyBlaXRoZXIgMywgNSwgNiAob3IgMjAxNSksIDcgKDIwMTYpLCA4ICgyMDE3KSwgOSAoMjAxOCksIDEwXG4gIC8vICgyMDE5KSwgMTEgKDIwMjApLCAxMiAoMjAyMSksIDEzICgyMDIyKSwgb3IgYFwibGF0ZXN0XCJgICh0aGVcbiAgLy8gbGF0ZXN0IHZlcnNpb24gdGhlIGxpYnJhcnkgc3VwcG9ydHMpLiBUaGlzIGluZmx1ZW5jZXMgc3VwcG9ydFxuICAvLyBmb3Igc3RyaWN0IG1vZGUsIHRoZSBzZXQgb2YgcmVzZXJ2ZWQgd29yZHMsIGFuZCBzdXBwb3J0IGZvclxuICAvLyBuZXcgc3ludGF4IGZlYXR1cmVzLlxuICBlY21hVmVyc2lvbjogbnVsbCxcbiAgLy8gYHNvdXJjZVR5cGVgIGluZGljYXRlcyB0aGUgbW9kZSB0aGUgY29kZSBzaG91bGQgYmUgcGFyc2VkIGluLlxuICAvLyBDYW4gYmUgZWl0aGVyIGBcInNjcmlwdFwiYCBvciBgXCJtb2R1bGVcImAuIFRoaXMgaW5mbHVlbmNlcyBnbG9iYWxcbiAgLy8gc3RyaWN0IG1vZGUgYW5kIHBhcnNpbmcgb2YgYGltcG9ydGAgYW5kIGBleHBvcnRgIGRlY2xhcmF0aW9ucy5cbiAgc291cmNlVHlwZTogXCJzY3JpcHRcIixcbiAgLy8gYG9uSW5zZXJ0ZWRTZW1pY29sb25gIGNhbiBiZSBhIGNhbGxiYWNrIHRoYXQgd2lsbCBiZSBjYWxsZWRcbiAgLy8gd2hlbiBhIHNlbWljb2xvbiBpcyBhdXRvbWF0aWNhbGx5IGluc2VydGVkLiBJdCB3aWxsIGJlIHBhc3NlZFxuICAvLyB0aGUgcG9zaXRpb24gb2YgdGhlIGNvbW1hIGFzIGFuIG9mZnNldCwgYW5kIGlmIGBsb2NhdGlvbnNgIGlzXG4gIC8vIGVuYWJsZWQsIGl0IGlzIGdpdmVuIHRoZSBsb2NhdGlvbiBhcyBhIGB7bGluZSwgY29sdW1ufWAgb2JqZWN0XG4gIC8vIGFzIHNlY29uZCBhcmd1bWVudC5cbiAgb25JbnNlcnRlZFNlbWljb2xvbjogbnVsbCxcbiAgLy8gYG9uVHJhaWxpbmdDb21tYWAgaXMgc2ltaWxhciB0byBgb25JbnNlcnRlZFNlbWljb2xvbmAsIGJ1dCBmb3JcbiAgLy8gdHJhaWxpbmcgY29tbWFzLlxuICBvblRyYWlsaW5nQ29tbWE6IG51bGwsXG4gIC8vIEJ5IGRlZmF1bHQsIHJlc2VydmVkIHdvcmRzIGFyZSBvbmx5IGVuZm9yY2VkIGlmIGVjbWFWZXJzaW9uID49IDUuXG4gIC8vIFNldCBgYWxsb3dSZXNlcnZlZGAgdG8gYSBib29sZWFuIHZhbHVlIHRvIGV4cGxpY2l0bHkgdHVybiB0aGlzIG9uXG4gIC8vIGFuIG9mZi4gV2hlbiB0aGlzIG9wdGlvbiBoYXMgdGhlIHZhbHVlIFwibmV2ZXJcIiwgcmVzZXJ2ZWQgd29yZHNcbiAgLy8gYW5kIGtleXdvcmRzIGNhbiBhbHNvIG5vdCBiZSB1c2VkIGFzIHByb3BlcnR5IG5hbWVzLlxuICBhbGxvd1Jlc2VydmVkOiBudWxsLFxuICAvLyBXaGVuIGVuYWJsZWQsIGEgcmV0dXJuIGF0IHRoZSB0b3AgbGV2ZWwgaXMgbm90IGNvbnNpZGVyZWQgYW5cbiAgLy8gZXJyb3IuXG4gIGFsbG93UmV0dXJuT3V0c2lkZUZ1bmN0aW9uOiBmYWxzZSxcbiAgLy8gV2hlbiBlbmFibGVkLCBpbXBvcnQvZXhwb3J0IHN0YXRlbWVudHMgYXJlIG5vdCBjb25zdHJhaW5lZCB0b1xuICAvLyBhcHBlYXJpbmcgYXQgdGhlIHRvcCBvZiB0aGUgcHJvZ3JhbSwgYW5kIGFuIGltcG9ydC5tZXRhIGV4cHJlc3Npb25cbiAgLy8gaW4gYSBzY3JpcHQgaXNuJ3QgY29uc2lkZXJlZCBhbiBlcnJvci5cbiAgYWxsb3dJbXBvcnRFeHBvcnRFdmVyeXdoZXJlOiBmYWxzZSxcbiAgLy8gQnkgZGVmYXVsdCwgYXdhaXQgaWRlbnRpZmllcnMgYXJlIGFsbG93ZWQgdG8gYXBwZWFyIGF0IHRoZSB0b3AtbGV2ZWwgc2NvcGUgb25seSBpZiBlY21hVmVyc2lvbiA+PSAyMDIyLlxuICAvLyBXaGVuIGVuYWJsZWQsIGF3YWl0IGlkZW50aWZpZXJzIGFyZSBhbGxvd2VkIHRvIGFwcGVhciBhdCB0aGUgdG9wLWxldmVsIHNjb3BlLFxuICAvLyBidXQgdGhleSBhcmUgc3RpbGwgbm90IGFsbG93ZWQgaW4gbm9uLWFzeW5jIGZ1bmN0aW9ucy5cbiAgYWxsb3dBd2FpdE91dHNpZGVGdW5jdGlvbjogbnVsbCxcbiAgLy8gV2hlbiBlbmFibGVkLCBzdXBlciBpZGVudGlmaWVycyBhcmUgbm90IGNvbnN0cmFpbmVkIHRvXG4gIC8vIGFwcGVhcmluZyBpbiBtZXRob2RzIGFuZCBkbyBub3QgcmFpc2UgYW4gZXJyb3Igd2hlbiB0aGV5IGFwcGVhciBlbHNld2hlcmUuXG4gIGFsbG93U3VwZXJPdXRzaWRlTWV0aG9kOiBudWxsLFxuICAvLyBXaGVuIGVuYWJsZWQsIGhhc2hiYW5nIGRpcmVjdGl2ZSBpbiB0aGUgYmVnaW5uaW5nIG9mIGZpbGVcbiAgLy8gaXMgYWxsb3dlZCBhbmQgdHJlYXRlZCBhcyBhIGxpbmUgY29tbWVudC5cbiAgYWxsb3dIYXNoQmFuZzogZmFsc2UsXG4gIC8vIFdoZW4gYGxvY2F0aW9uc2AgaXMgb24sIGBsb2NgIHByb3BlcnRpZXMgaG9sZGluZyBvYmplY3RzIHdpdGhcbiAgLy8gYHN0YXJ0YCBhbmQgYGVuZGAgcHJvcGVydGllcyBpbiBge2xpbmUsIGNvbHVtbn1gIGZvcm0gKHdpdGhcbiAgLy8gbGluZSBiZWluZyAxLWJhc2VkIGFuZCBjb2x1bW4gMC1iYXNlZCkgd2lsbCBiZSBhdHRhY2hlZCB0byB0aGVcbiAgLy8gbm9kZXMuXG4gIGxvY2F0aW9uczogZmFsc2UsXG4gIC8vIEEgZnVuY3Rpb24gY2FuIGJlIHBhc3NlZCBhcyBgb25Ub2tlbmAgb3B0aW9uLCB3aGljaCB3aWxsXG4gIC8vIGNhdXNlIEFjb3JuIHRvIGNhbGwgdGhhdCBmdW5jdGlvbiB3aXRoIG9iamVjdCBpbiB0aGUgc2FtZVxuICAvLyBmb3JtYXQgYXMgdG9rZW5zIHJldHVybmVkIGZyb20gYHRva2VuaXplcigpLmdldFRva2VuKClgLiBOb3RlXG4gIC8vIHRoYXQgeW91IGFyZSBub3QgYWxsb3dlZCB0byBjYWxsIHRoZSBwYXJzZXIgZnJvbSB0aGVcbiAgLy8gY2FsbGJhY2vigJR0aGF0IHdpbGwgY29ycnVwdCBpdHMgaW50ZXJuYWwgc3RhdGUuXG4gIG9uVG9rZW46IG51bGwsXG4gIC8vIEEgZnVuY3Rpb24gY2FuIGJlIHBhc3NlZCBhcyBgb25Db21tZW50YCBvcHRpb24sIHdoaWNoIHdpbGxcbiAgLy8gY2F1c2UgQWNvcm4gdG8gY2FsbCB0aGF0IGZ1bmN0aW9uIHdpdGggYChibG9jaywgdGV4dCwgc3RhcnQsXG4gIC8vIGVuZClgIHBhcmFtZXRlcnMgd2hlbmV2ZXIgYSBjb21tZW50IGlzIHNraXBwZWQuIGBibG9ja2AgaXMgYVxuICAvLyBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGlzIGlzIGEgYmxvY2sgKGAvKiAqL2ApIGNvbW1lbnQsXG4gIC8vIGB0ZXh0YCBpcyB0aGUgY29udGVudCBvZiB0aGUgY29tbWVudCwgYW5kIGBzdGFydGAgYW5kIGBlbmRgIGFyZVxuICAvLyBjaGFyYWN0ZXIgb2Zmc2V0cyB0aGF0IGRlbm90ZSB0aGUgc3RhcnQgYW5kIGVuZCBvZiB0aGUgY29tbWVudC5cbiAgLy8gV2hlbiB0aGUgYGxvY2F0aW9uc2Agb3B0aW9uIGlzIG9uLCB0d28gbW9yZSBwYXJhbWV0ZXJzIGFyZVxuICAvLyBwYXNzZWQsIHRoZSBmdWxsIGB7bGluZSwgY29sdW1ufWAgbG9jYXRpb25zIG9mIHRoZSBzdGFydCBhbmRcbiAgLy8gZW5kIG9mIHRoZSBjb21tZW50cy4gTm90ZSB0aGF0IHlvdSBhcmUgbm90IGFsbG93ZWQgdG8gY2FsbCB0aGVcbiAgLy8gcGFyc2VyIGZyb20gdGhlIGNhbGxiYWNr4oCUdGhhdCB3aWxsIGNvcnJ1cHQgaXRzIGludGVybmFsIHN0YXRlLlxuICBvbkNvbW1lbnQ6IG51bGwsXG4gIC8vIE5vZGVzIGhhdmUgdGhlaXIgc3RhcnQgYW5kIGVuZCBjaGFyYWN0ZXJzIG9mZnNldHMgcmVjb3JkZWQgaW5cbiAgLy8gYHN0YXJ0YCBhbmQgYGVuZGAgcHJvcGVydGllcyAoZGlyZWN0bHkgb24gdGhlIG5vZGUsIHJhdGhlciB0aGFuXG4gIC8vIHRoZSBgbG9jYCBvYmplY3QsIHdoaWNoIGhvbGRzIGxpbmUvY29sdW1uIGRhdGEuIFRvIGFsc28gYWRkIGFcbiAgLy8gW3NlbWktc3RhbmRhcmRpemVkXVtyYW5nZV0gYHJhbmdlYCBwcm9wZXJ0eSBob2xkaW5nIGEgYFtzdGFydCxcbiAgLy8gZW5kXWAgYXJyYXkgd2l0aCB0aGUgc2FtZSBudW1iZXJzLCBzZXQgdGhlIGByYW5nZXNgIG9wdGlvbiB0b1xuICAvLyBgdHJ1ZWAuXG4gIC8vXG4gIC8vIFtyYW5nZV06IGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTc0NTY3OFxuICByYW5nZXM6IGZhbHNlLFxuICAvLyBJdCBpcyBwb3NzaWJsZSB0byBwYXJzZSBtdWx0aXBsZSBmaWxlcyBpbnRvIGEgc2luZ2xlIEFTVCBieVxuICAvLyBwYXNzaW5nIHRoZSB0cmVlIHByb2R1Y2VkIGJ5IHBhcnNpbmcgdGhlIGZpcnN0IGZpbGUgYXNcbiAgLy8gYHByb2dyYW1gIG9wdGlvbiBpbiBzdWJzZXF1ZW50IHBhcnNlcy4gVGhpcyB3aWxsIGFkZCB0aGVcbiAgLy8gdG9wbGV2ZWwgZm9ybXMgb2YgdGhlIHBhcnNlZCBmaWxlIHRvIHRoZSBgUHJvZ3JhbWAgKHRvcCkgbm9kZVxuICAvLyBvZiBhbiBleGlzdGluZyBwYXJzZSB0cmVlLlxuICBwcm9ncmFtOiBudWxsLFxuICAvLyBXaGVuIGBsb2NhdGlvbnNgIGlzIG9uLCB5b3UgY2FuIHBhc3MgdGhpcyB0byByZWNvcmQgdGhlIHNvdXJjZVxuICAvLyBmaWxlIGluIGV2ZXJ5IG5vZGUncyBgbG9jYCBvYmplY3QuXG4gIHNvdXJjZUZpbGU6IG51bGwsXG4gIC8vIFRoaXMgdmFsdWUsIGlmIGdpdmVuLCBpcyBzdG9yZWQgaW4gZXZlcnkgbm9kZSwgd2hldGhlclxuICAvLyBgbG9jYXRpb25zYCBpcyBvbiBvciBvZmYuXG4gIGRpcmVjdFNvdXJjZUZpbGU6IG51bGwsXG4gIC8vIFdoZW4gZW5hYmxlZCwgcGFyZW50aGVzaXplZCBleHByZXNzaW9ucyBhcmUgcmVwcmVzZW50ZWQgYnlcbiAgLy8gKG5vbi1zdGFuZGFyZCkgUGFyZW50aGVzaXplZEV4cHJlc3Npb24gbm9kZXNcbiAgcHJlc2VydmVQYXJlbnM6IGZhbHNlXG59O1xuXG4vLyBJbnRlcnByZXQgYW5kIGRlZmF1bHQgYW4gb3B0aW9ucyBvYmplY3RcblxudmFyIHdhcm5lZEFib3V0RWNtYVZlcnNpb24gPSBmYWxzZTtcblxuZnVuY3Rpb24gZ2V0T3B0aW9ucyhvcHRzKSB7XG4gIHZhciBvcHRpb25zID0ge307XG5cbiAgZm9yICh2YXIgb3B0IGluIGRlZmF1bHRPcHRpb25zKVxuICAgIHsgb3B0aW9uc1tvcHRdID0gb3B0cyAmJiBoYXMob3B0cywgb3B0KSA/IG9wdHNbb3B0XSA6IGRlZmF1bHRPcHRpb25zW29wdF07IH1cblxuICBpZiAob3B0aW9ucy5lY21hVmVyc2lvbiA9PT0gXCJsYXRlc3RcIikge1xuICAgIG9wdGlvbnMuZWNtYVZlcnNpb24gPSAxZTg7XG4gIH0gZWxzZSBpZiAob3B0aW9ucy5lY21hVmVyc2lvbiA9PSBudWxsKSB7XG4gICAgaWYgKCF3YXJuZWRBYm91dEVjbWFWZXJzaW9uICYmIHR5cGVvZiBjb25zb2xlID09PSBcIm9iamVjdFwiICYmIGNvbnNvbGUud2Fybikge1xuICAgICAgd2FybmVkQWJvdXRFY21hVmVyc2lvbiA9IHRydWU7XG4gICAgICBjb25zb2xlLndhcm4oXCJTaW5jZSBBY29ybiA4LjAuMCwgb3B0aW9ucy5lY21hVmVyc2lvbiBpcyByZXF1aXJlZC5cXG5EZWZhdWx0aW5nIHRvIDIwMjAsIGJ1dCB0aGlzIHdpbGwgc3RvcCB3b3JraW5nIGluIHRoZSBmdXR1cmUuXCIpO1xuICAgIH1cbiAgICBvcHRpb25zLmVjbWFWZXJzaW9uID0gMTE7XG4gIH0gZWxzZSBpZiAob3B0aW9ucy5lY21hVmVyc2lvbiA+PSAyMDE1KSB7XG4gICAgb3B0aW9ucy5lY21hVmVyc2lvbiAtPSAyMDA5O1xuICB9XG5cbiAgaWYgKG9wdGlvbnMuYWxsb3dSZXNlcnZlZCA9PSBudWxsKVxuICAgIHsgb3B0aW9ucy5hbGxvd1Jlc2VydmVkID0gb3B0aW9ucy5lY21hVmVyc2lvbiA8IDU7IH1cblxuICBpZiAoaXNBcnJheShvcHRpb25zLm9uVG9rZW4pKSB7XG4gICAgdmFyIHRva2VucyA9IG9wdGlvbnMub25Ub2tlbjtcbiAgICBvcHRpb25zLm9uVG9rZW4gPSBmdW5jdGlvbiAodG9rZW4pIHsgcmV0dXJuIHRva2Vucy5wdXNoKHRva2VuKTsgfTtcbiAgfVxuICBpZiAoaXNBcnJheShvcHRpb25zLm9uQ29tbWVudCkpXG4gICAgeyBvcHRpb25zLm9uQ29tbWVudCA9IHB1c2hDb21tZW50KG9wdGlvbnMsIG9wdGlvbnMub25Db21tZW50KTsgfVxuXG4gIHJldHVybiBvcHRpb25zXG59XG5cbmZ1bmN0aW9uIHB1c2hDb21tZW50KG9wdGlvbnMsIGFycmF5KSB7XG4gIHJldHVybiBmdW5jdGlvbihibG9jaywgdGV4dCwgc3RhcnQsIGVuZCwgc3RhcnRMb2MsIGVuZExvYykge1xuICAgIHZhciBjb21tZW50ID0ge1xuICAgICAgdHlwZTogYmxvY2sgPyBcIkJsb2NrXCIgOiBcIkxpbmVcIixcbiAgICAgIHZhbHVlOiB0ZXh0LFxuICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgZW5kOiBlbmRcbiAgICB9O1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucylcbiAgICAgIHsgY29tbWVudC5sb2MgPSBuZXcgU291cmNlTG9jYXRpb24odGhpcywgc3RhcnRMb2MsIGVuZExvYyk7IH1cbiAgICBpZiAob3B0aW9ucy5yYW5nZXMpXG4gICAgICB7IGNvbW1lbnQucmFuZ2UgPSBbc3RhcnQsIGVuZF07IH1cbiAgICBhcnJheS5wdXNoKGNvbW1lbnQpO1xuICB9XG59XG5cbi8vIEVhY2ggc2NvcGUgZ2V0cyBhIGJpdHNldCB0aGF0IG1heSBjb250YWluIHRoZXNlIGZsYWdzXG52YXJcbiAgICBTQ09QRV9UT1AgPSAxLFxuICAgIFNDT1BFX0ZVTkNUSU9OID0gMixcbiAgICBTQ09QRV9WQVIgPSBTQ09QRV9UT1AgfCBTQ09QRV9GVU5DVElPTixcbiAgICBTQ09QRV9BU1lOQyA9IDQsXG4gICAgU0NPUEVfR0VORVJBVE9SID0gOCxcbiAgICBTQ09QRV9BUlJPVyA9IDE2LFxuICAgIFNDT1BFX1NJTVBMRV9DQVRDSCA9IDMyLFxuICAgIFNDT1BFX1NVUEVSID0gNjQsXG4gICAgU0NPUEVfRElSRUNUX1NVUEVSID0gMTI4O1xuXG5mdW5jdGlvbiBmdW5jdGlvbkZsYWdzKGFzeW5jLCBnZW5lcmF0b3IpIHtcbiAgcmV0dXJuIFNDT1BFX0ZVTkNUSU9OIHwgKGFzeW5jID8gU0NPUEVfQVNZTkMgOiAwKSB8IChnZW5lcmF0b3IgPyBTQ09QRV9HRU5FUkFUT1IgOiAwKVxufVxuXG4vLyBVc2VkIGluIGNoZWNrTFZhbCogYW5kIGRlY2xhcmVOYW1lIHRvIGRldGVybWluZSB0aGUgdHlwZSBvZiBhIGJpbmRpbmdcbnZhclxuICAgIEJJTkRfTk9ORSA9IDAsIC8vIE5vdCBhIGJpbmRpbmdcbiAgICBCSU5EX1ZBUiA9IDEsIC8vIFZhci1zdHlsZSBiaW5kaW5nXG4gICAgQklORF9MRVhJQ0FMID0gMiwgLy8gTGV0LSBvciBjb25zdC1zdHlsZSBiaW5kaW5nXG4gICAgQklORF9GVU5DVElPTiA9IDMsIC8vIEZ1bmN0aW9uIGRlY2xhcmF0aW9uXG4gICAgQklORF9TSU1QTEVfQ0FUQ0ggPSA0LCAvLyBTaW1wbGUgKGlkZW50aWZpZXIgcGF0dGVybikgY2F0Y2ggYmluZGluZ1xuICAgIEJJTkRfT1VUU0lERSA9IDU7IC8vIFNwZWNpYWwgY2FzZSBmb3IgZnVuY3Rpb24gbmFtZXMgYXMgYm91bmQgaW5zaWRlIHRoZSBmdW5jdGlvblxuXG52YXIgUGFyc2VyID0gZnVuY3Rpb24gUGFyc2VyKG9wdGlvbnMsIGlucHV0LCBzdGFydFBvcykge1xuICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zID0gZ2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgdGhpcy5zb3VyY2VGaWxlID0gb3B0aW9ucy5zb3VyY2VGaWxlO1xuICB0aGlzLmtleXdvcmRzID0gd29yZHNSZWdleHAoa2V5d29yZHNbb3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2ID8gNiA6IG9wdGlvbnMuc291cmNlVHlwZSA9PT0gXCJtb2R1bGVcIiA/IFwiNW1vZHVsZVwiIDogNV0pO1xuICB2YXIgcmVzZXJ2ZWQgPSBcIlwiO1xuICBpZiAob3B0aW9ucy5hbGxvd1Jlc2VydmVkICE9PSB0cnVlKSB7XG4gICAgcmVzZXJ2ZWQgPSByZXNlcnZlZFdvcmRzW29wdGlvbnMuZWNtYVZlcnNpb24gPj0gNiA/IDYgOiBvcHRpb25zLmVjbWFWZXJzaW9uID09PSA1ID8gNSA6IDNdO1xuICAgIGlmIChvcHRpb25zLnNvdXJjZVR5cGUgPT09IFwibW9kdWxlXCIpIHsgcmVzZXJ2ZWQgKz0gXCIgYXdhaXRcIjsgfVxuICB9XG4gIHRoaXMucmVzZXJ2ZWRXb3JkcyA9IHdvcmRzUmVnZXhwKHJlc2VydmVkKTtcbiAgdmFyIHJlc2VydmVkU3RyaWN0ID0gKHJlc2VydmVkID8gcmVzZXJ2ZWQgKyBcIiBcIiA6IFwiXCIpICsgcmVzZXJ2ZWRXb3Jkcy5zdHJpY3Q7XG4gIHRoaXMucmVzZXJ2ZWRXb3Jkc1N0cmljdCA9IHdvcmRzUmVnZXhwKHJlc2VydmVkU3RyaWN0KTtcbiAgdGhpcy5yZXNlcnZlZFdvcmRzU3RyaWN0QmluZCA9IHdvcmRzUmVnZXhwKHJlc2VydmVkU3RyaWN0ICsgXCIgXCIgKyByZXNlcnZlZFdvcmRzLnN0cmljdEJpbmQpO1xuICB0aGlzLmlucHV0ID0gU3RyaW5nKGlucHV0KTtcblxuICAvLyBVc2VkIHRvIHNpZ25hbCB0byBjYWxsZXJzIG9mIGByZWFkV29yZDFgIHdoZXRoZXIgdGhlIHdvcmRcbiAgLy8gY29udGFpbmVkIGFueSBlc2NhcGUgc2VxdWVuY2VzLiBUaGlzIGlzIG5lZWRlZCBiZWNhdXNlIHdvcmRzIHdpdGhcbiAgLy8gZXNjYXBlIHNlcXVlbmNlcyBtdXN0IG5vdCBiZSBpbnRlcnByZXRlZCBhcyBrZXl3b3Jkcy5cbiAgdGhpcy5jb250YWluc0VzYyA9IGZhbHNlO1xuXG4gIC8vIFNldCB1cCB0b2tlbiBzdGF0ZVxuXG4gIC8vIFRoZSBjdXJyZW50IHBvc2l0aW9uIG9mIHRoZSB0b2tlbml6ZXIgaW4gdGhlIGlucHV0LlxuICBpZiAoc3RhcnRQb3MpIHtcbiAgICB0aGlzLnBvcyA9IHN0YXJ0UG9zO1xuICAgIHRoaXMubGluZVN0YXJ0ID0gdGhpcy5pbnB1dC5sYXN0SW5kZXhPZihcIlxcblwiLCBzdGFydFBvcyAtIDEpICsgMTtcbiAgICB0aGlzLmN1ckxpbmUgPSB0aGlzLmlucHV0LnNsaWNlKDAsIHRoaXMubGluZVN0YXJ0KS5zcGxpdChsaW5lQnJlYWspLmxlbmd0aDtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLnBvcyA9IHRoaXMubGluZVN0YXJ0ID0gMDtcbiAgICB0aGlzLmN1ckxpbmUgPSAxO1xuICB9XG5cbiAgLy8gUHJvcGVydGllcyBvZiB0aGUgY3VycmVudCB0b2tlbjpcbiAgLy8gSXRzIHR5cGVcbiAgdGhpcy50eXBlID0gdHlwZXMuZW9mO1xuICAvLyBGb3IgdG9rZW5zIHRoYXQgaW5jbHVkZSBtb3JlIGluZm9ybWF0aW9uIHRoYW4gdGhlaXIgdHlwZSwgdGhlIHZhbHVlXG4gIHRoaXMudmFsdWUgPSBudWxsO1xuICAvLyBJdHMgc3RhcnQgYW5kIGVuZCBvZmZzZXRcbiAgdGhpcy5zdGFydCA9IHRoaXMuZW5kID0gdGhpcy5wb3M7XG4gIC8vIEFuZCwgaWYgbG9jYXRpb25zIGFyZSB1c2VkLCB0aGUge2xpbmUsIGNvbHVtbn0gb2JqZWN0XG4gIC8vIGNvcnJlc3BvbmRpbmcgdG8gdGhvc2Ugb2Zmc2V0c1xuICB0aGlzLnN0YXJ0TG9jID0gdGhpcy5lbmRMb2MgPSB0aGlzLmN1clBvc2l0aW9uKCk7XG5cbiAgLy8gUG9zaXRpb24gaW5mb3JtYXRpb24gZm9yIHRoZSBwcmV2aW91cyB0b2tlblxuICB0aGlzLmxhc3RUb2tFbmRMb2MgPSB0aGlzLmxhc3RUb2tTdGFydExvYyA9IG51bGw7XG4gIHRoaXMubGFzdFRva1N0YXJ0ID0gdGhpcy5sYXN0VG9rRW5kID0gdGhpcy5wb3M7XG5cbiAgLy8gVGhlIGNvbnRleHQgc3RhY2sgaXMgdXNlZCB0byBzdXBlcmZpY2lhbGx5IHRyYWNrIHN5bnRhY3RpY1xuICAvLyBjb250ZXh0IHRvIHByZWRpY3Qgd2hldGhlciBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBpcyBhbGxvd2VkIGluIGFcbiAgLy8gZ2l2ZW4gcG9zaXRpb24uXG4gIHRoaXMuY29udGV4dCA9IHRoaXMuaW5pdGlhbENvbnRleHQoKTtcbiAgdGhpcy5leHByQWxsb3dlZCA9IHRydWU7XG5cbiAgLy8gRmlndXJlIG91dCBpZiBpdCdzIGEgbW9kdWxlIGNvZGUuXG4gIHRoaXMuaW5Nb2R1bGUgPSBvcHRpb25zLnNvdXJjZVR5cGUgPT09IFwibW9kdWxlXCI7XG4gIHRoaXMuc3RyaWN0ID0gdGhpcy5pbk1vZHVsZSB8fCB0aGlzLnN0cmljdERpcmVjdGl2ZSh0aGlzLnBvcyk7XG5cbiAgLy8gVXNlZCB0byBzaWduaWZ5IHRoZSBzdGFydCBvZiBhIHBvdGVudGlhbCBhcnJvdyBmdW5jdGlvblxuICB0aGlzLnBvdGVudGlhbEFycm93QXQgPSAtMTtcbiAgdGhpcy5wb3RlbnRpYWxBcnJvd0luRm9yQXdhaXQgPSBmYWxzZTtcblxuICAvLyBQb3NpdGlvbnMgdG8gZGVsYXllZC1jaGVjayB0aGF0IHlpZWxkL2F3YWl0IGRvZXMgbm90IGV4aXN0IGluIGRlZmF1bHQgcGFyYW1ldGVycy5cbiAgdGhpcy55aWVsZFBvcyA9IHRoaXMuYXdhaXRQb3MgPSB0aGlzLmF3YWl0SWRlbnRQb3MgPSAwO1xuICAvLyBMYWJlbHMgaW4gc2NvcGUuXG4gIHRoaXMubGFiZWxzID0gW107XG4gIC8vIFRodXMtZmFyIHVuZGVmaW5lZCBleHBvcnRzLlxuICB0aGlzLnVuZGVmaW5lZEV4cG9ydHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gIC8vIElmIGVuYWJsZWQsIHNraXAgbGVhZGluZyBoYXNoYmFuZyBsaW5lLlxuICBpZiAodGhpcy5wb3MgPT09IDAgJiYgb3B0aW9ucy5hbGxvd0hhc2hCYW5nICYmIHRoaXMuaW5wdXQuc2xpY2UoMCwgMikgPT09IFwiIyFcIilcbiAgICB7IHRoaXMuc2tpcExpbmVDb21tZW50KDIpOyB9XG5cbiAgLy8gU2NvcGUgdHJhY2tpbmcgZm9yIGR1cGxpY2F0ZSB2YXJpYWJsZSBuYW1lcyAoc2VlIHNjb3BlLmpzKVxuICB0aGlzLnNjb3BlU3RhY2sgPSBbXTtcbiAgdGhpcy5lbnRlclNjb3BlKFNDT1BFX1RPUCk7XG5cbiAgLy8gRm9yIFJlZ0V4cCB2YWxpZGF0aW9uXG4gIHRoaXMucmVnZXhwU3RhdGUgPSBudWxsO1xuXG4gIC8vIFRoZSBzdGFjayBvZiBwcml2YXRlIG5hbWVzLlxuICAvLyBFYWNoIGVsZW1lbnQgaGFzIHR3byBwcm9wZXJ0aWVzOiAnZGVjbGFyZWQnIGFuZCAndXNlZCcuXG4gIC8vIFdoZW4gaXQgZXhpdGVkIGZyb20gdGhlIG91dGVybW9zdCBjbGFzcyBkZWZpbml0aW9uLCBhbGwgdXNlZCBwcml2YXRlIG5hbWVzIG11c3QgYmUgZGVjbGFyZWQuXG4gIHRoaXMucHJpdmF0ZU5hbWVTdGFjayA9IFtdO1xufTtcblxudmFyIHByb3RvdHlwZUFjY2Vzc29ycyA9IHsgaW5GdW5jdGlvbjogeyBjb25maWd1cmFibGU6IHRydWUgfSxpbkdlbmVyYXRvcjogeyBjb25maWd1cmFibGU6IHRydWUgfSxpbkFzeW5jOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LGNhbkF3YWl0OiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LGFsbG93U3VwZXI6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sYWxsb3dEaXJlY3RTdXBlcjogeyBjb25maWd1cmFibGU6IHRydWUgfSx0cmVhdEZ1bmN0aW9uc0FzVmFyOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LGluTm9uQXJyb3dGdW5jdGlvbjogeyBjb25maWd1cmFibGU6IHRydWUgfSB9O1xuXG5QYXJzZXIucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gcGFyc2UgKCkge1xuICB2YXIgbm9kZSA9IHRoaXMub3B0aW9ucy5wcm9ncmFtIHx8IHRoaXMuc3RhcnROb2RlKCk7XG4gIHRoaXMubmV4dFRva2VuKCk7XG4gIHJldHVybiB0aGlzLnBhcnNlVG9wTGV2ZWwobm9kZSlcbn07XG5cbnByb3RvdHlwZUFjY2Vzc29ycy5pbkZ1bmN0aW9uLmdldCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICh0aGlzLmN1cnJlbnRWYXJTY29wZSgpLmZsYWdzICYgU0NPUEVfRlVOQ1RJT04pID4gMCB9O1xucHJvdG90eXBlQWNjZXNzb3JzLmluR2VuZXJhdG9yLmdldCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICh0aGlzLmN1cnJlbnRWYXJTY29wZSgpLmZsYWdzICYgU0NPUEVfR0VORVJBVE9SKSA+IDAgJiYgIXRoaXMuY3VycmVudFZhclNjb3BlKCkuaW5DbGFzc0ZpZWxkSW5pdCB9O1xucHJvdG90eXBlQWNjZXNzb3JzLmluQXN5bmMuZ2V0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gKHRoaXMuY3VycmVudFZhclNjb3BlKCkuZmxhZ3MgJiBTQ09QRV9BU1lOQykgPiAwICYmICF0aGlzLmN1cnJlbnRWYXJTY29wZSgpLmluQ2xhc3NGaWVsZEluaXQgfTtcbnByb3RvdHlwZUFjY2Vzc29ycy5jYW5Bd2FpdC5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gIGZvciAodmFyIGkgPSB0aGlzLnNjb3BlU3RhY2subGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICB2YXIgc2NvcGUgPSB0aGlzLnNjb3BlU3RhY2tbaV07XG4gICAgaWYgKHNjb3BlLmluQ2xhc3NGaWVsZEluaXQpIHsgcmV0dXJuIGZhbHNlIH1cbiAgICBpZiAoc2NvcGUuZmxhZ3MgJiBTQ09QRV9GVU5DVElPTikgeyByZXR1cm4gKHNjb3BlLmZsYWdzICYgU0NPUEVfQVNZTkMpID4gMCB9XG4gIH1cbiAgcmV0dXJuICh0aGlzLmluTW9kdWxlICYmIHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSAxMykgfHwgdGhpcy5vcHRpb25zLmFsbG93QXdhaXRPdXRzaWRlRnVuY3Rpb25cbn07XG5wcm90b3R5cGVBY2Nlc3NvcnMuYWxsb3dTdXBlci5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciByZWYgPSB0aGlzLmN1cnJlbnRUaGlzU2NvcGUoKTtcbiAgICB2YXIgZmxhZ3MgPSByZWYuZmxhZ3M7XG4gICAgdmFyIGluQ2xhc3NGaWVsZEluaXQgPSByZWYuaW5DbGFzc0ZpZWxkSW5pdDtcbiAgcmV0dXJuIChmbGFncyAmIFNDT1BFX1NVUEVSKSA+IDAgfHwgaW5DbGFzc0ZpZWxkSW5pdCB8fCB0aGlzLm9wdGlvbnMuYWxsb3dTdXBlck91dHNpZGVNZXRob2Rcbn07XG5wcm90b3R5cGVBY2Nlc3NvcnMuYWxsb3dEaXJlY3RTdXBlci5nZXQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAodGhpcy5jdXJyZW50VGhpc1Njb3BlKCkuZmxhZ3MgJiBTQ09QRV9ESVJFQ1RfU1VQRVIpID4gMCB9O1xucHJvdG90eXBlQWNjZXNzb3JzLnRyZWF0RnVuY3Rpb25zQXNWYXIuZ2V0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy50cmVhdEZ1bmN0aW9uc0FzVmFySW5TY29wZSh0aGlzLmN1cnJlbnRTY29wZSgpKSB9O1xucHJvdG90eXBlQWNjZXNzb3JzLmluTm9uQXJyb3dGdW5jdGlvbi5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciByZWYgPSB0aGlzLmN1cnJlbnRUaGlzU2NvcGUoKTtcbiAgICB2YXIgZmxhZ3MgPSByZWYuZmxhZ3M7XG4gICAgdmFyIGluQ2xhc3NGaWVsZEluaXQgPSByZWYuaW5DbGFzc0ZpZWxkSW5pdDtcbiAgcmV0dXJuIChmbGFncyAmIFNDT1BFX0ZVTkNUSU9OKSA+IDAgfHwgaW5DbGFzc0ZpZWxkSW5pdFxufTtcblxuUGFyc2VyLmV4dGVuZCA9IGZ1bmN0aW9uIGV4dGVuZCAoKSB7XG4gICAgdmFyIHBsdWdpbnMgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB3aGlsZSAoIGxlbi0tICkgcGx1Z2luc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gIHZhciBjbHMgPSB0aGlzO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBsdWdpbnMubGVuZ3RoOyBpKyspIHsgY2xzID0gcGx1Z2luc1tpXShjbHMpOyB9XG4gIHJldHVybiBjbHNcbn07XG5cblBhcnNlci5wYXJzZSA9IGZ1bmN0aW9uIHBhcnNlIChpbnB1dCwgb3B0aW9ucykge1xuICByZXR1cm4gbmV3IHRoaXMob3B0aW9ucywgaW5wdXQpLnBhcnNlKClcbn07XG5cblBhcnNlci5wYXJzZUV4cHJlc3Npb25BdCA9IGZ1bmN0aW9uIHBhcnNlRXhwcmVzc2lvbkF0IChpbnB1dCwgcG9zLCBvcHRpb25zKSB7XG4gIHZhciBwYXJzZXIgPSBuZXcgdGhpcyhvcHRpb25zLCBpbnB1dCwgcG9zKTtcbiAgcGFyc2VyLm5leHRUb2tlbigpO1xuICByZXR1cm4gcGFyc2VyLnBhcnNlRXhwcmVzc2lvbigpXG59O1xuXG5QYXJzZXIudG9rZW5pemVyID0gZnVuY3Rpb24gdG9rZW5pemVyIChpbnB1dCwgb3B0aW9ucykge1xuICByZXR1cm4gbmV3IHRoaXMob3B0aW9ucywgaW5wdXQpXG59O1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyggUGFyc2VyLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzICk7XG5cbnZhciBwcCA9IFBhcnNlci5wcm90b3R5cGU7XG5cbi8vICMjIFBhcnNlciB1dGlsaXRpZXNcblxudmFyIGxpdGVyYWwgPSAvXig/OicoKD86XFxcXC58W14nXFxcXF0pKj8pJ3xcIigoPzpcXFxcLnxbXlwiXFxcXF0pKj8pXCIpLztcbnBwLnN0cmljdERpcmVjdGl2ZSA9IGZ1bmN0aW9uKHN0YXJ0KSB7XG4gIGZvciAoOzspIHtcbiAgICAvLyBUcnkgdG8gZmluZCBzdHJpbmcgbGl0ZXJhbC5cbiAgICBza2lwV2hpdGVTcGFjZS5sYXN0SW5kZXggPSBzdGFydDtcbiAgICBzdGFydCArPSBza2lwV2hpdGVTcGFjZS5leGVjKHRoaXMuaW5wdXQpWzBdLmxlbmd0aDtcbiAgICB2YXIgbWF0Y2ggPSBsaXRlcmFsLmV4ZWModGhpcy5pbnB1dC5zbGljZShzdGFydCkpO1xuICAgIGlmICghbWF0Y2gpIHsgcmV0dXJuIGZhbHNlIH1cbiAgICBpZiAoKG1hdGNoWzFdIHx8IG1hdGNoWzJdKSA9PT0gXCJ1c2Ugc3RyaWN0XCIpIHtcbiAgICAgIHNraXBXaGl0ZVNwYWNlLmxhc3RJbmRleCA9IHN0YXJ0ICsgbWF0Y2hbMF0ubGVuZ3RoO1xuICAgICAgdmFyIHNwYWNlQWZ0ZXIgPSBza2lwV2hpdGVTcGFjZS5leGVjKHRoaXMuaW5wdXQpLCBlbmQgPSBzcGFjZUFmdGVyLmluZGV4ICsgc3BhY2VBZnRlclswXS5sZW5ndGg7XG4gICAgICB2YXIgbmV4dCA9IHRoaXMuaW5wdXQuY2hhckF0KGVuZCk7XG4gICAgICByZXR1cm4gbmV4dCA9PT0gXCI7XCIgfHwgbmV4dCA9PT0gXCJ9XCIgfHxcbiAgICAgICAgKGxpbmVCcmVhay50ZXN0KHNwYWNlQWZ0ZXJbMF0pICYmXG4gICAgICAgICAhKC9bKGAuWytcXC0vKiU8Pj0sP14mXS8udGVzdChuZXh0KSB8fCBuZXh0ID09PSBcIiFcIiAmJiB0aGlzLmlucHV0LmNoYXJBdChlbmQgKyAxKSA9PT0gXCI9XCIpKVxuICAgIH1cbiAgICBzdGFydCArPSBtYXRjaFswXS5sZW5ndGg7XG5cbiAgICAvLyBTa2lwIHNlbWljb2xvbiwgaWYgYW55LlxuICAgIHNraXBXaGl0ZVNwYWNlLmxhc3RJbmRleCA9IHN0YXJ0O1xuICAgIHN0YXJ0ICs9IHNraXBXaGl0ZVNwYWNlLmV4ZWModGhpcy5pbnB1dClbMF0ubGVuZ3RoO1xuICAgIGlmICh0aGlzLmlucHV0W3N0YXJ0XSA9PT0gXCI7XCIpXG4gICAgICB7IHN0YXJ0Kys7IH1cbiAgfVxufTtcblxuLy8gUHJlZGljYXRlIHRoYXQgdGVzdHMgd2hldGhlciB0aGUgbmV4dCB0b2tlbiBpcyBvZiB0aGUgZ2l2ZW5cbi8vIHR5cGUsIGFuZCBpZiB5ZXMsIGNvbnN1bWVzIGl0IGFzIGEgc2lkZSBlZmZlY3QuXG5cbnBwLmVhdCA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZSkge1xuICAgIHRoaXMubmV4dCgpO1xuICAgIHJldHVybiB0cnVlXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbn07XG5cbi8vIFRlc3RzIHdoZXRoZXIgcGFyc2VkIHRva2VuIGlzIGEgY29udGV4dHVhbCBrZXl3b3JkLlxuXG5wcC5pc0NvbnRleHR1YWwgPSBmdW5jdGlvbihuYW1lKSB7XG4gIHJldHVybiB0aGlzLnR5cGUgPT09IHR5cGVzLm5hbWUgJiYgdGhpcy52YWx1ZSA9PT0gbmFtZSAmJiAhdGhpcy5jb250YWluc0VzY1xufTtcblxuLy8gQ29uc3VtZXMgY29udGV4dHVhbCBrZXl3b3JkIGlmIHBvc3NpYmxlLlxuXG5wcC5lYXRDb250ZXh0dWFsID0gZnVuY3Rpb24obmFtZSkge1xuICBpZiAoIXRoaXMuaXNDb250ZXh0dWFsKG5hbWUpKSB7IHJldHVybiBmYWxzZSB9XG4gIHRoaXMubmV4dCgpO1xuICByZXR1cm4gdHJ1ZVxufTtcblxuLy8gQXNzZXJ0cyB0aGF0IGZvbGxvd2luZyB0b2tlbiBpcyBnaXZlbiBjb250ZXh0dWFsIGtleXdvcmQuXG5cbnBwLmV4cGVjdENvbnRleHR1YWwgPSBmdW5jdGlvbihuYW1lKSB7XG4gIGlmICghdGhpcy5lYXRDb250ZXh0dWFsKG5hbWUpKSB7IHRoaXMudW5leHBlY3RlZCgpOyB9XG59O1xuXG4vLyBUZXN0IHdoZXRoZXIgYSBzZW1pY29sb24gY2FuIGJlIGluc2VydGVkIGF0IHRoZSBjdXJyZW50IHBvc2l0aW9uLlxuXG5wcC5jYW5JbnNlcnRTZW1pY29sb24gPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMudHlwZSA9PT0gdHlwZXMuZW9mIHx8XG4gICAgdGhpcy50eXBlID09PSB0eXBlcy5icmFjZVIgfHxcbiAgICBsaW5lQnJlYWsudGVzdCh0aGlzLmlucHV0LnNsaWNlKHRoaXMubGFzdFRva0VuZCwgdGhpcy5zdGFydCkpXG59O1xuXG5wcC5pbnNlcnRTZW1pY29sb24gPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCkpIHtcbiAgICBpZiAodGhpcy5vcHRpb25zLm9uSW5zZXJ0ZWRTZW1pY29sb24pXG4gICAgICB7IHRoaXMub3B0aW9ucy5vbkluc2VydGVkU2VtaWNvbG9uKHRoaXMubGFzdFRva0VuZCwgdGhpcy5sYXN0VG9rRW5kTG9jKTsgfVxuICAgIHJldHVybiB0cnVlXG4gIH1cbn07XG5cbi8vIENvbnN1bWUgYSBzZW1pY29sb24sIG9yLCBmYWlsaW5nIHRoYXQsIHNlZSBpZiB3ZSBhcmUgYWxsb3dlZCB0b1xuLy8gcHJldGVuZCB0aGF0IHRoZXJlIGlzIGEgc2VtaWNvbG9uIGF0IHRoaXMgcG9zaXRpb24uXG5cbnBwLnNlbWljb2xvbiA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMuZWF0KHR5cGVzLnNlbWkpICYmICF0aGlzLmluc2VydFNlbWljb2xvbigpKSB7IHRoaXMudW5leHBlY3RlZCgpOyB9XG59O1xuXG5wcC5hZnRlclRyYWlsaW5nQ29tbWEgPSBmdW5jdGlvbih0b2tUeXBlLCBub3ROZXh0KSB7XG4gIGlmICh0aGlzLnR5cGUgPT09IHRva1R5cGUpIHtcbiAgICBpZiAodGhpcy5vcHRpb25zLm9uVHJhaWxpbmdDb21tYSlcbiAgICAgIHsgdGhpcy5vcHRpb25zLm9uVHJhaWxpbmdDb21tYSh0aGlzLmxhc3RUb2tTdGFydCwgdGhpcy5sYXN0VG9rU3RhcnRMb2MpOyB9XG4gICAgaWYgKCFub3ROZXh0KVxuICAgICAgeyB0aGlzLm5leHQoKTsgfVxuICAgIHJldHVybiB0cnVlXG4gIH1cbn07XG5cbi8vIEV4cGVjdCBhIHRva2VuIG9mIGEgZ2l2ZW4gdHlwZS4gSWYgZm91bmQsIGNvbnN1bWUgaXQsIG90aGVyd2lzZSxcbi8vIHJhaXNlIGFuIHVuZXhwZWN0ZWQgdG9rZW4gZXJyb3IuXG5cbnBwLmV4cGVjdCA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgdGhpcy5lYXQodHlwZSkgfHwgdGhpcy51bmV4cGVjdGVkKCk7XG59O1xuXG4vLyBSYWlzZSBhbiB1bmV4cGVjdGVkIHRva2VuIGVycm9yLlxuXG5wcC51bmV4cGVjdGVkID0gZnVuY3Rpb24ocG9zKSB7XG4gIHRoaXMucmFpc2UocG9zICE9IG51bGwgPyBwb3MgOiB0aGlzLnN0YXJ0LCBcIlVuZXhwZWN0ZWQgdG9rZW5cIik7XG59O1xuXG5mdW5jdGlvbiBEZXN0cnVjdHVyaW5nRXJyb3JzKCkge1xuICB0aGlzLnNob3J0aGFuZEFzc2lnbiA9XG4gIHRoaXMudHJhaWxpbmdDb21tYSA9XG4gIHRoaXMucGFyZW50aGVzaXplZEFzc2lnbiA9XG4gIHRoaXMucGFyZW50aGVzaXplZEJpbmQgPVxuICB0aGlzLmRvdWJsZVByb3RvID1cbiAgICAtMTtcbn1cblxucHAuY2hlY2tQYXR0ZXJuRXJyb3JzID0gZnVuY3Rpb24ocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycywgaXNBc3NpZ24pIHtcbiAgaWYgKCFyZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7IHJldHVybiB9XG4gIGlmIChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnRyYWlsaW5nQ29tbWEgPiAtMSlcbiAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnRyYWlsaW5nQ29tbWEsIFwiQ29tbWEgaXMgbm90IHBlcm1pdHRlZCBhZnRlciB0aGUgcmVzdCBlbGVtZW50XCIpOyB9XG4gIHZhciBwYXJlbnMgPSBpc0Fzc2lnbiA/IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMucGFyZW50aGVzaXplZEFzc2lnbiA6IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMucGFyZW50aGVzaXplZEJpbmQ7XG4gIGlmIChwYXJlbnMgPiAtMSkgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUocGFyZW5zLCBcIlBhcmVudGhlc2l6ZWQgcGF0dGVyblwiKTsgfVxufTtcblxucHAuY2hlY2tFeHByZXNzaW9uRXJyb3JzID0gZnVuY3Rpb24ocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycywgYW5kVGhyb3cpIHtcbiAgaWYgKCFyZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7IHJldHVybiBmYWxzZSB9XG4gIHZhciBzaG9ydGhhbmRBc3NpZ24gPSByZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnNob3J0aGFuZEFzc2lnbjtcbiAgdmFyIGRvdWJsZVByb3RvID0gcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy5kb3VibGVQcm90bztcbiAgaWYgKCFhbmRUaHJvdykgeyByZXR1cm4gc2hvcnRoYW5kQXNzaWduID49IDAgfHwgZG91YmxlUHJvdG8gPj0gMCB9XG4gIGlmIChzaG9ydGhhbmRBc3NpZ24gPj0gMClcbiAgICB7IHRoaXMucmFpc2Uoc2hvcnRoYW5kQXNzaWduLCBcIlNob3J0aGFuZCBwcm9wZXJ0eSBhc3NpZ25tZW50cyBhcmUgdmFsaWQgb25seSBpbiBkZXN0cnVjdHVyaW5nIHBhdHRlcm5zXCIpOyB9XG4gIGlmIChkb3VibGVQcm90byA+PSAwKVxuICAgIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKGRvdWJsZVByb3RvLCBcIlJlZGVmaW5pdGlvbiBvZiBfX3Byb3RvX18gcHJvcGVydHlcIik7IH1cbn07XG5cbnBwLmNoZWNrWWllbGRBd2FpdEluRGVmYXVsdFBhcmFtcyA9IGZ1bmN0aW9uKCkge1xuICBpZiAodGhpcy55aWVsZFBvcyAmJiAoIXRoaXMuYXdhaXRQb3MgfHwgdGhpcy55aWVsZFBvcyA8IHRoaXMuYXdhaXRQb3MpKVxuICAgIHsgdGhpcy5yYWlzZSh0aGlzLnlpZWxkUG9zLCBcIllpZWxkIGV4cHJlc3Npb24gY2Fubm90IGJlIGEgZGVmYXVsdCB2YWx1ZVwiKTsgfVxuICBpZiAodGhpcy5hd2FpdFBvcylcbiAgICB7IHRoaXMucmFpc2UodGhpcy5hd2FpdFBvcywgXCJBd2FpdCBleHByZXNzaW9uIGNhbm5vdCBiZSBhIGRlZmF1bHQgdmFsdWVcIik7IH1cbn07XG5cbnBwLmlzU2ltcGxlQXNzaWduVGFyZ2V0ID0gZnVuY3Rpb24oZXhwcikge1xuICBpZiAoZXhwci50eXBlID09PSBcIlBhcmVudGhlc2l6ZWRFeHByZXNzaW9uXCIpXG4gICAgeyByZXR1cm4gdGhpcy5pc1NpbXBsZUFzc2lnblRhcmdldChleHByLmV4cHJlc3Npb24pIH1cbiAgcmV0dXJuIGV4cHIudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgfHwgZXhwci50eXBlID09PSBcIk1lbWJlckV4cHJlc3Npb25cIlxufTtcblxudmFyIHBwJDEgPSBQYXJzZXIucHJvdG90eXBlO1xuXG4vLyAjIyMgU3RhdGVtZW50IHBhcnNpbmdcblxuLy8gUGFyc2UgYSBwcm9ncmFtLiBJbml0aWFsaXplcyB0aGUgcGFyc2VyLCByZWFkcyBhbnkgbnVtYmVyIG9mXG4vLyBzdGF0ZW1lbnRzLCBhbmQgd3JhcHMgdGhlbSBpbiBhIFByb2dyYW0gbm9kZS4gIE9wdGlvbmFsbHkgdGFrZXMgYVxuLy8gYHByb2dyYW1gIGFyZ3VtZW50LiAgSWYgcHJlc2VudCwgdGhlIHN0YXRlbWVudHMgd2lsbCBiZSBhcHBlbmRlZFxuLy8gdG8gaXRzIGJvZHkgaW5zdGVhZCBvZiBjcmVhdGluZyBhIG5ldyBub2RlLlxuXG5wcCQxLnBhcnNlVG9wTGV2ZWwgPSBmdW5jdGlvbihub2RlKSB7XG4gIHZhciBleHBvcnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgaWYgKCFub2RlLmJvZHkpIHsgbm9kZS5ib2R5ID0gW107IH1cbiAgd2hpbGUgKHRoaXMudHlwZSAhPT0gdHlwZXMuZW9mKSB7XG4gICAgdmFyIHN0bXQgPSB0aGlzLnBhcnNlU3RhdGVtZW50KG51bGwsIHRydWUsIGV4cG9ydHMpO1xuICAgIG5vZGUuYm9keS5wdXNoKHN0bXQpO1xuICB9XG4gIGlmICh0aGlzLmluTW9kdWxlKVxuICAgIHsgZm9yICh2YXIgaSA9IDAsIGxpc3QgPSBPYmplY3Qua2V5cyh0aGlzLnVuZGVmaW5lZEV4cG9ydHMpOyBpIDwgbGlzdC5sZW5ndGg7IGkgKz0gMSlcbiAgICAgIHtcbiAgICAgICAgdmFyIG5hbWUgPSBsaXN0W2ldO1xuXG4gICAgICAgIHRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnVuZGVmaW5lZEV4cG9ydHNbbmFtZV0uc3RhcnQsIChcIkV4cG9ydCAnXCIgKyBuYW1lICsgXCInIGlzIG5vdCBkZWZpbmVkXCIpKTtcbiAgICAgIH0gfVxuICB0aGlzLmFkYXB0RGlyZWN0aXZlUHJvbG9ndWUobm9kZS5ib2R5KTtcbiAgdGhpcy5uZXh0KCk7XG4gIG5vZGUuc291cmNlVHlwZSA9IHRoaXMub3B0aW9ucy5zb3VyY2VUeXBlO1xuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiUHJvZ3JhbVwiKVxufTtcblxudmFyIGxvb3BMYWJlbCA9IHtraW5kOiBcImxvb3BcIn0sIHN3aXRjaExhYmVsID0ge2tpbmQ6IFwic3dpdGNoXCJ9O1xuXG5wcCQxLmlzTGV0ID0gZnVuY3Rpb24oY29udGV4dCkge1xuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uIDwgNiB8fCAhdGhpcy5pc0NvbnRleHR1YWwoXCJsZXRcIikpIHsgcmV0dXJuIGZhbHNlIH1cbiAgc2tpcFdoaXRlU3BhY2UubGFzdEluZGV4ID0gdGhpcy5wb3M7XG4gIHZhciBza2lwID0gc2tpcFdoaXRlU3BhY2UuZXhlYyh0aGlzLmlucHV0KTtcbiAgdmFyIG5leHQgPSB0aGlzLnBvcyArIHNraXBbMF0ubGVuZ3RoLCBuZXh0Q2ggPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQobmV4dCk7XG4gIC8vIEZvciBhbWJpZ3VvdXMgY2FzZXMsIGRldGVybWluZSBpZiBhIExleGljYWxEZWNsYXJhdGlvbiAob3Igb25seSBhXG4gIC8vIFN0YXRlbWVudCkgaXMgYWxsb3dlZCBoZXJlLiBJZiBjb250ZXh0IGlzIG5vdCBlbXB0eSB0aGVuIG9ubHkgYSBTdGF0ZW1lbnRcbiAgLy8gaXMgYWxsb3dlZC4gSG93ZXZlciwgYGxldCBbYCBpcyBhbiBleHBsaWNpdCBuZWdhdGl2ZSBsb29rYWhlYWQgZm9yXG4gIC8vIEV4cHJlc3Npb25TdGF0ZW1lbnQsIHNvIHNwZWNpYWwtY2FzZSBpdCBmaXJzdC5cbiAgaWYgKG5leHRDaCA9PT0gOTEgfHwgbmV4dENoID09PSA5MiB8fCBuZXh0Q2ggPiAweGQ3ZmYgJiYgbmV4dENoIDwgMHhkYzAwKSB7IHJldHVybiB0cnVlIH0gLy8gJ1snLCAnLycsIGFzdHJhbFxuICBpZiAoY29udGV4dCkgeyByZXR1cm4gZmFsc2UgfVxuXG4gIGlmIChuZXh0Q2ggPT09IDEyMykgeyByZXR1cm4gdHJ1ZSB9IC8vICd7J1xuICBpZiAoaXNJZGVudGlmaWVyU3RhcnQobmV4dENoLCB0cnVlKSkge1xuICAgIHZhciBwb3MgPSBuZXh0ICsgMTtcbiAgICB3aGlsZSAoaXNJZGVudGlmaWVyQ2hhcihuZXh0Q2ggPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQocG9zKSwgdHJ1ZSkpIHsgKytwb3M7IH1cbiAgICBpZiAobmV4dENoID09PSA5MiB8fCBuZXh0Q2ggPiAweGQ3ZmYgJiYgbmV4dENoIDwgMHhkYzAwKSB7IHJldHVybiB0cnVlIH1cbiAgICB2YXIgaWRlbnQgPSB0aGlzLmlucHV0LnNsaWNlKG5leHQsIHBvcyk7XG4gICAgaWYgKCFrZXl3b3JkUmVsYXRpb25hbE9wZXJhdG9yLnRlc3QoaWRlbnQpKSB7IHJldHVybiB0cnVlIH1cbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cbi8vIGNoZWNrICdhc3luYyBbbm8gTGluZVRlcm1pbmF0b3IgaGVyZV0gZnVuY3Rpb24nXG4vLyAtICdhc3luYyAvKmZvbyovIGZ1bmN0aW9uJyBpcyBPSy5cbi8vIC0gJ2FzeW5jIC8qXFxuKi8gZnVuY3Rpb24nIGlzIGludmFsaWQuXG5wcCQxLmlzQXN5bmNGdW5jdGlvbiA9IGZ1bmN0aW9uKCkge1xuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uIDwgOCB8fCAhdGhpcy5pc0NvbnRleHR1YWwoXCJhc3luY1wiKSlcbiAgICB7IHJldHVybiBmYWxzZSB9XG5cbiAgc2tpcFdoaXRlU3BhY2UubGFzdEluZGV4ID0gdGhpcy5wb3M7XG4gIHZhciBza2lwID0gc2tpcFdoaXRlU3BhY2UuZXhlYyh0aGlzLmlucHV0KTtcbiAgdmFyIG5leHQgPSB0aGlzLnBvcyArIHNraXBbMF0ubGVuZ3RoLCBhZnRlcjtcbiAgcmV0dXJuICFsaW5lQnJlYWsudGVzdCh0aGlzLmlucHV0LnNsaWNlKHRoaXMucG9zLCBuZXh0KSkgJiZcbiAgICB0aGlzLmlucHV0LnNsaWNlKG5leHQsIG5leHQgKyA4KSA9PT0gXCJmdW5jdGlvblwiICYmXG4gICAgKG5leHQgKyA4ID09PSB0aGlzLmlucHV0Lmxlbmd0aCB8fFxuICAgICAhKGlzSWRlbnRpZmllckNoYXIoYWZ0ZXIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQobmV4dCArIDgpKSB8fCBhZnRlciA+IDB4ZDdmZiAmJiBhZnRlciA8IDB4ZGMwMCkpXG59O1xuXG4vLyBQYXJzZSBhIHNpbmdsZSBzdGF0ZW1lbnQuXG4vL1xuLy8gSWYgZXhwZWN0aW5nIGEgc3RhdGVtZW50IGFuZCBmaW5kaW5nIGEgc2xhc2ggb3BlcmF0b3IsIHBhcnNlIGFcbi8vIHJlZ3VsYXIgZXhwcmVzc2lvbiBsaXRlcmFsLiBUaGlzIGlzIHRvIGhhbmRsZSBjYXNlcyBsaWtlXG4vLyBgaWYgKGZvbykgL2JsYWgvLmV4ZWMoZm9vKWAsIHdoZXJlIGxvb2tpbmcgYXQgdGhlIHByZXZpb3VzIHRva2VuXG4vLyBkb2VzIG5vdCBoZWxwLlxuXG5wcCQxLnBhcnNlU3RhdGVtZW50ID0gZnVuY3Rpb24oY29udGV4dCwgdG9wTGV2ZWwsIGV4cG9ydHMpIHtcbiAgdmFyIHN0YXJ0dHlwZSA9IHRoaXMudHlwZSwgbm9kZSA9IHRoaXMuc3RhcnROb2RlKCksIGtpbmQ7XG5cbiAgaWYgKHRoaXMuaXNMZXQoY29udGV4dCkpIHtcbiAgICBzdGFydHR5cGUgPSB0eXBlcy5fdmFyO1xuICAgIGtpbmQgPSBcImxldFwiO1xuICB9XG5cbiAgLy8gTW9zdCB0eXBlcyBvZiBzdGF0ZW1lbnRzIGFyZSByZWNvZ25pemVkIGJ5IHRoZSBrZXl3b3JkIHRoZXlcbiAgLy8gc3RhcnQgd2l0aC4gTWFueSBhcmUgdHJpdmlhbCB0byBwYXJzZSwgc29tZSByZXF1aXJlIGEgYml0IG9mXG4gIC8vIGNvbXBsZXhpdHkuXG5cbiAgc3dpdGNoIChzdGFydHR5cGUpIHtcbiAgY2FzZSB0eXBlcy5fYnJlYWs6IGNhc2UgdHlwZXMuX2NvbnRpbnVlOiByZXR1cm4gdGhpcy5wYXJzZUJyZWFrQ29udGludWVTdGF0ZW1lbnQobm9kZSwgc3RhcnR0eXBlLmtleXdvcmQpXG4gIGNhc2UgdHlwZXMuX2RlYnVnZ2VyOiByZXR1cm4gdGhpcy5wYXJzZURlYnVnZ2VyU3RhdGVtZW50KG5vZGUpXG4gIGNhc2UgdHlwZXMuX2RvOiByZXR1cm4gdGhpcy5wYXJzZURvU3RhdGVtZW50KG5vZGUpXG4gIGNhc2UgdHlwZXMuX2ZvcjogcmV0dXJuIHRoaXMucGFyc2VGb3JTdGF0ZW1lbnQobm9kZSlcbiAgY2FzZSB0eXBlcy5fZnVuY3Rpb246XG4gICAgLy8gRnVuY3Rpb24gYXMgc29sZSBib2R5IG9mIGVpdGhlciBhbiBpZiBzdGF0ZW1lbnQgb3IgYSBsYWJlbGVkIHN0YXRlbWVudFxuICAgIC8vIHdvcmtzLCBidXQgbm90IHdoZW4gaXQgaXMgcGFydCBvZiBhIGxhYmVsZWQgc3RhdGVtZW50IHRoYXQgaXMgdGhlIHNvbGVcbiAgICAvLyBib2R5IG9mIGFuIGlmIHN0YXRlbWVudC5cbiAgICBpZiAoKGNvbnRleHQgJiYgKHRoaXMuc3RyaWN0IHx8IGNvbnRleHQgIT09IFwiaWZcIiAmJiBjb250ZXh0ICE9PSBcImxhYmVsXCIpKSAmJiB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNikgeyB0aGlzLnVuZXhwZWN0ZWQoKTsgfVxuICAgIHJldHVybiB0aGlzLnBhcnNlRnVuY3Rpb25TdGF0ZW1lbnQobm9kZSwgZmFsc2UsICFjb250ZXh0KVxuICBjYXNlIHR5cGVzLl9jbGFzczpcbiAgICBpZiAoY29udGV4dCkgeyB0aGlzLnVuZXhwZWN0ZWQoKTsgfVxuICAgIHJldHVybiB0aGlzLnBhcnNlQ2xhc3Mobm9kZSwgdHJ1ZSlcbiAgY2FzZSB0eXBlcy5faWY6IHJldHVybiB0aGlzLnBhcnNlSWZTdGF0ZW1lbnQobm9kZSlcbiAgY2FzZSB0eXBlcy5fcmV0dXJuOiByZXR1cm4gdGhpcy5wYXJzZVJldHVyblN0YXRlbWVudChub2RlKVxuICBjYXNlIHR5cGVzLl9zd2l0Y2g6IHJldHVybiB0aGlzLnBhcnNlU3dpdGNoU3RhdGVtZW50KG5vZGUpXG4gIGNhc2UgdHlwZXMuX3Rocm93OiByZXR1cm4gdGhpcy5wYXJzZVRocm93U3RhdGVtZW50KG5vZGUpXG4gIGNhc2UgdHlwZXMuX3RyeTogcmV0dXJuIHRoaXMucGFyc2VUcnlTdGF0ZW1lbnQobm9kZSlcbiAgY2FzZSB0eXBlcy5fY29uc3Q6IGNhc2UgdHlwZXMuX3ZhcjpcbiAgICBraW5kID0ga2luZCB8fCB0aGlzLnZhbHVlO1xuICAgIGlmIChjb250ZXh0ICYmIGtpbmQgIT09IFwidmFyXCIpIHsgdGhpcy51bmV4cGVjdGVkKCk7IH1cbiAgICByZXR1cm4gdGhpcy5wYXJzZVZhclN0YXRlbWVudChub2RlLCBraW5kKVxuICBjYXNlIHR5cGVzLl93aGlsZTogcmV0dXJuIHRoaXMucGFyc2VXaGlsZVN0YXRlbWVudChub2RlKVxuICBjYXNlIHR5cGVzLl93aXRoOiByZXR1cm4gdGhpcy5wYXJzZVdpdGhTdGF0ZW1lbnQobm9kZSlcbiAgY2FzZSB0eXBlcy5icmFjZUw6IHJldHVybiB0aGlzLnBhcnNlQmxvY2sodHJ1ZSwgbm9kZSlcbiAgY2FzZSB0eXBlcy5zZW1pOiByZXR1cm4gdGhpcy5wYXJzZUVtcHR5U3RhdGVtZW50KG5vZGUpXG4gIGNhc2UgdHlwZXMuX2V4cG9ydDpcbiAgY2FzZSB0eXBlcy5faW1wb3J0OlxuICAgIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPiAxMCAmJiBzdGFydHR5cGUgPT09IHR5cGVzLl9pbXBvcnQpIHtcbiAgICAgIHNraXBXaGl0ZVNwYWNlLmxhc3RJbmRleCA9IHRoaXMucG9zO1xuICAgICAgdmFyIHNraXAgPSBza2lwV2hpdGVTcGFjZS5leGVjKHRoaXMuaW5wdXQpO1xuICAgICAgdmFyIG5leHQgPSB0aGlzLnBvcyArIHNraXBbMF0ubGVuZ3RoLCBuZXh0Q2ggPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQobmV4dCk7XG4gICAgICBpZiAobmV4dENoID09PSA0MCB8fCBuZXh0Q2ggPT09IDQ2KSAvLyAnKCcgb3IgJy4nXG4gICAgICAgIHsgcmV0dXJuIHRoaXMucGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KG5vZGUsIHRoaXMucGFyc2VFeHByZXNzaW9uKCkpIH1cbiAgICB9XG5cbiAgICBpZiAoIXRoaXMub3B0aW9ucy5hbGxvd0ltcG9ydEV4cG9ydEV2ZXJ5d2hlcmUpIHtcbiAgICAgIGlmICghdG9wTGV2ZWwpXG4gICAgICAgIHsgdGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCBcIidpbXBvcnQnIGFuZCAnZXhwb3J0JyBtYXkgb25seSBhcHBlYXIgYXQgdGhlIHRvcCBsZXZlbFwiKTsgfVxuICAgICAgaWYgKCF0aGlzLmluTW9kdWxlKVxuICAgICAgICB7IHRoaXMucmFpc2UodGhpcy5zdGFydCwgXCInaW1wb3J0JyBhbmQgJ2V4cG9ydCcgbWF5IGFwcGVhciBvbmx5IHdpdGggJ3NvdXJjZVR5cGU6IG1vZHVsZSdcIik7IH1cbiAgICB9XG4gICAgcmV0dXJuIHN0YXJ0dHlwZSA9PT0gdHlwZXMuX2ltcG9ydCA/IHRoaXMucGFyc2VJbXBvcnQobm9kZSkgOiB0aGlzLnBhcnNlRXhwb3J0KG5vZGUsIGV4cG9ydHMpXG5cbiAgICAvLyBJZiB0aGUgc3RhdGVtZW50IGRvZXMgbm90IHN0YXJ0IHdpdGggYSBzdGF0ZW1lbnQga2V5d29yZCBvciBhXG4gICAgLy8gYnJhY2UsIGl0J3MgYW4gRXhwcmVzc2lvblN0YXRlbWVudCBvciBMYWJlbGVkU3RhdGVtZW50LiBXZVxuICAgIC8vIHNpbXBseSBzdGFydCBwYXJzaW5nIGFuIGV4cHJlc3Npb24sIGFuZCBhZnRlcndhcmRzLCBpZiB0aGVcbiAgICAvLyBuZXh0IHRva2VuIGlzIGEgY29sb24gYW5kIHRoZSBleHByZXNzaW9uIHdhcyBhIHNpbXBsZVxuICAgIC8vIElkZW50aWZpZXIgbm9kZSwgd2Ugc3dpdGNoIHRvIGludGVycHJldGluZyBpdCBhcyBhIGxhYmVsLlxuICBkZWZhdWx0OlxuICAgIGlmICh0aGlzLmlzQXN5bmNGdW5jdGlvbigpKSB7XG4gICAgICBpZiAoY29udGV4dCkgeyB0aGlzLnVuZXhwZWN0ZWQoKTsgfVxuICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZUZ1bmN0aW9uU3RhdGVtZW50KG5vZGUsIHRydWUsICFjb250ZXh0KVxuICAgIH1cblxuICAgIHZhciBtYXliZU5hbWUgPSB0aGlzLnZhbHVlLCBleHByID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTtcbiAgICBpZiAoc3RhcnR0eXBlID09PSB0eXBlcy5uYW1lICYmIGV4cHIudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgJiYgdGhpcy5lYXQodHlwZXMuY29sb24pKVxuICAgICAgeyByZXR1cm4gdGhpcy5wYXJzZUxhYmVsZWRTdGF0ZW1lbnQobm9kZSwgbWF5YmVOYW1lLCBleHByLCBjb250ZXh0KSB9XG4gICAgZWxzZSB7IHJldHVybiB0aGlzLnBhcnNlRXhwcmVzc2lvblN0YXRlbWVudChub2RlLCBleHByKSB9XG4gIH1cbn07XG5cbnBwJDEucGFyc2VCcmVha0NvbnRpbnVlU3RhdGVtZW50ID0gZnVuY3Rpb24obm9kZSwga2V5d29yZCkge1xuICB2YXIgaXNCcmVhayA9IGtleXdvcmQgPT09IFwiYnJlYWtcIjtcbiAgdGhpcy5uZXh0KCk7XG4gIGlmICh0aGlzLmVhdCh0eXBlcy5zZW1pKSB8fCB0aGlzLmluc2VydFNlbWljb2xvbigpKSB7IG5vZGUubGFiZWwgPSBudWxsOyB9XG4gIGVsc2UgaWYgKHRoaXMudHlwZSAhPT0gdHlwZXMubmFtZSkgeyB0aGlzLnVuZXhwZWN0ZWQoKTsgfVxuICBlbHNlIHtcbiAgICBub2RlLmxhYmVsID0gdGhpcy5wYXJzZUlkZW50KCk7XG4gICAgdGhpcy5zZW1pY29sb24oKTtcbiAgfVxuXG4gIC8vIFZlcmlmeSB0aGF0IHRoZXJlIGlzIGFuIGFjdHVhbCBkZXN0aW5hdGlvbiB0byBicmVhayBvclxuICAvLyBjb250aW51ZSB0by5cbiAgdmFyIGkgPSAwO1xuICBmb3IgKDsgaSA8IHRoaXMubGFiZWxzLmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIGxhYiA9IHRoaXMubGFiZWxzW2ldO1xuICAgIGlmIChub2RlLmxhYmVsID09IG51bGwgfHwgbGFiLm5hbWUgPT09IG5vZGUubGFiZWwubmFtZSkge1xuICAgICAgaWYgKGxhYi5raW5kICE9IG51bGwgJiYgKGlzQnJlYWsgfHwgbGFiLmtpbmQgPT09IFwibG9vcFwiKSkgeyBicmVhayB9XG4gICAgICBpZiAobm9kZS5sYWJlbCAmJiBpc0JyZWFrKSB7IGJyZWFrIH1cbiAgICB9XG4gIH1cbiAgaWYgKGkgPT09IHRoaXMubGFiZWxzLmxlbmd0aCkgeyB0aGlzLnJhaXNlKG5vZGUuc3RhcnQsIFwiVW5zeW50YWN0aWMgXCIgKyBrZXl3b3JkKTsgfVxuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIGlzQnJlYWsgPyBcIkJyZWFrU3RhdGVtZW50XCIgOiBcIkNvbnRpbnVlU3RhdGVtZW50XCIpXG59O1xuXG5wcCQxLnBhcnNlRGVidWdnZXJTdGF0ZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7XG4gIHRoaXMubmV4dCgpO1xuICB0aGlzLnNlbWljb2xvbigpO1xuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiRGVidWdnZXJTdGF0ZW1lbnRcIilcbn07XG5cbnBwJDEucGFyc2VEb1N0YXRlbWVudCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpcy5uZXh0KCk7XG4gIHRoaXMubGFiZWxzLnB1c2gobG9vcExhYmVsKTtcbiAgbm9kZS5ib2R5ID0gdGhpcy5wYXJzZVN0YXRlbWVudChcImRvXCIpO1xuICB0aGlzLmxhYmVscy5wb3AoKTtcbiAgdGhpcy5leHBlY3QodHlwZXMuX3doaWxlKTtcbiAgbm9kZS50ZXN0ID0gdGhpcy5wYXJzZVBhcmVuRXhwcmVzc2lvbigpO1xuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDYpXG4gICAgeyB0aGlzLmVhdCh0eXBlcy5zZW1pKTsgfVxuICBlbHNlXG4gICAgeyB0aGlzLnNlbWljb2xvbigpOyB9XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJEb1doaWxlU3RhdGVtZW50XCIpXG59O1xuXG4vLyBEaXNhbWJpZ3VhdGluZyBiZXR3ZWVuIGEgYGZvcmAgYW5kIGEgYGZvcmAvYGluYCBvciBgZm9yYC9gb2ZgXG4vLyBsb29wIGlzIG5vbi10cml2aWFsLiBCYXNpY2FsbHksIHdlIGhhdmUgdG8gcGFyc2UgdGhlIGluaXQgYHZhcmBcbi8vIHN0YXRlbWVudCBvciBleHByZXNzaW9uLCBkaXNhbGxvd2luZyB0aGUgYGluYCBvcGVyYXRvciAoc2VlXG4vLyB0aGUgc2Vjb25kIHBhcmFtZXRlciB0byBgcGFyc2VFeHByZXNzaW9uYCksIGFuZCB0aGVuIGNoZWNrXG4vLyB3aGV0aGVyIHRoZSBuZXh0IHRva2VuIGlzIGBpbmAgb3IgYG9mYC4gV2hlbiB0aGVyZSBpcyBubyBpbml0XG4vLyBwYXJ0IChzZW1pY29sb24gaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIG9wZW5pbmcgcGFyZW50aGVzaXMpLCBpdFxuLy8gaXMgYSByZWd1bGFyIGBmb3JgIGxvb3AuXG5cbnBwJDEucGFyc2VGb3JTdGF0ZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7XG4gIHRoaXMubmV4dCgpO1xuICB2YXIgYXdhaXRBdCA9ICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gOSAmJiB0aGlzLmNhbkF3YWl0ICYmIHRoaXMuZWF0Q29udGV4dHVhbChcImF3YWl0XCIpKSA/IHRoaXMubGFzdFRva1N0YXJ0IDogLTE7XG4gIHRoaXMubGFiZWxzLnB1c2gobG9vcExhYmVsKTtcbiAgdGhpcy5lbnRlclNjb3BlKDApO1xuICB0aGlzLmV4cGVjdCh0eXBlcy5wYXJlbkwpO1xuICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5zZW1pKSB7XG4gICAgaWYgKGF3YWl0QXQgPiAtMSkgeyB0aGlzLnVuZXhwZWN0ZWQoYXdhaXRBdCk7IH1cbiAgICByZXR1cm4gdGhpcy5wYXJzZUZvcihub2RlLCBudWxsKVxuICB9XG4gIHZhciBpc0xldCA9IHRoaXMuaXNMZXQoKTtcbiAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuX3ZhciB8fCB0aGlzLnR5cGUgPT09IHR5cGVzLl9jb25zdCB8fCBpc0xldCkge1xuICAgIHZhciBpbml0JDEgPSB0aGlzLnN0YXJ0Tm9kZSgpLCBraW5kID0gaXNMZXQgPyBcImxldFwiIDogdGhpcy52YWx1ZTtcbiAgICB0aGlzLm5leHQoKTtcbiAgICB0aGlzLnBhcnNlVmFyKGluaXQkMSwgdHJ1ZSwga2luZCk7XG4gICAgdGhpcy5maW5pc2hOb2RlKGluaXQkMSwgXCJWYXJpYWJsZURlY2xhcmF0aW9uXCIpO1xuICAgIGlmICgodGhpcy50eXBlID09PSB0eXBlcy5faW4gfHwgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2ICYmIHRoaXMuaXNDb250ZXh0dWFsKFwib2ZcIikpKSAmJiBpbml0JDEuZGVjbGFyYXRpb25zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA5KSB7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLl9pbikge1xuICAgICAgICAgIGlmIChhd2FpdEF0ID4gLTEpIHsgdGhpcy51bmV4cGVjdGVkKGF3YWl0QXQpOyB9XG4gICAgICAgIH0gZWxzZSB7IG5vZGUuYXdhaXQgPSBhd2FpdEF0ID4gLTE7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLnBhcnNlRm9ySW4obm9kZSwgaW5pdCQxKVxuICAgIH1cbiAgICBpZiAoYXdhaXRBdCA+IC0xKSB7IHRoaXMudW5leHBlY3RlZChhd2FpdEF0KTsgfVxuICAgIHJldHVybiB0aGlzLnBhcnNlRm9yKG5vZGUsIGluaXQkMSlcbiAgfVxuICB2YXIgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycyA9IG5ldyBEZXN0cnVjdHVyaW5nRXJyb3JzO1xuICB2YXIgaW5pdCA9IHRoaXMucGFyc2VFeHByZXNzaW9uKGF3YWl0QXQgPiAtMSA/IFwiYXdhaXRcIiA6IHRydWUsIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpO1xuICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5faW4gfHwgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2ICYmIHRoaXMuaXNDb250ZXh0dWFsKFwib2ZcIikpKSB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA5KSB7XG4gICAgICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5faW4pIHtcbiAgICAgICAgaWYgKGF3YWl0QXQgPiAtMSkgeyB0aGlzLnVuZXhwZWN0ZWQoYXdhaXRBdCk7IH1cbiAgICAgIH0gZWxzZSB7IG5vZGUuYXdhaXQgPSBhd2FpdEF0ID4gLTE7IH1cbiAgICB9XG4gICAgdGhpcy50b0Fzc2lnbmFibGUoaW5pdCwgZmFsc2UsIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpO1xuICAgIHRoaXMuY2hlY2tMVmFsUGF0dGVybihpbml0KTtcbiAgICByZXR1cm4gdGhpcy5wYXJzZUZvckluKG5vZGUsIGluaXQpXG4gIH0gZWxzZSB7XG4gICAgdGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnMocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycywgdHJ1ZSk7XG4gIH1cbiAgaWYgKGF3YWl0QXQgPiAtMSkgeyB0aGlzLnVuZXhwZWN0ZWQoYXdhaXRBdCk7IH1cbiAgcmV0dXJuIHRoaXMucGFyc2VGb3Iobm9kZSwgaW5pdClcbn07XG5cbnBwJDEucGFyc2VGdW5jdGlvblN0YXRlbWVudCA9IGZ1bmN0aW9uKG5vZGUsIGlzQXN5bmMsIGRlY2xhcmF0aW9uUG9zaXRpb24pIHtcbiAgdGhpcy5uZXh0KCk7XG4gIHJldHVybiB0aGlzLnBhcnNlRnVuY3Rpb24obm9kZSwgRlVOQ19TVEFURU1FTlQgfCAoZGVjbGFyYXRpb25Qb3NpdGlvbiA/IDAgOiBGVU5DX0hBTkdJTkdfU1RBVEVNRU5UKSwgZmFsc2UsIGlzQXN5bmMpXG59O1xuXG5wcCQxLnBhcnNlSWZTdGF0ZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7XG4gIHRoaXMubmV4dCgpO1xuICBub2RlLnRlc3QgPSB0aGlzLnBhcnNlUGFyZW5FeHByZXNzaW9uKCk7XG4gIC8vIGFsbG93IGZ1bmN0aW9uIGRlY2xhcmF0aW9ucyBpbiBicmFuY2hlcywgYnV0IG9ubHkgaW4gbm9uLXN0cmljdCBtb2RlXG4gIG5vZGUuY29uc2VxdWVudCA9IHRoaXMucGFyc2VTdGF0ZW1lbnQoXCJpZlwiKTtcbiAgbm9kZS5hbHRlcm5hdGUgPSB0aGlzLmVhdCh0eXBlcy5fZWxzZSkgPyB0aGlzLnBhcnNlU3RhdGVtZW50KFwiaWZcIikgOiBudWxsO1xuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiSWZTdGF0ZW1lbnRcIilcbn07XG5cbnBwJDEucGFyc2VSZXR1cm5TdGF0ZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7XG4gIGlmICghdGhpcy5pbkZ1bmN0aW9uICYmICF0aGlzLm9wdGlvbnMuYWxsb3dSZXR1cm5PdXRzaWRlRnVuY3Rpb24pXG4gICAgeyB0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIFwiJ3JldHVybicgb3V0c2lkZSBvZiBmdW5jdGlvblwiKTsgfVxuICB0aGlzLm5leHQoKTtcblxuICAvLyBJbiBgcmV0dXJuYCAoYW5kIGBicmVha2AvYGNvbnRpbnVlYCksIHRoZSBrZXl3b3JkcyB3aXRoXG4gIC8vIG9wdGlvbmFsIGFyZ3VtZW50cywgd2UgZWFnZXJseSBsb29rIGZvciBhIHNlbWljb2xvbiBvciB0aGVcbiAgLy8gcG9zc2liaWxpdHkgdG8gaW5zZXJ0IG9uZS5cblxuICBpZiAodGhpcy5lYXQodHlwZXMuc2VtaSkgfHwgdGhpcy5pbnNlcnRTZW1pY29sb24oKSkgeyBub2RlLmFyZ3VtZW50ID0gbnVsbDsgfVxuICBlbHNlIHsgbm9kZS5hcmd1bWVudCA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7IHRoaXMuc2VtaWNvbG9uKCk7IH1cbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIlJldHVyblN0YXRlbWVudFwiKVxufTtcblxucHAkMS5wYXJzZVN3aXRjaFN0YXRlbWVudCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpcy5uZXh0KCk7XG4gIG5vZGUuZGlzY3JpbWluYW50ID0gdGhpcy5wYXJzZVBhcmVuRXhwcmVzc2lvbigpO1xuICBub2RlLmNhc2VzID0gW107XG4gIHRoaXMuZXhwZWN0KHR5cGVzLmJyYWNlTCk7XG4gIHRoaXMubGFiZWxzLnB1c2goc3dpdGNoTGFiZWwpO1xuICB0aGlzLmVudGVyU2NvcGUoMCk7XG5cbiAgLy8gU3RhdGVtZW50cyB1bmRlciBtdXN0IGJlIGdyb3VwZWQgKGJ5IGxhYmVsKSBpbiBTd2l0Y2hDYXNlXG4gIC8vIG5vZGVzLiBgY3VyYCBpcyB1c2VkIHRvIGtlZXAgdGhlIG5vZGUgdGhhdCB3ZSBhcmUgY3VycmVudGx5XG4gIC8vIGFkZGluZyBzdGF0ZW1lbnRzIHRvLlxuXG4gIHZhciBjdXI7XG4gIGZvciAodmFyIHNhd0RlZmF1bHQgPSBmYWxzZTsgdGhpcy50eXBlICE9PSB0eXBlcy5icmFjZVI7KSB7XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuX2Nhc2UgfHwgdGhpcy50eXBlID09PSB0eXBlcy5fZGVmYXVsdCkge1xuICAgICAgdmFyIGlzQ2FzZSA9IHRoaXMudHlwZSA9PT0gdHlwZXMuX2Nhc2U7XG4gICAgICBpZiAoY3VyKSB7IHRoaXMuZmluaXNoTm9kZShjdXIsIFwiU3dpdGNoQ2FzZVwiKTsgfVxuICAgICAgbm9kZS5jYXNlcy5wdXNoKGN1ciA9IHRoaXMuc3RhcnROb2RlKCkpO1xuICAgICAgY3VyLmNvbnNlcXVlbnQgPSBbXTtcbiAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgaWYgKGlzQ2FzZSkge1xuICAgICAgICBjdXIudGVzdCA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2F3RGVmYXVsdCkgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5sYXN0VG9rU3RhcnQsIFwiTXVsdGlwbGUgZGVmYXVsdCBjbGF1c2VzXCIpOyB9XG4gICAgICAgIHNhd0RlZmF1bHQgPSB0cnVlO1xuICAgICAgICBjdXIudGVzdCA9IG51bGw7XG4gICAgICB9XG4gICAgICB0aGlzLmV4cGVjdCh0eXBlcy5jb2xvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghY3VyKSB7IHRoaXMudW5leHBlY3RlZCgpOyB9XG4gICAgICBjdXIuY29uc2VxdWVudC5wdXNoKHRoaXMucGFyc2VTdGF0ZW1lbnQobnVsbCkpO1xuICAgIH1cbiAgfVxuICB0aGlzLmV4aXRTY29wZSgpO1xuICBpZiAoY3VyKSB7IHRoaXMuZmluaXNoTm9kZShjdXIsIFwiU3dpdGNoQ2FzZVwiKTsgfVxuICB0aGlzLm5leHQoKTsgLy8gQ2xvc2luZyBicmFjZVxuICB0aGlzLmxhYmVscy5wb3AoKTtcbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIlN3aXRjaFN0YXRlbWVudFwiKVxufTtcblxucHAkMS5wYXJzZVRocm93U3RhdGVtZW50ID0gZnVuY3Rpb24obm9kZSkge1xuICB0aGlzLm5leHQoKTtcbiAgaWYgKGxpbmVCcmVhay50ZXN0KHRoaXMuaW5wdXQuc2xpY2UodGhpcy5sYXN0VG9rRW5kLCB0aGlzLnN0YXJ0KSkpXG4gICAgeyB0aGlzLnJhaXNlKHRoaXMubGFzdFRva0VuZCwgXCJJbGxlZ2FsIG5ld2xpbmUgYWZ0ZXIgdGhyb3dcIik7IH1cbiAgbm9kZS5hcmd1bWVudCA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7XG4gIHRoaXMuc2VtaWNvbG9uKCk7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJUaHJvd1N0YXRlbWVudFwiKVxufTtcblxuLy8gUmV1c2VkIGVtcHR5IGFycmF5IGFkZGVkIGZvciBub2RlIGZpZWxkcyB0aGF0IGFyZSBhbHdheXMgZW1wdHkuXG5cbnZhciBlbXB0eSA9IFtdO1xuXG5wcCQxLnBhcnNlVHJ5U3RhdGVtZW50ID0gZnVuY3Rpb24obm9kZSkge1xuICB0aGlzLm5leHQoKTtcbiAgbm9kZS5ibG9jayA9IHRoaXMucGFyc2VCbG9jaygpO1xuICBub2RlLmhhbmRsZXIgPSBudWxsO1xuICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5fY2F0Y2gpIHtcbiAgICB2YXIgY2xhdXNlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgICB0aGlzLm5leHQoKTtcbiAgICBpZiAodGhpcy5lYXQodHlwZXMucGFyZW5MKSkge1xuICAgICAgY2xhdXNlLnBhcmFtID0gdGhpcy5wYXJzZUJpbmRpbmdBdG9tKCk7XG4gICAgICB2YXIgc2ltcGxlID0gY2xhdXNlLnBhcmFtLnR5cGUgPT09IFwiSWRlbnRpZmllclwiO1xuICAgICAgdGhpcy5lbnRlclNjb3BlKHNpbXBsZSA/IFNDT1BFX1NJTVBMRV9DQVRDSCA6IDApO1xuICAgICAgdGhpcy5jaGVja0xWYWxQYXR0ZXJuKGNsYXVzZS5wYXJhbSwgc2ltcGxlID8gQklORF9TSU1QTEVfQ0FUQ0ggOiBCSU5EX0xFWElDQUwpO1xuICAgICAgdGhpcy5leHBlY3QodHlwZXMucGFyZW5SKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA8IDEwKSB7IHRoaXMudW5leHBlY3RlZCgpOyB9XG4gICAgICBjbGF1c2UucGFyYW0gPSBudWxsO1xuICAgICAgdGhpcy5lbnRlclNjb3BlKDApO1xuICAgIH1cbiAgICBjbGF1c2UuYm9keSA9IHRoaXMucGFyc2VCbG9jayhmYWxzZSk7XG4gICAgdGhpcy5leGl0U2NvcGUoKTtcbiAgICBub2RlLmhhbmRsZXIgPSB0aGlzLmZpbmlzaE5vZGUoY2xhdXNlLCBcIkNhdGNoQ2xhdXNlXCIpO1xuICB9XG4gIG5vZGUuZmluYWxpemVyID0gdGhpcy5lYXQodHlwZXMuX2ZpbmFsbHkpID8gdGhpcy5wYXJzZUJsb2NrKCkgOiBudWxsO1xuICBpZiAoIW5vZGUuaGFuZGxlciAmJiAhbm9kZS5maW5hbGl6ZXIpXG4gICAgeyB0aGlzLnJhaXNlKG5vZGUuc3RhcnQsIFwiTWlzc2luZyBjYXRjaCBvciBmaW5hbGx5IGNsYXVzZVwiKTsgfVxuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiVHJ5U3RhdGVtZW50XCIpXG59O1xuXG5wcCQxLnBhcnNlVmFyU3RhdGVtZW50ID0gZnVuY3Rpb24obm9kZSwga2luZCkge1xuICB0aGlzLm5leHQoKTtcbiAgdGhpcy5wYXJzZVZhcihub2RlLCBmYWxzZSwga2luZCk7XG4gIHRoaXMuc2VtaWNvbG9uKCk7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJWYXJpYWJsZURlY2xhcmF0aW9uXCIpXG59O1xuXG5wcCQxLnBhcnNlV2hpbGVTdGF0ZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7XG4gIHRoaXMubmV4dCgpO1xuICBub2RlLnRlc3QgPSB0aGlzLnBhcnNlUGFyZW5FeHByZXNzaW9uKCk7XG4gIHRoaXMubGFiZWxzLnB1c2gobG9vcExhYmVsKTtcbiAgbm9kZS5ib2R5ID0gdGhpcy5wYXJzZVN0YXRlbWVudChcIndoaWxlXCIpO1xuICB0aGlzLmxhYmVscy5wb3AoKTtcbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIldoaWxlU3RhdGVtZW50XCIpXG59O1xuXG5wcCQxLnBhcnNlV2l0aFN0YXRlbWVudCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgaWYgKHRoaXMuc3RyaWN0KSB7IHRoaXMucmFpc2UodGhpcy5zdGFydCwgXCInd2l0aCcgaW4gc3RyaWN0IG1vZGVcIik7IH1cbiAgdGhpcy5uZXh0KCk7XG4gIG5vZGUub2JqZWN0ID0gdGhpcy5wYXJzZVBhcmVuRXhwcmVzc2lvbigpO1xuICBub2RlLmJvZHkgPSB0aGlzLnBhcnNlU3RhdGVtZW50KFwid2l0aFwiKTtcbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIldpdGhTdGF0ZW1lbnRcIilcbn07XG5cbnBwJDEucGFyc2VFbXB0eVN0YXRlbWVudCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpcy5uZXh0KCk7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJFbXB0eVN0YXRlbWVudFwiKVxufTtcblxucHAkMS5wYXJzZUxhYmVsZWRTdGF0ZW1lbnQgPSBmdW5jdGlvbihub2RlLCBtYXliZU5hbWUsIGV4cHIsIGNvbnRleHQpIHtcbiAgZm9yICh2YXIgaSQxID0gMCwgbGlzdCA9IHRoaXMubGFiZWxzOyBpJDEgPCBsaXN0Lmxlbmd0aDsgaSQxICs9IDEpXG4gICAge1xuICAgIHZhciBsYWJlbCA9IGxpc3RbaSQxXTtcblxuICAgIGlmIChsYWJlbC5uYW1lID09PSBtYXliZU5hbWUpXG4gICAgICB7IHRoaXMucmFpc2UoZXhwci5zdGFydCwgXCJMYWJlbCAnXCIgKyBtYXliZU5hbWUgKyBcIicgaXMgYWxyZWFkeSBkZWNsYXJlZFwiKTtcbiAgfSB9XG4gIHZhciBraW5kID0gdGhpcy50eXBlLmlzTG9vcCA/IFwibG9vcFwiIDogdGhpcy50eXBlID09PSB0eXBlcy5fc3dpdGNoID8gXCJzd2l0Y2hcIiA6IG51bGw7XG4gIGZvciAodmFyIGkgPSB0aGlzLmxhYmVscy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIHZhciBsYWJlbCQxID0gdGhpcy5sYWJlbHNbaV07XG4gICAgaWYgKGxhYmVsJDEuc3RhdGVtZW50U3RhcnQgPT09IG5vZGUuc3RhcnQpIHtcbiAgICAgIC8vIFVwZGF0ZSBpbmZvcm1hdGlvbiBhYm91dCBwcmV2aW91cyBsYWJlbHMgb24gdGhpcyBub2RlXG4gICAgICBsYWJlbCQxLnN0YXRlbWVudFN0YXJ0ID0gdGhpcy5zdGFydDtcbiAgICAgIGxhYmVsJDEua2luZCA9IGtpbmQ7XG4gICAgfSBlbHNlIHsgYnJlYWsgfVxuICB9XG4gIHRoaXMubGFiZWxzLnB1c2goe25hbWU6IG1heWJlTmFtZSwga2luZDoga2luZCwgc3RhdGVtZW50U3RhcnQ6IHRoaXMuc3RhcnR9KTtcbiAgbm9kZS5ib2R5ID0gdGhpcy5wYXJzZVN0YXRlbWVudChjb250ZXh0ID8gY29udGV4dC5pbmRleE9mKFwibGFiZWxcIikgPT09IC0xID8gY29udGV4dCArIFwibGFiZWxcIiA6IGNvbnRleHQgOiBcImxhYmVsXCIpO1xuICB0aGlzLmxhYmVscy5wb3AoKTtcbiAgbm9kZS5sYWJlbCA9IGV4cHI7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJMYWJlbGVkU3RhdGVtZW50XCIpXG59O1xuXG5wcCQxLnBhcnNlRXhwcmVzc2lvblN0YXRlbWVudCA9IGZ1bmN0aW9uKG5vZGUsIGV4cHIpIHtcbiAgbm9kZS5leHByZXNzaW9uID0gZXhwcjtcbiAgdGhpcy5zZW1pY29sb24oKTtcbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIilcbn07XG5cbi8vIFBhcnNlIGEgc2VtaWNvbG9uLWVuY2xvc2VkIGJsb2NrIG9mIHN0YXRlbWVudHMsIGhhbmRsaW5nIGBcInVzZVxuLy8gc3RyaWN0XCJgIGRlY2xhcmF0aW9ucyB3aGVuIGBhbGxvd1N0cmljdGAgaXMgdHJ1ZSAodXNlZCBmb3Jcbi8vIGZ1bmN0aW9uIGJvZGllcykuXG5cbnBwJDEucGFyc2VCbG9jayA9IGZ1bmN0aW9uKGNyZWF0ZU5ld0xleGljYWxTY29wZSwgbm9kZSwgZXhpdFN0cmljdCkge1xuICBpZiAoIGNyZWF0ZU5ld0xleGljYWxTY29wZSA9PT0gdm9pZCAwICkgY3JlYXRlTmV3TGV4aWNhbFNjb3BlID0gdHJ1ZTtcbiAgaWYgKCBub2RlID09PSB2b2lkIDAgKSBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcblxuICBub2RlLmJvZHkgPSBbXTtcbiAgdGhpcy5leHBlY3QodHlwZXMuYnJhY2VMKTtcbiAgaWYgKGNyZWF0ZU5ld0xleGljYWxTY29wZSkgeyB0aGlzLmVudGVyU2NvcGUoMCk7IH1cbiAgd2hpbGUgKHRoaXMudHlwZSAhPT0gdHlwZXMuYnJhY2VSKSB7XG4gICAgdmFyIHN0bXQgPSB0aGlzLnBhcnNlU3RhdGVtZW50KG51bGwpO1xuICAgIG5vZGUuYm9keS5wdXNoKHN0bXQpO1xuICB9XG4gIGlmIChleGl0U3RyaWN0KSB7IHRoaXMuc3RyaWN0ID0gZmFsc2U7IH1cbiAgdGhpcy5uZXh0KCk7XG4gIGlmIChjcmVhdGVOZXdMZXhpY2FsU2NvcGUpIHsgdGhpcy5leGl0U2NvcGUoKTsgfVxuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIilcbn07XG5cbi8vIFBhcnNlIGEgcmVndWxhciBgZm9yYCBsb29wLiBUaGUgZGlzYW1iaWd1YXRpb24gY29kZSBpblxuLy8gYHBhcnNlU3RhdGVtZW50YCB3aWxsIGFscmVhZHkgaGF2ZSBwYXJzZWQgdGhlIGluaXQgc3RhdGVtZW50IG9yXG4vLyBleHByZXNzaW9uLlxuXG5wcCQxLnBhcnNlRm9yID0gZnVuY3Rpb24obm9kZSwgaW5pdCkge1xuICBub2RlLmluaXQgPSBpbml0O1xuICB0aGlzLmV4cGVjdCh0eXBlcy5zZW1pKTtcbiAgbm9kZS50ZXN0ID0gdGhpcy50eXBlID09PSB0eXBlcy5zZW1pID8gbnVsbCA6IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7XG4gIHRoaXMuZXhwZWN0KHR5cGVzLnNlbWkpO1xuICBub2RlLnVwZGF0ZSA9IHRoaXMudHlwZSA9PT0gdHlwZXMucGFyZW5SID8gbnVsbCA6IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7XG4gIHRoaXMuZXhwZWN0KHR5cGVzLnBhcmVuUik7XG4gIG5vZGUuYm9keSA9IHRoaXMucGFyc2VTdGF0ZW1lbnQoXCJmb3JcIik7XG4gIHRoaXMuZXhpdFNjb3BlKCk7XG4gIHRoaXMubGFiZWxzLnBvcCgpO1xuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiRm9yU3RhdGVtZW50XCIpXG59O1xuXG4vLyBQYXJzZSBhIGBmb3JgL2BpbmAgYW5kIGBmb3JgL2BvZmAgbG9vcCwgd2hpY2ggYXJlIGFsbW9zdFxuLy8gc2FtZSBmcm9tIHBhcnNlcidzIHBlcnNwZWN0aXZlLlxuXG5wcCQxLnBhcnNlRm9ySW4gPSBmdW5jdGlvbihub2RlLCBpbml0KSB7XG4gIHZhciBpc0ZvckluID0gdGhpcy50eXBlID09PSB0eXBlcy5faW47XG4gIHRoaXMubmV4dCgpO1xuXG4gIGlmIChcbiAgICBpbml0LnR5cGUgPT09IFwiVmFyaWFibGVEZWNsYXJhdGlvblwiICYmXG4gICAgaW5pdC5kZWNsYXJhdGlvbnNbMF0uaW5pdCAhPSBudWxsICYmXG4gICAgKFxuICAgICAgIWlzRm9ySW4gfHxcbiAgICAgIHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA8IDggfHxcbiAgICAgIHRoaXMuc3RyaWN0IHx8XG4gICAgICBpbml0LmtpbmQgIT09IFwidmFyXCIgfHxcbiAgICAgIGluaXQuZGVjbGFyYXRpb25zWzBdLmlkLnR5cGUgIT09IFwiSWRlbnRpZmllclwiXG4gICAgKVxuICApIHtcbiAgICB0aGlzLnJhaXNlKFxuICAgICAgaW5pdC5zdGFydCxcbiAgICAgICgoaXNGb3JJbiA/IFwiZm9yLWluXCIgOiBcImZvci1vZlwiKSArIFwiIGxvb3AgdmFyaWFibGUgZGVjbGFyYXRpb24gbWF5IG5vdCBoYXZlIGFuIGluaXRpYWxpemVyXCIpXG4gICAgKTtcbiAgfVxuICBub2RlLmxlZnQgPSBpbml0O1xuICBub2RlLnJpZ2h0ID0gaXNGb3JJbiA/IHRoaXMucGFyc2VFeHByZXNzaW9uKCkgOiB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oKTtcbiAgdGhpcy5leHBlY3QodHlwZXMucGFyZW5SKTtcbiAgbm9kZS5ib2R5ID0gdGhpcy5wYXJzZVN0YXRlbWVudChcImZvclwiKTtcbiAgdGhpcy5leGl0U2NvcGUoKTtcbiAgdGhpcy5sYWJlbHMucG9wKCk7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgaXNGb3JJbiA/IFwiRm9ySW5TdGF0ZW1lbnRcIiA6IFwiRm9yT2ZTdGF0ZW1lbnRcIilcbn07XG5cbi8vIFBhcnNlIGEgbGlzdCBvZiB2YXJpYWJsZSBkZWNsYXJhdGlvbnMuXG5cbnBwJDEucGFyc2VWYXIgPSBmdW5jdGlvbihub2RlLCBpc0Zvciwga2luZCkge1xuICBub2RlLmRlY2xhcmF0aW9ucyA9IFtdO1xuICBub2RlLmtpbmQgPSBraW5kO1xuICBmb3IgKDs7KSB7XG4gICAgdmFyIGRlY2wgPSB0aGlzLnN0YXJ0Tm9kZSgpO1xuICAgIHRoaXMucGFyc2VWYXJJZChkZWNsLCBraW5kKTtcbiAgICBpZiAodGhpcy5lYXQodHlwZXMuZXEpKSB7XG4gICAgICBkZWNsLmluaXQgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oaXNGb3IpO1xuICAgIH0gZWxzZSBpZiAoa2luZCA9PT0gXCJjb25zdFwiICYmICEodGhpcy50eXBlID09PSB0eXBlcy5faW4gfHwgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2ICYmIHRoaXMuaXNDb250ZXh0dWFsKFwib2ZcIikpKSkge1xuICAgICAgdGhpcy51bmV4cGVjdGVkKCk7XG4gICAgfSBlbHNlIGlmIChkZWNsLmlkLnR5cGUgIT09IFwiSWRlbnRpZmllclwiICYmICEoaXNGb3IgJiYgKHRoaXMudHlwZSA9PT0gdHlwZXMuX2luIHx8IHRoaXMuaXNDb250ZXh0dWFsKFwib2ZcIikpKSkge1xuICAgICAgdGhpcy5yYWlzZSh0aGlzLmxhc3RUb2tFbmQsIFwiQ29tcGxleCBiaW5kaW5nIHBhdHRlcm5zIHJlcXVpcmUgYW4gaW5pdGlhbGl6YXRpb24gdmFsdWVcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlY2wuaW5pdCA9IG51bGw7XG4gICAgfVxuICAgIG5vZGUuZGVjbGFyYXRpb25zLnB1c2godGhpcy5maW5pc2hOb2RlKGRlY2wsIFwiVmFyaWFibGVEZWNsYXJhdG9yXCIpKTtcbiAgICBpZiAoIXRoaXMuZWF0KHR5cGVzLmNvbW1hKSkgeyBicmVhayB9XG4gIH1cbiAgcmV0dXJuIG5vZGVcbn07XG5cbnBwJDEucGFyc2VWYXJJZCA9IGZ1bmN0aW9uKGRlY2wsIGtpbmQpIHtcbiAgZGVjbC5pZCA9IHRoaXMucGFyc2VCaW5kaW5nQXRvbSgpO1xuICB0aGlzLmNoZWNrTFZhbFBhdHRlcm4oZGVjbC5pZCwga2luZCA9PT0gXCJ2YXJcIiA/IEJJTkRfVkFSIDogQklORF9MRVhJQ0FMLCBmYWxzZSk7XG59O1xuXG52YXIgRlVOQ19TVEFURU1FTlQgPSAxLCBGVU5DX0hBTkdJTkdfU1RBVEVNRU5UID0gMiwgRlVOQ19OVUxMQUJMRV9JRCA9IDQ7XG5cbi8vIFBhcnNlIGEgZnVuY3Rpb24gZGVjbGFyYXRpb24gb3IgbGl0ZXJhbCAoZGVwZW5kaW5nIG9uIHRoZVxuLy8gYHN0YXRlbWVudCAmIEZVTkNfU1RBVEVNRU5UYCkuXG5cbi8vIFJlbW92ZSBgYWxsb3dFeHByZXNzaW9uQm9keWAgZm9yIDcuMC4wLCBhcyBpdCBpcyBvbmx5IGNhbGxlZCB3aXRoIGZhbHNlXG5wcCQxLnBhcnNlRnVuY3Rpb24gPSBmdW5jdGlvbihub2RlLCBzdGF0ZW1lbnQsIGFsbG93RXhwcmVzc2lvbkJvZHksIGlzQXN5bmMpIHtcbiAgdGhpcy5pbml0RnVuY3Rpb24obm9kZSk7XG4gIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gOSB8fCB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNiAmJiAhaXNBc3luYykge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLnN0YXIgJiYgKHN0YXRlbWVudCAmIEZVTkNfSEFOR0lOR19TVEFURU1FTlQpKVxuICAgICAgeyB0aGlzLnVuZXhwZWN0ZWQoKTsgfVxuICAgIG5vZGUuZ2VuZXJhdG9yID0gdGhpcy5lYXQodHlwZXMuc3Rhcik7XG4gIH1cbiAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA4KVxuICAgIHsgbm9kZS5hc3luYyA9ICEhaXNBc3luYzsgfVxuXG4gIGlmIChzdGF0ZW1lbnQgJiBGVU5DX1NUQVRFTUVOVCkge1xuICAgIG5vZGUuaWQgPSAoc3RhdGVtZW50ICYgRlVOQ19OVUxMQUJMRV9JRCkgJiYgdGhpcy50eXBlICE9PSB0eXBlcy5uYW1lID8gbnVsbCA6IHRoaXMucGFyc2VJZGVudCgpO1xuICAgIGlmIChub2RlLmlkICYmICEoc3RhdGVtZW50ICYgRlVOQ19IQU5HSU5HX1NUQVRFTUVOVCkpXG4gICAgICAvLyBJZiBpdCBpcyBhIHJlZ3VsYXIgZnVuY3Rpb24gZGVjbGFyYXRpb24gaW4gc2xvcHB5IG1vZGUsIHRoZW4gaXQgaXNcbiAgICAgIC8vIHN1YmplY3QgdG8gQW5uZXggQiBzZW1hbnRpY3MgKEJJTkRfRlVOQ1RJT04pLiBPdGhlcndpc2UsIHRoZSBiaW5kaW5nXG4gICAgICAvLyBtb2RlIGRlcGVuZHMgb24gcHJvcGVydGllcyBvZiB0aGUgY3VycmVudCBzY29wZSAoc2VlXG4gICAgICAvLyB0cmVhdEZ1bmN0aW9uc0FzVmFyKS5cbiAgICAgIHsgdGhpcy5jaGVja0xWYWxTaW1wbGUobm9kZS5pZCwgKHRoaXMuc3RyaWN0IHx8IG5vZGUuZ2VuZXJhdG9yIHx8IG5vZGUuYXN5bmMpID8gdGhpcy50cmVhdEZ1bmN0aW9uc0FzVmFyID8gQklORF9WQVIgOiBCSU5EX0xFWElDQUwgOiBCSU5EX0ZVTkNUSU9OKTsgfVxuICB9XG5cbiAgdmFyIG9sZFlpZWxkUG9zID0gdGhpcy55aWVsZFBvcywgb2xkQXdhaXRQb3MgPSB0aGlzLmF3YWl0UG9zLCBvbGRBd2FpdElkZW50UG9zID0gdGhpcy5hd2FpdElkZW50UG9zO1xuICB0aGlzLnlpZWxkUG9zID0gMDtcbiAgdGhpcy5hd2FpdFBvcyA9IDA7XG4gIHRoaXMuYXdhaXRJZGVudFBvcyA9IDA7XG4gIHRoaXMuZW50ZXJTY29wZShmdW5jdGlvbkZsYWdzKG5vZGUuYXN5bmMsIG5vZGUuZ2VuZXJhdG9yKSk7XG5cbiAgaWYgKCEoc3RhdGVtZW50ICYgRlVOQ19TVEFURU1FTlQpKVxuICAgIHsgbm9kZS5pZCA9IHRoaXMudHlwZSA9PT0gdHlwZXMubmFtZSA/IHRoaXMucGFyc2VJZGVudCgpIDogbnVsbDsgfVxuXG4gIHRoaXMucGFyc2VGdW5jdGlvblBhcmFtcyhub2RlKTtcbiAgdGhpcy5wYXJzZUZ1bmN0aW9uQm9keShub2RlLCBhbGxvd0V4cHJlc3Npb25Cb2R5LCBmYWxzZSk7XG5cbiAgdGhpcy55aWVsZFBvcyA9IG9sZFlpZWxkUG9zO1xuICB0aGlzLmF3YWl0UG9zID0gb2xkQXdhaXRQb3M7XG4gIHRoaXMuYXdhaXRJZGVudFBvcyA9IG9sZEF3YWl0SWRlbnRQb3M7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgKHN0YXRlbWVudCAmIEZVTkNfU1RBVEVNRU5UKSA/IFwiRnVuY3Rpb25EZWNsYXJhdGlvblwiIDogXCJGdW5jdGlvbkV4cHJlc3Npb25cIilcbn07XG5cbnBwJDEucGFyc2VGdW5jdGlvblBhcmFtcyA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpcy5leHBlY3QodHlwZXMucGFyZW5MKTtcbiAgbm9kZS5wYXJhbXMgPSB0aGlzLnBhcnNlQmluZGluZ0xpc3QodHlwZXMucGFyZW5SLCBmYWxzZSwgdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDgpO1xuICB0aGlzLmNoZWNrWWllbGRBd2FpdEluRGVmYXVsdFBhcmFtcygpO1xufTtcblxuLy8gUGFyc2UgYSBjbGFzcyBkZWNsYXJhdGlvbiBvciBsaXRlcmFsIChkZXBlbmRpbmcgb24gdGhlXG4vLyBgaXNTdGF0ZW1lbnRgIHBhcmFtZXRlcikuXG5cbnBwJDEucGFyc2VDbGFzcyA9IGZ1bmN0aW9uKG5vZGUsIGlzU3RhdGVtZW50KSB7XG4gIHRoaXMubmV4dCgpO1xuXG4gIC8vIGVjbWEtMjYyIDE0LjYgQ2xhc3MgRGVmaW5pdGlvbnNcbiAgLy8gQSBjbGFzcyBkZWZpbml0aW9uIGlzIGFsd2F5cyBzdHJpY3QgbW9kZSBjb2RlLlxuICB2YXIgb2xkU3RyaWN0ID0gdGhpcy5zdHJpY3Q7XG4gIHRoaXMuc3RyaWN0ID0gdHJ1ZTtcblxuICB0aGlzLnBhcnNlQ2xhc3NJZChub2RlLCBpc1N0YXRlbWVudCk7XG4gIHRoaXMucGFyc2VDbGFzc1N1cGVyKG5vZGUpO1xuICB2YXIgcHJpdmF0ZU5hbWVNYXAgPSB0aGlzLmVudGVyQ2xhc3NCb2R5KCk7XG4gIHZhciBjbGFzc0JvZHkgPSB0aGlzLnN0YXJ0Tm9kZSgpO1xuICB2YXIgaGFkQ29uc3RydWN0b3IgPSBmYWxzZTtcbiAgY2xhc3NCb2R5LmJvZHkgPSBbXTtcbiAgdGhpcy5leHBlY3QodHlwZXMuYnJhY2VMKTtcbiAgd2hpbGUgKHRoaXMudHlwZSAhPT0gdHlwZXMuYnJhY2VSKSB7XG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLnBhcnNlQ2xhc3NFbGVtZW50KG5vZGUuc3VwZXJDbGFzcyAhPT0gbnVsbCk7XG4gICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgIGNsYXNzQm9keS5ib2R5LnB1c2goZWxlbWVudCk7XG4gICAgICBpZiAoZWxlbWVudC50eXBlID09PSBcIk1ldGhvZERlZmluaXRpb25cIiAmJiBlbGVtZW50LmtpbmQgPT09IFwiY29uc3RydWN0b3JcIikge1xuICAgICAgICBpZiAoaGFkQ29uc3RydWN0b3IpIHsgdGhpcy5yYWlzZShlbGVtZW50LnN0YXJ0LCBcIkR1cGxpY2F0ZSBjb25zdHJ1Y3RvciBpbiB0aGUgc2FtZSBjbGFzc1wiKTsgfVxuICAgICAgICBoYWRDb25zdHJ1Y3RvciA9IHRydWU7XG4gICAgICB9IGVsc2UgaWYgKGVsZW1lbnQua2V5LnR5cGUgPT09IFwiUHJpdmF0ZUlkZW50aWZpZXJcIiAmJiBpc1ByaXZhdGVOYW1lQ29uZmxpY3RlZChwcml2YXRlTmFtZU1hcCwgZWxlbWVudCkpIHtcbiAgICAgICAgdGhpcy5yYWlzZVJlY292ZXJhYmxlKGVsZW1lbnQua2V5LnN0YXJ0LCAoXCJJZGVudGlmaWVyICcjXCIgKyAoZWxlbWVudC5rZXkubmFtZSkgKyBcIicgaGFzIGFscmVhZHkgYmVlbiBkZWNsYXJlZFwiKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHRoaXMuc3RyaWN0ID0gb2xkU3RyaWN0O1xuICB0aGlzLm5leHQoKTtcbiAgbm9kZS5ib2R5ID0gdGhpcy5maW5pc2hOb2RlKGNsYXNzQm9keSwgXCJDbGFzc0JvZHlcIik7XG4gIHRoaXMuZXhpdENsYXNzQm9keSgpO1xuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIGlzU3RhdGVtZW50ID8gXCJDbGFzc0RlY2xhcmF0aW9uXCIgOiBcIkNsYXNzRXhwcmVzc2lvblwiKVxufTtcblxucHAkMS5wYXJzZUNsYXNzRWxlbWVudCA9IGZ1bmN0aW9uKGNvbnN0cnVjdG9yQWxsb3dzU3VwZXIpIHtcbiAgaWYgKHRoaXMuZWF0KHR5cGVzLnNlbWkpKSB7IHJldHVybiBudWxsIH1cblxuICB2YXIgZWNtYVZlcnNpb24gPSB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb247XG4gIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgdmFyIGtleU5hbWUgPSBcIlwiO1xuICB2YXIgaXNHZW5lcmF0b3IgPSBmYWxzZTtcbiAgdmFyIGlzQXN5bmMgPSBmYWxzZTtcbiAgdmFyIGtpbmQgPSBcIm1ldGhvZFwiO1xuXG4gIC8vIFBhcnNlIG1vZGlmaWVyc1xuICBub2RlLnN0YXRpYyA9IGZhbHNlO1xuICBpZiAodGhpcy5lYXRDb250ZXh0dWFsKFwic3RhdGljXCIpKSB7XG4gICAgaWYgKHRoaXMuaXNDbGFzc0VsZW1lbnROYW1lU3RhcnQoKSB8fCB0aGlzLnR5cGUgPT09IHR5cGVzLnN0YXIpIHtcbiAgICAgIG5vZGUuc3RhdGljID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAga2V5TmFtZSA9IFwic3RhdGljXCI7XG4gICAgfVxuICB9XG4gIGlmICgha2V5TmFtZSAmJiBlY21hVmVyc2lvbiA+PSA4ICYmIHRoaXMuZWF0Q29udGV4dHVhbChcImFzeW5jXCIpKSB7XG4gICAgaWYgKCh0aGlzLmlzQ2xhc3NFbGVtZW50TmFtZVN0YXJ0KCkgfHwgdGhpcy50eXBlID09PSB0eXBlcy5zdGFyKSAmJiAhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSkge1xuICAgICAgaXNBc3luYyA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGtleU5hbWUgPSBcImFzeW5jXCI7XG4gICAgfVxuICB9XG4gIGlmICgha2V5TmFtZSAmJiAoZWNtYVZlcnNpb24gPj0gOSB8fCAhaXNBc3luYykgJiYgdGhpcy5lYXQodHlwZXMuc3RhcikpIHtcbiAgICBpc0dlbmVyYXRvciA9IHRydWU7XG4gIH1cbiAgaWYgKCFrZXlOYW1lICYmICFpc0FzeW5jICYmICFpc0dlbmVyYXRvcikge1xuICAgIHZhciBsYXN0VmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgIGlmICh0aGlzLmVhdENvbnRleHR1YWwoXCJnZXRcIikgfHwgdGhpcy5lYXRDb250ZXh0dWFsKFwic2V0XCIpKSB7XG4gICAgICBpZiAodGhpcy5pc0NsYXNzRWxlbWVudE5hbWVTdGFydCgpKSB7XG4gICAgICAgIGtpbmQgPSBsYXN0VmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBrZXlOYW1lID0gbGFzdFZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIFBhcnNlIGVsZW1lbnQgbmFtZVxuICBpZiAoa2V5TmFtZSkge1xuICAgIC8vICdhc3luYycsICdnZXQnLCAnc2V0Jywgb3IgJ3N0YXRpYycgd2VyZSBub3QgYSBrZXl3b3JkIGNvbnRleHR1YWxseS5cbiAgICAvLyBUaGUgbGFzdCB0b2tlbiBpcyBhbnkgb2YgdGhvc2UuIE1ha2UgaXQgdGhlIGVsZW1lbnQgbmFtZS5cbiAgICBub2RlLmNvbXB1dGVkID0gZmFsc2U7XG4gICAgbm9kZS5rZXkgPSB0aGlzLnN0YXJ0Tm9kZUF0KHRoaXMubGFzdFRva1N0YXJ0LCB0aGlzLmxhc3RUb2tTdGFydExvYyk7XG4gICAgbm9kZS5rZXkubmFtZSA9IGtleU5hbWU7XG4gICAgdGhpcy5maW5pc2hOb2RlKG5vZGUua2V5LCBcIklkZW50aWZpZXJcIik7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5wYXJzZUNsYXNzRWxlbWVudE5hbWUobm9kZSk7XG4gIH1cblxuICAvLyBQYXJzZSBlbGVtZW50IHZhbHVlXG4gIGlmIChlY21hVmVyc2lvbiA8IDEzIHx8IHRoaXMudHlwZSA9PT0gdHlwZXMucGFyZW5MIHx8IGtpbmQgIT09IFwibWV0aG9kXCIgfHwgaXNHZW5lcmF0b3IgfHwgaXNBc3luYykge1xuICAgIHZhciBpc0NvbnN0cnVjdG9yID0gIW5vZGUuc3RhdGljICYmIGNoZWNrS2V5TmFtZShub2RlLCBcImNvbnN0cnVjdG9yXCIpO1xuICAgIHZhciBhbGxvd3NEaXJlY3RTdXBlciA9IGlzQ29uc3RydWN0b3IgJiYgY29uc3RydWN0b3JBbGxvd3NTdXBlcjtcbiAgICAvLyBDb3VsZG4ndCBtb3ZlIHRoaXMgY2hlY2sgaW50byB0aGUgJ3BhcnNlQ2xhc3NNZXRob2QnIG1ldGhvZCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eS5cbiAgICBpZiAoaXNDb25zdHJ1Y3RvciAmJiBraW5kICE9PSBcIm1ldGhvZFwiKSB7IHRoaXMucmFpc2Uobm9kZS5rZXkuc3RhcnQsIFwiQ29uc3RydWN0b3IgY2FuJ3QgaGF2ZSBnZXQvc2V0IG1vZGlmaWVyXCIpOyB9XG4gICAgbm9kZS5raW5kID0gaXNDb25zdHJ1Y3RvciA/IFwiY29uc3RydWN0b3JcIiA6IGtpbmQ7XG4gICAgdGhpcy5wYXJzZUNsYXNzTWV0aG9kKG5vZGUsIGlzR2VuZXJhdG9yLCBpc0FzeW5jLCBhbGxvd3NEaXJlY3RTdXBlcik7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5wYXJzZUNsYXNzRmllbGQobm9kZSk7XG4gIH1cblxuICByZXR1cm4gbm9kZVxufTtcblxucHAkMS5pc0NsYXNzRWxlbWVudE5hbWVTdGFydCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gKFxuICAgIHRoaXMudHlwZSA9PT0gdHlwZXMubmFtZSB8fFxuICAgIHRoaXMudHlwZSA9PT0gdHlwZXMucHJpdmF0ZUlkIHx8XG4gICAgdGhpcy50eXBlID09PSB0eXBlcy5udW0gfHxcbiAgICB0aGlzLnR5cGUgPT09IHR5cGVzLnN0cmluZyB8fFxuICAgIHRoaXMudHlwZSA9PT0gdHlwZXMuYnJhY2tldEwgfHxcbiAgICB0aGlzLnR5cGUua2V5d29yZFxuICApXG59O1xuXG5wcCQxLnBhcnNlQ2xhc3NFbGVtZW50TmFtZSA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMucHJpdmF0ZUlkKSB7XG4gICAgaWYgKHRoaXMudmFsdWUgPT09IFwiY29uc3RydWN0b3JcIikge1xuICAgICAgdGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCBcIkNsYXNzZXMgY2FuJ3QgaGF2ZSBhbiBlbGVtZW50IG5hbWVkICcjY29uc3RydWN0b3InXCIpO1xuICAgIH1cbiAgICBlbGVtZW50LmNvbXB1dGVkID0gZmFsc2U7XG4gICAgZWxlbWVudC5rZXkgPSB0aGlzLnBhcnNlUHJpdmF0ZUlkZW50KCk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5wYXJzZVByb3BlcnR5TmFtZShlbGVtZW50KTtcbiAgfVxufTtcblxucHAkMS5wYXJzZUNsYXNzTWV0aG9kID0gZnVuY3Rpb24obWV0aG9kLCBpc0dlbmVyYXRvciwgaXNBc3luYywgYWxsb3dzRGlyZWN0U3VwZXIpIHtcbiAgLy8gQ2hlY2sga2V5IGFuZCBmbGFnc1xuICB2YXIga2V5ID0gbWV0aG9kLmtleTtcbiAgaWYgKG1ldGhvZC5raW5kID09PSBcImNvbnN0cnVjdG9yXCIpIHtcbiAgICBpZiAoaXNHZW5lcmF0b3IpIHsgdGhpcy5yYWlzZShrZXkuc3RhcnQsIFwiQ29uc3RydWN0b3IgY2FuJ3QgYmUgYSBnZW5lcmF0b3JcIik7IH1cbiAgICBpZiAoaXNBc3luYykgeyB0aGlzLnJhaXNlKGtleS5zdGFydCwgXCJDb25zdHJ1Y3RvciBjYW4ndCBiZSBhbiBhc3luYyBtZXRob2RcIik7IH1cbiAgfSBlbHNlIGlmIChtZXRob2Quc3RhdGljICYmIGNoZWNrS2V5TmFtZShtZXRob2QsIFwicHJvdG90eXBlXCIpKSB7XG4gICAgdGhpcy5yYWlzZShrZXkuc3RhcnQsIFwiQ2xhc3NlcyBtYXkgbm90IGhhdmUgYSBzdGF0aWMgcHJvcGVydHkgbmFtZWQgcHJvdG90eXBlXCIpO1xuICB9XG5cbiAgLy8gUGFyc2UgdmFsdWVcbiAgdmFyIHZhbHVlID0gbWV0aG9kLnZhbHVlID0gdGhpcy5wYXJzZU1ldGhvZChpc0dlbmVyYXRvciwgaXNBc3luYywgYWxsb3dzRGlyZWN0U3VwZXIpO1xuXG4gIC8vIENoZWNrIHZhbHVlXG4gIGlmIChtZXRob2Qua2luZCA9PT0gXCJnZXRcIiAmJiB2YWx1ZS5wYXJhbXMubGVuZ3RoICE9PSAwKVxuICAgIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKHZhbHVlLnN0YXJ0LCBcImdldHRlciBzaG91bGQgaGF2ZSBubyBwYXJhbXNcIik7IH1cbiAgaWYgKG1ldGhvZC5raW5kID09PSBcInNldFwiICYmIHZhbHVlLnBhcmFtcy5sZW5ndGggIT09IDEpXG4gICAgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUodmFsdWUuc3RhcnQsIFwic2V0dGVyIHNob3VsZCBoYXZlIGV4YWN0bHkgb25lIHBhcmFtXCIpOyB9XG4gIGlmIChtZXRob2Qua2luZCA9PT0gXCJzZXRcIiAmJiB2YWx1ZS5wYXJhbXNbMF0udHlwZSA9PT0gXCJSZXN0RWxlbWVudFwiKVxuICAgIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKHZhbHVlLnBhcmFtc1swXS5zdGFydCwgXCJTZXR0ZXIgY2Fubm90IHVzZSByZXN0IHBhcmFtc1wiKTsgfVxuXG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobWV0aG9kLCBcIk1ldGhvZERlZmluaXRpb25cIilcbn07XG5cbnBwJDEucGFyc2VDbGFzc0ZpZWxkID0gZnVuY3Rpb24oZmllbGQpIHtcbiAgaWYgKGNoZWNrS2V5TmFtZShmaWVsZCwgXCJjb25zdHJ1Y3RvclwiKSkge1xuICAgIHRoaXMucmFpc2UoZmllbGQua2V5LnN0YXJ0LCBcIkNsYXNzZXMgY2FuJ3QgaGF2ZSBhIGZpZWxkIG5hbWVkICdjb25zdHJ1Y3RvcidcIik7XG4gIH0gZWxzZSBpZiAoZmllbGQuc3RhdGljICYmIGNoZWNrS2V5TmFtZShmaWVsZCwgXCJwcm90b3R5cGVcIikpIHtcbiAgICB0aGlzLnJhaXNlKGZpZWxkLmtleS5zdGFydCwgXCJDbGFzc2VzIGNhbid0IGhhdmUgYSBzdGF0aWMgZmllbGQgbmFtZWQgJ3Byb3RvdHlwZSdcIik7XG4gIH1cblxuICBpZiAodGhpcy5lYXQodHlwZXMuZXEpKSB7XG4gICAgLy8gVG8gcmFpc2UgU3ludGF4RXJyb3IgaWYgJ2FyZ3VtZW50cycgZXhpc3RzIGluIHRoZSBpbml0aWFsaXplci5cbiAgICB2YXIgc2NvcGUgPSB0aGlzLmN1cnJlbnRUaGlzU2NvcGUoKTtcbiAgICB2YXIgaW5DbGFzc0ZpZWxkSW5pdCA9IHNjb3BlLmluQ2xhc3NGaWVsZEluaXQ7XG4gICAgc2NvcGUuaW5DbGFzc0ZpZWxkSW5pdCA9IHRydWU7XG4gICAgZmllbGQudmFsdWUgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oKTtcbiAgICBzY29wZS5pbkNsYXNzRmllbGRJbml0ID0gaW5DbGFzc0ZpZWxkSW5pdDtcbiAgfSBlbHNlIHtcbiAgICBmaWVsZC52YWx1ZSA9IG51bGw7XG4gIH1cbiAgdGhpcy5zZW1pY29sb24oKTtcblxuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKGZpZWxkLCBcIlByb3BlcnR5RGVmaW5pdGlvblwiKVxufTtcblxucHAkMS5wYXJzZUNsYXNzSWQgPSBmdW5jdGlvbihub2RlLCBpc1N0YXRlbWVudCkge1xuICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5uYW1lKSB7XG4gICAgbm9kZS5pZCA9IHRoaXMucGFyc2VJZGVudCgpO1xuICAgIGlmIChpc1N0YXRlbWVudClcbiAgICAgIHsgdGhpcy5jaGVja0xWYWxTaW1wbGUobm9kZS5pZCwgQklORF9MRVhJQ0FMLCBmYWxzZSk7IH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoaXNTdGF0ZW1lbnQgPT09IHRydWUpXG4gICAgICB7IHRoaXMudW5leHBlY3RlZCgpOyB9XG4gICAgbm9kZS5pZCA9IG51bGw7XG4gIH1cbn07XG5cbnBwJDEucGFyc2VDbGFzc1N1cGVyID0gZnVuY3Rpb24obm9kZSkge1xuICBub2RlLnN1cGVyQ2xhc3MgPSB0aGlzLmVhdCh0eXBlcy5fZXh0ZW5kcykgPyB0aGlzLnBhcnNlRXhwclN1YnNjcmlwdHMoKSA6IG51bGw7XG59O1xuXG5wcCQxLmVudGVyQ2xhc3NCb2R5ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBlbGVtZW50ID0ge2RlY2xhcmVkOiBPYmplY3QuY3JlYXRlKG51bGwpLCB1c2VkOiBbXX07XG4gIHRoaXMucHJpdmF0ZU5hbWVTdGFjay5wdXNoKGVsZW1lbnQpO1xuICByZXR1cm4gZWxlbWVudC5kZWNsYXJlZFxufTtcblxucHAkMS5leGl0Q2xhc3NCb2R5ID0gZnVuY3Rpb24oKSB7XG4gIHZhciByZWYgPSB0aGlzLnByaXZhdGVOYW1lU3RhY2sucG9wKCk7XG4gIHZhciBkZWNsYXJlZCA9IHJlZi5kZWNsYXJlZDtcbiAgdmFyIHVzZWQgPSByZWYudXNlZDtcbiAgdmFyIGxlbiA9IHRoaXMucHJpdmF0ZU5hbWVTdGFjay5sZW5ndGg7XG4gIHZhciBwYXJlbnQgPSBsZW4gPT09IDAgPyBudWxsIDogdGhpcy5wcml2YXRlTmFtZVN0YWNrW2xlbiAtIDFdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHVzZWQubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgaWQgPSB1c2VkW2ldO1xuICAgIGlmICghaGFzKGRlY2xhcmVkLCBpZC5uYW1lKSkge1xuICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICBwYXJlbnQudXNlZC5wdXNoKGlkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmFpc2VSZWNvdmVyYWJsZShpZC5zdGFydCwgKFwiUHJpdmF0ZSBmaWVsZCAnI1wiICsgKGlkLm5hbWUpICsgXCInIG11c3QgYmUgZGVjbGFyZWQgaW4gYW4gZW5jbG9zaW5nIGNsYXNzXCIpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGlzUHJpdmF0ZU5hbWVDb25mbGljdGVkKHByaXZhdGVOYW1lTWFwLCBlbGVtZW50KSB7XG4gIHZhciBuYW1lID0gZWxlbWVudC5rZXkubmFtZTtcbiAgdmFyIGN1cnIgPSBwcml2YXRlTmFtZU1hcFtuYW1lXTtcblxuICB2YXIgbmV4dCA9IFwidHJ1ZVwiO1xuICBpZiAoZWxlbWVudC50eXBlID09PSBcIk1ldGhvZERlZmluaXRpb25cIiAmJiAoZWxlbWVudC5raW5kID09PSBcImdldFwiIHx8IGVsZW1lbnQua2luZCA9PT0gXCJzZXRcIikpIHtcbiAgICBuZXh0ID0gKGVsZW1lbnQuc3RhdGljID8gXCJzXCIgOiBcImlcIikgKyBlbGVtZW50LmtpbmQ7XG4gIH1cblxuICAvLyBgY2xhc3MgeyBnZXQgI2EoKXt9OyBzdGF0aWMgc2V0ICNhKF8pe30gfWAgaXMgYWxzbyBjb25mbGljdC5cbiAgaWYgKFxuICAgIGN1cnIgPT09IFwiaWdldFwiICYmIG5leHQgPT09IFwiaXNldFwiIHx8XG4gICAgY3VyciA9PT0gXCJpc2V0XCIgJiYgbmV4dCA9PT0gXCJpZ2V0XCIgfHxcbiAgICBjdXJyID09PSBcInNnZXRcIiAmJiBuZXh0ID09PSBcInNzZXRcIiB8fFxuICAgIGN1cnIgPT09IFwic3NldFwiICYmIG5leHQgPT09IFwic2dldFwiXG4gICkge1xuICAgIHByaXZhdGVOYW1lTWFwW25hbWVdID0gXCJ0cnVlXCI7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH0gZWxzZSBpZiAoIWN1cnIpIHtcbiAgICBwcml2YXRlTmFtZU1hcFtuYW1lXSA9IG5leHQ7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxufVxuXG5mdW5jdGlvbiBjaGVja0tleU5hbWUobm9kZSwgbmFtZSkge1xuICB2YXIgY29tcHV0ZWQgPSBub2RlLmNvbXB1dGVkO1xuICB2YXIga2V5ID0gbm9kZS5rZXk7XG4gIHJldHVybiAhY29tcHV0ZWQgJiYgKFxuICAgIGtleS50eXBlID09PSBcIklkZW50aWZpZXJcIiAmJiBrZXkubmFtZSA9PT0gbmFtZSB8fFxuICAgIGtleS50eXBlID09PSBcIkxpdGVyYWxcIiAmJiBrZXkudmFsdWUgPT09IG5hbWVcbiAgKVxufVxuXG4vLyBQYXJzZXMgbW9kdWxlIGV4cG9ydCBkZWNsYXJhdGlvbi5cblxucHAkMS5wYXJzZUV4cG9ydCA9IGZ1bmN0aW9uKG5vZGUsIGV4cG9ydHMpIHtcbiAgdGhpcy5uZXh0KCk7XG4gIC8vIGV4cG9ydCAqIGZyb20gJy4uLidcbiAgaWYgKHRoaXMuZWF0KHR5cGVzLnN0YXIpKSB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSAxMSkge1xuICAgICAgaWYgKHRoaXMuZWF0Q29udGV4dHVhbChcImFzXCIpKSB7XG4gICAgICAgIG5vZGUuZXhwb3J0ZWQgPSB0aGlzLnBhcnNlSWRlbnQodHJ1ZSk7XG4gICAgICAgIHRoaXMuY2hlY2tFeHBvcnQoZXhwb3J0cywgbm9kZS5leHBvcnRlZC5uYW1lLCB0aGlzLmxhc3RUb2tTdGFydCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBub2RlLmV4cG9ydGVkID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5leHBlY3RDb250ZXh0dWFsKFwiZnJvbVwiKTtcbiAgICBpZiAodGhpcy50eXBlICE9PSB0eXBlcy5zdHJpbmcpIHsgdGhpcy51bmV4cGVjdGVkKCk7IH1cbiAgICBub2RlLnNvdXJjZSA9IHRoaXMucGFyc2VFeHByQXRvbSgpO1xuICAgIHRoaXMuc2VtaWNvbG9uKCk7XG4gICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIkV4cG9ydEFsbERlY2xhcmF0aW9uXCIpXG4gIH1cbiAgaWYgKHRoaXMuZWF0KHR5cGVzLl9kZWZhdWx0KSkgeyAvLyBleHBvcnQgZGVmYXVsdCAuLi5cbiAgICB0aGlzLmNoZWNrRXhwb3J0KGV4cG9ydHMsIFwiZGVmYXVsdFwiLCB0aGlzLmxhc3RUb2tTdGFydCk7XG4gICAgdmFyIGlzQXN5bmM7XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuX2Z1bmN0aW9uIHx8IChpc0FzeW5jID0gdGhpcy5pc0FzeW5jRnVuY3Rpb24oKSkpIHtcbiAgICAgIHZhciBmTm9kZSA9IHRoaXMuc3RhcnROb2RlKCk7XG4gICAgICB0aGlzLm5leHQoKTtcbiAgICAgIGlmIChpc0FzeW5jKSB7IHRoaXMubmV4dCgpOyB9XG4gICAgICBub2RlLmRlY2xhcmF0aW9uID0gdGhpcy5wYXJzZUZ1bmN0aW9uKGZOb2RlLCBGVU5DX1NUQVRFTUVOVCB8IEZVTkNfTlVMTEFCTEVfSUQsIGZhbHNlLCBpc0FzeW5jKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuX2NsYXNzKSB7XG4gICAgICB2YXIgY05vZGUgPSB0aGlzLnN0YXJ0Tm9kZSgpO1xuICAgICAgbm9kZS5kZWNsYXJhdGlvbiA9IHRoaXMucGFyc2VDbGFzcyhjTm9kZSwgXCJudWxsYWJsZUlEXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBub2RlLmRlY2xhcmF0aW9uID0gdGhpcy5wYXJzZU1heWJlQXNzaWduKCk7XG4gICAgICB0aGlzLnNlbWljb2xvbigpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uXCIpXG4gIH1cbiAgLy8gZXhwb3J0IHZhcnxjb25zdHxsZXR8ZnVuY3Rpb258Y2xhc3MgLi4uXG4gIGlmICh0aGlzLnNob3VsZFBhcnNlRXhwb3J0U3RhdGVtZW50KCkpIHtcbiAgICBub2RlLmRlY2xhcmF0aW9uID0gdGhpcy5wYXJzZVN0YXRlbWVudChudWxsKTtcbiAgICBpZiAobm9kZS5kZWNsYXJhdGlvbi50eXBlID09PSBcIlZhcmlhYmxlRGVjbGFyYXRpb25cIilcbiAgICAgIHsgdGhpcy5jaGVja1ZhcmlhYmxlRXhwb3J0KGV4cG9ydHMsIG5vZGUuZGVjbGFyYXRpb24uZGVjbGFyYXRpb25zKTsgfVxuICAgIGVsc2VcbiAgICAgIHsgdGhpcy5jaGVja0V4cG9ydChleHBvcnRzLCBub2RlLmRlY2xhcmF0aW9uLmlkLm5hbWUsIG5vZGUuZGVjbGFyYXRpb24uaWQuc3RhcnQpOyB9XG4gICAgbm9kZS5zcGVjaWZpZXJzID0gW107XG4gICAgbm9kZS5zb3VyY2UgPSBudWxsO1xuICB9IGVsc2UgeyAvLyBleHBvcnQgeyB4LCB5IGFzIHogfSBbZnJvbSAnLi4uJ11cbiAgICBub2RlLmRlY2xhcmF0aW9uID0gbnVsbDtcbiAgICBub2RlLnNwZWNpZmllcnMgPSB0aGlzLnBhcnNlRXhwb3J0U3BlY2lmaWVycyhleHBvcnRzKTtcbiAgICBpZiAodGhpcy5lYXRDb250ZXh0dWFsKFwiZnJvbVwiKSkge1xuICAgICAgaWYgKHRoaXMudHlwZSAhPT0gdHlwZXMuc3RyaW5nKSB7IHRoaXMudW5leHBlY3RlZCgpOyB9XG4gICAgICBub2RlLnNvdXJjZSA9IHRoaXMucGFyc2VFeHByQXRvbSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGlzdCA9IG5vZGUuc3BlY2lmaWVyczsgaSA8IGxpc3QubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgLy8gY2hlY2sgZm9yIGtleXdvcmRzIHVzZWQgYXMgbG9jYWwgbmFtZXNcbiAgICAgICAgdmFyIHNwZWMgPSBsaXN0W2ldO1xuXG4gICAgICAgIHRoaXMuY2hlY2tVbnJlc2VydmVkKHNwZWMubG9jYWwpO1xuICAgICAgICAvLyBjaGVjayBpZiBleHBvcnQgaXMgZGVmaW5lZFxuICAgICAgICB0aGlzLmNoZWNrTG9jYWxFeHBvcnQoc3BlYy5sb2NhbCk7XG4gICAgICB9XG5cbiAgICAgIG5vZGUuc291cmNlID0gbnVsbDtcbiAgICB9XG4gICAgdGhpcy5zZW1pY29sb24oKTtcbiAgfVxuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiRXhwb3J0TmFtZWREZWNsYXJhdGlvblwiKVxufTtcblxucHAkMS5jaGVja0V4cG9ydCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIHBvcykge1xuICBpZiAoIWV4cG9ydHMpIHsgcmV0dXJuIH1cbiAgaWYgKGhhcyhleHBvcnRzLCBuYW1lKSlcbiAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShwb3MsIFwiRHVwbGljYXRlIGV4cG9ydCAnXCIgKyBuYW1lICsgXCInXCIpOyB9XG4gIGV4cG9ydHNbbmFtZV0gPSB0cnVlO1xufTtcblxucHAkMS5jaGVja1BhdHRlcm5FeHBvcnQgPSBmdW5jdGlvbihleHBvcnRzLCBwYXQpIHtcbiAgdmFyIHR5cGUgPSBwYXQudHlwZTtcbiAgaWYgKHR5cGUgPT09IFwiSWRlbnRpZmllclwiKVxuICAgIHsgdGhpcy5jaGVja0V4cG9ydChleHBvcnRzLCBwYXQubmFtZSwgcGF0LnN0YXJ0KTsgfVxuICBlbHNlIGlmICh0eXBlID09PSBcIk9iamVjdFBhdHRlcm5cIilcbiAgICB7IGZvciAodmFyIGkgPSAwLCBsaXN0ID0gcGF0LnByb3BlcnRpZXM7IGkgPCBsaXN0Lmxlbmd0aDsgaSArPSAxKVxuICAgICAge1xuICAgICAgICB2YXIgcHJvcCA9IGxpc3RbaV07XG5cbiAgICAgICAgdGhpcy5jaGVja1BhdHRlcm5FeHBvcnQoZXhwb3J0cywgcHJvcCk7XG4gICAgICB9IH1cbiAgZWxzZSBpZiAodHlwZSA9PT0gXCJBcnJheVBhdHRlcm5cIilcbiAgICB7IGZvciAodmFyIGkkMSA9IDAsIGxpc3QkMSA9IHBhdC5lbGVtZW50czsgaSQxIDwgbGlzdCQxLmxlbmd0aDsgaSQxICs9IDEpIHtcbiAgICAgIHZhciBlbHQgPSBsaXN0JDFbaSQxXTtcblxuICAgICAgICBpZiAoZWx0KSB7IHRoaXMuY2hlY2tQYXR0ZXJuRXhwb3J0KGV4cG9ydHMsIGVsdCk7IH1cbiAgICB9IH1cbiAgZWxzZSBpZiAodHlwZSA9PT0gXCJQcm9wZXJ0eVwiKVxuICAgIHsgdGhpcy5jaGVja1BhdHRlcm5FeHBvcnQoZXhwb3J0cywgcGF0LnZhbHVlKTsgfVxuICBlbHNlIGlmICh0eXBlID09PSBcIkFzc2lnbm1lbnRQYXR0ZXJuXCIpXG4gICAgeyB0aGlzLmNoZWNrUGF0dGVybkV4cG9ydChleHBvcnRzLCBwYXQubGVmdCk7IH1cbiAgZWxzZSBpZiAodHlwZSA9PT0gXCJSZXN0RWxlbWVudFwiKVxuICAgIHsgdGhpcy5jaGVja1BhdHRlcm5FeHBvcnQoZXhwb3J0cywgcGF0LmFyZ3VtZW50KTsgfVxuICBlbHNlIGlmICh0eXBlID09PSBcIlBhcmVudGhlc2l6ZWRFeHByZXNzaW9uXCIpXG4gICAgeyB0aGlzLmNoZWNrUGF0dGVybkV4cG9ydChleHBvcnRzLCBwYXQuZXhwcmVzc2lvbik7IH1cbn07XG5cbnBwJDEuY2hlY2tWYXJpYWJsZUV4cG9ydCA9IGZ1bmN0aW9uKGV4cG9ydHMsIGRlY2xzKSB7XG4gIGlmICghZXhwb3J0cykgeyByZXR1cm4gfVxuICBmb3IgKHZhciBpID0gMCwgbGlzdCA9IGRlY2xzOyBpIDwgbGlzdC5sZW5ndGg7IGkgKz0gMSlcbiAgICB7XG4gICAgdmFyIGRlY2wgPSBsaXN0W2ldO1xuXG4gICAgdGhpcy5jaGVja1BhdHRlcm5FeHBvcnQoZXhwb3J0cywgZGVjbC5pZCk7XG4gIH1cbn07XG5cbnBwJDEuc2hvdWxkUGFyc2VFeHBvcnRTdGF0ZW1lbnQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMudHlwZS5rZXl3b3JkID09PSBcInZhclwiIHx8XG4gICAgdGhpcy50eXBlLmtleXdvcmQgPT09IFwiY29uc3RcIiB8fFxuICAgIHRoaXMudHlwZS5rZXl3b3JkID09PSBcImNsYXNzXCIgfHxcbiAgICB0aGlzLnR5cGUua2V5d29yZCA9PT0gXCJmdW5jdGlvblwiIHx8XG4gICAgdGhpcy5pc0xldCgpIHx8XG4gICAgdGhpcy5pc0FzeW5jRnVuY3Rpb24oKVxufTtcblxuLy8gUGFyc2VzIGEgY29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgbW9kdWxlIGV4cG9ydHMuXG5cbnBwJDEucGFyc2VFeHBvcnRTcGVjaWZpZXJzID0gZnVuY3Rpb24oZXhwb3J0cykge1xuICB2YXIgbm9kZXMgPSBbXSwgZmlyc3QgPSB0cnVlO1xuICAvLyBleHBvcnQgeyB4LCB5IGFzIHogfSBbZnJvbSAnLi4uJ11cbiAgdGhpcy5leHBlY3QodHlwZXMuYnJhY2VMKTtcbiAgd2hpbGUgKCF0aGlzLmVhdCh0eXBlcy5icmFjZVIpKSB7XG4gICAgaWYgKCFmaXJzdCkge1xuICAgICAgdGhpcy5leHBlY3QodHlwZXMuY29tbWEpO1xuICAgICAgaWYgKHRoaXMuYWZ0ZXJUcmFpbGluZ0NvbW1hKHR5cGVzLmJyYWNlUikpIHsgYnJlYWsgfVxuICAgIH0gZWxzZSB7IGZpcnN0ID0gZmFsc2U7IH1cblxuICAgIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgICBub2RlLmxvY2FsID0gdGhpcy5wYXJzZUlkZW50KHRydWUpO1xuICAgIG5vZGUuZXhwb3J0ZWQgPSB0aGlzLmVhdENvbnRleHR1YWwoXCJhc1wiKSA/IHRoaXMucGFyc2VJZGVudCh0cnVlKSA6IG5vZGUubG9jYWw7XG4gICAgdGhpcy5jaGVja0V4cG9ydChleHBvcnRzLCBub2RlLmV4cG9ydGVkLm5hbWUsIG5vZGUuZXhwb3J0ZWQuc3RhcnQpO1xuICAgIG5vZGVzLnB1c2godGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiRXhwb3J0U3BlY2lmaWVyXCIpKTtcbiAgfVxuICByZXR1cm4gbm9kZXNcbn07XG5cbi8vIFBhcnNlcyBpbXBvcnQgZGVjbGFyYXRpb24uXG5cbnBwJDEucGFyc2VJbXBvcnQgPSBmdW5jdGlvbihub2RlKSB7XG4gIHRoaXMubmV4dCgpO1xuICAvLyBpbXBvcnQgJy4uLidcbiAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuc3RyaW5nKSB7XG4gICAgbm9kZS5zcGVjaWZpZXJzID0gZW1wdHk7XG4gICAgbm9kZS5zb3VyY2UgPSB0aGlzLnBhcnNlRXhwckF0b20oKTtcbiAgfSBlbHNlIHtcbiAgICBub2RlLnNwZWNpZmllcnMgPSB0aGlzLnBhcnNlSW1wb3J0U3BlY2lmaWVycygpO1xuICAgIHRoaXMuZXhwZWN0Q29udGV4dHVhbChcImZyb21cIik7XG4gICAgbm9kZS5zb3VyY2UgPSB0aGlzLnR5cGUgPT09IHR5cGVzLnN0cmluZyA/IHRoaXMucGFyc2VFeHByQXRvbSgpIDogdGhpcy51bmV4cGVjdGVkKCk7XG4gIH1cbiAgdGhpcy5zZW1pY29sb24oKTtcbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIkltcG9ydERlY2xhcmF0aW9uXCIpXG59O1xuXG4vLyBQYXJzZXMgYSBjb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBtb2R1bGUgaW1wb3J0cy5cblxucHAkMS5wYXJzZUltcG9ydFNwZWNpZmllcnMgPSBmdW5jdGlvbigpIHtcbiAgdmFyIG5vZGVzID0gW10sIGZpcnN0ID0gdHJ1ZTtcbiAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMubmFtZSkge1xuICAgIC8vIGltcG9ydCBkZWZhdWx0T2JqLCB7IHgsIHkgYXMgeiB9IGZyb20gJy4uLidcbiAgICB2YXIgbm9kZSA9IHRoaXMuc3RhcnROb2RlKCk7XG4gICAgbm9kZS5sb2NhbCA9IHRoaXMucGFyc2VJZGVudCgpO1xuICAgIHRoaXMuY2hlY2tMVmFsU2ltcGxlKG5vZGUubG9jYWwsIEJJTkRfTEVYSUNBTCk7XG4gICAgbm9kZXMucHVzaCh0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJJbXBvcnREZWZhdWx0U3BlY2lmaWVyXCIpKTtcbiAgICBpZiAoIXRoaXMuZWF0KHR5cGVzLmNvbW1hKSkgeyByZXR1cm4gbm9kZXMgfVxuICB9XG4gIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLnN0YXIpIHtcbiAgICB2YXIgbm9kZSQxID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgICB0aGlzLm5leHQoKTtcbiAgICB0aGlzLmV4cGVjdENvbnRleHR1YWwoXCJhc1wiKTtcbiAgICBub2RlJDEubG9jYWwgPSB0aGlzLnBhcnNlSWRlbnQoKTtcbiAgICB0aGlzLmNoZWNrTFZhbFNpbXBsZShub2RlJDEubG9jYWwsIEJJTkRfTEVYSUNBTCk7XG4gICAgbm9kZXMucHVzaCh0aGlzLmZpbmlzaE5vZGUobm9kZSQxLCBcIkltcG9ydE5hbWVzcGFjZVNwZWNpZmllclwiKSk7XG4gICAgcmV0dXJuIG5vZGVzXG4gIH1cbiAgdGhpcy5leHBlY3QodHlwZXMuYnJhY2VMKTtcbiAgd2hpbGUgKCF0aGlzLmVhdCh0eXBlcy5icmFjZVIpKSB7XG4gICAgaWYgKCFmaXJzdCkge1xuICAgICAgdGhpcy5leHBlY3QodHlwZXMuY29tbWEpO1xuICAgICAgaWYgKHRoaXMuYWZ0ZXJUcmFpbGluZ0NvbW1hKHR5cGVzLmJyYWNlUikpIHsgYnJlYWsgfVxuICAgIH0gZWxzZSB7IGZpcnN0ID0gZmFsc2U7IH1cblxuICAgIHZhciBub2RlJDIgPSB0aGlzLnN0YXJ0Tm9kZSgpO1xuICAgIG5vZGUkMi5pbXBvcnRlZCA9IHRoaXMucGFyc2VJZGVudCh0cnVlKTtcbiAgICBpZiAodGhpcy5lYXRDb250ZXh0dWFsKFwiYXNcIikpIHtcbiAgICAgIG5vZGUkMi5sb2NhbCA9IHRoaXMucGFyc2VJZGVudCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNoZWNrVW5yZXNlcnZlZChub2RlJDIuaW1wb3J0ZWQpO1xuICAgICAgbm9kZSQyLmxvY2FsID0gbm9kZSQyLmltcG9ydGVkO1xuICAgIH1cbiAgICB0aGlzLmNoZWNrTFZhbFNpbXBsZShub2RlJDIubG9jYWwsIEJJTkRfTEVYSUNBTCk7XG4gICAgbm9kZXMucHVzaCh0aGlzLmZpbmlzaE5vZGUobm9kZSQyLCBcIkltcG9ydFNwZWNpZmllclwiKSk7XG4gIH1cbiAgcmV0dXJuIG5vZGVzXG59O1xuXG4vLyBTZXQgYEV4cHJlc3Npb25TdGF0ZW1lbnQjZGlyZWN0aXZlYCBwcm9wZXJ0eSBmb3IgZGlyZWN0aXZlIHByb2xvZ3Vlcy5cbnBwJDEuYWRhcHREaXJlY3RpdmVQcm9sb2d1ZSA9IGZ1bmN0aW9uKHN0YXRlbWVudHMpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGF0ZW1lbnRzLmxlbmd0aCAmJiB0aGlzLmlzRGlyZWN0aXZlQ2FuZGlkYXRlKHN0YXRlbWVudHNbaV0pOyArK2kpIHtcbiAgICBzdGF0ZW1lbnRzW2ldLmRpcmVjdGl2ZSA9IHN0YXRlbWVudHNbaV0uZXhwcmVzc2lvbi5yYXcuc2xpY2UoMSwgLTEpO1xuICB9XG59O1xucHAkMS5pc0RpcmVjdGl2ZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uKHN0YXRlbWVudCkge1xuICByZXR1cm4gKFxuICAgIHN0YXRlbWVudC50eXBlID09PSBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiAmJlxuICAgIHN0YXRlbWVudC5leHByZXNzaW9uLnR5cGUgPT09IFwiTGl0ZXJhbFwiICYmXG4gICAgdHlwZW9mIHN0YXRlbWVudC5leHByZXNzaW9uLnZhbHVlID09PSBcInN0cmluZ1wiICYmXG4gICAgLy8gUmVqZWN0IHBhcmVudGhlc2l6ZWQgc3RyaW5ncy5cbiAgICAodGhpcy5pbnB1dFtzdGF0ZW1lbnQuc3RhcnRdID09PSBcIlxcXCJcIiB8fCB0aGlzLmlucHV0W3N0YXRlbWVudC5zdGFydF0gPT09IFwiJ1wiKVxuICApXG59O1xuXG52YXIgcHAkMiA9IFBhcnNlci5wcm90b3R5cGU7XG5cbi8vIENvbnZlcnQgZXhpc3RpbmcgZXhwcmVzc2lvbiBhdG9tIHRvIGFzc2lnbmFibGUgcGF0dGVyblxuLy8gaWYgcG9zc2libGUuXG5cbnBwJDIudG9Bc3NpZ25hYmxlID0gZnVuY3Rpb24obm9kZSwgaXNCaW5kaW5nLCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7XG4gIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNiAmJiBub2RlKSB7XG4gICAgc3dpdGNoIChub2RlLnR5cGUpIHtcbiAgICBjYXNlIFwiSWRlbnRpZmllclwiOlxuICAgICAgaWYgKHRoaXMuaW5Bc3luYyAmJiBub2RlLm5hbWUgPT09IFwiYXdhaXRcIilcbiAgICAgICAgeyB0aGlzLnJhaXNlKG5vZGUuc3RhcnQsIFwiQ2Fubm90IHVzZSAnYXdhaXQnIGFzIGlkZW50aWZpZXIgaW5zaWRlIGFuIGFzeW5jIGZ1bmN0aW9uXCIpOyB9XG4gICAgICBicmVha1xuXG4gICAgY2FzZSBcIk9iamVjdFBhdHRlcm5cIjpcbiAgICBjYXNlIFwiQXJyYXlQYXR0ZXJuXCI6XG4gICAgY2FzZSBcIkFzc2lnbm1lbnRQYXR0ZXJuXCI6XG4gICAgY2FzZSBcIlJlc3RFbGVtZW50XCI6XG4gICAgICBicmVha1xuXG4gICAgY2FzZSBcIk9iamVjdEV4cHJlc3Npb25cIjpcbiAgICAgIG5vZGUudHlwZSA9IFwiT2JqZWN0UGF0dGVyblwiO1xuICAgICAgaWYgKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpIHsgdGhpcy5jaGVja1BhdHRlcm5FcnJvcnMocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycywgdHJ1ZSk7IH1cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsaXN0ID0gbm9kZS5wcm9wZXJ0aWVzOyBpIDwgbGlzdC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICB2YXIgcHJvcCA9IGxpc3RbaV07XG5cbiAgICAgIHRoaXMudG9Bc3NpZ25hYmxlKHByb3AsIGlzQmluZGluZyk7XG4gICAgICAgIC8vIEVhcmx5IGVycm9yOlxuICAgICAgICAvLyAgIEFzc2lnbm1lbnRSZXN0UHJvcGVydHlbWWllbGQsIEF3YWl0XSA6XG4gICAgICAgIC8vICAgICBgLi4uYCBEZXN0cnVjdHVyaW5nQXNzaWdubWVudFRhcmdldFtZaWVsZCwgQXdhaXRdXG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgSXQgaXMgYSBTeW50YXggRXJyb3IgaWYgfERlc3RydWN0dXJpbmdBc3NpZ25tZW50VGFyZ2V0fCBpcyBhbiB8QXJyYXlMaXRlcmFsfCBvciBhbiB8T2JqZWN0TGl0ZXJhbHwuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBwcm9wLnR5cGUgPT09IFwiUmVzdEVsZW1lbnRcIiAmJlxuICAgICAgICAgIChwcm9wLmFyZ3VtZW50LnR5cGUgPT09IFwiQXJyYXlQYXR0ZXJuXCIgfHwgcHJvcC5hcmd1bWVudC50eXBlID09PSBcIk9iamVjdFBhdHRlcm5cIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5yYWlzZShwcm9wLmFyZ3VtZW50LnN0YXJ0LCBcIlVuZXhwZWN0ZWQgdG9rZW5cIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGJyZWFrXG5cbiAgICBjYXNlIFwiUHJvcGVydHlcIjpcbiAgICAgIC8vIEFzc2lnbm1lbnRQcm9wZXJ0eSBoYXMgdHlwZSA9PT0gXCJQcm9wZXJ0eVwiXG4gICAgICBpZiAobm9kZS5raW5kICE9PSBcImluaXRcIikgeyB0aGlzLnJhaXNlKG5vZGUua2V5LnN0YXJ0LCBcIk9iamVjdCBwYXR0ZXJuIGNhbid0IGNvbnRhaW4gZ2V0dGVyIG9yIHNldHRlclwiKTsgfVxuICAgICAgdGhpcy50b0Fzc2lnbmFibGUobm9kZS52YWx1ZSwgaXNCaW5kaW5nKTtcbiAgICAgIGJyZWFrXG5cbiAgICBjYXNlIFwiQXJyYXlFeHByZXNzaW9uXCI6XG4gICAgICBub2RlLnR5cGUgPSBcIkFycmF5UGF0dGVyblwiO1xuICAgICAgaWYgKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpIHsgdGhpcy5jaGVja1BhdHRlcm5FcnJvcnMocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycywgdHJ1ZSk7IH1cbiAgICAgIHRoaXMudG9Bc3NpZ25hYmxlTGlzdChub2RlLmVsZW1lbnRzLCBpc0JpbmRpbmcpO1xuICAgICAgYnJlYWtcblxuICAgIGNhc2UgXCJTcHJlYWRFbGVtZW50XCI6XG4gICAgICBub2RlLnR5cGUgPSBcIlJlc3RFbGVtZW50XCI7XG4gICAgICB0aGlzLnRvQXNzaWduYWJsZShub2RlLmFyZ3VtZW50LCBpc0JpbmRpbmcpO1xuICAgICAgaWYgKG5vZGUuYXJndW1lbnQudHlwZSA9PT0gXCJBc3NpZ25tZW50UGF0dGVyblwiKVxuICAgICAgICB7IHRoaXMucmFpc2Uobm9kZS5hcmd1bWVudC5zdGFydCwgXCJSZXN0IGVsZW1lbnRzIGNhbm5vdCBoYXZlIGEgZGVmYXVsdCB2YWx1ZVwiKTsgfVxuICAgICAgYnJlYWtcblxuICAgIGNhc2UgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiOlxuICAgICAgaWYgKG5vZGUub3BlcmF0b3IgIT09IFwiPVwiKSB7IHRoaXMucmFpc2Uobm9kZS5sZWZ0LmVuZCwgXCJPbmx5ICc9JyBvcGVyYXRvciBjYW4gYmUgdXNlZCBmb3Igc3BlY2lmeWluZyBkZWZhdWx0IHZhbHVlLlwiKTsgfVxuICAgICAgbm9kZS50eXBlID0gXCJBc3NpZ25tZW50UGF0dGVyblwiO1xuICAgICAgZGVsZXRlIG5vZGUub3BlcmF0b3I7XG4gICAgICB0aGlzLnRvQXNzaWduYWJsZShub2RlLmxlZnQsIGlzQmluZGluZyk7XG4gICAgICBicmVha1xuXG4gICAgY2FzZSBcIlBhcmVudGhlc2l6ZWRFeHByZXNzaW9uXCI6XG4gICAgICB0aGlzLnRvQXNzaWduYWJsZShub2RlLmV4cHJlc3Npb24sIGlzQmluZGluZywgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycyk7XG4gICAgICBicmVha1xuXG4gICAgY2FzZSBcIkNoYWluRXhwcmVzc2lvblwiOlxuICAgICAgdGhpcy5yYWlzZVJlY292ZXJhYmxlKG5vZGUuc3RhcnQsIFwiT3B0aW9uYWwgY2hhaW5pbmcgY2Fubm90IGFwcGVhciBpbiBsZWZ0LWhhbmQgc2lkZVwiKTtcbiAgICAgIGJyZWFrXG5cbiAgICBjYXNlIFwiTWVtYmVyRXhwcmVzc2lvblwiOlxuICAgICAgaWYgKCFpc0JpbmRpbmcpIHsgYnJlYWsgfVxuXG4gICAgZGVmYXVsdDpcbiAgICAgIHRoaXMucmFpc2Uobm9kZS5zdGFydCwgXCJBc3NpZ25pbmcgdG8gcnZhbHVlXCIpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7IHRoaXMuY2hlY2tQYXR0ZXJuRXJyb3JzKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMsIHRydWUpOyB9XG4gIHJldHVybiBub2RlXG59O1xuXG4vLyBDb252ZXJ0IGxpc3Qgb2YgZXhwcmVzc2lvbiBhdG9tcyB0byBiaW5kaW5nIGxpc3QuXG5cbnBwJDIudG9Bc3NpZ25hYmxlTGlzdCA9IGZ1bmN0aW9uKGV4cHJMaXN0LCBpc0JpbmRpbmcpIHtcbiAgdmFyIGVuZCA9IGV4cHJMaXN0Lmxlbmd0aDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbmQ7IGkrKykge1xuICAgIHZhciBlbHQgPSBleHByTGlzdFtpXTtcbiAgICBpZiAoZWx0KSB7IHRoaXMudG9Bc3NpZ25hYmxlKGVsdCwgaXNCaW5kaW5nKTsgfVxuICB9XG4gIGlmIChlbmQpIHtcbiAgICB2YXIgbGFzdCA9IGV4cHJMaXN0W2VuZCAtIDFdO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPT09IDYgJiYgaXNCaW5kaW5nICYmIGxhc3QgJiYgbGFzdC50eXBlID09PSBcIlJlc3RFbGVtZW50XCIgJiYgbGFzdC5hcmd1bWVudC50eXBlICE9PSBcIklkZW50aWZpZXJcIilcbiAgICAgIHsgdGhpcy51bmV4cGVjdGVkKGxhc3QuYXJndW1lbnQuc3RhcnQpOyB9XG4gIH1cbiAgcmV0dXJuIGV4cHJMaXN0XG59O1xuXG4vLyBQYXJzZXMgc3ByZWFkIGVsZW1lbnQuXG5cbnBwJDIucGFyc2VTcHJlYWQgPSBmdW5jdGlvbihyZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7XG4gIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgdGhpcy5uZXh0KCk7XG4gIG5vZGUuYXJndW1lbnQgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oZmFsc2UsIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpO1xuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiU3ByZWFkRWxlbWVudFwiKVxufTtcblxucHAkMi5wYXJzZVJlc3RCaW5kaW5nID0gZnVuY3Rpb24oKSB7XG4gIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgdGhpcy5uZXh0KCk7XG5cbiAgLy8gUmVzdEVsZW1lbnQgaW5zaWRlIG9mIGEgZnVuY3Rpb24gcGFyYW1ldGVyIG11c3QgYmUgYW4gaWRlbnRpZmllclxuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID09PSA2ICYmIHRoaXMudHlwZSAhPT0gdHlwZXMubmFtZSlcbiAgICB7IHRoaXMudW5leHBlY3RlZCgpOyB9XG5cbiAgbm9kZS5hcmd1bWVudCA9IHRoaXMucGFyc2VCaW5kaW5nQXRvbSgpO1xuXG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJSZXN0RWxlbWVudFwiKVxufTtcblxuLy8gUGFyc2VzIGx2YWx1ZSAoYXNzaWduYWJsZSkgYXRvbS5cblxucHAkMi5wYXJzZUJpbmRpbmdBdG9tID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNikge1xuICAgIHN3aXRjaCAodGhpcy50eXBlKSB7XG4gICAgY2FzZSB0eXBlcy5icmFja2V0TDpcbiAgICAgIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgbm9kZS5lbGVtZW50cyA9IHRoaXMucGFyc2VCaW5kaW5nTGlzdCh0eXBlcy5icmFja2V0UiwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiQXJyYXlQYXR0ZXJuXCIpXG5cbiAgICBjYXNlIHR5cGVzLmJyYWNlTDpcbiAgICAgIHJldHVybiB0aGlzLnBhcnNlT2JqKHRydWUpXG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzLnBhcnNlSWRlbnQoKVxufTtcblxucHAkMi5wYXJzZUJpbmRpbmdMaXN0ID0gZnVuY3Rpb24oY2xvc2UsIGFsbG93RW1wdHksIGFsbG93VHJhaWxpbmdDb21tYSkge1xuICB2YXIgZWx0cyA9IFtdLCBmaXJzdCA9IHRydWU7XG4gIHdoaWxlICghdGhpcy5lYXQoY2xvc2UpKSB7XG4gICAgaWYgKGZpcnN0KSB7IGZpcnN0ID0gZmFsc2U7IH1cbiAgICBlbHNlIHsgdGhpcy5leHBlY3QodHlwZXMuY29tbWEpOyB9XG4gICAgaWYgKGFsbG93RW1wdHkgJiYgdGhpcy50eXBlID09PSB0eXBlcy5jb21tYSkge1xuICAgICAgZWx0cy5wdXNoKG51bGwpO1xuICAgIH0gZWxzZSBpZiAoYWxsb3dUcmFpbGluZ0NvbW1hICYmIHRoaXMuYWZ0ZXJUcmFpbGluZ0NvbW1hKGNsb3NlKSkge1xuICAgICAgYnJlYWtcbiAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuZWxsaXBzaXMpIHtcbiAgICAgIHZhciByZXN0ID0gdGhpcy5wYXJzZVJlc3RCaW5kaW5nKCk7XG4gICAgICB0aGlzLnBhcnNlQmluZGluZ0xpc3RJdGVtKHJlc3QpO1xuICAgICAgZWx0cy5wdXNoKHJlc3QpO1xuICAgICAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuY29tbWEpIHsgdGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCBcIkNvbW1hIGlzIG5vdCBwZXJtaXR0ZWQgYWZ0ZXIgdGhlIHJlc3QgZWxlbWVudFwiKTsgfVxuICAgICAgdGhpcy5leHBlY3QoY2xvc2UpO1xuICAgICAgYnJlYWtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGVsZW0gPSB0aGlzLnBhcnNlTWF5YmVEZWZhdWx0KHRoaXMuc3RhcnQsIHRoaXMuc3RhcnRMb2MpO1xuICAgICAgdGhpcy5wYXJzZUJpbmRpbmdMaXN0SXRlbShlbGVtKTtcbiAgICAgIGVsdHMucHVzaChlbGVtKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGVsdHNcbn07XG5cbnBwJDIucGFyc2VCaW5kaW5nTGlzdEl0ZW0gPSBmdW5jdGlvbihwYXJhbSkge1xuICByZXR1cm4gcGFyYW1cbn07XG5cbi8vIFBhcnNlcyBhc3NpZ25tZW50IHBhdHRlcm4gYXJvdW5kIGdpdmVuIGF0b20gaWYgcG9zc2libGUuXG5cbnBwJDIucGFyc2VNYXliZURlZmF1bHQgPSBmdW5jdGlvbihzdGFydFBvcywgc3RhcnRMb2MsIGxlZnQpIHtcbiAgbGVmdCA9IGxlZnQgfHwgdGhpcy5wYXJzZUJpbmRpbmdBdG9tKCk7XG4gIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPCA2IHx8ICF0aGlzLmVhdCh0eXBlcy5lcSkpIHsgcmV0dXJuIGxlZnQgfVxuICB2YXIgbm9kZSA9IHRoaXMuc3RhcnROb2RlQXQoc3RhcnRQb3MsIHN0YXJ0TG9jKTtcbiAgbm9kZS5sZWZ0ID0gbGVmdDtcbiAgbm9kZS5yaWdodCA9IHRoaXMucGFyc2VNYXliZUFzc2lnbigpO1xuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiQXNzaWdubWVudFBhdHRlcm5cIilcbn07XG5cbi8vIFRoZSBmb2xsb3dpbmcgdGhyZWUgZnVuY3Rpb25zIGFsbCB2ZXJpZnkgdGhhdCBhIG5vZGUgaXMgYW4gbHZhbHVlIOKAlFxuLy8gc29tZXRoaW5nIHRoYXQgY2FuIGJlIGJvdW5kLCBvciBhc3NpZ25lZCB0by4gSW4gb3JkZXIgdG8gZG8gc28sIHRoZXkgcGVyZm9ybVxuLy8gYSB2YXJpZXR5IG9mIGNoZWNrczpcbi8vXG4vLyAtIENoZWNrIHRoYXQgbm9uZSBvZiB0aGUgYm91bmQvYXNzaWduZWQtdG8gaWRlbnRpZmllcnMgYXJlIHJlc2VydmVkIHdvcmRzLlxuLy8gLSBSZWNvcmQgbmFtZSBkZWNsYXJhdGlvbnMgZm9yIGJpbmRpbmdzIGluIHRoZSBhcHByb3ByaWF0ZSBzY29wZS5cbi8vIC0gQ2hlY2sgZHVwbGljYXRlIGFyZ3VtZW50IG5hbWVzLCBpZiBjaGVja0NsYXNoZXMgaXMgc2V0LlxuLy9cbi8vIElmIGEgY29tcGxleCBiaW5kaW5nIHBhdHRlcm4gaXMgZW5jb3VudGVyZWQgKGUuZy4sIG9iamVjdCBhbmQgYXJyYXlcbi8vIGRlc3RydWN0dXJpbmcpLCB0aGUgZW50aXJlIHBhdHRlcm4gaXMgcmVjdXJzaXZlbHkgY2hlY2tlZC5cbi8vXG4vLyBUaGVyZSBhcmUgdGhyZWUgdmVyc2lvbnMgb2YgY2hlY2tMVmFsKigpIGFwcHJvcHJpYXRlIGZvciBkaWZmZXJlbnRcbi8vIGNpcmN1bXN0YW5jZXM6XG4vL1xuLy8gLSBjaGVja0xWYWxTaW1wbGUoKSBzaGFsbCBiZSB1c2VkIGlmIHRoZSBzeW50YWN0aWMgY29uc3RydWN0IHN1cHBvcnRzXG4vLyAgIG5vdGhpbmcgb3RoZXIgdGhhbiBpZGVudGlmaWVycyBhbmQgbWVtYmVyIGV4cHJlc3Npb25zLiBQYXJlbnRoZXNpemVkXG4vLyAgIGV4cHJlc3Npb25zIGFyZSBhbHNvIGNvcnJlY3RseSBoYW5kbGVkLiBUaGlzIGlzIGdlbmVyYWxseSBhcHByb3ByaWF0ZSBmb3Jcbi8vICAgY29uc3RydWN0cyBmb3Igd2hpY2ggdGhlIHNwZWMgc2F5c1xuLy9cbi8vICAgPiBJdCBpcyBhIFN5bnRheCBFcnJvciBpZiBBc3NpZ25tZW50VGFyZ2V0VHlwZSBvZiBbdGhlIHByb2R1Y3Rpb25dIGlzIG5vdFxuLy8gICA+IHNpbXBsZS5cbi8vXG4vLyAgIEl0IGlzIGFsc28gYXBwcm9wcmlhdGUgZm9yIGNoZWNraW5nIGlmIGFuIGlkZW50aWZpZXIgaXMgdmFsaWQgYW5kIG5vdFxuLy8gICBkZWZpbmVkIGVsc2V3aGVyZSwgbGlrZSBpbXBvcnQgZGVjbGFyYXRpb25zIG9yIGZ1bmN0aW9uL2NsYXNzIGlkZW50aWZpZXJzLlxuLy9cbi8vICAgRXhhbXBsZXMgd2hlcmUgdGhpcyBpcyB1c2VkIGluY2x1ZGU6XG4vLyAgICAgYSArPSDigKY7XG4vLyAgICAgaW1wb3J0IGEgZnJvbSAn4oCmJztcbi8vICAgd2hlcmUgYSBpcyB0aGUgbm9kZSB0byBiZSBjaGVja2VkLlxuLy9cbi8vIC0gY2hlY2tMVmFsUGF0dGVybigpIHNoYWxsIGJlIHVzZWQgaWYgdGhlIHN5bnRhY3RpYyBjb25zdHJ1Y3Qgc3VwcG9ydHNcbi8vICAgYW55dGhpbmcgY2hlY2tMVmFsU2ltcGxlKCkgc3VwcG9ydHMsIGFzIHdlbGwgYXMgb2JqZWN0IGFuZCBhcnJheVxuLy8gICBkZXN0cnVjdHVyaW5nIHBhdHRlcm5zLiBUaGlzIGlzIGdlbmVyYWxseSBhcHByb3ByaWF0ZSBmb3IgY29uc3RydWN0cyBmb3Jcbi8vICAgd2hpY2ggdGhlIHNwZWMgc2F5c1xuLy9cbi8vICAgPiBJdCBpcyBhIFN5bnRheCBFcnJvciBpZiBbdGhlIHByb2R1Y3Rpb25dIGlzIG5laXRoZXIgYW4gT2JqZWN0TGl0ZXJhbCBub3Jcbi8vICAgPiBhbiBBcnJheUxpdGVyYWwgYW5kIEFzc2lnbm1lbnRUYXJnZXRUeXBlIG9mIFt0aGUgcHJvZHVjdGlvbl0gaXMgbm90XG4vLyAgID4gc2ltcGxlLlxuLy9cbi8vICAgRXhhbXBsZXMgd2hlcmUgdGhpcyBpcyB1c2VkIGluY2x1ZGU6XG4vLyAgICAgKGEgPSDigKYpO1xuLy8gICAgIGNvbnN0IGEgPSDigKY7XG4vLyAgICAgdHJ5IHsg4oCmIH0gY2F0Y2ggKGEpIHsg4oCmIH1cbi8vICAgd2hlcmUgYSBpcyB0aGUgbm9kZSB0byBiZSBjaGVja2VkLlxuLy9cbi8vIC0gY2hlY2tMVmFsSW5uZXJQYXR0ZXJuKCkgc2hhbGwgYmUgdXNlZCBpZiB0aGUgc3ludGFjdGljIGNvbnN0cnVjdCBzdXBwb3J0c1xuLy8gICBhbnl0aGluZyBjaGVja0xWYWxQYXR0ZXJuKCkgc3VwcG9ydHMsIGFzIHdlbGwgYXMgZGVmYXVsdCBhc3NpZ25tZW50XG4vLyAgIHBhdHRlcm5zLCByZXN0IGVsZW1lbnRzLCBhbmQgb3RoZXIgY29uc3RydWN0cyB0aGF0IG1heSBhcHBlYXIgd2l0aGluIGFuXG4vLyAgIG9iamVjdCBvciBhcnJheSBkZXN0cnVjdHVyaW5nIHBhdHRlcm4uXG4vL1xuLy8gICBBcyBhIHNwZWNpYWwgY2FzZSwgZnVuY3Rpb24gcGFyYW1ldGVycyBhbHNvIHVzZSBjaGVja0xWYWxJbm5lclBhdHRlcm4oKSxcbi8vICAgYXMgdGhleSBhbHNvIHN1cHBvcnQgZGVmYXVsdHMgYW5kIHJlc3QgY29uc3RydWN0cy5cbi8vXG4vLyBUaGVzZSBmdW5jdGlvbnMgZGVsaWJlcmF0ZWx5IHN1cHBvcnQgYm90aCBhc3NpZ25tZW50IGFuZCBiaW5kaW5nIGNvbnN0cnVjdHMsXG4vLyBhcyB0aGUgbG9naWMgZm9yIGJvdGggaXMgZXhjZWVkaW5nbHkgc2ltaWxhci4gSWYgdGhlIG5vZGUgaXMgdGhlIHRhcmdldCBvZlxuLy8gYW4gYXNzaWdubWVudCwgdGhlbiBiaW5kaW5nVHlwZSBzaG91bGQgYmUgc2V0IHRvIEJJTkRfTk9ORS4gT3RoZXJ3aXNlLCBpdFxuLy8gc2hvdWxkIGJlIHNldCB0byB0aGUgYXBwcm9wcmlhdGUgQklORF8qIGNvbnN0YW50LCBsaWtlIEJJTkRfVkFSIG9yXG4vLyBCSU5EX0xFWElDQUwuXG4vL1xuLy8gSWYgdGhlIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aXRoIGEgbm9uLUJJTkRfTk9ORSBiaW5kaW5nVHlwZSwgdGhlblxuLy8gYWRkaXRpb25hbGx5IGEgY2hlY2tDbGFzaGVzIG9iamVjdCBtYXkgYmUgc3BlY2lmaWVkIHRvIGFsbG93IGNoZWNraW5nIGZvclxuLy8gZHVwbGljYXRlIGFyZ3VtZW50IG5hbWVzLiBjaGVja0NsYXNoZXMgaXMgaWdub3JlZCBpZiB0aGUgcHJvdmlkZWQgY29uc3RydWN0XG4vLyBpcyBhbiBhc3NpZ25tZW50IChpLmUuLCBiaW5kaW5nVHlwZSBpcyBCSU5EX05PTkUpLlxuXG5wcCQyLmNoZWNrTFZhbFNpbXBsZSA9IGZ1bmN0aW9uKGV4cHIsIGJpbmRpbmdUeXBlLCBjaGVja0NsYXNoZXMpIHtcbiAgaWYgKCBiaW5kaW5nVHlwZSA9PT0gdm9pZCAwICkgYmluZGluZ1R5cGUgPSBCSU5EX05PTkU7XG5cbiAgdmFyIGlzQmluZCA9IGJpbmRpbmdUeXBlICE9PSBCSU5EX05PTkU7XG5cbiAgc3dpdGNoIChleHByLnR5cGUpIHtcbiAgY2FzZSBcIklkZW50aWZpZXJcIjpcbiAgICBpZiAodGhpcy5zdHJpY3QgJiYgdGhpcy5yZXNlcnZlZFdvcmRzU3RyaWN0QmluZC50ZXN0KGV4cHIubmFtZSkpXG4gICAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShleHByLnN0YXJ0LCAoaXNCaW5kID8gXCJCaW5kaW5nIFwiIDogXCJBc3NpZ25pbmcgdG8gXCIpICsgZXhwci5uYW1lICsgXCIgaW4gc3RyaWN0IG1vZGVcIik7IH1cbiAgICBpZiAoaXNCaW5kKSB7XG4gICAgICBpZiAoYmluZGluZ1R5cGUgPT09IEJJTkRfTEVYSUNBTCAmJiBleHByLm5hbWUgPT09IFwibGV0XCIpXG4gICAgICAgIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKGV4cHIuc3RhcnQsIFwibGV0IGlzIGRpc2FsbG93ZWQgYXMgYSBsZXhpY2FsbHkgYm91bmQgbmFtZVwiKTsgfVxuICAgICAgaWYgKGNoZWNrQ2xhc2hlcykge1xuICAgICAgICBpZiAoaGFzKGNoZWNrQ2xhc2hlcywgZXhwci5uYW1lKSlcbiAgICAgICAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShleHByLnN0YXJ0LCBcIkFyZ3VtZW50IG5hbWUgY2xhc2hcIik7IH1cbiAgICAgICAgY2hlY2tDbGFzaGVzW2V4cHIubmFtZV0gPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKGJpbmRpbmdUeXBlICE9PSBCSU5EX09VVFNJREUpIHsgdGhpcy5kZWNsYXJlTmFtZShleHByLm5hbWUsIGJpbmRpbmdUeXBlLCBleHByLnN0YXJ0KTsgfVxuICAgIH1cbiAgICBicmVha1xuXG4gIGNhc2UgXCJDaGFpbkV4cHJlc3Npb25cIjpcbiAgICB0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZXhwci5zdGFydCwgXCJPcHRpb25hbCBjaGFpbmluZyBjYW5ub3QgYXBwZWFyIGluIGxlZnQtaGFuZCBzaWRlXCIpO1xuICAgIGJyZWFrXG5cbiAgY2FzZSBcIk1lbWJlckV4cHJlc3Npb25cIjpcbiAgICBpZiAoaXNCaW5kKSB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShleHByLnN0YXJ0LCBcIkJpbmRpbmcgbWVtYmVyIGV4cHJlc3Npb25cIik7IH1cbiAgICBicmVha1xuXG4gIGNhc2UgXCJQYXJlbnRoZXNpemVkRXhwcmVzc2lvblwiOlxuICAgIGlmIChpc0JpbmQpIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKGV4cHIuc3RhcnQsIFwiQmluZGluZyBwYXJlbnRoZXNpemVkIGV4cHJlc3Npb25cIik7IH1cbiAgICByZXR1cm4gdGhpcy5jaGVja0xWYWxTaW1wbGUoZXhwci5leHByZXNzaW9uLCBiaW5kaW5nVHlwZSwgY2hlY2tDbGFzaGVzKVxuXG4gIGRlZmF1bHQ6XG4gICAgdGhpcy5yYWlzZShleHByLnN0YXJ0LCAoaXNCaW5kID8gXCJCaW5kaW5nXCIgOiBcIkFzc2lnbmluZyB0b1wiKSArIFwiIHJ2YWx1ZVwiKTtcbiAgfVxufTtcblxucHAkMi5jaGVja0xWYWxQYXR0ZXJuID0gZnVuY3Rpb24oZXhwciwgYmluZGluZ1R5cGUsIGNoZWNrQ2xhc2hlcykge1xuICBpZiAoIGJpbmRpbmdUeXBlID09PSB2b2lkIDAgKSBiaW5kaW5nVHlwZSA9IEJJTkRfTk9ORTtcblxuICBzd2l0Y2ggKGV4cHIudHlwZSkge1xuICBjYXNlIFwiT2JqZWN0UGF0dGVyblwiOlxuICAgIGZvciAodmFyIGkgPSAwLCBsaXN0ID0gZXhwci5wcm9wZXJ0aWVzOyBpIDwgbGlzdC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgdmFyIHByb3AgPSBsaXN0W2ldO1xuXG4gICAgdGhpcy5jaGVja0xWYWxJbm5lclBhdHRlcm4ocHJvcCwgYmluZGluZ1R5cGUsIGNoZWNrQ2xhc2hlcyk7XG4gICAgfVxuICAgIGJyZWFrXG5cbiAgY2FzZSBcIkFycmF5UGF0dGVyblwiOlxuICAgIGZvciAodmFyIGkkMSA9IDAsIGxpc3QkMSA9IGV4cHIuZWxlbWVudHM7IGkkMSA8IGxpc3QkMS5sZW5ndGg7IGkkMSArPSAxKSB7XG4gICAgICB2YXIgZWxlbSA9IGxpc3QkMVtpJDFdO1xuXG4gICAgaWYgKGVsZW0pIHsgdGhpcy5jaGVja0xWYWxJbm5lclBhdHRlcm4oZWxlbSwgYmluZGluZ1R5cGUsIGNoZWNrQ2xhc2hlcyk7IH1cbiAgICB9XG4gICAgYnJlYWtcblxuICBkZWZhdWx0OlxuICAgIHRoaXMuY2hlY2tMVmFsU2ltcGxlKGV4cHIsIGJpbmRpbmdUeXBlLCBjaGVja0NsYXNoZXMpO1xuICB9XG59O1xuXG5wcCQyLmNoZWNrTFZhbElubmVyUGF0dGVybiA9IGZ1bmN0aW9uKGV4cHIsIGJpbmRpbmdUeXBlLCBjaGVja0NsYXNoZXMpIHtcbiAgaWYgKCBiaW5kaW5nVHlwZSA9PT0gdm9pZCAwICkgYmluZGluZ1R5cGUgPSBCSU5EX05PTkU7XG5cbiAgc3dpdGNoIChleHByLnR5cGUpIHtcbiAgY2FzZSBcIlByb3BlcnR5XCI6XG4gICAgLy8gQXNzaWdubWVudFByb3BlcnR5IGhhcyB0eXBlID09PSBcIlByb3BlcnR5XCJcbiAgICB0aGlzLmNoZWNrTFZhbElubmVyUGF0dGVybihleHByLnZhbHVlLCBiaW5kaW5nVHlwZSwgY2hlY2tDbGFzaGVzKTtcbiAgICBicmVha1xuXG4gIGNhc2UgXCJBc3NpZ25tZW50UGF0dGVyblwiOlxuICAgIHRoaXMuY2hlY2tMVmFsUGF0dGVybihleHByLmxlZnQsIGJpbmRpbmdUeXBlLCBjaGVja0NsYXNoZXMpO1xuICAgIGJyZWFrXG5cbiAgY2FzZSBcIlJlc3RFbGVtZW50XCI6XG4gICAgdGhpcy5jaGVja0xWYWxQYXR0ZXJuKGV4cHIuYXJndW1lbnQsIGJpbmRpbmdUeXBlLCBjaGVja0NsYXNoZXMpO1xuICAgIGJyZWFrXG5cbiAgZGVmYXVsdDpcbiAgICB0aGlzLmNoZWNrTFZhbFBhdHRlcm4oZXhwciwgYmluZGluZ1R5cGUsIGNoZWNrQ2xhc2hlcyk7XG4gIH1cbn07XG5cbi8vIEEgcmVjdXJzaXZlIGRlc2NlbnQgcGFyc2VyIG9wZXJhdGVzIGJ5IGRlZmluaW5nIGZ1bmN0aW9ucyBmb3IgYWxsXG5cbnZhciBwcCQzID0gUGFyc2VyLnByb3RvdHlwZTtcblxuLy8gQ2hlY2sgaWYgcHJvcGVydHkgbmFtZSBjbGFzaGVzIHdpdGggYWxyZWFkeSBhZGRlZC5cbi8vIE9iamVjdC9jbGFzcyBnZXR0ZXJzIGFuZCBzZXR0ZXJzIGFyZSBub3QgYWxsb3dlZCB0byBjbGFzaCDigJRcbi8vIGVpdGhlciB3aXRoIGVhY2ggb3RoZXIgb3Igd2l0aCBhbiBpbml0IHByb3BlcnR5IOKAlCBhbmQgaW5cbi8vIHN0cmljdCBtb2RlLCBpbml0IHByb3BlcnRpZXMgYXJlIGFsc28gbm90IGFsbG93ZWQgdG8gYmUgcmVwZWF0ZWQuXG5cbnBwJDMuY2hlY2tQcm9wQ2xhc2ggPSBmdW5jdGlvbihwcm9wLCBwcm9wSGFzaCwgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycykge1xuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDkgJiYgcHJvcC50eXBlID09PSBcIlNwcmVhZEVsZW1lbnRcIilcbiAgICB7IHJldHVybiB9XG4gIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNiAmJiAocHJvcC5jb21wdXRlZCB8fCBwcm9wLm1ldGhvZCB8fCBwcm9wLnNob3J0aGFuZCkpXG4gICAgeyByZXR1cm4gfVxuICB2YXIga2V5ID0gcHJvcC5rZXk7XG4gIHZhciBuYW1lO1xuICBzd2l0Y2ggKGtleS50eXBlKSB7XG4gIGNhc2UgXCJJZGVudGlmaWVyXCI6IG5hbWUgPSBrZXkubmFtZTsgYnJlYWtcbiAgY2FzZSBcIkxpdGVyYWxcIjogbmFtZSA9IFN0cmluZyhrZXkudmFsdWUpOyBicmVha1xuICBkZWZhdWx0OiByZXR1cm5cbiAgfVxuICB2YXIga2luZCA9IHByb3Aua2luZDtcbiAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2KSB7XG4gICAgaWYgKG5hbWUgPT09IFwiX19wcm90b19fXCIgJiYga2luZCA9PT0gXCJpbml0XCIpIHtcbiAgICAgIGlmIChwcm9wSGFzaC5wcm90bykge1xuICAgICAgICBpZiAocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycykge1xuICAgICAgICAgIGlmIChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLmRvdWJsZVByb3RvIDwgMClcbiAgICAgICAgICAgIHsgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy5kb3VibGVQcm90byA9IGtleS5zdGFydDsgfVxuICAgICAgICAgIC8vIEJhY2t3YXJkcy1jb21wYXQga2x1ZGdlLiBDYW4gYmUgcmVtb3ZlZCBpbiB2ZXJzaW9uIDYuMFxuICAgICAgICB9IGVsc2UgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUoa2V5LnN0YXJ0LCBcIlJlZGVmaW5pdGlvbiBvZiBfX3Byb3RvX18gcHJvcGVydHlcIik7IH1cbiAgICAgIH1cbiAgICAgIHByb3BIYXNoLnByb3RvID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuXG4gIH1cbiAgbmFtZSA9IFwiJFwiICsgbmFtZTtcbiAgdmFyIG90aGVyID0gcHJvcEhhc2hbbmFtZV07XG4gIGlmIChvdGhlcikge1xuICAgIHZhciByZWRlZmluaXRpb247XG4gICAgaWYgKGtpbmQgPT09IFwiaW5pdFwiKSB7XG4gICAgICByZWRlZmluaXRpb24gPSB0aGlzLnN0cmljdCAmJiBvdGhlci5pbml0IHx8IG90aGVyLmdldCB8fCBvdGhlci5zZXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlZGVmaW5pdGlvbiA9IG90aGVyLmluaXQgfHwgb3RoZXJba2luZF07XG4gICAgfVxuICAgIGlmIChyZWRlZmluaXRpb24pXG4gICAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShrZXkuc3RhcnQsIFwiUmVkZWZpbml0aW9uIG9mIHByb3BlcnR5XCIpOyB9XG4gIH0gZWxzZSB7XG4gICAgb3RoZXIgPSBwcm9wSGFzaFtuYW1lXSA9IHtcbiAgICAgIGluaXQ6IGZhbHNlLFxuICAgICAgZ2V0OiBmYWxzZSxcbiAgICAgIHNldDogZmFsc2VcbiAgICB9O1xuICB9XG4gIG90aGVyW2tpbmRdID0gdHJ1ZTtcbn07XG5cbi8vICMjIyBFeHByZXNzaW9uIHBhcnNpbmdcblxuLy8gVGhlc2UgbmVzdCwgZnJvbSB0aGUgbW9zdCBnZW5lcmFsIGV4cHJlc3Npb24gdHlwZSBhdCB0aGUgdG9wIHRvXG4vLyAnYXRvbWljJywgbm9uZGl2aXNpYmxlIGV4cHJlc3Npb24gdHlwZXMgYXQgdGhlIGJvdHRvbS4gTW9zdCBvZlxuLy8gdGhlIGZ1bmN0aW9ucyB3aWxsIHNpbXBseSBsZXQgdGhlIGZ1bmN0aW9uKHMpIGJlbG93IHRoZW0gcGFyc2UsXG4vLyBhbmQsICppZiogdGhlIHN5bnRhY3RpYyBjb25zdHJ1Y3QgdGhleSBoYW5kbGUgaXMgcHJlc2VudCwgd3JhcFxuLy8gdGhlIEFTVCBub2RlIHRoYXQgdGhlIGlubmVyIHBhcnNlciBnYXZlIHRoZW0gaW4gYW5vdGhlciBub2RlLlxuXG4vLyBQYXJzZSBhIGZ1bGwgZXhwcmVzc2lvbi4gVGhlIG9wdGlvbmFsIGFyZ3VtZW50cyBhcmUgdXNlZCB0b1xuLy8gZm9yYmlkIHRoZSBgaW5gIG9wZXJhdG9yIChpbiBmb3IgbG9vcHMgaW5pdGFsaXphdGlvbiBleHByZXNzaW9ucylcbi8vIGFuZCBwcm92aWRlIHJlZmVyZW5jZSBmb3Igc3RvcmluZyAnPScgb3BlcmF0b3IgaW5zaWRlIHNob3J0aGFuZFxuLy8gcHJvcGVydHkgYXNzaWdubWVudCBpbiBjb250ZXh0cyB3aGVyZSBib3RoIG9iamVjdCBleHByZXNzaW9uXG4vLyBhbmQgb2JqZWN0IHBhdHRlcm4gbWlnaHQgYXBwZWFyIChzbyBpdCdzIHBvc3NpYmxlIHRvIHJhaXNlXG4vLyBkZWxheWVkIHN5bnRheCBlcnJvciBhdCBjb3JyZWN0IHBvc2l0aW9uKS5cblxucHAkMy5wYXJzZUV4cHJlc3Npb24gPSBmdW5jdGlvbihmb3JJbml0LCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7XG4gIHZhciBzdGFydFBvcyA9IHRoaXMuc3RhcnQsIHN0YXJ0TG9jID0gdGhpcy5zdGFydExvYztcbiAgdmFyIGV4cHIgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oZm9ySW5pdCwgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycyk7XG4gIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLmNvbW1hKSB7XG4gICAgdmFyIG5vZGUgPSB0aGlzLnN0YXJ0Tm9kZUF0KHN0YXJ0UG9zLCBzdGFydExvYyk7XG4gICAgbm9kZS5leHByZXNzaW9ucyA9IFtleHByXTtcbiAgICB3aGlsZSAodGhpcy5lYXQodHlwZXMuY29tbWEpKSB7IG5vZGUuZXhwcmVzc2lvbnMucHVzaCh0aGlzLnBhcnNlTWF5YmVBc3NpZ24oZm9ySW5pdCwgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycykpOyB9XG4gICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIlNlcXVlbmNlRXhwcmVzc2lvblwiKVxuICB9XG4gIHJldHVybiBleHByXG59O1xuXG4vLyBQYXJzZSBhbiBhc3NpZ25tZW50IGV4cHJlc3Npb24uIFRoaXMgaW5jbHVkZXMgYXBwbGljYXRpb25zIG9mXG4vLyBvcGVyYXRvcnMgbGlrZSBgKz1gLlxuXG5wcCQzLnBhcnNlTWF5YmVBc3NpZ24gPSBmdW5jdGlvbihmb3JJbml0LCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzLCBhZnRlckxlZnRQYXJzZSkge1xuICBpZiAodGhpcy5pc0NvbnRleHR1YWwoXCJ5aWVsZFwiKSkge1xuICAgIGlmICh0aGlzLmluR2VuZXJhdG9yKSB7IHJldHVybiB0aGlzLnBhcnNlWWllbGQoZm9ySW5pdCkgfVxuICAgIC8vIFRoZSB0b2tlbml6ZXIgd2lsbCBhc3N1bWUgYW4gZXhwcmVzc2lvbiBpcyBhbGxvd2VkIGFmdGVyXG4gICAgLy8gYHlpZWxkYCwgYnV0IHRoaXMgaXNuJ3QgdGhhdCBraW5kIG9mIHlpZWxkXG4gICAgZWxzZSB7IHRoaXMuZXhwckFsbG93ZWQgPSBmYWxzZTsgfVxuICB9XG5cbiAgdmFyIG93bkRlc3RydWN0dXJpbmdFcnJvcnMgPSBmYWxzZSwgb2xkUGFyZW5Bc3NpZ24gPSAtMSwgb2xkVHJhaWxpbmdDb21tYSA9IC0xO1xuICBpZiAocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycykge1xuICAgIG9sZFBhcmVuQXNzaWduID0gcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy5wYXJlbnRoZXNpemVkQXNzaWduO1xuICAgIG9sZFRyYWlsaW5nQ29tbWEgPSByZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnRyYWlsaW5nQ29tbWE7XG4gICAgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy5wYXJlbnRoZXNpemVkQXNzaWduID0gcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy50cmFpbGluZ0NvbW1hID0gLTE7XG4gIH0gZWxzZSB7XG4gICAgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycyA9IG5ldyBEZXN0cnVjdHVyaW5nRXJyb3JzO1xuICAgIG93bkRlc3RydWN0dXJpbmdFcnJvcnMgPSB0cnVlO1xuICB9XG5cbiAgdmFyIHN0YXJ0UG9zID0gdGhpcy5zdGFydCwgc3RhcnRMb2MgPSB0aGlzLnN0YXJ0TG9jO1xuICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5wYXJlbkwgfHwgdGhpcy50eXBlID09PSB0eXBlcy5uYW1lKSB7XG4gICAgdGhpcy5wb3RlbnRpYWxBcnJvd0F0ID0gdGhpcy5zdGFydDtcbiAgICB0aGlzLnBvdGVudGlhbEFycm93SW5Gb3JBd2FpdCA9IGZvckluaXQgPT09IFwiYXdhaXRcIjtcbiAgfVxuICB2YXIgbGVmdCA9IHRoaXMucGFyc2VNYXliZUNvbmRpdGlvbmFsKGZvckluaXQsIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpO1xuICBpZiAoYWZ0ZXJMZWZ0UGFyc2UpIHsgbGVmdCA9IGFmdGVyTGVmdFBhcnNlLmNhbGwodGhpcywgbGVmdCwgc3RhcnRQb3MsIHN0YXJ0TG9jKTsgfVxuICBpZiAodGhpcy50eXBlLmlzQXNzaWduKSB7XG4gICAgdmFyIG5vZGUgPSB0aGlzLnN0YXJ0Tm9kZUF0KHN0YXJ0UG9zLCBzdGFydExvYyk7XG4gICAgbm9kZS5vcGVyYXRvciA9IHRoaXMudmFsdWU7XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuZXEpXG4gICAgICB7IGxlZnQgPSB0aGlzLnRvQXNzaWduYWJsZShsZWZ0LCBmYWxzZSwgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycyk7IH1cbiAgICBpZiAoIW93bkRlc3RydWN0dXJpbmdFcnJvcnMpIHtcbiAgICAgIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMucGFyZW50aGVzaXplZEFzc2lnbiA9IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMudHJhaWxpbmdDb21tYSA9IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMuZG91YmxlUHJvdG8gPSAtMTtcbiAgICB9XG4gICAgaWYgKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMuc2hvcnRoYW5kQXNzaWduID49IGxlZnQuc3RhcnQpXG4gICAgICB7IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMuc2hvcnRoYW5kQXNzaWduID0gLTE7IH0gLy8gcmVzZXQgYmVjYXVzZSBzaG9ydGhhbmQgZGVmYXVsdCB3YXMgdXNlZCBjb3JyZWN0bHlcbiAgICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5lcSlcbiAgICAgIHsgdGhpcy5jaGVja0xWYWxQYXR0ZXJuKGxlZnQpOyB9XG4gICAgZWxzZVxuICAgICAgeyB0aGlzLmNoZWNrTFZhbFNpbXBsZShsZWZ0KTsgfVxuICAgIG5vZGUubGVmdCA9IGxlZnQ7XG4gICAgdGhpcy5uZXh0KCk7XG4gICAgbm9kZS5yaWdodCA9IHRoaXMucGFyc2VNYXliZUFzc2lnbihmb3JJbml0KTtcbiAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiQXNzaWdubWVudEV4cHJlc3Npb25cIilcbiAgfSBlbHNlIHtcbiAgICBpZiAob3duRGVzdHJ1Y3R1cmluZ0Vycm9ycykgeyB0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyhyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLCB0cnVlKTsgfVxuICB9XG4gIGlmIChvbGRQYXJlbkFzc2lnbiA+IC0xKSB7IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMucGFyZW50aGVzaXplZEFzc2lnbiA9IG9sZFBhcmVuQXNzaWduOyB9XG4gIGlmIChvbGRUcmFpbGluZ0NvbW1hID4gLTEpIHsgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy50cmFpbGluZ0NvbW1hID0gb2xkVHJhaWxpbmdDb21tYTsgfVxuICByZXR1cm4gbGVmdFxufTtcblxuLy8gUGFyc2UgYSB0ZXJuYXJ5IGNvbmRpdGlvbmFsIChgPzpgKSBvcGVyYXRvci5cblxucHAkMy5wYXJzZU1heWJlQ29uZGl0aW9uYWwgPSBmdW5jdGlvbihmb3JJbml0LCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7XG4gIHZhciBzdGFydFBvcyA9IHRoaXMuc3RhcnQsIHN0YXJ0TG9jID0gdGhpcy5zdGFydExvYztcbiAgdmFyIGV4cHIgPSB0aGlzLnBhcnNlRXhwck9wcyhmb3JJbml0LCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKTtcbiAgaWYgKHRoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpKSB7IHJldHVybiBleHByIH1cbiAgaWYgKHRoaXMuZWF0KHR5cGVzLnF1ZXN0aW9uKSkge1xuICAgIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGVBdChzdGFydFBvcywgc3RhcnRMb2MpO1xuICAgIG5vZGUudGVzdCA9IGV4cHI7XG4gICAgbm9kZS5jb25zZXF1ZW50ID0gdGhpcy5wYXJzZU1heWJlQXNzaWduKCk7XG4gICAgdGhpcy5leHBlY3QodHlwZXMuY29sb24pO1xuICAgIG5vZGUuYWx0ZXJuYXRlID0gdGhpcy5wYXJzZU1heWJlQXNzaWduKGZvckluaXQpO1xuICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJDb25kaXRpb25hbEV4cHJlc3Npb25cIilcbiAgfVxuICByZXR1cm4gZXhwclxufTtcblxuLy8gU3RhcnQgdGhlIHByZWNlZGVuY2UgcGFyc2VyLlxuXG5wcCQzLnBhcnNlRXhwck9wcyA9IGZ1bmN0aW9uKGZvckluaXQsIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpIHtcbiAgdmFyIHN0YXJ0UG9zID0gdGhpcy5zdGFydCwgc3RhcnRMb2MgPSB0aGlzLnN0YXJ0TG9jO1xuICB2YXIgZXhwciA9IHRoaXMucGFyc2VNYXliZVVuYXJ5KHJlZkRlc3RydWN0dXJpbmdFcnJvcnMsIGZhbHNlKTtcbiAgaWYgKHRoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpKSB7IHJldHVybiBleHByIH1cbiAgcmV0dXJuIGV4cHIuc3RhcnQgPT09IHN0YXJ0UG9zICYmIGV4cHIudHlwZSA9PT0gXCJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvblwiID8gZXhwciA6IHRoaXMucGFyc2VFeHByT3AoZXhwciwgc3RhcnRQb3MsIHN0YXJ0TG9jLCAtMSwgZm9ySW5pdClcbn07XG5cbi8vIFBhcnNlIGJpbmFyeSBvcGVyYXRvcnMgd2l0aCB0aGUgb3BlcmF0b3IgcHJlY2VkZW5jZSBwYXJzaW5nXG4vLyBhbGdvcml0aG0uIGBsZWZ0YCBpcyB0aGUgbGVmdC1oYW5kIHNpZGUgb2YgdGhlIG9wZXJhdG9yLlxuLy8gYG1pblByZWNgIHByb3ZpZGVzIGNvbnRleHQgdGhhdCBhbGxvd3MgdGhlIGZ1bmN0aW9uIHRvIHN0b3AgYW5kXG4vLyBkZWZlciBmdXJ0aGVyIHBhcnNlciB0byBvbmUgb2YgaXRzIGNhbGxlcnMgd2hlbiBpdCBlbmNvdW50ZXJzIGFuXG4vLyBvcGVyYXRvciB0aGF0IGhhcyBhIGxvd2VyIHByZWNlZGVuY2UgdGhhbiB0aGUgc2V0IGl0IGlzIHBhcnNpbmcuXG5cbnBwJDMucGFyc2VFeHByT3AgPSBmdW5jdGlvbihsZWZ0LCBsZWZ0U3RhcnRQb3MsIGxlZnRTdGFydExvYywgbWluUHJlYywgZm9ySW5pdCkge1xuICB2YXIgcHJlYyA9IHRoaXMudHlwZS5iaW5vcDtcbiAgaWYgKHByZWMgIT0gbnVsbCAmJiAoIWZvckluaXQgfHwgdGhpcy50eXBlICE9PSB0eXBlcy5faW4pKSB7XG4gICAgaWYgKHByZWMgPiBtaW5QcmVjKSB7XG4gICAgICB2YXIgbG9naWNhbCA9IHRoaXMudHlwZSA9PT0gdHlwZXMubG9naWNhbE9SIHx8IHRoaXMudHlwZSA9PT0gdHlwZXMubG9naWNhbEFORDtcbiAgICAgIHZhciBjb2FsZXNjZSA9IHRoaXMudHlwZSA9PT0gdHlwZXMuY29hbGVzY2U7XG4gICAgICBpZiAoY29hbGVzY2UpIHtcbiAgICAgICAgLy8gSGFuZGxlIHRoZSBwcmVjZWRlbmNlIG9mIGB0dC5jb2FsZXNjZWAgYXMgZXF1YWwgdG8gdGhlIHJhbmdlIG9mIGxvZ2ljYWwgZXhwcmVzc2lvbnMuXG4gICAgICAgIC8vIEluIG90aGVyIHdvcmRzLCBgbm9kZS5yaWdodGAgc2hvdWxkbid0IGNvbnRhaW4gbG9naWNhbCBleHByZXNzaW9ucyBpbiBvcmRlciB0byBjaGVjayB0aGUgbWl4ZWQgZXJyb3IuXG4gICAgICAgIHByZWMgPSB0eXBlcy5sb2dpY2FsQU5ELmJpbm9wO1xuICAgICAgfVxuICAgICAgdmFyIG9wID0gdGhpcy52YWx1ZTtcbiAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgdmFyIHN0YXJ0UG9zID0gdGhpcy5zdGFydCwgc3RhcnRMb2MgPSB0aGlzLnN0YXJ0TG9jO1xuICAgICAgdmFyIHJpZ2h0ID0gdGhpcy5wYXJzZUV4cHJPcCh0aGlzLnBhcnNlTWF5YmVVbmFyeShudWxsLCBmYWxzZSksIHN0YXJ0UG9zLCBzdGFydExvYywgcHJlYywgZm9ySW5pdCk7XG4gICAgICB2YXIgbm9kZSA9IHRoaXMuYnVpbGRCaW5hcnkobGVmdFN0YXJ0UG9zLCBsZWZ0U3RhcnRMb2MsIGxlZnQsIHJpZ2h0LCBvcCwgbG9naWNhbCB8fCBjb2FsZXNjZSk7XG4gICAgICBpZiAoKGxvZ2ljYWwgJiYgdGhpcy50eXBlID09PSB0eXBlcy5jb2FsZXNjZSkgfHwgKGNvYWxlc2NlICYmICh0aGlzLnR5cGUgPT09IHR5cGVzLmxvZ2ljYWxPUiB8fCB0aGlzLnR5cGUgPT09IHR5cGVzLmxvZ2ljYWxBTkQpKSkge1xuICAgICAgICB0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5zdGFydCwgXCJMb2dpY2FsIGV4cHJlc3Npb25zIGFuZCBjb2FsZXNjZSBleHByZXNzaW9ucyBjYW5ub3QgYmUgbWl4ZWQuIFdyYXAgZWl0aGVyIGJ5IHBhcmVudGhlc2VzXCIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMucGFyc2VFeHByT3Aobm9kZSwgbGVmdFN0YXJ0UG9zLCBsZWZ0U3RhcnRMb2MsIG1pblByZWMsIGZvckluaXQpXG4gICAgfVxuICB9XG4gIHJldHVybiBsZWZ0XG59O1xuXG5wcCQzLmJ1aWxkQmluYXJ5ID0gZnVuY3Rpb24oc3RhcnRQb3MsIHN0YXJ0TG9jLCBsZWZ0LCByaWdodCwgb3AsIGxvZ2ljYWwpIHtcbiAgdmFyIG5vZGUgPSB0aGlzLnN0YXJ0Tm9kZUF0KHN0YXJ0UG9zLCBzdGFydExvYyk7XG4gIG5vZGUubGVmdCA9IGxlZnQ7XG4gIG5vZGUub3BlcmF0b3IgPSBvcDtcbiAgbm9kZS5yaWdodCA9IHJpZ2h0O1xuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIGxvZ2ljYWwgPyBcIkxvZ2ljYWxFeHByZXNzaW9uXCIgOiBcIkJpbmFyeUV4cHJlc3Npb25cIilcbn07XG5cbi8vIFBhcnNlIHVuYXJ5IG9wZXJhdG9ycywgYm90aCBwcmVmaXggYW5kIHBvc3RmaXguXG5cbnBwJDMucGFyc2VNYXliZVVuYXJ5ID0gZnVuY3Rpb24ocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycywgc2F3VW5hcnksIGluY0RlYykge1xuICB2YXIgc3RhcnRQb3MgPSB0aGlzLnN0YXJ0LCBzdGFydExvYyA9IHRoaXMuc3RhcnRMb2MsIGV4cHI7XG4gIGlmICh0aGlzLmlzQ29udGV4dHVhbChcImF3YWl0XCIpICYmIHRoaXMuY2FuQXdhaXQpIHtcbiAgICBleHByID0gdGhpcy5wYXJzZUF3YWl0KCk7XG4gICAgc2F3VW5hcnkgPSB0cnVlO1xuICB9IGVsc2UgaWYgKHRoaXMudHlwZS5wcmVmaXgpIHtcbiAgICB2YXIgbm9kZSA9IHRoaXMuc3RhcnROb2RlKCksIHVwZGF0ZSA9IHRoaXMudHlwZSA9PT0gdHlwZXMuaW5jRGVjO1xuICAgIG5vZGUub3BlcmF0b3IgPSB0aGlzLnZhbHVlO1xuICAgIG5vZGUucHJlZml4ID0gdHJ1ZTtcbiAgICB0aGlzLm5leHQoKTtcbiAgICBub2RlLmFyZ3VtZW50ID0gdGhpcy5wYXJzZU1heWJlVW5hcnkobnVsbCwgdHJ1ZSwgdXBkYXRlKTtcbiAgICB0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyhyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLCB0cnVlKTtcbiAgICBpZiAodXBkYXRlKSB7IHRoaXMuY2hlY2tMVmFsU2ltcGxlKG5vZGUuYXJndW1lbnQpOyB9XG4gICAgZWxzZSBpZiAodGhpcy5zdHJpY3QgJiYgbm9kZS5vcGVyYXRvciA9PT0gXCJkZWxldGVcIiAmJlxuICAgICAgICAgICAgIG5vZGUuYXJndW1lbnQudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIpXG4gICAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShub2RlLnN0YXJ0LCBcIkRlbGV0aW5nIGxvY2FsIHZhcmlhYmxlIGluIHN0cmljdCBtb2RlXCIpOyB9XG4gICAgZWxzZSBpZiAobm9kZS5vcGVyYXRvciA9PT0gXCJkZWxldGVcIiAmJiBpc1ByaXZhdGVGaWVsZEFjY2Vzcyhub2RlLmFyZ3VtZW50KSlcbiAgICAgIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKG5vZGUuc3RhcnQsIFwiUHJpdmF0ZSBmaWVsZHMgY2FuIG5vdCBiZSBkZWxldGVkXCIpOyB9XG4gICAgZWxzZSB7IHNhd1VuYXJ5ID0gdHJ1ZTsgfVxuICAgIGV4cHIgPSB0aGlzLmZpbmlzaE5vZGUobm9kZSwgdXBkYXRlID8gXCJVcGRhdGVFeHByZXNzaW9uXCIgOiBcIlVuYXJ5RXhwcmVzc2lvblwiKTtcbiAgfSBlbHNlIHtcbiAgICBleHByID0gdGhpcy5wYXJzZUV4cHJTdWJzY3JpcHRzKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpO1xuICAgIGlmICh0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyhyZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSkgeyByZXR1cm4gZXhwciB9XG4gICAgd2hpbGUgKHRoaXMudHlwZS5wb3N0Zml4ICYmICF0aGlzLmNhbkluc2VydFNlbWljb2xvbigpKSB7XG4gICAgICB2YXIgbm9kZSQxID0gdGhpcy5zdGFydE5vZGVBdChzdGFydFBvcywgc3RhcnRMb2MpO1xuICAgICAgbm9kZSQxLm9wZXJhdG9yID0gdGhpcy52YWx1ZTtcbiAgICAgIG5vZGUkMS5wcmVmaXggPSBmYWxzZTtcbiAgICAgIG5vZGUkMS5hcmd1bWVudCA9IGV4cHI7XG4gICAgICB0aGlzLmNoZWNrTFZhbFNpbXBsZShleHByKTtcbiAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgZXhwciA9IHRoaXMuZmluaXNoTm9kZShub2RlJDEsIFwiVXBkYXRlRXhwcmVzc2lvblwiKTtcbiAgICB9XG4gIH1cblxuICBpZiAoIWluY0RlYyAmJiB0aGlzLmVhdCh0eXBlcy5zdGFyc3RhcikpIHtcbiAgICBpZiAoc2F3VW5hcnkpXG4gICAgICB7IHRoaXMudW5leHBlY3RlZCh0aGlzLmxhc3RUb2tTdGFydCk7IH1cbiAgICBlbHNlXG4gICAgICB7IHJldHVybiB0aGlzLmJ1aWxkQmluYXJ5KHN0YXJ0UG9zLCBzdGFydExvYywgZXhwciwgdGhpcy5wYXJzZU1heWJlVW5hcnkobnVsbCwgZmFsc2UpLCBcIioqXCIsIGZhbHNlKSB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGV4cHJcbiAgfVxufTtcblxuZnVuY3Rpb24gaXNQcml2YXRlRmllbGRBY2Nlc3Mobm9kZSkge1xuICByZXR1cm4gKFxuICAgIG5vZGUudHlwZSA9PT0gXCJNZW1iZXJFeHByZXNzaW9uXCIgJiYgbm9kZS5wcm9wZXJ0eS50eXBlID09PSBcIlByaXZhdGVJZGVudGlmaWVyXCIgfHxcbiAgICBub2RlLnR5cGUgPT09IFwiQ2hhaW5FeHByZXNzaW9uXCIgJiYgaXNQcml2YXRlRmllbGRBY2Nlc3Mobm9kZS5leHByZXNzaW9uKVxuICApXG59XG5cbi8vIFBhcnNlIGNhbGwsIGRvdCwgYW5kIGBbXWAtc3Vic2NyaXB0IGV4cHJlc3Npb25zLlxuXG5wcCQzLnBhcnNlRXhwclN1YnNjcmlwdHMgPSBmdW5jdGlvbihyZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7XG4gIHZhciBzdGFydFBvcyA9IHRoaXMuc3RhcnQsIHN0YXJ0TG9jID0gdGhpcy5zdGFydExvYztcbiAgdmFyIGV4cHIgPSB0aGlzLnBhcnNlRXhwckF0b20ocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycyk7XG4gIGlmIChleHByLnR5cGUgPT09IFwiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb25cIiAmJiB0aGlzLmlucHV0LnNsaWNlKHRoaXMubGFzdFRva1N0YXJ0LCB0aGlzLmxhc3RUb2tFbmQpICE9PSBcIilcIilcbiAgICB7IHJldHVybiBleHByIH1cbiAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VTdWJzY3JpcHRzKGV4cHIsIHN0YXJ0UG9zLCBzdGFydExvYyk7XG4gIGlmIChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzICYmIHJlc3VsdC50eXBlID09PSBcIk1lbWJlckV4cHJlc3Npb25cIikge1xuICAgIGlmIChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnBhcmVudGhlc2l6ZWRBc3NpZ24gPj0gcmVzdWx0LnN0YXJ0KSB7IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMucGFyZW50aGVzaXplZEFzc2lnbiA9IC0xOyB9XG4gICAgaWYgKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMucGFyZW50aGVzaXplZEJpbmQgPj0gcmVzdWx0LnN0YXJ0KSB7IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMucGFyZW50aGVzaXplZEJpbmQgPSAtMTsgfVxuICAgIGlmIChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnRyYWlsaW5nQ29tbWEgPj0gcmVzdWx0LnN0YXJ0KSB7IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMudHJhaWxpbmdDb21tYSA9IC0xOyB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdFxufTtcblxucHAkMy5wYXJzZVN1YnNjcmlwdHMgPSBmdW5jdGlvbihiYXNlLCBzdGFydFBvcywgc3RhcnRMb2MsIG5vQ2FsbHMpIHtcbiAgdmFyIG1heWJlQXN5bmNBcnJvdyA9IHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA4ICYmIGJhc2UudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgJiYgYmFzZS5uYW1lID09PSBcImFzeW5jXCIgJiZcbiAgICAgIHRoaXMubGFzdFRva0VuZCA9PT0gYmFzZS5lbmQgJiYgIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCkgJiYgYmFzZS5lbmQgLSBiYXNlLnN0YXJ0ID09PSA1ICYmXG4gICAgICB0aGlzLnBvdGVudGlhbEFycm93QXQgPT09IGJhc2Uuc3RhcnQ7XG4gIHZhciBvcHRpb25hbENoYWluZWQgPSBmYWxzZTtcblxuICB3aGlsZSAodHJ1ZSkge1xuICAgIHZhciBlbGVtZW50ID0gdGhpcy5wYXJzZVN1YnNjcmlwdChiYXNlLCBzdGFydFBvcywgc3RhcnRMb2MsIG5vQ2FsbHMsIG1heWJlQXN5bmNBcnJvdywgb3B0aW9uYWxDaGFpbmVkKTtcblxuICAgIGlmIChlbGVtZW50Lm9wdGlvbmFsKSB7IG9wdGlvbmFsQ2hhaW5lZCA9IHRydWU7IH1cbiAgICBpZiAoZWxlbWVudCA9PT0gYmFzZSB8fCBlbGVtZW50LnR5cGUgPT09IFwiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb25cIikge1xuICAgICAgaWYgKG9wdGlvbmFsQ2hhaW5lZCkge1xuICAgICAgICB2YXIgY2hhaW5Ob2RlID0gdGhpcy5zdGFydE5vZGVBdChzdGFydFBvcywgc3RhcnRMb2MpO1xuICAgICAgICBjaGFpbk5vZGUuZXhwcmVzc2lvbiA9IGVsZW1lbnQ7XG4gICAgICAgIGVsZW1lbnQgPSB0aGlzLmZpbmlzaE5vZGUoY2hhaW5Ob2RlLCBcIkNoYWluRXhwcmVzc2lvblwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlbGVtZW50XG4gICAgfVxuXG4gICAgYmFzZSA9IGVsZW1lbnQ7XG4gIH1cbn07XG5cbnBwJDMucGFyc2VTdWJzY3JpcHQgPSBmdW5jdGlvbihiYXNlLCBzdGFydFBvcywgc3RhcnRMb2MsIG5vQ2FsbHMsIG1heWJlQXN5bmNBcnJvdywgb3B0aW9uYWxDaGFpbmVkKSB7XG4gIHZhciBvcHRpb25hbFN1cHBvcnRlZCA9IHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSAxMTtcbiAgdmFyIG9wdGlvbmFsID0gb3B0aW9uYWxTdXBwb3J0ZWQgJiYgdGhpcy5lYXQodHlwZXMucXVlc3Rpb25Eb3QpO1xuICBpZiAobm9DYWxscyAmJiBvcHRpb25hbCkgeyB0aGlzLnJhaXNlKHRoaXMubGFzdFRva1N0YXJ0LCBcIk9wdGlvbmFsIGNoYWluaW5nIGNhbm5vdCBhcHBlYXIgaW4gdGhlIGNhbGxlZSBvZiBuZXcgZXhwcmVzc2lvbnNcIik7IH1cblxuICB2YXIgY29tcHV0ZWQgPSB0aGlzLmVhdCh0eXBlcy5icmFja2V0TCk7XG4gIGlmIChjb21wdXRlZCB8fCAob3B0aW9uYWwgJiYgdGhpcy50eXBlICE9PSB0eXBlcy5wYXJlbkwgJiYgdGhpcy50eXBlICE9PSB0eXBlcy5iYWNrUXVvdGUpIHx8IHRoaXMuZWF0KHR5cGVzLmRvdCkpIHtcbiAgICB2YXIgbm9kZSA9IHRoaXMuc3RhcnROb2RlQXQoc3RhcnRQb3MsIHN0YXJ0TG9jKTtcbiAgICBub2RlLm9iamVjdCA9IGJhc2U7XG4gICAgaWYgKGNvbXB1dGVkKSB7XG4gICAgICBub2RlLnByb3BlcnR5ID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIHRoaXMuZXhwZWN0KHR5cGVzLmJyYWNrZXRSKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMucHJpdmF0ZUlkICYmIGJhc2UudHlwZSAhPT0gXCJTdXBlclwiKSB7XG4gICAgICBub2RlLnByb3BlcnR5ID0gdGhpcy5wYXJzZVByaXZhdGVJZGVudCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBub2RlLnByb3BlcnR5ID0gdGhpcy5wYXJzZUlkZW50KHRoaXMub3B0aW9ucy5hbGxvd1Jlc2VydmVkICE9PSBcIm5ldmVyXCIpO1xuICAgIH1cbiAgICBub2RlLmNvbXB1dGVkID0gISFjb21wdXRlZDtcbiAgICBpZiAob3B0aW9uYWxTdXBwb3J0ZWQpIHtcbiAgICAgIG5vZGUub3B0aW9uYWwgPSBvcHRpb25hbDtcbiAgICB9XG4gICAgYmFzZSA9IHRoaXMuZmluaXNoTm9kZShub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIik7XG4gIH0gZWxzZSBpZiAoIW5vQ2FsbHMgJiYgdGhpcy5lYXQodHlwZXMucGFyZW5MKSkge1xuICAgIHZhciByZWZEZXN0cnVjdHVyaW5nRXJyb3JzID0gbmV3IERlc3RydWN0dXJpbmdFcnJvcnMsIG9sZFlpZWxkUG9zID0gdGhpcy55aWVsZFBvcywgb2xkQXdhaXRQb3MgPSB0aGlzLmF3YWl0UG9zLCBvbGRBd2FpdElkZW50UG9zID0gdGhpcy5hd2FpdElkZW50UG9zO1xuICAgIHRoaXMueWllbGRQb3MgPSAwO1xuICAgIHRoaXMuYXdhaXRQb3MgPSAwO1xuICAgIHRoaXMuYXdhaXRJZGVudFBvcyA9IDA7XG4gICAgdmFyIGV4cHJMaXN0ID0gdGhpcy5wYXJzZUV4cHJMaXN0KHR5cGVzLnBhcmVuUiwgdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDgsIGZhbHNlLCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKTtcbiAgICBpZiAobWF5YmVBc3luY0Fycm93ICYmICFvcHRpb25hbCAmJiAhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSAmJiB0aGlzLmVhdCh0eXBlcy5hcnJvdykpIHtcbiAgICAgIHRoaXMuY2hlY2tQYXR0ZXJuRXJyb3JzKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMsIGZhbHNlKTtcbiAgICAgIHRoaXMuY2hlY2tZaWVsZEF3YWl0SW5EZWZhdWx0UGFyYW1zKCk7XG4gICAgICBpZiAodGhpcy5hd2FpdElkZW50UG9zID4gMClcbiAgICAgICAgeyB0aGlzLnJhaXNlKHRoaXMuYXdhaXRJZGVudFBvcywgXCJDYW5ub3QgdXNlICdhd2FpdCcgYXMgaWRlbnRpZmllciBpbnNpZGUgYW4gYXN5bmMgZnVuY3Rpb25cIik7IH1cbiAgICAgIHRoaXMueWllbGRQb3MgPSBvbGRZaWVsZFBvcztcbiAgICAgIHRoaXMuYXdhaXRQb3MgPSBvbGRBd2FpdFBvcztcbiAgICAgIHRoaXMuYXdhaXRJZGVudFBvcyA9IG9sZEF3YWl0SWRlbnRQb3M7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZUFycm93RXhwcmVzc2lvbih0aGlzLnN0YXJ0Tm9kZUF0KHN0YXJ0UG9zLCBzdGFydExvYyksIGV4cHJMaXN0LCB0cnVlKVxuICAgIH1cbiAgICB0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyhyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLCB0cnVlKTtcbiAgICB0aGlzLnlpZWxkUG9zID0gb2xkWWllbGRQb3MgfHwgdGhpcy55aWVsZFBvcztcbiAgICB0aGlzLmF3YWl0UG9zID0gb2xkQXdhaXRQb3MgfHwgdGhpcy5hd2FpdFBvcztcbiAgICB0aGlzLmF3YWl0SWRlbnRQb3MgPSBvbGRBd2FpdElkZW50UG9zIHx8IHRoaXMuYXdhaXRJZGVudFBvcztcbiAgICB2YXIgbm9kZSQxID0gdGhpcy5zdGFydE5vZGVBdChzdGFydFBvcywgc3RhcnRMb2MpO1xuICAgIG5vZGUkMS5jYWxsZWUgPSBiYXNlO1xuICAgIG5vZGUkMS5hcmd1bWVudHMgPSBleHByTGlzdDtcbiAgICBpZiAob3B0aW9uYWxTdXBwb3J0ZWQpIHtcbiAgICAgIG5vZGUkMS5vcHRpb25hbCA9IG9wdGlvbmFsO1xuICAgIH1cbiAgICBiYXNlID0gdGhpcy5maW5pc2hOb2RlKG5vZGUkMSwgXCJDYWxsRXhwcmVzc2lvblwiKTtcbiAgfSBlbHNlIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLmJhY2tRdW90ZSkge1xuICAgIGlmIChvcHRpb25hbCB8fCBvcHRpb25hbENoYWluZWQpIHtcbiAgICAgIHRoaXMucmFpc2UodGhpcy5zdGFydCwgXCJPcHRpb25hbCBjaGFpbmluZyBjYW5ub3QgYXBwZWFyIGluIHRoZSB0YWcgb2YgdGFnZ2VkIHRlbXBsYXRlIGV4cHJlc3Npb25zXCIpO1xuICAgIH1cbiAgICB2YXIgbm9kZSQyID0gdGhpcy5zdGFydE5vZGVBdChzdGFydFBvcywgc3RhcnRMb2MpO1xuICAgIG5vZGUkMi50YWcgPSBiYXNlO1xuICAgIG5vZGUkMi5xdWFzaSA9IHRoaXMucGFyc2VUZW1wbGF0ZSh7aXNUYWdnZWQ6IHRydWV9KTtcbiAgICBiYXNlID0gdGhpcy5maW5pc2hOb2RlKG5vZGUkMiwgXCJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb25cIik7XG4gIH1cbiAgcmV0dXJuIGJhc2Vcbn07XG5cbi8vIFBhcnNlIGFuIGF0b21pYyBleHByZXNzaW9uIOKAlCBlaXRoZXIgYSBzaW5nbGUgdG9rZW4gdGhhdCBpcyBhblxuLy8gZXhwcmVzc2lvbiwgYW4gZXhwcmVzc2lvbiBzdGFydGVkIGJ5IGEga2V5d29yZCBsaWtlIGBmdW5jdGlvbmAgb3Jcbi8vIGBuZXdgLCBvciBhbiBleHByZXNzaW9uIHdyYXBwZWQgaW4gcHVuY3R1YXRpb24gbGlrZSBgKClgLCBgW11gLFxuLy8gb3IgYHt9YC5cblxucHAkMy5wYXJzZUV4cHJBdG9tID0gZnVuY3Rpb24ocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycykge1xuICAvLyBJZiBhIGRpdmlzaW9uIG9wZXJhdG9yIGFwcGVhcnMgaW4gYW4gZXhwcmVzc2lvbiBwb3NpdGlvbiwgdGhlXG4gIC8vIHRva2VuaXplciBnb3QgY29uZnVzZWQsIGFuZCB3ZSBmb3JjZSBpdCB0byByZWFkIGEgcmVnZXhwIGluc3RlYWQuXG4gIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLnNsYXNoKSB7IHRoaXMucmVhZFJlZ2V4cCgpOyB9XG5cbiAgdmFyIG5vZGUsIGNhbkJlQXJyb3cgPSB0aGlzLnBvdGVudGlhbEFycm93QXQgPT09IHRoaXMuc3RhcnQ7XG4gIHN3aXRjaCAodGhpcy50eXBlKSB7XG4gIGNhc2UgdHlwZXMuX3N1cGVyOlxuICAgIGlmICghdGhpcy5hbGxvd1N1cGVyKVxuICAgICAgeyB0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIFwiJ3N1cGVyJyBrZXl3b3JkIG91dHNpZGUgYSBtZXRob2RcIik7IH1cbiAgICBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgICB0aGlzLm5leHQoKTtcbiAgICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5wYXJlbkwgJiYgIXRoaXMuYWxsb3dEaXJlY3RTdXBlcilcbiAgICAgIHsgdGhpcy5yYWlzZShub2RlLnN0YXJ0LCBcInN1cGVyKCkgY2FsbCBvdXRzaWRlIGNvbnN0cnVjdG9yIG9mIGEgc3ViY2xhc3NcIik7IH1cbiAgICAvLyBUaGUgYHN1cGVyYCBrZXl3b3JkIGNhbiBhcHBlYXIgYXQgYmVsb3c6XG4gICAgLy8gU3VwZXJQcm9wZXJ0eTpcbiAgICAvLyAgICAgc3VwZXIgWyBFeHByZXNzaW9uIF1cbiAgICAvLyAgICAgc3VwZXIgLiBJZGVudGlmaWVyTmFtZVxuICAgIC8vIFN1cGVyQ2FsbDpcbiAgICAvLyAgICAgc3VwZXIgKCBBcmd1bWVudHMgKVxuICAgIGlmICh0aGlzLnR5cGUgIT09IHR5cGVzLmRvdCAmJiB0aGlzLnR5cGUgIT09IHR5cGVzLmJyYWNrZXRMICYmIHRoaXMudHlwZSAhPT0gdHlwZXMucGFyZW5MKVxuICAgICAgeyB0aGlzLnVuZXhwZWN0ZWQoKTsgfVxuICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJTdXBlclwiKVxuXG4gIGNhc2UgdHlwZXMuX3RoaXM6XG4gICAgbm9kZSA9IHRoaXMuc3RhcnROb2RlKCk7XG4gICAgdGhpcy5uZXh0KCk7XG4gICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIlRoaXNFeHByZXNzaW9uXCIpXG5cbiAgY2FzZSB0eXBlcy5uYW1lOlxuICAgIHZhciBzdGFydFBvcyA9IHRoaXMuc3RhcnQsIHN0YXJ0TG9jID0gdGhpcy5zdGFydExvYywgY29udGFpbnNFc2MgPSB0aGlzLmNvbnRhaW5zRXNjO1xuICAgIHZhciBpZCA9IHRoaXMucGFyc2VJZGVudChmYWxzZSk7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA4ICYmICFjb250YWluc0VzYyAmJiBpZC5uYW1lID09PSBcImFzeW5jXCIgJiYgIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCkgJiYgdGhpcy5lYXQodHlwZXMuX2Z1bmN0aW9uKSlcbiAgICAgIHsgcmV0dXJuIHRoaXMucGFyc2VGdW5jdGlvbih0aGlzLnN0YXJ0Tm9kZUF0KHN0YXJ0UG9zLCBzdGFydExvYyksIDAsIGZhbHNlLCB0cnVlKSB9XG4gICAgaWYgKGNhbkJlQXJyb3cgJiYgIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCkpIHtcbiAgICAgIGlmICh0aGlzLmVhdCh0eXBlcy5hcnJvdykpXG4gICAgICAgIHsgcmV0dXJuIHRoaXMucGFyc2VBcnJvd0V4cHJlc3Npb24odGhpcy5zdGFydE5vZGVBdChzdGFydFBvcywgc3RhcnRMb2MpLCBbaWRdLCBmYWxzZSkgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA4ICYmIGlkLm5hbWUgPT09IFwiYXN5bmNcIiAmJiB0aGlzLnR5cGUgPT09IHR5cGVzLm5hbWUgJiYgIWNvbnRhaW5zRXNjICYmXG4gICAgICAgICAgKCF0aGlzLnBvdGVudGlhbEFycm93SW5Gb3JBd2FpdCB8fCB0aGlzLnZhbHVlICE9PSBcIm9mXCIgfHwgdGhpcy5jb250YWluc0VzYykpIHtcbiAgICAgICAgaWQgPSB0aGlzLnBhcnNlSWRlbnQoZmFsc2UpO1xuICAgICAgICBpZiAodGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSB8fCAhdGhpcy5lYXQodHlwZXMuYXJyb3cpKVxuICAgICAgICAgIHsgdGhpcy51bmV4cGVjdGVkKCk7IH1cbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VBcnJvd0V4cHJlc3Npb24odGhpcy5zdGFydE5vZGVBdChzdGFydFBvcywgc3RhcnRMb2MpLCBbaWRdLCB0cnVlKVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaWRcblxuICBjYXNlIHR5cGVzLnJlZ2V4cDpcbiAgICB2YXIgdmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgIG5vZGUgPSB0aGlzLnBhcnNlTGl0ZXJhbCh2YWx1ZS52YWx1ZSk7XG4gICAgbm9kZS5yZWdleCA9IHtwYXR0ZXJuOiB2YWx1ZS5wYXR0ZXJuLCBmbGFnczogdmFsdWUuZmxhZ3N9O1xuICAgIHJldHVybiBub2RlXG5cbiAgY2FzZSB0eXBlcy5udW06IGNhc2UgdHlwZXMuc3RyaW5nOlxuICAgIHJldHVybiB0aGlzLnBhcnNlTGl0ZXJhbCh0aGlzLnZhbHVlKVxuXG4gIGNhc2UgdHlwZXMuX251bGw6IGNhc2UgdHlwZXMuX3RydWU6IGNhc2UgdHlwZXMuX2ZhbHNlOlxuICAgIG5vZGUgPSB0aGlzLnN0YXJ0Tm9kZSgpO1xuICAgIG5vZGUudmFsdWUgPSB0aGlzLnR5cGUgPT09IHR5cGVzLl9udWxsID8gbnVsbCA6IHRoaXMudHlwZSA9PT0gdHlwZXMuX3RydWU7XG4gICAgbm9kZS5yYXcgPSB0aGlzLnR5cGUua2V5d29yZDtcbiAgICB0aGlzLm5leHQoKTtcbiAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiTGl0ZXJhbFwiKVxuXG4gIGNhc2UgdHlwZXMucGFyZW5MOlxuICAgIHZhciBzdGFydCA9IHRoaXMuc3RhcnQsIGV4cHIgPSB0aGlzLnBhcnNlUGFyZW5BbmREaXN0aW5ndWlzaEV4cHJlc3Npb24oY2FuQmVBcnJvdyk7XG4gICAgaWYgKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpIHtcbiAgICAgIGlmIChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnBhcmVudGhlc2l6ZWRBc3NpZ24gPCAwICYmICF0aGlzLmlzU2ltcGxlQXNzaWduVGFyZ2V0KGV4cHIpKVxuICAgICAgICB7IHJlZkRlc3RydWN0dXJpbmdFcnJvcnMucGFyZW50aGVzaXplZEFzc2lnbiA9IHN0YXJ0OyB9XG4gICAgICBpZiAocmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy5wYXJlbnRoZXNpemVkQmluZCA8IDApXG4gICAgICAgIHsgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy5wYXJlbnRoZXNpemVkQmluZCA9IHN0YXJ0OyB9XG4gICAgfVxuICAgIHJldHVybiBleHByXG5cbiAgY2FzZSB0eXBlcy5icmFja2V0TDpcbiAgICBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgICB0aGlzLm5leHQoKTtcbiAgICBub2RlLmVsZW1lbnRzID0gdGhpcy5wYXJzZUV4cHJMaXN0KHR5cGVzLmJyYWNrZXRSLCB0cnVlLCB0cnVlLCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKTtcbiAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiQXJyYXlFeHByZXNzaW9uXCIpXG5cbiAgY2FzZSB0eXBlcy5icmFjZUw6XG4gICAgcmV0dXJuIHRoaXMucGFyc2VPYmooZmFsc2UsIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpXG5cbiAgY2FzZSB0eXBlcy5fZnVuY3Rpb246XG4gICAgbm9kZSA9IHRoaXMuc3RhcnROb2RlKCk7XG4gICAgdGhpcy5uZXh0KCk7XG4gICAgcmV0dXJuIHRoaXMucGFyc2VGdW5jdGlvbihub2RlLCAwKVxuXG4gIGNhc2UgdHlwZXMuX2NsYXNzOlxuICAgIHJldHVybiB0aGlzLnBhcnNlQ2xhc3ModGhpcy5zdGFydE5vZGUoKSwgZmFsc2UpXG5cbiAgY2FzZSB0eXBlcy5fbmV3OlxuICAgIHJldHVybiB0aGlzLnBhcnNlTmV3KClcblxuICBjYXNlIHR5cGVzLmJhY2tRdW90ZTpcbiAgICByZXR1cm4gdGhpcy5wYXJzZVRlbXBsYXRlKClcblxuICBjYXNlIHR5cGVzLl9pbXBvcnQ6XG4gICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSAxMSkge1xuICAgICAgcmV0dXJuIHRoaXMucGFyc2VFeHBySW1wb3J0KClcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMudW5leHBlY3RlZCgpXG4gICAgfVxuXG4gIGRlZmF1bHQ6XG4gICAgdGhpcy51bmV4cGVjdGVkKCk7XG4gIH1cbn07XG5cbnBwJDMucGFyc2VFeHBySW1wb3J0ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcblxuICAvLyBDb25zdW1lIGBpbXBvcnRgIGFzIGFuIGlkZW50aWZpZXIgZm9yIGBpbXBvcnQubWV0YWAuXG4gIC8vIEJlY2F1c2UgYHRoaXMucGFyc2VJZGVudCh0cnVlKWAgZG9lc24ndCBjaGVjayBlc2NhcGUgc2VxdWVuY2VzLCBpdCBuZWVkcyB0aGUgY2hlY2sgb2YgYHRoaXMuY29udGFpbnNFc2NgLlxuICBpZiAodGhpcy5jb250YWluc0VzYykgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5zdGFydCwgXCJFc2NhcGUgc2VxdWVuY2UgaW4ga2V5d29yZCBpbXBvcnRcIik7IH1cbiAgdmFyIG1ldGEgPSB0aGlzLnBhcnNlSWRlbnQodHJ1ZSk7XG5cbiAgc3dpdGNoICh0aGlzLnR5cGUpIHtcbiAgY2FzZSB0eXBlcy5wYXJlbkw6XG4gICAgcmV0dXJuIHRoaXMucGFyc2VEeW5hbWljSW1wb3J0KG5vZGUpXG4gIGNhc2UgdHlwZXMuZG90OlxuICAgIG5vZGUubWV0YSA9IG1ldGE7XG4gICAgcmV0dXJuIHRoaXMucGFyc2VJbXBvcnRNZXRhKG5vZGUpXG4gIGRlZmF1bHQ6XG4gICAgdGhpcy51bmV4cGVjdGVkKCk7XG4gIH1cbn07XG5cbnBwJDMucGFyc2VEeW5hbWljSW1wb3J0ID0gZnVuY3Rpb24obm9kZSkge1xuICB0aGlzLm5leHQoKTsgLy8gc2tpcCBgKGBcblxuICAvLyBQYXJzZSBub2RlLnNvdXJjZS5cbiAgbm9kZS5zb3VyY2UgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oKTtcblxuICAvLyBWZXJpZnkgZW5kaW5nLlxuICBpZiAoIXRoaXMuZWF0KHR5cGVzLnBhcmVuUikpIHtcbiAgICB2YXIgZXJyb3JQb3MgPSB0aGlzLnN0YXJ0O1xuICAgIGlmICh0aGlzLmVhdCh0eXBlcy5jb21tYSkgJiYgdGhpcy5lYXQodHlwZXMucGFyZW5SKSkge1xuICAgICAgdGhpcy5yYWlzZVJlY292ZXJhYmxlKGVycm9yUG9zLCBcIlRyYWlsaW5nIGNvbW1hIGlzIG5vdCBhbGxvd2VkIGluIGltcG9ydCgpXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVuZXhwZWN0ZWQoZXJyb3JQb3MpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJJbXBvcnRFeHByZXNzaW9uXCIpXG59O1xuXG5wcCQzLnBhcnNlSW1wb3J0TWV0YSA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpcy5uZXh0KCk7IC8vIHNraXAgYC5gXG5cbiAgdmFyIGNvbnRhaW5zRXNjID0gdGhpcy5jb250YWluc0VzYztcbiAgbm9kZS5wcm9wZXJ0eSA9IHRoaXMucGFyc2VJZGVudCh0cnVlKTtcblxuICBpZiAobm9kZS5wcm9wZXJ0eS5uYW1lICE9PSBcIm1ldGFcIilcbiAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShub2RlLnByb3BlcnR5LnN0YXJ0LCBcIlRoZSBvbmx5IHZhbGlkIG1ldGEgcHJvcGVydHkgZm9yIGltcG9ydCBpcyAnaW1wb3J0Lm1ldGEnXCIpOyB9XG4gIGlmIChjb250YWluc0VzYylcbiAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShub2RlLnN0YXJ0LCBcIidpbXBvcnQubWV0YScgbXVzdCBub3QgY29udGFpbiBlc2NhcGVkIGNoYXJhY3RlcnNcIik7IH1cbiAgaWYgKHRoaXMub3B0aW9ucy5zb3VyY2VUeXBlICE9PSBcIm1vZHVsZVwiICYmICF0aGlzLm9wdGlvbnMuYWxsb3dJbXBvcnRFeHBvcnRFdmVyeXdoZXJlKVxuICAgIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKG5vZGUuc3RhcnQsIFwiQ2Fubm90IHVzZSAnaW1wb3J0Lm1ldGEnIG91dHNpZGUgYSBtb2R1bGVcIik7IH1cblxuICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKG5vZGUsIFwiTWV0YVByb3BlcnR5XCIpXG59O1xuXG5wcCQzLnBhcnNlTGl0ZXJhbCA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgbm9kZS52YWx1ZSA9IHZhbHVlO1xuICBub2RlLnJhdyA9IHRoaXMuaW5wdXQuc2xpY2UodGhpcy5zdGFydCwgdGhpcy5lbmQpO1xuICBpZiAobm9kZS5yYXcuY2hhckNvZGVBdChub2RlLnJhdy5sZW5ndGggLSAxKSA9PT0gMTEwKSB7IG5vZGUuYmlnaW50ID0gbm9kZS5yYXcuc2xpY2UoMCwgLTEpLnJlcGxhY2UoL18vZywgXCJcIik7IH1cbiAgdGhpcy5uZXh0KCk7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJMaXRlcmFsXCIpXG59O1xuXG5wcCQzLnBhcnNlUGFyZW5FeHByZXNzaW9uID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZXhwZWN0KHR5cGVzLnBhcmVuTCk7XG4gIHZhciB2YWwgPSB0aGlzLnBhcnNlRXhwcmVzc2lvbigpO1xuICB0aGlzLmV4cGVjdCh0eXBlcy5wYXJlblIpO1xuICByZXR1cm4gdmFsXG59O1xuXG5wcCQzLnBhcnNlUGFyZW5BbmREaXN0aW5ndWlzaEV4cHJlc3Npb24gPSBmdW5jdGlvbihjYW5CZUFycm93KSB7XG4gIHZhciBzdGFydFBvcyA9IHRoaXMuc3RhcnQsIHN0YXJ0TG9jID0gdGhpcy5zdGFydExvYywgdmFsLCBhbGxvd1RyYWlsaW5nQ29tbWEgPSB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gODtcbiAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2KSB7XG4gICAgdGhpcy5uZXh0KCk7XG5cbiAgICB2YXIgaW5uZXJTdGFydFBvcyA9IHRoaXMuc3RhcnQsIGlubmVyU3RhcnRMb2MgPSB0aGlzLnN0YXJ0TG9jO1xuICAgIHZhciBleHByTGlzdCA9IFtdLCBmaXJzdCA9IHRydWUsIGxhc3RJc0NvbW1hID0gZmFsc2U7XG4gICAgdmFyIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMgPSBuZXcgRGVzdHJ1Y3R1cmluZ0Vycm9ycywgb2xkWWllbGRQb3MgPSB0aGlzLnlpZWxkUG9zLCBvbGRBd2FpdFBvcyA9IHRoaXMuYXdhaXRQb3MsIHNwcmVhZFN0YXJ0O1xuICAgIHRoaXMueWllbGRQb3MgPSAwO1xuICAgIHRoaXMuYXdhaXRQb3MgPSAwO1xuICAgIC8vIERvIG5vdCBzYXZlIGF3YWl0SWRlbnRQb3MgdG8gYWxsb3cgY2hlY2tpbmcgYXdhaXRzIG5lc3RlZCBpbiBwYXJhbWV0ZXJzXG4gICAgd2hpbGUgKHRoaXMudHlwZSAhPT0gdHlwZXMucGFyZW5SKSB7XG4gICAgICBmaXJzdCA/IGZpcnN0ID0gZmFsc2UgOiB0aGlzLmV4cGVjdCh0eXBlcy5jb21tYSk7XG4gICAgICBpZiAoYWxsb3dUcmFpbGluZ0NvbW1hICYmIHRoaXMuYWZ0ZXJUcmFpbGluZ0NvbW1hKHR5cGVzLnBhcmVuUiwgdHJ1ZSkpIHtcbiAgICAgICAgbGFzdElzQ29tbWEgPSB0cnVlO1xuICAgICAgICBicmVha1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLmVsbGlwc2lzKSB7XG4gICAgICAgIHNwcmVhZFN0YXJ0ID0gdGhpcy5zdGFydDtcbiAgICAgICAgZXhwckxpc3QucHVzaCh0aGlzLnBhcnNlUGFyZW5JdGVtKHRoaXMucGFyc2VSZXN0QmluZGluZygpKSk7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLmNvbW1hKSB7IHRoaXMucmFpc2UodGhpcy5zdGFydCwgXCJDb21tYSBpcyBub3QgcGVybWl0dGVkIGFmdGVyIHRoZSByZXN0IGVsZW1lbnRcIik7IH1cbiAgICAgICAgYnJlYWtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGV4cHJMaXN0LnB1c2godGhpcy5wYXJzZU1heWJlQXNzaWduKGZhbHNlLCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzLCB0aGlzLnBhcnNlUGFyZW5JdGVtKSk7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBpbm5lckVuZFBvcyA9IHRoaXMuc3RhcnQsIGlubmVyRW5kTG9jID0gdGhpcy5zdGFydExvYztcbiAgICB0aGlzLmV4cGVjdCh0eXBlcy5wYXJlblIpO1xuXG4gICAgaWYgKGNhbkJlQXJyb3cgJiYgIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCkgJiYgdGhpcy5lYXQodHlwZXMuYXJyb3cpKSB7XG4gICAgICB0aGlzLmNoZWNrUGF0dGVybkVycm9ycyhyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLCBmYWxzZSk7XG4gICAgICB0aGlzLmNoZWNrWWllbGRBd2FpdEluRGVmYXVsdFBhcmFtcygpO1xuICAgICAgdGhpcy55aWVsZFBvcyA9IG9sZFlpZWxkUG9zO1xuICAgICAgdGhpcy5hd2FpdFBvcyA9IG9sZEF3YWl0UG9zO1xuICAgICAgcmV0dXJuIHRoaXMucGFyc2VQYXJlbkFycm93TGlzdChzdGFydFBvcywgc3RhcnRMb2MsIGV4cHJMaXN0KVxuICAgIH1cblxuICAgIGlmICghZXhwckxpc3QubGVuZ3RoIHx8IGxhc3RJc0NvbW1hKSB7IHRoaXMudW5leHBlY3RlZCh0aGlzLmxhc3RUb2tTdGFydCk7IH1cbiAgICBpZiAoc3ByZWFkU3RhcnQpIHsgdGhpcy51bmV4cGVjdGVkKHNwcmVhZFN0YXJ0KTsgfVxuICAgIHRoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMsIHRydWUpO1xuICAgIHRoaXMueWllbGRQb3MgPSBvbGRZaWVsZFBvcyB8fCB0aGlzLnlpZWxkUG9zO1xuICAgIHRoaXMuYXdhaXRQb3MgPSBvbGRBd2FpdFBvcyB8fCB0aGlzLmF3YWl0UG9zO1xuXG4gICAgaWYgKGV4cHJMaXN0Lmxlbmd0aCA+IDEpIHtcbiAgICAgIHZhbCA9IHRoaXMuc3RhcnROb2RlQXQoaW5uZXJTdGFydFBvcywgaW5uZXJTdGFydExvYyk7XG4gICAgICB2YWwuZXhwcmVzc2lvbnMgPSBleHByTGlzdDtcbiAgICAgIHRoaXMuZmluaXNoTm9kZUF0KHZhbCwgXCJTZXF1ZW5jZUV4cHJlc3Npb25cIiwgaW5uZXJFbmRQb3MsIGlubmVyRW5kTG9jKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFsID0gZXhwckxpc3RbMF07XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHZhbCA9IHRoaXMucGFyc2VQYXJlbkV4cHJlc3Npb24oKTtcbiAgfVxuXG4gIGlmICh0aGlzLm9wdGlvbnMucHJlc2VydmVQYXJlbnMpIHtcbiAgICB2YXIgcGFyID0gdGhpcy5zdGFydE5vZGVBdChzdGFydFBvcywgc3RhcnRMb2MpO1xuICAgIHBhci5leHByZXNzaW9uID0gdmFsO1xuICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGUocGFyLCBcIlBhcmVudGhlc2l6ZWRFeHByZXNzaW9uXCIpXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHZhbFxuICB9XG59O1xuXG5wcCQzLnBhcnNlUGFyZW5JdGVtID0gZnVuY3Rpb24oaXRlbSkge1xuICByZXR1cm4gaXRlbVxufTtcblxucHAkMy5wYXJzZVBhcmVuQXJyb3dMaXN0ID0gZnVuY3Rpb24oc3RhcnRQb3MsIHN0YXJ0TG9jLCBleHByTGlzdCkge1xuICByZXR1cm4gdGhpcy5wYXJzZUFycm93RXhwcmVzc2lvbih0aGlzLnN0YXJ0Tm9kZUF0KHN0YXJ0UG9zLCBzdGFydExvYyksIGV4cHJMaXN0KVxufTtcblxuLy8gTmV3J3MgcHJlY2VkZW5jZSBpcyBzbGlnaHRseSB0cmlja3kuIEl0IG11c3QgYWxsb3cgaXRzIGFyZ3VtZW50IHRvXG4vLyBiZSBhIGBbXWAgb3IgZG90IHN1YnNjcmlwdCBleHByZXNzaW9uLCBidXQgbm90IGEgY2FsbCDigJQgYXQgbGVhc3QsXG4vLyBub3Qgd2l0aG91dCB3cmFwcGluZyBpdCBpbiBwYXJlbnRoZXNlcy4gVGh1cywgaXQgdXNlcyB0aGUgbm9DYWxsc1xuLy8gYXJndW1lbnQgdG8gcGFyc2VTdWJzY3JpcHRzIHRvIHByZXZlbnQgaXQgZnJvbSBjb25zdW1pbmcgdGhlXG4vLyBhcmd1bWVudCBsaXN0LlxuXG52YXIgZW1wdHkkMSA9IFtdO1xuXG5wcCQzLnBhcnNlTmV3ID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLmNvbnRhaW5zRXNjKSB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnN0YXJ0LCBcIkVzY2FwZSBzZXF1ZW5jZSBpbiBrZXl3b3JkIG5ld1wiKTsgfVxuICB2YXIgbm9kZSA9IHRoaXMuc3RhcnROb2RlKCk7XG4gIHZhciBtZXRhID0gdGhpcy5wYXJzZUlkZW50KHRydWUpO1xuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDYgJiYgdGhpcy5lYXQodHlwZXMuZG90KSkge1xuICAgIG5vZGUubWV0YSA9IG1ldGE7XG4gICAgdmFyIGNvbnRhaW5zRXNjID0gdGhpcy5jb250YWluc0VzYztcbiAgICBub2RlLnByb3BlcnR5ID0gdGhpcy5wYXJzZUlkZW50KHRydWUpO1xuICAgIGlmIChub2RlLnByb3BlcnR5Lm5hbWUgIT09IFwidGFyZ2V0XCIpXG4gICAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShub2RlLnByb3BlcnR5LnN0YXJ0LCBcIlRoZSBvbmx5IHZhbGlkIG1ldGEgcHJvcGVydHkgZm9yIG5ldyBpcyAnbmV3LnRhcmdldCdcIik7IH1cbiAgICBpZiAoY29udGFpbnNFc2MpXG4gICAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShub2RlLnN0YXJ0LCBcIiduZXcudGFyZ2V0JyBtdXN0IG5vdCBjb250YWluIGVzY2FwZWQgY2hhcmFjdGVyc1wiKTsgfVxuICAgIGlmICghdGhpcy5pbk5vbkFycm93RnVuY3Rpb24pXG4gICAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShub2RlLnN0YXJ0LCBcIiduZXcudGFyZ2V0JyBjYW4gb25seSBiZSB1c2VkIGluIGZ1bmN0aW9uc1wiKTsgfVxuICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJNZXRhUHJvcGVydHlcIilcbiAgfVxuICB2YXIgc3RhcnRQb3MgPSB0aGlzLnN0YXJ0LCBzdGFydExvYyA9IHRoaXMuc3RhcnRMb2MsIGlzSW1wb3J0ID0gdGhpcy50eXBlID09PSB0eXBlcy5faW1wb3J0O1xuICBub2RlLmNhbGxlZSA9IHRoaXMucGFyc2VTdWJzY3JpcHRzKHRoaXMucGFyc2VFeHByQXRvbSgpLCBzdGFydFBvcywgc3RhcnRMb2MsIHRydWUpO1xuICBpZiAoaXNJbXBvcnQgJiYgbm9kZS5jYWxsZWUudHlwZSA9PT0gXCJJbXBvcnRFeHByZXNzaW9uXCIpIHtcbiAgICB0aGlzLnJhaXNlKHN0YXJ0UG9zLCBcIkNhbm5vdCB1c2UgbmV3IHdpdGggaW1wb3J0KClcIik7XG4gIH1cbiAgaWYgKHRoaXMuZWF0KHR5cGVzLnBhcmVuTCkpIHsgbm9kZS5hcmd1bWVudHMgPSB0aGlzLnBhcnNlRXhwckxpc3QodHlwZXMucGFyZW5SLCB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gOCwgZmFsc2UpOyB9XG4gIGVsc2UgeyBub2RlLmFyZ3VtZW50cyA9IGVtcHR5JDE7IH1cbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIk5ld0V4cHJlc3Npb25cIilcbn07XG5cbi8vIFBhcnNlIHRlbXBsYXRlIGV4cHJlc3Npb24uXG5cbnBwJDMucGFyc2VUZW1wbGF0ZUVsZW1lbnQgPSBmdW5jdGlvbihyZWYpIHtcbiAgdmFyIGlzVGFnZ2VkID0gcmVmLmlzVGFnZ2VkO1xuXG4gIHZhciBlbGVtID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuaW52YWxpZFRlbXBsYXRlKSB7XG4gICAgaWYgKCFpc1RhZ2dlZCkge1xuICAgICAgdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIFwiQmFkIGVzY2FwZSBzZXF1ZW5jZSBpbiB1bnRhZ2dlZCB0ZW1wbGF0ZSBsaXRlcmFsXCIpO1xuICAgIH1cbiAgICBlbGVtLnZhbHVlID0ge1xuICAgICAgcmF3OiB0aGlzLnZhbHVlLFxuICAgICAgY29va2VkOiBudWxsXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBlbGVtLnZhbHVlID0ge1xuICAgICAgcmF3OiB0aGlzLmlucHV0LnNsaWNlKHRoaXMuc3RhcnQsIHRoaXMuZW5kKS5yZXBsYWNlKC9cXHJcXG4/L2csIFwiXFxuXCIpLFxuICAgICAgY29va2VkOiB0aGlzLnZhbHVlXG4gICAgfTtcbiAgfVxuICB0aGlzLm5leHQoKTtcbiAgZWxlbS50YWlsID0gdGhpcy50eXBlID09PSB0eXBlcy5iYWNrUXVvdGU7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUoZWxlbSwgXCJUZW1wbGF0ZUVsZW1lbnRcIilcbn07XG5cbnBwJDMucGFyc2VUZW1wbGF0ZSA9IGZ1bmN0aW9uKHJlZikge1xuICBpZiAoIHJlZiA9PT0gdm9pZCAwICkgcmVmID0ge307XG4gIHZhciBpc1RhZ2dlZCA9IHJlZi5pc1RhZ2dlZDsgaWYgKCBpc1RhZ2dlZCA9PT0gdm9pZCAwICkgaXNUYWdnZWQgPSBmYWxzZTtcblxuICB2YXIgbm9kZSA9IHRoaXMuc3RhcnROb2RlKCk7XG4gIHRoaXMubmV4dCgpO1xuICBub2RlLmV4cHJlc3Npb25zID0gW107XG4gIHZhciBjdXJFbHQgPSB0aGlzLnBhcnNlVGVtcGxhdGVFbGVtZW50KHtpc1RhZ2dlZDogaXNUYWdnZWR9KTtcbiAgbm9kZS5xdWFzaXMgPSBbY3VyRWx0XTtcbiAgd2hpbGUgKCFjdXJFbHQudGFpbCkge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLmVvZikgeyB0aGlzLnJhaXNlKHRoaXMucG9zLCBcIlVudGVybWluYXRlZCB0ZW1wbGF0ZSBsaXRlcmFsXCIpOyB9XG4gICAgdGhpcy5leHBlY3QodHlwZXMuZG9sbGFyQnJhY2VMKTtcbiAgICBub2RlLmV4cHJlc3Npb25zLnB1c2godGhpcy5wYXJzZUV4cHJlc3Npb24oKSk7XG4gICAgdGhpcy5leHBlY3QodHlwZXMuYnJhY2VSKTtcbiAgICBub2RlLnF1YXNpcy5wdXNoKGN1ckVsdCA9IHRoaXMucGFyc2VUZW1wbGF0ZUVsZW1lbnQoe2lzVGFnZ2VkOiBpc1RhZ2dlZH0pKTtcbiAgfVxuICB0aGlzLm5leHQoKTtcbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIlRlbXBsYXRlTGl0ZXJhbFwiKVxufTtcblxucHAkMy5pc0FzeW5jUHJvcCA9IGZ1bmN0aW9uKHByb3ApIHtcbiAgcmV0dXJuICFwcm9wLmNvbXB1dGVkICYmIHByb3Aua2V5LnR5cGUgPT09IFwiSWRlbnRpZmllclwiICYmIHByb3Aua2V5Lm5hbWUgPT09IFwiYXN5bmNcIiAmJlxuICAgICh0aGlzLnR5cGUgPT09IHR5cGVzLm5hbWUgfHwgdGhpcy50eXBlID09PSB0eXBlcy5udW0gfHwgdGhpcy50eXBlID09PSB0eXBlcy5zdHJpbmcgfHwgdGhpcy50eXBlID09PSB0eXBlcy5icmFja2V0TCB8fCB0aGlzLnR5cGUua2V5d29yZCB8fCAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDkgJiYgdGhpcy50eXBlID09PSB0eXBlcy5zdGFyKSkgJiZcbiAgICAhbGluZUJyZWFrLnRlc3QodGhpcy5pbnB1dC5zbGljZSh0aGlzLmxhc3RUb2tFbmQsIHRoaXMuc3RhcnQpKVxufTtcblxuLy8gUGFyc2UgYW4gb2JqZWN0IGxpdGVyYWwgb3IgYmluZGluZyBwYXR0ZXJuLlxuXG5wcCQzLnBhcnNlT2JqID0gZnVuY3Rpb24oaXNQYXR0ZXJuLCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7XG4gIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKSwgZmlyc3QgPSB0cnVlLCBwcm9wSGFzaCA9IHt9O1xuICBub2RlLnByb3BlcnRpZXMgPSBbXTtcbiAgdGhpcy5uZXh0KCk7XG4gIHdoaWxlICghdGhpcy5lYXQodHlwZXMuYnJhY2VSKSkge1xuICAgIGlmICghZmlyc3QpIHtcbiAgICAgIHRoaXMuZXhwZWN0KHR5cGVzLmNvbW1hKTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNSAmJiB0aGlzLmFmdGVyVHJhaWxpbmdDb21tYSh0eXBlcy5icmFjZVIpKSB7IGJyZWFrIH1cbiAgICB9IGVsc2UgeyBmaXJzdCA9IGZhbHNlOyB9XG5cbiAgICB2YXIgcHJvcCA9IHRoaXMucGFyc2VQcm9wZXJ0eShpc1BhdHRlcm4sIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpO1xuICAgIGlmICghaXNQYXR0ZXJuKSB7IHRoaXMuY2hlY2tQcm9wQ2xhc2gocHJvcCwgcHJvcEhhc2gsIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMpOyB9XG4gICAgbm9kZS5wcm9wZXJ0aWVzLnB1c2gocHJvcCk7XG4gIH1cbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBpc1BhdHRlcm4gPyBcIk9iamVjdFBhdHRlcm5cIiA6IFwiT2JqZWN0RXhwcmVzc2lvblwiKVxufTtcblxucHAkMy5wYXJzZVByb3BlcnR5ID0gZnVuY3Rpb24oaXNQYXR0ZXJuLCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKSB7XG4gIHZhciBwcm9wID0gdGhpcy5zdGFydE5vZGUoKSwgaXNHZW5lcmF0b3IsIGlzQXN5bmMsIHN0YXJ0UG9zLCBzdGFydExvYztcbiAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA5ICYmIHRoaXMuZWF0KHR5cGVzLmVsbGlwc2lzKSkge1xuICAgIGlmIChpc1BhdHRlcm4pIHtcbiAgICAgIHByb3AuYXJndW1lbnQgPSB0aGlzLnBhcnNlSWRlbnQoZmFsc2UpO1xuICAgICAgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuY29tbWEpIHtcbiAgICAgICAgdGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCBcIkNvbW1hIGlzIG5vdCBwZXJtaXR0ZWQgYWZ0ZXIgdGhlIHJlc3QgZWxlbWVudFwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGUocHJvcCwgXCJSZXN0RWxlbWVudFwiKVxuICAgIH1cbiAgICAvLyBUbyBkaXNhbGxvdyBwYXJlbnRoZXNpemVkIGlkZW50aWZpZXIgdmlhIGB0aGlzLnRvQXNzaWduYWJsZSgpYC5cbiAgICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5wYXJlbkwgJiYgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycykge1xuICAgICAgaWYgKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMucGFyZW50aGVzaXplZEFzc2lnbiA8IDApIHtcbiAgICAgICAgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy5wYXJlbnRoZXNpemVkQXNzaWduID0gdGhpcy5zdGFydDtcbiAgICAgIH1cbiAgICAgIGlmIChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnBhcmVudGhlc2l6ZWRCaW5kIDwgMCkge1xuICAgICAgICByZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnBhcmVudGhlc2l6ZWRCaW5kID0gdGhpcy5zdGFydDtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gUGFyc2UgYXJndW1lbnQuXG4gICAgcHJvcC5hcmd1bWVudCA9IHRoaXMucGFyc2VNYXliZUFzc2lnbihmYWxzZSwgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycyk7XG4gICAgLy8gVG8gZGlzYWxsb3cgdHJhaWxpbmcgY29tbWEgdmlhIGB0aGlzLnRvQXNzaWduYWJsZSgpYC5cbiAgICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5jb21tYSAmJiByZWZEZXN0cnVjdHVyaW5nRXJyb3JzICYmIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMudHJhaWxpbmdDb21tYSA8IDApIHtcbiAgICAgIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMudHJhaWxpbmdDb21tYSA9IHRoaXMuc3RhcnQ7XG4gICAgfVxuICAgIC8vIEZpbmlzaFxuICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGUocHJvcCwgXCJTcHJlYWRFbGVtZW50XCIpXG4gIH1cbiAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2KSB7XG4gICAgcHJvcC5tZXRob2QgPSBmYWxzZTtcbiAgICBwcm9wLnNob3J0aGFuZCA9IGZhbHNlO1xuICAgIGlmIChpc1BhdHRlcm4gfHwgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycykge1xuICAgICAgc3RhcnRQb3MgPSB0aGlzLnN0YXJ0O1xuICAgICAgc3RhcnRMb2MgPSB0aGlzLnN0YXJ0TG9jO1xuICAgIH1cbiAgICBpZiAoIWlzUGF0dGVybilcbiAgICAgIHsgaXNHZW5lcmF0b3IgPSB0aGlzLmVhdCh0eXBlcy5zdGFyKTsgfVxuICB9XG4gIHZhciBjb250YWluc0VzYyA9IHRoaXMuY29udGFpbnNFc2M7XG4gIHRoaXMucGFyc2VQcm9wZXJ0eU5hbWUocHJvcCk7XG4gIGlmICghaXNQYXR0ZXJuICYmICFjb250YWluc0VzYyAmJiB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gOCAmJiAhaXNHZW5lcmF0b3IgJiYgdGhpcy5pc0FzeW5jUHJvcChwcm9wKSkge1xuICAgIGlzQXN5bmMgPSB0cnVlO1xuICAgIGlzR2VuZXJhdG9yID0gdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDkgJiYgdGhpcy5lYXQodHlwZXMuc3Rhcik7XG4gICAgdGhpcy5wYXJzZVByb3BlcnR5TmFtZShwcm9wLCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKTtcbiAgfSBlbHNlIHtcbiAgICBpc0FzeW5jID0gZmFsc2U7XG4gIH1cbiAgdGhpcy5wYXJzZVByb3BlcnR5VmFsdWUocHJvcCwgaXNQYXR0ZXJuLCBpc0dlbmVyYXRvciwgaXNBc3luYywgc3RhcnRQb3MsIHN0YXJ0TG9jLCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzLCBjb250YWluc0VzYyk7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUocHJvcCwgXCJQcm9wZXJ0eVwiKVxufTtcblxucHAkMy5wYXJzZVByb3BlcnR5VmFsdWUgPSBmdW5jdGlvbihwcm9wLCBpc1BhdHRlcm4sIGlzR2VuZXJhdG9yLCBpc0FzeW5jLCBzdGFydFBvcywgc3RhcnRMb2MsIHJlZkRlc3RydWN0dXJpbmdFcnJvcnMsIGNvbnRhaW5zRXNjKSB7XG4gIGlmICgoaXNHZW5lcmF0b3IgfHwgaXNBc3luYykgJiYgdGhpcy50eXBlID09PSB0eXBlcy5jb2xvbilcbiAgICB7IHRoaXMudW5leHBlY3RlZCgpOyB9XG5cbiAgaWYgKHRoaXMuZWF0KHR5cGVzLmNvbG9uKSkge1xuICAgIHByb3AudmFsdWUgPSBpc1BhdHRlcm4gPyB0aGlzLnBhcnNlTWF5YmVEZWZhdWx0KHRoaXMuc3RhcnQsIHRoaXMuc3RhcnRMb2MpIDogdGhpcy5wYXJzZU1heWJlQXNzaWduKGZhbHNlLCByZWZEZXN0cnVjdHVyaW5nRXJyb3JzKTtcbiAgICBwcm9wLmtpbmQgPSBcImluaXRcIjtcbiAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNiAmJiB0aGlzLnR5cGUgPT09IHR5cGVzLnBhcmVuTCkge1xuICAgIGlmIChpc1BhdHRlcm4pIHsgdGhpcy51bmV4cGVjdGVkKCk7IH1cbiAgICBwcm9wLmtpbmQgPSBcImluaXRcIjtcbiAgICBwcm9wLm1ldGhvZCA9IHRydWU7XG4gICAgcHJvcC52YWx1ZSA9IHRoaXMucGFyc2VNZXRob2QoaXNHZW5lcmF0b3IsIGlzQXN5bmMpO1xuICB9IGVsc2UgaWYgKCFpc1BhdHRlcm4gJiYgIWNvbnRhaW5zRXNjICYmXG4gICAgICAgICAgICAgdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDUgJiYgIXByb3AuY29tcHV0ZWQgJiYgcHJvcC5rZXkudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgJiZcbiAgICAgICAgICAgICAocHJvcC5rZXkubmFtZSA9PT0gXCJnZXRcIiB8fCBwcm9wLmtleS5uYW1lID09PSBcInNldFwiKSAmJlxuICAgICAgICAgICAgICh0aGlzLnR5cGUgIT09IHR5cGVzLmNvbW1hICYmIHRoaXMudHlwZSAhPT0gdHlwZXMuYnJhY2VSICYmIHRoaXMudHlwZSAhPT0gdHlwZXMuZXEpKSB7XG4gICAgaWYgKGlzR2VuZXJhdG9yIHx8IGlzQXN5bmMpIHsgdGhpcy51bmV4cGVjdGVkKCk7IH1cbiAgICBwcm9wLmtpbmQgPSBwcm9wLmtleS5uYW1lO1xuICAgIHRoaXMucGFyc2VQcm9wZXJ0eU5hbWUocHJvcCk7XG4gICAgcHJvcC52YWx1ZSA9IHRoaXMucGFyc2VNZXRob2QoZmFsc2UpO1xuICAgIHZhciBwYXJhbUNvdW50ID0gcHJvcC5raW5kID09PSBcImdldFwiID8gMCA6IDE7XG4gICAgaWYgKHByb3AudmFsdWUucGFyYW1zLmxlbmd0aCAhPT0gcGFyYW1Db3VudCkge1xuICAgICAgdmFyIHN0YXJ0ID0gcHJvcC52YWx1ZS5zdGFydDtcbiAgICAgIGlmIChwcm9wLmtpbmQgPT09IFwiZ2V0XCIpXG4gICAgICAgIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKHN0YXJ0LCBcImdldHRlciBzaG91bGQgaGF2ZSBubyBwYXJhbXNcIik7IH1cbiAgICAgIGVsc2VcbiAgICAgICAgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUoc3RhcnQsIFwic2V0dGVyIHNob3VsZCBoYXZlIGV4YWN0bHkgb25lIHBhcmFtXCIpOyB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwcm9wLmtpbmQgPT09IFwic2V0XCIgJiYgcHJvcC52YWx1ZS5wYXJhbXNbMF0udHlwZSA9PT0gXCJSZXN0RWxlbWVudFwiKVxuICAgICAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShwcm9wLnZhbHVlLnBhcmFtc1swXS5zdGFydCwgXCJTZXR0ZXIgY2Fubm90IHVzZSByZXN0IHBhcmFtc1wiKTsgfVxuICAgIH1cbiAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNiAmJiAhcHJvcC5jb21wdXRlZCAmJiBwcm9wLmtleS50eXBlID09PSBcIklkZW50aWZpZXJcIikge1xuICAgIGlmIChpc0dlbmVyYXRvciB8fCBpc0FzeW5jKSB7IHRoaXMudW5leHBlY3RlZCgpOyB9XG4gICAgdGhpcy5jaGVja1VucmVzZXJ2ZWQocHJvcC5rZXkpO1xuICAgIGlmIChwcm9wLmtleS5uYW1lID09PSBcImF3YWl0XCIgJiYgIXRoaXMuYXdhaXRJZGVudFBvcylcbiAgICAgIHsgdGhpcy5hd2FpdElkZW50UG9zID0gc3RhcnRQb3M7IH1cbiAgICBwcm9wLmtpbmQgPSBcImluaXRcIjtcbiAgICBpZiAoaXNQYXR0ZXJuKSB7XG4gICAgICBwcm9wLnZhbHVlID0gdGhpcy5wYXJzZU1heWJlRGVmYXVsdChzdGFydFBvcywgc3RhcnRMb2MsIHRoaXMuY29weU5vZGUocHJvcC5rZXkpKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gdHlwZXMuZXEgJiYgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycykge1xuICAgICAgaWYgKHJlZkRlc3RydWN0dXJpbmdFcnJvcnMuc2hvcnRoYW5kQXNzaWduIDwgMClcbiAgICAgICAgeyByZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnNob3J0aGFuZEFzc2lnbiA9IHRoaXMuc3RhcnQ7IH1cbiAgICAgIHByb3AudmFsdWUgPSB0aGlzLnBhcnNlTWF5YmVEZWZhdWx0KHN0YXJ0UG9zLCBzdGFydExvYywgdGhpcy5jb3B5Tm9kZShwcm9wLmtleSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwcm9wLnZhbHVlID0gdGhpcy5jb3B5Tm9kZShwcm9wLmtleSk7XG4gICAgfVxuICAgIHByb3Auc2hvcnRoYW5kID0gdHJ1ZTtcbiAgfSBlbHNlIHsgdGhpcy51bmV4cGVjdGVkKCk7IH1cbn07XG5cbnBwJDMucGFyc2VQcm9wZXJ0eU5hbWUgPSBmdW5jdGlvbihwcm9wKSB7XG4gIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNikge1xuICAgIGlmICh0aGlzLmVhdCh0eXBlcy5icmFja2V0TCkpIHtcbiAgICAgIHByb3AuY29tcHV0ZWQgPSB0cnVlO1xuICAgICAgcHJvcC5rZXkgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oKTtcbiAgICAgIHRoaXMuZXhwZWN0KHR5cGVzLmJyYWNrZXRSKTtcbiAgICAgIHJldHVybiBwcm9wLmtleVxuICAgIH0gZWxzZSB7XG4gICAgICBwcm9wLmNvbXB1dGVkID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiBwcm9wLmtleSA9IHRoaXMudHlwZSA9PT0gdHlwZXMubnVtIHx8IHRoaXMudHlwZSA9PT0gdHlwZXMuc3RyaW5nID8gdGhpcy5wYXJzZUV4cHJBdG9tKCkgOiB0aGlzLnBhcnNlSWRlbnQodGhpcy5vcHRpb25zLmFsbG93UmVzZXJ2ZWQgIT09IFwibmV2ZXJcIilcbn07XG5cbi8vIEluaXRpYWxpemUgZW1wdHkgZnVuY3Rpb24gbm9kZS5cblxucHAkMy5pbml0RnVuY3Rpb24gPSBmdW5jdGlvbihub2RlKSB7XG4gIG5vZGUuaWQgPSBudWxsO1xuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDYpIHsgbm9kZS5nZW5lcmF0b3IgPSBub2RlLmV4cHJlc3Npb24gPSBmYWxzZTsgfVxuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDgpIHsgbm9kZS5hc3luYyA9IGZhbHNlOyB9XG59O1xuXG4vLyBQYXJzZSBvYmplY3Qgb3IgY2xhc3MgbWV0aG9kLlxuXG5wcCQzLnBhcnNlTWV0aG9kID0gZnVuY3Rpb24oaXNHZW5lcmF0b3IsIGlzQXN5bmMsIGFsbG93RGlyZWN0U3VwZXIpIHtcbiAgdmFyIG5vZGUgPSB0aGlzLnN0YXJ0Tm9kZSgpLCBvbGRZaWVsZFBvcyA9IHRoaXMueWllbGRQb3MsIG9sZEF3YWl0UG9zID0gdGhpcy5hd2FpdFBvcywgb2xkQXdhaXRJZGVudFBvcyA9IHRoaXMuYXdhaXRJZGVudFBvcztcblxuICB0aGlzLmluaXRGdW5jdGlvbihub2RlKTtcbiAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2KVxuICAgIHsgbm9kZS5nZW5lcmF0b3IgPSBpc0dlbmVyYXRvcjsgfVxuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDgpXG4gICAgeyBub2RlLmFzeW5jID0gISFpc0FzeW5jOyB9XG5cbiAgdGhpcy55aWVsZFBvcyA9IDA7XG4gIHRoaXMuYXdhaXRQb3MgPSAwO1xuICB0aGlzLmF3YWl0SWRlbnRQb3MgPSAwO1xuICB0aGlzLmVudGVyU2NvcGUoZnVuY3Rpb25GbGFncyhpc0FzeW5jLCBub2RlLmdlbmVyYXRvcikgfCBTQ09QRV9TVVBFUiB8IChhbGxvd0RpcmVjdFN1cGVyID8gU0NPUEVfRElSRUNUX1NVUEVSIDogMCkpO1xuXG4gIHRoaXMuZXhwZWN0KHR5cGVzLnBhcmVuTCk7XG4gIG5vZGUucGFyYW1zID0gdGhpcy5wYXJzZUJpbmRpbmdMaXN0KHR5cGVzLnBhcmVuUiwgZmFsc2UsIHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA4KTtcbiAgdGhpcy5jaGVja1lpZWxkQXdhaXRJbkRlZmF1bHRQYXJhbXMoKTtcbiAgdGhpcy5wYXJzZUZ1bmN0aW9uQm9keShub2RlLCBmYWxzZSwgdHJ1ZSk7XG5cbiAgdGhpcy55aWVsZFBvcyA9IG9sZFlpZWxkUG9zO1xuICB0aGlzLmF3YWl0UG9zID0gb2xkQXdhaXRQb3M7XG4gIHRoaXMuYXdhaXRJZGVudFBvcyA9IG9sZEF3YWl0SWRlbnRQb3M7XG4gIHJldHVybiB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJGdW5jdGlvbkV4cHJlc3Npb25cIilcbn07XG5cbi8vIFBhcnNlIGFycm93IGZ1bmN0aW9uIGV4cHJlc3Npb24gd2l0aCBnaXZlbiBwYXJhbWV0ZXJzLlxuXG5wcCQzLnBhcnNlQXJyb3dFeHByZXNzaW9uID0gZnVuY3Rpb24obm9kZSwgcGFyYW1zLCBpc0FzeW5jKSB7XG4gIHZhciBvbGRZaWVsZFBvcyA9IHRoaXMueWllbGRQb3MsIG9sZEF3YWl0UG9zID0gdGhpcy5hd2FpdFBvcywgb2xkQXdhaXRJZGVudFBvcyA9IHRoaXMuYXdhaXRJZGVudFBvcztcblxuICB0aGlzLmVudGVyU2NvcGUoZnVuY3Rpb25GbGFncyhpc0FzeW5jLCBmYWxzZSkgfCBTQ09QRV9BUlJPVyk7XG4gIHRoaXMuaW5pdEZ1bmN0aW9uKG5vZGUpO1xuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDgpIHsgbm9kZS5hc3luYyA9ICEhaXNBc3luYzsgfVxuXG4gIHRoaXMueWllbGRQb3MgPSAwO1xuICB0aGlzLmF3YWl0UG9zID0gMDtcbiAgdGhpcy5hd2FpdElkZW50UG9zID0gMDtcblxuICBub2RlLnBhcmFtcyA9IHRoaXMudG9Bc3NpZ25hYmxlTGlzdChwYXJhbXMsIHRydWUpO1xuICB0aGlzLnBhcnNlRnVuY3Rpb25Cb2R5KG5vZGUsIHRydWUsIGZhbHNlKTtcblxuICB0aGlzLnlpZWxkUG9zID0gb2xkWWllbGRQb3M7XG4gIHRoaXMuYXdhaXRQb3MgPSBvbGRBd2FpdFBvcztcbiAgdGhpcy5hd2FpdElkZW50UG9zID0gb2xkQXdhaXRJZGVudFBvcztcbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIkFycm93RnVuY3Rpb25FeHByZXNzaW9uXCIpXG59O1xuXG4vLyBQYXJzZSBmdW5jdGlvbiBib2R5IGFuZCBjaGVjayBwYXJhbWV0ZXJzLlxuXG5wcCQzLnBhcnNlRnVuY3Rpb25Cb2R5ID0gZnVuY3Rpb24obm9kZSwgaXNBcnJvd0Z1bmN0aW9uLCBpc01ldGhvZCkge1xuICB2YXIgaXNFeHByZXNzaW9uID0gaXNBcnJvd0Z1bmN0aW9uICYmIHRoaXMudHlwZSAhPT0gdHlwZXMuYnJhY2VMO1xuICB2YXIgb2xkU3RyaWN0ID0gdGhpcy5zdHJpY3QsIHVzZVN0cmljdCA9IGZhbHNlO1xuXG4gIGlmIChpc0V4cHJlc3Npb24pIHtcbiAgICBub2RlLmJvZHkgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oKTtcbiAgICBub2RlLmV4cHJlc3Npb24gPSB0cnVlO1xuICAgIHRoaXMuY2hlY2tQYXJhbXMobm9kZSwgZmFsc2UpO1xuICB9IGVsc2Uge1xuICAgIHZhciBub25TaW1wbGUgPSB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNyAmJiAhdGhpcy5pc1NpbXBsZVBhcmFtTGlzdChub2RlLnBhcmFtcyk7XG4gICAgaWYgKCFvbGRTdHJpY3QgfHwgbm9uU2ltcGxlKSB7XG4gICAgICB1c2VTdHJpY3QgPSB0aGlzLnN0cmljdERpcmVjdGl2ZSh0aGlzLmVuZCk7XG4gICAgICAvLyBJZiB0aGlzIGlzIGEgc3RyaWN0IG1vZGUgZnVuY3Rpb24sIHZlcmlmeSB0aGF0IGFyZ3VtZW50IG5hbWVzXG4gICAgICAvLyBhcmUgbm90IHJlcGVhdGVkLCBhbmQgaXQgZG9lcyBub3QgdHJ5IHRvIGJpbmQgdGhlIHdvcmRzIGBldmFsYFxuICAgICAgLy8gb3IgYGFyZ3VtZW50c2AuXG4gICAgICBpZiAodXNlU3RyaWN0ICYmIG5vblNpbXBsZSlcbiAgICAgICAgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUobm9kZS5zdGFydCwgXCJJbGxlZ2FsICd1c2Ugc3RyaWN0JyBkaXJlY3RpdmUgaW4gZnVuY3Rpb24gd2l0aCBub24tc2ltcGxlIHBhcmFtZXRlciBsaXN0XCIpOyB9XG4gICAgfVxuICAgIC8vIFN0YXJ0IGEgbmV3IHNjb3BlIHdpdGggcmVnYXJkIHRvIGxhYmVscyBhbmQgdGhlIGBpbkZ1bmN0aW9uYFxuICAgIC8vIGZsYWcgKHJlc3RvcmUgdGhlbSB0byB0aGVpciBvbGQgdmFsdWUgYWZ0ZXJ3YXJkcykuXG4gICAgdmFyIG9sZExhYmVscyA9IHRoaXMubGFiZWxzO1xuICAgIHRoaXMubGFiZWxzID0gW107XG4gICAgaWYgKHVzZVN0cmljdCkgeyB0aGlzLnN0cmljdCA9IHRydWU7IH1cblxuICAgIC8vIEFkZCB0aGUgcGFyYW1zIHRvIHZhckRlY2xhcmVkTmFtZXMgdG8gZW5zdXJlIHRoYXQgYW4gZXJyb3IgaXMgdGhyb3duXG4gICAgLy8gaWYgYSBsZXQvY29uc3QgZGVjbGFyYXRpb24gaW4gdGhlIGZ1bmN0aW9uIGNsYXNoZXMgd2l0aCBvbmUgb2YgdGhlIHBhcmFtcy5cbiAgICB0aGlzLmNoZWNrUGFyYW1zKG5vZGUsICFvbGRTdHJpY3QgJiYgIXVzZVN0cmljdCAmJiAhaXNBcnJvd0Z1bmN0aW9uICYmICFpc01ldGhvZCAmJiB0aGlzLmlzU2ltcGxlUGFyYW1MaXN0KG5vZGUucGFyYW1zKSk7XG4gICAgLy8gRW5zdXJlIHRoZSBmdW5jdGlvbiBuYW1lIGlzbid0IGEgZm9yYmlkZGVuIGlkZW50aWZpZXIgaW4gc3RyaWN0IG1vZGUsIGUuZy4gJ2V2YWwnXG4gICAgaWYgKHRoaXMuc3RyaWN0ICYmIG5vZGUuaWQpIHsgdGhpcy5jaGVja0xWYWxTaW1wbGUobm9kZS5pZCwgQklORF9PVVRTSURFKTsgfVxuICAgIG5vZGUuYm9keSA9IHRoaXMucGFyc2VCbG9jayhmYWxzZSwgdW5kZWZpbmVkLCB1c2VTdHJpY3QgJiYgIW9sZFN0cmljdCk7XG4gICAgbm9kZS5leHByZXNzaW9uID0gZmFsc2U7XG4gICAgdGhpcy5hZGFwdERpcmVjdGl2ZVByb2xvZ3VlKG5vZGUuYm9keS5ib2R5KTtcbiAgICB0aGlzLmxhYmVscyA9IG9sZExhYmVscztcbiAgfVxuICB0aGlzLmV4aXRTY29wZSgpO1xufTtcblxucHAkMy5pc1NpbXBsZVBhcmFtTGlzdCA9IGZ1bmN0aW9uKHBhcmFtcykge1xuICBmb3IgKHZhciBpID0gMCwgbGlzdCA9IHBhcmFtczsgaSA8IGxpc3QubGVuZ3RoOyBpICs9IDEpXG4gICAge1xuICAgIHZhciBwYXJhbSA9IGxpc3RbaV07XG5cbiAgICBpZiAocGFyYW0udHlwZSAhPT0gXCJJZGVudGlmaWVyXCIpIHsgcmV0dXJuIGZhbHNlXG4gIH0gfVxuICByZXR1cm4gdHJ1ZVxufTtcblxuLy8gQ2hlY2tzIGZ1bmN0aW9uIHBhcmFtcyBmb3IgdmFyaW91cyBkaXNhbGxvd2VkIHBhdHRlcm5zIHN1Y2ggYXMgdXNpbmcgXCJldmFsXCJcbi8vIG9yIFwiYXJndW1lbnRzXCIgYW5kIGR1cGxpY2F0ZSBwYXJhbWV0ZXJzLlxuXG5wcCQzLmNoZWNrUGFyYW1zID0gZnVuY3Rpb24obm9kZSwgYWxsb3dEdXBsaWNhdGVzKSB7XG4gIHZhciBuYW1lSGFzaCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIGZvciAodmFyIGkgPSAwLCBsaXN0ID0gbm9kZS5wYXJhbXM7IGkgPCBsaXN0Lmxlbmd0aDsgaSArPSAxKVxuICAgIHtcbiAgICB2YXIgcGFyYW0gPSBsaXN0W2ldO1xuXG4gICAgdGhpcy5jaGVja0xWYWxJbm5lclBhdHRlcm4ocGFyYW0sIEJJTkRfVkFSLCBhbGxvd0R1cGxpY2F0ZXMgPyBudWxsIDogbmFtZUhhc2gpO1xuICB9XG59O1xuXG4vLyBQYXJzZXMgYSBjb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBleHByZXNzaW9ucywgYW5kIHJldHVybnMgdGhlbSBhc1xuLy8gYW4gYXJyYXkuIGBjbG9zZWAgaXMgdGhlIHRva2VuIHR5cGUgdGhhdCBlbmRzIHRoZSBsaXN0LCBhbmRcbi8vIGBhbGxvd0VtcHR5YCBjYW4gYmUgdHVybmVkIG9uIHRvIGFsbG93IHN1YnNlcXVlbnQgY29tbWFzIHdpdGhcbi8vIG5vdGhpbmcgaW4gYmV0d2VlbiB0aGVtIHRvIGJlIHBhcnNlZCBhcyBgbnVsbGAgKHdoaWNoIGlzIG5lZWRlZFxuLy8gZm9yIGFycmF5IGxpdGVyYWxzKS5cblxucHAkMy5wYXJzZUV4cHJMaXN0ID0gZnVuY3Rpb24oY2xvc2UsIGFsbG93VHJhaWxpbmdDb21tYSwgYWxsb3dFbXB0eSwgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycykge1xuICB2YXIgZWx0cyA9IFtdLCBmaXJzdCA9IHRydWU7XG4gIHdoaWxlICghdGhpcy5lYXQoY2xvc2UpKSB7XG4gICAgaWYgKCFmaXJzdCkge1xuICAgICAgdGhpcy5leHBlY3QodHlwZXMuY29tbWEpO1xuICAgICAgaWYgKGFsbG93VHJhaWxpbmdDb21tYSAmJiB0aGlzLmFmdGVyVHJhaWxpbmdDb21tYShjbG9zZSkpIHsgYnJlYWsgfVxuICAgIH0gZWxzZSB7IGZpcnN0ID0gZmFsc2U7IH1cblxuICAgIHZhciBlbHQgPSAodm9pZCAwKTtcbiAgICBpZiAoYWxsb3dFbXB0eSAmJiB0aGlzLnR5cGUgPT09IHR5cGVzLmNvbW1hKVxuICAgICAgeyBlbHQgPSBudWxsOyB9XG4gICAgZWxzZSBpZiAodGhpcy50eXBlID09PSB0eXBlcy5lbGxpcHNpcykge1xuICAgICAgZWx0ID0gdGhpcy5wYXJzZVNwcmVhZChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzKTtcbiAgICAgIGlmIChyZWZEZXN0cnVjdHVyaW5nRXJyb3JzICYmIHRoaXMudHlwZSA9PT0gdHlwZXMuY29tbWEgJiYgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycy50cmFpbGluZ0NvbW1hIDwgMClcbiAgICAgICAgeyByZWZEZXN0cnVjdHVyaW5nRXJyb3JzLnRyYWlsaW5nQ29tbWEgPSB0aGlzLnN0YXJ0OyB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsdCA9IHRoaXMucGFyc2VNYXliZUFzc2lnbihmYWxzZSwgcmVmRGVzdHJ1Y3R1cmluZ0Vycm9ycyk7XG4gICAgfVxuICAgIGVsdHMucHVzaChlbHQpO1xuICB9XG4gIHJldHVybiBlbHRzXG59O1xuXG5wcCQzLmNoZWNrVW5yZXNlcnZlZCA9IGZ1bmN0aW9uKHJlZikge1xuICB2YXIgc3RhcnQgPSByZWYuc3RhcnQ7XG4gIHZhciBlbmQgPSByZWYuZW5kO1xuICB2YXIgbmFtZSA9IHJlZi5uYW1lO1xuXG4gIGlmICh0aGlzLmluR2VuZXJhdG9yICYmIG5hbWUgPT09IFwieWllbGRcIilcbiAgICB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZShzdGFydCwgXCJDYW5ub3QgdXNlICd5aWVsZCcgYXMgaWRlbnRpZmllciBpbnNpZGUgYSBnZW5lcmF0b3JcIik7IH1cbiAgaWYgKHRoaXMuaW5Bc3luYyAmJiBuYW1lID09PSBcImF3YWl0XCIpXG4gICAgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUoc3RhcnQsIFwiQ2Fubm90IHVzZSAnYXdhaXQnIGFzIGlkZW50aWZpZXIgaW5zaWRlIGFuIGFzeW5jIGZ1bmN0aW9uXCIpOyB9XG4gIGlmICh0aGlzLmN1cnJlbnRUaGlzU2NvcGUoKS5pbkNsYXNzRmllbGRJbml0ICYmIG5hbWUgPT09IFwiYXJndW1lbnRzXCIpXG4gICAgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUoc3RhcnQsIFwiQ2Fubm90IHVzZSAnYXJndW1lbnRzJyBpbiBjbGFzcyBmaWVsZCBpbml0aWFsaXplclwiKTsgfVxuICBpZiAodGhpcy5rZXl3b3Jkcy50ZXN0KG5hbWUpKVxuICAgIHsgdGhpcy5yYWlzZShzdGFydCwgKFwiVW5leHBlY3RlZCBrZXl3b3JkICdcIiArIG5hbWUgKyBcIidcIikpOyB9XG4gIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPCA2ICYmXG4gICAgdGhpcy5pbnB1dC5zbGljZShzdGFydCwgZW5kKS5pbmRleE9mKFwiXFxcXFwiKSAhPT0gLTEpIHsgcmV0dXJuIH1cbiAgdmFyIHJlID0gdGhpcy5zdHJpY3QgPyB0aGlzLnJlc2VydmVkV29yZHNTdHJpY3QgOiB0aGlzLnJlc2VydmVkV29yZHM7XG4gIGlmIChyZS50ZXN0KG5hbWUpKSB7XG4gICAgaWYgKCF0aGlzLmluQXN5bmMgJiYgbmFtZSA9PT0gXCJhd2FpdFwiKVxuICAgICAgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUoc3RhcnQsIFwiQ2Fubm90IHVzZSBrZXl3b3JkICdhd2FpdCcgb3V0c2lkZSBhbiBhc3luYyBmdW5jdGlvblwiKTsgfVxuICAgIHRoaXMucmFpc2VSZWNvdmVyYWJsZShzdGFydCwgKFwiVGhlIGtleXdvcmQgJ1wiICsgbmFtZSArIFwiJyBpcyByZXNlcnZlZFwiKSk7XG4gIH1cbn07XG5cbi8vIFBhcnNlIHRoZSBuZXh0IHRva2VuIGFzIGFuIGlkZW50aWZpZXIuIElmIGBsaWJlcmFsYCBpcyB0cnVlICh1c2VkXG4vLyB3aGVuIHBhcnNpbmcgcHJvcGVydGllcyksIGl0IHdpbGwgYWxzbyBjb252ZXJ0IGtleXdvcmRzIGludG9cbi8vIGlkZW50aWZpZXJzLlxuXG5wcCQzLnBhcnNlSWRlbnQgPSBmdW5jdGlvbihsaWJlcmFsLCBpc0JpbmRpbmcpIHtcbiAgdmFyIG5vZGUgPSB0aGlzLnN0YXJ0Tm9kZSgpO1xuICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5uYW1lKSB7XG4gICAgbm9kZS5uYW1lID0gdGhpcy52YWx1ZTtcbiAgfSBlbHNlIGlmICh0aGlzLnR5cGUua2V5d29yZCkge1xuICAgIG5vZGUubmFtZSA9IHRoaXMudHlwZS5rZXl3b3JkO1xuXG4gICAgLy8gVG8gZml4IGh0dHBzOi8vZ2l0aHViLmNvbS9hY29ybmpzL2Fjb3JuL2lzc3Vlcy81NzVcbiAgICAvLyBgY2xhc3NgIGFuZCBgZnVuY3Rpb25gIGtleXdvcmRzIHB1c2ggbmV3IGNvbnRleHQgaW50byB0aGlzLmNvbnRleHQuXG4gICAgLy8gQnV0IHRoZXJlIGlzIG5vIGNoYW5jZSB0byBwb3AgdGhlIGNvbnRleHQgaWYgdGhlIGtleXdvcmQgaXMgY29uc3VtZWQgYXMgYW4gaWRlbnRpZmllciBzdWNoIGFzIGEgcHJvcGVydHkgbmFtZS5cbiAgICAvLyBJZiB0aGUgcHJldmlvdXMgdG9rZW4gaXMgYSBkb3QsIHRoaXMgZG9lcyBub3QgYXBwbHkgYmVjYXVzZSB0aGUgY29udGV4dC1tYW5hZ2luZyBjb2RlIGFscmVhZHkgaWdub3JlZCB0aGUga2V5d29yZFxuICAgIGlmICgobm9kZS5uYW1lID09PSBcImNsYXNzXCIgfHwgbm9kZS5uYW1lID09PSBcImZ1bmN0aW9uXCIpICYmXG4gICAgICAgICh0aGlzLmxhc3RUb2tFbmQgIT09IHRoaXMubGFzdFRva1N0YXJ0ICsgMSB8fCB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5sYXN0VG9rU3RhcnQpICE9PSA0NikpIHtcbiAgICAgIHRoaXMuY29udGV4dC5wb3AoKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdGhpcy51bmV4cGVjdGVkKCk7XG4gIH1cbiAgdGhpcy5uZXh0KCEhbGliZXJhbCk7XG4gIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIklkZW50aWZpZXJcIik7XG4gIGlmICghbGliZXJhbCkge1xuICAgIHRoaXMuY2hlY2tVbnJlc2VydmVkKG5vZGUpO1xuICAgIGlmIChub2RlLm5hbWUgPT09IFwiYXdhaXRcIiAmJiAhdGhpcy5hd2FpdElkZW50UG9zKVxuICAgICAgeyB0aGlzLmF3YWl0SWRlbnRQb3MgPSBub2RlLnN0YXJ0OyB9XG4gIH1cbiAgcmV0dXJuIG5vZGVcbn07XG5cbnBwJDMucGFyc2VQcml2YXRlSWRlbnQgPSBmdW5jdGlvbigpIHtcbiAgdmFyIG5vZGUgPSB0aGlzLnN0YXJ0Tm9kZSgpO1xuICBpZiAodGhpcy50eXBlID09PSB0eXBlcy5wcml2YXRlSWQpIHtcbiAgICBub2RlLm5hbWUgPSB0aGlzLnZhbHVlO1xuICB9IGVsc2Uge1xuICAgIHRoaXMudW5leHBlY3RlZCgpO1xuICB9XG4gIHRoaXMubmV4dCgpO1xuICB0aGlzLmZpbmlzaE5vZGUobm9kZSwgXCJQcml2YXRlSWRlbnRpZmllclwiKTtcblxuICAvLyBGb3IgdmFsaWRhdGluZyBleGlzdGVuY2VcbiAgaWYgKHRoaXMucHJpdmF0ZU5hbWVTdGFjay5sZW5ndGggPT09IDApIHtcbiAgICB0aGlzLnJhaXNlKG5vZGUuc3RhcnQsIChcIlByaXZhdGUgZmllbGQgJyNcIiArIChub2RlLm5hbWUpICsgXCInIG11c3QgYmUgZGVjbGFyZWQgaW4gYW4gZW5jbG9zaW5nIGNsYXNzXCIpKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLnByaXZhdGVOYW1lU3RhY2tbdGhpcy5wcml2YXRlTmFtZVN0YWNrLmxlbmd0aCAtIDFdLnVzZWQucHVzaChub2RlKTtcbiAgfVxuXG4gIHJldHVybiBub2RlXG59O1xuXG4vLyBQYXJzZXMgeWllbGQgZXhwcmVzc2lvbiBpbnNpZGUgZ2VuZXJhdG9yLlxuXG5wcCQzLnBhcnNlWWllbGQgPSBmdW5jdGlvbihmb3JJbml0KSB7XG4gIGlmICghdGhpcy55aWVsZFBvcykgeyB0aGlzLnlpZWxkUG9zID0gdGhpcy5zdGFydDsgfVxuXG4gIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgdGhpcy5uZXh0KCk7XG4gIGlmICh0aGlzLnR5cGUgPT09IHR5cGVzLnNlbWkgfHwgdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSB8fCAodGhpcy50eXBlICE9PSB0eXBlcy5zdGFyICYmICF0aGlzLnR5cGUuc3RhcnRzRXhwcikpIHtcbiAgICBub2RlLmRlbGVnYXRlID0gZmFsc2U7XG4gICAgbm9kZS5hcmd1bWVudCA9IG51bGw7XG4gIH0gZWxzZSB7XG4gICAgbm9kZS5kZWxlZ2F0ZSA9IHRoaXMuZWF0KHR5cGVzLnN0YXIpO1xuICAgIG5vZGUuYXJndW1lbnQgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oZm9ySW5pdCk7XG4gIH1cbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIllpZWxkRXhwcmVzc2lvblwiKVxufTtcblxucHAkMy5wYXJzZUF3YWl0ID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5hd2FpdFBvcykgeyB0aGlzLmF3YWl0UG9zID0gdGhpcy5zdGFydDsgfVxuXG4gIHZhciBub2RlID0gdGhpcy5zdGFydE5vZGUoKTtcbiAgdGhpcy5uZXh0KCk7XG4gIG5vZGUuYXJndW1lbnQgPSB0aGlzLnBhcnNlTWF5YmVVbmFyeShudWxsLCB0cnVlKTtcbiAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShub2RlLCBcIkF3YWl0RXhwcmVzc2lvblwiKVxufTtcblxudmFyIHBwJDQgPSBQYXJzZXIucHJvdG90eXBlO1xuXG4vLyBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gcmFpc2UgZXhjZXB0aW9ucyBvbiBwYXJzZSBlcnJvcnMuIEl0XG4vLyB0YWtlcyBhbiBvZmZzZXQgaW50ZWdlciAoaW50byB0aGUgY3VycmVudCBgaW5wdXRgKSB0byBpbmRpY2F0ZVxuLy8gdGhlIGxvY2F0aW9uIG9mIHRoZSBlcnJvciwgYXR0YWNoZXMgdGhlIHBvc2l0aW9uIHRvIHRoZSBlbmRcbi8vIG9mIHRoZSBlcnJvciBtZXNzYWdlLCBhbmQgdGhlbiByYWlzZXMgYSBgU3ludGF4RXJyb3JgIHdpdGggdGhhdFxuLy8gbWVzc2FnZS5cblxucHAkNC5yYWlzZSA9IGZ1bmN0aW9uKHBvcywgbWVzc2FnZSkge1xuICB2YXIgbG9jID0gZ2V0TGluZUluZm8odGhpcy5pbnB1dCwgcG9zKTtcbiAgbWVzc2FnZSArPSBcIiAoXCIgKyBsb2MubGluZSArIFwiOlwiICsgbG9jLmNvbHVtbiArIFwiKVwiO1xuICB2YXIgZXJyID0gbmV3IFN5bnRheEVycm9yKG1lc3NhZ2UpO1xuICBlcnIucG9zID0gcG9zOyBlcnIubG9jID0gbG9jOyBlcnIucmFpc2VkQXQgPSB0aGlzLnBvcztcbiAgdGhyb3cgZXJyXG59O1xuXG5wcCQ0LnJhaXNlUmVjb3ZlcmFibGUgPSBwcCQ0LnJhaXNlO1xuXG5wcCQ0LmN1clBvc2l0aW9uID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLm9wdGlvbnMubG9jYXRpb25zKSB7XG4gICAgcmV0dXJuIG5ldyBQb3NpdGlvbih0aGlzLmN1ckxpbmUsIHRoaXMucG9zIC0gdGhpcy5saW5lU3RhcnQpXG4gIH1cbn07XG5cbnZhciBwcCQ1ID0gUGFyc2VyLnByb3RvdHlwZTtcblxudmFyIFNjb3BlID0gZnVuY3Rpb24gU2NvcGUoZmxhZ3MpIHtcbiAgdGhpcy5mbGFncyA9IGZsYWdzO1xuICAvLyBBIGxpc3Qgb2YgdmFyLWRlY2xhcmVkIG5hbWVzIGluIHRoZSBjdXJyZW50IGxleGljYWwgc2NvcGVcbiAgdGhpcy52YXIgPSBbXTtcbiAgLy8gQSBsaXN0IG9mIGxleGljYWxseS1kZWNsYXJlZCBuYW1lcyBpbiB0aGUgY3VycmVudCBsZXhpY2FsIHNjb3BlXG4gIHRoaXMubGV4aWNhbCA9IFtdO1xuICAvLyBBIGxpc3Qgb2YgbGV4aWNhbGx5LWRlY2xhcmVkIEZ1bmN0aW9uRGVjbGFyYXRpb24gbmFtZXMgaW4gdGhlIGN1cnJlbnQgbGV4aWNhbCBzY29wZVxuICB0aGlzLmZ1bmN0aW9ucyA9IFtdO1xuICAvLyBBIHN3aXRjaCB0byBkaXNhbGxvdyB0aGUgaWRlbnRpZmllciByZWZlcmVuY2UgJ2FyZ3VtZW50cydcbiAgdGhpcy5pbkNsYXNzRmllbGRJbml0ID0gZmFsc2U7XG59O1xuXG4vLyBUaGUgZnVuY3Rpb25zIGluIHRoaXMgbW9kdWxlIGtlZXAgdHJhY2sgb2YgZGVjbGFyZWQgdmFyaWFibGVzIGluIHRoZSBjdXJyZW50IHNjb3BlIGluIG9yZGVyIHRvIGRldGVjdCBkdXBsaWNhdGUgdmFyaWFibGUgbmFtZXMuXG5cbnBwJDUuZW50ZXJTY29wZSA9IGZ1bmN0aW9uKGZsYWdzKSB7XG4gIHRoaXMuc2NvcGVTdGFjay5wdXNoKG5ldyBTY29wZShmbGFncykpO1xufTtcblxucHAkNS5leGl0U2NvcGUgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5zY29wZVN0YWNrLnBvcCgpO1xufTtcblxuLy8gVGhlIHNwZWMgc2F5czpcbi8vID4gQXQgdGhlIHRvcCBsZXZlbCBvZiBhIGZ1bmN0aW9uLCBvciBzY3JpcHQsIGZ1bmN0aW9uIGRlY2xhcmF0aW9ucyBhcmVcbi8vID4gdHJlYXRlZCBsaWtlIHZhciBkZWNsYXJhdGlvbnMgcmF0aGVyIHRoYW4gbGlrZSBsZXhpY2FsIGRlY2xhcmF0aW9ucy5cbnBwJDUudHJlYXRGdW5jdGlvbnNBc1ZhckluU2NvcGUgPSBmdW5jdGlvbihzY29wZSkge1xuICByZXR1cm4gKHNjb3BlLmZsYWdzICYgU0NPUEVfRlVOQ1RJT04pIHx8ICF0aGlzLmluTW9kdWxlICYmIChzY29wZS5mbGFncyAmIFNDT1BFX1RPUClcbn07XG5cbnBwJDUuZGVjbGFyZU5hbWUgPSBmdW5jdGlvbihuYW1lLCBiaW5kaW5nVHlwZSwgcG9zKSB7XG4gIHZhciByZWRlY2xhcmVkID0gZmFsc2U7XG4gIGlmIChiaW5kaW5nVHlwZSA9PT0gQklORF9MRVhJQ0FMKSB7XG4gICAgdmFyIHNjb3BlID0gdGhpcy5jdXJyZW50U2NvcGUoKTtcbiAgICByZWRlY2xhcmVkID0gc2NvcGUubGV4aWNhbC5pbmRleE9mKG5hbWUpID4gLTEgfHwgc2NvcGUuZnVuY3Rpb25zLmluZGV4T2YobmFtZSkgPiAtMSB8fCBzY29wZS52YXIuaW5kZXhPZihuYW1lKSA+IC0xO1xuICAgIHNjb3BlLmxleGljYWwucHVzaChuYW1lKTtcbiAgICBpZiAodGhpcy5pbk1vZHVsZSAmJiAoc2NvcGUuZmxhZ3MgJiBTQ09QRV9UT1ApKVxuICAgICAgeyBkZWxldGUgdGhpcy51bmRlZmluZWRFeHBvcnRzW25hbWVdOyB9XG4gIH0gZWxzZSBpZiAoYmluZGluZ1R5cGUgPT09IEJJTkRfU0lNUExFX0NBVENIKSB7XG4gICAgdmFyIHNjb3BlJDEgPSB0aGlzLmN1cnJlbnRTY29wZSgpO1xuICAgIHNjb3BlJDEubGV4aWNhbC5wdXNoKG5hbWUpO1xuICB9IGVsc2UgaWYgKGJpbmRpbmdUeXBlID09PSBCSU5EX0ZVTkNUSU9OKSB7XG4gICAgdmFyIHNjb3BlJDIgPSB0aGlzLmN1cnJlbnRTY29wZSgpO1xuICAgIGlmICh0aGlzLnRyZWF0RnVuY3Rpb25zQXNWYXIpXG4gICAgICB7IHJlZGVjbGFyZWQgPSBzY29wZSQyLmxleGljYWwuaW5kZXhPZihuYW1lKSA+IC0xOyB9XG4gICAgZWxzZVxuICAgICAgeyByZWRlY2xhcmVkID0gc2NvcGUkMi5sZXhpY2FsLmluZGV4T2YobmFtZSkgPiAtMSB8fCBzY29wZSQyLnZhci5pbmRleE9mKG5hbWUpID4gLTE7IH1cbiAgICBzY29wZSQyLmZ1bmN0aW9ucy5wdXNoKG5hbWUpO1xuICB9IGVsc2Uge1xuICAgIGZvciAodmFyIGkgPSB0aGlzLnNjb3BlU3RhY2subGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgIHZhciBzY29wZSQzID0gdGhpcy5zY29wZVN0YWNrW2ldO1xuICAgICAgaWYgKHNjb3BlJDMubGV4aWNhbC5pbmRleE9mKG5hbWUpID4gLTEgJiYgISgoc2NvcGUkMy5mbGFncyAmIFNDT1BFX1NJTVBMRV9DQVRDSCkgJiYgc2NvcGUkMy5sZXhpY2FsWzBdID09PSBuYW1lKSB8fFxuICAgICAgICAgICF0aGlzLnRyZWF0RnVuY3Rpb25zQXNWYXJJblNjb3BlKHNjb3BlJDMpICYmIHNjb3BlJDMuZnVuY3Rpb25zLmluZGV4T2YobmFtZSkgPiAtMSkge1xuICAgICAgICByZWRlY2xhcmVkID0gdHJ1ZTtcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICAgIHNjb3BlJDMudmFyLnB1c2gobmFtZSk7XG4gICAgICBpZiAodGhpcy5pbk1vZHVsZSAmJiAoc2NvcGUkMy5mbGFncyAmIFNDT1BFX1RPUCkpXG4gICAgICAgIHsgZGVsZXRlIHRoaXMudW5kZWZpbmVkRXhwb3J0c1tuYW1lXTsgfVxuICAgICAgaWYgKHNjb3BlJDMuZmxhZ3MgJiBTQ09QRV9WQVIpIHsgYnJlYWsgfVxuICAgIH1cbiAgfVxuICBpZiAocmVkZWNsYXJlZCkgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUocG9zLCAoXCJJZGVudGlmaWVyICdcIiArIG5hbWUgKyBcIicgaGFzIGFscmVhZHkgYmVlbiBkZWNsYXJlZFwiKSk7IH1cbn07XG5cbnBwJDUuY2hlY2tMb2NhbEV4cG9ydCA9IGZ1bmN0aW9uKGlkKSB7XG4gIC8vIHNjb3BlLmZ1bmN0aW9ucyBtdXN0IGJlIGVtcHR5IGFzIE1vZHVsZSBjb2RlIGlzIGFsd2F5cyBzdHJpY3QuXG4gIGlmICh0aGlzLnNjb3BlU3RhY2tbMF0ubGV4aWNhbC5pbmRleE9mKGlkLm5hbWUpID09PSAtMSAmJlxuICAgICAgdGhpcy5zY29wZVN0YWNrWzBdLnZhci5pbmRleE9mKGlkLm5hbWUpID09PSAtMSkge1xuICAgIHRoaXMudW5kZWZpbmVkRXhwb3J0c1tpZC5uYW1lXSA9IGlkO1xuICB9XG59O1xuXG5wcCQ1LmN1cnJlbnRTY29wZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5zY29wZVN0YWNrW3RoaXMuc2NvcGVTdGFjay5sZW5ndGggLSAxXVxufTtcblxucHAkNS5jdXJyZW50VmFyU2NvcGUgPSBmdW5jdGlvbigpIHtcbiAgZm9yICh2YXIgaSA9IHRoaXMuc2NvcGVTdGFjay5sZW5ndGggLSAxOzsgaS0tKSB7XG4gICAgdmFyIHNjb3BlID0gdGhpcy5zY29wZVN0YWNrW2ldO1xuICAgIGlmIChzY29wZS5mbGFncyAmIFNDT1BFX1ZBUikgeyByZXR1cm4gc2NvcGUgfVxuICB9XG59O1xuXG4vLyBDb3VsZCBiZSB1c2VmdWwgZm9yIGB0aGlzYCwgYG5ldy50YXJnZXRgLCBgc3VwZXIoKWAsIGBzdXBlci5wcm9wZXJ0eWAsIGFuZCBgc3VwZXJbcHJvcGVydHldYC5cbnBwJDUuY3VycmVudFRoaXNTY29wZSA9IGZ1bmN0aW9uKCkge1xuICBmb3IgKHZhciBpID0gdGhpcy5zY29wZVN0YWNrLmxlbmd0aCAtIDE7OyBpLS0pIHtcbiAgICB2YXIgc2NvcGUgPSB0aGlzLnNjb3BlU3RhY2tbaV07XG4gICAgaWYgKHNjb3BlLmZsYWdzICYgU0NPUEVfVkFSICYmICEoc2NvcGUuZmxhZ3MgJiBTQ09QRV9BUlJPVykpIHsgcmV0dXJuIHNjb3BlIH1cbiAgfVxufTtcblxudmFyIE5vZGUgPSBmdW5jdGlvbiBOb2RlKHBhcnNlciwgcG9zLCBsb2MpIHtcbiAgdGhpcy50eXBlID0gXCJcIjtcbiAgdGhpcy5zdGFydCA9IHBvcztcbiAgdGhpcy5lbmQgPSAwO1xuICBpZiAocGFyc2VyLm9wdGlvbnMubG9jYXRpb25zKVxuICAgIHsgdGhpcy5sb2MgPSBuZXcgU291cmNlTG9jYXRpb24ocGFyc2VyLCBsb2MpOyB9XG4gIGlmIChwYXJzZXIub3B0aW9ucy5kaXJlY3RTb3VyY2VGaWxlKVxuICAgIHsgdGhpcy5zb3VyY2VGaWxlID0gcGFyc2VyLm9wdGlvbnMuZGlyZWN0U291cmNlRmlsZTsgfVxuICBpZiAocGFyc2VyLm9wdGlvbnMucmFuZ2VzKVxuICAgIHsgdGhpcy5yYW5nZSA9IFtwb3MsIDBdOyB9XG59O1xuXG4vLyBTdGFydCBhbiBBU1Qgbm9kZSwgYXR0YWNoaW5nIGEgc3RhcnQgb2Zmc2V0LlxuXG52YXIgcHAkNiA9IFBhcnNlci5wcm90b3R5cGU7XG5cbnBwJDYuc3RhcnROb2RlID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiBuZXcgTm9kZSh0aGlzLCB0aGlzLnN0YXJ0LCB0aGlzLnN0YXJ0TG9jKVxufTtcblxucHAkNi5zdGFydE5vZGVBdCA9IGZ1bmN0aW9uKHBvcywgbG9jKSB7XG4gIHJldHVybiBuZXcgTm9kZSh0aGlzLCBwb3MsIGxvYylcbn07XG5cbi8vIEZpbmlzaCBhbiBBU1Qgbm9kZSwgYWRkaW5nIGB0eXBlYCBhbmQgYGVuZGAgcHJvcGVydGllcy5cblxuZnVuY3Rpb24gZmluaXNoTm9kZUF0KG5vZGUsIHR5cGUsIHBvcywgbG9jKSB7XG4gIG5vZGUudHlwZSA9IHR5cGU7XG4gIG5vZGUuZW5kID0gcG9zO1xuICBpZiAodGhpcy5vcHRpb25zLmxvY2F0aW9ucylcbiAgICB7IG5vZGUubG9jLmVuZCA9IGxvYzsgfVxuICBpZiAodGhpcy5vcHRpb25zLnJhbmdlcylcbiAgICB7IG5vZGUucmFuZ2VbMV0gPSBwb3M7IH1cbiAgcmV0dXJuIG5vZGVcbn1cblxucHAkNi5maW5pc2hOb2RlID0gZnVuY3Rpb24obm9kZSwgdHlwZSkge1xuICByZXR1cm4gZmluaXNoTm9kZUF0LmNhbGwodGhpcywgbm9kZSwgdHlwZSwgdGhpcy5sYXN0VG9rRW5kLCB0aGlzLmxhc3RUb2tFbmRMb2MpXG59O1xuXG4vLyBGaW5pc2ggbm9kZSBhdCBnaXZlbiBwb3NpdGlvblxuXG5wcCQ2LmZpbmlzaE5vZGVBdCA9IGZ1bmN0aW9uKG5vZGUsIHR5cGUsIHBvcywgbG9jKSB7XG4gIHJldHVybiBmaW5pc2hOb2RlQXQuY2FsbCh0aGlzLCBub2RlLCB0eXBlLCBwb3MsIGxvYylcbn07XG5cbnBwJDYuY29weU5vZGUgPSBmdW5jdGlvbihub2RlKSB7XG4gIHZhciBuZXdOb2RlID0gbmV3IE5vZGUodGhpcywgbm9kZS5zdGFydCwgdGhpcy5zdGFydExvYyk7XG4gIGZvciAodmFyIHByb3AgaW4gbm9kZSkgeyBuZXdOb2RlW3Byb3BdID0gbm9kZVtwcm9wXTsgfVxuICByZXR1cm4gbmV3Tm9kZVxufTtcblxuLy8gVGhlIGFsZ29yaXRobSB1c2VkIHRvIGRldGVybWluZSB3aGV0aGVyIGEgcmVnZXhwIGNhbiBhcHBlYXIgYXQgYVxuXG52YXIgVG9rQ29udGV4dCA9IGZ1bmN0aW9uIFRva0NvbnRleHQodG9rZW4sIGlzRXhwciwgcHJlc2VydmVTcGFjZSwgb3ZlcnJpZGUsIGdlbmVyYXRvcikge1xuICB0aGlzLnRva2VuID0gdG9rZW47XG4gIHRoaXMuaXNFeHByID0gISFpc0V4cHI7XG4gIHRoaXMucHJlc2VydmVTcGFjZSA9ICEhcHJlc2VydmVTcGFjZTtcbiAgdGhpcy5vdmVycmlkZSA9IG92ZXJyaWRlO1xuICB0aGlzLmdlbmVyYXRvciA9ICEhZ2VuZXJhdG9yO1xufTtcblxudmFyIHR5cGVzJDEgPSB7XG4gIGJfc3RhdDogbmV3IFRva0NvbnRleHQoXCJ7XCIsIGZhbHNlKSxcbiAgYl9leHByOiBuZXcgVG9rQ29udGV4dChcIntcIiwgdHJ1ZSksXG4gIGJfdG1wbDogbmV3IFRva0NvbnRleHQoXCIke1wiLCBmYWxzZSksXG4gIHBfc3RhdDogbmV3IFRva0NvbnRleHQoXCIoXCIsIGZhbHNlKSxcbiAgcF9leHByOiBuZXcgVG9rQ29udGV4dChcIihcIiwgdHJ1ZSksXG4gIHFfdG1wbDogbmV3IFRva0NvbnRleHQoXCJgXCIsIHRydWUsIHRydWUsIGZ1bmN0aW9uIChwKSB7IHJldHVybiBwLnRyeVJlYWRUZW1wbGF0ZVRva2VuKCk7IH0pLFxuICBmX3N0YXQ6IG5ldyBUb2tDb250ZXh0KFwiZnVuY3Rpb25cIiwgZmFsc2UpLFxuICBmX2V4cHI6IG5ldyBUb2tDb250ZXh0KFwiZnVuY3Rpb25cIiwgdHJ1ZSksXG4gIGZfZXhwcl9nZW46IG5ldyBUb2tDb250ZXh0KFwiZnVuY3Rpb25cIiwgdHJ1ZSwgZmFsc2UsIG51bGwsIHRydWUpLFxuICBmX2dlbjogbmV3IFRva0NvbnRleHQoXCJmdW5jdGlvblwiLCBmYWxzZSwgZmFsc2UsIG51bGwsIHRydWUpXG59O1xuXG52YXIgcHAkNyA9IFBhcnNlci5wcm90b3R5cGU7XG5cbnBwJDcuaW5pdGlhbENvbnRleHQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIFt0eXBlcyQxLmJfc3RhdF1cbn07XG5cbnBwJDcuYnJhY2VJc0Jsb2NrID0gZnVuY3Rpb24ocHJldlR5cGUpIHtcbiAgdmFyIHBhcmVudCA9IHRoaXMuY3VyQ29udGV4dCgpO1xuICBpZiAocGFyZW50ID09PSB0eXBlcyQxLmZfZXhwciB8fCBwYXJlbnQgPT09IHR5cGVzJDEuZl9zdGF0KVxuICAgIHsgcmV0dXJuIHRydWUgfVxuICBpZiAocHJldlR5cGUgPT09IHR5cGVzLmNvbG9uICYmIChwYXJlbnQgPT09IHR5cGVzJDEuYl9zdGF0IHx8IHBhcmVudCA9PT0gdHlwZXMkMS5iX2V4cHIpKVxuICAgIHsgcmV0dXJuICFwYXJlbnQuaXNFeHByIH1cblxuICAvLyBUaGUgY2hlY2sgZm9yIGB0dC5uYW1lICYmIGV4cHJBbGxvd2VkYCBkZXRlY3RzIHdoZXRoZXIgd2UgYXJlXG4gIC8vIGFmdGVyIGEgYHlpZWxkYCBvciBgb2ZgIGNvbnN0cnVjdC4gU2VlIHRoZSBgdXBkYXRlQ29udGV4dGAgZm9yXG4gIC8vIGB0dC5uYW1lYC5cbiAgaWYgKHByZXZUeXBlID09PSB0eXBlcy5fcmV0dXJuIHx8IHByZXZUeXBlID09PSB0eXBlcy5uYW1lICYmIHRoaXMuZXhwckFsbG93ZWQpXG4gICAgeyByZXR1cm4gbGluZUJyZWFrLnRlc3QodGhpcy5pbnB1dC5zbGljZSh0aGlzLmxhc3RUb2tFbmQsIHRoaXMuc3RhcnQpKSB9XG4gIGlmIChwcmV2VHlwZSA9PT0gdHlwZXMuX2Vsc2UgfHwgcHJldlR5cGUgPT09IHR5cGVzLnNlbWkgfHwgcHJldlR5cGUgPT09IHR5cGVzLmVvZiB8fCBwcmV2VHlwZSA9PT0gdHlwZXMucGFyZW5SIHx8IHByZXZUeXBlID09PSB0eXBlcy5hcnJvdylcbiAgICB7IHJldHVybiB0cnVlIH1cbiAgaWYgKHByZXZUeXBlID09PSB0eXBlcy5icmFjZUwpXG4gICAgeyByZXR1cm4gcGFyZW50ID09PSB0eXBlcyQxLmJfc3RhdCB9XG4gIGlmIChwcmV2VHlwZSA9PT0gdHlwZXMuX3ZhciB8fCBwcmV2VHlwZSA9PT0gdHlwZXMuX2NvbnN0IHx8IHByZXZUeXBlID09PSB0eXBlcy5uYW1lKVxuICAgIHsgcmV0dXJuIGZhbHNlIH1cbiAgcmV0dXJuICF0aGlzLmV4cHJBbGxvd2VkXG59O1xuXG5wcCQ3LmluR2VuZXJhdG9yQ29udGV4dCA9IGZ1bmN0aW9uKCkge1xuICBmb3IgKHZhciBpID0gdGhpcy5jb250ZXh0Lmxlbmd0aCAtIDE7IGkgPj0gMTsgaS0tKSB7XG4gICAgdmFyIGNvbnRleHQgPSB0aGlzLmNvbnRleHRbaV07XG4gICAgaWYgKGNvbnRleHQudG9rZW4gPT09IFwiZnVuY3Rpb25cIilcbiAgICAgIHsgcmV0dXJuIGNvbnRleHQuZ2VuZXJhdG9yIH1cbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cbnBwJDcudXBkYXRlQ29udGV4dCA9IGZ1bmN0aW9uKHByZXZUeXBlKSB7XG4gIHZhciB1cGRhdGUsIHR5cGUgPSB0aGlzLnR5cGU7XG4gIGlmICh0eXBlLmtleXdvcmQgJiYgcHJldlR5cGUgPT09IHR5cGVzLmRvdClcbiAgICB7IHRoaXMuZXhwckFsbG93ZWQgPSBmYWxzZTsgfVxuICBlbHNlIGlmICh1cGRhdGUgPSB0eXBlLnVwZGF0ZUNvbnRleHQpXG4gICAgeyB1cGRhdGUuY2FsbCh0aGlzLCBwcmV2VHlwZSk7IH1cbiAgZWxzZVxuICAgIHsgdGhpcy5leHByQWxsb3dlZCA9IHR5cGUuYmVmb3JlRXhwcjsgfVxufTtcblxuLy8gVG9rZW4tc3BlY2lmaWMgY29udGV4dCB1cGRhdGUgY29kZVxuXG50eXBlcy5wYXJlblIudXBkYXRlQ29udGV4dCA9IHR5cGVzLmJyYWNlUi51cGRhdGVDb250ZXh0ID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLmNvbnRleHQubGVuZ3RoID09PSAxKSB7XG4gICAgdGhpcy5leHByQWxsb3dlZCA9IHRydWU7XG4gICAgcmV0dXJuXG4gIH1cbiAgdmFyIG91dCA9IHRoaXMuY29udGV4dC5wb3AoKTtcbiAgaWYgKG91dCA9PT0gdHlwZXMkMS5iX3N0YXQgJiYgdGhpcy5jdXJDb250ZXh0KCkudG9rZW4gPT09IFwiZnVuY3Rpb25cIikge1xuICAgIG91dCA9IHRoaXMuY29udGV4dC5wb3AoKTtcbiAgfVxuICB0aGlzLmV4cHJBbGxvd2VkID0gIW91dC5pc0V4cHI7XG59O1xuXG50eXBlcy5icmFjZUwudXBkYXRlQ29udGV4dCA9IGZ1bmN0aW9uKHByZXZUeXBlKSB7XG4gIHRoaXMuY29udGV4dC5wdXNoKHRoaXMuYnJhY2VJc0Jsb2NrKHByZXZUeXBlKSA/IHR5cGVzJDEuYl9zdGF0IDogdHlwZXMkMS5iX2V4cHIpO1xuICB0aGlzLmV4cHJBbGxvd2VkID0gdHJ1ZTtcbn07XG5cbnR5cGVzLmRvbGxhckJyYWNlTC51cGRhdGVDb250ZXh0ID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuY29udGV4dC5wdXNoKHR5cGVzJDEuYl90bXBsKTtcbiAgdGhpcy5leHByQWxsb3dlZCA9IHRydWU7XG59O1xuXG50eXBlcy5wYXJlbkwudXBkYXRlQ29udGV4dCA9IGZ1bmN0aW9uKHByZXZUeXBlKSB7XG4gIHZhciBzdGF0ZW1lbnRQYXJlbnMgPSBwcmV2VHlwZSA9PT0gdHlwZXMuX2lmIHx8IHByZXZUeXBlID09PSB0eXBlcy5fZm9yIHx8IHByZXZUeXBlID09PSB0eXBlcy5fd2l0aCB8fCBwcmV2VHlwZSA9PT0gdHlwZXMuX3doaWxlO1xuICB0aGlzLmNvbnRleHQucHVzaChzdGF0ZW1lbnRQYXJlbnMgPyB0eXBlcyQxLnBfc3RhdCA6IHR5cGVzJDEucF9leHByKTtcbiAgdGhpcy5leHByQWxsb3dlZCA9IHRydWU7XG59O1xuXG50eXBlcy5pbmNEZWMudXBkYXRlQ29udGV4dCA9IGZ1bmN0aW9uKCkge1xuICAvLyB0b2tFeHByQWxsb3dlZCBzdGF5cyB1bmNoYW5nZWRcbn07XG5cbnR5cGVzLl9mdW5jdGlvbi51cGRhdGVDb250ZXh0ID0gdHlwZXMuX2NsYXNzLnVwZGF0ZUNvbnRleHQgPSBmdW5jdGlvbihwcmV2VHlwZSkge1xuICBpZiAocHJldlR5cGUuYmVmb3JlRXhwciAmJiBwcmV2VHlwZSAhPT0gdHlwZXMuX2Vsc2UgJiZcbiAgICAgICEocHJldlR5cGUgPT09IHR5cGVzLnNlbWkgJiYgdGhpcy5jdXJDb250ZXh0KCkgIT09IHR5cGVzJDEucF9zdGF0KSAmJlxuICAgICAgIShwcmV2VHlwZSA9PT0gdHlwZXMuX3JldHVybiAmJiBsaW5lQnJlYWsudGVzdCh0aGlzLmlucHV0LnNsaWNlKHRoaXMubGFzdFRva0VuZCwgdGhpcy5zdGFydCkpKSAmJlxuICAgICAgISgocHJldlR5cGUgPT09IHR5cGVzLmNvbG9uIHx8IHByZXZUeXBlID09PSB0eXBlcy5icmFjZUwpICYmIHRoaXMuY3VyQ29udGV4dCgpID09PSB0eXBlcyQxLmJfc3RhdCkpXG4gICAgeyB0aGlzLmNvbnRleHQucHVzaCh0eXBlcyQxLmZfZXhwcik7IH1cbiAgZWxzZVxuICAgIHsgdGhpcy5jb250ZXh0LnB1c2godHlwZXMkMS5mX3N0YXQpOyB9XG4gIHRoaXMuZXhwckFsbG93ZWQgPSBmYWxzZTtcbn07XG5cbnR5cGVzLmJhY2tRdW90ZS51cGRhdGVDb250ZXh0ID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLmN1ckNvbnRleHQoKSA9PT0gdHlwZXMkMS5xX3RtcGwpXG4gICAgeyB0aGlzLmNvbnRleHQucG9wKCk7IH1cbiAgZWxzZVxuICAgIHsgdGhpcy5jb250ZXh0LnB1c2godHlwZXMkMS5xX3RtcGwpOyB9XG4gIHRoaXMuZXhwckFsbG93ZWQgPSBmYWxzZTtcbn07XG5cbnR5cGVzLnN0YXIudXBkYXRlQ29udGV4dCA9IGZ1bmN0aW9uKHByZXZUeXBlKSB7XG4gIGlmIChwcmV2VHlwZSA9PT0gdHlwZXMuX2Z1bmN0aW9uKSB7XG4gICAgdmFyIGluZGV4ID0gdGhpcy5jb250ZXh0Lmxlbmd0aCAtIDE7XG4gICAgaWYgKHRoaXMuY29udGV4dFtpbmRleF0gPT09IHR5cGVzJDEuZl9leHByKVxuICAgICAgeyB0aGlzLmNvbnRleHRbaW5kZXhdID0gdHlwZXMkMS5mX2V4cHJfZ2VuOyB9XG4gICAgZWxzZVxuICAgICAgeyB0aGlzLmNvbnRleHRbaW5kZXhdID0gdHlwZXMkMS5mX2dlbjsgfVxuICB9XG4gIHRoaXMuZXhwckFsbG93ZWQgPSB0cnVlO1xufTtcblxudHlwZXMubmFtZS51cGRhdGVDb250ZXh0ID0gZnVuY3Rpb24ocHJldlR5cGUpIHtcbiAgdmFyIGFsbG93ZWQgPSBmYWxzZTtcbiAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2ICYmIHByZXZUeXBlICE9PSB0eXBlcy5kb3QpIHtcbiAgICBpZiAodGhpcy52YWx1ZSA9PT0gXCJvZlwiICYmICF0aGlzLmV4cHJBbGxvd2VkIHx8XG4gICAgICAgIHRoaXMudmFsdWUgPT09IFwieWllbGRcIiAmJiB0aGlzLmluR2VuZXJhdG9yQ29udGV4dCgpKVxuICAgICAgeyBhbGxvd2VkID0gdHJ1ZTsgfVxuICB9XG4gIHRoaXMuZXhwckFsbG93ZWQgPSBhbGxvd2VkO1xufTtcblxuLy8gVGhpcyBmaWxlIGNvbnRhaW5zIFVuaWNvZGUgcHJvcGVydGllcyBleHRyYWN0ZWQgZnJvbSB0aGUgRUNNQVNjcmlwdFxuLy8gc3BlY2lmaWNhdGlvbi4gVGhlIGxpc3RzIGFyZSBleHRyYWN0ZWQgbGlrZSBzbzpcbi8vICQkKCcjdGFibGUtYmluYXJ5LXVuaWNvZGUtcHJvcGVydGllcyA+IGZpZ3VyZSA+IHRhYmxlID4gdGJvZHkgPiB0ciA+IHRkOm50aC1jaGlsZCgxKSBjb2RlJykubWFwKGVsID0+IGVsLmlubmVyVGV4dClcblxuLy8gI3RhYmxlLWJpbmFyeS11bmljb2RlLXByb3BlcnRpZXNcbnZhciBlY21hOUJpbmFyeVByb3BlcnRpZXMgPSBcIkFTQ0lJIEFTQ0lJX0hleF9EaWdpdCBBSGV4IEFscGhhYmV0aWMgQWxwaGEgQW55IEFzc2lnbmVkIEJpZGlfQ29udHJvbCBCaWRpX0MgQmlkaV9NaXJyb3JlZCBCaWRpX00gQ2FzZV9JZ25vcmFibGUgQ0kgQ2FzZWQgQ2hhbmdlc19XaGVuX0Nhc2Vmb2xkZWQgQ1dDRiBDaGFuZ2VzX1doZW5fQ2FzZW1hcHBlZCBDV0NNIENoYW5nZXNfV2hlbl9Mb3dlcmNhc2VkIENXTCBDaGFuZ2VzX1doZW5fTkZLQ19DYXNlZm9sZGVkIENXS0NGIENoYW5nZXNfV2hlbl9UaXRsZWNhc2VkIENXVCBDaGFuZ2VzX1doZW5fVXBwZXJjYXNlZCBDV1UgRGFzaCBEZWZhdWx0X0lnbm9yYWJsZV9Db2RlX1BvaW50IERJIERlcHJlY2F0ZWQgRGVwIERpYWNyaXRpYyBEaWEgRW1vamkgRW1vamlfQ29tcG9uZW50IEVtb2ppX01vZGlmaWVyIEVtb2ppX01vZGlmaWVyX0Jhc2UgRW1vamlfUHJlc2VudGF0aW9uIEV4dGVuZGVyIEV4dCBHcmFwaGVtZV9CYXNlIEdyX0Jhc2UgR3JhcGhlbWVfRXh0ZW5kIEdyX0V4dCBIZXhfRGlnaXQgSGV4IElEU19CaW5hcnlfT3BlcmF0b3IgSURTQiBJRFNfVHJpbmFyeV9PcGVyYXRvciBJRFNUIElEX0NvbnRpbnVlIElEQyBJRF9TdGFydCBJRFMgSWRlb2dyYXBoaWMgSWRlbyBKb2luX0NvbnRyb2wgSm9pbl9DIExvZ2ljYWxfT3JkZXJfRXhjZXB0aW9uIExPRSBMb3dlcmNhc2UgTG93ZXIgTWF0aCBOb25jaGFyYWN0ZXJfQ29kZV9Qb2ludCBOQ2hhciBQYXR0ZXJuX1N5bnRheCBQYXRfU3luIFBhdHRlcm5fV2hpdGVfU3BhY2UgUGF0X1dTIFF1b3RhdGlvbl9NYXJrIFFNYXJrIFJhZGljYWwgUmVnaW9uYWxfSW5kaWNhdG9yIFJJIFNlbnRlbmNlX1Rlcm1pbmFsIFNUZXJtIFNvZnRfRG90dGVkIFNEIFRlcm1pbmFsX1B1bmN0dWF0aW9uIFRlcm0gVW5pZmllZF9JZGVvZ3JhcGggVUlkZW8gVXBwZXJjYXNlIFVwcGVyIFZhcmlhdGlvbl9TZWxlY3RvciBWUyBXaGl0ZV9TcGFjZSBzcGFjZSBYSURfQ29udGludWUgWElEQyBYSURfU3RhcnQgWElEU1wiO1xudmFyIGVjbWExMEJpbmFyeVByb3BlcnRpZXMgPSBlY21hOUJpbmFyeVByb3BlcnRpZXMgKyBcIiBFeHRlbmRlZF9QaWN0b2dyYXBoaWNcIjtcbnZhciBlY21hMTFCaW5hcnlQcm9wZXJ0aWVzID0gZWNtYTEwQmluYXJ5UHJvcGVydGllcztcbnZhciBlY21hMTJCaW5hcnlQcm9wZXJ0aWVzID0gZWNtYTExQmluYXJ5UHJvcGVydGllcyArIFwiIEVCYXNlIEVDb21wIEVNb2QgRVByZXMgRXh0UGljdFwiO1xudmFyIHVuaWNvZGVCaW5hcnlQcm9wZXJ0aWVzID0ge1xuICA5OiBlY21hOUJpbmFyeVByb3BlcnRpZXMsXG4gIDEwOiBlY21hMTBCaW5hcnlQcm9wZXJ0aWVzLFxuICAxMTogZWNtYTExQmluYXJ5UHJvcGVydGllcyxcbiAgMTI6IGVjbWExMkJpbmFyeVByb3BlcnRpZXNcbn07XG5cbi8vICN0YWJsZS11bmljb2RlLWdlbmVyYWwtY2F0ZWdvcnktdmFsdWVzXG52YXIgdW5pY29kZUdlbmVyYWxDYXRlZ29yeVZhbHVlcyA9IFwiQ2FzZWRfTGV0dGVyIExDIENsb3NlX1B1bmN0dWF0aW9uIFBlIENvbm5lY3Rvcl9QdW5jdHVhdGlvbiBQYyBDb250cm9sIENjIGNudHJsIEN1cnJlbmN5X1N5bWJvbCBTYyBEYXNoX1B1bmN0dWF0aW9uIFBkIERlY2ltYWxfTnVtYmVyIE5kIGRpZ2l0IEVuY2xvc2luZ19NYXJrIE1lIEZpbmFsX1B1bmN0dWF0aW9uIFBmIEZvcm1hdCBDZiBJbml0aWFsX1B1bmN0dWF0aW9uIFBpIExldHRlciBMIExldHRlcl9OdW1iZXIgTmwgTGluZV9TZXBhcmF0b3IgWmwgTG93ZXJjYXNlX0xldHRlciBMbCBNYXJrIE0gQ29tYmluaW5nX01hcmsgTWF0aF9TeW1ib2wgU20gTW9kaWZpZXJfTGV0dGVyIExtIE1vZGlmaWVyX1N5bWJvbCBTayBOb25zcGFjaW5nX01hcmsgTW4gTnVtYmVyIE4gT3Blbl9QdW5jdHVhdGlvbiBQcyBPdGhlciBDIE90aGVyX0xldHRlciBMbyBPdGhlcl9OdW1iZXIgTm8gT3RoZXJfUHVuY3R1YXRpb24gUG8gT3RoZXJfU3ltYm9sIFNvIFBhcmFncmFwaF9TZXBhcmF0b3IgWnAgUHJpdmF0ZV9Vc2UgQ28gUHVuY3R1YXRpb24gUCBwdW5jdCBTZXBhcmF0b3IgWiBTcGFjZV9TZXBhcmF0b3IgWnMgU3BhY2luZ19NYXJrIE1jIFN1cnJvZ2F0ZSBDcyBTeW1ib2wgUyBUaXRsZWNhc2VfTGV0dGVyIEx0IFVuYXNzaWduZWQgQ24gVXBwZXJjYXNlX0xldHRlciBMdVwiO1xuXG4vLyAjdGFibGUtdW5pY29kZS1zY3JpcHQtdmFsdWVzXG52YXIgZWNtYTlTY3JpcHRWYWx1ZXMgPSBcIkFkbGFtIEFkbG0gQWhvbSBBaG9tIEFuYXRvbGlhbl9IaWVyb2dseXBocyBIbHV3IEFyYWJpYyBBcmFiIEFybWVuaWFuIEFybW4gQXZlc3RhbiBBdnN0IEJhbGluZXNlIEJhbGkgQmFtdW0gQmFtdSBCYXNzYV9WYWggQmFzcyBCYXRhayBCYXRrIEJlbmdhbGkgQmVuZyBCaGFpa3N1a2kgQmhrcyBCb3BvbW9mbyBCb3BvIEJyYWhtaSBCcmFoIEJyYWlsbGUgQnJhaSBCdWdpbmVzZSBCdWdpIEJ1aGlkIEJ1aGQgQ2FuYWRpYW5fQWJvcmlnaW5hbCBDYW5zIENhcmlhbiBDYXJpIENhdWNhc2lhbl9BbGJhbmlhbiBBZ2hiIENoYWttYSBDYWttIENoYW0gQ2hhbSBDaGVyb2tlZSBDaGVyIENvbW1vbiBaeXl5IENvcHRpYyBDb3B0IFFhYWMgQ3VuZWlmb3JtIFhzdXggQ3lwcmlvdCBDcHJ0IEN5cmlsbGljIEN5cmwgRGVzZXJldCBEc3J0IERldmFuYWdhcmkgRGV2YSBEdXBsb3lhbiBEdXBsIEVneXB0aWFuX0hpZXJvZ2x5cGhzIEVneXAgRWxiYXNhbiBFbGJhIEV0aGlvcGljIEV0aGkgR2VvcmdpYW4gR2VvciBHbGFnb2xpdGljIEdsYWcgR290aGljIEdvdGggR3JhbnRoYSBHcmFuIEdyZWVrIEdyZWsgR3VqYXJhdGkgR3VqciBHdXJtdWtoaSBHdXJ1IEhhbiBIYW5pIEhhbmd1bCBIYW5nIEhhbnVub28gSGFubyBIYXRyYW4gSGF0ciBIZWJyZXcgSGViciBIaXJhZ2FuYSBIaXJhIEltcGVyaWFsX0FyYW1haWMgQXJtaSBJbmhlcml0ZWQgWmluaCBRYWFpIEluc2NyaXB0aW9uYWxfUGFobGF2aSBQaGxpIEluc2NyaXB0aW9uYWxfUGFydGhpYW4gUHJ0aSBKYXZhbmVzZSBKYXZhIEthaXRoaSBLdGhpIEthbm5hZGEgS25kYSBLYXRha2FuYSBLYW5hIEtheWFoX0xpIEthbGkgS2hhcm9zaHRoaSBLaGFyIEtobWVyIEtobXIgS2hvamtpIEtob2ogS2h1ZGF3YWRpIFNpbmQgTGFvIExhb28gTGF0aW4gTGF0biBMZXBjaGEgTGVwYyBMaW1idSBMaW1iIExpbmVhcl9BIExpbmEgTGluZWFyX0IgTGluYiBMaXN1IExpc3UgTHljaWFuIEx5Y2kgTHlkaWFuIEx5ZGkgTWFoYWphbmkgTWFoaiBNYWxheWFsYW0gTWx5bSBNYW5kYWljIE1hbmQgTWFuaWNoYWVhbiBNYW5pIE1hcmNoZW4gTWFyYyBNYXNhcmFtX0dvbmRpIEdvbm0gTWVldGVpX01heWVrIE10ZWkgTWVuZGVfS2lrYWt1aSBNZW5kIE1lcm9pdGljX0N1cnNpdmUgTWVyYyBNZXJvaXRpY19IaWVyb2dseXBocyBNZXJvIE1pYW8gUGxyZCBNb2RpIE1vZGkgTW9uZ29saWFuIE1vbmcgTXJvIE1yb28gTXVsdGFuaSBNdWx0IE15YW5tYXIgTXltciBOYWJhdGFlYW4gTmJhdCBOZXdfVGFpX0x1ZSBUYWx1IE5ld2EgTmV3YSBOa28gTmtvbyBOdXNodSBOc2h1IE9naGFtIE9nYW0gT2xfQ2hpa2kgT2xjayBPbGRfSHVuZ2FyaWFuIEh1bmcgT2xkX0l0YWxpYyBJdGFsIE9sZF9Ob3J0aF9BcmFiaWFuIE5hcmIgT2xkX1Blcm1pYyBQZXJtIE9sZF9QZXJzaWFuIFhwZW8gT2xkX1NvdXRoX0FyYWJpYW4gU2FyYiBPbGRfVHVya2ljIE9ya2ggT3JpeWEgT3J5YSBPc2FnZSBPc2dlIE9zbWFueWEgT3NtYSBQYWhhd2hfSG1vbmcgSG1uZyBQYWxteXJlbmUgUGFsbSBQYXVfQ2luX0hhdSBQYXVjIFBoYWdzX1BhIFBoYWcgUGhvZW5pY2lhbiBQaG54IFBzYWx0ZXJfUGFobGF2aSBQaGxwIFJlamFuZyBSam5nIFJ1bmljIFJ1bnIgU2FtYXJpdGFuIFNhbXIgU2F1cmFzaHRyYSBTYXVyIFNoYXJhZGEgU2hyZCBTaGF2aWFuIFNoYXcgU2lkZGhhbSBTaWRkIFNpZ25Xcml0aW5nIFNnbncgU2luaGFsYSBTaW5oIFNvcmFfU29tcGVuZyBTb3JhIFNveW9tYm8gU295byBTdW5kYW5lc2UgU3VuZCBTeWxvdGlfTmFncmkgU3lsbyBTeXJpYWMgU3lyYyBUYWdhbG9nIFRnbGcgVGFnYmFud2EgVGFnYiBUYWlfTGUgVGFsZSBUYWlfVGhhbSBMYW5hIFRhaV9WaWV0IFRhdnQgVGFrcmkgVGFrciBUYW1pbCBUYW1sIFRhbmd1dCBUYW5nIFRlbHVndSBUZWx1IFRoYWFuYSBUaGFhIFRoYWkgVGhhaSBUaWJldGFuIFRpYnQgVGlmaW5hZ2ggVGZuZyBUaXJodXRhIFRpcmggVWdhcml0aWMgVWdhciBWYWkgVmFpaSBXYXJhbmdfQ2l0aSBXYXJhIFlpIFlpaWkgWmFuYWJhemFyX1NxdWFyZSBaYW5iXCI7XG52YXIgZWNtYTEwU2NyaXB0VmFsdWVzID0gZWNtYTlTY3JpcHRWYWx1ZXMgKyBcIiBEb2dyYSBEb2dyIEd1bmphbGFfR29uZGkgR29uZyBIYW5pZmlfUm9oaW5neWEgUm9oZyBNYWthc2FyIE1ha2EgTWVkZWZhaWRyaW4gTWVkZiBPbGRfU29nZGlhbiBTb2dvIFNvZ2RpYW4gU29nZFwiO1xudmFyIGVjbWExMVNjcmlwdFZhbHVlcyA9IGVjbWExMFNjcmlwdFZhbHVlcyArIFwiIEVseW1haWMgRWx5bSBOYW5kaW5hZ2FyaSBOYW5kIE55aWFrZW5nX1B1YWNodWVfSG1vbmcgSG1ucCBXYW5jaG8gV2Nob1wiO1xudmFyIGVjbWExMlNjcmlwdFZhbHVlcyA9IGVjbWExMVNjcmlwdFZhbHVlcyArIFwiIENob3Jhc21pYW4gQ2hycyBEaWFrIERpdmVzX0FrdXJ1IEtoaXRhbl9TbWFsbF9TY3JpcHQgS2l0cyBZZXppIFllemlkaVwiO1xudmFyIHVuaWNvZGVTY3JpcHRWYWx1ZXMgPSB7XG4gIDk6IGVjbWE5U2NyaXB0VmFsdWVzLFxuICAxMDogZWNtYTEwU2NyaXB0VmFsdWVzLFxuICAxMTogZWNtYTExU2NyaXB0VmFsdWVzLFxuICAxMjogZWNtYTEyU2NyaXB0VmFsdWVzXG59O1xuXG52YXIgZGF0YSA9IHt9O1xuZnVuY3Rpb24gYnVpbGRVbmljb2RlRGF0YShlY21hVmVyc2lvbikge1xuICB2YXIgZCA9IGRhdGFbZWNtYVZlcnNpb25dID0ge1xuICAgIGJpbmFyeTogd29yZHNSZWdleHAodW5pY29kZUJpbmFyeVByb3BlcnRpZXNbZWNtYVZlcnNpb25dICsgXCIgXCIgKyB1bmljb2RlR2VuZXJhbENhdGVnb3J5VmFsdWVzKSxcbiAgICBub25CaW5hcnk6IHtcbiAgICAgIEdlbmVyYWxfQ2F0ZWdvcnk6IHdvcmRzUmVnZXhwKHVuaWNvZGVHZW5lcmFsQ2F0ZWdvcnlWYWx1ZXMpLFxuICAgICAgU2NyaXB0OiB3b3Jkc1JlZ2V4cCh1bmljb2RlU2NyaXB0VmFsdWVzW2VjbWFWZXJzaW9uXSlcbiAgICB9XG4gIH07XG4gIGQubm9uQmluYXJ5LlNjcmlwdF9FeHRlbnNpb25zID0gZC5ub25CaW5hcnkuU2NyaXB0O1xuXG4gIGQubm9uQmluYXJ5LmdjID0gZC5ub25CaW5hcnkuR2VuZXJhbF9DYXRlZ29yeTtcbiAgZC5ub25CaW5hcnkuc2MgPSBkLm5vbkJpbmFyeS5TY3JpcHQ7XG4gIGQubm9uQmluYXJ5LnNjeCA9IGQubm9uQmluYXJ5LlNjcmlwdF9FeHRlbnNpb25zO1xufVxuYnVpbGRVbmljb2RlRGF0YSg5KTtcbmJ1aWxkVW5pY29kZURhdGEoMTApO1xuYnVpbGRVbmljb2RlRGF0YSgxMSk7XG5idWlsZFVuaWNvZGVEYXRhKDEyKTtcblxudmFyIHBwJDggPSBQYXJzZXIucHJvdG90eXBlO1xuXG52YXIgUmVnRXhwVmFsaWRhdGlvblN0YXRlID0gZnVuY3Rpb24gUmVnRXhwVmFsaWRhdGlvblN0YXRlKHBhcnNlcikge1xuICB0aGlzLnBhcnNlciA9IHBhcnNlcjtcbiAgdGhpcy52YWxpZEZsYWdzID0gXCJnaW1cIiArIChwYXJzZXIub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2ID8gXCJ1eVwiIDogXCJcIikgKyAocGFyc2VyLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gOSA/IFwic1wiIDogXCJcIikgKyAocGFyc2VyLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gMTMgPyBcImRcIiA6IFwiXCIpO1xuICB0aGlzLnVuaWNvZGVQcm9wZXJ0aWVzID0gZGF0YVtwYXJzZXIub3B0aW9ucy5lY21hVmVyc2lvbiA+PSAxMiA/IDEyIDogcGFyc2VyLm9wdGlvbnMuZWNtYVZlcnNpb25dO1xuICB0aGlzLnNvdXJjZSA9IFwiXCI7XG4gIHRoaXMuZmxhZ3MgPSBcIlwiO1xuICB0aGlzLnN0YXJ0ID0gMDtcbiAgdGhpcy5zd2l0Y2hVID0gZmFsc2U7XG4gIHRoaXMuc3dpdGNoTiA9IGZhbHNlO1xuICB0aGlzLnBvcyA9IDA7XG4gIHRoaXMubGFzdEludFZhbHVlID0gMDtcbiAgdGhpcy5sYXN0U3RyaW5nVmFsdWUgPSBcIlwiO1xuICB0aGlzLmxhc3RBc3NlcnRpb25Jc1F1YW50aWZpYWJsZSA9IGZhbHNlO1xuICB0aGlzLm51bUNhcHR1cmluZ1BhcmVucyA9IDA7XG4gIHRoaXMubWF4QmFja1JlZmVyZW5jZSA9IDA7XG4gIHRoaXMuZ3JvdXBOYW1lcyA9IFtdO1xuICB0aGlzLmJhY2tSZWZlcmVuY2VOYW1lcyA9IFtdO1xufTtcblxuUmVnRXhwVmFsaWRhdGlvblN0YXRlLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uIHJlc2V0IChzdGFydCwgcGF0dGVybiwgZmxhZ3MpIHtcbiAgdmFyIHVuaWNvZGUgPSBmbGFncy5pbmRleE9mKFwidVwiKSAhPT0gLTE7XG4gIHRoaXMuc3RhcnQgPSBzdGFydCB8IDA7XG4gIHRoaXMuc291cmNlID0gcGF0dGVybiArIFwiXCI7XG4gIHRoaXMuZmxhZ3MgPSBmbGFncztcbiAgdGhpcy5zd2l0Y2hVID0gdW5pY29kZSAmJiB0aGlzLnBhcnNlci5vcHRpb25zLmVjbWFWZXJzaW9uID49IDY7XG4gIHRoaXMuc3dpdGNoTiA9IHVuaWNvZGUgJiYgdGhpcy5wYXJzZXIub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA5O1xufTtcblxuUmVnRXhwVmFsaWRhdGlvblN0YXRlLnByb3RvdHlwZS5yYWlzZSA9IGZ1bmN0aW9uIHJhaXNlIChtZXNzYWdlKSB7XG4gIHRoaXMucGFyc2VyLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5zdGFydCwgKFwiSW52YWxpZCByZWd1bGFyIGV4cHJlc3Npb246IC9cIiArICh0aGlzLnNvdXJjZSkgKyBcIi86IFwiICsgbWVzc2FnZSkpO1xufTtcblxuLy8gSWYgdSBmbGFnIGlzIGdpdmVuLCB0aGlzIHJldHVybnMgdGhlIGNvZGUgcG9pbnQgYXQgdGhlIGluZGV4IChpdCBjb21iaW5lcyBhIHN1cnJvZ2F0ZSBwYWlyKS5cbi8vIE90aGVyd2lzZSwgdGhpcyByZXR1cm5zIHRoZSBjb2RlIHVuaXQgb2YgdGhlIGluZGV4IChjYW4gYmUgYSBwYXJ0IG9mIGEgc3Vycm9nYXRlIHBhaXIpLlxuUmVnRXhwVmFsaWRhdGlvblN0YXRlLnByb3RvdHlwZS5hdCA9IGZ1bmN0aW9uIGF0IChpLCBmb3JjZVUpIHtcbiAgICBpZiAoIGZvcmNlVSA9PT0gdm9pZCAwICkgZm9yY2VVID0gZmFsc2U7XG5cbiAgdmFyIHMgPSB0aGlzLnNvdXJjZTtcbiAgdmFyIGwgPSBzLmxlbmd0aDtcbiAgaWYgKGkgPj0gbCkge1xuICAgIHJldHVybiAtMVxuICB9XG4gIHZhciBjID0gcy5jaGFyQ29kZUF0KGkpO1xuICBpZiAoIShmb3JjZVUgfHwgdGhpcy5zd2l0Y2hVKSB8fCBjIDw9IDB4RDdGRiB8fCBjID49IDB4RTAwMCB8fCBpICsgMSA+PSBsKSB7XG4gICAgcmV0dXJuIGNcbiAgfVxuICB2YXIgbmV4dCA9IHMuY2hhckNvZGVBdChpICsgMSk7XG4gIHJldHVybiBuZXh0ID49IDB4REMwMCAmJiBuZXh0IDw9IDB4REZGRiA/IChjIDw8IDEwKSArIG5leHQgLSAweDM1RkRDMDAgOiBjXG59O1xuXG5SZWdFeHBWYWxpZGF0aW9uU3RhdGUucHJvdG90eXBlLm5leHRJbmRleCA9IGZ1bmN0aW9uIG5leHRJbmRleCAoaSwgZm9yY2VVKSB7XG4gICAgaWYgKCBmb3JjZVUgPT09IHZvaWQgMCApIGZvcmNlVSA9IGZhbHNlO1xuXG4gIHZhciBzID0gdGhpcy5zb3VyY2U7XG4gIHZhciBsID0gcy5sZW5ndGg7XG4gIGlmIChpID49IGwpIHtcbiAgICByZXR1cm4gbFxuICB9XG4gIHZhciBjID0gcy5jaGFyQ29kZUF0KGkpLCBuZXh0O1xuICBpZiAoIShmb3JjZVUgfHwgdGhpcy5zd2l0Y2hVKSB8fCBjIDw9IDB4RDdGRiB8fCBjID49IDB4RTAwMCB8fCBpICsgMSA+PSBsIHx8XG4gICAgICAobmV4dCA9IHMuY2hhckNvZGVBdChpICsgMSkpIDwgMHhEQzAwIHx8IG5leHQgPiAweERGRkYpIHtcbiAgICByZXR1cm4gaSArIDFcbiAgfVxuICByZXR1cm4gaSArIDJcbn07XG5cblJlZ0V4cFZhbGlkYXRpb25TdGF0ZS5wcm90b3R5cGUuY3VycmVudCA9IGZ1bmN0aW9uIGN1cnJlbnQgKGZvcmNlVSkge1xuICAgIGlmICggZm9yY2VVID09PSB2b2lkIDAgKSBmb3JjZVUgPSBmYWxzZTtcblxuICByZXR1cm4gdGhpcy5hdCh0aGlzLnBvcywgZm9yY2VVKVxufTtcblxuUmVnRXhwVmFsaWRhdGlvblN0YXRlLnByb3RvdHlwZS5sb29rYWhlYWQgPSBmdW5jdGlvbiBsb29rYWhlYWQgKGZvcmNlVSkge1xuICAgIGlmICggZm9yY2VVID09PSB2b2lkIDAgKSBmb3JjZVUgPSBmYWxzZTtcblxuICByZXR1cm4gdGhpcy5hdCh0aGlzLm5leHRJbmRleCh0aGlzLnBvcywgZm9yY2VVKSwgZm9yY2VVKVxufTtcblxuUmVnRXhwVmFsaWRhdGlvblN0YXRlLnByb3RvdHlwZS5hZHZhbmNlID0gZnVuY3Rpb24gYWR2YW5jZSAoZm9yY2VVKSB7XG4gICAgaWYgKCBmb3JjZVUgPT09IHZvaWQgMCApIGZvcmNlVSA9IGZhbHNlO1xuXG4gIHRoaXMucG9zID0gdGhpcy5uZXh0SW5kZXgodGhpcy5wb3MsIGZvcmNlVSk7XG59O1xuXG5SZWdFeHBWYWxpZGF0aW9uU3RhdGUucHJvdG90eXBlLmVhdCA9IGZ1bmN0aW9uIGVhdCAoY2gsIGZvcmNlVSkge1xuICAgIGlmICggZm9yY2VVID09PSB2b2lkIDAgKSBmb3JjZVUgPSBmYWxzZTtcblxuICBpZiAodGhpcy5jdXJyZW50KGZvcmNlVSkgPT09IGNoKSB7XG4gICAgdGhpcy5hZHZhbmNlKGZvcmNlVSk7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cbmZ1bmN0aW9uIGNvZGVQb2ludFRvU3RyaW5nKGNoKSB7XG4gIGlmIChjaCA8PSAweEZGRkYpIHsgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpIH1cbiAgY2ggLT0gMHgxMDAwMDtcbiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoKGNoID4+IDEwKSArIDB4RDgwMCwgKGNoICYgMHgwM0ZGKSArIDB4REMwMClcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGUgZmxhZ3MgcGFydCBvZiBhIGdpdmVuIFJlZ0V4cExpdGVyYWwuXG4gKlxuICogQHBhcmFtIHtSZWdFeHBWYWxpZGF0aW9uU3RhdGV9IHN0YXRlIFRoZSBzdGF0ZSB0byB2YWxpZGF0ZSBSZWdFeHAuXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xucHAkOC52YWxpZGF0ZVJlZ0V4cEZsYWdzID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgdmFyIHZhbGlkRmxhZ3MgPSBzdGF0ZS52YWxpZEZsYWdzO1xuICB2YXIgZmxhZ3MgPSBzdGF0ZS5mbGFncztcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGZsYWdzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGZsYWcgPSBmbGFncy5jaGFyQXQoaSk7XG4gICAgaWYgKHZhbGlkRmxhZ3MuaW5kZXhPZihmbGFnKSA9PT0gLTEpIHtcbiAgICAgIHRoaXMucmFpc2Uoc3RhdGUuc3RhcnQsIFwiSW52YWxpZCByZWd1bGFyIGV4cHJlc3Npb24gZmxhZ1wiKTtcbiAgICB9XG4gICAgaWYgKGZsYWdzLmluZGV4T2YoZmxhZywgaSArIDEpID4gLTEpIHtcbiAgICAgIHRoaXMucmFpc2Uoc3RhdGUuc3RhcnQsIFwiRHVwbGljYXRlIHJlZ3VsYXIgZXhwcmVzc2lvbiBmbGFnXCIpO1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGUgcGF0dGVybiBwYXJ0IG9mIGEgZ2l2ZW4gUmVnRXhwTGl0ZXJhbC5cbiAqXG4gKiBAcGFyYW0ge1JlZ0V4cFZhbGlkYXRpb25TdGF0ZX0gc3RhdGUgVGhlIHN0YXRlIHRvIHZhbGlkYXRlIFJlZ0V4cC5cbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5wcCQ4LnZhbGlkYXRlUmVnRXhwUGF0dGVybiA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHRoaXMucmVnZXhwX3BhdHRlcm4oc3RhdGUpO1xuXG4gIC8vIFRoZSBnb2FsIHN5bWJvbCBmb3IgdGhlIHBhcnNlIGlzIHxQYXR0ZXJuW35VLCB+Tl18LiBJZiB0aGUgcmVzdWx0IG9mXG4gIC8vIHBhcnNpbmcgY29udGFpbnMgYSB8R3JvdXBOYW1lfCwgcmVwYXJzZSB3aXRoIHRoZSBnb2FsIHN5bWJvbFxuICAvLyB8UGF0dGVyblt+VSwgK05dfCBhbmQgdXNlIHRoaXMgcmVzdWx0IGluc3RlYWQuIFRocm93IGEgKlN5bnRheEVycm9yKlxuICAvLyBleGNlcHRpb24gaWYgX1BfIGRpZCBub3QgY29uZm9ybSB0byB0aGUgZ3JhbW1hciwgaWYgYW55IGVsZW1lbnRzIG9mIF9QX1xuICAvLyB3ZXJlIG5vdCBtYXRjaGVkIGJ5IHRoZSBwYXJzZSwgb3IgaWYgYW55IEVhcmx5IEVycm9yIGNvbmRpdGlvbnMgZXhpc3QuXG4gIGlmICghc3RhdGUuc3dpdGNoTiAmJiB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gOSAmJiBzdGF0ZS5ncm91cE5hbWVzLmxlbmd0aCA+IDApIHtcbiAgICBzdGF0ZS5zd2l0Y2hOID0gdHJ1ZTtcbiAgICB0aGlzLnJlZ2V4cF9wYXR0ZXJuKHN0YXRlKTtcbiAgfVxufTtcblxuLy8gaHR0cHM6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi84LjAvI3Byb2QtUGF0dGVyblxucHAkOC5yZWdleHBfcGF0dGVybiA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHN0YXRlLnBvcyA9IDA7XG4gIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IDA7XG4gIHN0YXRlLmxhc3RTdHJpbmdWYWx1ZSA9IFwiXCI7XG4gIHN0YXRlLmxhc3RBc3NlcnRpb25Jc1F1YW50aWZpYWJsZSA9IGZhbHNlO1xuICBzdGF0ZS5udW1DYXB0dXJpbmdQYXJlbnMgPSAwO1xuICBzdGF0ZS5tYXhCYWNrUmVmZXJlbmNlID0gMDtcbiAgc3RhdGUuZ3JvdXBOYW1lcy5sZW5ndGggPSAwO1xuICBzdGF0ZS5iYWNrUmVmZXJlbmNlTmFtZXMubGVuZ3RoID0gMDtcblxuICB0aGlzLnJlZ2V4cF9kaXNqdW5jdGlvbihzdGF0ZSk7XG5cbiAgaWYgKHN0YXRlLnBvcyAhPT0gc3RhdGUuc291cmNlLmxlbmd0aCkge1xuICAgIC8vIE1ha2UgdGhlIHNhbWUgbWVzc2FnZXMgYXMgVjguXG4gICAgaWYgKHN0YXRlLmVhdCgweDI5IC8qICkgKi8pKSB7XG4gICAgICBzdGF0ZS5yYWlzZShcIlVubWF0Y2hlZCAnKSdcIik7XG4gICAgfVxuICAgIGlmIChzdGF0ZS5lYXQoMHg1RCAvKiBdICovKSB8fCBzdGF0ZS5lYXQoMHg3RCAvKiB9ICovKSkge1xuICAgICAgc3RhdGUucmFpc2UoXCJMb25lIHF1YW50aWZpZXIgYnJhY2tldHNcIik7XG4gICAgfVxuICB9XG4gIGlmIChzdGF0ZS5tYXhCYWNrUmVmZXJlbmNlID4gc3RhdGUubnVtQ2FwdHVyaW5nUGFyZW5zKSB7XG4gICAgc3RhdGUucmFpc2UoXCJJbnZhbGlkIGVzY2FwZVwiKTtcbiAgfVxuICBmb3IgKHZhciBpID0gMCwgbGlzdCA9IHN0YXRlLmJhY2tSZWZlcmVuY2VOYW1lczsgaSA8IGxpc3QubGVuZ3RoOyBpICs9IDEpIHtcbiAgICB2YXIgbmFtZSA9IGxpc3RbaV07XG5cbiAgICBpZiAoc3RhdGUuZ3JvdXBOYW1lcy5pbmRleE9mKG5hbWUpID09PSAtMSkge1xuICAgICAgc3RhdGUucmFpc2UoXCJJbnZhbGlkIG5hbWVkIGNhcHR1cmUgcmVmZXJlbmNlZFwiKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLURpc2p1bmN0aW9uXG5wcCQ4LnJlZ2V4cF9kaXNqdW5jdGlvbiA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHRoaXMucmVnZXhwX2FsdGVybmF0aXZlKHN0YXRlKTtcbiAgd2hpbGUgKHN0YXRlLmVhdCgweDdDIC8qIHwgKi8pKSB7XG4gICAgdGhpcy5yZWdleHBfYWx0ZXJuYXRpdmUoc3RhdGUpO1xuICB9XG5cbiAgLy8gTWFrZSB0aGUgc2FtZSBtZXNzYWdlIGFzIFY4LlxuICBpZiAodGhpcy5yZWdleHBfZWF0UXVhbnRpZmllcihzdGF0ZSwgdHJ1ZSkpIHtcbiAgICBzdGF0ZS5yYWlzZShcIk5vdGhpbmcgdG8gcmVwZWF0XCIpO1xuICB9XG4gIGlmIChzdGF0ZS5lYXQoMHg3QiAvKiB7ICovKSkge1xuICAgIHN0YXRlLnJhaXNlKFwiTG9uZSBxdWFudGlmaWVyIGJyYWNrZXRzXCIpO1xuICB9XG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1BbHRlcm5hdGl2ZVxucHAkOC5yZWdleHBfYWx0ZXJuYXRpdmUgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB3aGlsZSAoc3RhdGUucG9zIDwgc3RhdGUuc291cmNlLmxlbmd0aCAmJiB0aGlzLnJlZ2V4cF9lYXRUZXJtKHN0YXRlKSlcbiAgICB7IH1cbn07XG5cbi8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLWFubmV4Qi1UZXJtXG5wcCQ4LnJlZ2V4cF9lYXRUZXJtID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgaWYgKHRoaXMucmVnZXhwX2VhdEFzc2VydGlvbihzdGF0ZSkpIHtcbiAgICAvLyBIYW5kbGUgYFF1YW50aWZpYWJsZUFzc2VydGlvbiBRdWFudGlmaWVyYCBhbHRlcm5hdGl2ZS5cbiAgICAvLyBgc3RhdGUubGFzdEFzc2VydGlvbklzUXVhbnRpZmlhYmxlYCBpcyB0cnVlIGlmIHRoZSBsYXN0IGVhdGVuIEFzc2VydGlvblxuICAgIC8vIGlzIGEgUXVhbnRpZmlhYmxlQXNzZXJ0aW9uLlxuICAgIGlmIChzdGF0ZS5sYXN0QXNzZXJ0aW9uSXNRdWFudGlmaWFibGUgJiYgdGhpcy5yZWdleHBfZWF0UXVhbnRpZmllcihzdGF0ZSkpIHtcbiAgICAgIC8vIE1ha2UgdGhlIHNhbWUgbWVzc2FnZSBhcyBWOC5cbiAgICAgIGlmIChzdGF0ZS5zd2l0Y2hVKSB7XG4gICAgICAgIHN0YXRlLnJhaXNlKFwiSW52YWxpZCBxdWFudGlmaWVyXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgaWYgKHN0YXRlLnN3aXRjaFUgPyB0aGlzLnJlZ2V4cF9lYXRBdG9tKHN0YXRlKSA6IHRoaXMucmVnZXhwX2VhdEV4dGVuZGVkQXRvbShzdGF0ZSkpIHtcbiAgICB0aGlzLnJlZ2V4cF9lYXRRdWFudGlmaWVyKHN0YXRlKTtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1hbm5leEItQXNzZXJ0aW9uXG5wcCQ4LnJlZ2V4cF9lYXRBc3NlcnRpb24gPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgc3RhcnQgPSBzdGF0ZS5wb3M7XG4gIHN0YXRlLmxhc3RBc3NlcnRpb25Jc1F1YW50aWZpYWJsZSA9IGZhbHNlO1xuXG4gIC8vIF4sICRcbiAgaWYgKHN0YXRlLmVhdCgweDVFIC8qIF4gKi8pIHx8IHN0YXRlLmVhdCgweDI0IC8qICQgKi8pKSB7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIC8vIFxcYiBcXEJcbiAgaWYgKHN0YXRlLmVhdCgweDVDIC8qIFxcICovKSkge1xuICAgIGlmIChzdGF0ZS5lYXQoMHg0MiAvKiBCICovKSB8fCBzdGF0ZS5lYXQoMHg2MiAvKiBiICovKSkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgc3RhdGUucG9zID0gc3RhcnQ7XG4gIH1cblxuICAvLyBMb29rYWhlYWQgLyBMb29rYmVoaW5kXG4gIGlmIChzdGF0ZS5lYXQoMHgyOCAvKiAoICovKSAmJiBzdGF0ZS5lYXQoMHgzRiAvKiA/ICovKSkge1xuICAgIHZhciBsb29rYmVoaW5kID0gZmFsc2U7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA5KSB7XG4gICAgICBsb29rYmVoaW5kID0gc3RhdGUuZWF0KDB4M0MgLyogPCAqLyk7XG4gICAgfVxuICAgIGlmIChzdGF0ZS5lYXQoMHgzRCAvKiA9ICovKSB8fCBzdGF0ZS5lYXQoMHgyMSAvKiAhICovKSkge1xuICAgICAgdGhpcy5yZWdleHBfZGlzanVuY3Rpb24oc3RhdGUpO1xuICAgICAgaWYgKCFzdGF0ZS5lYXQoMHgyOSAvKiApICovKSkge1xuICAgICAgICBzdGF0ZS5yYWlzZShcIlVudGVybWluYXRlZCBncm91cFwiKTtcbiAgICAgIH1cbiAgICAgIHN0YXRlLmxhc3RBc3NlcnRpb25Jc1F1YW50aWZpYWJsZSA9ICFsb29rYmVoaW5kO1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gIH1cblxuICBzdGF0ZS5wb3MgPSBzdGFydDtcbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1RdWFudGlmaWVyXG5wcCQ4LnJlZ2V4cF9lYXRRdWFudGlmaWVyID0gZnVuY3Rpb24oc3RhdGUsIG5vRXJyb3IpIHtcbiAgaWYgKCBub0Vycm9yID09PSB2b2lkIDAgKSBub0Vycm9yID0gZmFsc2U7XG5cbiAgaWYgKHRoaXMucmVnZXhwX2VhdFF1YW50aWZpZXJQcmVmaXgoc3RhdGUsIG5vRXJyb3IpKSB7XG4gICAgc3RhdGUuZWF0KDB4M0YgLyogPyAqLyk7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cbi8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLVF1YW50aWZpZXJQcmVmaXhcbnBwJDgucmVnZXhwX2VhdFF1YW50aWZpZXJQcmVmaXggPSBmdW5jdGlvbihzdGF0ZSwgbm9FcnJvcikge1xuICByZXR1cm4gKFxuICAgIHN0YXRlLmVhdCgweDJBIC8qICogKi8pIHx8XG4gICAgc3RhdGUuZWF0KDB4MkIgLyogKyAqLykgfHxcbiAgICBzdGF0ZS5lYXQoMHgzRiAvKiA/ICovKSB8fFxuICAgIHRoaXMucmVnZXhwX2VhdEJyYWNlZFF1YW50aWZpZXIoc3RhdGUsIG5vRXJyb3IpXG4gIClcbn07XG5wcCQ4LnJlZ2V4cF9lYXRCcmFjZWRRdWFudGlmaWVyID0gZnVuY3Rpb24oc3RhdGUsIG5vRXJyb3IpIHtcbiAgdmFyIHN0YXJ0ID0gc3RhdGUucG9zO1xuICBpZiAoc3RhdGUuZWF0KDB4N0IgLyogeyAqLykpIHtcbiAgICB2YXIgbWluID0gMCwgbWF4ID0gLTE7XG4gICAgaWYgKHRoaXMucmVnZXhwX2VhdERlY2ltYWxEaWdpdHMoc3RhdGUpKSB7XG4gICAgICBtaW4gPSBzdGF0ZS5sYXN0SW50VmFsdWU7XG4gICAgICBpZiAoc3RhdGUuZWF0KDB4MkMgLyogLCAqLykgJiYgdGhpcy5yZWdleHBfZWF0RGVjaW1hbERpZ2l0cyhzdGF0ZSkpIHtcbiAgICAgICAgbWF4ID0gc3RhdGUubGFzdEludFZhbHVlO1xuICAgICAgfVxuICAgICAgaWYgKHN0YXRlLmVhdCgweDdEIC8qIH0gKi8pKSB7XG4gICAgICAgIC8vIFN5bnRheEVycm9yIGluIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNzZWMtdGVybVxuICAgICAgICBpZiAobWF4ICE9PSAtMSAmJiBtYXggPCBtaW4gJiYgIW5vRXJyb3IpIHtcbiAgICAgICAgICBzdGF0ZS5yYWlzZShcIm51bWJlcnMgb3V0IG9mIG9yZGVyIGluIHt9IHF1YW50aWZpZXJcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHN0YXRlLnN3aXRjaFUgJiYgIW5vRXJyb3IpIHtcbiAgICAgIHN0YXRlLnJhaXNlKFwiSW5jb21wbGV0ZSBxdWFudGlmaWVyXCIpO1xuICAgIH1cbiAgICBzdGF0ZS5wb3MgPSBzdGFydDtcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cbi8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLUF0b21cbnBwJDgucmVnZXhwX2VhdEF0b20gPSBmdW5jdGlvbihzdGF0ZSkge1xuICByZXR1cm4gKFxuICAgIHRoaXMucmVnZXhwX2VhdFBhdHRlcm5DaGFyYWN0ZXJzKHN0YXRlKSB8fFxuICAgIHN0YXRlLmVhdCgweDJFIC8qIC4gKi8pIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0UmV2ZXJzZVNvbGlkdXNBdG9tRXNjYXBlKHN0YXRlKSB8fFxuICAgIHRoaXMucmVnZXhwX2VhdENoYXJhY3RlckNsYXNzKHN0YXRlKSB8fFxuICAgIHRoaXMucmVnZXhwX2VhdFVuY2FwdHVyaW5nR3JvdXAoc3RhdGUpIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0Q2FwdHVyaW5nR3JvdXAoc3RhdGUpXG4gIClcbn07XG5wcCQ4LnJlZ2V4cF9lYXRSZXZlcnNlU29saWR1c0F0b21Fc2NhcGUgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgc3RhcnQgPSBzdGF0ZS5wb3M7XG4gIGlmIChzdGF0ZS5lYXQoMHg1QyAvKiBcXCAqLykpIHtcbiAgICBpZiAodGhpcy5yZWdleHBfZWF0QXRvbUVzY2FwZShzdGF0ZSkpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIHN0YXRlLnBvcyA9IHN0YXJ0O1xuICB9XG4gIHJldHVybiBmYWxzZVxufTtcbnBwJDgucmVnZXhwX2VhdFVuY2FwdHVyaW5nR3JvdXAgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgc3RhcnQgPSBzdGF0ZS5wb3M7XG4gIGlmIChzdGF0ZS5lYXQoMHgyOCAvKiAoICovKSkge1xuICAgIGlmIChzdGF0ZS5lYXQoMHgzRiAvKiA/ICovKSAmJiBzdGF0ZS5lYXQoMHgzQSAvKiA6ICovKSkge1xuICAgICAgdGhpcy5yZWdleHBfZGlzanVuY3Rpb24oc3RhdGUpO1xuICAgICAgaWYgKHN0YXRlLmVhdCgweDI5IC8qICkgKi8pKSB7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgICBzdGF0ZS5yYWlzZShcIlVudGVybWluYXRlZCBncm91cFwiKTtcbiAgICB9XG4gICAgc3RhdGUucG9zID0gc3RhcnQ7XG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59O1xucHAkOC5yZWdleHBfZWF0Q2FwdHVyaW5nR3JvdXAgPSBmdW5jdGlvbihzdGF0ZSkge1xuICBpZiAoc3RhdGUuZWF0KDB4MjggLyogKCAqLykpIHtcbiAgICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDkpIHtcbiAgICAgIHRoaXMucmVnZXhwX2dyb3VwU3BlY2lmaWVyKHN0YXRlKTtcbiAgICB9IGVsc2UgaWYgKHN0YXRlLmN1cnJlbnQoKSA9PT0gMHgzRiAvKiA/ICovKSB7XG4gICAgICBzdGF0ZS5yYWlzZShcIkludmFsaWQgZ3JvdXBcIik7XG4gICAgfVxuICAgIHRoaXMucmVnZXhwX2Rpc2p1bmN0aW9uKHN0YXRlKTtcbiAgICBpZiAoc3RhdGUuZWF0KDB4MjkgLyogKSAqLykpIHtcbiAgICAgIHN0YXRlLm51bUNhcHR1cmluZ1BhcmVucyArPSAxO1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgc3RhdGUucmFpc2UoXCJVbnRlcm1pbmF0ZWQgZ3JvdXBcIik7XG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1hbm5leEItRXh0ZW5kZWRBdG9tXG5wcCQ4LnJlZ2V4cF9lYXRFeHRlbmRlZEF0b20gPSBmdW5jdGlvbihzdGF0ZSkge1xuICByZXR1cm4gKFxuICAgIHN0YXRlLmVhdCgweDJFIC8qIC4gKi8pIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0UmV2ZXJzZVNvbGlkdXNBdG9tRXNjYXBlKHN0YXRlKSB8fFxuICAgIHRoaXMucmVnZXhwX2VhdENoYXJhY3RlckNsYXNzKHN0YXRlKSB8fFxuICAgIHRoaXMucmVnZXhwX2VhdFVuY2FwdHVyaW5nR3JvdXAoc3RhdGUpIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0Q2FwdHVyaW5nR3JvdXAoc3RhdGUpIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0SW52YWxpZEJyYWNlZFF1YW50aWZpZXIoc3RhdGUpIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0RXh0ZW5kZWRQYXR0ZXJuQ2hhcmFjdGVyKHN0YXRlKVxuICApXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1hbm5leEItSW52YWxpZEJyYWNlZFF1YW50aWZpZXJcbnBwJDgucmVnZXhwX2VhdEludmFsaWRCcmFjZWRRdWFudGlmaWVyID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgaWYgKHRoaXMucmVnZXhwX2VhdEJyYWNlZFF1YW50aWZpZXIoc3RhdGUsIHRydWUpKSB7XG4gICAgc3RhdGUucmFpc2UoXCJOb3RoaW5nIHRvIHJlcGVhdFwiKTtcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cbi8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLVN5bnRheENoYXJhY3RlclxucHAkOC5yZWdleHBfZWF0U3ludGF4Q2hhcmFjdGVyID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgdmFyIGNoID0gc3RhdGUuY3VycmVudCgpO1xuICBpZiAoaXNTeW50YXhDaGFyYWN0ZXIoY2gpKSB7XG4gICAgc3RhdGUubGFzdEludFZhbHVlID0gY2g7XG4gICAgc3RhdGUuYWR2YW5jZSgpO1xuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59O1xuZnVuY3Rpb24gaXNTeW50YXhDaGFyYWN0ZXIoY2gpIHtcbiAgcmV0dXJuIChcbiAgICBjaCA9PT0gMHgyNCAvKiAkICovIHx8XG4gICAgY2ggPj0gMHgyOCAvKiAoICovICYmIGNoIDw9IDB4MkIgLyogKyAqLyB8fFxuICAgIGNoID09PSAweDJFIC8qIC4gKi8gfHxcbiAgICBjaCA9PT0gMHgzRiAvKiA/ICovIHx8XG4gICAgY2ggPj0gMHg1QiAvKiBbICovICYmIGNoIDw9IDB4NUUgLyogXiAqLyB8fFxuICAgIGNoID49IDB4N0IgLyogeyAqLyAmJiBjaCA8PSAweDdEIC8qIH0gKi9cbiAgKVxufVxuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1QYXR0ZXJuQ2hhcmFjdGVyXG4vLyBCdXQgZWF0IGVhZ2VyLlxucHAkOC5yZWdleHBfZWF0UGF0dGVybkNoYXJhY3RlcnMgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgc3RhcnQgPSBzdGF0ZS5wb3M7XG4gIHZhciBjaCA9IDA7XG4gIHdoaWxlICgoY2ggPSBzdGF0ZS5jdXJyZW50KCkpICE9PSAtMSAmJiAhaXNTeW50YXhDaGFyYWN0ZXIoY2gpKSB7XG4gICAgc3RhdGUuYWR2YW5jZSgpO1xuICB9XG4gIHJldHVybiBzdGF0ZS5wb3MgIT09IHN0YXJ0XG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1hbm5leEItRXh0ZW5kZWRQYXR0ZXJuQ2hhcmFjdGVyXG5wcCQ4LnJlZ2V4cF9lYXRFeHRlbmRlZFBhdHRlcm5DaGFyYWN0ZXIgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgY2ggPSBzdGF0ZS5jdXJyZW50KCk7XG4gIGlmIChcbiAgICBjaCAhPT0gLTEgJiZcbiAgICBjaCAhPT0gMHgyNCAvKiAkICovICYmXG4gICAgIShjaCA+PSAweDI4IC8qICggKi8gJiYgY2ggPD0gMHgyQiAvKiArICovKSAmJlxuICAgIGNoICE9PSAweDJFIC8qIC4gKi8gJiZcbiAgICBjaCAhPT0gMHgzRiAvKiA/ICovICYmXG4gICAgY2ggIT09IDB4NUIgLyogWyAqLyAmJlxuICAgIGNoICE9PSAweDVFIC8qIF4gKi8gJiZcbiAgICBjaCAhPT0gMHg3QyAvKiB8ICovXG4gICkge1xuICAgIHN0YXRlLmFkdmFuY2UoKTtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIHJldHVybiBmYWxzZVxufTtcblxuLy8gR3JvdXBTcGVjaWZpZXIgOjpcbi8vICAgW2VtcHR5XVxuLy8gICBgP2AgR3JvdXBOYW1lXG5wcCQ4LnJlZ2V4cF9ncm91cFNwZWNpZmllciA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIGlmIChzdGF0ZS5lYXQoMHgzRiAvKiA/ICovKSkge1xuICAgIGlmICh0aGlzLnJlZ2V4cF9lYXRHcm91cE5hbWUoc3RhdGUpKSB7XG4gICAgICBpZiAoc3RhdGUuZ3JvdXBOYW1lcy5pbmRleE9mKHN0YXRlLmxhc3RTdHJpbmdWYWx1ZSkgIT09IC0xKSB7XG4gICAgICAgIHN0YXRlLnJhaXNlKFwiRHVwbGljYXRlIGNhcHR1cmUgZ3JvdXAgbmFtZVwiKTtcbiAgICAgIH1cbiAgICAgIHN0YXRlLmdyb3VwTmFtZXMucHVzaChzdGF0ZS5sYXN0U3RyaW5nVmFsdWUpO1xuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIHN0YXRlLnJhaXNlKFwiSW52YWxpZCBncm91cFwiKTtcbiAgfVxufTtcblxuLy8gR3JvdXBOYW1lIDo6XG4vLyAgIGA8YCBSZWdFeHBJZGVudGlmaWVyTmFtZSBgPmBcbi8vIE5vdGU6IHRoaXMgdXBkYXRlcyBgc3RhdGUubGFzdFN0cmluZ1ZhbHVlYCBwcm9wZXJ0eSB3aXRoIHRoZSBlYXRlbiBuYW1lLlxucHAkOC5yZWdleHBfZWF0R3JvdXBOYW1lID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgc3RhdGUubGFzdFN0cmluZ1ZhbHVlID0gXCJcIjtcbiAgaWYgKHN0YXRlLmVhdCgweDNDIC8qIDwgKi8pKSB7XG4gICAgaWYgKHRoaXMucmVnZXhwX2VhdFJlZ0V4cElkZW50aWZpZXJOYW1lKHN0YXRlKSAmJiBzdGF0ZS5lYXQoMHgzRSAvKiA+ICovKSkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgc3RhdGUucmFpc2UoXCJJbnZhbGlkIGNhcHR1cmUgZ3JvdXAgbmFtZVwiKTtcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cbi8vIFJlZ0V4cElkZW50aWZpZXJOYW1lIDo6XG4vLyAgIFJlZ0V4cElkZW50aWZpZXJTdGFydFxuLy8gICBSZWdFeHBJZGVudGlmaWVyTmFtZSBSZWdFeHBJZGVudGlmaWVyUGFydFxuLy8gTm90ZTogdGhpcyB1cGRhdGVzIGBzdGF0ZS5sYXN0U3RyaW5nVmFsdWVgIHByb3BlcnR5IHdpdGggdGhlIGVhdGVuIG5hbWUuXG5wcCQ4LnJlZ2V4cF9lYXRSZWdFeHBJZGVudGlmaWVyTmFtZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHN0YXRlLmxhc3RTdHJpbmdWYWx1ZSA9IFwiXCI7XG4gIGlmICh0aGlzLnJlZ2V4cF9lYXRSZWdFeHBJZGVudGlmaWVyU3RhcnQoc3RhdGUpKSB7XG4gICAgc3RhdGUubGFzdFN0cmluZ1ZhbHVlICs9IGNvZGVQb2ludFRvU3RyaW5nKHN0YXRlLmxhc3RJbnRWYWx1ZSk7XG4gICAgd2hpbGUgKHRoaXMucmVnZXhwX2VhdFJlZ0V4cElkZW50aWZpZXJQYXJ0KHN0YXRlKSkge1xuICAgICAgc3RhdGUubGFzdFN0cmluZ1ZhbHVlICs9IGNvZGVQb2ludFRvU3RyaW5nKHN0YXRlLmxhc3RJbnRWYWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBSZWdFeHBJZGVudGlmaWVyU3RhcnQgOjpcbi8vICAgVW5pY29kZUlEU3RhcnRcbi8vICAgYCRgXG4vLyAgIGBfYFxuLy8gICBgXFxgIFJlZ0V4cFVuaWNvZGVFc2NhcGVTZXF1ZW5jZVsrVV1cbnBwJDgucmVnZXhwX2VhdFJlZ0V4cElkZW50aWZpZXJTdGFydCA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHZhciBzdGFydCA9IHN0YXRlLnBvcztcbiAgdmFyIGZvcmNlVSA9IHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSAxMTtcbiAgdmFyIGNoID0gc3RhdGUuY3VycmVudChmb3JjZVUpO1xuICBzdGF0ZS5hZHZhbmNlKGZvcmNlVSk7XG5cbiAgaWYgKGNoID09PSAweDVDIC8qIFxcICovICYmIHRoaXMucmVnZXhwX2VhdFJlZ0V4cFVuaWNvZGVFc2NhcGVTZXF1ZW5jZShzdGF0ZSwgZm9yY2VVKSkge1xuICAgIGNoID0gc3RhdGUubGFzdEludFZhbHVlO1xuICB9XG4gIGlmIChpc1JlZ0V4cElkZW50aWZpZXJTdGFydChjaCkpIHtcbiAgICBzdGF0ZS5sYXN0SW50VmFsdWUgPSBjaDtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgc3RhdGUucG9zID0gc3RhcnQ7XG4gIHJldHVybiBmYWxzZVxufTtcbmZ1bmN0aW9uIGlzUmVnRXhwSWRlbnRpZmllclN0YXJ0KGNoKSB7XG4gIHJldHVybiBpc0lkZW50aWZpZXJTdGFydChjaCwgdHJ1ZSkgfHwgY2ggPT09IDB4MjQgLyogJCAqLyB8fCBjaCA9PT0gMHg1RiAvKiBfICovXG59XG5cbi8vIFJlZ0V4cElkZW50aWZpZXJQYXJ0IDo6XG4vLyAgIFVuaWNvZGVJRENvbnRpbnVlXG4vLyAgIGAkYFxuLy8gICBgX2Bcbi8vICAgYFxcYCBSZWdFeHBVbmljb2RlRXNjYXBlU2VxdWVuY2VbK1VdXG4vLyAgIDxaV05KPlxuLy8gICA8WldKPlxucHAkOC5yZWdleHBfZWF0UmVnRXhwSWRlbnRpZmllclBhcnQgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgc3RhcnQgPSBzdGF0ZS5wb3M7XG4gIHZhciBmb3JjZVUgPSB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gMTE7XG4gIHZhciBjaCA9IHN0YXRlLmN1cnJlbnQoZm9yY2VVKTtcbiAgc3RhdGUuYWR2YW5jZShmb3JjZVUpO1xuXG4gIGlmIChjaCA9PT0gMHg1QyAvKiBcXCAqLyAmJiB0aGlzLnJlZ2V4cF9lYXRSZWdFeHBVbmljb2RlRXNjYXBlU2VxdWVuY2Uoc3RhdGUsIGZvcmNlVSkpIHtcbiAgICBjaCA9IHN0YXRlLmxhc3RJbnRWYWx1ZTtcbiAgfVxuICBpZiAoaXNSZWdFeHBJZGVudGlmaWVyUGFydChjaCkpIHtcbiAgICBzdGF0ZS5sYXN0SW50VmFsdWUgPSBjaDtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgc3RhdGUucG9zID0gc3RhcnQ7XG4gIHJldHVybiBmYWxzZVxufTtcbmZ1bmN0aW9uIGlzUmVnRXhwSWRlbnRpZmllclBhcnQoY2gpIHtcbiAgcmV0dXJuIGlzSWRlbnRpZmllckNoYXIoY2gsIHRydWUpIHx8IGNoID09PSAweDI0IC8qICQgKi8gfHwgY2ggPT09IDB4NUYgLyogXyAqLyB8fCBjaCA9PT0gMHgyMDBDIC8qIDxaV05KPiAqLyB8fCBjaCA9PT0gMHgyMDBEIC8qIDxaV0o+ICovXG59XG5cbi8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLWFubmV4Qi1BdG9tRXNjYXBlXG5wcCQ4LnJlZ2V4cF9lYXRBdG9tRXNjYXBlID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgaWYgKFxuICAgIHRoaXMucmVnZXhwX2VhdEJhY2tSZWZlcmVuY2Uoc3RhdGUpIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyQ2xhc3NFc2NhcGUoc3RhdGUpIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyRXNjYXBlKHN0YXRlKSB8fFxuICAgIChzdGF0ZS5zd2l0Y2hOICYmIHRoaXMucmVnZXhwX2VhdEtHcm91cE5hbWUoc3RhdGUpKVxuICApIHtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIGlmIChzdGF0ZS5zd2l0Y2hVKSB7XG4gICAgLy8gTWFrZSB0aGUgc2FtZSBtZXNzYWdlIGFzIFY4LlxuICAgIGlmIChzdGF0ZS5jdXJyZW50KCkgPT09IDB4NjMgLyogYyAqLykge1xuICAgICAgc3RhdGUucmFpc2UoXCJJbnZhbGlkIHVuaWNvZGUgZXNjYXBlXCIpO1xuICAgIH1cbiAgICBzdGF0ZS5yYWlzZShcIkludmFsaWQgZXNjYXBlXCIpO1xuICB9XG4gIHJldHVybiBmYWxzZVxufTtcbnBwJDgucmVnZXhwX2VhdEJhY2tSZWZlcmVuY2UgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgc3RhcnQgPSBzdGF0ZS5wb3M7XG4gIGlmICh0aGlzLnJlZ2V4cF9lYXREZWNpbWFsRXNjYXBlKHN0YXRlKSkge1xuICAgIHZhciBuID0gc3RhdGUubGFzdEludFZhbHVlO1xuICAgIGlmIChzdGF0ZS5zd2l0Y2hVKSB7XG4gICAgICAvLyBGb3IgU3ludGF4RXJyb3IgaW4gaHR0cHM6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi84LjAvI3NlYy1hdG9tZXNjYXBlXG4gICAgICBpZiAobiA+IHN0YXRlLm1heEJhY2tSZWZlcmVuY2UpIHtcbiAgICAgICAgc3RhdGUubWF4QmFja1JlZmVyZW5jZSA9IG47XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBpZiAobiA8PSBzdGF0ZS5udW1DYXB0dXJpbmdQYXJlbnMpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIHN0YXRlLnBvcyA9IHN0YXJ0O1xuICB9XG4gIHJldHVybiBmYWxzZVxufTtcbnBwJDgucmVnZXhwX2VhdEtHcm91cE5hbWUgPSBmdW5jdGlvbihzdGF0ZSkge1xuICBpZiAoc3RhdGUuZWF0KDB4NkIgLyogayAqLykpIHtcbiAgICBpZiAodGhpcy5yZWdleHBfZWF0R3JvdXBOYW1lKHN0YXRlKSkge1xuICAgICAgc3RhdGUuYmFja1JlZmVyZW5jZU5hbWVzLnB1c2goc3RhdGUubGFzdFN0cmluZ1ZhbHVlKTtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIHN0YXRlLnJhaXNlKFwiSW52YWxpZCBuYW1lZCByZWZlcmVuY2VcIik7XG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1hbm5leEItQ2hhcmFjdGVyRXNjYXBlXG5wcCQ4LnJlZ2V4cF9lYXRDaGFyYWN0ZXJFc2NhcGUgPSBmdW5jdGlvbihzdGF0ZSkge1xuICByZXR1cm4gKFxuICAgIHRoaXMucmVnZXhwX2VhdENvbnRyb2xFc2NhcGUoc3RhdGUpIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0Q0NvbnRyb2xMZXR0ZXIoc3RhdGUpIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0WmVybyhzdGF0ZSkgfHxcbiAgICB0aGlzLnJlZ2V4cF9lYXRIZXhFc2NhcGVTZXF1ZW5jZShzdGF0ZSkgfHxcbiAgICB0aGlzLnJlZ2V4cF9lYXRSZWdFeHBVbmljb2RlRXNjYXBlU2VxdWVuY2Uoc3RhdGUsIGZhbHNlKSB8fFxuICAgICghc3RhdGUuc3dpdGNoVSAmJiB0aGlzLnJlZ2V4cF9lYXRMZWdhY3lPY3RhbEVzY2FwZVNlcXVlbmNlKHN0YXRlKSkgfHxcbiAgICB0aGlzLnJlZ2V4cF9lYXRJZGVudGl0eUVzY2FwZShzdGF0ZSlcbiAgKVxufTtcbnBwJDgucmVnZXhwX2VhdENDb250cm9sTGV0dGVyID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgdmFyIHN0YXJ0ID0gc3RhdGUucG9zO1xuICBpZiAoc3RhdGUuZWF0KDB4NjMgLyogYyAqLykpIHtcbiAgICBpZiAodGhpcy5yZWdleHBfZWF0Q29udHJvbExldHRlcihzdGF0ZSkpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIHN0YXRlLnBvcyA9IHN0YXJ0O1xuICB9XG4gIHJldHVybiBmYWxzZVxufTtcbnBwJDgucmVnZXhwX2VhdFplcm8gPSBmdW5jdGlvbihzdGF0ZSkge1xuICBpZiAoc3RhdGUuY3VycmVudCgpID09PSAweDMwIC8qIDAgKi8gJiYgIWlzRGVjaW1hbERpZ2l0KHN0YXRlLmxvb2thaGVhZCgpKSkge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IDA7XG4gICAgc3RhdGUuYWR2YW5jZSgpO1xuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1Db250cm9sRXNjYXBlXG5wcCQ4LnJlZ2V4cF9lYXRDb250cm9sRXNjYXBlID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgdmFyIGNoID0gc3RhdGUuY3VycmVudCgpO1xuICBpZiAoY2ggPT09IDB4NzQgLyogdCAqLykge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IDB4MDk7IC8qIFxcdCAqL1xuICAgIHN0YXRlLmFkdmFuY2UoKTtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIGlmIChjaCA9PT0gMHg2RSAvKiBuICovKSB7XG4gICAgc3RhdGUubGFzdEludFZhbHVlID0gMHgwQTsgLyogXFxuICovXG4gICAgc3RhdGUuYWR2YW5jZSgpO1xuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgaWYgKGNoID09PSAweDc2IC8qIHYgKi8pIHtcbiAgICBzdGF0ZS5sYXN0SW50VmFsdWUgPSAweDBCOyAvKiBcXHYgKi9cbiAgICBzdGF0ZS5hZHZhbmNlKCk7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuICBpZiAoY2ggPT09IDB4NjYgLyogZiAqLykge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IDB4MEM7IC8qIFxcZiAqL1xuICAgIHN0YXRlLmFkdmFuY2UoKTtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIGlmIChjaCA9PT0gMHg3MiAvKiByICovKSB7XG4gICAgc3RhdGUubGFzdEludFZhbHVlID0gMHgwRDsgLyogXFxyICovXG4gICAgc3RhdGUuYWR2YW5jZSgpO1xuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1Db250cm9sTGV0dGVyXG5wcCQ4LnJlZ2V4cF9lYXRDb250cm9sTGV0dGVyID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgdmFyIGNoID0gc3RhdGUuY3VycmVudCgpO1xuICBpZiAoaXNDb250cm9sTGV0dGVyKGNoKSkge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IGNoICUgMHgyMDtcbiAgICBzdGF0ZS5hZHZhbmNlKCk7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5mdW5jdGlvbiBpc0NvbnRyb2xMZXR0ZXIoY2gpIHtcbiAgcmV0dXJuIChcbiAgICAoY2ggPj0gMHg0MSAvKiBBICovICYmIGNoIDw9IDB4NUEgLyogWiAqLykgfHxcbiAgICAoY2ggPj0gMHg2MSAvKiBhICovICYmIGNoIDw9IDB4N0EgLyogeiAqLylcbiAgKVxufVxuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1SZWdFeHBVbmljb2RlRXNjYXBlU2VxdWVuY2VcbnBwJDgucmVnZXhwX2VhdFJlZ0V4cFVuaWNvZGVFc2NhcGVTZXF1ZW5jZSA9IGZ1bmN0aW9uKHN0YXRlLCBmb3JjZVUpIHtcbiAgaWYgKCBmb3JjZVUgPT09IHZvaWQgMCApIGZvcmNlVSA9IGZhbHNlO1xuXG4gIHZhciBzdGFydCA9IHN0YXRlLnBvcztcbiAgdmFyIHN3aXRjaFUgPSBmb3JjZVUgfHwgc3RhdGUuc3dpdGNoVTtcblxuICBpZiAoc3RhdGUuZWF0KDB4NzUgLyogdSAqLykpIHtcbiAgICBpZiAodGhpcy5yZWdleHBfZWF0Rml4ZWRIZXhEaWdpdHMoc3RhdGUsIDQpKSB7XG4gICAgICB2YXIgbGVhZCA9IHN0YXRlLmxhc3RJbnRWYWx1ZTtcbiAgICAgIGlmIChzd2l0Y2hVICYmIGxlYWQgPj0gMHhEODAwICYmIGxlYWQgPD0gMHhEQkZGKSB7XG4gICAgICAgIHZhciBsZWFkU3Vycm9nYXRlRW5kID0gc3RhdGUucG9zO1xuICAgICAgICBpZiAoc3RhdGUuZWF0KDB4NUMgLyogXFwgKi8pICYmIHN0YXRlLmVhdCgweDc1IC8qIHUgKi8pICYmIHRoaXMucmVnZXhwX2VhdEZpeGVkSGV4RGlnaXRzKHN0YXRlLCA0KSkge1xuICAgICAgICAgIHZhciB0cmFpbCA9IHN0YXRlLmxhc3RJbnRWYWx1ZTtcbiAgICAgICAgICBpZiAodHJhaWwgPj0gMHhEQzAwICYmIHRyYWlsIDw9IDB4REZGRikge1xuICAgICAgICAgICAgc3RhdGUubGFzdEludFZhbHVlID0gKGxlYWQgLSAweEQ4MDApICogMHg0MDAgKyAodHJhaWwgLSAweERDMDApICsgMHgxMDAwMDtcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHN0YXRlLnBvcyA9IGxlYWRTdXJyb2dhdGVFbmQ7XG4gICAgICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IGxlYWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBpZiAoXG4gICAgICBzd2l0Y2hVICYmXG4gICAgICBzdGF0ZS5lYXQoMHg3QiAvKiB7ICovKSAmJlxuICAgICAgdGhpcy5yZWdleHBfZWF0SGV4RGlnaXRzKHN0YXRlKSAmJlxuICAgICAgc3RhdGUuZWF0KDB4N0QgLyogfSAqLykgJiZcbiAgICAgIGlzVmFsaWRVbmljb2RlKHN0YXRlLmxhc3RJbnRWYWx1ZSlcbiAgICApIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIGlmIChzd2l0Y2hVKSB7XG4gICAgICBzdGF0ZS5yYWlzZShcIkludmFsaWQgdW5pY29kZSBlc2NhcGVcIik7XG4gICAgfVxuICAgIHN0YXRlLnBvcyA9IHN0YXJ0O1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlXG59O1xuZnVuY3Rpb24gaXNWYWxpZFVuaWNvZGUoY2gpIHtcbiAgcmV0dXJuIGNoID49IDAgJiYgY2ggPD0gMHgxMEZGRkZcbn1cblxuLy8gaHR0cHM6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi84LjAvI3Byb2QtYW5uZXhCLUlkZW50aXR5RXNjYXBlXG5wcCQ4LnJlZ2V4cF9lYXRJZGVudGl0eUVzY2FwZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIGlmIChzdGF0ZS5zd2l0Y2hVKSB7XG4gICAgaWYgKHRoaXMucmVnZXhwX2VhdFN5bnRheENoYXJhY3RlcihzdGF0ZSkpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIGlmIChzdGF0ZS5lYXQoMHgyRiAvKiAvICovKSkge1xuICAgICAgc3RhdGUubGFzdEludFZhbHVlID0gMHgyRjsgLyogLyAqL1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICB2YXIgY2ggPSBzdGF0ZS5jdXJyZW50KCk7XG4gIGlmIChjaCAhPT0gMHg2MyAvKiBjICovICYmICghc3RhdGUuc3dpdGNoTiB8fCBjaCAhPT0gMHg2QiAvKiBrICovKSkge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IGNoO1xuICAgIHN0YXRlLmFkdmFuY2UoKTtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1EZWNpbWFsRXNjYXBlXG5wcCQ4LnJlZ2V4cF9lYXREZWNpbWFsRXNjYXBlID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgc3RhdGUubGFzdEludFZhbHVlID0gMDtcbiAgdmFyIGNoID0gc3RhdGUuY3VycmVudCgpO1xuICBpZiAoY2ggPj0gMHgzMSAvKiAxICovICYmIGNoIDw9IDB4MzkgLyogOSAqLykge1xuICAgIGRvIHtcbiAgICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IDEwICogc3RhdGUubGFzdEludFZhbHVlICsgKGNoIC0gMHgzMCAvKiAwICovKTtcbiAgICAgIHN0YXRlLmFkdmFuY2UoKTtcbiAgICB9IHdoaWxlICgoY2ggPSBzdGF0ZS5jdXJyZW50KCkpID49IDB4MzAgLyogMCAqLyAmJiBjaCA8PSAweDM5IC8qIDkgKi8pXG4gICAgcmV0dXJuIHRydWVcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cbi8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLUNoYXJhY3RlckNsYXNzRXNjYXBlXG5wcCQ4LnJlZ2V4cF9lYXRDaGFyYWN0ZXJDbGFzc0VzY2FwZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHZhciBjaCA9IHN0YXRlLmN1cnJlbnQoKTtcblxuICBpZiAoaXNDaGFyYWN0ZXJDbGFzc0VzY2FwZShjaCkpIHtcbiAgICBzdGF0ZS5sYXN0SW50VmFsdWUgPSAtMTtcbiAgICBzdGF0ZS5hZHZhbmNlKCk7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGlmIChcbiAgICBzdGF0ZS5zd2l0Y2hVICYmXG4gICAgdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDkgJiZcbiAgICAoY2ggPT09IDB4NTAgLyogUCAqLyB8fCBjaCA9PT0gMHg3MCAvKiBwICovKVxuICApIHtcbiAgICBzdGF0ZS5sYXN0SW50VmFsdWUgPSAtMTtcbiAgICBzdGF0ZS5hZHZhbmNlKCk7XG4gICAgaWYgKFxuICAgICAgc3RhdGUuZWF0KDB4N0IgLyogeyAqLykgJiZcbiAgICAgIHRoaXMucmVnZXhwX2VhdFVuaWNvZGVQcm9wZXJ0eVZhbHVlRXhwcmVzc2lvbihzdGF0ZSkgJiZcbiAgICAgIHN0YXRlLmVhdCgweDdEIC8qIH0gKi8pXG4gICAgKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBzdGF0ZS5yYWlzZShcIkludmFsaWQgcHJvcGVydHkgbmFtZVwiKTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZVxufTtcbmZ1bmN0aW9uIGlzQ2hhcmFjdGVyQ2xhc3NFc2NhcGUoY2gpIHtcbiAgcmV0dXJuIChcbiAgICBjaCA9PT0gMHg2NCAvKiBkICovIHx8XG4gICAgY2ggPT09IDB4NDQgLyogRCAqLyB8fFxuICAgIGNoID09PSAweDczIC8qIHMgKi8gfHxcbiAgICBjaCA9PT0gMHg1MyAvKiBTICovIHx8XG4gICAgY2ggPT09IDB4NzcgLyogdyAqLyB8fFxuICAgIGNoID09PSAweDU3IC8qIFcgKi9cbiAgKVxufVxuXG4vLyBVbmljb2RlUHJvcGVydHlWYWx1ZUV4cHJlc3Npb24gOjpcbi8vICAgVW5pY29kZVByb3BlcnR5TmFtZSBgPWAgVW5pY29kZVByb3BlcnR5VmFsdWVcbi8vICAgTG9uZVVuaWNvZGVQcm9wZXJ0eU5hbWVPclZhbHVlXG5wcCQ4LnJlZ2V4cF9lYXRVbmljb2RlUHJvcGVydHlWYWx1ZUV4cHJlc3Npb24gPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgc3RhcnQgPSBzdGF0ZS5wb3M7XG5cbiAgLy8gVW5pY29kZVByb3BlcnR5TmFtZSBgPWAgVW5pY29kZVByb3BlcnR5VmFsdWVcbiAgaWYgKHRoaXMucmVnZXhwX2VhdFVuaWNvZGVQcm9wZXJ0eU5hbWUoc3RhdGUpICYmIHN0YXRlLmVhdCgweDNEIC8qID0gKi8pKSB7XG4gICAgdmFyIG5hbWUgPSBzdGF0ZS5sYXN0U3RyaW5nVmFsdWU7XG4gICAgaWYgKHRoaXMucmVnZXhwX2VhdFVuaWNvZGVQcm9wZXJ0eVZhbHVlKHN0YXRlKSkge1xuICAgICAgdmFyIHZhbHVlID0gc3RhdGUubGFzdFN0cmluZ1ZhbHVlO1xuICAgICAgdGhpcy5yZWdleHBfdmFsaWRhdGVVbmljb2RlUHJvcGVydHlOYW1lQW5kVmFsdWUoc3RhdGUsIG5hbWUsIHZhbHVlKTtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICB9XG4gIHN0YXRlLnBvcyA9IHN0YXJ0O1xuXG4gIC8vIExvbmVVbmljb2RlUHJvcGVydHlOYW1lT3JWYWx1ZVxuICBpZiAodGhpcy5yZWdleHBfZWF0TG9uZVVuaWNvZGVQcm9wZXJ0eU5hbWVPclZhbHVlKHN0YXRlKSkge1xuICAgIHZhciBuYW1lT3JWYWx1ZSA9IHN0YXRlLmxhc3RTdHJpbmdWYWx1ZTtcbiAgICB0aGlzLnJlZ2V4cF92YWxpZGF0ZVVuaWNvZGVQcm9wZXJ0eU5hbWVPclZhbHVlKHN0YXRlLCBuYW1lT3JWYWx1ZSk7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5wcCQ4LnJlZ2V4cF92YWxpZGF0ZVVuaWNvZGVQcm9wZXJ0eU5hbWVBbmRWYWx1ZSA9IGZ1bmN0aW9uKHN0YXRlLCBuYW1lLCB2YWx1ZSkge1xuICBpZiAoIWhhcyhzdGF0ZS51bmljb2RlUHJvcGVydGllcy5ub25CaW5hcnksIG5hbWUpKVxuICAgIHsgc3RhdGUucmFpc2UoXCJJbnZhbGlkIHByb3BlcnR5IG5hbWVcIik7IH1cbiAgaWYgKCFzdGF0ZS51bmljb2RlUHJvcGVydGllcy5ub25CaW5hcnlbbmFtZV0udGVzdCh2YWx1ZSkpXG4gICAgeyBzdGF0ZS5yYWlzZShcIkludmFsaWQgcHJvcGVydHkgdmFsdWVcIik7IH1cbn07XG5wcCQ4LnJlZ2V4cF92YWxpZGF0ZVVuaWNvZGVQcm9wZXJ0eU5hbWVPclZhbHVlID0gZnVuY3Rpb24oc3RhdGUsIG5hbWVPclZhbHVlKSB7XG4gIGlmICghc3RhdGUudW5pY29kZVByb3BlcnRpZXMuYmluYXJ5LnRlc3QobmFtZU9yVmFsdWUpKVxuICAgIHsgc3RhdGUucmFpc2UoXCJJbnZhbGlkIHByb3BlcnR5IG5hbWVcIik7IH1cbn07XG5cbi8vIFVuaWNvZGVQcm9wZXJ0eU5hbWUgOjpcbi8vICAgVW5pY29kZVByb3BlcnR5TmFtZUNoYXJhY3RlcnNcbnBwJDgucmVnZXhwX2VhdFVuaWNvZGVQcm9wZXJ0eU5hbWUgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgY2ggPSAwO1xuICBzdGF0ZS5sYXN0U3RyaW5nVmFsdWUgPSBcIlwiO1xuICB3aGlsZSAoaXNVbmljb2RlUHJvcGVydHlOYW1lQ2hhcmFjdGVyKGNoID0gc3RhdGUuY3VycmVudCgpKSkge1xuICAgIHN0YXRlLmxhc3RTdHJpbmdWYWx1ZSArPSBjb2RlUG9pbnRUb1N0cmluZyhjaCk7XG4gICAgc3RhdGUuYWR2YW5jZSgpO1xuICB9XG4gIHJldHVybiBzdGF0ZS5sYXN0U3RyaW5nVmFsdWUgIT09IFwiXCJcbn07XG5mdW5jdGlvbiBpc1VuaWNvZGVQcm9wZXJ0eU5hbWVDaGFyYWN0ZXIoY2gpIHtcbiAgcmV0dXJuIGlzQ29udHJvbExldHRlcihjaCkgfHwgY2ggPT09IDB4NUYgLyogXyAqL1xufVxuXG4vLyBVbmljb2RlUHJvcGVydHlWYWx1ZSA6OlxuLy8gICBVbmljb2RlUHJvcGVydHlWYWx1ZUNoYXJhY3RlcnNcbnBwJDgucmVnZXhwX2VhdFVuaWNvZGVQcm9wZXJ0eVZhbHVlID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgdmFyIGNoID0gMDtcbiAgc3RhdGUubGFzdFN0cmluZ1ZhbHVlID0gXCJcIjtcbiAgd2hpbGUgKGlzVW5pY29kZVByb3BlcnR5VmFsdWVDaGFyYWN0ZXIoY2ggPSBzdGF0ZS5jdXJyZW50KCkpKSB7XG4gICAgc3RhdGUubGFzdFN0cmluZ1ZhbHVlICs9IGNvZGVQb2ludFRvU3RyaW5nKGNoKTtcbiAgICBzdGF0ZS5hZHZhbmNlKCk7XG4gIH1cbiAgcmV0dXJuIHN0YXRlLmxhc3RTdHJpbmdWYWx1ZSAhPT0gXCJcIlxufTtcbmZ1bmN0aW9uIGlzVW5pY29kZVByb3BlcnR5VmFsdWVDaGFyYWN0ZXIoY2gpIHtcbiAgcmV0dXJuIGlzVW5pY29kZVByb3BlcnR5TmFtZUNoYXJhY3RlcihjaCkgfHwgaXNEZWNpbWFsRGlnaXQoY2gpXG59XG5cbi8vIExvbmVVbmljb2RlUHJvcGVydHlOYW1lT3JWYWx1ZSA6OlxuLy8gICBVbmljb2RlUHJvcGVydHlWYWx1ZUNoYXJhY3RlcnNcbnBwJDgucmVnZXhwX2VhdExvbmVVbmljb2RlUHJvcGVydHlOYW1lT3JWYWx1ZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHJldHVybiB0aGlzLnJlZ2V4cF9lYXRVbmljb2RlUHJvcGVydHlWYWx1ZShzdGF0ZSlcbn07XG5cbi8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLUNoYXJhY3RlckNsYXNzXG5wcCQ4LnJlZ2V4cF9lYXRDaGFyYWN0ZXJDbGFzcyA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIGlmIChzdGF0ZS5lYXQoMHg1QiAvKiBbICovKSkge1xuICAgIHN0YXRlLmVhdCgweDVFIC8qIF4gKi8pO1xuICAgIHRoaXMucmVnZXhwX2NsYXNzUmFuZ2VzKHN0YXRlKTtcbiAgICBpZiAoc3RhdGUuZWF0KDB4NUQgLyogXSAqLykpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIC8vIFVucmVhY2hhYmxlIHNpbmNlIGl0IHRocmV3IFwidW50ZXJtaW5hdGVkIHJlZ3VsYXIgZXhwcmVzc2lvblwiIGVycm9yIGJlZm9yZS5cbiAgICBzdGF0ZS5yYWlzZShcIlVudGVybWluYXRlZCBjaGFyYWN0ZXIgY2xhc3NcIik7XG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1DbGFzc1Jhbmdlc1xuLy8gaHR0cHM6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi84LjAvI3Byb2QtTm9uZW1wdHlDbGFzc1Jhbmdlc1xuLy8gaHR0cHM6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi84LjAvI3Byb2QtTm9uZW1wdHlDbGFzc1Jhbmdlc05vRGFzaFxucHAkOC5yZWdleHBfY2xhc3NSYW5nZXMgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB3aGlsZSAodGhpcy5yZWdleHBfZWF0Q2xhc3NBdG9tKHN0YXRlKSkge1xuICAgIHZhciBsZWZ0ID0gc3RhdGUubGFzdEludFZhbHVlO1xuICAgIGlmIChzdGF0ZS5lYXQoMHgyRCAvKiAtICovKSAmJiB0aGlzLnJlZ2V4cF9lYXRDbGFzc0F0b20oc3RhdGUpKSB7XG4gICAgICB2YXIgcmlnaHQgPSBzdGF0ZS5sYXN0SW50VmFsdWU7XG4gICAgICBpZiAoc3RhdGUuc3dpdGNoVSAmJiAobGVmdCA9PT0gLTEgfHwgcmlnaHQgPT09IC0xKSkge1xuICAgICAgICBzdGF0ZS5yYWlzZShcIkludmFsaWQgY2hhcmFjdGVyIGNsYXNzXCIpO1xuICAgICAgfVxuICAgICAgaWYgKGxlZnQgIT09IC0xICYmIHJpZ2h0ICE9PSAtMSAmJiBsZWZ0ID4gcmlnaHQpIHtcbiAgICAgICAgc3RhdGUucmFpc2UoXCJSYW5nZSBvdXQgb2Ygb3JkZXIgaW4gY2hhcmFjdGVyIGNsYXNzXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuLy8gaHR0cHM6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi84LjAvI3Byb2QtQ2xhc3NBdG9tXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1DbGFzc0F0b21Ob0Rhc2hcbnBwJDgucmVnZXhwX2VhdENsYXNzQXRvbSA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHZhciBzdGFydCA9IHN0YXRlLnBvcztcblxuICBpZiAoc3RhdGUuZWF0KDB4NUMgLyogXFwgKi8pKSB7XG4gICAgaWYgKHRoaXMucmVnZXhwX2VhdENsYXNzRXNjYXBlKHN0YXRlKSkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgaWYgKHN0YXRlLnN3aXRjaFUpIHtcbiAgICAgIC8vIE1ha2UgdGhlIHNhbWUgbWVzc2FnZSBhcyBWOC5cbiAgICAgIHZhciBjaCQxID0gc3RhdGUuY3VycmVudCgpO1xuICAgICAgaWYgKGNoJDEgPT09IDB4NjMgLyogYyAqLyB8fCBpc09jdGFsRGlnaXQoY2gkMSkpIHtcbiAgICAgICAgc3RhdGUucmFpc2UoXCJJbnZhbGlkIGNsYXNzIGVzY2FwZVwiKTtcbiAgICAgIH1cbiAgICAgIHN0YXRlLnJhaXNlKFwiSW52YWxpZCBlc2NhcGVcIik7XG4gICAgfVxuICAgIHN0YXRlLnBvcyA9IHN0YXJ0O1xuICB9XG5cbiAgdmFyIGNoID0gc3RhdGUuY3VycmVudCgpO1xuICBpZiAoY2ggIT09IDB4NUQgLyogXSAqLykge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IGNoO1xuICAgIHN0YXRlLmFkdmFuY2UoKTtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1hbm5leEItQ2xhc3NFc2NhcGVcbnBwJDgucmVnZXhwX2VhdENsYXNzRXNjYXBlID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgdmFyIHN0YXJ0ID0gc3RhdGUucG9zO1xuXG4gIGlmIChzdGF0ZS5lYXQoMHg2MiAvKiBiICovKSkge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IDB4MDg7IC8qIDxCUz4gKi9cbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgaWYgKHN0YXRlLnN3aXRjaFUgJiYgc3RhdGUuZWF0KDB4MkQgLyogLSAqLykpIHtcbiAgICBzdGF0ZS5sYXN0SW50VmFsdWUgPSAweDJEOyAvKiAtICovXG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGlmICghc3RhdGUuc3dpdGNoVSAmJiBzdGF0ZS5lYXQoMHg2MyAvKiBjICovKSkge1xuICAgIGlmICh0aGlzLnJlZ2V4cF9lYXRDbGFzc0NvbnRyb2xMZXR0ZXIoc3RhdGUpKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBzdGF0ZS5wb3MgPSBzdGFydDtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgdGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyQ2xhc3NFc2NhcGUoc3RhdGUpIHx8XG4gICAgdGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyRXNjYXBlKHN0YXRlKVxuICApXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1hbm5leEItQ2xhc3NDb250cm9sTGV0dGVyXG5wcCQ4LnJlZ2V4cF9lYXRDbGFzc0NvbnRyb2xMZXR0ZXIgPSBmdW5jdGlvbihzdGF0ZSkge1xuICB2YXIgY2ggPSBzdGF0ZS5jdXJyZW50KCk7XG4gIGlmIChpc0RlY2ltYWxEaWdpdChjaCkgfHwgY2ggPT09IDB4NUYgLyogXyAqLykge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IGNoICUgMHgyMDtcbiAgICBzdGF0ZS5hZHZhbmNlKCk7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cbi8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLUhleEVzY2FwZVNlcXVlbmNlXG5wcCQ4LnJlZ2V4cF9lYXRIZXhFc2NhcGVTZXF1ZW5jZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHZhciBzdGFydCA9IHN0YXRlLnBvcztcbiAgaWYgKHN0YXRlLmVhdCgweDc4IC8qIHggKi8pKSB7XG4gICAgaWYgKHRoaXMucmVnZXhwX2VhdEZpeGVkSGV4RGlnaXRzKHN0YXRlLCAyKSkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgaWYgKHN0YXRlLnN3aXRjaFUpIHtcbiAgICAgIHN0YXRlLnJhaXNlKFwiSW52YWxpZCBlc2NhcGVcIik7XG4gICAgfVxuICAgIHN0YXRlLnBvcyA9IHN0YXJ0O1xuICB9XG4gIHJldHVybiBmYWxzZVxufTtcblxuLy8gaHR0cHM6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi84LjAvI3Byb2QtRGVjaW1hbERpZ2l0c1xucHAkOC5yZWdleHBfZWF0RGVjaW1hbERpZ2l0cyA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHZhciBzdGFydCA9IHN0YXRlLnBvcztcbiAgdmFyIGNoID0gMDtcbiAgc3RhdGUubGFzdEludFZhbHVlID0gMDtcbiAgd2hpbGUgKGlzRGVjaW1hbERpZ2l0KGNoID0gc3RhdGUuY3VycmVudCgpKSkge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IDEwICogc3RhdGUubGFzdEludFZhbHVlICsgKGNoIC0gMHgzMCAvKiAwICovKTtcbiAgICBzdGF0ZS5hZHZhbmNlKCk7XG4gIH1cbiAgcmV0dXJuIHN0YXRlLnBvcyAhPT0gc3RhcnRcbn07XG5mdW5jdGlvbiBpc0RlY2ltYWxEaWdpdChjaCkge1xuICByZXR1cm4gY2ggPj0gMHgzMCAvKiAwICovICYmIGNoIDw9IDB4MzkgLyogOSAqL1xufVxuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1IZXhEaWdpdHNcbnBwJDgucmVnZXhwX2VhdEhleERpZ2l0cyA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHZhciBzdGFydCA9IHN0YXRlLnBvcztcbiAgdmFyIGNoID0gMDtcbiAgc3RhdGUubGFzdEludFZhbHVlID0gMDtcbiAgd2hpbGUgKGlzSGV4RGlnaXQoY2ggPSBzdGF0ZS5jdXJyZW50KCkpKSB7XG4gICAgc3RhdGUubGFzdEludFZhbHVlID0gMTYgKiBzdGF0ZS5sYXN0SW50VmFsdWUgKyBoZXhUb0ludChjaCk7XG4gICAgc3RhdGUuYWR2YW5jZSgpO1xuICB9XG4gIHJldHVybiBzdGF0ZS5wb3MgIT09IHN0YXJ0XG59O1xuZnVuY3Rpb24gaXNIZXhEaWdpdChjaCkge1xuICByZXR1cm4gKFxuICAgIChjaCA+PSAweDMwIC8qIDAgKi8gJiYgY2ggPD0gMHgzOSAvKiA5ICovKSB8fFxuICAgIChjaCA+PSAweDQxIC8qIEEgKi8gJiYgY2ggPD0gMHg0NiAvKiBGICovKSB8fFxuICAgIChjaCA+PSAweDYxIC8qIGEgKi8gJiYgY2ggPD0gMHg2NiAvKiBmICovKVxuICApXG59XG5mdW5jdGlvbiBoZXhUb0ludChjaCkge1xuICBpZiAoY2ggPj0gMHg0MSAvKiBBICovICYmIGNoIDw9IDB4NDYgLyogRiAqLykge1xuICAgIHJldHVybiAxMCArIChjaCAtIDB4NDEgLyogQSAqLylcbiAgfVxuICBpZiAoY2ggPj0gMHg2MSAvKiBhICovICYmIGNoIDw9IDB4NjYgLyogZiAqLykge1xuICAgIHJldHVybiAxMCArIChjaCAtIDB4NjEgLyogYSAqLylcbiAgfVxuICByZXR1cm4gY2ggLSAweDMwIC8qIDAgKi9cbn1cblxuLy8gaHR0cHM6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi84LjAvI3Byb2QtYW5uZXhCLUxlZ2FjeU9jdGFsRXNjYXBlU2VxdWVuY2Vcbi8vIEFsbG93cyBvbmx5IDAtMzc3KG9jdGFsKSBpLmUuIDAtMjU1KGRlY2ltYWwpLlxucHAkOC5yZWdleHBfZWF0TGVnYWN5T2N0YWxFc2NhcGVTZXF1ZW5jZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIGlmICh0aGlzLnJlZ2V4cF9lYXRPY3RhbERpZ2l0KHN0YXRlKSkge1xuICAgIHZhciBuMSA9IHN0YXRlLmxhc3RJbnRWYWx1ZTtcbiAgICBpZiAodGhpcy5yZWdleHBfZWF0T2N0YWxEaWdpdChzdGF0ZSkpIHtcbiAgICAgIHZhciBuMiA9IHN0YXRlLmxhc3RJbnRWYWx1ZTtcbiAgICAgIGlmIChuMSA8PSAzICYmIHRoaXMucmVnZXhwX2VhdE9jdGFsRGlnaXQoc3RhdGUpKSB7XG4gICAgICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IG4xICogNjQgKyBuMiAqIDggKyBzdGF0ZS5sYXN0SW50VmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGF0ZS5sYXN0SW50VmFsdWUgPSBuMSAqIDggKyBuMjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc3RhdGUubGFzdEludFZhbHVlID0gbjE7XG4gICAgfVxuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59O1xuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1PY3RhbERpZ2l0XG5wcCQ4LnJlZ2V4cF9lYXRPY3RhbERpZ2l0ID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgdmFyIGNoID0gc3RhdGUuY3VycmVudCgpO1xuICBpZiAoaXNPY3RhbERpZ2l0KGNoKSkge1xuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IGNoIC0gMHgzMDsgLyogMCAqL1xuICAgIHN0YXRlLmFkdmFuY2UoKTtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IDA7XG4gIHJldHVybiBmYWxzZVxufTtcbmZ1bmN0aW9uIGlzT2N0YWxEaWdpdChjaCkge1xuICByZXR1cm4gY2ggPj0gMHgzMCAvKiAwICovICYmIGNoIDw9IDB4MzcgLyogNyAqL1xufVxuXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1IZXg0RGlnaXRzXG4vLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzguMC8jcHJvZC1IZXhEaWdpdFxuLy8gQW5kIEhleERpZ2l0IEhleERpZ2l0IGluIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOC4wLyNwcm9kLUhleEVzY2FwZVNlcXVlbmNlXG5wcCQ4LnJlZ2V4cF9lYXRGaXhlZEhleERpZ2l0cyA9IGZ1bmN0aW9uKHN0YXRlLCBsZW5ndGgpIHtcbiAgdmFyIHN0YXJ0ID0gc3RhdGUucG9zO1xuICBzdGF0ZS5sYXN0SW50VmFsdWUgPSAwO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgdmFyIGNoID0gc3RhdGUuY3VycmVudCgpO1xuICAgIGlmICghaXNIZXhEaWdpdChjaCkpIHtcbiAgICAgIHN0YXRlLnBvcyA9IHN0YXJ0O1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIHN0YXRlLmxhc3RJbnRWYWx1ZSA9IDE2ICogc3RhdGUubGFzdEludFZhbHVlICsgaGV4VG9JbnQoY2gpO1xuICAgIHN0YXRlLmFkdmFuY2UoKTtcbiAgfVxuICByZXR1cm4gdHJ1ZVxufTtcblxuLy8gT2JqZWN0IHR5cGUgdXNlZCB0byByZXByZXNlbnQgdG9rZW5zLiBOb3RlIHRoYXQgbm9ybWFsbHksIHRva2Vuc1xuLy8gc2ltcGx5IGV4aXN0IGFzIHByb3BlcnRpZXMgb24gdGhlIHBhcnNlciBvYmplY3QuIFRoaXMgaXMgb25seVxuLy8gdXNlZCBmb3IgdGhlIG9uVG9rZW4gY2FsbGJhY2sgYW5kIHRoZSBleHRlcm5hbCB0b2tlbml6ZXIuXG5cbnZhciBUb2tlbiA9IGZ1bmN0aW9uIFRva2VuKHApIHtcbiAgdGhpcy50eXBlID0gcC50eXBlO1xuICB0aGlzLnZhbHVlID0gcC52YWx1ZTtcbiAgdGhpcy5zdGFydCA9IHAuc3RhcnQ7XG4gIHRoaXMuZW5kID0gcC5lbmQ7XG4gIGlmIChwLm9wdGlvbnMubG9jYXRpb25zKVxuICAgIHsgdGhpcy5sb2MgPSBuZXcgU291cmNlTG9jYXRpb24ocCwgcC5zdGFydExvYywgcC5lbmRMb2MpOyB9XG4gIGlmIChwLm9wdGlvbnMucmFuZ2VzKVxuICAgIHsgdGhpcy5yYW5nZSA9IFtwLnN0YXJ0LCBwLmVuZF07IH1cbn07XG5cbi8vICMjIFRva2VuaXplclxuXG52YXIgcHAkOSA9IFBhcnNlci5wcm90b3R5cGU7XG5cbi8vIE1vdmUgdG8gdGhlIG5leHQgdG9rZW5cblxucHAkOS5uZXh0ID0gZnVuY3Rpb24oaWdub3JlRXNjYXBlU2VxdWVuY2VJbktleXdvcmQpIHtcbiAgaWYgKCFpZ25vcmVFc2NhcGVTZXF1ZW5jZUluS2V5d29yZCAmJiB0aGlzLnR5cGUua2V5d29yZCAmJiB0aGlzLmNvbnRhaW5zRXNjKVxuICAgIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIFwiRXNjYXBlIHNlcXVlbmNlIGluIGtleXdvcmQgXCIgKyB0aGlzLnR5cGUua2V5d29yZCk7IH1cbiAgaWYgKHRoaXMub3B0aW9ucy5vblRva2VuKVxuICAgIHsgdGhpcy5vcHRpb25zLm9uVG9rZW4obmV3IFRva2VuKHRoaXMpKTsgfVxuXG4gIHRoaXMubGFzdFRva0VuZCA9IHRoaXMuZW5kO1xuICB0aGlzLmxhc3RUb2tTdGFydCA9IHRoaXMuc3RhcnQ7XG4gIHRoaXMubGFzdFRva0VuZExvYyA9IHRoaXMuZW5kTG9jO1xuICB0aGlzLmxhc3RUb2tTdGFydExvYyA9IHRoaXMuc3RhcnRMb2M7XG4gIHRoaXMubmV4dFRva2VuKCk7XG59O1xuXG5wcCQ5LmdldFRva2VuID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMubmV4dCgpO1xuICByZXR1cm4gbmV3IFRva2VuKHRoaXMpXG59O1xuXG4vLyBJZiB3ZSdyZSBpbiBhbiBFUzYgZW52aXJvbm1lbnQsIG1ha2UgcGFyc2VycyBpdGVyYWJsZVxuaWYgKHR5cGVvZiBTeW1ib2wgIT09IFwidW5kZWZpbmVkXCIpXG4gIHsgcHAkOVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG9rZW4gPSB0aGlzJDEuZ2V0VG9rZW4oKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkb25lOiB0b2tlbi50eXBlID09PSB0eXBlcy5lb2YsXG4gICAgICAgICAgdmFsdWU6IHRva2VuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07IH1cblxuLy8gVG9nZ2xlIHN0cmljdCBtb2RlLiBSZS1yZWFkcyB0aGUgbmV4dCBudW1iZXIgb3Igc3RyaW5nIHRvIHBsZWFzZVxuLy8gcGVkYW50aWMgdGVzdHMgKGBcInVzZSBzdHJpY3RcIjsgMDEwO2Agc2hvdWxkIGZhaWwpLlxuXG5wcCQ5LmN1ckNvbnRleHQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMuY29udGV4dFt0aGlzLmNvbnRleHQubGVuZ3RoIC0gMV1cbn07XG5cbi8vIFJlYWQgYSBzaW5nbGUgdG9rZW4sIHVwZGF0aW5nIHRoZSBwYXJzZXIgb2JqZWN0J3MgdG9rZW4tcmVsYXRlZFxuLy8gcHJvcGVydGllcy5cblxucHAkOS5uZXh0VG9rZW4gPSBmdW5jdGlvbigpIHtcbiAgdmFyIGN1ckNvbnRleHQgPSB0aGlzLmN1ckNvbnRleHQoKTtcbiAgaWYgKCFjdXJDb250ZXh0IHx8ICFjdXJDb250ZXh0LnByZXNlcnZlU3BhY2UpIHsgdGhpcy5za2lwU3BhY2UoKTsgfVxuXG4gIHRoaXMuc3RhcnQgPSB0aGlzLnBvcztcbiAgaWYgKHRoaXMub3B0aW9ucy5sb2NhdGlvbnMpIHsgdGhpcy5zdGFydExvYyA9IHRoaXMuY3VyUG9zaXRpb24oKTsgfVxuICBpZiAodGhpcy5wb3MgPj0gdGhpcy5pbnB1dC5sZW5ndGgpIHsgcmV0dXJuIHRoaXMuZmluaXNoVG9rZW4odHlwZXMuZW9mKSB9XG5cbiAgaWYgKGN1ckNvbnRleHQub3ZlcnJpZGUpIHsgcmV0dXJuIGN1ckNvbnRleHQub3ZlcnJpZGUodGhpcykgfVxuICBlbHNlIHsgdGhpcy5yZWFkVG9rZW4odGhpcy5mdWxsQ2hhckNvZGVBdFBvcygpKTsgfVxufTtcblxucHAkOS5yZWFkVG9rZW4gPSBmdW5jdGlvbihjb2RlKSB7XG4gIC8vIElkZW50aWZpZXIgb3Iga2V5d29yZC4gJ1xcdVhYWFgnIHNlcXVlbmNlcyBhcmUgYWxsb3dlZCBpblxuICAvLyBpZGVudGlmaWVycywgc28gJ1xcJyBhbHNvIGRpc3BhdGNoZXMgdG8gdGhhdC5cbiAgaWYgKGlzSWRlbnRpZmllclN0YXJ0KGNvZGUsIHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2KSB8fCBjb2RlID09PSA5MiAvKiAnXFwnICovKVxuICAgIHsgcmV0dXJuIHRoaXMucmVhZFdvcmQoKSB9XG5cbiAgcmV0dXJuIHRoaXMuZ2V0VG9rZW5Gcm9tQ29kZShjb2RlKVxufTtcblxucHAkOS5mdWxsQ2hhckNvZGVBdFBvcyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgY29kZSA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyk7XG4gIGlmIChjb2RlIDw9IDB4ZDdmZiB8fCBjb2RlID49IDB4ZGMwMCkgeyByZXR1cm4gY29kZSB9XG4gIHZhciBuZXh0ID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zICsgMSk7XG4gIHJldHVybiBuZXh0IDw9IDB4ZGJmZiB8fCBuZXh0ID49IDB4ZTAwMCA/IGNvZGUgOiAoY29kZSA8PCAxMCkgKyBuZXh0IC0gMHgzNWZkYzAwXG59O1xuXG5wcCQ5LnNraXBCbG9ja0NvbW1lbnQgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHN0YXJ0TG9jID0gdGhpcy5vcHRpb25zLm9uQ29tbWVudCAmJiB0aGlzLmN1clBvc2l0aW9uKCk7XG4gIHZhciBzdGFydCA9IHRoaXMucG9zLCBlbmQgPSB0aGlzLmlucHV0LmluZGV4T2YoXCIqL1wiLCB0aGlzLnBvcyArPSAyKTtcbiAgaWYgKGVuZCA9PT0gLTEpIHsgdGhpcy5yYWlzZSh0aGlzLnBvcyAtIDIsIFwiVW50ZXJtaW5hdGVkIGNvbW1lbnRcIik7IH1cbiAgdGhpcy5wb3MgPSBlbmQgKyAyO1xuICBpZiAodGhpcy5vcHRpb25zLmxvY2F0aW9ucykge1xuICAgIGxpbmVCcmVha0cubGFzdEluZGV4ID0gc3RhcnQ7XG4gICAgdmFyIG1hdGNoO1xuICAgIHdoaWxlICgobWF0Y2ggPSBsaW5lQnJlYWtHLmV4ZWModGhpcy5pbnB1dCkpICYmIG1hdGNoLmluZGV4IDwgdGhpcy5wb3MpIHtcbiAgICAgICsrdGhpcy5jdXJMaW5lO1xuICAgICAgdGhpcy5saW5lU3RhcnQgPSBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aDtcbiAgICB9XG4gIH1cbiAgaWYgKHRoaXMub3B0aW9ucy5vbkNvbW1lbnQpXG4gICAgeyB0aGlzLm9wdGlvbnMub25Db21tZW50KHRydWUsIHRoaXMuaW5wdXQuc2xpY2Uoc3RhcnQgKyAyLCBlbmQpLCBzdGFydCwgdGhpcy5wb3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydExvYywgdGhpcy5jdXJQb3NpdGlvbigpKTsgfVxufTtcblxucHAkOS5za2lwTGluZUNvbW1lbnQgPSBmdW5jdGlvbihzdGFydFNraXApIHtcbiAgdmFyIHN0YXJ0ID0gdGhpcy5wb3M7XG4gIHZhciBzdGFydExvYyA9IHRoaXMub3B0aW9ucy5vbkNvbW1lbnQgJiYgdGhpcy5jdXJQb3NpdGlvbigpO1xuICB2YXIgY2ggPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MgKz0gc3RhcnRTa2lwKTtcbiAgd2hpbGUgKHRoaXMucG9zIDwgdGhpcy5pbnB1dC5sZW5ndGggJiYgIWlzTmV3TGluZShjaCkpIHtcbiAgICBjaCA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCgrK3RoaXMucG9zKTtcbiAgfVxuICBpZiAodGhpcy5vcHRpb25zLm9uQ29tbWVudClcbiAgICB7IHRoaXMub3B0aW9ucy5vbkNvbW1lbnQoZmFsc2UsIHRoaXMuaW5wdXQuc2xpY2Uoc3RhcnQgKyBzdGFydFNraXAsIHRoaXMucG9zKSwgc3RhcnQsIHRoaXMucG9zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRMb2MsIHRoaXMuY3VyUG9zaXRpb24oKSk7IH1cbn07XG5cbi8vIENhbGxlZCBhdCB0aGUgc3RhcnQgb2YgdGhlIHBhcnNlIGFuZCBhZnRlciBldmVyeSB0b2tlbi4gU2tpcHNcbi8vIHdoaXRlc3BhY2UgYW5kIGNvbW1lbnRzLCBhbmQuXG5cbnBwJDkuc2tpcFNwYWNlID0gZnVuY3Rpb24oKSB7XG4gIGxvb3A6IHdoaWxlICh0aGlzLnBvcyA8IHRoaXMuaW5wdXQubGVuZ3RoKSB7XG4gICAgdmFyIGNoID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKTtcbiAgICBzd2l0Y2ggKGNoKSB7XG4gICAgY2FzZSAzMjogY2FzZSAxNjA6IC8vICcgJ1xuICAgICAgKyt0aGlzLnBvcztcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAxMzpcbiAgICAgIGlmICh0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MgKyAxKSA9PT0gMTApIHtcbiAgICAgICAgKyt0aGlzLnBvcztcbiAgICAgIH1cbiAgICBjYXNlIDEwOiBjYXNlIDgyMzI6IGNhc2UgODIzMzpcbiAgICAgICsrdGhpcy5wb3M7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmxvY2F0aW9ucykge1xuICAgICAgICArK3RoaXMuY3VyTGluZTtcbiAgICAgICAgdGhpcy5saW5lU3RhcnQgPSB0aGlzLnBvcztcbiAgICAgIH1cbiAgICAgIGJyZWFrXG4gICAgY2FzZSA0NzogLy8gJy8nXG4gICAgICBzd2l0Y2ggKHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyArIDEpKSB7XG4gICAgICBjYXNlIDQyOiAvLyAnKidcbiAgICAgICAgdGhpcy5za2lwQmxvY2tDb21tZW50KCk7XG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlIDQ3OlxuICAgICAgICB0aGlzLnNraXBMaW5lQ29tbWVudCgyKTtcbiAgICAgICAgYnJlYWtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrIGxvb3BcbiAgICAgIH1cbiAgICAgIGJyZWFrXG4gICAgZGVmYXVsdDpcbiAgICAgIGlmIChjaCA+IDggJiYgY2ggPCAxNCB8fCBjaCA+PSA1NzYwICYmIG5vbkFTQ0lJd2hpdGVzcGFjZS50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKSkge1xuICAgICAgICArK3RoaXMucG9zO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYnJlYWsgbG9vcFxuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuLy8gQ2FsbGVkIGF0IHRoZSBlbmQgb2YgZXZlcnkgdG9rZW4uIFNldHMgYGVuZGAsIGB2YWxgLCBhbmRcbi8vIG1haW50YWlucyBgY29udGV4dGAgYW5kIGBleHByQWxsb3dlZGAsIGFuZCBza2lwcyB0aGUgc3BhY2UgYWZ0ZXJcbi8vIHRoZSB0b2tlbiwgc28gdGhhdCB0aGUgbmV4dCBvbmUncyBgc3RhcnRgIHdpbGwgcG9pbnQgYXQgdGhlXG4vLyByaWdodCBwb3NpdGlvbi5cblxucHAkOS5maW5pc2hUb2tlbiA9IGZ1bmN0aW9uKHR5cGUsIHZhbCkge1xuICB0aGlzLmVuZCA9IHRoaXMucG9zO1xuICBpZiAodGhpcy5vcHRpb25zLmxvY2F0aW9ucykgeyB0aGlzLmVuZExvYyA9IHRoaXMuY3VyUG9zaXRpb24oKTsgfVxuICB2YXIgcHJldlR5cGUgPSB0aGlzLnR5cGU7XG4gIHRoaXMudHlwZSA9IHR5cGU7XG4gIHRoaXMudmFsdWUgPSB2YWw7XG5cbiAgdGhpcy51cGRhdGVDb250ZXh0KHByZXZUeXBlKTtcbn07XG5cbi8vICMjIyBUb2tlbiByZWFkaW5nXG5cbi8vIFRoaXMgaXMgdGhlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHRvIGZldGNoIHRoZSBuZXh0IHRva2VuLiBJdFxuLy8gaXMgc29tZXdoYXQgb2JzY3VyZSwgYmVjYXVzZSBpdCB3b3JrcyBpbiBjaGFyYWN0ZXIgY29kZXMgcmF0aGVyXG4vLyB0aGFuIGNoYXJhY3RlcnMsIGFuZCBiZWNhdXNlIG9wZXJhdG9yIHBhcnNpbmcgaGFzIGJlZW4gaW5saW5lZFxuLy8gaW50byBpdC5cbi8vXG4vLyBBbGwgaW4gdGhlIG5hbWUgb2Ygc3BlZWQuXG4vL1xucHAkOS5yZWFkVG9rZW5fZG90ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBuZXh0ID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zICsgMSk7XG4gIGlmIChuZXh0ID49IDQ4ICYmIG5leHQgPD0gNTcpIHsgcmV0dXJuIHRoaXMucmVhZE51bWJlcih0cnVlKSB9XG4gIHZhciBuZXh0MiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyArIDIpO1xuICBpZiAodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDYgJiYgbmV4dCA9PT0gNDYgJiYgbmV4dDIgPT09IDQ2KSB7IC8vIDQ2ID0gZG90ICcuJ1xuICAgIHRoaXMucG9zICs9IDM7XG4gICAgcmV0dXJuIHRoaXMuZmluaXNoVG9rZW4odHlwZXMuZWxsaXBzaXMpXG4gIH0gZWxzZSB7XG4gICAgKyt0aGlzLnBvcztcbiAgICByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5kb3QpXG4gIH1cbn07XG5cbnBwJDkucmVhZFRva2VuX3NsYXNoID0gZnVuY3Rpb24oKSB7IC8vICcvJ1xuICB2YXIgbmV4dCA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyArIDEpO1xuICBpZiAodGhpcy5leHByQWxsb3dlZCkgeyArK3RoaXMucG9zOyByZXR1cm4gdGhpcy5yZWFkUmVnZXhwKCkgfVxuICBpZiAobmV4dCA9PT0gNjEpIHsgcmV0dXJuIHRoaXMuZmluaXNoT3AodHlwZXMuYXNzaWduLCAyKSB9XG4gIHJldHVybiB0aGlzLmZpbmlzaE9wKHR5cGVzLnNsYXNoLCAxKVxufTtcblxucHAkOS5yZWFkVG9rZW5fbXVsdF9tb2R1bG9fZXhwID0gZnVuY3Rpb24oY29kZSkgeyAvLyAnJSonXG4gIHZhciBuZXh0ID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zICsgMSk7XG4gIHZhciBzaXplID0gMTtcbiAgdmFyIHRva2VudHlwZSA9IGNvZGUgPT09IDQyID8gdHlwZXMuc3RhciA6IHR5cGVzLm1vZHVsbztcblxuICAvLyBleHBvbmVudGlhdGlvbiBvcGVyYXRvciAqKiBhbmQgKio9XG4gIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gNyAmJiBjb2RlID09PSA0MiAmJiBuZXh0ID09PSA0Mikge1xuICAgICsrc2l6ZTtcbiAgICB0b2tlbnR5cGUgPSB0eXBlcy5zdGFyc3RhcjtcbiAgICBuZXh0ID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zICsgMik7XG4gIH1cblxuICBpZiAobmV4dCA9PT0gNjEpIHsgcmV0dXJuIHRoaXMuZmluaXNoT3AodHlwZXMuYXNzaWduLCBzaXplICsgMSkgfVxuICByZXR1cm4gdGhpcy5maW5pc2hPcCh0b2tlbnR5cGUsIHNpemUpXG59O1xuXG5wcCQ5LnJlYWRUb2tlbl9waXBlX2FtcCA9IGZ1bmN0aW9uKGNvZGUpIHsgLy8gJ3wmJ1xuICB2YXIgbmV4dCA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyArIDEpO1xuICBpZiAobmV4dCA9PT0gY29kZSkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gMTIpIHtcbiAgICAgIHZhciBuZXh0MiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyArIDIpO1xuICAgICAgaWYgKG5leHQyID09PSA2MSkgeyByZXR1cm4gdGhpcy5maW5pc2hPcCh0eXBlcy5hc3NpZ24sIDMpIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZmluaXNoT3AoY29kZSA9PT0gMTI0ID8gdHlwZXMubG9naWNhbE9SIDogdHlwZXMubG9naWNhbEFORCwgMilcbiAgfVxuICBpZiAobmV4dCA9PT0gNjEpIHsgcmV0dXJuIHRoaXMuZmluaXNoT3AodHlwZXMuYXNzaWduLCAyKSB9XG4gIHJldHVybiB0aGlzLmZpbmlzaE9wKGNvZGUgPT09IDEyNCA/IHR5cGVzLmJpdHdpc2VPUiA6IHR5cGVzLmJpdHdpc2VBTkQsIDEpXG59O1xuXG5wcCQ5LnJlYWRUb2tlbl9jYXJldCA9IGZ1bmN0aW9uKCkgeyAvLyAnXidcbiAgdmFyIG5leHQgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MgKyAxKTtcbiAgaWYgKG5leHQgPT09IDYxKSB7IHJldHVybiB0aGlzLmZpbmlzaE9wKHR5cGVzLmFzc2lnbiwgMikgfVxuICByZXR1cm4gdGhpcy5maW5pc2hPcCh0eXBlcy5iaXR3aXNlWE9SLCAxKVxufTtcblxucHAkOS5yZWFkVG9rZW5fcGx1c19taW4gPSBmdW5jdGlvbihjb2RlKSB7IC8vICcrLSdcbiAgdmFyIG5leHQgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MgKyAxKTtcbiAgaWYgKG5leHQgPT09IGNvZGUpIHtcbiAgICBpZiAobmV4dCA9PT0gNDUgJiYgIXRoaXMuaW5Nb2R1bGUgJiYgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zICsgMikgPT09IDYyICYmXG4gICAgICAgICh0aGlzLmxhc3RUb2tFbmQgPT09IDAgfHwgbGluZUJyZWFrLnRlc3QodGhpcy5pbnB1dC5zbGljZSh0aGlzLmxhc3RUb2tFbmQsIHRoaXMucG9zKSkpKSB7XG4gICAgICAvLyBBIGAtLT5gIGxpbmUgY29tbWVudFxuICAgICAgdGhpcy5za2lwTGluZUNvbW1lbnQoMyk7XG4gICAgICB0aGlzLnNraXBTcGFjZSgpO1xuICAgICAgcmV0dXJuIHRoaXMubmV4dFRva2VuKClcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZmluaXNoT3AodHlwZXMuaW5jRGVjLCAyKVxuICB9XG4gIGlmIChuZXh0ID09PSA2MSkgeyByZXR1cm4gdGhpcy5maW5pc2hPcCh0eXBlcy5hc3NpZ24sIDIpIH1cbiAgcmV0dXJuIHRoaXMuZmluaXNoT3AodHlwZXMucGx1c01pbiwgMSlcbn07XG5cbnBwJDkucmVhZFRva2VuX2x0X2d0ID0gZnVuY3Rpb24oY29kZSkgeyAvLyAnPD4nXG4gIHZhciBuZXh0ID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zICsgMSk7XG4gIHZhciBzaXplID0gMTtcbiAgaWYgKG5leHQgPT09IGNvZGUpIHtcbiAgICBzaXplID0gY29kZSA9PT0gNjIgJiYgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zICsgMikgPT09IDYyID8gMyA6IDI7XG4gICAgaWYgKHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyArIHNpemUpID09PSA2MSkgeyByZXR1cm4gdGhpcy5maW5pc2hPcCh0eXBlcy5hc3NpZ24sIHNpemUgKyAxKSB9XG4gICAgcmV0dXJuIHRoaXMuZmluaXNoT3AodHlwZXMuYml0U2hpZnQsIHNpemUpXG4gIH1cbiAgaWYgKG5leHQgPT09IDMzICYmIGNvZGUgPT09IDYwICYmICF0aGlzLmluTW9kdWxlICYmIHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyArIDIpID09PSA0NSAmJlxuICAgICAgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zICsgMykgPT09IDQ1KSB7XG4gICAgLy8gYDwhLS1gLCBhbiBYTUwtc3R5bGUgY29tbWVudCB0aGF0IHNob3VsZCBiZSBpbnRlcnByZXRlZCBhcyBhIGxpbmUgY29tbWVudFxuICAgIHRoaXMuc2tpcExpbmVDb21tZW50KDQpO1xuICAgIHRoaXMuc2tpcFNwYWNlKCk7XG4gICAgcmV0dXJuIHRoaXMubmV4dFRva2VuKClcbiAgfVxuICBpZiAobmV4dCA9PT0gNjEpIHsgc2l6ZSA9IDI7IH1cbiAgcmV0dXJuIHRoaXMuZmluaXNoT3AodHlwZXMucmVsYXRpb25hbCwgc2l6ZSlcbn07XG5cbnBwJDkucmVhZFRva2VuX2VxX2V4Y2wgPSBmdW5jdGlvbihjb2RlKSB7IC8vICc9ISdcbiAgdmFyIG5leHQgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MgKyAxKTtcbiAgaWYgKG5leHQgPT09IDYxKSB7IHJldHVybiB0aGlzLmZpbmlzaE9wKHR5cGVzLmVxdWFsaXR5LCB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MgKyAyKSA9PT0gNjEgPyAzIDogMikgfVxuICBpZiAoY29kZSA9PT0gNjEgJiYgbmV4dCA9PT0gNjIgJiYgdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDYpIHsgLy8gJz0+J1xuICAgIHRoaXMucG9zICs9IDI7XG4gICAgcmV0dXJuIHRoaXMuZmluaXNoVG9rZW4odHlwZXMuYXJyb3cpXG4gIH1cbiAgcmV0dXJuIHRoaXMuZmluaXNoT3AoY29kZSA9PT0gNjEgPyB0eXBlcy5lcSA6IHR5cGVzLnByZWZpeCwgMSlcbn07XG5cbnBwJDkucmVhZFRva2VuX3F1ZXN0aW9uID0gZnVuY3Rpb24oKSB7IC8vICc/J1xuICB2YXIgZWNtYVZlcnNpb24gPSB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb247XG4gIGlmIChlY21hVmVyc2lvbiA+PSAxMSkge1xuICAgIHZhciBuZXh0ID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zICsgMSk7XG4gICAgaWYgKG5leHQgPT09IDQ2KSB7XG4gICAgICB2YXIgbmV4dDIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MgKyAyKTtcbiAgICAgIGlmIChuZXh0MiA8IDQ4IHx8IG5leHQyID4gNTcpIHsgcmV0dXJuIHRoaXMuZmluaXNoT3AodHlwZXMucXVlc3Rpb25Eb3QsIDIpIH1cbiAgICB9XG4gICAgaWYgKG5leHQgPT09IDYzKSB7XG4gICAgICBpZiAoZWNtYVZlcnNpb24gPj0gMTIpIHtcbiAgICAgICAgdmFyIG5leHQyJDEgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MgKyAyKTtcbiAgICAgICAgaWYgKG5leHQyJDEgPT09IDYxKSB7IHJldHVybiB0aGlzLmZpbmlzaE9wKHR5cGVzLmFzc2lnbiwgMykgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuZmluaXNoT3AodHlwZXMuY29hbGVzY2UsIDIpXG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzLmZpbmlzaE9wKHR5cGVzLnF1ZXN0aW9uLCAxKVxufTtcblxucHAkOS5yZWFkVG9rZW5fbnVtYmVyU2lnbiA9IGZ1bmN0aW9uKCkgeyAvLyAnIydcbiAgdmFyIGVjbWFWZXJzaW9uID0gdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uO1xuICB2YXIgY29kZSA9IDM1OyAvLyAnIydcbiAgaWYgKGVjbWFWZXJzaW9uID49IDEzKSB7XG4gICAgKyt0aGlzLnBvcztcbiAgICBjb2RlID0gdGhpcy5mdWxsQ2hhckNvZGVBdFBvcygpO1xuICAgIGlmIChpc0lkZW50aWZpZXJTdGFydChjb2RlLCB0cnVlKSB8fCBjb2RlID09PSA5MiAvKiAnXFwnICovKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5wcml2YXRlSWQsIHRoaXMucmVhZFdvcmQxKCkpXG4gICAgfVxuICB9XG5cbiAgdGhpcy5yYWlzZSh0aGlzLnBvcywgXCJVbmV4cGVjdGVkIGNoYXJhY3RlciAnXCIgKyBjb2RlUG9pbnRUb1N0cmluZyQxKGNvZGUpICsgXCInXCIpO1xufTtcblxucHAkOS5nZXRUb2tlbkZyb21Db2RlID0gZnVuY3Rpb24oY29kZSkge1xuICBzd2l0Y2ggKGNvZGUpIHtcbiAgLy8gVGhlIGludGVycHJldGF0aW9uIG9mIGEgZG90IGRlcGVuZHMgb24gd2hldGhlciBpdCBpcyBmb2xsb3dlZFxuICAvLyBieSBhIGRpZ2l0IG9yIGFub3RoZXIgdHdvIGRvdHMuXG4gIGNhc2UgNDY6IC8vICcuJ1xuICAgIHJldHVybiB0aGlzLnJlYWRUb2tlbl9kb3QoKVxuXG4gIC8vIFB1bmN0dWF0aW9uIHRva2Vucy5cbiAgY2FzZSA0MDogKyt0aGlzLnBvczsgcmV0dXJuIHRoaXMuZmluaXNoVG9rZW4odHlwZXMucGFyZW5MKVxuICBjYXNlIDQxOiArK3RoaXMucG9zOyByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5wYXJlblIpXG4gIGNhc2UgNTk6ICsrdGhpcy5wb3M7IHJldHVybiB0aGlzLmZpbmlzaFRva2VuKHR5cGVzLnNlbWkpXG4gIGNhc2UgNDQ6ICsrdGhpcy5wb3M7IHJldHVybiB0aGlzLmZpbmlzaFRva2VuKHR5cGVzLmNvbW1hKVxuICBjYXNlIDkxOiArK3RoaXMucG9zOyByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5icmFja2V0TClcbiAgY2FzZSA5MzogKyt0aGlzLnBvczsgcmV0dXJuIHRoaXMuZmluaXNoVG9rZW4odHlwZXMuYnJhY2tldFIpXG4gIGNhc2UgMTIzOiArK3RoaXMucG9zOyByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5icmFjZUwpXG4gIGNhc2UgMTI1OiArK3RoaXMucG9zOyByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5icmFjZVIpXG4gIGNhc2UgNTg6ICsrdGhpcy5wb3M7IHJldHVybiB0aGlzLmZpbmlzaFRva2VuKHR5cGVzLmNvbG9uKVxuXG4gIGNhc2UgOTY6IC8vICdgJ1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPCA2KSB7IGJyZWFrIH1cbiAgICArK3RoaXMucG9zO1xuICAgIHJldHVybiB0aGlzLmZpbmlzaFRva2VuKHR5cGVzLmJhY2tRdW90ZSlcblxuICBjYXNlIDQ4OiAvLyAnMCdcbiAgICB2YXIgbmV4dCA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyArIDEpO1xuICAgIGlmIChuZXh0ID09PSAxMjAgfHwgbmV4dCA9PT0gODgpIHsgcmV0dXJuIHRoaXMucmVhZFJhZGl4TnVtYmVyKDE2KSB9IC8vICcweCcsICcwWCcgLSBoZXggbnVtYmVyXG4gICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSA2KSB7XG4gICAgICBpZiAobmV4dCA9PT0gMTExIHx8IG5leHQgPT09IDc5KSB7IHJldHVybiB0aGlzLnJlYWRSYWRpeE51bWJlcig4KSB9IC8vICcwbycsICcwTycgLSBvY3RhbCBudW1iZXJcbiAgICAgIGlmIChuZXh0ID09PSA5OCB8fCBuZXh0ID09PSA2NikgeyByZXR1cm4gdGhpcy5yZWFkUmFkaXhOdW1iZXIoMikgfSAvLyAnMGInLCAnMEInIC0gYmluYXJ5IG51bWJlclxuICAgIH1cblxuICAvLyBBbnl0aGluZyBlbHNlIGJlZ2lubmluZyB3aXRoIGEgZGlnaXQgaXMgYW4gaW50ZWdlciwgb2N0YWxcbiAgLy8gbnVtYmVyLCBvciBmbG9hdC5cbiAgY2FzZSA0OTogY2FzZSA1MDogY2FzZSA1MTogY2FzZSA1MjogY2FzZSA1MzogY2FzZSA1NDogY2FzZSA1NTogY2FzZSA1NjogY2FzZSA1NzogLy8gMS05XG4gICAgcmV0dXJuIHRoaXMucmVhZE51bWJlcihmYWxzZSlcblxuICAvLyBRdW90ZXMgcHJvZHVjZSBzdHJpbmdzLlxuICBjYXNlIDM0OiBjYXNlIDM5OiAvLyAnXCInLCBcIidcIlxuICAgIHJldHVybiB0aGlzLnJlYWRTdHJpbmcoY29kZSlcblxuICAvLyBPcGVyYXRvcnMgYXJlIHBhcnNlZCBpbmxpbmUgaW4gdGlueSBzdGF0ZSBtYWNoaW5lcy4gJz0nICg2MSkgaXNcbiAgLy8gb2Z0ZW4gcmVmZXJyZWQgdG8uIGBmaW5pc2hPcGAgc2ltcGx5IHNraXBzIHRoZSBhbW91bnQgb2ZcbiAgLy8gY2hhcmFjdGVycyBpdCBpcyBnaXZlbiBhcyBzZWNvbmQgYXJndW1lbnQsIGFuZCByZXR1cm5zIGEgdG9rZW5cbiAgLy8gb2YgdGhlIHR5cGUgZ2l2ZW4gYnkgaXRzIGZpcnN0IGFyZ3VtZW50LlxuXG4gIGNhc2UgNDc6IC8vICcvJ1xuICAgIHJldHVybiB0aGlzLnJlYWRUb2tlbl9zbGFzaCgpXG5cbiAgY2FzZSAzNzogY2FzZSA0MjogLy8gJyUqJ1xuICAgIHJldHVybiB0aGlzLnJlYWRUb2tlbl9tdWx0X21vZHVsb19leHAoY29kZSlcblxuICBjYXNlIDEyNDogY2FzZSAzODogLy8gJ3wmJ1xuICAgIHJldHVybiB0aGlzLnJlYWRUb2tlbl9waXBlX2FtcChjb2RlKVxuXG4gIGNhc2UgOTQ6IC8vICdeJ1xuICAgIHJldHVybiB0aGlzLnJlYWRUb2tlbl9jYXJldCgpXG5cbiAgY2FzZSA0MzogY2FzZSA0NTogLy8gJystJ1xuICAgIHJldHVybiB0aGlzLnJlYWRUb2tlbl9wbHVzX21pbihjb2RlKVxuXG4gIGNhc2UgNjA6IGNhc2UgNjI6IC8vICc8PidcbiAgICByZXR1cm4gdGhpcy5yZWFkVG9rZW5fbHRfZ3QoY29kZSlcblxuICBjYXNlIDYxOiBjYXNlIDMzOiAvLyAnPSEnXG4gICAgcmV0dXJuIHRoaXMucmVhZFRva2VuX2VxX2V4Y2woY29kZSlcblxuICBjYXNlIDYzOiAvLyAnPydcbiAgICByZXR1cm4gdGhpcy5yZWFkVG9rZW5fcXVlc3Rpb24oKVxuXG4gIGNhc2UgMTI2OiAvLyAnfidcbiAgICByZXR1cm4gdGhpcy5maW5pc2hPcCh0eXBlcy5wcmVmaXgsIDEpXG5cbiAgY2FzZSAzNTogLy8gJyMnXG4gICAgcmV0dXJuIHRoaXMucmVhZFRva2VuX251bWJlclNpZ24oKVxuICB9XG5cbiAgdGhpcy5yYWlzZSh0aGlzLnBvcywgXCJVbmV4cGVjdGVkIGNoYXJhY3RlciAnXCIgKyBjb2RlUG9pbnRUb1N0cmluZyQxKGNvZGUpICsgXCInXCIpO1xufTtcblxucHAkOS5maW5pc2hPcCA9IGZ1bmN0aW9uKHR5cGUsIHNpemUpIHtcbiAgdmFyIHN0ciA9IHRoaXMuaW5wdXQuc2xpY2UodGhpcy5wb3MsIHRoaXMucG9zICsgc2l6ZSk7XG4gIHRoaXMucG9zICs9IHNpemU7XG4gIHJldHVybiB0aGlzLmZpbmlzaFRva2VuKHR5cGUsIHN0cilcbn07XG5cbnBwJDkucmVhZFJlZ2V4cCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgZXNjYXBlZCwgaW5DbGFzcywgc3RhcnQgPSB0aGlzLnBvcztcbiAgZm9yICg7Oykge1xuICAgIGlmICh0aGlzLnBvcyA+PSB0aGlzLmlucHV0Lmxlbmd0aCkgeyB0aGlzLnJhaXNlKHN0YXJ0LCBcIlVudGVybWluYXRlZCByZWd1bGFyIGV4cHJlc3Npb25cIik7IH1cbiAgICB2YXIgY2ggPSB0aGlzLmlucHV0LmNoYXJBdCh0aGlzLnBvcyk7XG4gICAgaWYgKGxpbmVCcmVhay50ZXN0KGNoKSkgeyB0aGlzLnJhaXNlKHN0YXJ0LCBcIlVudGVybWluYXRlZCByZWd1bGFyIGV4cHJlc3Npb25cIik7IH1cbiAgICBpZiAoIWVzY2FwZWQpIHtcbiAgICAgIGlmIChjaCA9PT0gXCJbXCIpIHsgaW5DbGFzcyA9IHRydWU7IH1cbiAgICAgIGVsc2UgaWYgKGNoID09PSBcIl1cIiAmJiBpbkNsYXNzKSB7IGluQ2xhc3MgPSBmYWxzZTsgfVxuICAgICAgZWxzZSBpZiAoY2ggPT09IFwiL1wiICYmICFpbkNsYXNzKSB7IGJyZWFrIH1cbiAgICAgIGVzY2FwZWQgPSBjaCA9PT0gXCJcXFxcXCI7XG4gICAgfSBlbHNlIHsgZXNjYXBlZCA9IGZhbHNlOyB9XG4gICAgKyt0aGlzLnBvcztcbiAgfVxuICB2YXIgcGF0dGVybiA9IHRoaXMuaW5wdXQuc2xpY2Uoc3RhcnQsIHRoaXMucG9zKTtcbiAgKyt0aGlzLnBvcztcbiAgdmFyIGZsYWdzU3RhcnQgPSB0aGlzLnBvcztcbiAgdmFyIGZsYWdzID0gdGhpcy5yZWFkV29yZDEoKTtcbiAgaWYgKHRoaXMuY29udGFpbnNFc2MpIHsgdGhpcy51bmV4cGVjdGVkKGZsYWdzU3RhcnQpOyB9XG5cbiAgLy8gVmFsaWRhdGUgcGF0dGVyblxuICB2YXIgc3RhdGUgPSB0aGlzLnJlZ2V4cFN0YXRlIHx8ICh0aGlzLnJlZ2V4cFN0YXRlID0gbmV3IFJlZ0V4cFZhbGlkYXRpb25TdGF0ZSh0aGlzKSk7XG4gIHN0YXRlLnJlc2V0KHN0YXJ0LCBwYXR0ZXJuLCBmbGFncyk7XG4gIHRoaXMudmFsaWRhdGVSZWdFeHBGbGFncyhzdGF0ZSk7XG4gIHRoaXMudmFsaWRhdGVSZWdFeHBQYXR0ZXJuKHN0YXRlKTtcblxuICAvLyBDcmVhdGUgTGl0ZXJhbCN2YWx1ZSBwcm9wZXJ0eSB2YWx1ZS5cbiAgdmFyIHZhbHVlID0gbnVsbDtcbiAgdHJ5IHtcbiAgICB2YWx1ZSA9IG5ldyBSZWdFeHAocGF0dGVybiwgZmxhZ3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gRVNUcmVlIHJlcXVpcmVzIG51bGwgaWYgaXQgZmFpbGVkIHRvIGluc3RhbnRpYXRlIFJlZ0V4cCBvYmplY3QuXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2VzdHJlZS9lc3RyZWUvYmxvYi9hMjcwMDNhZGY0ZmQ3YmZhZDQ0ZGU5Y2VmMzcyYTJlYWNkNTI3YjFjL2VzNS5tZCNyZWdleHBsaXRlcmFsXG4gIH1cblxuICByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5yZWdleHAsIHtwYXR0ZXJuOiBwYXR0ZXJuLCBmbGFnczogZmxhZ3MsIHZhbHVlOiB2YWx1ZX0pXG59O1xuXG4vLyBSZWFkIGFuIGludGVnZXIgaW4gdGhlIGdpdmVuIHJhZGl4LiBSZXR1cm4gbnVsbCBpZiB6ZXJvIGRpZ2l0c1xuLy8gd2VyZSByZWFkLCB0aGUgaW50ZWdlciB2YWx1ZSBvdGhlcndpc2UuIFdoZW4gYGxlbmAgaXMgZ2l2ZW4sIHRoaXNcbi8vIHdpbGwgcmV0dXJuIGBudWxsYCB1bmxlc3MgdGhlIGludGVnZXIgaGFzIGV4YWN0bHkgYGxlbmAgZGlnaXRzLlxuXG5wcCQ5LnJlYWRJbnQgPSBmdW5jdGlvbihyYWRpeCwgbGVuLCBtYXliZUxlZ2FjeU9jdGFsTnVtZXJpY0xpdGVyYWwpIHtcbiAgLy8gYGxlbmAgaXMgdXNlZCBmb3IgY2hhcmFjdGVyIGVzY2FwZSBzZXF1ZW5jZXMuIEluIHRoYXQgY2FzZSwgZGlzYWxsb3cgc2VwYXJhdG9ycy5cbiAgdmFyIGFsbG93U2VwYXJhdG9ycyA9IHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA+PSAxMiAmJiBsZW4gPT09IHVuZGVmaW5lZDtcblxuICAvLyBgbWF5YmVMZWdhY3lPY3RhbE51bWVyaWNMaXRlcmFsYCBpcyB0cnVlIGlmIGl0IGRvZXNuJ3QgaGF2ZSBwcmVmaXggKDB4LDBvLDBiKVxuICAvLyBhbmQgaXNuJ3QgZnJhY3Rpb24gcGFydCBub3IgZXhwb25lbnQgcGFydC4gSW4gdGhhdCBjYXNlLCBpZiB0aGUgZmlyc3QgZGlnaXRcbiAgLy8gaXMgemVybyB0aGVuIGRpc2FsbG93IHNlcGFyYXRvcnMuXG4gIHZhciBpc0xlZ2FjeU9jdGFsTnVtZXJpY0xpdGVyYWwgPSBtYXliZUxlZ2FjeU9jdGFsTnVtZXJpY0xpdGVyYWwgJiYgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKSA9PT0gNDg7XG5cbiAgdmFyIHN0YXJ0ID0gdGhpcy5wb3MsIHRvdGFsID0gMCwgbGFzdENvZGUgPSAwO1xuICBmb3IgKHZhciBpID0gMCwgZSA9IGxlbiA9PSBudWxsID8gSW5maW5pdHkgOiBsZW47IGkgPCBlOyArK2ksICsrdGhpcy5wb3MpIHtcbiAgICB2YXIgY29kZSA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyksIHZhbCA9ICh2b2lkIDApO1xuXG4gICAgaWYgKGFsbG93U2VwYXJhdG9ycyAmJiBjb2RlID09PSA5NSkge1xuICAgICAgaWYgKGlzTGVnYWN5T2N0YWxOdW1lcmljTGl0ZXJhbCkgeyB0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5wb3MsIFwiTnVtZXJpYyBzZXBhcmF0b3IgaXMgbm90IGFsbG93ZWQgaW4gbGVnYWN5IG9jdGFsIG51bWVyaWMgbGl0ZXJhbHNcIik7IH1cbiAgICAgIGlmIChsYXN0Q29kZSA9PT0gOTUpIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMucG9zLCBcIk51bWVyaWMgc2VwYXJhdG9yIG11c3QgYmUgZXhhY3RseSBvbmUgdW5kZXJzY29yZVwiKTsgfVxuICAgICAgaWYgKGkgPT09IDApIHsgdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMucG9zLCBcIk51bWVyaWMgc2VwYXJhdG9yIGlzIG5vdCBhbGxvd2VkIGF0IHRoZSBmaXJzdCBvZiBkaWdpdHNcIik7IH1cbiAgICAgIGxhc3RDb2RlID0gY29kZTtcbiAgICAgIGNvbnRpbnVlXG4gICAgfVxuXG4gICAgaWYgKGNvZGUgPj0gOTcpIHsgdmFsID0gY29kZSAtIDk3ICsgMTA7IH0gLy8gYVxuICAgIGVsc2UgaWYgKGNvZGUgPj0gNjUpIHsgdmFsID0gY29kZSAtIDY1ICsgMTA7IH0gLy8gQVxuICAgIGVsc2UgaWYgKGNvZGUgPj0gNDggJiYgY29kZSA8PSA1NykgeyB2YWwgPSBjb2RlIC0gNDg7IH0gLy8gMC05XG4gICAgZWxzZSB7IHZhbCA9IEluZmluaXR5OyB9XG4gICAgaWYgKHZhbCA+PSByYWRpeCkgeyBicmVhayB9XG4gICAgbGFzdENvZGUgPSBjb2RlO1xuICAgIHRvdGFsID0gdG90YWwgKiByYWRpeCArIHZhbDtcbiAgfVxuXG4gIGlmIChhbGxvd1NlcGFyYXRvcnMgJiYgbGFzdENvZGUgPT09IDk1KSB7IHRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnBvcyAtIDEsIFwiTnVtZXJpYyBzZXBhcmF0b3IgaXMgbm90IGFsbG93ZWQgYXQgdGhlIGxhc3Qgb2YgZGlnaXRzXCIpOyB9XG4gIGlmICh0aGlzLnBvcyA9PT0gc3RhcnQgfHwgbGVuICE9IG51bGwgJiYgdGhpcy5wb3MgLSBzdGFydCAhPT0gbGVuKSB7IHJldHVybiBudWxsIH1cblxuICByZXR1cm4gdG90YWxcbn07XG5cbmZ1bmN0aW9uIHN0cmluZ1RvTnVtYmVyKHN0ciwgaXNMZWdhY3lPY3RhbE51bWVyaWNMaXRlcmFsKSB7XG4gIGlmIChpc0xlZ2FjeU9jdGFsTnVtZXJpY0xpdGVyYWwpIHtcbiAgICByZXR1cm4gcGFyc2VJbnQoc3RyLCA4KVxuICB9XG5cbiAgLy8gYHBhcnNlRmxvYXQodmFsdWUpYCBzdG9wcyBwYXJzaW5nIGF0IHRoZSBmaXJzdCBudW1lcmljIHNlcGFyYXRvciB0aGVuIHJldHVybnMgYSB3cm9uZyB2YWx1ZS5cbiAgcmV0dXJuIHBhcnNlRmxvYXQoc3RyLnJlcGxhY2UoL18vZywgXCJcIikpXG59XG5cbmZ1bmN0aW9uIHN0cmluZ1RvQmlnSW50KHN0cikge1xuICBpZiAodHlwZW9mIEJpZ0ludCAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIC8vIGBCaWdJbnQodmFsdWUpYCB0aHJvd3Mgc3ludGF4IGVycm9yIGlmIHRoZSBzdHJpbmcgY29udGFpbnMgbnVtZXJpYyBzZXBhcmF0b3JzLlxuICByZXR1cm4gQmlnSW50KHN0ci5yZXBsYWNlKC9fL2csIFwiXCIpKVxufVxuXG5wcCQ5LnJlYWRSYWRpeE51bWJlciA9IGZ1bmN0aW9uKHJhZGl4KSB7XG4gIHZhciBzdGFydCA9IHRoaXMucG9zO1xuICB0aGlzLnBvcyArPSAyOyAvLyAweFxuICB2YXIgdmFsID0gdGhpcy5yZWFkSW50KHJhZGl4KTtcbiAgaWYgKHZhbCA9PSBudWxsKSB7IHRoaXMucmFpc2UodGhpcy5zdGFydCArIDIsIFwiRXhwZWN0ZWQgbnVtYmVyIGluIHJhZGl4IFwiICsgcmFkaXgpOyB9XG4gIGlmICh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gMTEgJiYgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKSA9PT0gMTEwKSB7XG4gICAgdmFsID0gc3RyaW5nVG9CaWdJbnQodGhpcy5pbnB1dC5zbGljZShzdGFydCwgdGhpcy5wb3MpKTtcbiAgICArK3RoaXMucG9zO1xuICB9IGVsc2UgaWYgKGlzSWRlbnRpZmllclN0YXJ0KHRoaXMuZnVsbENoYXJDb2RlQXRQb3MoKSkpIHsgdGhpcy5yYWlzZSh0aGlzLnBvcywgXCJJZGVudGlmaWVyIGRpcmVjdGx5IGFmdGVyIG51bWJlclwiKTsgfVxuICByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5udW0sIHZhbClcbn07XG5cbi8vIFJlYWQgYW4gaW50ZWdlciwgb2N0YWwgaW50ZWdlciwgb3IgZmxvYXRpbmctcG9pbnQgbnVtYmVyLlxuXG5wcCQ5LnJlYWROdW1iZXIgPSBmdW5jdGlvbihzdGFydHNXaXRoRG90KSB7XG4gIHZhciBzdGFydCA9IHRoaXMucG9zO1xuICBpZiAoIXN0YXJ0c1dpdGhEb3QgJiYgdGhpcy5yZWFkSW50KDEwLCB1bmRlZmluZWQsIHRydWUpID09PSBudWxsKSB7IHRoaXMucmFpc2Uoc3RhcnQsIFwiSW52YWxpZCBudW1iZXJcIik7IH1cbiAgdmFyIG9jdGFsID0gdGhpcy5wb3MgLSBzdGFydCA+PSAyICYmIHRoaXMuaW5wdXQuY2hhckNvZGVBdChzdGFydCkgPT09IDQ4O1xuICBpZiAob2N0YWwgJiYgdGhpcy5zdHJpY3QpIHsgdGhpcy5yYWlzZShzdGFydCwgXCJJbnZhbGlkIG51bWJlclwiKTsgfVxuICB2YXIgbmV4dCA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyk7XG4gIGlmICghb2N0YWwgJiYgIXN0YXJ0c1dpdGhEb3QgJiYgdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDExICYmIG5leHQgPT09IDExMCkge1xuICAgIHZhciB2YWwkMSA9IHN0cmluZ1RvQmlnSW50KHRoaXMuaW5wdXQuc2xpY2Uoc3RhcnQsIHRoaXMucG9zKSk7XG4gICAgKyt0aGlzLnBvcztcbiAgICBpZiAoaXNJZGVudGlmaWVyU3RhcnQodGhpcy5mdWxsQ2hhckNvZGVBdFBvcygpKSkgeyB0aGlzLnJhaXNlKHRoaXMucG9zLCBcIklkZW50aWZpZXIgZGlyZWN0bHkgYWZ0ZXIgbnVtYmVyXCIpOyB9XG4gICAgcmV0dXJuIHRoaXMuZmluaXNoVG9rZW4odHlwZXMubnVtLCB2YWwkMSlcbiAgfVxuICBpZiAob2N0YWwgJiYgL1s4OV0vLnRlc3QodGhpcy5pbnB1dC5zbGljZShzdGFydCwgdGhpcy5wb3MpKSkgeyBvY3RhbCA9IGZhbHNlOyB9XG4gIGlmIChuZXh0ID09PSA0NiAmJiAhb2N0YWwpIHsgLy8gJy4nXG4gICAgKyt0aGlzLnBvcztcbiAgICB0aGlzLnJlYWRJbnQoMTApO1xuICAgIG5leHQgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpO1xuICB9XG4gIGlmICgobmV4dCA9PT0gNjkgfHwgbmV4dCA9PT0gMTAxKSAmJiAhb2N0YWwpIHsgLy8gJ2VFJ1xuICAgIG5leHQgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQoKyt0aGlzLnBvcyk7XG4gICAgaWYgKG5leHQgPT09IDQzIHx8IG5leHQgPT09IDQ1KSB7ICsrdGhpcy5wb3M7IH0gLy8gJystJ1xuICAgIGlmICh0aGlzLnJlYWRJbnQoMTApID09PSBudWxsKSB7IHRoaXMucmFpc2Uoc3RhcnQsIFwiSW52YWxpZCBudW1iZXJcIik7IH1cbiAgfVxuICBpZiAoaXNJZGVudGlmaWVyU3RhcnQodGhpcy5mdWxsQ2hhckNvZGVBdFBvcygpKSkgeyB0aGlzLnJhaXNlKHRoaXMucG9zLCBcIklkZW50aWZpZXIgZGlyZWN0bHkgYWZ0ZXIgbnVtYmVyXCIpOyB9XG5cbiAgdmFyIHZhbCA9IHN0cmluZ1RvTnVtYmVyKHRoaXMuaW5wdXQuc2xpY2Uoc3RhcnQsIHRoaXMucG9zKSwgb2N0YWwpO1xuICByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5udW0sIHZhbClcbn07XG5cbi8vIFJlYWQgYSBzdHJpbmcgdmFsdWUsIGludGVycHJldGluZyBiYWNrc2xhc2gtZXNjYXBlcy5cblxucHAkOS5yZWFkQ29kZVBvaW50ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBjaCA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyksIGNvZGU7XG5cbiAgaWYgKGNoID09PSAxMjMpIHsgLy8gJ3snXG4gICAgaWYgKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbiA8IDYpIHsgdGhpcy51bmV4cGVjdGVkKCk7IH1cbiAgICB2YXIgY29kZVBvcyA9ICsrdGhpcy5wb3M7XG4gICAgY29kZSA9IHRoaXMucmVhZEhleENoYXIodGhpcy5pbnB1dC5pbmRleE9mKFwifVwiLCB0aGlzLnBvcykgLSB0aGlzLnBvcyk7XG4gICAgKyt0aGlzLnBvcztcbiAgICBpZiAoY29kZSA+IDB4MTBGRkZGKSB7IHRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKGNvZGVQb3MsIFwiQ29kZSBwb2ludCBvdXQgb2YgYm91bmRzXCIpOyB9XG4gIH0gZWxzZSB7XG4gICAgY29kZSA9IHRoaXMucmVhZEhleENoYXIoNCk7XG4gIH1cbiAgcmV0dXJuIGNvZGVcbn07XG5cbmZ1bmN0aW9uIGNvZGVQb2ludFRvU3RyaW5nJDEoY29kZSkge1xuICAvLyBVVEYtMTYgRGVjb2RpbmdcbiAgaWYgKGNvZGUgPD0gMHhGRkZGKSB7IHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpIH1cbiAgY29kZSAtPSAweDEwMDAwO1xuICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSgoY29kZSA+PiAxMCkgKyAweEQ4MDAsIChjb2RlICYgMTAyMykgKyAweERDMDApXG59XG5cbnBwJDkucmVhZFN0cmluZyA9IGZ1bmN0aW9uKHF1b3RlKSB7XG4gIHZhciBvdXQgPSBcIlwiLCBjaHVua1N0YXJ0ID0gKyt0aGlzLnBvcztcbiAgZm9yICg7Oykge1xuICAgIGlmICh0aGlzLnBvcyA+PSB0aGlzLmlucHV0Lmxlbmd0aCkgeyB0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIFwiVW50ZXJtaW5hdGVkIHN0cmluZyBjb25zdGFudFwiKTsgfVxuICAgIHZhciBjaCA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyk7XG4gICAgaWYgKGNoID09PSBxdW90ZSkgeyBicmVhayB9XG4gICAgaWYgKGNoID09PSA5MikgeyAvLyAnXFwnXG4gICAgICBvdXQgKz0gdGhpcy5pbnB1dC5zbGljZShjaHVua1N0YXJ0LCB0aGlzLnBvcyk7XG4gICAgICBvdXQgKz0gdGhpcy5yZWFkRXNjYXBlZENoYXIoZmFsc2UpO1xuICAgICAgY2h1bmtTdGFydCA9IHRoaXMucG9zO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoaXNOZXdMaW5lKGNoLCB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24gPj0gMTApKSB7IHRoaXMucmFpc2UodGhpcy5zdGFydCwgXCJVbnRlcm1pbmF0ZWQgc3RyaW5nIGNvbnN0YW50XCIpOyB9XG4gICAgICArK3RoaXMucG9zO1xuICAgIH1cbiAgfVxuICBvdXQgKz0gdGhpcy5pbnB1dC5zbGljZShjaHVua1N0YXJ0LCB0aGlzLnBvcysrKTtcbiAgcmV0dXJuIHRoaXMuZmluaXNoVG9rZW4odHlwZXMuc3RyaW5nLCBvdXQpXG59O1xuXG4vLyBSZWFkcyB0ZW1wbGF0ZSBzdHJpbmcgdG9rZW5zLlxuXG52YXIgSU5WQUxJRF9URU1QTEFURV9FU0NBUEVfRVJST1IgPSB7fTtcblxucHAkOS50cnlSZWFkVGVtcGxhdGVUb2tlbiA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmluVGVtcGxhdGVFbGVtZW50ID0gdHJ1ZTtcbiAgdHJ5IHtcbiAgICB0aGlzLnJlYWRUbXBsVG9rZW4oKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKGVyciA9PT0gSU5WQUxJRF9URU1QTEFURV9FU0NBUEVfRVJST1IpIHtcbiAgICAgIHRoaXMucmVhZEludmFsaWRUZW1wbGF0ZVRva2VuKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IGVyclxuICAgIH1cbiAgfVxuXG4gIHRoaXMuaW5UZW1wbGF0ZUVsZW1lbnQgPSBmYWxzZTtcbn07XG5cbnBwJDkuaW52YWxpZFN0cmluZ1Rva2VuID0gZnVuY3Rpb24ocG9zaXRpb24sIG1lc3NhZ2UpIHtcbiAgaWYgKHRoaXMuaW5UZW1wbGF0ZUVsZW1lbnQgJiYgdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDkpIHtcbiAgICB0aHJvdyBJTlZBTElEX1RFTVBMQVRFX0VTQ0FQRV9FUlJPUlxuICB9IGVsc2Uge1xuICAgIHRoaXMucmFpc2UocG9zaXRpb24sIG1lc3NhZ2UpO1xuICB9XG59O1xuXG5wcCQ5LnJlYWRUbXBsVG9rZW4gPSBmdW5jdGlvbigpIHtcbiAgdmFyIG91dCA9IFwiXCIsIGNodW5rU3RhcnQgPSB0aGlzLnBvcztcbiAgZm9yICg7Oykge1xuICAgIGlmICh0aGlzLnBvcyA+PSB0aGlzLmlucHV0Lmxlbmd0aCkgeyB0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIFwiVW50ZXJtaW5hdGVkIHRlbXBsYXRlXCIpOyB9XG4gICAgdmFyIGNoID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKTtcbiAgICBpZiAoY2ggPT09IDk2IHx8IGNoID09PSAzNiAmJiB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MgKyAxKSA9PT0gMTIzKSB7IC8vICdgJywgJyR7J1xuICAgICAgaWYgKHRoaXMucG9zID09PSB0aGlzLnN0YXJ0ICYmICh0aGlzLnR5cGUgPT09IHR5cGVzLnRlbXBsYXRlIHx8IHRoaXMudHlwZSA9PT0gdHlwZXMuaW52YWxpZFRlbXBsYXRlKSkge1xuICAgICAgICBpZiAoY2ggPT09IDM2KSB7XG4gICAgICAgICAgdGhpcy5wb3MgKz0gMjtcbiAgICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5kb2xsYXJCcmFjZUwpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgKyt0aGlzLnBvcztcbiAgICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlcy5iYWNrUXVvdGUpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIG91dCArPSB0aGlzLmlucHV0LnNsaWNlKGNodW5rU3RhcnQsIHRoaXMucG9zKTtcbiAgICAgIHJldHVybiB0aGlzLmZpbmlzaFRva2VuKHR5cGVzLnRlbXBsYXRlLCBvdXQpXG4gICAgfVxuICAgIGlmIChjaCA9PT0gOTIpIHsgLy8gJ1xcJ1xuICAgICAgb3V0ICs9IHRoaXMuaW5wdXQuc2xpY2UoY2h1bmtTdGFydCwgdGhpcy5wb3MpO1xuICAgICAgb3V0ICs9IHRoaXMucmVhZEVzY2FwZWRDaGFyKHRydWUpO1xuICAgICAgY2h1bmtTdGFydCA9IHRoaXMucG9zO1xuICAgIH0gZWxzZSBpZiAoaXNOZXdMaW5lKGNoKSkge1xuICAgICAgb3V0ICs9IHRoaXMuaW5wdXQuc2xpY2UoY2h1bmtTdGFydCwgdGhpcy5wb3MpO1xuICAgICAgKyt0aGlzLnBvcztcbiAgICAgIHN3aXRjaCAoY2gpIHtcbiAgICAgIGNhc2UgMTM6XG4gICAgICAgIGlmICh0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpID09PSAxMCkgeyArK3RoaXMucG9zOyB9XG4gICAgICBjYXNlIDEwOlxuICAgICAgICBvdXQgKz0gXCJcXG5cIjtcbiAgICAgICAgYnJlYWtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTtcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9jYXRpb25zKSB7XG4gICAgICAgICsrdGhpcy5jdXJMaW5lO1xuICAgICAgICB0aGlzLmxpbmVTdGFydCA9IHRoaXMucG9zO1xuICAgICAgfVxuICAgICAgY2h1bmtTdGFydCA9IHRoaXMucG9zO1xuICAgIH0gZWxzZSB7XG4gICAgICArK3RoaXMucG9zO1xuICAgIH1cbiAgfVxufTtcblxuLy8gUmVhZHMgYSB0ZW1wbGF0ZSB0b2tlbiB0byBzZWFyY2ggZm9yIHRoZSBlbmQsIHdpdGhvdXQgdmFsaWRhdGluZyBhbnkgZXNjYXBlIHNlcXVlbmNlc1xucHAkOS5yZWFkSW52YWxpZFRlbXBsYXRlVG9rZW4gPSBmdW5jdGlvbigpIHtcbiAgZm9yICg7IHRoaXMucG9zIDwgdGhpcy5pbnB1dC5sZW5ndGg7IHRoaXMucG9zKyspIHtcbiAgICBzd2l0Y2ggKHRoaXMuaW5wdXRbdGhpcy5wb3NdKSB7XG4gICAgY2FzZSBcIlxcXFxcIjpcbiAgICAgICsrdGhpcy5wb3M7XG4gICAgICBicmVha1xuXG4gICAgY2FzZSBcIiRcIjpcbiAgICAgIGlmICh0aGlzLmlucHV0W3RoaXMucG9zICsgMV0gIT09IFwie1wiKSB7XG4gICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgLy8gZmFsbHMgdGhyb3VnaFxuXG4gICAgY2FzZSBcImBcIjpcbiAgICAgIHJldHVybiB0aGlzLmZpbmlzaFRva2VuKHR5cGVzLmludmFsaWRUZW1wbGF0ZSwgdGhpcy5pbnB1dC5zbGljZSh0aGlzLnN0YXJ0LCB0aGlzLnBvcykpXG5cbiAgICAvLyBubyBkZWZhdWx0XG4gICAgfVxuICB9XG4gIHRoaXMucmFpc2UodGhpcy5zdGFydCwgXCJVbnRlcm1pbmF0ZWQgdGVtcGxhdGVcIik7XG59O1xuXG4vLyBVc2VkIHRvIHJlYWQgZXNjYXBlZCBjaGFyYWN0ZXJzXG5cbnBwJDkucmVhZEVzY2FwZWRDaGFyID0gZnVuY3Rpb24oaW5UZW1wbGF0ZSkge1xuICB2YXIgY2ggPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQoKyt0aGlzLnBvcyk7XG4gICsrdGhpcy5wb3M7XG4gIHN3aXRjaCAoY2gpIHtcbiAgY2FzZSAxMTA6IHJldHVybiBcIlxcblwiIC8vICduJyAtPiAnXFxuJ1xuICBjYXNlIDExNDogcmV0dXJuIFwiXFxyXCIgLy8gJ3InIC0+ICdcXHInXG4gIGNhc2UgMTIwOiByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh0aGlzLnJlYWRIZXhDaGFyKDIpKSAvLyAneCdcbiAgY2FzZSAxMTc6IHJldHVybiBjb2RlUG9pbnRUb1N0cmluZyQxKHRoaXMucmVhZENvZGVQb2ludCgpKSAvLyAndSdcbiAgY2FzZSAxMTY6IHJldHVybiBcIlxcdFwiIC8vICd0JyAtPiAnXFx0J1xuICBjYXNlIDk4OiByZXR1cm4gXCJcXGJcIiAvLyAnYicgLT4gJ1xcYidcbiAgY2FzZSAxMTg6IHJldHVybiBcIlxcdTAwMGJcIiAvLyAndicgLT4gJ1xcdTAwMGInXG4gIGNhc2UgMTAyOiByZXR1cm4gXCJcXGZcIiAvLyAnZicgLT4gJ1xcZidcbiAgY2FzZSAxMzogaWYgKHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcykgPT09IDEwKSB7ICsrdGhpcy5wb3M7IH0gLy8gJ1xcclxcbidcbiAgY2FzZSAxMDogLy8gJyBcXG4nXG4gICAgaWYgKHRoaXMub3B0aW9ucy5sb2NhdGlvbnMpIHsgdGhpcy5saW5lU3RhcnQgPSB0aGlzLnBvczsgKyt0aGlzLmN1ckxpbmU7IH1cbiAgICByZXR1cm4gXCJcIlxuICBjYXNlIDU2OlxuICBjYXNlIDU3OlxuICAgIGlmICh0aGlzLnN0cmljdCkge1xuICAgICAgdGhpcy5pbnZhbGlkU3RyaW5nVG9rZW4oXG4gICAgICAgIHRoaXMucG9zIC0gMSxcbiAgICAgICAgXCJJbnZhbGlkIGVzY2FwZSBzZXF1ZW5jZVwiXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoaW5UZW1wbGF0ZSkge1xuICAgICAgdmFyIGNvZGVQb3MgPSB0aGlzLnBvcyAtIDE7XG5cbiAgICAgIHRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKFxuICAgICAgICBjb2RlUG9zLFxuICAgICAgICBcIkludmFsaWQgZXNjYXBlIHNlcXVlbmNlIGluIHRlbXBsYXRlIHN0cmluZ1wiXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgZGVmYXVsdDpcbiAgICBpZiAoY2ggPj0gNDggJiYgY2ggPD0gNTUpIHtcbiAgICAgIHZhciBvY3RhbFN0ciA9IHRoaXMuaW5wdXQuc3Vic3RyKHRoaXMucG9zIC0gMSwgMykubWF0Y2goL15bMC03XSsvKVswXTtcbiAgICAgIHZhciBvY3RhbCA9IHBhcnNlSW50KG9jdGFsU3RyLCA4KTtcbiAgICAgIGlmIChvY3RhbCA+IDI1NSkge1xuICAgICAgICBvY3RhbFN0ciA9IG9jdGFsU3RyLnNsaWNlKDAsIC0xKTtcbiAgICAgICAgb2N0YWwgPSBwYXJzZUludChvY3RhbFN0ciwgOCk7XG4gICAgICB9XG4gICAgICB0aGlzLnBvcyArPSBvY3RhbFN0ci5sZW5ndGggLSAxO1xuICAgICAgY2ggPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpO1xuICAgICAgaWYgKChvY3RhbFN0ciAhPT0gXCIwXCIgfHwgY2ggPT09IDU2IHx8IGNoID09PSA1NykgJiYgKHRoaXMuc3RyaWN0IHx8IGluVGVtcGxhdGUpKSB7XG4gICAgICAgIHRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKFxuICAgICAgICAgIHRoaXMucG9zIC0gMSAtIG9jdGFsU3RyLmxlbmd0aCxcbiAgICAgICAgICBpblRlbXBsYXRlXG4gICAgICAgICAgICA/IFwiT2N0YWwgbGl0ZXJhbCBpbiB0ZW1wbGF0ZSBzdHJpbmdcIlxuICAgICAgICAgICAgOiBcIk9jdGFsIGxpdGVyYWwgaW4gc3RyaWN0IG1vZGVcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUob2N0YWwpXG4gICAgfVxuICAgIGlmIChpc05ld0xpbmUoY2gpKSB7XG4gICAgICAvLyBVbmljb2RlIG5ldyBsaW5lIGNoYXJhY3RlcnMgYWZ0ZXIgXFwgZ2V0IHJlbW92ZWQgZnJvbSBvdXRwdXQgaW4gYm90aFxuICAgICAgLy8gdGVtcGxhdGUgbGl0ZXJhbHMgYW5kIHN0cmluZ3NcbiAgICAgIHJldHVybiBcIlwiXG4gICAgfVxuICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKVxuICB9XG59O1xuXG4vLyBVc2VkIHRvIHJlYWQgY2hhcmFjdGVyIGVzY2FwZSBzZXF1ZW5jZXMgKCdcXHgnLCAnXFx1JywgJ1xcVScpLlxuXG5wcCQ5LnJlYWRIZXhDaGFyID0gZnVuY3Rpb24obGVuKSB7XG4gIHZhciBjb2RlUG9zID0gdGhpcy5wb3M7XG4gIHZhciBuID0gdGhpcy5yZWFkSW50KDE2LCBsZW4pO1xuICBpZiAobiA9PT0gbnVsbCkgeyB0aGlzLmludmFsaWRTdHJpbmdUb2tlbihjb2RlUG9zLCBcIkJhZCBjaGFyYWN0ZXIgZXNjYXBlIHNlcXVlbmNlXCIpOyB9XG4gIHJldHVybiBuXG59O1xuXG4vLyBSZWFkIGFuIGlkZW50aWZpZXIsIGFuZCByZXR1cm4gaXQgYXMgYSBzdHJpbmcuIFNldHMgYHRoaXMuY29udGFpbnNFc2NgXG4vLyB0byB3aGV0aGVyIHRoZSB3b3JkIGNvbnRhaW5lZCBhICdcXHUnIGVzY2FwZS5cbi8vXG4vLyBJbmNyZW1lbnRhbGx5IGFkZHMgb25seSBlc2NhcGVkIGNoYXJzLCBhZGRpbmcgb3RoZXIgY2h1bmtzIGFzLWlzXG4vLyBhcyBhIG1pY3JvLW9wdGltaXphdGlvbi5cblxucHAkOS5yZWFkV29yZDEgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jb250YWluc0VzYyA9IGZhbHNlO1xuICB2YXIgd29yZCA9IFwiXCIsIGZpcnN0ID0gdHJ1ZSwgY2h1bmtTdGFydCA9IHRoaXMucG9zO1xuICB2YXIgYXN0cmFsID0gdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uID49IDY7XG4gIHdoaWxlICh0aGlzLnBvcyA8IHRoaXMuaW5wdXQubGVuZ3RoKSB7XG4gICAgdmFyIGNoID0gdGhpcy5mdWxsQ2hhckNvZGVBdFBvcygpO1xuICAgIGlmIChpc0lkZW50aWZpZXJDaGFyKGNoLCBhc3RyYWwpKSB7XG4gICAgICB0aGlzLnBvcyArPSBjaCA8PSAweGZmZmYgPyAxIDogMjtcbiAgICB9IGVsc2UgaWYgKGNoID09PSA5MikgeyAvLyBcIlxcXCJcbiAgICAgIHRoaXMuY29udGFpbnNFc2MgPSB0cnVlO1xuICAgICAgd29yZCArPSB0aGlzLmlucHV0LnNsaWNlKGNodW5rU3RhcnQsIHRoaXMucG9zKTtcbiAgICAgIHZhciBlc2NTdGFydCA9IHRoaXMucG9zO1xuICAgICAgaWYgKHRoaXMuaW5wdXQuY2hhckNvZGVBdCgrK3RoaXMucG9zKSAhPT0gMTE3KSAvLyBcInVcIlxuICAgICAgICB7IHRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKHRoaXMucG9zLCBcIkV4cGVjdGluZyBVbmljb2RlIGVzY2FwZSBzZXF1ZW5jZSBcXFxcdVhYWFhcIik7IH1cbiAgICAgICsrdGhpcy5wb3M7XG4gICAgICB2YXIgZXNjID0gdGhpcy5yZWFkQ29kZVBvaW50KCk7XG4gICAgICBpZiAoIShmaXJzdCA/IGlzSWRlbnRpZmllclN0YXJ0IDogaXNJZGVudGlmaWVyQ2hhcikoZXNjLCBhc3RyYWwpKVxuICAgICAgICB7IHRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKGVzY1N0YXJ0LCBcIkludmFsaWQgVW5pY29kZSBlc2NhcGVcIik7IH1cbiAgICAgIHdvcmQgKz0gY29kZVBvaW50VG9TdHJpbmckMShlc2MpO1xuICAgICAgY2h1bmtTdGFydCA9IHRoaXMucG9zO1xuICAgIH0gZWxzZSB7XG4gICAgICBicmVha1xuICAgIH1cbiAgICBmaXJzdCA9IGZhbHNlO1xuICB9XG4gIHJldHVybiB3b3JkICsgdGhpcy5pbnB1dC5zbGljZShjaHVua1N0YXJ0LCB0aGlzLnBvcylcbn07XG5cbi8vIFJlYWQgYW4gaWRlbnRpZmllciBvciBrZXl3b3JkIHRva2VuLiBXaWxsIGNoZWNrIGZvciByZXNlcnZlZFxuLy8gd29yZHMgd2hlbiBuZWNlc3NhcnkuXG5cbnBwJDkucmVhZFdvcmQgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHdvcmQgPSB0aGlzLnJlYWRXb3JkMSgpO1xuICB2YXIgdHlwZSA9IHR5cGVzLm5hbWU7XG4gIGlmICh0aGlzLmtleXdvcmRzLnRlc3Qod29yZCkpIHtcbiAgICB0eXBlID0ga2V5d29yZHMkMVt3b3JkXTtcbiAgfVxuICByZXR1cm4gdGhpcy5maW5pc2hUb2tlbih0eXBlLCB3b3JkKVxufTtcblxuLy8gQWNvcm4gaXMgYSB0aW55LCBmYXN0IEphdmFTY3JpcHQgcGFyc2VyIHdyaXR0ZW4gaW4gSmF2YVNjcmlwdC5cblxudmFyIHZlcnNpb24gPSBcIjguNC4xXCI7XG5cblBhcnNlci5hY29ybiA9IHtcbiAgUGFyc2VyOiBQYXJzZXIsXG4gIHZlcnNpb246IHZlcnNpb24sXG4gIGRlZmF1bHRPcHRpb25zOiBkZWZhdWx0T3B0aW9ucyxcbiAgUG9zaXRpb246IFBvc2l0aW9uLFxuICBTb3VyY2VMb2NhdGlvbjogU291cmNlTG9jYXRpb24sXG4gIGdldExpbmVJbmZvOiBnZXRMaW5lSW5mbyxcbiAgTm9kZTogTm9kZSxcbiAgVG9rZW5UeXBlOiBUb2tlblR5cGUsXG4gIHRva1R5cGVzOiB0eXBlcyxcbiAga2V5d29yZFR5cGVzOiBrZXl3b3JkcyQxLFxuICBUb2tDb250ZXh0OiBUb2tDb250ZXh0LFxuICB0b2tDb250ZXh0czogdHlwZXMkMSxcbiAgaXNJZGVudGlmaWVyQ2hhcjogaXNJZGVudGlmaWVyQ2hhcixcbiAgaXNJZGVudGlmaWVyU3RhcnQ6IGlzSWRlbnRpZmllclN0YXJ0LFxuICBUb2tlbjogVG9rZW4sXG4gIGlzTmV3TGluZTogaXNOZXdMaW5lLFxuICBsaW5lQnJlYWs6IGxpbmVCcmVhayxcbiAgbGluZUJyZWFrRzogbGluZUJyZWFrRyxcbiAgbm9uQVNDSUl3aGl0ZXNwYWNlOiBub25BU0NJSXdoaXRlc3BhY2Vcbn07XG5cbi8vIFRoZSBtYWluIGV4cG9ydGVkIGludGVyZmFjZSAodW5kZXIgYHNlbGYuYWNvcm5gIHdoZW4gaW4gdGhlXG4vLyBicm93c2VyKSBpcyBhIGBwYXJzZWAgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIGNvZGUgc3RyaW5nIGFuZFxuLy8gcmV0dXJucyBhbiBhYnN0cmFjdCBzeW50YXggdHJlZSBhcyBzcGVjaWZpZWQgYnkgW01vemlsbGEgcGFyc2VyXG4vLyBBUEldW2FwaV0uXG4vL1xuLy8gW2FwaV06IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvU3BpZGVyTW9ua2V5L1BhcnNlcl9BUElcblxuZnVuY3Rpb24gcGFyc2UoaW5wdXQsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIFBhcnNlci5wYXJzZShpbnB1dCwgb3B0aW9ucylcbn1cblxuLy8gVGhpcyBmdW5jdGlvbiB0cmllcyB0byBwYXJzZSBhIHNpbmdsZSBleHByZXNzaW9uIGF0IGEgZ2l2ZW5cbi8vIG9mZnNldCBpbiBhIHN0cmluZy4gVXNlZnVsIGZvciBwYXJzaW5nIG1peGVkLWxhbmd1YWdlIGZvcm1hdHNcbi8vIHRoYXQgZW1iZWQgSmF2YVNjcmlwdCBleHByZXNzaW9ucy5cblxuZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uQXQoaW5wdXQsIHBvcywgb3B0aW9ucykge1xuICByZXR1cm4gUGFyc2VyLnBhcnNlRXhwcmVzc2lvbkF0KGlucHV0LCBwb3MsIG9wdGlvbnMpXG59XG5cbmZ1bmN0aW9uIGZsYXR0ZW4obm9kZXMsIHRhcmdldCA9IFtdKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBjb25zdCBub2RlID0gbm9kZXNbaV07XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KG5vZGUpKSB7XG4gICAgICAgICAgICBmbGF0dGVuKG5vZGUsIHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXQucHVzaChub2RlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGFyZ2V0O1xufVxuXG5jb25zdCBwYXR0ZXJuID0gL15cXHMqc3ZlbHRlLWlnbm9yZVxccysoW1xcc1xcU10rKVxccyokL207XG5mdW5jdGlvbiBleHRyYWN0X3N2ZWx0ZV9pZ25vcmUodGV4dCkge1xuICAgIGNvbnN0IG1hdGNoID0gcGF0dGVybi5leGVjKHRleHQpO1xuICAgIHJldHVybiBtYXRjaCA/IG1hdGNoWzFdLnNwbGl0KC9bXlxcU10vKS5tYXAoeCA9PiB4LnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pIDogW107XG59XG5mdW5jdGlvbiBleHRyYWN0X3N2ZWx0ZV9pZ25vcmVfZnJvbV9jb21tZW50cyhub2RlKSB7XG4gICAgcmV0dXJuIGZsYXR0ZW4oKG5vZGUubGVhZGluZ0NvbW1lbnRzIHx8IFtdKS5tYXAoY29tbWVudCA9PiBleHRyYWN0X3N2ZWx0ZV9pZ25vcmUoY29tbWVudC52YWx1ZSkpKTtcbn1cbmZ1bmN0aW9uIGV4dHJhY3RfaWdub3Jlc19hYm92ZV9wb3NpdGlvbihwb3NpdGlvbiwgdGVtcGxhdGVfbm9kZXMpIHtcbiAgICBjb25zdCBwcmV2aW91c19ub2RlX2lkeCA9IHRlbXBsYXRlX25vZGVzLmZpbmRJbmRleChjaGlsZCA9PiBjaGlsZC5lbmQgPT09IHBvc2l0aW9uKTtcbiAgICBpZiAocHJldmlvdXNfbm9kZV9pZHggPT09IC0xKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IHByZXZpb3VzX25vZGVfaWR4OyBpID49IDA7IGktLSkge1xuICAgICAgICBjb25zdCBub2RlID0gdGVtcGxhdGVfbm9kZXNbaV07XG4gICAgICAgIGlmIChub2RlLnR5cGUgIT09ICdDb21tZW50JyAmJiBub2RlLnR5cGUgIT09ICdUZXh0Jykge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdDb21tZW50Jykge1xuICAgICAgICAgICAgaWYgKG5vZGUuaWdub3Jlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5pZ25vcmVzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBbXTtcbn1cblxuZnVuY3Rpb24gZnV6enltYXRjaChuYW1lLCBuYW1lcykge1xuICAgIGNvbnN0IHNldCA9IG5ldyBGdXp6eVNldChuYW1lcyk7XG4gICAgY29uc3QgbWF0Y2hlcyA9IHNldC5nZXQobmFtZSk7XG4gICAgcmV0dXJuIG1hdGNoZXMgJiYgbWF0Y2hlc1swXSAmJiBtYXRjaGVzWzBdWzBdID4gMC43ID8gbWF0Y2hlc1swXVsxXSA6IG51bGw7XG59XG4vLyBhZGFwdGVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL0dsZW5jaC9mdXp6eXNldC5qcy9ibG9iL21hc3Rlci9saWIvZnV6enlzZXQuanNcbi8vIEJTRCBMaWNlbnNlZFxuY29uc3QgR1JBTV9TSVpFX0xPV0VSID0gMjtcbmNvbnN0IEdSQU1fU0laRV9VUFBFUiA9IDM7XG4vLyByZXR1cm4gYW4gZWRpdCBkaXN0YW5jZSBmcm9tIDAgdG8gMVxuZnVuY3Rpb24gX2Rpc3RhbmNlKHN0cjEsIHN0cjIpIHtcbiAgICBpZiAoc3RyMSA9PT0gbnVsbCAmJiBzdHIyID09PSBudWxsKSB7XG4gICAgICAgIHRocm93ICdUcnlpbmcgdG8gY29tcGFyZSB0d28gbnVsbCB2YWx1ZXMnO1xuICAgIH1cbiAgICBpZiAoc3RyMSA9PT0gbnVsbCB8fCBzdHIyID09PSBudWxsKVxuICAgICAgICByZXR1cm4gMDtcbiAgICBzdHIxID0gU3RyaW5nKHN0cjEpO1xuICAgIHN0cjIgPSBTdHJpbmcoc3RyMik7XG4gICAgY29uc3QgZGlzdGFuY2UgPSBsZXZlbnNodGVpbihzdHIxLCBzdHIyKTtcbiAgICBpZiAoc3RyMS5sZW5ndGggPiBzdHIyLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gMSAtIGRpc3RhbmNlIC8gc3RyMS5sZW5ndGg7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gMSAtIGRpc3RhbmNlIC8gc3RyMi5sZW5ndGg7XG4gICAgfVxufVxuLy8gaGVscGVyIGZ1bmN0aW9uc1xuZnVuY3Rpb24gbGV2ZW5zaHRlaW4oc3RyMSwgc3RyMikge1xuICAgIGNvbnN0IGN1cnJlbnQgPSBbXTtcbiAgICBsZXQgcHJldjtcbiAgICBsZXQgdmFsdWU7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gc3RyMi5sZW5ndGg7IGkrKykge1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSBzdHIxLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBpZiAoaSAmJiBqKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0cjEuY2hhckF0KGogLSAxKSA9PT0gc3RyMi5jaGFyQXQoaSAtIDEpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcHJldjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gTWF0aC5taW4oY3VycmVudFtqXSwgY3VycmVudFtqIC0gMV0sIHByZXYpICsgMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IGkgKyBqO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcHJldiA9IGN1cnJlbnRbal07XG4gICAgICAgICAgICBjdXJyZW50W2pdID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGN1cnJlbnQucG9wKCk7XG59XG5jb25zdCBub25fd29yZF9yZWdleCA9IC9bXlxcdywgXSsvO1xuZnVuY3Rpb24gaXRlcmF0ZV9ncmFtcyh2YWx1ZSwgZ3JhbV9zaXplID0gMikge1xuICAgIGNvbnN0IHNpbXBsaWZpZWQgPSAnLScgKyB2YWx1ZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2Uobm9uX3dvcmRfcmVnZXgsICcnKSArICctJztcbiAgICBjb25zdCBsZW5fZGlmZiA9IGdyYW1fc2l6ZSAtIHNpbXBsaWZpZWQubGVuZ3RoO1xuICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgICBpZiAobGVuX2RpZmYgPiAwKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuX2RpZmY7ICsraSkge1xuICAgICAgICAgICAgdmFsdWUgKz0gJy0nO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2ltcGxpZmllZC5sZW5ndGggLSBncmFtX3NpemUgKyAxOyArK2kpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHNpbXBsaWZpZWQuc2xpY2UoaSwgaSArIGdyYW1fc2l6ZSkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cztcbn1cbmZ1bmN0aW9uIGdyYW1fY291bnRlcih2YWx1ZSwgZ3JhbV9zaXplID0gMikge1xuICAgIC8vIHJldHVybiBhbiBvYmplY3Qgd2hlcmUga2V5PWdyYW0sIHZhbHVlPW51bWJlciBvZiBvY2N1cnJlbmNlc1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgIGNvbnN0IGdyYW1zID0gaXRlcmF0ZV9ncmFtcyh2YWx1ZSwgZ3JhbV9zaXplKTtcbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChpOyBpIDwgZ3JhbXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgaWYgKGdyYW1zW2ldIGluIHJlc3VsdCkge1xuICAgICAgICAgICAgcmVzdWx0W2dyYW1zW2ldXSArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0W2dyYW1zW2ldXSA9IDE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIHNvcnRfZGVzY2VuZGluZyhhLCBiKSB7XG4gICAgcmV0dXJuIGJbMF0gLSBhWzBdO1xufVxuY2xhc3MgRnV6enlTZXQge1xuICAgIGNvbnN0cnVjdG9yKGFycikge1xuICAgICAgICB0aGlzLmV4YWN0X3NldCA9IHt9O1xuICAgICAgICB0aGlzLm1hdGNoX2RpY3QgPSB7fTtcbiAgICAgICAgdGhpcy5pdGVtcyA9IHt9O1xuICAgICAgICAvLyBpbml0aWFsaXphdGlvblxuICAgICAgICBmb3IgKGxldCBpID0gR1JBTV9TSVpFX0xPV0VSOyBpIDwgR1JBTV9TSVpFX1VQUEVSICsgMTsgKytpKSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1zW2ldID0gW107XG4gICAgICAgIH1cbiAgICAgICAgLy8gYWRkIGFsbCB0aGUgaXRlbXMgdG8gdGhlIHNldFxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5hZGQoYXJyW2ldKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhZGQodmFsdWUpIHtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZF92YWx1ZSA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmIChub3JtYWxpemVkX3ZhbHVlIGluIHRoaXMuZXhhY3Rfc2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGkgPSBHUkFNX1NJWkVfTE9XRVI7XG4gICAgICAgIGZvciAoaTsgaSA8IEdSQU1fU0laRV9VUFBFUiArIDE7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5fYWRkKHZhbHVlLCBpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfYWRkKHZhbHVlLCBncmFtX3NpemUpIHtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZF92YWx1ZSA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5pdGVtc1tncmFtX3NpemVdIHx8IFtdO1xuICAgICAgICBjb25zdCBpbmRleCA9IGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgaXRlbXMucHVzaCgwKTtcbiAgICAgICAgY29uc3QgZ3JhbV9jb3VudHMgPSBncmFtX2NvdW50ZXIobm9ybWFsaXplZF92YWx1ZSwgZ3JhbV9zaXplKTtcbiAgICAgICAgbGV0IHN1bV9vZl9zcXVhcmVfZ3JhbV9jb3VudHMgPSAwO1xuICAgICAgICBsZXQgZ3JhbTtcbiAgICAgICAgbGV0IGdyYW1fY291bnQ7XG4gICAgICAgIGZvciAoZ3JhbSBpbiBncmFtX2NvdW50cykge1xuICAgICAgICAgICAgZ3JhbV9jb3VudCA9IGdyYW1fY291bnRzW2dyYW1dO1xuICAgICAgICAgICAgc3VtX29mX3NxdWFyZV9ncmFtX2NvdW50cyArPSBNYXRoLnBvdyhncmFtX2NvdW50LCAyKTtcbiAgICAgICAgICAgIGlmIChncmFtIGluIHRoaXMubWF0Y2hfZGljdCkge1xuICAgICAgICAgICAgICAgIHRoaXMubWF0Y2hfZGljdFtncmFtXS5wdXNoKFtpbmRleCwgZ3JhbV9jb3VudF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXRjaF9kaWN0W2dyYW1dID0gW1tpbmRleCwgZ3JhbV9jb3VudF1dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZlY3Rvcl9ub3JtYWwgPSBNYXRoLnNxcnQoc3VtX29mX3NxdWFyZV9ncmFtX2NvdW50cyk7XG4gICAgICAgIGl0ZW1zW2luZGV4XSA9IFt2ZWN0b3Jfbm9ybWFsLCBub3JtYWxpemVkX3ZhbHVlXTtcbiAgICAgICAgdGhpcy5pdGVtc1tncmFtX3NpemVdID0gaXRlbXM7XG4gICAgICAgIHRoaXMuZXhhY3Rfc2V0W25vcm1hbGl6ZWRfdmFsdWVdID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCh2YWx1ZSkge1xuICAgICAgICBjb25zdCBub3JtYWxpemVkX3ZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5leGFjdF9zZXRbbm9ybWFsaXplZF92YWx1ZV07XG4gICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiBbWzEsIHJlc3VsdF1dO1xuICAgICAgICB9XG4gICAgICAgIGxldCByZXN1bHRzID0gW107XG4gICAgICAgIC8vIHN0YXJ0IHdpdGggaGlnaCBncmFtIHNpemUgYW5kIGlmIHRoZXJlIGFyZSBubyByZXN1bHRzLCBnbyB0byBsb3dlciBncmFtIHNpemVzXG4gICAgICAgIGZvciAobGV0IGdyYW1fc2l6ZSA9IEdSQU1fU0laRV9VUFBFUjsgZ3JhbV9zaXplID49IEdSQU1fU0laRV9MT1dFUjsgLS1ncmFtX3NpemUpIHtcbiAgICAgICAgICAgIHJlc3VsdHMgPSB0aGlzLl9fZ2V0KHZhbHVlLCBncmFtX3NpemUpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgX19nZXQodmFsdWUsIGdyYW1fc2l6ZSkge1xuICAgICAgICBjb25zdCBub3JtYWxpemVkX3ZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHt9O1xuICAgICAgICBjb25zdCBncmFtX2NvdW50cyA9IGdyYW1fY291bnRlcihub3JtYWxpemVkX3ZhbHVlLCBncmFtX3NpemUpO1xuICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuaXRlbXNbZ3JhbV9zaXplXTtcbiAgICAgICAgbGV0IHN1bV9vZl9zcXVhcmVfZ3JhbV9jb3VudHMgPSAwO1xuICAgICAgICBsZXQgZ3JhbTtcbiAgICAgICAgbGV0IGdyYW1fY291bnQ7XG4gICAgICAgIGxldCBpO1xuICAgICAgICBsZXQgaW5kZXg7XG4gICAgICAgIGxldCBvdGhlcl9ncmFtX2NvdW50O1xuICAgICAgICBmb3IgKGdyYW0gaW4gZ3JhbV9jb3VudHMpIHtcbiAgICAgICAgICAgIGdyYW1fY291bnQgPSBncmFtX2NvdW50c1tncmFtXTtcbiAgICAgICAgICAgIHN1bV9vZl9zcXVhcmVfZ3JhbV9jb3VudHMgKz0gTWF0aC5wb3coZ3JhbV9jb3VudCwgMik7XG4gICAgICAgICAgICBpZiAoZ3JhbSBpbiB0aGlzLm1hdGNoX2RpY3QpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5tYXRjaF9kaWN0W2dyYW1dLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gdGhpcy5tYXRjaF9kaWN0W2dyYW1dW2ldWzBdO1xuICAgICAgICAgICAgICAgICAgICBvdGhlcl9ncmFtX2NvdW50ID0gdGhpcy5tYXRjaF9kaWN0W2dyYW1dW2ldWzFdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggaW4gbWF0Y2hlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1tpbmRleF0gKz0gZ3JhbV9jb3VudCAqIG90aGVyX2dyYW1fY291bnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzW2luZGV4XSA9IGdyYW1fY291bnQgKiBvdGhlcl9ncmFtX2NvdW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZlY3Rvcl9ub3JtYWwgPSBNYXRoLnNxcnQoc3VtX29mX3NxdWFyZV9ncmFtX2NvdW50cyk7XG4gICAgICAgIGxldCByZXN1bHRzID0gW107XG4gICAgICAgIGxldCBtYXRjaF9zY29yZTtcbiAgICAgICAgLy8gYnVpbGQgYSByZXN1bHRzIGxpc3Qgb2YgW3Njb3JlLCBzdHJdXG4gICAgICAgIGZvciAoY29uc3QgbWF0Y2hfaW5kZXggaW4gbWF0Y2hlcykge1xuICAgICAgICAgICAgbWF0Y2hfc2NvcmUgPSBtYXRjaGVzW21hdGNoX2luZGV4XTtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaChbXG4gICAgICAgICAgICAgICAgbWF0Y2hfc2NvcmUgLyAodmVjdG9yX25vcm1hbCAqIGl0ZW1zW21hdGNoX2luZGV4XVswXSksXG4gICAgICAgICAgICAgICAgaXRlbXNbbWF0Y2hfaW5kZXhdWzFdXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHRzLnNvcnQoc29ydF9kZXNjZW5kaW5nKTtcbiAgICAgICAgbGV0IG5ld19yZXN1bHRzID0gW107XG4gICAgICAgIGNvbnN0IGVuZF9pbmRleCA9IE1hdGgubWluKDUwLCByZXN1bHRzLmxlbmd0aCk7XG4gICAgICAgIC8vIHRydW5jYXRlIHNvbWV3aGF0IGFyYml0cmFyaWx5IHRvIDUwXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZW5kX2luZGV4OyArK2kpIHtcbiAgICAgICAgICAgIG5ld19yZXN1bHRzLnB1c2goW1xuICAgICAgICAgICAgICAgIF9kaXN0YW5jZShyZXN1bHRzW2ldWzFdLCBub3JtYWxpemVkX3ZhbHVlKSxcbiAgICAgICAgICAgICAgICByZXN1bHRzW2ldWzFdXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHRzID0gbmV3X3Jlc3VsdHM7XG4gICAgICAgIHJlc3VsdHMuc29ydChzb3J0X2Rlc2NlbmRpbmcpO1xuICAgICAgICBuZXdfcmVzdWx0cyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChyZXN1bHRzW2ldWzBdID09IHJlc3VsdHNbMF1bMF0pIHtcbiAgICAgICAgICAgICAgICBuZXdfcmVzdWx0cy5wdXNoKFtyZXN1bHRzW2ldWzBdLCB0aGlzLmV4YWN0X3NldFtyZXN1bHRzW2ldWzFdXV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdfcmVzdWx0cztcbiAgICB9XG59XG5cbi8vIEFkYXB0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vYWNvcm5qcy9hY29ybi9ibG9iLzY1ODQ4MTVkY2E3NDQwZTAwZGU4NDFkMWRhZDE1MjMwMmZkZDdjYTUvc3JjL3Rva2VuaXplLmpzXG4vLyBSZXByb2R1Y2VkIHVuZGVyIE1JVCBMaWNlbnNlIGh0dHBzOi8vZ2l0aHViLmNvbS9hY29ybmpzL2Fjb3JuL2Jsb2IvbWFzdGVyL0xJQ0VOU0VcbmZ1bmN0aW9uIGZ1bGxfY2hhcl9jb2RlX2F0KHN0ciwgaSkge1xuICAgIGNvbnN0IGNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTtcbiAgICBpZiAoY29kZSA8PSAweGQ3ZmYgfHwgY29kZSA+PSAweGUwMDApXG4gICAgICAgIHJldHVybiBjb2RlO1xuICAgIGNvbnN0IG5leHQgPSBzdHIuY2hhckNvZGVBdChpICsgMSk7XG4gICAgcmV0dXJuIChjb2RlIDw8IDEwKSArIG5leHQgLSAweDM1ZmRjMDA7XG59XG5cbmNvbnN0IGdsb2JhbHMgPSBuZXcgU2V0KFtcbiAgICAnYWxlcnQnLFxuICAgICdBcnJheScsXG4gICAgJ0JpZ0ludCcsXG4gICAgJ0Jvb2xlYW4nLFxuICAgICdjbGVhckludGVydmFsJyxcbiAgICAnY2xlYXJUaW1lb3V0JyxcbiAgICAnY29uZmlybScsXG4gICAgJ2NvbnNvbGUnLFxuICAgICdEYXRlJyxcbiAgICAnZGVjb2RlVVJJJyxcbiAgICAnZGVjb2RlVVJJQ29tcG9uZW50JyxcbiAgICAnZG9jdW1lbnQnLFxuICAgICdFbGVtZW50JyxcbiAgICAnZW5jb2RlVVJJJyxcbiAgICAnZW5jb2RlVVJJQ29tcG9uZW50JyxcbiAgICAnRXJyb3InLFxuICAgICdFdmFsRXJyb3InLFxuICAgICdFdmVudCcsXG4gICAgJ0V2ZW50U291cmNlJyxcbiAgICAnZmV0Y2gnLFxuICAgICdnbG9iYWwnLFxuICAgICdnbG9iYWxUaGlzJyxcbiAgICAnaGlzdG9yeScsXG4gICAgJ0hUTUxFbGVtZW50JyxcbiAgICAnSW5maW5pdHknLFxuICAgICdJbnRlcm5hbEVycm9yJyxcbiAgICAnSW50bCcsXG4gICAgJ2lzRmluaXRlJyxcbiAgICAnaXNOYU4nLFxuICAgICdKU09OJyxcbiAgICAnbG9jYWxTdG9yYWdlJyxcbiAgICAnbG9jYXRpb24nLFxuICAgICdNYXAnLFxuICAgICdNYXRoJyxcbiAgICAnTmFOJyxcbiAgICAnbmF2aWdhdG9yJyxcbiAgICAnTm9kZScsXG4gICAgJ051bWJlcicsXG4gICAgJ09iamVjdCcsXG4gICAgJ3BhcnNlRmxvYXQnLFxuICAgICdwYXJzZUludCcsXG4gICAgJ3Byb2Nlc3MnLFxuICAgICdQcm9taXNlJyxcbiAgICAncHJvbXB0JyxcbiAgICAnUmFuZ2VFcnJvcicsXG4gICAgJ1JlZmVyZW5jZUVycm9yJyxcbiAgICAnUmVnRXhwJyxcbiAgICAnc2Vzc2lvblN0b3JhZ2UnLFxuICAgICdTZXQnLFxuICAgICdzZXRJbnRlcnZhbCcsXG4gICAgJ3NldFRpbWVvdXQnLFxuICAgICdTdHJpbmcnLFxuICAgICdTVkdFbGVtZW50JyxcbiAgICAnU3ludGF4RXJyb3InLFxuICAgICdUeXBlRXJyb3InLFxuICAgICd1bmRlZmluZWQnLFxuICAgICdVUklFcnJvcicsXG4gICAgJ1VSTCcsXG4gICAgJ1VSTFNlYXJjaFBhcmFtcycsXG4gICAgJ3dpbmRvdydcbl0pO1xuY29uc3QgcmVzZXJ2ZWQgPSBuZXcgU2V0KFtcbiAgICAnYXJndW1lbnRzJyxcbiAgICAnYXdhaXQnLFxuICAgICdicmVhaycsXG4gICAgJ2Nhc2UnLFxuICAgICdjYXRjaCcsXG4gICAgJ2NsYXNzJyxcbiAgICAnY29uc3QnLFxuICAgICdjb250aW51ZScsXG4gICAgJ2RlYnVnZ2VyJyxcbiAgICAnZGVmYXVsdCcsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2RvJyxcbiAgICAnZWxzZScsXG4gICAgJ2VudW0nLFxuICAgICdldmFsJyxcbiAgICAnZXhwb3J0JyxcbiAgICAnZXh0ZW5kcycsXG4gICAgJ2ZhbHNlJyxcbiAgICAnZmluYWxseScsXG4gICAgJ2ZvcicsXG4gICAgJ2Z1bmN0aW9uJyxcbiAgICAnaWYnLFxuICAgICdpbXBsZW1lbnRzJyxcbiAgICAnaW1wb3J0JyxcbiAgICAnaW4nLFxuICAgICdpbnN0YW5jZW9mJyxcbiAgICAnaW50ZXJmYWNlJyxcbiAgICAnbGV0JyxcbiAgICAnbmV3JyxcbiAgICAnbnVsbCcsXG4gICAgJ3BhY2thZ2UnLFxuICAgICdwcml2YXRlJyxcbiAgICAncHJvdGVjdGVkJyxcbiAgICAncHVibGljJyxcbiAgICAncmV0dXJuJyxcbiAgICAnc3RhdGljJyxcbiAgICAnc3VwZXInLFxuICAgICdzd2l0Y2gnLFxuICAgICd0aGlzJyxcbiAgICAndGhyb3cnLFxuICAgICd0cnVlJyxcbiAgICAndHJ5JyxcbiAgICAndHlwZW9mJyxcbiAgICAndmFyJyxcbiAgICAndm9pZCcsXG4gICAgJ3doaWxlJyxcbiAgICAnd2l0aCcsXG4gICAgJ3lpZWxkJ1xuXSk7XG5jb25zdCB2b2lkX2VsZW1lbnRfbmFtZXMgPSAvXig/OmFyZWF8YmFzZXxicnxjb2x8Y29tbWFuZHxlbWJlZHxocnxpbWd8aW5wdXR8a2V5Z2VufGxpbmt8bWV0YXxwYXJhbXxzb3VyY2V8dHJhY2t8d2JyKSQvO1xuZnVuY3Rpb24gaXNfdm9pZChuYW1lKSB7XG4gICAgcmV0dXJuIHZvaWRfZWxlbWVudF9uYW1lcy50ZXN0KG5hbWUpIHx8IG5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJyFkb2N0eXBlJztcbn1cbmZ1bmN0aW9uIGlzX3ZhbGlkKHN0cikge1xuICAgIGxldCBpID0gMDtcbiAgICB3aGlsZSAoaSA8IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgY29kZSA9IGZ1bGxfY2hhcl9jb2RlX2F0KHN0ciwgaSk7XG4gICAgICAgIGlmICghKGkgPT09IDAgPyBpc0lkZW50aWZpZXJTdGFydCA6IGlzSWRlbnRpZmllckNoYXIpKGNvZGUsIHRydWUpKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpICs9IGNvZGUgPD0gMHhmZmZmID8gMSA6IDI7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gc2FuaXRpemUobmFtZSkge1xuICAgIHJldHVybiBuYW1lXG4gICAgICAgIC5yZXBsYWNlKC9bXmEtekEtWjAtOV9dKy9nLCAnXycpXG4gICAgICAgIC5yZXBsYWNlKC9eXy8sICcnKVxuICAgICAgICAucmVwbGFjZSgvXyQvLCAnJylcbiAgICAgICAgLnJlcGxhY2UoL15bMC05XS8sICdfJCYnKTtcbn1cblxuZnVuY3Rpb24gbGlzdChpdGVtcywgY29uanVuY3Rpb24gPSAnb3InKSB7XG4gICAgaWYgKGl0ZW1zLmxlbmd0aCA9PT0gMSlcbiAgICAgICAgcmV0dXJuIGl0ZW1zWzBdO1xuICAgIHJldHVybiBgJHtpdGVtcy5zbGljZSgwLCAtMSkuam9pbignLCAnKX0gJHtjb25qdW5jdGlvbn0gJHtpdGVtc1tpdGVtcy5sZW5ndGggLSAxXX1gO1xufVxuXG4vLyBBbGwgcGFyc2VyIGVycm9ycyBzaG91bGQgYmUgbGlzdGVkIGFuZCBhY2Nlc3NlZCBmcm9tIGhlcmVcbi8qKlxuICogQGludGVybmFsXG4gKi9cbnZhciBwYXJzZXJfZXJyb3JzID0ge1xuICAgIGNzc19zeW50YXhfZXJyb3I6IChtZXNzYWdlKSA9PiAoe1xuICAgICAgICBjb2RlOiAnY3NzLXN5bnRheC1lcnJvcicsXG4gICAgICAgIG1lc3NhZ2VcbiAgICB9KSxcbiAgICBkdXBsaWNhdGVfYXR0cmlidXRlOiB7XG4gICAgICAgIGNvZGU6ICdkdXBsaWNhdGUtYXR0cmlidXRlJyxcbiAgICAgICAgbWVzc2FnZTogJ0F0dHJpYnV0ZXMgbmVlZCB0byBiZSB1bmlxdWUnXG4gICAgfSxcbiAgICBkdXBsaWNhdGVfZWxlbWVudDogKHNsdWcsIG5hbWUpID0+ICh7XG4gICAgICAgIGNvZGU6IGBkdXBsaWNhdGUtJHtzbHVnfWAsXG4gICAgICAgIG1lc3NhZ2U6IGBBIGNvbXBvbmVudCBjYW4gb25seSBoYXZlIG9uZSA8JHtuYW1lfT4gdGFnYFxuICAgIH0pLFxuICAgIGR1cGxpY2F0ZV9zdHlsZToge1xuICAgICAgICBjb2RlOiAnZHVwbGljYXRlLXN0eWxlJyxcbiAgICAgICAgbWVzc2FnZTogJ1lvdSBjYW4gb25seSBoYXZlIG9uZSB0b3AtbGV2ZWwgPHN0eWxlPiB0YWcgcGVyIGNvbXBvbmVudCdcbiAgICB9LFxuICAgIGVtcHR5X2F0dHJpYnV0ZV9zaG9ydGhhbmQ6IHtcbiAgICAgICAgY29kZTogJ2VtcHR5LWF0dHJpYnV0ZS1zaG9ydGhhbmQnLFxuICAgICAgICBtZXNzYWdlOiAnQXR0cmlidXRlIHNob3J0aGFuZCBjYW5ub3QgYmUgZW1wdHknXG4gICAgfSxcbiAgICBlbXB0eV9kaXJlY3RpdmVfbmFtZTogKHR5cGUpID0+ICh7XG4gICAgICAgIGNvZGU6ICdlbXB0eS1kaXJlY3RpdmUtbmFtZScsXG4gICAgICAgIG1lc3NhZ2U6IGAke3R5cGV9IG5hbWUgY2Fubm90IGJlIGVtcHR5YFxuICAgIH0pLFxuICAgIGVtcHR5X2dsb2JhbF9zZWxlY3Rvcjoge1xuICAgICAgICBjb2RlOiAnY3NzLXN5bnRheC1lcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICc6Z2xvYmFsKCkgbXVzdCBjb250YWluIGEgc2VsZWN0b3InXG4gICAgfSxcbiAgICBleHBlY3RlZF9ibG9ja190eXBlOiB7XG4gICAgICAgIGNvZGU6ICdleHBlY3RlZC1ibG9jay10eXBlJyxcbiAgICAgICAgbWVzc2FnZTogJ0V4cGVjdGVkIGlmLCBlYWNoIG9yIGF3YWl0J1xuICAgIH0sXG4gICAgZXhwZWN0ZWRfbmFtZToge1xuICAgICAgICBjb2RlOiAnZXhwZWN0ZWQtbmFtZScsXG4gICAgICAgIG1lc3NhZ2U6ICdFeHBlY3RlZCBuYW1lJ1xuICAgIH0sXG4gICAgaW52YWxpZF9jYXRjaF9wbGFjZW1lbnRfdW5jbG9zZWRfYmxvY2s6IChibG9jaykgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtY2F0Y2gtcGxhY2VtZW50JyxcbiAgICAgICAgbWVzc2FnZTogYEV4cGVjdGVkIHRvIGNsb3NlICR7YmxvY2t9IGJlZm9yZSBzZWVpbmcgezpjYXRjaH0gYmxvY2tgXG4gICAgfSksXG4gICAgaW52YWxpZF9jYXRjaF9wbGFjZW1lbnRfd2l0aG91dF9hd2FpdDoge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1jYXRjaC1wbGFjZW1lbnQnLFxuICAgICAgICBtZXNzYWdlOiAnQ2Fubm90IGhhdmUgYW4gezpjYXRjaH0gYmxvY2sgb3V0c2lkZSBhbiB7I2F3YWl0IC4uLn0gYmxvY2snXG4gICAgfSxcbiAgICBpbnZhbGlkX2NvbXBvbmVudF9kZWZpbml0aW9uOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWNvbXBvbmVudC1kZWZpbml0aW9uJyxcbiAgICAgICAgbWVzc2FnZTogJ2ludmFsaWQgY29tcG9uZW50IGRlZmluaXRpb24nXG4gICAgfSxcbiAgICBpbnZhbGlkX2Nsb3NpbmdfdGFnX3Vub3BlbmVkOiAobmFtZSkgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtY2xvc2luZy10YWcnLFxuICAgICAgICBtZXNzYWdlOiBgPC8ke25hbWV9PiBhdHRlbXB0ZWQgdG8gY2xvc2UgYW4gZWxlbWVudCB0aGF0IHdhcyBub3Qgb3BlbmBcbiAgICB9KSxcbiAgICBpbnZhbGlkX2Nsb3NpbmdfdGFnX2F1dG9jbG9zZWQ6IChuYW1lLCByZWFzb24pID0+ICh7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWNsb3NpbmctdGFnJyxcbiAgICAgICAgbWVzc2FnZTogYDwvJHtuYW1lfT4gYXR0ZW1wdGVkIHRvIGNsb3NlIDwke25hbWV9PiB0aGF0IHdhcyBhbHJlYWR5IGF1dG9tYXRpY2FsbHkgY2xvc2VkIGJ5IDwke3JlYXNvbn0+YFxuICAgIH0pLFxuICAgIGludmFsaWRfZGVidWdfYXJnczoge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1kZWJ1Zy1hcmdzJyxcbiAgICAgICAgbWVzc2FnZTogJ3tAZGVidWcgLi4ufSBhcmd1bWVudHMgbXVzdCBiZSBpZGVudGlmaWVycywgbm90IGFyYml0cmFyeSBleHByZXNzaW9ucydcbiAgICB9LFxuICAgIGludmFsaWRfZGVjbGFyYXRpb246IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtZGVjbGFyYXRpb24nLFxuICAgICAgICBtZXNzYWdlOiAnRGVjbGFyYXRpb24gY2Fubm90IGJlIGVtcHR5J1xuICAgIH0sXG4gICAgaW52YWxpZF9kaXJlY3RpdmVfdmFsdWU6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtZGlyZWN0aXZlLXZhbHVlJyxcbiAgICAgICAgbWVzc2FnZTogJ0RpcmVjdGl2ZSB2YWx1ZSBtdXN0IGJlIGEgSmF2YVNjcmlwdCBleHByZXNzaW9uIGVuY2xvc2VkIGluIGN1cmx5IGJyYWNlcydcbiAgICB9LFxuICAgIGludmFsaWRfZWxzZWlmOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWVsc2VpZicsXG4gICAgICAgIG1lc3NhZ2U6ICdcXCdlbHNlaWZcXCcgc2hvdWxkIGJlIFxcJ2Vsc2UgaWZcXCcnXG4gICAgfSxcbiAgICBpbnZhbGlkX2Vsc2VpZl9wbGFjZW1lbnRfb3V0c2lkZV9pZjoge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1lbHNlaWYtcGxhY2VtZW50JyxcbiAgICAgICAgbWVzc2FnZTogJ0Nhbm5vdCBoYXZlIGFuIHs6ZWxzZSBpZiAuLi59IGJsb2NrIG91dHNpZGUgYW4geyNpZiAuLi59IGJsb2NrJ1xuICAgIH0sXG4gICAgaW52YWxpZF9lbHNlaWZfcGxhY2VtZW50X3VuY2xvc2VkX2Jsb2NrOiAoYmxvY2spID0+ICh7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWVsc2VpZi1wbGFjZW1lbnQnLFxuICAgICAgICBtZXNzYWdlOiBgRXhwZWN0ZWQgdG8gY2xvc2UgJHtibG9ja30gYmVmb3JlIHNlZWluZyB7OmVsc2UgaWYgLi4ufSBibG9ja2BcbiAgICB9KSxcbiAgICBpbnZhbGlkX2Vsc2VfcGxhY2VtZW50X291dHNpZGVfaWY6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtZWxzZS1wbGFjZW1lbnQnLFxuICAgICAgICBtZXNzYWdlOiAnQ2Fubm90IGhhdmUgYW4gezplbHNlfSBibG9jayBvdXRzaWRlIGFuIHsjaWYgLi4ufSBvciB7I2VhY2ggLi4ufSBibG9jaydcbiAgICB9LFxuICAgIGludmFsaWRfZWxzZV9wbGFjZW1lbnRfdW5jbG9zZWRfYmxvY2s6IChibG9jaykgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtZWxzZS1wbGFjZW1lbnQnLFxuICAgICAgICBtZXNzYWdlOiBgRXhwZWN0ZWQgdG8gY2xvc2UgJHtibG9ja30gYmVmb3JlIHNlZWluZyB7OmVsc2V9IGJsb2NrYFxuICAgIH0pLFxuICAgIGludmFsaWRfZWxlbWVudF9jb250ZW50OiAoc2x1ZywgbmFtZSkgPT4gKHtcbiAgICAgICAgY29kZTogYGludmFsaWQtJHtzbHVnfS1jb250ZW50YCxcbiAgICAgICAgbWVzc2FnZTogYDwke25hbWV9PiBjYW5ub3QgaGF2ZSBjaGlsZHJlbmBcbiAgICB9KSxcbiAgICBpbnZhbGlkX2VsZW1lbnRfcGxhY2VtZW50OiAoc2x1ZywgbmFtZSkgPT4gKHtcbiAgICAgICAgY29kZTogYGludmFsaWQtJHtzbHVnfS1wbGFjZW1lbnRgLFxuICAgICAgICBtZXNzYWdlOiBgPCR7bmFtZX0+IHRhZ3MgY2Fubm90IGJlIGluc2lkZSBlbGVtZW50cyBvciBibG9ja3NgXG4gICAgfSksXG4gICAgaW52YWxpZF9yZWZfZGlyZWN0aXZlOiAobmFtZSkgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtcmVmLWRpcmVjdGl2ZScsXG4gICAgICAgIG1lc3NhZ2U6IGBUaGUgcmVmIGRpcmVjdGl2ZSBpcyBubyBsb25nZXIgc3VwcG9ydGVkIOKAlCB1c2UgXFxgYmluZDp0aGlzPXske25hbWV9fVxcYCBpbnN0ZWFkYFxuICAgIH0pLFxuICAgIGludmFsaWRfcmVmX3NlbGVjdG9yOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLXJlZi1zZWxlY3RvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdyZWYgc2VsZWN0b3JzIGFyZSBubyBsb25nZXIgc3VwcG9ydGVkJ1xuICAgIH0sXG4gICAgaW52YWxpZF9zZWxmX3BsYWNlbWVudDoge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1zZWxmLXBsYWNlbWVudCcsXG4gICAgICAgIG1lc3NhZ2U6ICc8c3ZlbHRlOnNlbGY+IGNvbXBvbmVudHMgY2FuIG9ubHkgZXhpc3QgaW5zaWRlIHsjaWZ9IGJsb2NrcywgeyNlYWNofSBibG9ja3MsIG9yIHNsb3RzIHBhc3NlZCB0byBjb21wb25lbnRzJ1xuICAgIH0sXG4gICAgaW52YWxpZF9zY3JpcHRfaW5zdGFuY2U6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtc2NyaXB0JyxcbiAgICAgICAgbWVzc2FnZTogJ0EgY29tcG9uZW50IGNhbiBvbmx5IGhhdmUgb25lIGluc3RhbmNlLWxldmVsIDxzY3JpcHQ+IGVsZW1lbnQnXG4gICAgfSxcbiAgICBpbnZhbGlkX3NjcmlwdF9tb2R1bGU6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtc2NyaXB0JyxcbiAgICAgICAgbWVzc2FnZTogJ0EgY29tcG9uZW50IGNhbiBvbmx5IGhhdmUgb25lIDxzY3JpcHQgY29udGV4dD1cIm1vZHVsZVwiPiBlbGVtZW50J1xuICAgIH0sXG4gICAgaW52YWxpZF9zY3JpcHRfY29udGV4dF9hdHRyaWJ1dGU6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtc2NyaXB0JyxcbiAgICAgICAgbWVzc2FnZTogJ2NvbnRleHQgYXR0cmlidXRlIG11c3QgYmUgc3RhdGljJ1xuICAgIH0sXG4gICAgaW52YWxpZF9zY3JpcHRfY29udGV4dF92YWx1ZToge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1zY3JpcHQnLFxuICAgICAgICBtZXNzYWdlOiAnSWYgdGhlIGNvbnRleHQgYXR0cmlidXRlIGlzIHN1cHBsaWVkLCBpdHMgdmFsdWUgbXVzdCBiZSBcIm1vZHVsZVwiJ1xuICAgIH0sXG4gICAgaW52YWxpZF90YWdfbmFtZToge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC10YWctbmFtZScsXG4gICAgICAgIG1lc3NhZ2U6ICdFeHBlY3RlZCB2YWxpZCB0YWcgbmFtZSdcbiAgICB9LFxuICAgIGludmFsaWRfdGFnX25hbWVfc3ZlbHRlX2VsZW1lbnQ6ICh0YWdzLCBtYXRjaCkgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtdGFnLW5hbWUnLFxuICAgICAgICBtZXNzYWdlOiBgVmFsaWQgPHN2ZWx0ZTouLi4+IHRhZyBuYW1lcyBhcmUgJHtsaXN0KHRhZ3MpfSR7bWF0Y2ggPyAnIChkaWQgeW91IG1lYW4gJyArIG1hdGNoICsgJz8pJyA6ICcnfWBcbiAgICB9KSxcbiAgICBpbnZhbGlkX3RoZW5fcGxhY2VtZW50X3VuY2xvc2VkX2Jsb2NrOiAoYmxvY2spID0+ICh7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLXRoZW4tcGxhY2VtZW50JyxcbiAgICAgICAgbWVzc2FnZTogYEV4cGVjdGVkIHRvIGNsb3NlICR7YmxvY2t9IGJlZm9yZSBzZWVpbmcgezp0aGVufSBibG9ja2BcbiAgICB9KSxcbiAgICBpbnZhbGlkX3RoZW5fcGxhY2VtZW50X3dpdGhvdXRfYXdhaXQ6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtdGhlbi1wbGFjZW1lbnQnLFxuICAgICAgICBtZXNzYWdlOiAnQ2Fubm90IGhhdmUgYW4gezp0aGVufSBibG9jayBvdXRzaWRlIGFuIHsjYXdhaXQgLi4ufSBibG9jaydcbiAgICB9LFxuICAgIGludmFsaWRfdm9pZF9jb250ZW50OiAobmFtZSkgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtdm9pZC1jb250ZW50JyxcbiAgICAgICAgbWVzc2FnZTogYDwke25hbWV9PiBpcyBhIHZvaWQgZWxlbWVudCBhbmQgY2Fubm90IGhhdmUgY2hpbGRyZW4sIG9yIGEgY2xvc2luZyB0YWdgXG4gICAgfSksXG4gICAgbWlzc2luZ19jb21wb25lbnRfZGVmaW5pdGlvbjoge1xuICAgICAgICBjb2RlOiAnbWlzc2luZy1jb21wb25lbnQtZGVmaW5pdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6ICc8c3ZlbHRlOmNvbXBvbmVudD4gbXVzdCBoYXZlIGEgXFwndGhpc1xcJyBhdHRyaWJ1dGUnXG4gICAgfSxcbiAgICBtaXNzaW5nX2F0dHJpYnV0ZV92YWx1ZToge1xuICAgICAgICBjb2RlOiAnbWlzc2luZy1hdHRyaWJ1dGUtdmFsdWUnLFxuICAgICAgICBtZXNzYWdlOiAnRXhwZWN0ZWQgdmFsdWUgZm9yIHRoZSBhdHRyaWJ1dGUnXG4gICAgfSxcbiAgICB1bmNsb3NlZF9zY3JpcHQ6IHtcbiAgICAgICAgY29kZTogJ3VuY2xvc2VkLXNjcmlwdCcsXG4gICAgICAgIG1lc3NhZ2U6ICc8c2NyaXB0PiBtdXN0IGhhdmUgYSBjbG9zaW5nIHRhZydcbiAgICB9LFxuICAgIHVuY2xvc2VkX3N0eWxlOiB7XG4gICAgICAgIGNvZGU6ICd1bmNsb3NlZC1zdHlsZScsXG4gICAgICAgIG1lc3NhZ2U6ICc8c3R5bGU+IG11c3QgaGF2ZSBhIGNsb3NpbmcgdGFnJ1xuICAgIH0sXG4gICAgdW5jbG9zZWRfY29tbWVudDoge1xuICAgICAgICBjb2RlOiAndW5jbG9zZWQtY29tbWVudCcsXG4gICAgICAgIG1lc3NhZ2U6ICdjb21tZW50IHdhcyBsZWZ0IG9wZW4sIGV4cGVjdGVkIC0tPidcbiAgICB9LFxuICAgIHVuY2xvc2VkX2F0dHJpYnV0ZV92YWx1ZTogKHRva2VuKSA9PiAoe1xuICAgICAgICBjb2RlOiAndW5jbG9zZWQtYXR0cmlidXRlLXZhbHVlJyxcbiAgICAgICAgbWVzc2FnZTogYEV4cGVjdGVkIHRvIGNsb3NlIHRoZSBhdHRyaWJ1dGUgdmFsdWUgd2l0aCAke3Rva2VufWBcbiAgICB9KSxcbiAgICB1bmV4cGVjdGVkX2Jsb2NrX2Nsb3NlOiB7XG4gICAgICAgIGNvZGU6ICd1bmV4cGVjdGVkLWJsb2NrLWNsb3NlJyxcbiAgICAgICAgbWVzc2FnZTogJ1VuZXhwZWN0ZWQgYmxvY2sgY2xvc2luZyB0YWcnXG4gICAgfSxcbiAgICB1bmV4cGVjdGVkX2VvZjoge1xuICAgICAgICBjb2RlOiAndW5leHBlY3RlZC1lb2YnLFxuICAgICAgICBtZXNzYWdlOiAnVW5leHBlY3RlZCBlbmQgb2YgaW5wdXQnXG4gICAgfSxcbiAgICB1bmV4cGVjdGVkX2VvZl90b2tlbjogKHRva2VuKSA9PiAoe1xuICAgICAgICBjb2RlOiAndW5leHBlY3RlZC1lb2YnLFxuICAgICAgICBtZXNzYWdlOiBgVW5leHBlY3RlZCAke3Rva2VufWBcbiAgICB9KSxcbiAgICB1bmV4cGVjdGVkX3Rva2VuOiAodG9rZW4pID0+ICh7XG4gICAgICAgIGNvZGU6ICd1bmV4cGVjdGVkLXRva2VuJyxcbiAgICAgICAgbWVzc2FnZTogYEV4cGVjdGVkICR7dG9rZW59YFxuICAgIH0pLFxuICAgIHVuZXhwZWN0ZWRfdG9rZW5fZGVzdHJ1Y3R1cmU6IHtcbiAgICAgICAgY29kZTogJ3VuZXhwZWN0ZWQtdG9rZW4nLFxuICAgICAgICBtZXNzYWdlOiAnRXhwZWN0ZWQgaWRlbnRpZmllciBvciBkZXN0cnVjdHVyZSBwYXR0ZXJuJ1xuICAgIH1cbn07XG5cbi8vIEB0cy1jaGVja1xuLyoqIEB0eXBlZGVmIHsgaW1wb3J0KCdlc3RyZWUnKS5CYXNlTm9kZX0gQmFzZU5vZGUgKi9cblxuLyoqIEB0eXBlZGVmIHt7XG5cdHNraXA6ICgpID0+IHZvaWQ7XG5cdHJlbW92ZTogKCkgPT4gdm9pZDtcblx0cmVwbGFjZTogKG5vZGU6IEJhc2VOb2RlKSA9PiB2b2lkO1xufX0gV2Fsa2VyQ29udGV4dCAqL1xuXG5jbGFzcyBXYWxrZXJCYXNlIHtcblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0LyoqIEB0eXBlIHtib29sZWFufSAqL1xuXHRcdHRoaXMuc2hvdWxkX3NraXAgPSBmYWxzZTtcblxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cblx0XHR0aGlzLnNob3VsZF9yZW1vdmUgPSBmYWxzZTtcblxuXHRcdC8qKiBAdHlwZSB7QmFzZU5vZGUgfCBudWxsfSAqL1xuXHRcdHRoaXMucmVwbGFjZW1lbnQgPSBudWxsO1xuXG5cdFx0LyoqIEB0eXBlIHtXYWxrZXJDb250ZXh0fSAqL1xuXHRcdHRoaXMuY29udGV4dCA9IHtcblx0XHRcdHNraXA6ICgpID0+ICh0aGlzLnNob3VsZF9za2lwID0gdHJ1ZSksXG5cdFx0XHRyZW1vdmU6ICgpID0+ICh0aGlzLnNob3VsZF9yZW1vdmUgPSB0cnVlKSxcblx0XHRcdHJlcGxhY2U6IChub2RlKSA9PiAodGhpcy5yZXBsYWNlbWVudCA9IG5vZGUpXG5cdFx0fTtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKiBAcGFyYW0ge2FueX0gcGFyZW50XG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleFxuXHQgKiBAcGFyYW0ge0Jhc2VOb2RlfSBub2RlXG5cdCAqL1xuXHRyZXBsYWNlKHBhcmVudCwgcHJvcCwgaW5kZXgsIG5vZGUpIHtcblx0XHRpZiAocGFyZW50KSB7XG5cdFx0XHRpZiAoaW5kZXggIT09IG51bGwpIHtcblx0XHRcdFx0cGFyZW50W3Byb3BdW2luZGV4XSA9IG5vZGU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRwYXJlbnRbcHJvcF0gPSBub2RlO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKiBAcGFyYW0ge2FueX0gcGFyZW50XG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleFxuXHQgKi9cblx0cmVtb3ZlKHBhcmVudCwgcHJvcCwgaW5kZXgpIHtcblx0XHRpZiAocGFyZW50KSB7XG5cdFx0XHRpZiAoaW5kZXggIT09IG51bGwpIHtcblx0XHRcdFx0cGFyZW50W3Byb3BdLnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRkZWxldGUgcGFyZW50W3Byb3BdO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG4vLyBAdHMtY2hlY2tcblxuLyoqIEB0eXBlZGVmIHsgaW1wb3J0KCdlc3RyZWUnKS5CYXNlTm9kZX0gQmFzZU5vZGUgKi9cbi8qKiBAdHlwZWRlZiB7IGltcG9ydCgnLi93YWxrZXIuanMnKS5XYWxrZXJDb250ZXh0fSBXYWxrZXJDb250ZXh0ICovXG5cbi8qKiBAdHlwZWRlZiB7KFxuICogICAgdGhpczogV2Fsa2VyQ29udGV4dCxcbiAqICAgIG5vZGU6IEJhc2VOb2RlLFxuICogICAgcGFyZW50OiBCYXNlTm9kZSxcbiAqICAgIGtleTogc3RyaW5nLFxuICogICAgaW5kZXg6IG51bWJlclxuICogKSA9PiB2b2lkfSBTeW5jSGFuZGxlciAqL1xuXG5jbGFzcyBTeW5jV2Fsa2VyIGV4dGVuZHMgV2Fsa2VyQmFzZSB7XG5cdC8qKlxuXHQgKlxuXHQgKiBAcGFyYW0ge1N5bmNIYW5kbGVyfSBlbnRlclxuXHQgKiBAcGFyYW0ge1N5bmNIYW5kbGVyfSBsZWF2ZVxuXHQgKi9cblx0Y29uc3RydWN0b3IoZW50ZXIsIGxlYXZlKSB7XG5cdFx0c3VwZXIoKTtcblxuXHRcdC8qKiBAdHlwZSB7U3luY0hhbmRsZXJ9ICovXG5cdFx0dGhpcy5lbnRlciA9IGVudGVyO1xuXG5cdFx0LyoqIEB0eXBlIHtTeW5jSGFuZGxlcn0gKi9cblx0XHR0aGlzLmxlYXZlID0gbGVhdmU7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHBhcmFtIHtCYXNlTm9kZX0gbm9kZVxuXHQgKiBAcGFyYW0ge0Jhc2VOb2RlfSBwYXJlbnRcblx0ICogQHBhcmFtIHtzdHJpbmd9IFtwcm9wXVxuXHQgKiBAcGFyYW0ge251bWJlcn0gW2luZGV4XVxuXHQgKiBAcmV0dXJucyB7QmFzZU5vZGV9XG5cdCAqL1xuXHR2aXNpdChub2RlLCBwYXJlbnQsIHByb3AsIGluZGV4KSB7XG5cdFx0aWYgKG5vZGUpIHtcblx0XHRcdGlmICh0aGlzLmVudGVyKSB7XG5cdFx0XHRcdGNvbnN0IF9zaG91bGRfc2tpcCA9IHRoaXMuc2hvdWxkX3NraXA7XG5cdFx0XHRcdGNvbnN0IF9zaG91bGRfcmVtb3ZlID0gdGhpcy5zaG91bGRfcmVtb3ZlO1xuXHRcdFx0XHRjb25zdCBfcmVwbGFjZW1lbnQgPSB0aGlzLnJlcGxhY2VtZW50O1xuXHRcdFx0XHR0aGlzLnNob3VsZF9za2lwID0gZmFsc2U7XG5cdFx0XHRcdHRoaXMuc2hvdWxkX3JlbW92ZSA9IGZhbHNlO1xuXHRcdFx0XHR0aGlzLnJlcGxhY2VtZW50ID0gbnVsbDtcblxuXHRcdFx0XHR0aGlzLmVudGVyLmNhbGwodGhpcy5jb250ZXh0LCBub2RlLCBwYXJlbnQsIHByb3AsIGluZGV4KTtcblxuXHRcdFx0XHRpZiAodGhpcy5yZXBsYWNlbWVudCkge1xuXHRcdFx0XHRcdG5vZGUgPSB0aGlzLnJlcGxhY2VtZW50O1xuXHRcdFx0XHRcdHRoaXMucmVwbGFjZShwYXJlbnQsIHByb3AsIGluZGV4LCBub2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0aGlzLnNob3VsZF9yZW1vdmUpIHtcblx0XHRcdFx0XHR0aGlzLnJlbW92ZShwYXJlbnQsIHByb3AsIGluZGV4KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnN0IHNraXBwZWQgPSB0aGlzLnNob3VsZF9za2lwO1xuXHRcdFx0XHRjb25zdCByZW1vdmVkID0gdGhpcy5zaG91bGRfcmVtb3ZlO1xuXG5cdFx0XHRcdHRoaXMuc2hvdWxkX3NraXAgPSBfc2hvdWxkX3NraXA7XG5cdFx0XHRcdHRoaXMuc2hvdWxkX3JlbW92ZSA9IF9zaG91bGRfcmVtb3ZlO1xuXHRcdFx0XHR0aGlzLnJlcGxhY2VtZW50ID0gX3JlcGxhY2VtZW50O1xuXG5cdFx0XHRcdGlmIChza2lwcGVkKSByZXR1cm4gbm9kZTtcblx0XHRcdFx0aWYgKHJlbW92ZWQpIHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGNvbnN0IGtleSBpbiBub2RlKSB7XG5cdFx0XHRcdGNvbnN0IHZhbHVlID0gbm9kZVtrZXldO1xuXG5cdFx0XHRcdGlmICh0eXBlb2YgdmFsdWUgIT09IFwib2JqZWN0XCIpIHtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuXHRcdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdFx0XHRcdGlmICh2YWx1ZVtpXSAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsdWVbaV0udHlwZSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdFx0XHRcdFx0aWYgKCF0aGlzLnZpc2l0KHZhbHVlW2ldLCBub2RlLCBrZXksIGkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0Ly8gcmVtb3ZlZFxuXHRcdFx0XHRcdFx0XHRcdGktLTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUudHlwZSA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRcdHRoaXMudmlzaXQodmFsdWUsIG5vZGUsIGtleSwgbnVsbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMubGVhdmUpIHtcblx0XHRcdFx0Y29uc3QgX3JlcGxhY2VtZW50ID0gdGhpcy5yZXBsYWNlbWVudDtcblx0XHRcdFx0Y29uc3QgX3Nob3VsZF9yZW1vdmUgPSB0aGlzLnNob3VsZF9yZW1vdmU7XG5cdFx0XHRcdHRoaXMucmVwbGFjZW1lbnQgPSBudWxsO1xuXHRcdFx0XHR0aGlzLnNob3VsZF9yZW1vdmUgPSBmYWxzZTtcblxuXHRcdFx0XHR0aGlzLmxlYXZlLmNhbGwodGhpcy5jb250ZXh0LCBub2RlLCBwYXJlbnQsIHByb3AsIGluZGV4KTtcblxuXHRcdFx0XHRpZiAodGhpcy5yZXBsYWNlbWVudCkge1xuXHRcdFx0XHRcdG5vZGUgPSB0aGlzLnJlcGxhY2VtZW50O1xuXHRcdFx0XHRcdHRoaXMucmVwbGFjZShwYXJlbnQsIHByb3AsIGluZGV4LCBub2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0aGlzLnNob3VsZF9yZW1vdmUpIHtcblx0XHRcdFx0XHR0aGlzLnJlbW92ZShwYXJlbnQsIHByb3AsIGluZGV4KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnN0IHJlbW92ZWQgPSB0aGlzLnNob3VsZF9yZW1vdmU7XG5cblx0XHRcdFx0dGhpcy5yZXBsYWNlbWVudCA9IF9yZXBsYWNlbWVudDtcblx0XHRcdFx0dGhpcy5zaG91bGRfcmVtb3ZlID0gX3Nob3VsZF9yZW1vdmU7XG5cblx0XHRcdFx0aWYgKHJlbW92ZWQpIHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBub2RlO1xuXHR9XG59XG5cbi8vIEB0cy1jaGVja1xuXG4vKiogQHR5cGVkZWYgeyBpbXBvcnQoJ2VzdHJlZScpLkJhc2VOb2RlfSBCYXNlTm9kZSAqL1xuLyoqIEB0eXBlZGVmIHsgaW1wb3J0KCcuL3N5bmMuanMnKS5TeW5jSGFuZGxlcn0gU3luY0hhbmRsZXIgKi9cbi8qKiBAdHlwZWRlZiB7IGltcG9ydCgnLi9hc3luYy5qcycpLkFzeW5jSGFuZGxlcn0gQXN5bmNIYW5kbGVyICovXG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7QmFzZU5vZGV9IGFzdFxuICogQHBhcmFtIHt7XG4gKiAgIGVudGVyPzogU3luY0hhbmRsZXJcbiAqICAgbGVhdmU/OiBTeW5jSGFuZGxlclxuICogfX0gd2Fsa2VyXG4gKiBAcmV0dXJucyB7QmFzZU5vZGV9XG4gKi9cbmZ1bmN0aW9uIHdhbGsoYXN0LCB7IGVudGVyLCBsZWF2ZSB9KSB7XG5cdGNvbnN0IGluc3RhbmNlID0gbmV3IFN5bmNXYWxrZXIoZW50ZXIsIGxlYXZlKTtcblx0cmV0dXJuIGluc3RhbmNlLnZpc2l0KGFzdCwgbnVsbCk7XG59XG5cbi8vIGdlbmVyYXRlIGFuIElEIHRoYXQgaXMsIHRvIGFsbCBpbnRlbnRzIGFuZCBwdXJwb3NlcywgdW5pcXVlXG5jb25zdCBpZCA9IChNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxZTIwKSkudG9TdHJpbmcoMzYpO1xuY29uc3QgcmUgPSBuZXcgUmVnRXhwKGBfJHtpZH1fKD86KFxcXFxkKyl8KEFUKXwoSEFTSCkpXyhcXFxcdyspP2AsICdnJyk7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCdlc3RyZWUnKS5Db21tZW50fSBDb21tZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuTm9kZX0gTm9kZSAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtOb2RlICYge1xuICogICBzdGFydDogbnVtYmVyO1xuICogICBlbmQ6IG51bWJlcjtcbiAqICAgaGFzX3RyYWlsaW5nX25ld2xpbmU/OiBib29sZWFuXG4gKiB9fSBOb2RlV2l0aExvY2F0aW9uXG4gKi9cblxuLyoqXG4gKiBAdHlwZWRlZiB7Q29tbWVudCAmIHtcbiAqICAgc3RhcnQ6IG51bWJlcjtcbiAqICAgZW5kOiBudW1iZXI7XG4gKiAgIGhhc190cmFpbGluZ19uZXdsaW5lPzogYm9vbGVhblxuICogfX0gQ29tbWVudFdpdGhMb2NhdGlvblxuICovXG5cbi8qKlxuICogQHBhcmFtIHtDb21tZW50V2l0aExvY2F0aW9uW119IGNvbW1lbnRzXG4gKiBAcGFyYW0ge3N0cmluZ30gcmF3XG4gKi9cbmNvbnN0IGdldF9jb21tZW50X2hhbmRsZXJzID0gKGNvbW1lbnRzLCByYXcpID0+ICh7XG5cblx0Ly8gcGFzcyB0byBhY29ybiBvcHRpb25zXG5cdC8qKlxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IGJsb2NrXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZVxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhcnRcblx0ICogQHBhcmFtIHtudW1iZXJ9IGVuZFxuXHQgKi9cblx0b25Db21tZW50OiAoYmxvY2ssIHZhbHVlLCBzdGFydCwgZW5kKSA9PiB7XG5cdFx0aWYgKGJsb2NrICYmIC9cXG4vLnRlc3QodmFsdWUpKSB7XG5cdFx0XHRsZXQgYSA9IHN0YXJ0O1xuXHRcdFx0d2hpbGUgKGEgPiAwICYmIHJhd1thIC0gMV0gIT09ICdcXG4nKSBhIC09IDE7XG5cblx0XHRcdGxldCBiID0gYTtcblx0XHRcdHdoaWxlICgvWyBcXHRdLy50ZXN0KHJhd1tiXSkpIGIgKz0gMTtcblxuXHRcdFx0Y29uc3QgaW5kZW50YXRpb24gPSByYXcuc2xpY2UoYSwgYik7XG5cdFx0XHR2YWx1ZSA9IHZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChgXiR7aW5kZW50YXRpb259YCwgJ2dtJyksICcnKTtcblx0XHR9XG5cblx0XHRjb21tZW50cy5wdXNoKHsgdHlwZTogYmxvY2sgPyAnQmxvY2snIDogJ0xpbmUnLCB2YWx1ZSwgc3RhcnQsIGVuZCB9KTtcblx0fSxcblxuXHQvLyBwYXNzIHRvIGVzdHJlZS13YWxrZXIgb3B0aW9uc1xuXHQvKiogQHBhcmFtIHtOb2RlV2l0aExvY2F0aW9ufSBub2RlICovXG5cdGVudGVyKG5vZGUpIHtcblx0XHRsZXQgY29tbWVudDtcblxuXHRcdHdoaWxlIChjb21tZW50c1swXSAmJiBjb21tZW50c1swXS5zdGFydCA8IG5vZGUuc3RhcnQpIHtcblx0XHRcdGNvbW1lbnQgPSBjb21tZW50cy5zaGlmdCgpO1xuXG5cdFx0XHRjb21tZW50LnZhbHVlID0gY29tbWVudC52YWx1ZS5yZXBsYWNlKHJlLCAobWF0Y2gsIGlkLCBhdCwgaGFzaCwgdmFsdWUpID0+IHtcblx0XHRcdFx0aWYgKGhhc2gpIHJldHVybiBgIyR7dmFsdWV9YDtcblx0XHRcdFx0aWYgKGF0KSByZXR1cm4gYEAke3ZhbHVlfWA7XG5cblx0XHRcdFx0cmV0dXJuIG1hdGNoO1xuXHRcdFx0fSk7XG5cblx0XHRcdGNvbnN0IG5leHQgPSBjb21tZW50c1swXSB8fCBub2RlO1xuXHRcdFx0Y29tbWVudC5oYXNfdHJhaWxpbmdfbmV3bGluZSA9IChcblx0XHRcdFx0Y29tbWVudC50eXBlID09PSAnTGluZScgfHxcblx0XHRcdFx0L1xcbi8udGVzdChyYXcuc2xpY2UoY29tbWVudC5lbmQsIG5leHQuc3RhcnQpKVxuXHRcdFx0KTtcblxuXHRcdFx0KG5vZGUubGVhZGluZ0NvbW1lbnRzIHx8IChub2RlLmxlYWRpbmdDb21tZW50cyA9IFtdKSkucHVzaChjb21tZW50KTtcblx0XHR9XG5cdH0sXG5cblx0LyoqIEBwYXJhbSB7Tm9kZVdpdGhMb2NhdGlvbn0gbm9kZSAqL1xuXHRsZWF2ZShub2RlKSB7XG5cdFx0aWYgKGNvbW1lbnRzWzBdKSB7XG5cdFx0XHRjb25zdCBzbGljZSA9IHJhdy5zbGljZShub2RlLmVuZCwgY29tbWVudHNbMF0uc3RhcnQpO1xuXG5cdFx0XHRpZiAoL15bLCkgXFx0XSokLy50ZXN0KHNsaWNlKSkge1xuXHRcdFx0XHRub2RlLnRyYWlsaW5nQ29tbWVudHMgPSBbY29tbWVudHMuc2hpZnQoKV07XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG59KTtcblxuLy9AdHMtY2hlY2tcbi8qKiBAdHlwZWRlZiB7IGltcG9ydCgnZXN0cmVlJykuTm9kZX0gTm9kZSAqL1xuLyoqIEB0eXBlZGVmIHtOb2RlIHwge1xuICogICB0eXBlOiAnUHJvcGVydHlEZWZpbml0aW9uJztcbiAqICAgY29tcHV0ZWQ6IGJvb2xlYW47XG4gKiAgIHZhbHVlOiBOb2RlXG4gKiB9fSBOb2RlV2l0aFByb3BlcnR5RGVmaW5pdGlvbiAqL1xuXG4vKipcbiAqXG4gKiBAcGFyYW0ge05vZGVXaXRoUHJvcGVydHlEZWZpbml0aW9ufSBub2RlXG4gKiBAcGFyYW0ge05vZGVXaXRoUHJvcGVydHlEZWZpbml0aW9ufSBwYXJlbnRcbiAqIEByZXR1cm5zIGJvb2xlYW5cbiAqL1xuZnVuY3Rpb24gaXNfcmVmZXJlbmNlIChub2RlLCBwYXJlbnQpIHtcblx0aWYgKG5vZGUudHlwZSA9PT0gJ01lbWJlckV4cHJlc3Npb24nKSB7XG5cdFx0cmV0dXJuICFub2RlLmNvbXB1dGVkICYmIGlzX3JlZmVyZW5jZShub2RlLm9iamVjdCwgbm9kZSk7XG5cdH1cblxuXHRpZiAobm9kZS50eXBlID09PSAnSWRlbnRpZmllcicpIHtcblx0XHRpZiAoIXBhcmVudCkgcmV0dXJuIHRydWU7XG5cblx0XHRzd2l0Y2ggKHBhcmVudC50eXBlKSB7XG5cdFx0XHQvLyBkaXNyZWdhcmQgYGJhcmAgaW4gYGZvby5iYXJgXG5cdFx0XHRjYXNlICdNZW1iZXJFeHByZXNzaW9uJzogcmV0dXJuIHBhcmVudC5jb21wdXRlZCB8fCBub2RlID09PSBwYXJlbnQub2JqZWN0O1xuXG5cdFx0XHQvLyBkaXNyZWdhcmQgdGhlIGBmb29gIGluIGBjbGFzcyB7Zm9vKCl7fX1gIGJ1dCBrZWVwIGl0IGluIGBjbGFzcyB7W2Zvb10oKXt9fWBcblx0XHRcdGNhc2UgJ01ldGhvZERlZmluaXRpb24nOiByZXR1cm4gcGFyZW50LmNvbXB1dGVkO1xuXG5cdFx0XHQvLyBkaXNyZWdhcmQgdGhlIGBmb29gIGluIGBjbGFzcyB7Zm9vPWJhcn1gIGJ1dCBrZWVwIGl0IGluIGBjbGFzcyB7W2Zvb109YmFyfWAgYW5kIGBjbGFzcyB7YmFyPWZvb31gXG5cdFx0XHRjYXNlICdQcm9wZXJ0eURlZmluaXRpb24nOiByZXR1cm4gcGFyZW50LmNvbXB1dGVkIHx8IG5vZGUgPT09IHBhcmVudC52YWx1ZTtcblxuXHRcdFx0Ly8gZGlzcmVnYXJkIHRoZSBgYmFyYCBpbiBgeyBiYXI6IGZvbyB9YCwgYnV0IGtlZXAgaXQgaW4gYHsgW2Jhcl06IGZvbyB9YFxuXHRcdFx0Y2FzZSAnUHJvcGVydHknOiByZXR1cm4gcGFyZW50LmNvbXB1dGVkIHx8IG5vZGUgPT09IHBhcmVudC52YWx1ZTtcblxuXHRcdFx0Ly8gZGlzcmVnYXJkIHRoZSBgYmFyYCBpbiBgZXhwb3J0IHsgZm9vIGFzIGJhciB9YCBvclxuXHRcdFx0Ly8gdGhlIGZvbyBpbiBgaW1wb3J0IHsgZm9vIGFzIGJhciB9YFxuXHRcdFx0Y2FzZSAnRXhwb3J0U3BlY2lmaWVyJzpcblx0XHRcdGNhc2UgJ0ltcG9ydFNwZWNpZmllcic6IHJldHVybiBub2RlID09PSBwYXJlbnQubG9jYWw7XG5cblx0XHRcdC8vIGRpc3JlZ2FyZCB0aGUgYGZvb2AgaW4gYGZvbzogd2hpbGUgKC4uLikgeyAuLi4gYnJlYWsgZm9vOyAuLi4gY29udGludWUgZm9vO31gXG5cdFx0XHRjYXNlICdMYWJlbGVkU3RhdGVtZW50Jzpcblx0XHRcdGNhc2UgJ0JyZWFrU3RhdGVtZW50Jzpcblx0XHRcdGNhc2UgJ0NvbnRpbnVlU3RhdGVtZW50JzogcmV0dXJuIGZhbHNlO1xuXHRcdFx0ZGVmYXVsdDogcmV0dXJuIHRydWU7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGZhbHNlO1xufVxuXG4vKiogQHBhcmFtIHtpbXBvcnQoJ2VzdHJlZScpLk5vZGV9IGV4cHJlc3Npb24gKi9cbmZ1bmN0aW9uIGFuYWx5emUoZXhwcmVzc2lvbikge1xuXHQvKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuTm9kZX0gTm9kZSAqL1xuXG5cdC8qKiBAdHlwZSB7V2Vha01hcDxOb2RlLCBTY29wZT59ICovXG5cdGNvbnN0IG1hcCA9IG5ldyBXZWFrTWFwKCk7XG5cblx0LyoqIEB0eXBlIHtNYXA8c3RyaW5nLCBOb2RlPn0gKi9cblx0Y29uc3QgZ2xvYmFscyA9IG5ldyBNYXAoKTtcblxuXHRjb25zdCBzY29wZSA9IG5ldyBTY29wZSQxKG51bGwsIGZhbHNlKTtcblxuXHQvKiogQHR5cGUge1tTY29wZSwgaW1wb3J0KCdlc3RyZWUnKS5JZGVudGlmaWVyXVtdfSAqL1xuXHRjb25zdCByZWZlcmVuY2VzID0gW107XG5cdGxldCBjdXJyZW50X3Njb3BlID0gc2NvcGU7XG5cblx0d2FsayhleHByZXNzaW9uLCB7XG5cdFx0LyoqXG5cdFx0ICogQHBhcmFtIHtOb2RlfSBub2RlXG5cdFx0ICogQHBhcmFtIHthbnl9IHBhcmVudFxuXHRcdCAqL1xuXHRcdGVudGVyKG5vZGUsIHBhcmVudCkge1xuXHRcdFx0c3dpdGNoIChub2RlLnR5cGUpIHtcblx0XHRcdFx0Y2FzZSAnSWRlbnRpZmllcic6XG5cdFx0XHRcdFx0aWYgKGlzX3JlZmVyZW5jZShub2RlLCBwYXJlbnQpKSB7XG5cdFx0XHRcdFx0XHRyZWZlcmVuY2VzLnB1c2goW2N1cnJlbnRfc2NvcGUsIG5vZGVdKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSAnSW1wb3J0RGVjbGFyYXRpb24nOlxuXHRcdFx0XHRcdG5vZGUuc3BlY2lmaWVycy5mb3JFYWNoKChzcGVjaWZpZXIpID0+IHtcblx0XHRcdFx0XHRcdGN1cnJlbnRfc2NvcGUuZGVjbGFyYXRpb25zLnNldChzcGVjaWZpZXIubG9jYWwubmFtZSwgc3BlY2lmaWVyKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlICdGdW5jdGlvbkV4cHJlc3Npb24nOlxuXHRcdFx0XHRjYXNlICdGdW5jdGlvbkRlY2xhcmF0aW9uJzpcblx0XHRcdFx0Y2FzZSAnQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24nOlxuXHRcdFx0XHRcdGlmIChub2RlLnR5cGUgPT09ICdGdW5jdGlvbkRlY2xhcmF0aW9uJykge1xuXHRcdFx0XHRcdFx0aWYgKG5vZGUuaWQpIHtcblx0XHRcdFx0XHRcdFx0Y3VycmVudF9zY29wZS5kZWNsYXJhdGlvbnMuc2V0KG5vZGUuaWQubmFtZSwgbm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdG1hcC5zZXQobm9kZSwgY3VycmVudF9zY29wZSA9IG5ldyBTY29wZSQxKGN1cnJlbnRfc2NvcGUsIGZhbHNlKSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG1hcC5zZXQobm9kZSwgY3VycmVudF9zY29wZSA9IG5ldyBTY29wZSQxKGN1cnJlbnRfc2NvcGUsIGZhbHNlKSk7XG5cblx0XHRcdFx0XHRcdGlmIChub2RlLnR5cGUgPT09ICdGdW5jdGlvbkV4cHJlc3Npb24nICYmIG5vZGUuaWQpIHtcblx0XHRcdFx0XHRcdFx0Y3VycmVudF9zY29wZS5kZWNsYXJhdGlvbnMuc2V0KG5vZGUuaWQubmFtZSwgbm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bm9kZS5wYXJhbXMuZm9yRWFjaChwYXJhbSA9PiB7XG5cdFx0XHRcdFx0XHRleHRyYWN0X25hbWVzKHBhcmFtKS5mb3JFYWNoKG5hbWUgPT4ge1xuXHRcdFx0XHRcdFx0XHRjdXJyZW50X3Njb3BlLmRlY2xhcmF0aW9ucy5zZXQobmFtZSwgbm9kZSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlICdGb3JTdGF0ZW1lbnQnOlxuXHRcdFx0XHRjYXNlICdGb3JJblN0YXRlbWVudCc6XG5cdFx0XHRcdGNhc2UgJ0Zvck9mU3RhdGVtZW50Jzpcblx0XHRcdFx0XHRtYXAuc2V0KG5vZGUsIGN1cnJlbnRfc2NvcGUgPSBuZXcgU2NvcGUkMShjdXJyZW50X3Njb3BlLCB0cnVlKSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSAnQmxvY2tTdGF0ZW1lbnQnOlxuXHRcdFx0XHRcdG1hcC5zZXQobm9kZSwgY3VycmVudF9zY29wZSA9IG5ldyBTY29wZSQxKGN1cnJlbnRfc2NvcGUsIHRydWUpKTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlICdDbGFzc0RlY2xhcmF0aW9uJzpcblx0XHRcdFx0Y2FzZSAnVmFyaWFibGVEZWNsYXJhdGlvbic6XG5cdFx0XHRcdFx0Y3VycmVudF9zY29wZS5hZGRfZGVjbGFyYXRpb24obm9kZSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSAnQ2F0Y2hDbGF1c2UnOlxuXHRcdFx0XHRcdG1hcC5zZXQobm9kZSwgY3VycmVudF9zY29wZSA9IG5ldyBTY29wZSQxKGN1cnJlbnRfc2NvcGUsIHRydWUpKTtcblxuXHRcdFx0XHRcdGlmIChub2RlLnBhcmFtKSB7XG5cdFx0XHRcdFx0XHRleHRyYWN0X25hbWVzKG5vZGUucGFyYW0pLmZvckVhY2gobmFtZSA9PiB7XG5cdFx0XHRcdFx0XHRcdGN1cnJlbnRfc2NvcGUuZGVjbGFyYXRpb25zLnNldChuYW1lLCBub2RlLnBhcmFtKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqIEBwYXJhbSB7Tm9kZX0gbm9kZSAqL1xuXHRcdGxlYXZlKG5vZGUpIHtcblx0XHRcdGlmIChtYXAuaGFzKG5vZGUpKSB7XG5cdFx0XHRcdGN1cnJlbnRfc2NvcGUgPSBjdXJyZW50X3Njb3BlLnBhcmVudDtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdGZvciAobGV0IGkgPSByZWZlcmVuY2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG5cdFx0Y29uc3QgW3Njb3BlLCByZWZlcmVuY2VdID0gcmVmZXJlbmNlc1tpXTtcblxuXHRcdGlmICghc2NvcGUucmVmZXJlbmNlcy5oYXMocmVmZXJlbmNlLm5hbWUpKSB7XG5cdFx0XHRhZGRfcmVmZXJlbmNlKHNjb3BlLCByZWZlcmVuY2UubmFtZSk7XG5cdFx0fVxuXHRcdGlmICghc2NvcGUuZmluZF9vd25lcihyZWZlcmVuY2UubmFtZSkpIHtcblx0XHRcdGdsb2JhbHMuc2V0KHJlZmVyZW5jZS5uYW1lLCByZWZlcmVuY2UpO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiB7IG1hcCwgc2NvcGUsIGdsb2JhbHMgfTtcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIHtTY29wZX0gc2NvcGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gKi9cbmZ1bmN0aW9uIGFkZF9yZWZlcmVuY2Uoc2NvcGUsIG5hbWUpIHtcblx0c2NvcGUucmVmZXJlbmNlcy5hZGQobmFtZSk7XG5cdGlmIChzY29wZS5wYXJlbnQpIGFkZF9yZWZlcmVuY2Uoc2NvcGUucGFyZW50LCBuYW1lKTtcbn1cblxuY2xhc3MgU2NvcGUkMSB7XG5cdGNvbnN0cnVjdG9yKHBhcmVudCwgYmxvY2spIHtcblx0XHQvKiogQHR5cGUge1Njb3BlIHwgbnVsbH0gKi9cblx0XHR0aGlzLnBhcmVudCA9IHBhcmVudDtcblxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cblx0XHR0aGlzLmJsb2NrID0gYmxvY2s7XG5cblx0XHQvKiogQHR5cGUge01hcDxzdHJpbmcsIGltcG9ydCgnZXN0cmVlJykuTm9kZT59ICovXG5cdFx0dGhpcy5kZWNsYXJhdGlvbnMgPSBuZXcgTWFwKCk7XG5cblx0XHQvKiogQHR5cGUge1NldDxzdHJpbmc+fSAqL1xuXHRcdHRoaXMuaW5pdGlhbGlzZWRfZGVjbGFyYXRpb25zID0gbmV3IFNldCgpO1xuXG5cdFx0LyoqIEB0eXBlIHtTZXQ8c3RyaW5nPn0gKi9cblx0XHR0aGlzLnJlZmVyZW5jZXMgPSBuZXcgU2V0KCk7XG5cdH1cblxuXHQvKiogQHBhcmFtIHtpbXBvcnQoJ2VzdHJlZScpLlZhcmlhYmxlRGVjbGFyYXRpb24gfCBpbXBvcnQoJ2VzdHJlZScpLkNsYXNzRGVjbGFyYXRpb259IG5vZGUgKi9cblx0YWRkX2RlY2xhcmF0aW9uKG5vZGUpIHtcblx0XHRpZiAobm9kZS50eXBlID09PSAnVmFyaWFibGVEZWNsYXJhdGlvbicpIHtcblx0XHRcdGlmIChub2RlLmtpbmQgPT09ICd2YXInICYmIHRoaXMuYmxvY2sgJiYgdGhpcy5wYXJlbnQpIHtcblx0XHRcdFx0dGhpcy5wYXJlbnQuYWRkX2RlY2xhcmF0aW9uKG5vZGUpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0LyoqIEBwYXJhbSB7aW1wb3J0KCdlc3RyZWUnKS5WYXJpYWJsZURlY2xhcmF0b3J9IGRlY2xhcmF0b3IgKi9cblx0XHRcdFx0Y29uc3QgaGFuZGxlX2RlY2xhcmF0b3IgPSAoZGVjbGFyYXRvcikgPT4ge1xuXHRcdFx0XHRcdGV4dHJhY3RfbmFtZXMoZGVjbGFyYXRvci5pZCkuZm9yRWFjaChuYW1lID0+IHtcblx0XHRcdFx0XHRcdHRoaXMuZGVjbGFyYXRpb25zLnNldChuYW1lLCBub2RlKTtcblx0XHRcdFx0XHRcdGlmIChkZWNsYXJhdG9yLmluaXQpIHRoaXMuaW5pdGlhbGlzZWRfZGVjbGFyYXRpb25zLmFkZChuYW1lKTtcblx0XHRcdFx0XHR9KTtcdFx0XHRcdH07XG5cblx0XHRcdFx0bm9kZS5kZWNsYXJhdGlvbnMuZm9yRWFjaChoYW5kbGVfZGVjbGFyYXRvcik7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIGlmIChub2RlLmlkKSB7XG5cdFx0XHR0aGlzLmRlY2xhcmF0aW9ucy5zZXQobm9kZS5pZC5uYW1lLCBub2RlKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcblx0ICogQHJldHVybnMge1Njb3BlIHwgbnVsbH1cblx0ICovXG5cdGZpbmRfb3duZXIobmFtZSkge1xuXHRcdGlmICh0aGlzLmRlY2xhcmF0aW9ucy5oYXMobmFtZSkpIHJldHVybiB0aGlzO1xuXHRcdHJldHVybiB0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5maW5kX293bmVyKG5hbWUpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxuXHQgKi9cblx0aGFzKG5hbWUpIHtcblx0XHRyZXR1cm4gKFxuXHRcdFx0dGhpcy5kZWNsYXJhdGlvbnMuaGFzKG5hbWUpIHx8ICghIXRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50LmhhcyhuYW1lKSlcblx0XHQpO1xuXHR9XG59XG5cbi8qKlxuICogQHBhcmFtIHtpbXBvcnQoJ2VzdHJlZScpLk5vZGV9IHBhcmFtXG4gKiBAcmV0dXJucyB7c3RyaW5nW119XG4gKi9cbmZ1bmN0aW9uIGV4dHJhY3RfbmFtZXMocGFyYW0pIHtcblx0cmV0dXJuIGV4dHJhY3RfaWRlbnRpZmllcnMocGFyYW0pLm1hcChub2RlID0+IG5vZGUubmFtZSk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtpbXBvcnQoJ2VzdHJlZScpLk5vZGV9IHBhcmFtXG4gKiBAcGFyYW0ge2ltcG9ydCgnZXN0cmVlJykuSWRlbnRpZmllcltdfSBub2Rlc1xuICogQHJldHVybnMge2ltcG9ydCgnZXN0cmVlJykuSWRlbnRpZmllcltdfVxuICovXG5mdW5jdGlvbiBleHRyYWN0X2lkZW50aWZpZXJzKHBhcmFtLCBub2RlcyA9IFtdKSB7XG5cdHN3aXRjaCAocGFyYW0udHlwZSkge1xuXHRcdGNhc2UgJ0lkZW50aWZpZXInOlxuXHRcdFx0bm9kZXMucHVzaChwYXJhbSk7XG5cdFx0XHRicmVhaztcblxuXHRcdGNhc2UgJ01lbWJlckV4cHJlc3Npb24nOlxuXHRcdFx0bGV0IG9iamVjdCA9IHBhcmFtO1xuXHRcdFx0d2hpbGUgKG9iamVjdC50eXBlID09PSAnTWVtYmVyRXhwcmVzc2lvbicpIHtcblx0XHRcdFx0b2JqZWN0ID0gLyoqIEB0eXBlIHthbnl9ICovIChvYmplY3Qub2JqZWN0KTtcblx0XHRcdH1cblx0XHRcdG5vZGVzLnB1c2goLyoqIEB0eXBlIHthbnl9ICovIChvYmplY3QpKTtcblx0XHRcdGJyZWFrO1xuXG5cdFx0Y2FzZSAnT2JqZWN0UGF0dGVybic6XG5cdFx0XHQvKiogQHBhcmFtIHtpbXBvcnQoJ2VzdHJlZScpLlByb3BlcnR5IHwgaW1wb3J0KCdlc3RyZWUnKS5SZXN0RWxlbWVudH0gcHJvcCAqL1xuXHRcdFx0Y29uc3QgaGFuZGxlX3Byb3AgPSAocHJvcCkgPT4ge1xuXHRcdFx0XHRpZiAocHJvcC50eXBlID09PSAnUmVzdEVsZW1lbnQnKSB7XG5cdFx0XHRcdFx0ZXh0cmFjdF9pZGVudGlmaWVycyhwcm9wLmFyZ3VtZW50LCBub2Rlcyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZXh0cmFjdF9pZGVudGlmaWVycyhwcm9wLnZhbHVlLCBub2Rlcyk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cblx0XHRcdHBhcmFtLnByb3BlcnRpZXMuZm9yRWFjaChoYW5kbGVfcHJvcCk7XG5cdFx0XHRicmVhaztcblxuXHRcdGNhc2UgJ0FycmF5UGF0dGVybic6XG5cdFx0XHQvKiogQHBhcmFtIHtpbXBvcnQoJ2VzdHJlZScpLk5vZGV9IGVsZW1lbnQgKi9cblx0XHRcdGNvbnN0IGhhbmRsZV9lbGVtZW50ID0gKGVsZW1lbnQpID0+IHtcblx0XHRcdFx0aWYgKGVsZW1lbnQpIGV4dHJhY3RfaWRlbnRpZmllcnMoZWxlbWVudCwgbm9kZXMpO1xuXHRcdFx0fTtcblxuXHRcdFx0cGFyYW0uZWxlbWVudHMuZm9yRWFjaChoYW5kbGVfZWxlbWVudCk7XG5cdFx0XHRicmVhaztcblxuXHRcdGNhc2UgJ1Jlc3RFbGVtZW50Jzpcblx0XHRcdGV4dHJhY3RfaWRlbnRpZmllcnMocGFyYW0uYXJndW1lbnQsIG5vZGVzKTtcblx0XHRcdGJyZWFrO1xuXG5cdFx0Y2FzZSAnQXNzaWdubWVudFBhdHRlcm4nOlxuXHRcdFx0ZXh0cmFjdF9pZGVudGlmaWVycyhwYXJhbS5sZWZ0LCBub2Rlcyk7XG5cdFx0XHRicmVhaztcblx0fVxuXG5cdHJldHVybiBub2Rlcztcbn1cblxuLy8gaGVhdmlseSBiYXNlZCBvbiBodHRwczovL2dpdGh1Yi5jb20vZGF2aWRib25uZXQvYXN0cmluZ1xuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuQXJyb3dGdW5jdGlvbkV4cHJlc3Npb259IEFycm93RnVuY3Rpb25FeHByZXNzaW9uICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuQmluYXJ5RXhwcmVzc2lvbn0gQmluYXJ5RXhwcmVzc2lvbiAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJ2VzdHJlZScpLkNhbGxFeHByZXNzaW9ufSBDYWxsRXhwcmVzc2lvbiAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJ2VzdHJlZScpLkNvbW1lbnR9IENvbW1lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCdlc3RyZWUnKS5FeHBvcnRTcGVjaWZpZXJ9IEV4cG9ydFNwZWNpZmllciAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJ2VzdHJlZScpLkV4cHJlc3Npb259IEV4cHJlc3Npb24gKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCdlc3RyZWUnKS5GdW5jdGlvbkRlY2xhcmF0aW9ufSBGdW5jdGlvbkRlY2xhcmF0aW9uICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuSW1wb3J0RGVjbGFyYXRpb259IEltcG9ydERlY2xhcmF0aW9uICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuSW1wb3J0U3BlY2lmaWVyfSBJbXBvcnRTcGVjaWZpZXIgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCdlc3RyZWUnKS5MaXRlcmFsfSBMaXRlcmFsICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuTG9naWNhbEV4cHJlc3Npb259IExvZ2ljYWxFeHByZXNzaW9uICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuTmV3RXhwcmVzc2lvbn0gTmV3RXhwcmVzc2lvbiAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJ2VzdHJlZScpLk5vZGV9IE5vZGUgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCdlc3RyZWUnKS5PYmplY3RFeHByZXNzaW9ufSBPYmplY3RFeHByZXNzaW9uICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuUGF0dGVybn0gUGF0dGVybiAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJ2VzdHJlZScpLlNlcXVlbmNlRXhwcmVzc2lvbn0gU2VxdWVuY2VFeHByZXNzaW9uICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuU2ltcGxlQ2FsbEV4cHJlc3Npb259IFNpbXBsZUNhbGxFeHByZXNzaW9uICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuU3dpdGNoU3RhdGVtZW50fSBTd2l0Y2hTdGF0ZW1lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCdlc3RyZWUnKS5WYXJpYWJsZURlY2xhcmF0aW9ufSBWYXJpYWJsZURlY2xhcmF0aW9uICovXG5cbi8qKlxuICogQHR5cGVkZWYge3tcbiAqICAgY29udGVudDogc3RyaW5nO1xuICogICBsb2M/OiB7XG4gKiAgICAgc3RhcnQ6IHsgbGluZTogbnVtYmVyOyBjb2x1bW46IG51bWJlcjsgfTtcbiAqICAgICBlbmQ6IHsgbGluZTogbnVtYmVyOyBjb2x1bW46IG51bWJlcjsgfTtcbiAqICAgfTtcbiAqICAgaGFzX25ld2xpbmU6IGJvb2xlYW47XG4gKiB9fSBDaHVua1xuICovXG5cbi8qKlxuICogQHR5cGVkZWYgeyhub2RlOiBhbnksIHN0YXRlOiBTdGF0ZSkgPT4gQ2h1bmtbXX0gSGFuZGxlclxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge3tcbiAqICAgaW5kZW50OiBzdHJpbmc7XG4gKiAgIHNjb3BlOiBhbnk7IC8vIFRPRE8gaW1wb3J0IGZyb20gcGVyaXNjb3BpY1xuICogICBzY29wZV9tYXA6IFdlYWtNYXA8Tm9kZSwgYW55PjtcbiAqICAgZ2V0TmFtZTogKG5hbWU6IHN0cmluZykgPT4gc3RyaW5nO1xuICogICBkZWNvbmZsaWN0ZWQ6IFdlYWtNYXA8Tm9kZSwgTWFwPHN0cmluZywgc3RyaW5nPj47XG4gKiAgIGNvbW1lbnRzOiBDb21tZW50W107XG4gKiB9fSBTdGF0ZVxuICovXG5cbi8qKlxuICogQHBhcmFtIHtOb2RlfSBub2RlXG4gKiBAcGFyYW0ge1N0YXRlfSBzdGF0ZVxuICogQHJldHVybnMge0NodW5rW119XG4gKi9cbmZ1bmN0aW9uIGhhbmRsZShub2RlLCBzdGF0ZSkge1xuXHRjb25zdCBoYW5kbGVyID0gaGFuZGxlcnNbbm9kZS50eXBlXTtcblxuXHRpZiAoIWhhbmRsZXIpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYE5vdCBpbXBsZW1lbnRlZCAke25vZGUudHlwZX1gKTtcblx0fVxuXG5cdGNvbnN0IHJlc3VsdCA9IGhhbmRsZXIobm9kZSwgc3RhdGUpO1xuXG5cdGlmIChub2RlLmxlYWRpbmdDb21tZW50cykge1xuXHRcdHJlc3VsdC51bnNoaWZ0KGMobm9kZS5sZWFkaW5nQ29tbWVudHMubWFwKGNvbW1lbnQgPT4gY29tbWVudC50eXBlID09PSAnQmxvY2snXG5cdFx0XHQ/IGAvKiR7Y29tbWVudC52YWx1ZX0qLyR7LyoqIEB0eXBlIHthbnl9ICovIChjb21tZW50KS5oYXNfdHJhaWxpbmdfbmV3bGluZSA/IGBcXG4ke3N0YXRlLmluZGVudH1gIDogYCBgfWBcblx0XHRcdDogYC8vJHtjb21tZW50LnZhbHVlfSR7LyoqIEB0eXBlIHthbnl9ICovIChjb21tZW50KS5oYXNfdHJhaWxpbmdfbmV3bGluZSA/IGBcXG4ke3N0YXRlLmluZGVudH1gIDogYCBgfWApLmpvaW4oYGApKSk7XG5cdH1cblxuXHRpZiAobm9kZS50cmFpbGluZ0NvbW1lbnRzKSB7XG5cdFx0c3RhdGUuY29tbWVudHMucHVzaChub2RlLnRyYWlsaW5nQ29tbWVudHNbMF0pOyAvLyB0aGVyZSBpcyBvbmx5IGV2ZXIgb25lXG5cdH1cblxuXHRyZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50XG4gKiBAcGFyYW0ge05vZGV9IFtub2RlXVxuICogQHJldHVybnMge0NodW5rfVxuICovXG5mdW5jdGlvbiBjKGNvbnRlbnQsIG5vZGUpIHtcblx0cmV0dXJuIHtcblx0XHRjb250ZW50LFxuXHRcdGxvYzogbm9kZSAmJiBub2RlLmxvYyxcblx0XHRoYXNfbmV3bGluZTogL1xcbi8udGVzdChjb250ZW50KVxuXHR9O1xufVxuXG5jb25zdCBPUEVSQVRPUl9QUkVDRURFTkNFID0ge1xuXHQnfHwnOiAyLFxuXHQnJiYnOiAzLFxuXHQnPz8nOiA0LFxuXHQnfCc6IDUsXG5cdCdeJzogNixcblx0JyYnOiA3LFxuXHQnPT0nOiA4LFxuXHQnIT0nOiA4LFxuXHQnPT09JzogOCxcblx0JyE9PSc6IDgsXG5cdCc8JzogOSxcblx0Jz4nOiA5LFxuXHQnPD0nOiA5LFxuXHQnPj0nOiA5LFxuXHRpbjogOSxcblx0aW5zdGFuY2VvZjogOSxcblx0Jzw8JzogMTAsXG5cdCc+Pic6IDEwLFxuXHQnPj4+JzogMTAsXG5cdCcrJzogMTEsXG5cdCctJzogMTEsXG5cdCcqJzogMTIsXG5cdCclJzogMTIsXG5cdCcvJzogMTIsXG5cdCcqKic6IDEzLFxufTtcblxuLyoqIEB0eXBlIHtSZWNvcmQ8c3RyaW5nLCBudW1iZXI+fSAqL1xuY29uc3QgRVhQUkVTU0lPTlNfUFJFQ0VERU5DRSA9IHtcblx0QXJyYXlFeHByZXNzaW9uOiAyMCxcblx0VGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uOiAyMCxcblx0VGhpc0V4cHJlc3Npb246IDIwLFxuXHRJZGVudGlmaWVyOiAyMCxcblx0TGl0ZXJhbDogMTgsXG5cdFRlbXBsYXRlTGl0ZXJhbDogMjAsXG5cdFN1cGVyOiAyMCxcblx0U2VxdWVuY2VFeHByZXNzaW9uOiAyMCxcblx0TWVtYmVyRXhwcmVzc2lvbjogMTksXG5cdENhbGxFeHByZXNzaW9uOiAxOSxcblx0TmV3RXhwcmVzc2lvbjogMTksXG5cdEF3YWl0RXhwcmVzc2lvbjogMTcsXG5cdENsYXNzRXhwcmVzc2lvbjogMTcsXG5cdEZ1bmN0aW9uRXhwcmVzc2lvbjogMTcsXG5cdE9iamVjdEV4cHJlc3Npb246IDE3LFxuXHRVcGRhdGVFeHByZXNzaW9uOiAxNixcblx0VW5hcnlFeHByZXNzaW9uOiAxNSxcblx0QmluYXJ5RXhwcmVzc2lvbjogMTQsXG5cdExvZ2ljYWxFeHByZXNzaW9uOiAxMyxcblx0Q29uZGl0aW9uYWxFeHByZXNzaW9uOiA0LFxuXHRBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbjogMyxcblx0QXNzaWdubWVudEV4cHJlc3Npb246IDMsXG5cdFlpZWxkRXhwcmVzc2lvbjogMixcblx0UmVzdEVsZW1lbnQ6IDFcbn07XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7RXhwcmVzc2lvbn0gbm9kZVxuICogQHBhcmFtIHtCaW5hcnlFeHByZXNzaW9uIHwgTG9naWNhbEV4cHJlc3Npb259IHBhcmVudFxuICogQHBhcmFtIHtib29sZWFufSBpc19yaWdodFxuICogQHJldHVybnNcbiAqL1xuZnVuY3Rpb24gbmVlZHNfcGFyZW5zKG5vZGUsIHBhcmVudCwgaXNfcmlnaHQpIHtcblx0Ly8gc3BlY2lhbCBjYXNlIHdoZXJlIGxvZ2ljYWwgZXhwcmVzc2lvbnMgYW5kIGNvYWxlc2NlIGV4cHJlc3Npb25zIGNhbm5vdCBiZSBtaXhlZCxcblx0Ly8gZWl0aGVyIG9mIHRoZW0gbmVlZCB0byBiZSB3cmFwcGVkIHdpdGggcGFyZW50aGVzZXNcblx0aWYgKFxuXHRcdG5vZGUudHlwZSA9PT0gJ0xvZ2ljYWxFeHByZXNzaW9uJyAmJlxuXHRcdHBhcmVudC50eXBlID09PSAnTG9naWNhbEV4cHJlc3Npb24nICYmXG5cdFx0KChwYXJlbnQub3BlcmF0b3IgPT09ICc/PycgJiYgbm9kZS5vcGVyYXRvciAhPT0gJz8/JykgfHxcblx0XHRcdChwYXJlbnQub3BlcmF0b3IgIT09ICc/PycgJiYgbm9kZS5vcGVyYXRvciA9PT0gJz8/JykpXG5cdCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0Y29uc3QgcHJlY2VkZW5jZSA9IEVYUFJFU1NJT05TX1BSRUNFREVOQ0Vbbm9kZS50eXBlXTtcblx0Y29uc3QgcGFyZW50X3ByZWNlZGVuY2UgPSBFWFBSRVNTSU9OU19QUkVDRURFTkNFW3BhcmVudC50eXBlXTtcblxuXHRpZiAocHJlY2VkZW5jZSAhPT0gcGFyZW50X3ByZWNlZGVuY2UpIHtcblx0XHQvLyBEaWZmZXJlbnQgbm9kZSB0eXBlc1xuXHRcdHJldHVybiAoXG5cdFx0XHQoIWlzX3JpZ2h0ICYmXG5cdFx0XHRcdHByZWNlZGVuY2UgPT09IDE1ICYmXG5cdFx0XHRcdHBhcmVudF9wcmVjZWRlbmNlID09PSAxNCAmJlxuXHRcdFx0XHRwYXJlbnQub3BlcmF0b3IgPT09ICcqKicpIHx8XG5cdFx0XHRwcmVjZWRlbmNlIDwgcGFyZW50X3ByZWNlZGVuY2Vcblx0XHQpO1xuXHR9XG5cblx0aWYgKHByZWNlZGVuY2UgIT09IDEzICYmIHByZWNlZGVuY2UgIT09IDE0KSB7XG5cdFx0Ly8gTm90IGEgYExvZ2ljYWxFeHByZXNzaW9uYCBvciBgQmluYXJ5RXhwcmVzc2lvbmBcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRpZiAoLyoqIEB0eXBlIHtCaW5hcnlFeHByZXNzaW9ufSAqLyAobm9kZSkub3BlcmF0b3IgPT09ICcqKicgJiYgcGFyZW50Lm9wZXJhdG9yID09PSAnKionKSB7XG5cdFx0Ly8gRXhwb25lbnRpYXRpb24gb3BlcmF0b3IgaGFzIHJpZ2h0LXRvLWxlZnQgYXNzb2NpYXRpdml0eVxuXHRcdHJldHVybiAhaXNfcmlnaHQ7XG5cdH1cblxuXHRpZiAoaXNfcmlnaHQpIHtcblx0XHQvLyBQYXJlbnRoZXNpcyBhcmUgdXNlZCBpZiBib3RoIG9wZXJhdG9ycyBoYXZlIHRoZSBzYW1lIHByZWNlZGVuY2Vcblx0XHRyZXR1cm4gKFxuXHRcdFx0T1BFUkFUT1JfUFJFQ0VERU5DRVsvKiogQHR5cGUge0JpbmFyeUV4cHJlc3Npb259ICovIChub2RlKS5vcGVyYXRvcl0gPD1cblx0XHRcdE9QRVJBVE9SX1BSRUNFREVOQ0VbcGFyZW50Lm9wZXJhdG9yXVxuXHRcdCk7XG5cdH1cblxuXHRyZXR1cm4gKFxuXHRcdE9QRVJBVE9SX1BSRUNFREVOQ0VbLyoqIEB0eXBlIHtCaW5hcnlFeHByZXNzaW9ufSAqLyAobm9kZSkub3BlcmF0b3JdIDxcblx0XHRPUEVSQVRPUl9QUkVDRURFTkNFW3BhcmVudC5vcGVyYXRvcl1cblx0KTtcbn1cblxuLyoqIEBwYXJhbSB7Tm9kZX0gbm9kZSAqL1xuZnVuY3Rpb24gaGFzX2NhbGxfZXhwcmVzc2lvbihub2RlKSB7XG5cdHdoaWxlIChub2RlKSB7XG5cdFx0aWYgKG5vZGUudHlwZVswXSA9PT0gJ0NhbGxFeHByZXNzaW9uJykge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdNZW1iZXJFeHByZXNzaW9uJykge1xuXHRcdFx0bm9kZSA9IG5vZGUub2JqZWN0O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG59XG5cbi8qKiBAcGFyYW0ge0NodW5rW119IGNodW5rcyAqL1xuY29uc3QgaGFzX25ld2xpbmUgPSAoY2h1bmtzKSA9PiB7XG5cdGZvciAobGV0IGkgPSAwOyBpIDwgY2h1bmtzLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0aWYgKGNodW5rc1tpXS5oYXNfbmV3bGluZSkgcmV0dXJuIHRydWU7XG5cdH1cblx0cmV0dXJuIGZhbHNlO1xufTtcblxuLyoqIEBwYXJhbSB7Q2h1bmtbXX0gY2h1bmtzICovXG5jb25zdCBnZXRfbGVuZ3RoID0gKGNodW5rcykgPT4ge1xuXHRsZXQgdG90YWwgPSAwO1xuXHRmb3IgKGxldCBpID0gMDsgaSA8IGNodW5rcy5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdHRvdGFsICs9IGNodW5rc1tpXS5jb250ZW50Lmxlbmd0aDtcblx0fVxuXHRyZXR1cm4gdG90YWw7XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7bnVtYmVyfSBhXG4gKiBAcGFyYW0ge251bWJlcn0gYlxuICovXG5jb25zdCBzdW0gPSAoYSwgYikgPT4gYSArIGI7XG5cbi8qKlxuICogQHBhcmFtIHtDaHVua1tdW119IG5vZGVzXG4gKiBAcGFyYW0ge0NodW5rfSBzZXBhcmF0b3JcbiAqIEByZXR1cm5zIHtDaHVua1tdfVxuICovXG5jb25zdCBqb2luID0gKG5vZGVzLCBzZXBhcmF0b3IpID0+IHtcblx0aWYgKG5vZGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdO1xuXG5cdGNvbnN0IGpvaW5lZCA9IFsuLi5ub2Rlc1swXV07XG5cdGZvciAobGV0IGkgPSAxOyBpIDwgbm9kZXMubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRqb2luZWQucHVzaChzZXBhcmF0b3IsIC4uLm5vZGVzW2ldKTtcblx0fVxuXHRyZXR1cm4gam9pbmVkO1xufTtcblxuLyoqXG4gKiBAcGFyYW0geyhub2RlOiBhbnksIHN0YXRlOiBTdGF0ZSkgPT4gQ2h1bmtbXX0gZm5cbiAqL1xuY29uc3Qgc2NvcGVkID0gKGZuKSA9PiB7XG5cdC8qKlxuXHQgKiBAcGFyYW0ge2FueX0gbm9kZVxuXHQgKiBAcGFyYW0ge1N0YXRlfSBzdGF0ZVxuXHQgKi9cblx0Y29uc3Qgc2NvcGVkX2ZuID0gKG5vZGUsIHN0YXRlKSA9PiB7XG5cdFx0cmV0dXJuIGZuKG5vZGUsIHtcblx0XHRcdC4uLnN0YXRlLFxuXHRcdFx0c2NvcGU6IHN0YXRlLnNjb3BlX21hcC5nZXQobm9kZSlcblx0XHR9KTtcblx0fTtcblxuXHRyZXR1cm4gc2NvcGVkX2ZuO1xufTtcblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICogQHBhcmFtIHtTZXQ8c3RyaW5nPn0gbmFtZXNcbiAqL1xuY29uc3QgZGVjb25mbGljdCA9IChuYW1lLCBuYW1lcykgPT4ge1xuXHRjb25zdCBvcmlnaW5hbCA9IG5hbWU7XG5cdGxldCBpID0gMTtcblxuXHR3aGlsZSAobmFtZXMuaGFzKG5hbWUpKSB7XG5cdFx0bmFtZSA9IGAke29yaWdpbmFsfSQke2krK31gO1xuXHR9XG5cblx0cmV0dXJuIG5hbWU7XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7Tm9kZVtdfSBub2Rlc1xuICogQHBhcmFtIHtTdGF0ZX0gc3RhdGVcbiAqL1xuY29uc3QgaGFuZGxlX2JvZHkgPSAobm9kZXMsIHN0YXRlKSA9PiB7XG5cdGNvbnN0IGNodW5rcyA9IFtdO1xuXG5cdGNvbnN0IGJvZHkgPSBub2Rlcy5tYXAoc3RhdGVtZW50ID0+IHtcblx0XHRjb25zdCBjaHVua3MgPSBoYW5kbGUoc3RhdGVtZW50LCB7XG5cdFx0XHQuLi5zdGF0ZSxcblx0XHRcdGluZGVudDogc3RhdGUuaW5kZW50XG5cdFx0fSk7XG5cblx0XHRsZXQgYWRkX25ld2xpbmUgPSBmYWxzZTtcblxuXHRcdHdoaWxlIChzdGF0ZS5jb21tZW50cy5sZW5ndGgpIHtcblx0XHRcdGNvbnN0IGNvbW1lbnQgPSBzdGF0ZS5jb21tZW50cy5zaGlmdCgpO1xuXHRcdFx0Y29uc3QgcHJlZml4ID0gYWRkX25ld2xpbmUgPyBgXFxuJHtzdGF0ZS5pbmRlbnR9YCA6IGAgYDtcblxuXHRcdFx0Y2h1bmtzLnB1c2goYyhjb21tZW50LnR5cGUgPT09ICdCbG9jaydcblx0XHRcdFx0PyBgJHtwcmVmaXh9Lyoke2NvbW1lbnQudmFsdWV9Ki9gXG5cdFx0XHRcdDogYCR7cHJlZml4fS8vJHtjb21tZW50LnZhbHVlfWApKTtcblxuXHRcdFx0YWRkX25ld2xpbmUgPSAoY29tbWVudC50eXBlID09PSAnTGluZScpO1xuXHRcdH1cblxuXHRcdHJldHVybiBjaHVua3M7XG5cdH0pO1xuXG5cdGxldCBuZWVkZWRfcGFkZGluZyA9IGZhbHNlO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgYm9keS5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdGNvbnN0IG5lZWRzX3BhZGRpbmcgPSBoYXNfbmV3bGluZShib2R5W2ldKTtcblxuXHRcdGlmIChpID4gMCkge1xuXHRcdFx0Y2h1bmtzLnB1c2goXG5cdFx0XHRcdGMobmVlZHNfcGFkZGluZyB8fCBuZWVkZWRfcGFkZGluZyA/IGBcXG5cXG4ke3N0YXRlLmluZGVudH1gIDogYFxcbiR7c3RhdGUuaW5kZW50fWApXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0Li4uYm9keVtpXVxuXHRcdCk7XG5cblx0XHRuZWVkZWRfcGFkZGluZyA9IG5lZWRzX3BhZGRpbmc7XG5cdH1cblxuXHRyZXR1cm4gY2h1bmtzO1xufTtcblxuLyoqXG4gKiBAcGFyYW0ge1ZhcmlhYmxlRGVjbGFyYXRpb259IG5vZGVcbiAqIEBwYXJhbSB7U3RhdGV9IHN0YXRlXG4gKi9cbmNvbnN0IGhhbmRsZV92YXJfZGVjbGFyYXRpb24gPSAobm9kZSwgc3RhdGUpID0+IHtcblx0Y29uc3QgY2h1bmtzID0gW2MoYCR7bm9kZS5raW5kfSBgKV07XG5cblx0Y29uc3QgZGVjbGFyYXRvcnMgPSBub2RlLmRlY2xhcmF0aW9ucy5tYXAoZCA9PiBoYW5kbGUoZCwge1xuXHRcdC4uLnN0YXRlLFxuXHRcdGluZGVudDogc3RhdGUuaW5kZW50ICsgKG5vZGUuZGVjbGFyYXRpb25zLmxlbmd0aCA9PT0gMSA/ICcnIDogJ1xcdCcpXG5cdH0pKTtcblxuXHRjb25zdCBtdWx0aXBsZV9saW5lcyA9IChcblx0XHRkZWNsYXJhdG9ycy5zb21lKGhhc19uZXdsaW5lKSB8fFxuXHRcdChkZWNsYXJhdG9ycy5tYXAoZ2V0X2xlbmd0aCkucmVkdWNlKHN1bSwgMCkgKyAoc3RhdGUuaW5kZW50Lmxlbmd0aCArIGRlY2xhcmF0b3JzLmxlbmd0aCAtIDEpICogMikgPiA4MFxuXHQpO1xuXG5cdGNvbnN0IHNlcGFyYXRvciA9IGMobXVsdGlwbGVfbGluZXMgPyBgLFxcbiR7c3RhdGUuaW5kZW50fVxcdGAgOiAnLCAnKTtcblxuXHRpZiAobXVsdGlwbGVfbGluZXMpIHtcblx0XHRjaHVua3MucHVzaCguLi5qb2luKGRlY2xhcmF0b3JzLCBzZXBhcmF0b3IpKTtcblx0fSBlbHNlIHtcblx0XHRjaHVua3MucHVzaChcblx0XHRcdC4uLmpvaW4oZGVjbGFyYXRvcnMsIHNlcGFyYXRvcilcblx0XHQpO1xuXHR9XG5cblx0cmV0dXJuIGNodW5rcztcbn07XG5cbi8qKiBAdHlwZSB7UmVjb3JkPHN0cmluZywgSGFuZGxlcj59ICovXG5jb25zdCBoYW5kbGVycyA9IHtcblx0UHJvZ3JhbShub2RlLCBzdGF0ZSkge1xuXHRcdHJldHVybiBoYW5kbGVfYm9keShub2RlLmJvZHksIHN0YXRlKTtcblx0fSxcblxuXHRCbG9ja1N0YXRlbWVudDogc2NvcGVkKChub2RlLCBzdGF0ZSkgPT4ge1xuXHRcdHJldHVybiBbXG5cdFx0XHRjKGB7XFxuJHtzdGF0ZS5pbmRlbnR9XFx0YCksXG5cdFx0XHQuLi5oYW5kbGVfYm9keShub2RlLmJvZHksIHsgLi4uc3RhdGUsIGluZGVudDogc3RhdGUuaW5kZW50ICsgJ1xcdCcgfSksXG5cdFx0XHRjKGBcXG4ke3N0YXRlLmluZGVudH19YClcblx0XHRdO1xuXHR9KSxcblxuXHRFbXB0eVN0YXRlbWVudChub2RlLCBzdGF0ZSkge1xuXHRcdHJldHVybiBbYygnOycpXTtcblx0fSxcblxuXHRQYXJlbnRoZXNpemVkRXhwcmVzc2lvbihub2RlLCBzdGF0ZSkge1xuXHRcdHJldHVybiBoYW5kbGUobm9kZS5leHByZXNzaW9uLCBzdGF0ZSk7XG5cdH0sXG5cblx0RXhwcmVzc2lvblN0YXRlbWVudChub2RlLCBzdGF0ZSkge1xuXHRcdGlmIChcblx0XHRcdG5vZGUuZXhwcmVzc2lvbi50eXBlID09PSAnQXNzaWdubWVudEV4cHJlc3Npb24nICYmXG5cdFx0XHRub2RlLmV4cHJlc3Npb24ubGVmdC50eXBlID09PSAnT2JqZWN0UGF0dGVybidcblx0XHQpIHtcblx0XHRcdC8vIGlzIGFuIEFzc2lnbm1lbnRFeHByZXNzaW9uIHRvIGFuIE9iamVjdFBhdHRlcm5cblx0XHRcdHJldHVybiBbXG5cdFx0XHRcdGMoJygnKSxcblx0XHRcdFx0Li4uaGFuZGxlKG5vZGUuZXhwcmVzc2lvbiwgc3RhdGUpLFxuXHRcdFx0XHRjKCcpOycpXG5cdFx0XHRdO1xuXHRcdH1cblxuXHRcdHJldHVybiBbXG5cdFx0XHQuLi5oYW5kbGUobm9kZS5leHByZXNzaW9uLCBzdGF0ZSksXG5cdFx0XHRjKCc7Jylcblx0XHRdO1xuXHR9LFxuXG5cdElmU3RhdGVtZW50KG5vZGUsIHN0YXRlKSB7XG5cdFx0Y29uc3QgY2h1bmtzID0gW1xuXHRcdFx0YygnaWYgKCcpLFxuXHRcdFx0Li4uaGFuZGxlKG5vZGUudGVzdCwgc3RhdGUpLFxuXHRcdFx0YygnKSAnKSxcblx0XHRcdC4uLmhhbmRsZShub2RlLmNvbnNlcXVlbnQsIHN0YXRlKVxuXHRcdF07XG5cblx0XHRpZiAobm9kZS5hbHRlcm5hdGUpIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKCcgZWxzZSAnKSxcblx0XHRcdFx0Li4uaGFuZGxlKG5vZGUuYWx0ZXJuYXRlLCBzdGF0ZSlcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSxcblxuXHRMYWJlbGVkU3RhdGVtZW50KG5vZGUsIHN0YXRlKSB7XG5cdFx0cmV0dXJuIFtcblx0XHRcdC4uLmhhbmRsZShub2RlLmxhYmVsLCBzdGF0ZSksXG5cdFx0XHRjKCc6ICcpLFxuXHRcdFx0Li4uaGFuZGxlKG5vZGUuYm9keSwgc3RhdGUpXG5cdFx0XTtcblx0fSxcblxuXHRCcmVha1N0YXRlbWVudChub2RlLCBzdGF0ZSkge1xuXHRcdHJldHVybiBub2RlLmxhYmVsXG5cdFx0XHQ/IFtjKCdicmVhayAnKSwgLi4uaGFuZGxlKG5vZGUubGFiZWwsIHN0YXRlKSwgYygnOycpXVxuXHRcdFx0OiBbYygnYnJlYWs7JyldO1xuXHR9LFxuXG5cdENvbnRpbnVlU3RhdGVtZW50KG5vZGUsIHN0YXRlKSB7XG5cdFx0cmV0dXJuIG5vZGUubGFiZWxcblx0XHRcdD8gW2MoJ2NvbnRpbnVlICcpLCAuLi5oYW5kbGUobm9kZS5sYWJlbCwgc3RhdGUpLCBjKCc7JyldXG5cdFx0XHQ6IFtjKCdjb250aW51ZTsnKV07XG5cdH0sXG5cblx0V2l0aFN0YXRlbWVudChub2RlLCBzdGF0ZSkge1xuXHRcdHJldHVybiBbXG5cdFx0XHRjKCd3aXRoICgnKSxcblx0XHRcdC4uLmhhbmRsZShub2RlLm9iamVjdCwgc3RhdGUpLFxuXHRcdFx0YygnKSAnKSxcblx0XHRcdC4uLmhhbmRsZShub2RlLmJvZHksIHN0YXRlKVxuXHRcdF07XG5cdH0sXG5cblx0U3dpdGNoU3RhdGVtZW50KC8qKiBAdHlwZSB7U3dpdGNoU3RhdGVtZW50fSAqLyBub2RlLCBzdGF0ZSkge1xuXHRcdGNvbnN0IGNodW5rcyA9IFtcblx0XHRcdGMoJ3N3aXRjaCAoJyksXG5cdFx0XHQuLi5oYW5kbGUobm9kZS5kaXNjcmltaW5hbnQsIHN0YXRlKSxcblx0XHRcdGMoJykgeycpXG5cdFx0XTtcblxuXHRcdG5vZGUuY2FzZXMuZm9yRWFjaChibG9jayA9PiB7XG5cdFx0XHRpZiAoYmxvY2sudGVzdCkge1xuXHRcdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0XHRjKGBcXG4ke3N0YXRlLmluZGVudH1cXHRjYXNlIGApLFxuXHRcdFx0XHRcdC4uLmhhbmRsZShibG9jay50ZXN0LCB7IC4uLnN0YXRlLCBpbmRlbnQ6IGAke3N0YXRlLmluZGVudH1cXHRgIH0pLFxuXHRcdFx0XHRcdGMoJzonKVxuXHRcdFx0XHQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2h1bmtzLnB1c2goYyhgXFxuJHtzdGF0ZS5pbmRlbnR9XFx0ZGVmYXVsdDpgKSk7XG5cdFx0XHR9XG5cblx0XHRcdGJsb2NrLmNvbnNlcXVlbnQuZm9yRWFjaChzdGF0ZW1lbnQgPT4ge1xuXHRcdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0XHRjKGBcXG4ke3N0YXRlLmluZGVudH1cXHRcXHRgKSxcblx0XHRcdFx0XHQuLi5oYW5kbGUoc3RhdGVtZW50LCB7IC4uLnN0YXRlLCBpbmRlbnQ6IGAke3N0YXRlLmluZGVudH1cXHRcXHRgIH0pXG5cdFx0XHRcdCk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblxuXHRcdGNodW5rcy5wdXNoKGMoYFxcbiR7c3RhdGUuaW5kZW50fX1gKSk7XG5cblx0XHRyZXR1cm4gY2h1bmtzO1xuXHR9LFxuXG5cdFJldHVyblN0YXRlbWVudChub2RlLCBzdGF0ZSkge1xuXHRcdGlmIChub2RlLmFyZ3VtZW50KSB7XG5cdFx0XHRjb25zdCBjb250YWluc19jb21tZW50ID0gbm9kZS5hcmd1bWVudC5sZWFkaW5nQ29tbWVudHMgJiYgbm9kZS5hcmd1bWVudC5sZWFkaW5nQ29tbWVudHMuc29tZSgoLyoqIEB0eXBlIGltcG9ydCgnLi4vdXRpbHMvY29tbWVudHMuanMnKS5Db21tZW50V2l0aExvY2F0aW9uICovIGNvbW1lbnQpID0+IGNvbW1lbnQuaGFzX3RyYWlsaW5nX25ld2xpbmUpO1xuXHRcdFx0cmV0dXJuIFtcblx0XHRcdFx0Yyhjb250YWluc19jb21tZW50ID8gJ3JldHVybiAoJyA6ICdyZXR1cm4gJyksXG5cdFx0XHRcdC4uLmhhbmRsZShub2RlLmFyZ3VtZW50LCBzdGF0ZSksXG5cdFx0XHRcdGMoY29udGFpbnNfY29tbWVudCA/ICcpOycgOiAnOycpXG5cdFx0XHRdO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gW2MoJ3JldHVybjsnKV07XG5cdFx0fVxuXHR9LFxuXG5cdFRocm93U3RhdGVtZW50KG5vZGUsIHN0YXRlKSB7XG5cdFx0cmV0dXJuIFtcblx0XHRcdGMoJ3Rocm93ICcpLFxuXHRcdFx0Li4uaGFuZGxlKG5vZGUuYXJndW1lbnQsIHN0YXRlKSxcblx0XHRcdGMoJzsnKVxuXHRcdF07XG5cdH0sXG5cblx0VHJ5U3RhdGVtZW50KG5vZGUsIHN0YXRlKSB7XG5cdFx0Y29uc3QgY2h1bmtzID0gW1xuXHRcdFx0YygndHJ5ICcpLFxuXHRcdFx0Li4uaGFuZGxlKG5vZGUuYmxvY2ssIHN0YXRlKVxuXHRcdF07XG5cblx0XHRpZiAobm9kZS5oYW5kbGVyKSB7XG5cdFx0XHRpZiAobm9kZS5oYW5kbGVyLnBhcmFtKSB7XG5cdFx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRcdGMoJyBjYXRjaCgnKSxcblx0XHRcdFx0XHQuLi5oYW5kbGUobm9kZS5oYW5kbGVyLnBhcmFtLCBzdGF0ZSksXG5cdFx0XHRcdFx0YygnKSAnKVxuXHRcdFx0XHQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2h1bmtzLnB1c2goYygnIGNhdGNoICcpKTtcblx0XHRcdH1cblxuXHRcdFx0Y2h1bmtzLnB1c2goLi4uaGFuZGxlKG5vZGUuaGFuZGxlci5ib2R5LCBzdGF0ZSkpO1xuXHRcdH1cblxuXHRcdGlmIChub2RlLmZpbmFsaXplcikge1xuXHRcdFx0Y2h1bmtzLnB1c2goYygnIGZpbmFsbHkgJyksIC4uLmhhbmRsZShub2RlLmZpbmFsaXplciwgc3RhdGUpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gY2h1bmtzO1xuXHR9LFxuXG5cdFdoaWxlU3RhdGVtZW50KG5vZGUsIHN0YXRlKSB7XG5cdFx0cmV0dXJuIFtcblx0XHRcdGMoJ3doaWxlICgnKSxcblx0XHRcdC4uLmhhbmRsZShub2RlLnRlc3QsIHN0YXRlKSxcblx0XHRcdGMoJykgJyksXG5cdFx0XHQuLi5oYW5kbGUobm9kZS5ib2R5LCBzdGF0ZSlcblx0XHRdO1xuXHR9LFxuXG5cdERvV2hpbGVTdGF0ZW1lbnQobm9kZSwgc3RhdGUpIHtcblx0XHRyZXR1cm4gW1xuXHRcdFx0YygnZG8gJyksXG5cdFx0XHQuLi5oYW5kbGUobm9kZS5ib2R5LCBzdGF0ZSksXG5cdFx0XHRjKCcgd2hpbGUgKCcpLFxuXHRcdFx0Li4uaGFuZGxlKG5vZGUudGVzdCwgc3RhdGUpLFxuXHRcdFx0YygnKTsnKVxuXHRcdF07XG5cdH0sXG5cblx0Rm9yU3RhdGVtZW50OiBzY29wZWQoKG5vZGUsIHN0YXRlKSA9PiB7XG5cdFx0Y29uc3QgY2h1bmtzID0gW2MoJ2ZvciAoJyldO1xuXG5cdFx0aWYgKG5vZGUuaW5pdCkge1xuXHRcdFx0aWYgKG5vZGUuaW5pdC50eXBlID09PSAnVmFyaWFibGVEZWNsYXJhdGlvbicpIHtcblx0XHRcdFx0Y2h1bmtzLnB1c2goLi4uaGFuZGxlX3Zhcl9kZWNsYXJhdGlvbihub2RlLmluaXQsIHN0YXRlKSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjaHVua3MucHVzaCguLi5oYW5kbGUobm9kZS5pbml0LCBzdGF0ZSkpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGNodW5rcy5wdXNoKGMoJzsgJykpO1xuXHRcdGlmIChub2RlLnRlc3QpIGNodW5rcy5wdXNoKC4uLmhhbmRsZShub2RlLnRlc3QsIHN0YXRlKSk7XG5cdFx0Y2h1bmtzLnB1c2goYygnOyAnKSk7XG5cdFx0aWYgKG5vZGUudXBkYXRlKSBjaHVua3MucHVzaCguLi5oYW5kbGUobm9kZS51cGRhdGUsIHN0YXRlKSk7XG5cblx0XHRjaHVua3MucHVzaChcblx0XHRcdGMoJykgJyksXG5cdFx0XHQuLi5oYW5kbGUobm9kZS5ib2R5LCBzdGF0ZSlcblx0XHQpO1xuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSksXG5cblx0Rm9ySW5TdGF0ZW1lbnQ6IHNjb3BlZCgobm9kZSwgc3RhdGUpID0+IHtcblx0XHRjb25zdCBjaHVua3MgPSBbXG5cdFx0XHRjKGBmb3IgJHtub2RlLmF3YWl0ID8gJ2F3YWl0ICcgOiAnJ30oYClcblx0XHRdO1xuXG5cdFx0aWYgKG5vZGUubGVmdC50eXBlID09PSAnVmFyaWFibGVEZWNsYXJhdGlvbicpIHtcblx0XHRcdGNodW5rcy5wdXNoKC4uLmhhbmRsZV92YXJfZGVjbGFyYXRpb24obm9kZS5sZWZ0LCBzdGF0ZSkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjaHVua3MucHVzaCguLi5oYW5kbGUobm9kZS5sZWZ0LCBzdGF0ZSkpO1xuXHRcdH1cblxuXHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0Yyhub2RlLnR5cGUgPT09ICdGb3JJblN0YXRlbWVudCcgPyBgIGluIGAgOiBgIG9mIGApLFxuXHRcdFx0Li4uaGFuZGxlKG5vZGUucmlnaHQsIHN0YXRlKSxcblx0XHRcdGMoJykgJyksXG5cdFx0XHQuLi5oYW5kbGUobm9kZS5ib2R5LCBzdGF0ZSlcblx0XHQpO1xuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSksXG5cblx0RGVidWdnZXJTdGF0ZW1lbnQobm9kZSwgc3RhdGUpIHtcblx0XHRyZXR1cm4gW2MoJ2RlYnVnZ2VyJywgbm9kZSksIGMoJzsnKV07XG5cdH0sXG5cblx0RnVuY3Rpb25EZWNsYXJhdGlvbjogc2NvcGVkKCgvKiogQHR5cGUge0Z1bmN0aW9uRGVjbGFyYXRpb259ICovIG5vZGUsIHN0YXRlKSA9PiB7XG5cdFx0Y29uc3QgY2h1bmtzID0gW107XG5cblx0XHRpZiAobm9kZS5hc3luYykgY2h1bmtzLnB1c2goYygnYXN5bmMgJykpO1xuXHRcdGNodW5rcy5wdXNoKGMobm9kZS5nZW5lcmF0b3IgPyAnZnVuY3Rpb24qICcgOiAnZnVuY3Rpb24gJykpO1xuXHRcdGlmIChub2RlLmlkKSBjaHVua3MucHVzaCguLi5oYW5kbGUobm9kZS5pZCwgc3RhdGUpKTtcblx0XHRjaHVua3MucHVzaChjKCcoJykpO1xuXG5cdFx0Y29uc3QgcGFyYW1zID0gbm9kZS5wYXJhbXMubWFwKHAgPT4gaGFuZGxlKHAsIHtcblx0XHRcdC4uLnN0YXRlLFxuXHRcdFx0aW5kZW50OiBzdGF0ZS5pbmRlbnQgKyAnXFx0J1xuXHRcdH0pKTtcblxuXHRcdGNvbnN0IG11bHRpcGxlX2xpbmVzID0gKFxuXHRcdFx0cGFyYW1zLnNvbWUoaGFzX25ld2xpbmUpIHx8XG5cdFx0XHQocGFyYW1zLm1hcChnZXRfbGVuZ3RoKS5yZWR1Y2Uoc3VtLCAwKSArIChzdGF0ZS5pbmRlbnQubGVuZ3RoICsgcGFyYW1zLmxlbmd0aCAtIDEpICogMikgPiA4MFxuXHRcdCk7XG5cblx0XHRjb25zdCBzZXBhcmF0b3IgPSBjKG11bHRpcGxlX2xpbmVzID8gYCxcXG4ke3N0YXRlLmluZGVudH1gIDogJywgJyk7XG5cblx0XHRpZiAobXVsdGlwbGVfbGluZXMpIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKGBcXG4ke3N0YXRlLmluZGVudH1cXHRgKSxcblx0XHRcdFx0Li4uam9pbihwYXJhbXMsIHNlcGFyYXRvciksXG5cdFx0XHRcdGMoYFxcbiR7c3RhdGUuaW5kZW50fWApXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0Li4uam9pbihwYXJhbXMsIHNlcGFyYXRvcilcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y2h1bmtzLnB1c2goXG5cdFx0XHRjKCcpICcpLFxuXHRcdFx0Li4uaGFuZGxlKG5vZGUuYm9keSwgc3RhdGUpXG5cdFx0KTtcblxuXHRcdHJldHVybiBjaHVua3M7XG5cdH0pLFxuXG5cdFZhcmlhYmxlRGVjbGFyYXRpb24obm9kZSwgc3RhdGUpIHtcblx0XHRyZXR1cm4gaGFuZGxlX3Zhcl9kZWNsYXJhdGlvbihub2RlLCBzdGF0ZSkuY29uY2F0KGMoJzsnKSk7XG5cdH0sXG5cblx0VmFyaWFibGVEZWNsYXJhdG9yKG5vZGUsIHN0YXRlKSB7XG5cdFx0aWYgKG5vZGUuaW5pdCkge1xuXHRcdFx0cmV0dXJuIFtcblx0XHRcdFx0Li4uaGFuZGxlKG5vZGUuaWQsIHN0YXRlKSxcblx0XHRcdFx0YygnID0gJyksXG5cdFx0XHRcdC4uLmhhbmRsZShub2RlLmluaXQsIHN0YXRlKVxuXHRcdFx0XTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIGhhbmRsZShub2RlLmlkLCBzdGF0ZSk7XG5cdFx0fVxuXHR9LFxuXG5cdENsYXNzRGVjbGFyYXRpb24obm9kZSwgc3RhdGUpIHtcblx0XHRjb25zdCBjaHVua3MgPSBbYygnY2xhc3MgJyldO1xuXG5cdFx0aWYgKG5vZGUuaWQpIGNodW5rcy5wdXNoKC4uLmhhbmRsZShub2RlLmlkLCBzdGF0ZSksIGMoJyAnKSk7XG5cblx0XHRpZiAobm9kZS5zdXBlckNsYXNzKSB7XG5cdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0YygnZXh0ZW5kcyAnKSxcblx0XHRcdFx0Li4uaGFuZGxlKG5vZGUuc3VwZXJDbGFzcywgc3RhdGUpLFxuXHRcdFx0XHRjKCcgJylcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y2h1bmtzLnB1c2goLi4uaGFuZGxlKG5vZGUuYm9keSwgc3RhdGUpKTtcblxuXHRcdHJldHVybiBjaHVua3M7XG5cdH0sXG5cblx0SW1wb3J0RGVjbGFyYXRpb24oLyoqIEB0eXBlIHtJbXBvcnREZWNsYXJhdGlvbn0gKi8gbm9kZSwgc3RhdGUpIHtcblx0XHRjb25zdCBjaHVua3MgPSBbYygnaW1wb3J0ICcpXTtcblxuXHRcdGNvbnN0IHsgbGVuZ3RoIH0gPSBub2RlLnNwZWNpZmllcnM7XG5cdFx0Y29uc3Qgc291cmNlID0gaGFuZGxlKG5vZGUuc291cmNlLCBzdGF0ZSk7XG5cblx0XHRpZiAobGVuZ3RoID4gMCkge1xuXHRcdFx0bGV0IGkgPSAwO1xuXG5cdFx0XHR3aGlsZSAoaSA8IGxlbmd0aCkge1xuXHRcdFx0XHRpZiAoaSA+IDApIHtcblx0XHRcdFx0XHRjaHVua3MucHVzaChjKCcsICcpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnN0IHNwZWNpZmllciA9IG5vZGUuc3BlY2lmaWVyc1tpXTtcblxuXHRcdFx0XHRpZiAoc3BlY2lmaWVyLnR5cGUgPT09ICdJbXBvcnREZWZhdWx0U3BlY2lmaWVyJykge1xuXHRcdFx0XHRcdGNodW5rcy5wdXNoKGMoc3BlY2lmaWVyLmxvY2FsLm5hbWUsIHNwZWNpZmllcikpO1xuXHRcdFx0XHRcdGkgKz0gMTtcblx0XHRcdFx0fSBlbHNlIGlmIChzcGVjaWZpZXIudHlwZSA9PT0gJ0ltcG9ydE5hbWVzcGFjZVNwZWNpZmllcicpIHtcblx0XHRcdFx0XHRjaHVua3MucHVzaChjKCcqIGFzICcgKyBzcGVjaWZpZXIubG9jYWwubmFtZSwgc3BlY2lmaWVyKSk7XG5cdFx0XHRcdFx0aSArPSAxO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpIDwgbGVuZ3RoKSB7XG5cdFx0XHRcdC8vIHdlIGhhdmUgbmFtZWQgc3BlY2lmaWVyc1xuXHRcdFx0XHRjb25zdCBzcGVjaWZpZXJzID0gbm9kZS5zcGVjaWZpZXJzLnNsaWNlKGkpLm1hcCgoLyoqIEB0eXBlIHtJbXBvcnRTcGVjaWZpZXJ9ICovIHNwZWNpZmllcikgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IG5hbWUgPSBoYW5kbGUoc3BlY2lmaWVyLmltcG9ydGVkLCBzdGF0ZSlbMF07XG5cdFx0XHRcdFx0Y29uc3QgYXMgPSBoYW5kbGUoc3BlY2lmaWVyLmxvY2FsLCBzdGF0ZSlbMF07XG5cblx0XHRcdFx0XHRpZiAobmFtZS5jb250ZW50ID09PSBhcy5jb250ZW50KSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gW2FzXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gW25hbWUsIGMoJyBhcyAnKSwgYXNdO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRjb25zdCB3aWR0aCA9IGdldF9sZW5ndGgoY2h1bmtzKSArIHNwZWNpZmllcnMubWFwKGdldF9sZW5ndGgpLnJlZHVjZShzdW0sIDApICsgKDIgKiBzcGVjaWZpZXJzLmxlbmd0aCkgKyA2ICsgZ2V0X2xlbmd0aChzb3VyY2UpO1xuXG5cdFx0XHRcdGlmICh3aWR0aCA+IDgwKSB7XG5cdFx0XHRcdFx0Y2h1bmtzLnB1c2goXG5cdFx0XHRcdFx0XHRjKGB7XFxuXFx0YCksXG5cdFx0XHRcdFx0XHQuLi5qb2luKHNwZWNpZmllcnMsIGMoJyxcXG5cXHQnKSksXG5cdFx0XHRcdFx0XHRjKCdcXG59Jylcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRcdFx0YyhgeyBgKSxcblx0XHRcdFx0XHRcdC4uLmpvaW4oc3BlY2lmaWVycywgYygnLCAnKSksXG5cdFx0XHRcdFx0XHRjKCcgfScpXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRjaHVua3MucHVzaChjKCcgZnJvbSAnKSk7XG5cdFx0fVxuXG5cdFx0Y2h1bmtzLnB1c2goXG5cdFx0XHQuLi5zb3VyY2UsXG5cdFx0XHRjKCc7Jylcblx0XHQpO1xuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSxcblxuXHRJbXBvcnRFeHByZXNzaW9uKG5vZGUsIHN0YXRlKSB7XG5cdFx0cmV0dXJuIFtjKCdpbXBvcnQoJyksIC4uLmhhbmRsZShub2RlLnNvdXJjZSwgc3RhdGUpLCBjKCcpJyldO1xuXHR9LFxuXG5cdEV4cG9ydERlZmF1bHREZWNsYXJhdGlvbihub2RlLCBzdGF0ZSkge1xuXHRcdGNvbnN0IGNodW5rcyA9IFtcblx0XHRcdGMoYGV4cG9ydCBkZWZhdWx0IGApLFxuXHRcdFx0Li4uaGFuZGxlKG5vZGUuZGVjbGFyYXRpb24sIHN0YXRlKVxuXHRcdF07XG5cblx0XHRpZiAobm9kZS5kZWNsYXJhdGlvbi50eXBlICE9PSAnRnVuY3Rpb25EZWNsYXJhdGlvbicpIHtcblx0XHRcdGNodW5rcy5wdXNoKGMoJzsnKSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSxcblxuXHRFeHBvcnROYW1lZERlY2xhcmF0aW9uKG5vZGUsIHN0YXRlKSB7XG5cdFx0Y29uc3QgY2h1bmtzID0gW2MoJ2V4cG9ydCAnKV07XG5cblx0XHRpZiAobm9kZS5kZWNsYXJhdGlvbikge1xuXHRcdFx0Y2h1bmtzLnB1c2goLi4uaGFuZGxlKG5vZGUuZGVjbGFyYXRpb24sIHN0YXRlKSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IHNwZWNpZmllcnMgPSBub2RlLnNwZWNpZmllcnMubWFwKCgvKiogQHR5cGUge0V4cG9ydFNwZWNpZmllcn0gKi8gc3BlY2lmaWVyKSA9PiB7XG5cdFx0XHRcdGNvbnN0IG5hbWUgPSBoYW5kbGUoc3BlY2lmaWVyLmxvY2FsLCBzdGF0ZSlbMF07XG5cdFx0XHRcdGNvbnN0IGFzID0gaGFuZGxlKHNwZWNpZmllci5leHBvcnRlZCwgc3RhdGUpWzBdO1xuXG5cdFx0XHRcdGlmIChuYW1lLmNvbnRlbnQgPT09IGFzLmNvbnRlbnQpIHtcblx0XHRcdFx0XHRyZXR1cm4gW25hbWVdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIFtuYW1lLCBjKCcgYXMgJyksIGFzXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRjb25zdCB3aWR0aCA9IDcgKyBzcGVjaWZpZXJzLm1hcChnZXRfbGVuZ3RoKS5yZWR1Y2Uoc3VtLCAwKSArIDIgKiBzcGVjaWZpZXJzLmxlbmd0aDtcblxuXHRcdFx0aWYgKHdpZHRoID4gODApIHtcblx0XHRcdFx0Y2h1bmtzLnB1c2goXG5cdFx0XHRcdFx0Yygne1xcblxcdCcpLFxuXHRcdFx0XHRcdC4uLmpvaW4oc3BlY2lmaWVycywgYygnLFxcblxcdCcpKSxcblx0XHRcdFx0XHRjKCdcXG59Jylcblx0XHRcdFx0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRcdGMoJ3sgJyksXG5cdFx0XHRcdFx0Li4uam9pbihzcGVjaWZpZXJzLCBjKCcsICcpKSxcblx0XHRcdFx0XHRjKCcgfScpXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChub2RlLnNvdXJjZSkge1xuXHRcdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0XHRjKCcgZnJvbSAnKSxcblx0XHRcdFx0XHQuLi5oYW5kbGUobm9kZS5zb3VyY2UsIHN0YXRlKVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGNodW5rcy5wdXNoKGMoJzsnKSk7XG5cblx0XHRyZXR1cm4gY2h1bmtzO1xuXHR9LFxuXG5cdEV4cG9ydEFsbERlY2xhcmF0aW9uKG5vZGUsIHN0YXRlKSB7XG5cdFx0cmV0dXJuIFtcblx0XHRcdGMoYGV4cG9ydCAqIGZyb20gYCksXG5cdFx0XHQuLi5oYW5kbGUobm9kZS5zb3VyY2UsIHN0YXRlKSxcblx0XHRcdGMoYDtgKVxuXHRcdF07XG5cdH0sXG5cblx0TWV0aG9kRGVmaW5pdGlvbihub2RlLCBzdGF0ZSkge1xuXHRcdGNvbnN0IGNodW5rcyA9IFtdO1xuXG5cdFx0aWYgKG5vZGUuc3RhdGljKSB7XG5cdFx0XHRjaHVua3MucHVzaChjKCdzdGF0aWMgJykpO1xuXHRcdH1cblxuXHRcdGlmIChub2RlLmtpbmQgPT09ICdnZXQnIHx8IG5vZGUua2luZCA9PT0gJ3NldCcpIHtcblx0XHRcdC8vIEdldHRlciBvciBzZXR0ZXJcblx0XHRcdGNodW5rcy5wdXNoKGMobm9kZS5raW5kICsgJyAnKSk7XG5cdFx0fVxuXG5cdFx0aWYgKG5vZGUudmFsdWUuYXN5bmMpIHtcblx0XHRcdGNodW5rcy5wdXNoKGMoJ2FzeW5jICcpKTtcblx0XHR9XG5cblx0XHRpZiAobm9kZS52YWx1ZS5nZW5lcmF0b3IpIHtcblx0XHRcdGNodW5rcy5wdXNoKGMoJyonKSk7XG5cdFx0fVxuXG5cdFx0aWYgKG5vZGUuY29tcHV0ZWQpIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKCdbJyksXG5cdFx0XHRcdC4uLmhhbmRsZShub2RlLmtleSwgc3RhdGUpLFxuXHRcdFx0XHRjKCddJylcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNodW5rcy5wdXNoKC4uLmhhbmRsZShub2RlLmtleSwgc3RhdGUpKTtcblx0XHR9XG5cblx0XHRjaHVua3MucHVzaChjKCcoJykpO1xuXG5cdFx0Y29uc3QgeyBwYXJhbXMgfSA9IG5vZGUudmFsdWU7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBwYXJhbXMubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdGNodW5rcy5wdXNoKC4uLmhhbmRsZShwYXJhbXNbaV0sIHN0YXRlKSk7XG5cdFx0XHRpZiAoaSA8IHBhcmFtcy5sZW5ndGggLSAxKSBjaHVua3MucHVzaChjKCcsICcpKTtcblx0XHR9XG5cblx0XHRjaHVua3MucHVzaChcblx0XHRcdGMoJykgJyksXG5cdFx0XHQuLi5oYW5kbGUobm9kZS52YWx1ZS5ib2R5LCBzdGF0ZSlcblx0XHQpO1xuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSxcblxuXHRBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbjogc2NvcGVkKCgvKiogQHR5cGUge0Fycm93RnVuY3Rpb25FeHByZXNzaW9ufSAqLyBub2RlLCBzdGF0ZSkgPT4ge1xuXHRcdGNvbnN0IGNodW5rcyA9IFtdO1xuXG5cdFx0aWYgKG5vZGUuYXN5bmMpIGNodW5rcy5wdXNoKGMoJ2FzeW5jICcpKTtcblxuXHRcdGlmIChub2RlLnBhcmFtcy5sZW5ndGggPT09IDEgJiYgbm9kZS5wYXJhbXNbMF0udHlwZSA9PT0gJ0lkZW50aWZpZXInKSB7XG5cdFx0XHRjaHVua3MucHVzaCguLi5oYW5kbGUobm9kZS5wYXJhbXNbMF0sIHN0YXRlKSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IHBhcmFtcyA9IG5vZGUucGFyYW1zLm1hcChwYXJhbSA9PiBoYW5kbGUocGFyYW0sIHtcblx0XHRcdFx0Li4uc3RhdGUsXG5cdFx0XHRcdGluZGVudDogc3RhdGUuaW5kZW50ICsgJ1xcdCdcblx0XHRcdH0pKTtcblxuXHRcdFx0Y2h1bmtzLnB1c2goXG5cdFx0XHRcdGMoJygnKSxcblx0XHRcdFx0Li4uam9pbihwYXJhbXMsIGMoJywgJykpLFxuXHRcdFx0XHRjKCcpJylcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y2h1bmtzLnB1c2goYygnID0+ICcpKTtcblxuXHRcdGlmIChcblx0XHRcdG5vZGUuYm9keS50eXBlID09PSAnT2JqZWN0RXhwcmVzc2lvbicgfHxcblx0XHRcdChub2RlLmJvZHkudHlwZSA9PT0gJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJyAmJiBub2RlLmJvZHkubGVmdC50eXBlID09PSAnT2JqZWN0UGF0dGVybicpXG5cdFx0KSB7XG5cdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0YygnKCcpLFxuXHRcdFx0XHQuLi5oYW5kbGUobm9kZS5ib2R5LCBzdGF0ZSksXG5cdFx0XHRcdGMoJyknKVxuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2h1bmtzLnB1c2goLi4uaGFuZGxlKG5vZGUuYm9keSwgc3RhdGUpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gY2h1bmtzO1xuXHR9KSxcblxuXHRUaGlzRXhwcmVzc2lvbihub2RlLCBzdGF0ZSkge1xuXHRcdHJldHVybiBbYygndGhpcycsIG5vZGUpXTtcblx0fSxcblxuXHRTdXBlcihub2RlLCBzdGF0ZSkge1xuXHRcdHJldHVybiBbYygnc3VwZXInLCBub2RlKV07XG5cdH0sXG5cblx0UmVzdEVsZW1lbnQobm9kZSwgc3RhdGUpIHtcblx0XHRyZXR1cm4gW2MoJy4uLicpLCAuLi5oYW5kbGUobm9kZS5hcmd1bWVudCwgc3RhdGUpXTtcblx0fSxcblxuXHRZaWVsZEV4cHJlc3Npb24obm9kZSwgc3RhdGUpIHtcblx0XHRpZiAobm9kZS5hcmd1bWVudCkge1xuXHRcdFx0cmV0dXJuIFtjKG5vZGUuZGVsZWdhdGUgPyBgeWllbGQqIGAgOiBgeWllbGQgYCksIC4uLmhhbmRsZShub2RlLmFyZ3VtZW50LCBzdGF0ZSldO1xuXHRcdH1cblxuXHRcdHJldHVybiBbYyhub2RlLmRlbGVnYXRlID8gYHlpZWxkKmAgOiBgeWllbGRgKV07XG5cdH0sXG5cblx0QXdhaXRFeHByZXNzaW9uKG5vZGUsIHN0YXRlKSB7XG5cdFx0aWYgKG5vZGUuYXJndW1lbnQpIHtcblx0XHRcdGNvbnN0IHByZWNlZGVuY2UgPSBFWFBSRVNTSU9OU19QUkVDRURFTkNFW25vZGUuYXJndW1lbnQudHlwZV07XG5cblx0XHRcdGlmIChwcmVjZWRlbmNlICYmIChwcmVjZWRlbmNlIDwgRVhQUkVTU0lPTlNfUFJFQ0VERU5DRS5Bd2FpdEV4cHJlc3Npb24pKSB7XG5cdFx0XHRcdHJldHVybiBbYygnYXdhaXQgKCcpLCAuLi5oYW5kbGUobm9kZS5hcmd1bWVudCwgc3RhdGUpLCBjKCcpJyldO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIFtjKCdhd2FpdCAnKSwgLi4uaGFuZGxlKG5vZGUuYXJndW1lbnQsIHN0YXRlKV07XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIFtjKCdhd2FpdCcpXTtcblx0fSxcblxuXHRUZW1wbGF0ZUxpdGVyYWwobm9kZSwgc3RhdGUpIHtcblx0XHRjb25zdCBjaHVua3MgPSBbYygnYCcpXTtcblxuXHRcdGNvbnN0IHsgcXVhc2lzLCBleHByZXNzaW9ucyB9ID0gbm9kZTtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZXhwcmVzc2lvbnMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKHF1YXNpc1tpXS52YWx1ZS5yYXcpLFxuXHRcdFx0XHRjKCckeycpLFxuXHRcdFx0XHQuLi5oYW5kbGUoZXhwcmVzc2lvbnNbaV0sIHN0YXRlKSxcblx0XHRcdFx0YygnfScpXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0YyhxdWFzaXNbcXVhc2lzLmxlbmd0aCAtIDFdLnZhbHVlLnJhdyksXG5cdFx0XHRjKCdgJylcblx0XHQpO1xuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSxcblxuXHRUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24obm9kZSwgc3RhdGUpIHtcblx0XHRyZXR1cm4gaGFuZGxlKG5vZGUudGFnLCBzdGF0ZSkuY29uY2F0KGhhbmRsZShub2RlLnF1YXNpLCBzdGF0ZSkpO1xuXHR9LFxuXG5cdEFycmF5RXhwcmVzc2lvbihub2RlLCBzdGF0ZSkge1xuXHRcdGNvbnN0IGNodW5rcyA9IFtjKCdbJyldO1xuXG5cdFx0LyoqIEB0eXBlIHtDaHVua1tdW119ICovXG5cdFx0Y29uc3QgZWxlbWVudHMgPSBbXTtcblxuXHRcdC8qKiBAdHlwZSB7Q2h1bmtbXX0gKi9cblx0XHRsZXQgc3BhcnNlX2NvbW1hcyA9IFtdO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLmVsZW1lbnRzLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHQvLyBjYW4ndCB1c2UgbWFwL2ZvckVhY2ggYmVjYXVzZSBvZiBzcGFyc2UgYXJyYXlzXG5cdFx0XHRjb25zdCBlbGVtZW50ID0gbm9kZS5lbGVtZW50c1tpXTtcblx0XHRcdGlmIChlbGVtZW50KSB7XG5cdFx0XHRcdGVsZW1lbnRzLnB1c2goWy4uLnNwYXJzZV9jb21tYXMsIC4uLmhhbmRsZShlbGVtZW50LCB7XG5cdFx0XHRcdFx0Li4uc3RhdGUsXG5cdFx0XHRcdFx0aW5kZW50OiBzdGF0ZS5pbmRlbnQgKyAnXFx0J1xuXHRcdFx0XHR9KV0pO1xuXHRcdFx0XHRzcGFyc2VfY29tbWFzID0gW107XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzcGFyc2VfY29tbWFzLnB1c2goYygnLCcpKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRjb25zdCBtdWx0aXBsZV9saW5lcyA9IChcblx0XHRcdGVsZW1lbnRzLnNvbWUoaGFzX25ld2xpbmUpIHx8XG5cdFx0XHQoZWxlbWVudHMubWFwKGdldF9sZW5ndGgpLnJlZHVjZShzdW0sIDApICsgKHN0YXRlLmluZGVudC5sZW5ndGggKyBlbGVtZW50cy5sZW5ndGggLSAxKSAqIDIpID4gODBcblx0XHQpO1xuXG5cdFx0aWYgKG11bHRpcGxlX2xpbmVzKSB7XG5cdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0YyhgXFxuJHtzdGF0ZS5pbmRlbnR9XFx0YCksXG5cdFx0XHRcdC4uLmpvaW4oZWxlbWVudHMsIGMoYCxcXG4ke3N0YXRlLmluZGVudH1cXHRgKSksXG5cdFx0XHRcdGMoYFxcbiR7c3RhdGUuaW5kZW50fWApLFxuXHRcdFx0XHQuLi5zcGFyc2VfY29tbWFzXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjaHVua3MucHVzaCguLi5qb2luKGVsZW1lbnRzLCBjKCcsICcpKSwgLi4uc3BhcnNlX2NvbW1hcyk7XG5cdFx0fVxuXG5cdFx0Y2h1bmtzLnB1c2goYygnXScpKTtcblxuXHRcdHJldHVybiBjaHVua3M7XG5cdH0sXG5cblx0T2JqZWN0RXhwcmVzc2lvbigvKiogQHR5cGUge09iamVjdEV4cHJlc3Npb259ICovIG5vZGUsIHN0YXRlKSB7XG5cdFx0aWYgKG5vZGUucHJvcGVydGllcy5sZW5ndGggPT09IDApIHtcblx0XHRcdHJldHVybiBbYygne30nKV07XG5cdFx0fVxuXG5cdFx0bGV0IGhhc19pbmxpbmVfY29tbWVudCA9IGZhbHNlO1xuXG5cdFx0LyoqIEB0eXBlIHtDaHVua1tdfSAqL1xuXHRcdGNvbnN0IGNodW5rcyA9IFtdO1xuXHRcdGNvbnN0IHNlcGFyYXRvciA9IGMoJywgJyk7XG5cblx0XHRub2RlLnByb3BlcnRpZXMuZm9yRWFjaCgocCwgaSkgPT4ge1xuXHRcdFx0Y2h1bmtzLnB1c2goLi4uaGFuZGxlKHAsIHtcblx0XHRcdFx0Li4uc3RhdGUsXG5cdFx0XHRcdGluZGVudDogc3RhdGUuaW5kZW50ICsgJ1xcdCdcblx0XHRcdH0pKTtcblxuXHRcdFx0aWYgKHN0YXRlLmNvbW1lbnRzLmxlbmd0aCkge1xuXHRcdFx0XHQvLyBUT0RPIGdlbmVyYWxpc2UgdGhpcywgc28gaXQgd29ya3Mgd2l0aCBBcnJheUV4cHJlc3Npb25zIGFuZCBvdGhlciB0aGluZ3MuXG5cdFx0XHRcdC8vIEF0IHByZXNlbnQsIHN0dWZmIHdpbGwganVzdCBnZXQgYXBwZW5kZWQgdG8gdGhlIGNsb3Nlc3Qgc3RhdGVtZW50L2RlY2xhcmF0aW9uXG5cdFx0XHRcdGNodW5rcy5wdXNoKGMoJywgJykpO1xuXG5cdFx0XHRcdHdoaWxlIChzdGF0ZS5jb21tZW50cy5sZW5ndGgpIHtcblx0XHRcdFx0XHRjb25zdCBjb21tZW50ID0gc3RhdGUuY29tbWVudHMuc2hpZnQoKTtcblxuXHRcdFx0XHRcdGNodW5rcy5wdXNoKGMoY29tbWVudC50eXBlID09PSAnQmxvY2snXG5cdFx0XHRcdFx0XHQ/IGAvKiR7Y29tbWVudC52YWx1ZX0qL1xcbiR7c3RhdGUuaW5kZW50fVxcdGBcblx0XHRcdFx0XHRcdDogYC8vJHtjb21tZW50LnZhbHVlfVxcbiR7c3RhdGUuaW5kZW50fVxcdGApKTtcblxuXHRcdFx0XHRcdGlmIChjb21tZW50LnR5cGUgPT09ICdMaW5lJykge1xuXHRcdFx0XHRcdFx0aGFzX2lubGluZV9jb21tZW50ID0gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmIChpIDwgbm9kZS5wcm9wZXJ0aWVzLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRjaHVua3MucHVzaChzZXBhcmF0b3IpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRjb25zdCBtdWx0aXBsZV9saW5lcyA9IChcblx0XHRcdGhhc19pbmxpbmVfY29tbWVudCB8fFxuXHRcdFx0aGFzX25ld2xpbmUoY2h1bmtzKSB8fFxuXHRcdFx0Z2V0X2xlbmd0aChjaHVua3MpID4gNDBcblx0XHQpO1xuXG5cdFx0aWYgKG11bHRpcGxlX2xpbmVzKSB7XG5cdFx0XHRzZXBhcmF0b3IuY29udGVudCA9IGAsXFxuJHtzdGF0ZS5pbmRlbnR9XFx0YDtcblx0XHR9XG5cblx0XHRyZXR1cm4gW1xuXHRcdFx0YyhtdWx0aXBsZV9saW5lcyA/IGB7XFxuJHtzdGF0ZS5pbmRlbnR9XFx0YCA6IGB7IGApLFxuXHRcdFx0Li4uY2h1bmtzLFxuXHRcdFx0YyhtdWx0aXBsZV9saW5lcyA/IGBcXG4ke3N0YXRlLmluZGVudH19YCA6IGAgfWApXG5cdFx0XTtcblx0fSxcblxuXHRQcm9wZXJ0eShub2RlLCBzdGF0ZSkge1xuXHRcdGNvbnN0IHZhbHVlID0gaGFuZGxlKG5vZGUudmFsdWUsIHN0YXRlKTtcblxuXHRcdGlmIChub2RlLmtleSA9PT0gbm9kZS52YWx1ZSkge1xuXHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdH1cblxuXHRcdC8vIHNwZWNpYWwgY2FzZVxuXHRcdGlmIChcblx0XHRcdCFub2RlLmNvbXB1dGVkICYmXG5cdFx0XHRub2RlLnZhbHVlLnR5cGUgPT09ICdBc3NpZ25tZW50UGF0dGVybicgJiZcblx0XHRcdG5vZGUudmFsdWUubGVmdC50eXBlID09PSAnSWRlbnRpZmllcicgJiZcblx0XHRcdG5vZGUudmFsdWUubGVmdC5uYW1lID09PSBub2RlLmtleS5uYW1lXG5cdFx0KSB7XG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fVxuXG5cdFx0aWYgKCFub2RlLmNvbXB1dGVkICYmIG5vZGUudmFsdWUudHlwZSA9PT0gJ0lkZW50aWZpZXInICYmIChcblx0XHRcdChub2RlLmtleS50eXBlID09PSAnSWRlbnRpZmllcicgJiYgbm9kZS5rZXkubmFtZSA9PT0gdmFsdWVbMF0uY29udGVudCkgfHxcblx0XHRcdChub2RlLmtleS50eXBlID09PSAnTGl0ZXJhbCcgJiYgbm9kZS5rZXkudmFsdWUgPT09IHZhbHVlWzBdLmNvbnRlbnQpXG5cdFx0KSkge1xuXHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdH1cblxuXHRcdGNvbnN0IGtleSA9IGhhbmRsZShub2RlLmtleSwgc3RhdGUpO1xuXG5cdFx0aWYgKG5vZGUudmFsdWUudHlwZSA9PT0gJ0Z1bmN0aW9uRXhwcmVzc2lvbicgJiYgIW5vZGUudmFsdWUuaWQpIHtcblx0XHRcdHN0YXRlID0ge1xuXHRcdFx0XHQuLi5zdGF0ZSxcblx0XHRcdFx0c2NvcGU6IHN0YXRlLnNjb3BlX21hcC5nZXQobm9kZS52YWx1ZSlcblx0XHRcdH07XG5cblx0XHRcdGNvbnN0IGNodW5rcyA9IG5vZGUua2luZCAhPT0gJ2luaXQnXG5cdFx0XHRcdD8gW2MoYCR7bm9kZS5raW5kfSBgKV1cblx0XHRcdFx0OiBbXTtcblxuXHRcdFx0aWYgKG5vZGUudmFsdWUuYXN5bmMpIHtcblx0XHRcdFx0Y2h1bmtzLnB1c2goYygnYXN5bmMgJykpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKG5vZGUudmFsdWUuZ2VuZXJhdG9yKSB7XG5cdFx0XHRcdGNodW5rcy5wdXNoKGMoJyonKSk7XG5cdFx0XHR9XG5cblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHQuLi4obm9kZS5jb21wdXRlZCA/IFtjKCdbJyksIC4uLmtleSwgYygnXScpXSA6IGtleSksXG5cdFx0XHRcdGMoJygnKSxcblx0XHRcdFx0Li4uam9pbihub2RlLnZhbHVlLnBhcmFtcy5tYXAoKC8qKiBAdHlwZSB7UGF0dGVybn0gKi8gcGFyYW0pID0+IGhhbmRsZShwYXJhbSwgc3RhdGUpKSwgYygnLCAnKSksXG5cdFx0XHRcdGMoJykgJyksXG5cdFx0XHRcdC4uLmhhbmRsZShub2RlLnZhbHVlLmJvZHksIHN0YXRlKVxuXHRcdFx0KTtcblxuXHRcdFx0cmV0dXJuIGNodW5rcztcblx0XHR9XG5cblx0XHRpZiAobm9kZS5jb21wdXRlZCkge1xuXHRcdFx0cmV0dXJuIFtcblx0XHRcdFx0YygnWycpLFxuXHRcdFx0XHQuLi5rZXksXG5cdFx0XHRcdGMoJ106ICcpLFxuXHRcdFx0XHQuLi52YWx1ZVxuXHRcdFx0XTtcblx0XHR9XG5cblx0XHRyZXR1cm4gW1xuXHRcdFx0Li4ua2V5LFxuXHRcdFx0YygnOiAnKSxcblx0XHRcdC4uLnZhbHVlXG5cdFx0XTtcblx0fSxcblxuXHRPYmplY3RQYXR0ZXJuKG5vZGUsIHN0YXRlKSB7XG5cdFx0Y29uc3QgY2h1bmtzID0gW2MoJ3sgJyldO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLnByb3BlcnRpZXMubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdGNodW5rcy5wdXNoKC4uLmhhbmRsZShub2RlLnByb3BlcnRpZXNbaV0sIHN0YXRlKSk7XG5cdFx0XHRpZiAoaSA8IG5vZGUucHJvcGVydGllcy5sZW5ndGggLSAxKSBjaHVua3MucHVzaChjKCcsICcpKTtcblx0XHR9XG5cblx0XHRjaHVua3MucHVzaChjKCcgfScpKTtcblxuXHRcdHJldHVybiBjaHVua3M7XG5cdH0sXG5cblx0U2VxdWVuY2VFeHByZXNzaW9uKC8qKiBAdHlwZSB7U2VxdWVuY2VFeHByZXNzaW9ufSAqLyBub2RlLCBzdGF0ZSkge1xuXHRcdGNvbnN0IGV4cHJlc3Npb25zID0gbm9kZS5leHByZXNzaW9ucy5tYXAoZSA9PiBoYW5kbGUoZSwgc3RhdGUpKTtcblxuXHRcdHJldHVybiBbXG5cdFx0XHRjKCcoJyksXG5cdFx0XHQuLi5qb2luKGV4cHJlc3Npb25zLCBjKCcsICcpKSxcblx0XHRcdGMoJyknKVxuXHRcdF07XG5cdH0sXG5cblx0VW5hcnlFeHByZXNzaW9uKG5vZGUsIHN0YXRlKSB7XG5cdFx0Y29uc3QgY2h1bmtzID0gW2Mobm9kZS5vcGVyYXRvcildO1xuXG5cdFx0aWYgKG5vZGUub3BlcmF0b3IubGVuZ3RoID4gMSkge1xuXHRcdFx0Y2h1bmtzLnB1c2goYygnICcpKTtcblx0XHR9XG5cblx0XHRpZiAoXG5cdFx0XHRFWFBSRVNTSU9OU19QUkVDRURFTkNFW25vZGUuYXJndW1lbnQudHlwZV0gPFxuXHRcdFx0RVhQUkVTU0lPTlNfUFJFQ0VERU5DRS5VbmFyeUV4cHJlc3Npb25cblx0XHQpIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKCcoJyksXG5cdFx0XHRcdC4uLmhhbmRsZShub2RlLmFyZ3VtZW50LCBzdGF0ZSksXG5cdFx0XHRcdGMoJyknKVxuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2h1bmtzLnB1c2goLi4uaGFuZGxlKG5vZGUuYXJndW1lbnQsIHN0YXRlKSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSxcblxuXHRVcGRhdGVFeHByZXNzaW9uKG5vZGUsIHN0YXRlKSB7XG5cdFx0cmV0dXJuIG5vZGUucHJlZml4XG5cdFx0XHQ/IFtjKG5vZGUub3BlcmF0b3IpLCAuLi5oYW5kbGUobm9kZS5hcmd1bWVudCwgc3RhdGUpXVxuXHRcdFx0OiBbLi4uaGFuZGxlKG5vZGUuYXJndW1lbnQsIHN0YXRlKSwgYyhub2RlLm9wZXJhdG9yKV07XG5cdH0sXG5cblx0QXNzaWdubWVudEV4cHJlc3Npb24obm9kZSwgc3RhdGUpIHtcblx0XHRyZXR1cm4gW1xuXHRcdFx0Li4uaGFuZGxlKG5vZGUubGVmdCwgc3RhdGUpLFxuXHRcdFx0YyhgICR7bm9kZS5vcGVyYXRvciB8fCAnPSd9IGApLFxuXHRcdFx0Li4uaGFuZGxlKG5vZGUucmlnaHQsIHN0YXRlKVxuXHRcdF07XG5cdH0sXG5cblx0QmluYXJ5RXhwcmVzc2lvbihub2RlLCBzdGF0ZSkge1xuXHRcdGNvbnN0IGNodW5rcyA9IFtdO1xuXG5cdFx0Ly8gVE9ET1xuXHRcdC8vIGNvbnN0IGlzX2luID0gbm9kZS5vcGVyYXRvciA9PT0gJ2luJztcblx0XHQvLyBpZiAoaXNfaW4pIHtcblx0XHQvLyBcdC8vIEF2b2lkcyBjb25mdXNpb24gaW4gYGZvcmAgbG9vcHMgaW5pdGlhbGl6ZXJzXG5cdFx0Ly8gXHRjaHVua3MucHVzaChjKCcoJykpO1xuXHRcdC8vIH1cblxuXHRcdGlmIChuZWVkc19wYXJlbnMobm9kZS5sZWZ0LCBub2RlLCBmYWxzZSkpIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKCcoJyksXG5cdFx0XHRcdC4uLmhhbmRsZShub2RlLmxlZnQsIHN0YXRlKSxcblx0XHRcdFx0YygnKScpXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjaHVua3MucHVzaCguLi5oYW5kbGUobm9kZS5sZWZ0LCBzdGF0ZSkpO1xuXHRcdH1cblxuXHRcdGNodW5rcy5wdXNoKGMoYCAke25vZGUub3BlcmF0b3J9IGApKTtcblxuXHRcdGlmIChuZWVkc19wYXJlbnMobm9kZS5yaWdodCwgbm9kZSwgdHJ1ZSkpIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKCcoJyksXG5cdFx0XHRcdC4uLmhhbmRsZShub2RlLnJpZ2h0LCBzdGF0ZSksXG5cdFx0XHRcdGMoJyknKVxuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2h1bmtzLnB1c2goLi4uaGFuZGxlKG5vZGUucmlnaHQsIHN0YXRlKSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSxcblxuXHRDb25kaXRpb25hbEV4cHJlc3Npb24obm9kZSwgc3RhdGUpIHtcblx0XHRjb25zdCBjaHVua3MgPSBbXTtcblxuXHRcdGlmIChcblx0XHRcdEVYUFJFU1NJT05TX1BSRUNFREVOQ0Vbbm9kZS50ZXN0LnR5cGVdID5cblx0XHRcdEVYUFJFU1NJT05TX1BSRUNFREVOQ0UuQ29uZGl0aW9uYWxFeHByZXNzaW9uXG5cdFx0KSB7XG5cdFx0XHRjaHVua3MucHVzaCguLi5oYW5kbGUobm9kZS50ZXN0LCBzdGF0ZSkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0YygnKCcpLFxuXHRcdFx0XHQuLi5oYW5kbGUobm9kZS50ZXN0LCBzdGF0ZSksXG5cdFx0XHRcdGMoJyknKVxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCBjaGlsZF9zdGF0ZSA9IHsgLi4uc3RhdGUsIGluZGVudDogc3RhdGUuaW5kZW50ICsgJ1xcdCcgfTtcblxuXHRcdGNvbnN0IGNvbnNlcXVlbnQgPSBoYW5kbGUobm9kZS5jb25zZXF1ZW50LCBjaGlsZF9zdGF0ZSk7XG5cdFx0Y29uc3QgYWx0ZXJuYXRlID0gaGFuZGxlKG5vZGUuYWx0ZXJuYXRlLCBjaGlsZF9zdGF0ZSk7XG5cblx0XHRjb25zdCBtdWx0aXBsZV9saW5lcyA9IChcblx0XHRcdGhhc19uZXdsaW5lKGNvbnNlcXVlbnQpIHx8IGhhc19uZXdsaW5lKGFsdGVybmF0ZSkgfHxcblx0XHRcdGdldF9sZW5ndGgoY2h1bmtzKSArIGdldF9sZW5ndGgoY29uc2VxdWVudCkgKyBnZXRfbGVuZ3RoKGFsdGVybmF0ZSkgPiA1MFxuXHRcdCk7XG5cblx0XHRpZiAobXVsdGlwbGVfbGluZXMpIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKGBcXG4ke3N0YXRlLmluZGVudH0/IGApLFxuXHRcdFx0XHQuLi5jb25zZXF1ZW50LFxuXHRcdFx0XHRjKGBcXG4ke3N0YXRlLmluZGVudH06IGApLFxuXHRcdFx0XHQuLi5hbHRlcm5hdGVcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKGAgPyBgKSxcblx0XHRcdFx0Li4uY29uc2VxdWVudCxcblx0XHRcdFx0YyhgIDogYCksXG5cdFx0XHRcdC4uLmFsdGVybmF0ZVxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gY2h1bmtzO1xuXHR9LFxuXG5cdE5ld0V4cHJlc3Npb24oLyoqIEB0eXBlIHtOZXdFeHByZXNzaW9ufSAqLyBub2RlLCBzdGF0ZSkge1xuXHRcdGNvbnN0IGNodW5rcyA9IFtjKCduZXcgJyldO1xuXG5cdFx0aWYgKFxuXHRcdFx0RVhQUkVTU0lPTlNfUFJFQ0VERU5DRVtub2RlLmNhbGxlZS50eXBlXSA8XG5cdFx0XHRFWFBSRVNTSU9OU19QUkVDRURFTkNFLkNhbGxFeHByZXNzaW9uIHx8IGhhc19jYWxsX2V4cHJlc3Npb24obm9kZS5jYWxsZWUpXG5cdFx0KSB7XG5cdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0YygnKCcpLFxuXHRcdFx0XHQuLi5oYW5kbGUobm9kZS5jYWxsZWUsIHN0YXRlKSxcblx0XHRcdFx0YygnKScpXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjaHVua3MucHVzaCguLi5oYW5kbGUobm9kZS5jYWxsZWUsIHN0YXRlKSk7XG5cdFx0fVxuXG5cdFx0Ly8gVE9ETyB0aGlzIGlzIGNvcGllZCBmcm9tIENhbGxFeHByZXNzaW9uIOKAlCBEUlkgaXQgb3V0XG5cdFx0Y29uc3QgYXJncyA9IG5vZGUuYXJndW1lbnRzLm1hcChhcmcgPT4gaGFuZGxlKGFyZywge1xuXHRcdFx0Li4uc3RhdGUsXG5cdFx0XHRpbmRlbnQ6IHN0YXRlLmluZGVudCArICdcXHQnXG5cdFx0fSkpO1xuXG5cdFx0Y29uc3Qgc2VwYXJhdG9yID0gYXJncy5zb21lKGhhc19uZXdsaW5lKSAvLyBUT0RPIG9yIGxlbmd0aCBleGNlZWRzIDgwXG5cdFx0XHQ/IGMoJyxcXG4nICsgc3RhdGUuaW5kZW50KVxuXHRcdFx0OiBjKCcsICcpO1xuXG5cdFx0Y2h1bmtzLnB1c2goXG5cdFx0XHRjKCcoJyksXG5cdFx0XHQuLi5qb2luKGFyZ3MsIHNlcGFyYXRvciksXG5cdFx0XHRjKCcpJylcblx0XHQpO1xuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSxcblxuXHRDaGFpbkV4cHJlc3Npb24obm9kZSwgc3RhdGUpIHtcblx0XHRyZXR1cm4gaGFuZGxlKG5vZGUuZXhwcmVzc2lvbiwgc3RhdGUpO1xuXHR9LFxuXG5cdENhbGxFeHByZXNzaW9uKC8qKiBAdHlwZSB7Q2FsbEV4cHJlc3Npb259ICovIG5vZGUsIHN0YXRlKSB7XG5cdFx0Y29uc3QgY2h1bmtzID0gW107XG5cblx0XHRpZiAoXG5cdFx0XHRFWFBSRVNTSU9OU19QUkVDRURFTkNFW25vZGUuY2FsbGVlLnR5cGVdIDxcblx0XHRcdEVYUFJFU1NJT05TX1BSRUNFREVOQ0UuQ2FsbEV4cHJlc3Npb25cblx0XHQpIHtcblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKCcoJyksXG5cdFx0XHRcdC4uLmhhbmRsZShub2RlLmNhbGxlZSwgc3RhdGUpLFxuXHRcdFx0XHRjKCcpJylcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNodW5rcy5wdXNoKC4uLmhhbmRsZShub2RlLmNhbGxlZSwgc3RhdGUpKTtcblx0XHR9XG5cblx0XHRpZiAoLyoqIEB0eXBlIHtTaW1wbGVDYWxsRXhwcmVzc2lvbn0gKi8gKG5vZGUpLm9wdGlvbmFsKSB7XG5cdFx0XHRjaHVua3MucHVzaChjKCc/LicpKTtcblx0XHR9XG5cblx0XHRjb25zdCBhcmdzID0gbm9kZS5hcmd1bWVudHMubWFwKGFyZyA9PiBoYW5kbGUoYXJnLCBzdGF0ZSkpO1xuXG5cdFx0Y29uc3QgbXVsdGlwbGVfbGluZXMgPSBhcmdzLnNsaWNlKDAsIC0xKS5zb21lKGhhc19uZXdsaW5lKTsgLy8gVE9ETyBvciBsZW5ndGggZXhjZWVkcyA4MFxuXG5cdFx0aWYgKG11bHRpcGxlX2xpbmVzKSB7XG5cdFx0XHQvLyBuZWVkIHRvIGhhbmRsZSBhcmdzIGFnYWluLiBUT0RPIGZpbmQgYWx0ZXJuYXRpdmUgYXBwcm9hY2g/XG5cdFx0XHRjb25zdCBhcmdzID0gbm9kZS5hcmd1bWVudHMubWFwKGFyZyA9PiBoYW5kbGUoYXJnLCB7XG5cdFx0XHRcdC4uLnN0YXRlLFxuXHRcdFx0XHRpbmRlbnQ6IGAke3N0YXRlLmluZGVudH1cXHRgXG5cdFx0XHR9KSk7XG5cblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKGAoXFxuJHtzdGF0ZS5pbmRlbnR9XFx0YCksXG5cdFx0XHRcdC4uLmpvaW4oYXJncywgYyhgLFxcbiR7c3RhdGUuaW5kZW50fVxcdGApKSxcblx0XHRcdFx0YyhgXFxuJHtzdGF0ZS5pbmRlbnR9KWApXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjaHVua3MucHVzaChcblx0XHRcdFx0YygnKCcpLFxuXHRcdFx0XHQuLi5qb2luKGFyZ3MsIGMoJywgJykpLFxuXHRcdFx0XHRjKCcpJylcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNodW5rcztcblx0fSxcblxuXHRNZW1iZXJFeHByZXNzaW9uKG5vZGUsIHN0YXRlKSB7XG5cdFx0Y29uc3QgY2h1bmtzID0gW107XG5cblx0XHRpZiAoRVhQUkVTU0lPTlNfUFJFQ0VERU5DRVtub2RlLm9iamVjdC50eXBlXSA8IEVYUFJFU1NJT05TX1BSRUNFREVOQ0UuTWVtYmVyRXhwcmVzc2lvbikge1xuXHRcdFx0Y2h1bmtzLnB1c2goXG5cdFx0XHRcdGMoJygnKSxcblx0XHRcdFx0Li4uaGFuZGxlKG5vZGUub2JqZWN0LCBzdGF0ZSksXG5cdFx0XHRcdGMoJyknKVxuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2h1bmtzLnB1c2goLi4uaGFuZGxlKG5vZGUub2JqZWN0LCBzdGF0ZSkpO1xuXHRcdH1cblxuXHRcdGlmIChub2RlLmNvbXB1dGVkKSB7XG5cdFx0XHRpZiAobm9kZS5vcHRpb25hbCkge1xuXHRcdFx0XHRjaHVua3MucHVzaChjKCc/LicpKTtcblx0XHRcdH1cblx0XHRcdGNodW5rcy5wdXNoKFxuXHRcdFx0XHRjKCdbJyksXG5cdFx0XHRcdC4uLmhhbmRsZShub2RlLnByb3BlcnR5LCBzdGF0ZSksXG5cdFx0XHRcdGMoJ10nKVxuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2h1bmtzLnB1c2goXG5cdFx0XHRcdGMobm9kZS5vcHRpb25hbCA/ICc/LicgOiAnLicpLFxuXHRcdFx0XHQuLi5oYW5kbGUobm9kZS5wcm9wZXJ0eSwgc3RhdGUpXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBjaHVua3M7XG5cdH0sXG5cblx0TWV0YVByb3BlcnR5KG5vZGUsIHN0YXRlKSB7XG5cdFx0cmV0dXJuIFsuLi5oYW5kbGUobm9kZS5tZXRhLCBzdGF0ZSksIGMoJy4nKSwgLi4uaGFuZGxlKG5vZGUucHJvcGVydHksIHN0YXRlKV07XG5cdH0sXG5cblx0SWRlbnRpZmllcihub2RlLCBzdGF0ZSkge1xuXHRcdGxldCBuYW1lID0gbm9kZS5uYW1lO1xuXG5cdFx0aWYgKG5hbWVbMF0gPT09ICdAJykge1xuXHRcdFx0bmFtZSA9IHN0YXRlLmdldE5hbWUobmFtZS5zbGljZSgxKSk7XG5cdFx0fSBlbHNlIGlmIChub2RlLm5hbWVbMF0gPT09ICcjJykge1xuXHRcdFx0Y29uc3Qgb3duZXIgPSBzdGF0ZS5zY29wZS5maW5kX293bmVyKG5vZGUubmFtZSk7XG5cblx0XHRcdGlmICghb3duZXIpIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZmluZCBvd25lciBmb3Igbm9kZWApO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXN0YXRlLmRlY29uZmxpY3RlZC5oYXMob3duZXIpKSB7XG5cdFx0XHRcdHN0YXRlLmRlY29uZmxpY3RlZC5zZXQob3duZXIsIG5ldyBNYXAoKSk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IGRlY29uZmxpY3RfbWFwID0gc3RhdGUuZGVjb25mbGljdGVkLmdldChvd25lcik7XG5cblx0XHRcdGlmICghZGVjb25mbGljdF9tYXAuaGFzKG5vZGUubmFtZSkpIHtcblx0XHRcdFx0ZGVjb25mbGljdF9tYXAuc2V0KG5vZGUubmFtZSwgZGVjb25mbGljdChub2RlLm5hbWUuc2xpY2UoMSksIG93bmVyLnJlZmVyZW5jZXMpKTtcblx0XHRcdH1cblxuXHRcdFx0bmFtZSA9IGRlY29uZmxpY3RfbWFwLmdldChub2RlLm5hbWUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBbYyhuYW1lLCBub2RlKV07XG5cdH0sXG5cblx0TGl0ZXJhbCgvKiogQHR5cGUge0xpdGVyYWx9ICovIG5vZGUsIHN0YXRlKSB7XG5cdFx0aWYgKHR5cGVvZiBub2RlLnZhbHVlID09PSAnc3RyaW5nJykge1xuXHRcdFx0cmV0dXJuIFtcblx0XHRcdFx0Ly8gVE9ETyBkbyB3ZSBuZWVkIHRvIGhhbmRsZSB3ZWlyZCB1bmljb2RlIGNoYXJhY3RlcnMgc29tZWhvdz9cblx0XHRcdFx0Ly8gc3RyLnJlcGxhY2UoL1xcXFx1KFxcZHs0fSkvZywgKG0sIG4pID0+IFN0cmluZy5mcm9tQ2hhckNvZGUoK24pKVxuXHRcdFx0XHRjKChub2RlLnJhdyB8fCBKU09OLnN0cmluZ2lmeShub2RlLnZhbHVlKSkucmVwbGFjZShyZSwgKF9tLCBfaSwgYXQsIGhhc2gsIG5hbWUpID0+IHtcblx0XHRcdFx0XHRpZiAoYXQpXHRyZXR1cm4gJ0AnICsgbmFtZTtcblx0XHRcdFx0XHRpZiAoaGFzaCkgcmV0dXJuICcjJyArIG5hbWU7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGB0aGlzIHNob3VsZG4ndCBoYXBwZW5gKTtcblx0XHRcdFx0fSksIG5vZGUpXG5cdFx0XHRdO1xuXHRcdH1cblxuXHRcdHJldHVybiBbYyhub2RlLnJhdyB8fCBTdHJpbmcobm9kZS52YWx1ZSksIG5vZGUpXTtcblx0fVxufTtcblxuaGFuZGxlcnMuRm9yT2ZTdGF0ZW1lbnQgPSBoYW5kbGVycy5Gb3JJblN0YXRlbWVudDtcbmhhbmRsZXJzLkZ1bmN0aW9uRXhwcmVzc2lvbiA9IGhhbmRsZXJzLkZ1bmN0aW9uRGVjbGFyYXRpb247XG5oYW5kbGVycy5DbGFzc0V4cHJlc3Npb24gPSBoYW5kbGVycy5DbGFzc0RlY2xhcmF0aW9uO1xuaGFuZGxlcnMuQ2xhc3NCb2R5ID0gaGFuZGxlcnMuQmxvY2tTdGF0ZW1lbnQ7XG5oYW5kbGVycy5TcHJlYWRFbGVtZW50ID0gaGFuZGxlcnMuUmVzdEVsZW1lbnQ7XG5oYW5kbGVycy5BcnJheVBhdHRlcm4gPSBoYW5kbGVycy5BcnJheUV4cHJlc3Npb247XG5oYW5kbGVycy5Mb2dpY2FsRXhwcmVzc2lvbiA9IGhhbmRsZXJzLkJpbmFyeUV4cHJlc3Npb247XG5oYW5kbGVycy5Bc3NpZ25tZW50UGF0dGVybiA9IGhhbmRsZXJzLkFzc2lnbm1lbnRFeHByZXNzaW9uO1xuXG52YXIgY2hhclRvSW50ZWdlciA9IHt9O1xudmFyIGNoYXJzID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89JztcbmZvciAodmFyIGkgPSAwOyBpIDwgY2hhcnMubGVuZ3RoOyBpKyspIHtcbiAgICBjaGFyVG9JbnRlZ2VyW2NoYXJzLmNoYXJDb2RlQXQoaSldID0gaTtcbn1cbmZ1bmN0aW9uIGRlY29kZShtYXBwaW5ncykge1xuICAgIHZhciBkZWNvZGVkID0gW107XG4gICAgdmFyIGxpbmUgPSBbXTtcbiAgICB2YXIgc2VnbWVudCA9IFtcbiAgICAgICAgMCxcbiAgICAgICAgMCxcbiAgICAgICAgMCxcbiAgICAgICAgMCxcbiAgICAgICAgMCxcbiAgICBdO1xuICAgIHZhciBqID0gMDtcbiAgICBmb3IgKHZhciBpID0gMCwgc2hpZnQgPSAwLCB2YWx1ZSA9IDA7IGkgPCBtYXBwaW5ncy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgYyA9IG1hcHBpbmdzLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgIGlmIChjID09PSA0NCkgeyAvLyBcIixcIlxuICAgICAgICAgICAgc2VnbWVudGlmeShsaW5lLCBzZWdtZW50LCBqKTtcbiAgICAgICAgICAgIGogPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGMgPT09IDU5KSB7IC8vIFwiO1wiXG4gICAgICAgICAgICBzZWdtZW50aWZ5KGxpbmUsIHNlZ21lbnQsIGopO1xuICAgICAgICAgICAgaiA9IDA7XG4gICAgICAgICAgICBkZWNvZGVkLnB1c2gobGluZSk7XG4gICAgICAgICAgICBsaW5lID0gW107XG4gICAgICAgICAgICBzZWdtZW50WzBdID0gMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBpbnRlZ2VyID0gY2hhclRvSW50ZWdlcltjXTtcbiAgICAgICAgICAgIGlmIChpbnRlZ2VyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY2hhcmFjdGVyICgnICsgU3RyaW5nLmZyb21DaGFyQ29kZShjKSArICcpJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaGFzQ29udGludWF0aW9uQml0ID0gaW50ZWdlciAmIDMyO1xuICAgICAgICAgICAgaW50ZWdlciAmPSAzMTtcbiAgICAgICAgICAgIHZhbHVlICs9IGludGVnZXIgPDwgc2hpZnQ7XG4gICAgICAgICAgICBpZiAoaGFzQ29udGludWF0aW9uQml0KSB7XG4gICAgICAgICAgICAgICAgc2hpZnQgKz0gNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBzaG91bGROZWdhdGUgPSB2YWx1ZSAmIDE7XG4gICAgICAgICAgICAgICAgdmFsdWUgPj4+PSAxO1xuICAgICAgICAgICAgICAgIGlmIChzaG91bGROZWdhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSA9PT0gMCA/IC0weDgwMDAwMDAwIDogLXZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZWdtZW50W2pdICs9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHNoaWZ0ID0gMDsgLy8gcmVzZXRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBzZWdtZW50aWZ5KGxpbmUsIHNlZ21lbnQsIGopO1xuICAgIGRlY29kZWQucHVzaChsaW5lKTtcbiAgICByZXR1cm4gZGVjb2RlZDtcbn1cbmZ1bmN0aW9uIHNlZ21lbnRpZnkobGluZSwgc2VnbWVudCwgaikge1xuICAgIC8vIFRoaXMgbG9va3MgdWdseSwgYnV0IHdlJ3JlIGNyZWF0aW5nIHNwZWNpYWxpemVkIGFycmF5cyB3aXRoIGEgc3BlY2lmaWNcbiAgICAvLyBsZW5ndGguIFRoaXMgaXMgbXVjaCBmYXN0ZXIgdGhhbiBjcmVhdGluZyBhIG5ldyBhcnJheSAod2hpY2ggdjggZXhwYW5kcyB0b1xuICAgIC8vIGEgY2FwYWNpdHkgb2YgMTcgYWZ0ZXIgcHVzaGluZyB0aGUgZmlyc3QgaXRlbSksIG9yIHNsaWNpbmcgb3V0IGEgc3ViYXJyYXlcbiAgICAvLyAod2hpY2ggaXMgc2xvdykuIExlbmd0aCA0IGlzIGFzc3VtZWQgdG8gYmUgdGhlIG1vc3QgZnJlcXVlbnQsIGZvbGxvd2VkIGJ5XG4gICAgLy8gbGVuZ3RoIDUgKHNpbmNlIG5vdCBldmVyeXRoaW5nIHdpbGwgaGF2ZSBhbiBhc3NvY2lhdGVkIG5hbWUpLCBmb2xsb3dlZCBieVxuICAgIC8vIGxlbmd0aCAxIChpdCdzIHByb2JhYmx5IHJhcmUgZm9yIGEgc291cmNlIHN1YnN0cmluZyB0byBub3QgaGF2ZSBhblxuICAgIC8vIGFzc29jaWF0ZWQgc2VnbWVudCBkYXRhKS5cbiAgICBpZiAoaiA9PT0gNClcbiAgICAgICAgbGluZS5wdXNoKFtzZWdtZW50WzBdLCBzZWdtZW50WzFdLCBzZWdtZW50WzJdLCBzZWdtZW50WzNdXSk7XG4gICAgZWxzZSBpZiAoaiA9PT0gNSlcbiAgICAgICAgbGluZS5wdXNoKFtzZWdtZW50WzBdLCBzZWdtZW50WzFdLCBzZWdtZW50WzJdLCBzZWdtZW50WzNdLCBzZWdtZW50WzRdXSk7XG4gICAgZWxzZSBpZiAoaiA9PT0gMSlcbiAgICAgICAgbGluZS5wdXNoKFtzZWdtZW50WzBdXSk7XG59XG5mdW5jdGlvbiBlbmNvZGUoZGVjb2RlZCkge1xuICAgIHZhciBzb3VyY2VGaWxlSW5kZXggPSAwOyAvLyBzZWNvbmQgZmllbGRcbiAgICB2YXIgc291cmNlQ29kZUxpbmUgPSAwOyAvLyB0aGlyZCBmaWVsZFxuICAgIHZhciBzb3VyY2VDb2RlQ29sdW1uID0gMDsgLy8gZm91cnRoIGZpZWxkXG4gICAgdmFyIG5hbWVJbmRleCA9IDA7IC8vIGZpZnRoIGZpZWxkXG4gICAgdmFyIG1hcHBpbmdzID0gJyc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWNvZGVkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBsaW5lID0gZGVjb2RlZFtpXTtcbiAgICAgICAgaWYgKGkgPiAwKVxuICAgICAgICAgICAgbWFwcGluZ3MgKz0gJzsnO1xuICAgICAgICBpZiAobGluZS5sZW5ndGggPT09IDApXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgdmFyIGdlbmVyYXRlZENvZGVDb2x1bW4gPSAwOyAvLyBmaXJzdCBmaWVsZFxuICAgICAgICB2YXIgbGluZU1hcHBpbmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgbGluZV8xID0gbGluZTsgX2kgPCBsaW5lXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICB2YXIgc2VnbWVudCA9IGxpbmVfMVtfaV07XG4gICAgICAgICAgICB2YXIgc2VnbWVudE1hcHBpbmdzID0gZW5jb2RlSW50ZWdlcihzZWdtZW50WzBdIC0gZ2VuZXJhdGVkQ29kZUNvbHVtbik7XG4gICAgICAgICAgICBnZW5lcmF0ZWRDb2RlQ29sdW1uID0gc2VnbWVudFswXTtcbiAgICAgICAgICAgIGlmIChzZWdtZW50Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBzZWdtZW50TWFwcGluZ3MgKz1cbiAgICAgICAgICAgICAgICAgICAgZW5jb2RlSW50ZWdlcihzZWdtZW50WzFdIC0gc291cmNlRmlsZUluZGV4KSArXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVJbnRlZ2VyKHNlZ21lbnRbMl0gLSBzb3VyY2VDb2RlTGluZSkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlSW50ZWdlcihzZWdtZW50WzNdIC0gc291cmNlQ29kZUNvbHVtbik7XG4gICAgICAgICAgICAgICAgc291cmNlRmlsZUluZGV4ID0gc2VnbWVudFsxXTtcbiAgICAgICAgICAgICAgICBzb3VyY2VDb2RlTGluZSA9IHNlZ21lbnRbMl07XG4gICAgICAgICAgICAgICAgc291cmNlQ29kZUNvbHVtbiA9IHNlZ21lbnRbM107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VnbWVudC5sZW5ndGggPT09IDUpIHtcbiAgICAgICAgICAgICAgICBzZWdtZW50TWFwcGluZ3MgKz0gZW5jb2RlSW50ZWdlcihzZWdtZW50WzRdIC0gbmFtZUluZGV4KTtcbiAgICAgICAgICAgICAgICBuYW1lSW5kZXggPSBzZWdtZW50WzRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGluZU1hcHBpbmdzLnB1c2goc2VnbWVudE1hcHBpbmdzKTtcbiAgICAgICAgfVxuICAgICAgICBtYXBwaW5ncyArPSBsaW5lTWFwcGluZ3Muam9pbignLCcpO1xuICAgIH1cbiAgICByZXR1cm4gbWFwcGluZ3M7XG59XG5mdW5jdGlvbiBlbmNvZGVJbnRlZ2VyKG51bSkge1xuICAgIHZhciByZXN1bHQgPSAnJztcbiAgICBudW0gPSBudW0gPCAwID8gKC1udW0gPDwgMSkgfCAxIDogbnVtIDw8IDE7XG4gICAgZG8ge1xuICAgICAgICB2YXIgY2xhbXBlZCA9IG51bSAmIDMxO1xuICAgICAgICBudW0gPj4+PSA1O1xuICAgICAgICBpZiAobnVtID4gMCkge1xuICAgICAgICAgICAgY2xhbXBlZCB8PSAzMjtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQgKz0gY2hhcnNbY2xhbXBlZF07XG4gICAgfSB3aGlsZSAobnVtID4gMCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqIEB0eXBlIHsoc3RyPzogc3RyaW5nKSA9PiBzdHJpbmd9IHN0ciAqL1xubGV0IGJ0b2EkMSA9ICgpID0+IHtcblx0dGhyb3cgbmV3IEVycm9yKCdVbnN1cHBvcnRlZCBlbnZpcm9ubWVudDogYHdpbmRvdy5idG9hYCBvciBgQnVmZmVyYCBzaG91bGQgYmUgc3VwcG9ydGVkLicpO1xufTtcblxuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cuYnRvYSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRidG9hJDEgPSAoc3RyKSA9PiB3aW5kb3cuYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoc3RyKSkpO1xufSBlbHNlIGlmICh0eXBlb2YgQnVmZmVyID09PSAnZnVuY3Rpb24nKSB7XG5cdGJ0b2EkMSA9IChzdHIpID0+IEJ1ZmZlci5mcm9tKHN0ciwgJ3V0Zi04JykudG9TdHJpbmcoJ2Jhc2U2NCcpO1xufVxuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuTm9kZX0gTm9kZSAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHt7XG4gKiAgIGZpbGU/OiBzdHJpbmc7XG4gKiAgIHNvdXJjZU1hcFNvdXJjZT86IHN0cmluZztcbiAqICAgc291cmNlTWFwQ29udGVudD86IHN0cmluZztcbiAqICAgc291cmNlTWFwRW5jb2RlTWFwcGluZ3M/OiBib29sZWFuOyAvLyBkZWZhdWx0IHRydWVcbiAqICAgZ2V0TmFtZT86IChuYW1lOiBzdHJpbmcpID0+IHN0cmluZztcbiAqIH19IFByaW50T3B0aW9uc1xuICovXG5cbi8qKlxuICogQHBhcmFtIHtOb2RlfSBub2RlXG4gKiBAcGFyYW0ge1ByaW50T3B0aW9uc30gb3B0c1xuICogQHJldHVybnMge3sgY29kZTogc3RyaW5nLCBtYXA6IGFueSB9fSAvLyBUT0RPXG4gKi9cbmZ1bmN0aW9uIHByaW50KG5vZGUsIG9wdHMgPSB7fSkge1xuXHRpZiAoQXJyYXkuaXNBcnJheShub2RlKSkge1xuXHRcdHJldHVybiBwcmludCh7XG5cdFx0XHR0eXBlOiAnUHJvZ3JhbScsXG5cdFx0XHRib2R5OiBub2RlLFxuXHRcdFx0c291cmNlVHlwZTogJ21vZHVsZSdcblx0XHR9LCBvcHRzKTtcblx0fVxuXG5cdGNvbnN0IHtcblx0XHRnZXROYW1lID0gLyoqIEBwYXJhbSB7c3RyaW5nfSB4ICovICh4KSA9PiB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYFVuaGFuZGxlZCBzaWdpbCBAJHt4fWApO1xuXHRcdH1cblx0fSA9IG9wdHM7XG5cblx0bGV0IHsgbWFwOiBzY29wZV9tYXAsIHNjb3BlIH0gPSBhbmFseXplKG5vZGUpO1xuXHRjb25zdCBkZWNvbmZsaWN0ZWQgPSBuZXcgV2Vha01hcCgpO1xuXG5cdGNvbnN0IGNodW5rcyA9IGhhbmRsZShub2RlLCB7XG5cdFx0aW5kZW50OiAnJyxcblx0XHRnZXROYW1lLFxuXHRcdHNjb3BlLFxuXHRcdHNjb3BlX21hcCxcblx0XHRkZWNvbmZsaWN0ZWQsXG5cdFx0Y29tbWVudHM6IFtdXG5cdH0pO1xuXG5cdC8qKiBAdHlwZWRlZiB7W251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl19IFNlZ21lbnQgKi9cblxuXHRsZXQgY29kZSA9ICcnO1xuXHRsZXQgY3VycmVudF9jb2x1bW4gPSAwO1xuXG5cdC8qKiBAdHlwZSB7U2VnbWVudFtdW119ICovXG5cdGxldCBtYXBwaW5ncyA9IFtdO1xuXG5cdC8qKiBAdHlwZSB7U2VnbWVudFtdfSAqL1xuXHRsZXQgY3VycmVudF9saW5lID0gW107XG5cblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBjaHVua3MubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRjb25zdCBjaHVuayA9IGNodW5rc1tpXTtcblxuXHRcdGNvZGUgKz0gY2h1bmsuY29udGVudDtcblxuXHRcdGlmIChjaHVuay5sb2MpIHtcblx0XHRcdGN1cnJlbnRfbGluZS5wdXNoKFtcblx0XHRcdFx0Y3VycmVudF9jb2x1bW4sXG5cdFx0XHRcdDAsIC8vIHNvdXJjZSBpbmRleCBpcyBhbHdheXMgemVyb1xuXHRcdFx0XHRjaHVuay5sb2Muc3RhcnQubGluZSAtIDEsXG5cdFx0XHRcdGNodW5rLmxvYy5zdGFydC5jb2x1bW4sXG5cdFx0XHRdKTtcblx0XHR9XG5cblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGNodW5rLmNvbnRlbnQubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdGlmIChjaHVuay5jb250ZW50W2ldID09PSAnXFxuJykge1xuXHRcdFx0XHRtYXBwaW5ncy5wdXNoKGN1cnJlbnRfbGluZSk7XG5cdFx0XHRcdGN1cnJlbnRfbGluZSA9IFtdO1xuXHRcdFx0XHRjdXJyZW50X2NvbHVtbiA9IDA7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjdXJyZW50X2NvbHVtbiArPSAxO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChjaHVuay5sb2MpIHtcblx0XHRcdGN1cnJlbnRfbGluZS5wdXNoKFtcblx0XHRcdFx0Y3VycmVudF9jb2x1bW4sXG5cdFx0XHRcdDAsIC8vIHNvdXJjZSBpbmRleCBpcyBhbHdheXMgemVyb1xuXHRcdFx0XHRjaHVuay5sb2MuZW5kLmxpbmUgLSAxLFxuXHRcdFx0XHRjaHVuay5sb2MuZW5kLmNvbHVtbixcblx0XHRcdF0pO1xuXHRcdH1cblx0fVxuXG5cdG1hcHBpbmdzLnB1c2goY3VycmVudF9saW5lKTtcblxuXHRjb25zdCBtYXAgPSB7XG5cdFx0dmVyc2lvbjogMyxcblx0XHQvKiogQHR5cGUge3N0cmluZ1tdfSAqL1xuXHRcdG5hbWVzOiBbXSxcblx0XHRzb3VyY2VzOiBbb3B0cy5zb3VyY2VNYXBTb3VyY2UgfHwgbnVsbF0sXG5cdFx0c291cmNlc0NvbnRlbnQ6IFtvcHRzLnNvdXJjZU1hcENvbnRlbnQgfHwgbnVsbF0sXG5cdFx0bWFwcGluZ3M6IG9wdHMuc291cmNlTWFwRW5jb2RlTWFwcGluZ3MgPT0gdW5kZWZpbmVkIHx8IG9wdHMuc291cmNlTWFwRW5jb2RlTWFwcGluZ3Ncblx0XHRcdD8gZW5jb2RlKG1hcHBpbmdzKSA6IG1hcHBpbmdzXG5cdH07XG5cblx0T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobWFwLCB7XG5cdFx0dG9TdHJpbmc6IHtcblx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxuXHRcdFx0dmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nKCkge1xuXHRcdFx0XHRyZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcyk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHR0b1VybDoge1xuXHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXG5cdFx0XHR2YWx1ZTogZnVuY3Rpb24gdG9VcmwoKSB7XG5cdFx0XHRcdHJldHVybiAnZGF0YTphcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LCcgKyBidG9hJDEodGhpcy50b1N0cmluZygpKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdHJldHVybiB7XG5cdFx0Y29kZSxcblx0XHRtYXBcblx0fTtcbn1cblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJ2VzdHJlZScpLkV4cHJlc3Npb259IEV4cHJlc3Npb24gKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCdlc3RyZWUnKS5Ob2RlfSBOb2RlICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnZXN0cmVlJykuT2JqZWN0RXhwcmVzc2lvbn0gT2JqZWN0RXhwcmVzc2lvbiAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJ2VzdHJlZScpLlByb3BlcnR5fSBQcm9wZXJ0eSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJ2VzdHJlZScpLlNwcmVhZEVsZW1lbnR9IFNwcmVhZEVsZW1lbnQgKi9cblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vdXRpbHMvY29tbWVudHMnKS5Db21tZW50V2l0aExvY2F0aW9ufSBDb21tZW50V2l0aExvY2F0aW9uICovXG5cbi8qKiBAdHlwZSB7UmVjb3JkPHN0cmluZywgc3RyaW5nPn0gKi9cbmNvbnN0IHNpZ2lscyA9IHtcblx0J0AnOiAnQVQnLFxuXHQnIyc6ICdIQVNIJ1xufTtcblxuLyoqIEBwYXJhbSB7VGVtcGxhdGVTdHJpbmdzQXJyYXl9IHN0cmluZ3MgKi9cbmNvbnN0IGpvaW4kMSA9IChzdHJpbmdzKSA9PiB7XG5cdGxldCBzdHIgPSBzdHJpbmdzWzBdO1xuXHRmb3IgKGxldCBpID0gMTsgaSA8IHN0cmluZ3MubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRzdHIgKz0gYF8ke2lkfV8ke2kgLSAxfV8ke3N0cmluZ3NbaV19YDtcblx0fVxuXHRyZXR1cm4gc3RyLnJlcGxhY2UoXG5cdFx0LyhbQCNdKShcXHcrKS9nLFxuXHRcdChfbSwgc2lnaWwsIG5hbWUpID0+IGBfJHtpZH1fJHtzaWdpbHNbc2lnaWxdfV8ke25hbWV9YFxuXHQpO1xufTtcblxuLyoqXG4gKiBAcGFyYW0ge2FueVtdfSBhcnJheVxuICogQHBhcmFtIHthbnlbXX0gdGFyZ2V0XG4gKi9cbmNvbnN0IGZsYXR0ZW5fYm9keSA9IChhcnJheSwgdGFyZ2V0KSA9PiB7XG5cdGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRjb25zdCBzdGF0ZW1lbnQgPSBhcnJheVtpXTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShzdGF0ZW1lbnQpKSB7XG5cdFx0XHRmbGF0dGVuX2JvZHkoc3RhdGVtZW50LCB0YXJnZXQpO1xuXHRcdFx0Y29udGludWU7XG5cdFx0fVxuXG5cdFx0aWYgKHN0YXRlbWVudC50eXBlID09PSAnRXhwcmVzc2lvblN0YXRlbWVudCcpIHtcblx0XHRcdGlmIChzdGF0ZW1lbnQuZXhwcmVzc2lvbiA9PT0gRU1QVFkpIGNvbnRpbnVlO1xuXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheShzdGF0ZW1lbnQuZXhwcmVzc2lvbikpIHtcblx0XHRcdFx0Ly8gVE9ETyB0aGlzIGlzIGhhY2t0YWN1bGFyXG5cdFx0XHRcdGxldCBub2RlID0gc3RhdGVtZW50LmV4cHJlc3Npb25bMF07XG5cdFx0XHRcdHdoaWxlIChBcnJheS5pc0FycmF5KG5vZGUpKSBub2RlID0gbm9kZVswXTtcblx0XHRcdFx0aWYgKG5vZGUpIG5vZGUubGVhZGluZ0NvbW1lbnRzID0gc3RhdGVtZW50LmxlYWRpbmdDb21tZW50cztcblxuXHRcdFx0XHRmbGF0dGVuX2JvZHkoc3RhdGVtZW50LmV4cHJlc3Npb24sIHRhcmdldCk7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoLyhFeHByZXNzaW9ufExpdGVyYWwpJC8udGVzdChzdGF0ZW1lbnQuZXhwcmVzc2lvbi50eXBlKSkge1xuXHRcdFx0XHR0YXJnZXQucHVzaChzdGF0ZW1lbnQpO1xuXHRcdFx0XHRjb250aW51ZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHN0YXRlbWVudC5sZWFkaW5nQ29tbWVudHMpXG5cdFx0XHRcdHN0YXRlbWVudC5leHByZXNzaW9uLmxlYWRpbmdDb21tZW50cyA9IHN0YXRlbWVudC5sZWFkaW5nQ29tbWVudHM7XG5cdFx0XHRpZiAoc3RhdGVtZW50LnRyYWlsaW5nQ29tbWVudHMpXG5cdFx0XHRcdHN0YXRlbWVudC5leHByZXNzaW9uLnRyYWlsaW5nQ29tbWVudHMgPSBzdGF0ZW1lbnQudHJhaWxpbmdDb21tZW50cztcblxuXHRcdFx0dGFyZ2V0LnB1c2goc3RhdGVtZW50LmV4cHJlc3Npb24pO1xuXHRcdFx0Y29udGludWU7XG5cdFx0fVxuXG5cdFx0dGFyZ2V0LnB1c2goc3RhdGVtZW50KTtcblx0fVxuXG5cdHJldHVybiB0YXJnZXQ7XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7YW55W119IGFycmF5XG4gKiBAcGFyYW0ge2FueVtdfSB0YXJnZXRcbiAqL1xuY29uc3QgZmxhdHRlbl9wcm9wZXJ0aWVzID0gKGFycmF5LCB0YXJnZXQpID0+IHtcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdGNvbnN0IHByb3BlcnR5ID0gYXJyYXlbaV07XG5cblx0XHRpZiAocHJvcGVydHkudmFsdWUgPT09IEVNUFRZKSBjb250aW51ZTtcblxuXHRcdGlmIChwcm9wZXJ0eS5rZXkgPT09IHByb3BlcnR5LnZhbHVlICYmIEFycmF5LmlzQXJyYXkocHJvcGVydHkua2V5KSkge1xuXHRcdFx0ZmxhdHRlbl9wcm9wZXJ0aWVzKHByb3BlcnR5LmtleSwgdGFyZ2V0KTtcblx0XHRcdGNvbnRpbnVlO1xuXHRcdH1cblxuXHRcdHRhcmdldC5wdXNoKHByb3BlcnR5KTtcblx0fVxuXG5cdHJldHVybiB0YXJnZXQ7XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7YW55W119IG5vZGVzXG4gKiBAcGFyYW0ge2FueVtdfSB0YXJnZXRcbiAqL1xuY29uc3QgZmxhdHRlbiQxID0gKG5vZGVzLCB0YXJnZXQpID0+IHtcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdGNvbnN0IG5vZGUgPSBub2Rlc1tpXTtcblxuXHRcdGlmIChub2RlID09PSBFTVBUWSkgY29udGludWU7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShub2RlKSkge1xuXHRcdFx0ZmxhdHRlbiQxKG5vZGUsIHRhcmdldCk7XG5cdFx0XHRjb250aW51ZTtcblx0XHR9XG5cblx0XHR0YXJnZXQucHVzaChub2RlKTtcblx0fVxuXG5cdHJldHVybiB0YXJnZXQ7XG59O1xuXG5jb25zdCBFTVBUWSA9IHsgdHlwZTogJ0VtcHR5JyB9O1xuXG4vKipcbiAqXG4gKiBAcGFyYW0ge0NvbW1lbnRXaXRoTG9jYXRpb25bXX0gY29tbWVudHNcbiAqIEBwYXJhbSB7c3RyaW5nfSByYXdcbiAqIEByZXR1cm5zIHthbnl9XG4gKi9cbmNvbnN0IGFjb3JuX29wdHMgPSAoY29tbWVudHMsIHJhdykgPT4ge1xuXHRjb25zdCB7IG9uQ29tbWVudCB9ID0gZ2V0X2NvbW1lbnRfaGFuZGxlcnMoY29tbWVudHMsIHJhdyk7XG5cdHJldHVybiB7XG5cdFx0ZWNtYVZlcnNpb246IDIwMjAsXG5cdFx0c291cmNlVHlwZTogJ21vZHVsZScsXG5cdFx0YWxsb3dBd2FpdE91dHNpZGVGdW5jdGlvbjogdHJ1ZSxcblx0XHRhbGxvd0ltcG9ydEV4cG9ydEV2ZXJ5d2hlcmU6IHRydWUsXG5cdFx0YWxsb3dSZXR1cm5PdXRzaWRlRnVuY3Rpb246IHRydWUsXG5cdFx0b25Db21tZW50XG5cdH07XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSByYXdcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHBhcmFtIHthbnlbXX0gdmFsdWVzXG4gKiBAcGFyYW0ge0NvbW1lbnRXaXRoTG9jYXRpb25bXX0gY29tbWVudHNcbiAqL1xuY29uc3QgaW5qZWN0ID0gKHJhdywgbm9kZSwgdmFsdWVzLCBjb21tZW50cykgPT4ge1xuXHRjb21tZW50cy5mb3JFYWNoKChjb21tZW50KSA9PiB7XG5cdFx0Y29tbWVudC52YWx1ZSA9IGNvbW1lbnQudmFsdWUucmVwbGFjZShyZSwgKG0sIGkpID0+XG5cdFx0XHQraSBpbiB2YWx1ZXMgPyB2YWx1ZXNbK2ldIDogbVxuXHRcdCk7XG5cdH0pO1xuXG5cdGNvbnN0IHsgZW50ZXIsIGxlYXZlIH0gPSBnZXRfY29tbWVudF9oYW5kbGVycyhjb21tZW50cywgcmF3KTtcblxuXHRyZXR1cm4gd2Fsayhub2RlLCB7XG5cdFx0ZW50ZXIsXG5cblx0XHQvKiogQHBhcmFtIHthbnl9IG5vZGUgKi9cblx0XHRsZWF2ZShub2RlKSB7XG5cdFx0XHRpZiAobm9kZS50eXBlID09PSAnSWRlbnRpZmllcicpIHtcblx0XHRcdFx0cmUubGFzdEluZGV4ID0gMDtcblx0XHRcdFx0Y29uc3QgbWF0Y2ggPSByZS5leGVjKG5vZGUubmFtZSk7XG5cblx0XHRcdFx0aWYgKG1hdGNoKSB7XG5cdFx0XHRcdFx0aWYgKG1hdGNoWzFdKSB7XG5cdFx0XHRcdFx0XHRpZiAoK21hdGNoWzFdIGluIHZhbHVlcykge1xuXHRcdFx0XHRcdFx0XHRsZXQgdmFsdWUgPSB2YWx1ZXNbK21hdGNoWzFdXTtcblxuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuXHRcdFx0XHRcdFx0XHRcdHZhbHVlID0ge1xuXHRcdFx0XHRcdFx0XHRcdFx0dHlwZTogJ0lkZW50aWZpZXInLFxuXHRcdFx0XHRcdFx0XHRcdFx0bmFtZTogdmFsdWUsXG5cdFx0XHRcdFx0XHRcdFx0XHRsZWFkaW5nQ29tbWVudHM6IG5vZGUubGVhZGluZ0NvbW1lbnRzLFxuXHRcdFx0XHRcdFx0XHRcdFx0dHJhaWxpbmdDb21tZW50czogbm9kZS50cmFpbGluZ0NvbW1lbnRzXG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFsdWUgPSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR0eXBlOiAnTGl0ZXJhbCcsXG5cdFx0XHRcdFx0XHRcdFx0XHR2YWx1ZSxcblx0XHRcdFx0XHRcdFx0XHRcdGxlYWRpbmdDb21tZW50czogbm9kZS5sZWFkaW5nQ29tbWVudHMsXG5cdFx0XHRcdFx0XHRcdFx0XHR0cmFpbGluZ0NvbW1lbnRzOiBub2RlLnRyYWlsaW5nQ29tbWVudHNcblx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0dGhpcy5yZXBsYWNlKHZhbHVlIHx8IEVNUFRZKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bm9kZS5uYW1lID0gYCR7bWF0Y2hbMl0gPyBgQGAgOiBgI2B9JHttYXRjaFs0XX1gO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAobm9kZS50eXBlID09PSAnTGl0ZXJhbCcpIHtcblx0XHRcdFx0aWYgKHR5cGVvZiBub2RlLnZhbHVlID09PSAnc3RyaW5nJykge1xuXHRcdFx0XHRcdHJlLmxhc3RJbmRleCA9IDA7XG5cdFx0XHRcdFx0Y29uc3QgbmV3X3ZhbHVlID0gLyoqIEB0eXBlIHtzdHJpbmd9ICovIChub2RlLnZhbHVlKS5yZXBsYWNlKFxuXHRcdFx0XHRcdFx0cmUsXG5cdFx0XHRcdFx0XHQobSwgaSkgPT4gKCtpIGluIHZhbHVlcyA/IHZhbHVlc1sraV0gOiBtKVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0Y29uc3QgaGFzX2NoYW5nZWQgPSBuZXdfdmFsdWUgIT09IG5vZGUudmFsdWU7XG5cdFx0XHRcdFx0bm9kZS52YWx1ZSA9IG5ld192YWx1ZTtcblx0XHRcdFx0XHRpZiAoaGFzX2NoYW5nZWQgJiYgbm9kZS5yYXcpIHtcblx0XHRcdFx0XHRcdC8vIHByZXNlcnZlIHRoZSBxdW90ZXNcblx0XHRcdFx0XHRcdG5vZGUucmF3ID0gYCR7bm9kZS5yYXdbMF19JHtKU09OLnN0cmluZ2lmeShub2RlLnZhbHVlKS5zbGljZShcblx0XHRcdFx0XHRcdFx0MSxcblx0XHRcdFx0XHRcdFx0LTFcblx0XHRcdFx0XHRcdCl9JHtub2RlLnJhd1tub2RlLnJhdy5sZW5ndGggLSAxXX1gO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAobm9kZS50eXBlID09PSAnVGVtcGxhdGVFbGVtZW50Jykge1xuXHRcdFx0XHRyZS5sYXN0SW5kZXggPSAwO1xuXHRcdFx0XHRub2RlLnZhbHVlLnJhdyA9IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAobm9kZS52YWx1ZS5yYXcpLnJlcGxhY2UoXG5cdFx0XHRcdFx0cmUsXG5cdFx0XHRcdFx0KG0sIGkpID0+ICgraSBpbiB2YWx1ZXMgPyB2YWx1ZXNbK2ldIDogbSlcblx0XHRcdFx0KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG5vZGUudHlwZSA9PT0gJ1Byb2dyYW0nIHx8IG5vZGUudHlwZSA9PT0gJ0Jsb2NrU3RhdGVtZW50Jykge1xuXHRcdFx0XHRub2RlLmJvZHkgPSBmbGF0dGVuX2JvZHkobm9kZS5ib2R5LCBbXSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChub2RlLnR5cGUgPT09ICdPYmplY3RFeHByZXNzaW9uJyB8fCBub2RlLnR5cGUgPT09ICdPYmplY3RQYXR0ZXJuJykge1xuXHRcdFx0XHRub2RlLnByb3BlcnRpZXMgPSBmbGF0dGVuX3Byb3BlcnRpZXMobm9kZS5wcm9wZXJ0aWVzLCBbXSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChub2RlLnR5cGUgPT09ICdBcnJheUV4cHJlc3Npb24nIHx8IG5vZGUudHlwZSA9PT0gJ0FycmF5UGF0dGVybicpIHtcblx0XHRcdFx0bm9kZS5lbGVtZW50cyA9IGZsYXR0ZW4kMShub2RlLmVsZW1lbnRzLCBbXSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChcblx0XHRcdFx0bm9kZS50eXBlID09PSAnRnVuY3Rpb25FeHByZXNzaW9uJyB8fFxuXHRcdFx0XHRub2RlLnR5cGUgPT09ICdGdW5jdGlvbkRlY2xhcmF0aW9uJyB8fFxuXHRcdFx0XHRub2RlLnR5cGUgPT09ICdBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbidcblx0XHRcdCkge1xuXHRcdFx0XHRub2RlLnBhcmFtcyA9IGZsYXR0ZW4kMShub2RlLnBhcmFtcywgW10pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAobm9kZS50eXBlID09PSAnQ2FsbEV4cHJlc3Npb24nIHx8IG5vZGUudHlwZSA9PT0gJ05ld0V4cHJlc3Npb24nKSB7XG5cdFx0XHRcdG5vZGUuYXJndW1lbnRzID0gZmxhdHRlbiQxKG5vZGUuYXJndW1lbnRzLCBbXSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChcblx0XHRcdFx0bm9kZS50eXBlID09PSAnSW1wb3J0RGVjbGFyYXRpb24nIHx8XG5cdFx0XHRcdG5vZGUudHlwZSA9PT0gJ0V4cG9ydE5hbWVkRGVjbGFyYXRpb24nXG5cdFx0XHQpIHtcblx0XHRcdFx0bm9kZS5zcGVjaWZpZXJzID0gZmxhdHRlbiQxKG5vZGUuc3BlY2lmaWVycywgW10pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAobm9kZS50eXBlID09PSAnRm9yU3RhdGVtZW50Jykge1xuXHRcdFx0XHRub2RlLmluaXQgPSBub2RlLmluaXQgPT09IEVNUFRZID8gbnVsbCA6IG5vZGUuaW5pdDtcblx0XHRcdFx0bm9kZS50ZXN0ID0gbm9kZS50ZXN0ID09PSBFTVBUWSA/IG51bGwgOiBub2RlLnRlc3Q7XG5cdFx0XHRcdG5vZGUudXBkYXRlID0gbm9kZS51cGRhdGUgPT09IEVNUFRZID8gbnVsbCA6IG5vZGUudXBkYXRlO1xuXHRcdFx0fVxuXG5cdFx0XHRsZWF2ZShub2RlKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKlxuICogQHBhcmFtIHtUZW1wbGF0ZVN0cmluZ3NBcnJheX0gc3RyaW5nc1xuICogQHBhcmFtICB7YW55W119IHZhbHVlc1xuICogQHJldHVybnMge05vZGVbXX1cbiAqL1xuZnVuY3Rpb24gYihzdHJpbmdzLCAuLi52YWx1ZXMpIHtcblx0Y29uc3Qgc3RyID0gam9pbiQxKHN0cmluZ3MpO1xuXG5cdC8qKiBAdHlwZSB7Q29tbWVudFdpdGhMb2NhdGlvbltdfSAqL1xuXHRjb25zdCBjb21tZW50cyA9IFtdO1xuXG5cdHRyeSB7XG5cdFx0bGV0IGFzdCA9IC8qKiBAdHlwZSB7YW55fSAqLyAoXG5cdFx0XHRwYXJzZShzdHIsIGFjb3JuX29wdHMoY29tbWVudHMsIHN0cikpXG5cdFx0KTtcblxuXHRcdGFzdCA9IGluamVjdChzdHIsIGFzdCwgdmFsdWVzLCBjb21tZW50cyk7XG5cblx0XHRyZXR1cm4gYXN0LmJvZHk7XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdGhhbmRsZV9lcnJvcihzdHIsIGVycik7XG5cdH1cbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIHtUZW1wbGF0ZVN0cmluZ3NBcnJheX0gc3RyaW5nc1xuICogQHBhcmFtICB7YW55W119IHZhbHVlc1xuICogQHJldHVybnMge0V4cHJlc3Npb24gJiB7IHN0YXJ0OiBOdW1iZXIsIGVuZDogbnVtYmVyIH19XG4gKi9cbmZ1bmN0aW9uIHgoc3RyaW5ncywgLi4udmFsdWVzKSB7XG5cdGNvbnN0IHN0ciA9IGpvaW4kMShzdHJpbmdzKTtcblxuXHQvKiogQHR5cGUge0NvbW1lbnRXaXRoTG9jYXRpb25bXX0gKi9cblx0Y29uc3QgY29tbWVudHMgPSBbXTtcblxuXHR0cnkge1xuXHRcdGxldCBleHByZXNzaW9uID1cblx0XHRcdC8qKiBAdHlwZSB7RXhwcmVzc2lvbiAmIHsgc3RhcnQ6IE51bWJlciwgZW5kOiBudW1iZXIgfX0gKi8gKFxuXHRcdFx0XHRwYXJzZUV4cHJlc3Npb25BdChzdHIsIDAsIGFjb3JuX29wdHMoY29tbWVudHMsIHN0cikpXG5cdFx0XHQpO1xuXHRcdGNvbnN0IG1hdGNoID0gL1xcUysvLmV4ZWMoc3RyLnNsaWNlKGV4cHJlc3Npb24uZW5kKSk7XG5cdFx0aWYgKG1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYFVuZXhwZWN0ZWQgdG9rZW4gJyR7bWF0Y2hbMF19J2ApO1xuXHRcdH1cblxuXHRcdGV4cHJlc3Npb24gPSAvKiogQHR5cGUge0V4cHJlc3Npb24gJiB7IHN0YXJ0OiBOdW1iZXIsIGVuZDogbnVtYmVyIH19ICovIChcblx0XHRcdGluamVjdChzdHIsIGV4cHJlc3Npb24sIHZhbHVlcywgY29tbWVudHMpXG5cdFx0KTtcblxuXHRcdHJldHVybiBleHByZXNzaW9uO1xuXHR9IGNhdGNoIChlcnIpIHtcblx0XHRoYW5kbGVfZXJyb3Ioc3RyLCBlcnIpO1xuXHR9XG59XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7VGVtcGxhdGVTdHJpbmdzQXJyYXl9IHN0cmluZ3NcbiAqIEBwYXJhbSAge2FueVtdfSB2YWx1ZXNcbiAqIEByZXR1cm5zIHsoUHJvcGVydHkgfCBTcHJlYWRFbGVtZW50KSAmIHsgc3RhcnQ6IE51bWJlciwgZW5kOiBudW1iZXIgfX1cbiAqL1xuZnVuY3Rpb24gcChzdHJpbmdzLCAuLi52YWx1ZXMpIHtcblx0Y29uc3Qgc3RyID0gYHske2pvaW4kMShzdHJpbmdzKX19YDtcblxuXHQvKiogQHR5cGUge0NvbW1lbnRXaXRoTG9jYXRpb25bXX0gKi9cblx0Y29uc3QgY29tbWVudHMgPSBbXTtcblxuXHR0cnkge1xuXHRcdGxldCBleHByZXNzaW9uID0gLyoqIEB0eXBlIHthbnl9ICovIChcblx0XHRcdHBhcnNlRXhwcmVzc2lvbkF0KHN0ciwgMCwgYWNvcm5fb3B0cyhjb21tZW50cywgc3RyKSlcblx0XHQpO1xuXG5cdFx0ZXhwcmVzc2lvbiA9IGluamVjdChzdHIsIGV4cHJlc3Npb24sIHZhbHVlcywgY29tbWVudHMpO1xuXG5cdFx0cmV0dXJuIGV4cHJlc3Npb24ucHJvcGVydGllc1swXTtcblx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0aGFuZGxlX2Vycm9yKHN0ciwgZXJyKTtcblx0fVxufVxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJcbiAqIEBwYXJhbSB7RXJyb3J9IGVyclxuICovXG5mdW5jdGlvbiBoYW5kbGVfZXJyb3Ioc3RyLCBlcnIpIHtcblx0Ly8gVE9ETyBsb2NhdGlvbi9jb2RlIGZyYW1lXG5cblx0cmUubGFzdEluZGV4ID0gMDtcblxuXHRzdHIgPSBzdHIucmVwbGFjZShyZSwgKG0sIGksIGF0LCBoYXNoLCBuYW1lKSA9PiB7XG5cdFx0aWYgKGF0KSByZXR1cm4gYEAke25hbWV9YDtcblx0XHRpZiAoaGFzaCkgcmV0dXJuIGAjJHtuYW1lfWA7XG5cblx0XHRyZXR1cm4gJyR7Li4ufSc7XG5cdH0pO1xuXG5cdGNvbnNvbGUubG9nKGBmYWlsZWQgdG8gcGFyc2U6XFxuJHtzdHJ9YCk7XG5cdHRocm93IGVycjtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gc291cmNlXG4gKiBAcGFyYW0ge2FueX0gb3B0c1xuICovXG5jb25zdCBwYXJzZSQxID0gKHNvdXJjZSwgb3B0cykgPT4ge1xuXHQvKiogQHR5cGUge0NvbW1lbnRXaXRoTG9jYXRpb25bXX0gKi9cblx0Y29uc3QgY29tbWVudHMgPSBbXTtcblx0Y29uc3QgeyBvbkNvbW1lbnQsIGVudGVyLCBsZWF2ZSB9ID0gZ2V0X2NvbW1lbnRfaGFuZGxlcnMoY29tbWVudHMsIHNvdXJjZSk7XG5cdGNvbnN0IGFzdCA9IC8qKiBAdHlwZSB7YW55fSAqLyAocGFyc2Uoc291cmNlLCB7IG9uQ29tbWVudCwgLi4ub3B0cyB9KSk7XG5cdHdhbGsoYXN0LCB7IGVudGVyLCBsZWF2ZSB9KTtcblx0cmV0dXJuIGFzdDtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHNvdXJjZVxuICogQHBhcmFtIHtudW1iZXJ9IGluZGV4XG4gKiBAcGFyYW0ge2FueX0gb3B0c1xuICovXG5jb25zdCBwYXJzZUV4cHJlc3Npb25BdCQxID0gKHNvdXJjZSwgaW5kZXgsIG9wdHMpID0+IHtcblx0LyoqIEB0eXBlIHtDb21tZW50V2l0aExvY2F0aW9uW119ICovXG5cdGNvbnN0IGNvbW1lbnRzID0gW107XG5cdGNvbnN0IHsgb25Db21tZW50LCBlbnRlciwgbGVhdmUgfSA9IGdldF9jb21tZW50X2hhbmRsZXJzKGNvbW1lbnRzLCBzb3VyY2UpO1xuXHRjb25zdCBhc3QgPSAvKiogQHR5cGUge2FueX0gKi8gKFxuXHRcdHBhcnNlRXhwcmVzc2lvbkF0KHNvdXJjZSwgaW5kZXgsIHsgb25Db21tZW50LCAuLi5vcHRzIH0pXG5cdCk7XG5cdHdhbGsoYXN0LCB7IGVudGVyLCBsZWF2ZSB9KTtcblx0cmV0dXJuIGFzdDtcbn07XG5cbmNvbnN0IHBhcnNlJDIgPSAoc291cmNlKSA9PiBwYXJzZSQxKHNvdXJjZSwge1xuICAgIHNvdXJjZVR5cGU6ICdtb2R1bGUnLFxuICAgIGVjbWFWZXJzaW9uOiAxMixcbiAgICBsb2NhdGlvbnM6IHRydWVcbn0pO1xuY29uc3QgcGFyc2VfZXhwcmVzc2lvbl9hdCA9IChzb3VyY2UsIGluZGV4KSA9PiBwYXJzZUV4cHJlc3Npb25BdCQxKHNvdXJjZSwgaW5kZXgsIHtcbiAgICBzb3VyY2VUeXBlOiAnbW9kdWxlJyxcbiAgICBlY21hVmVyc2lvbjogMTIsXG4gICAgbG9jYXRpb25zOiB0cnVlXG59KTtcblxuY29uc3Qgd2hpdGVzcGFjZSA9IC9bIFxcdFxcclxcbl0vO1xuY29uc3Qgc3RhcnRfd2hpdGVzcGFjZSA9IC9eWyBcXHRcXHJcXG5dKi87XG5jb25zdCBlbmRfd2hpdGVzcGFjZSA9IC9bIFxcdFxcclxcbl0qJC87XG5jb25zdCBkaW1lbnNpb25zID0gL14oPzpvZmZzZXR8Y2xpZW50KSg/OldpZHRofEhlaWdodCkkLztcblxuZnVuY3Rpb24gcmVhZF9leHByZXNzaW9uKHBhcnNlcikge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBwYXJzZV9leHByZXNzaW9uX2F0KHBhcnNlci50ZW1wbGF0ZSwgcGFyc2VyLmluZGV4KTtcbiAgICAgICAgbGV0IG51bV9wYXJlbnMgPSAwO1xuICAgICAgICBmb3IgKGxldCBpID0gcGFyc2VyLmluZGV4OyBpIDwgbm9kZS5zdGFydDsgaSArPSAxKSB7XG4gICAgICAgICAgICBpZiAocGFyc2VyLnRlbXBsYXRlW2ldID09PSAnKCcpXG4gICAgICAgICAgICAgICAgbnVtX3BhcmVucyArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGxldCBpbmRleCA9IG5vZGUuZW5kO1xuICAgICAgICB3aGlsZSAobnVtX3BhcmVucyA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGNoYXIgPSBwYXJzZXIudGVtcGxhdGVbaW5kZXhdO1xuICAgICAgICAgICAgaWYgKGNoYXIgPT09ICcpJykge1xuICAgICAgICAgICAgICAgIG51bV9wYXJlbnMgLT0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCF3aGl0ZXNwYWNlLnRlc3QoY2hhcikpIHtcbiAgICAgICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy51bmV4cGVjdGVkX3Rva2VuKCcpJyksIGluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGluZGV4ICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgcGFyc2VyLmluZGV4ID0gaW5kZXg7XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHBhcnNlci5hY29ybl9lcnJvcihlcnIpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0X2NvbnRleHQocGFyc2VyLCBhdHRyaWJ1dGVzLCBzdGFydCkge1xuICAgIGNvbnN0IGNvbnRleHQgPSBhdHRyaWJ1dGVzLmZpbmQoYXR0cmlidXRlID0+IGF0dHJpYnV0ZS5uYW1lID09PSAnY29udGV4dCcpO1xuICAgIGlmICghY29udGV4dClcbiAgICAgICAgcmV0dXJuICdkZWZhdWx0JztcbiAgICBpZiAoY29udGV4dC52YWx1ZS5sZW5ndGggIT09IDEgfHwgY29udGV4dC52YWx1ZVswXS50eXBlICE9PSAnVGV4dCcpIHtcbiAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMuaW52YWxpZF9zY3JpcHRfY29udGV4dF9hdHRyaWJ1dGUsIHN0YXJ0KTtcbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSBjb250ZXh0LnZhbHVlWzBdLmRhdGE7XG4gICAgaWYgKHZhbHVlICE9PSAnbW9kdWxlJykge1xuICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5pbnZhbGlkX3NjcmlwdF9jb250ZXh0X3ZhbHVlLCBjb250ZXh0LnN0YXJ0KTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gcmVhZF9zY3JpcHQocGFyc2VyLCBzdGFydCwgYXR0cmlidXRlcykge1xuICAgIGNvbnN0IHNjcmlwdF9zdGFydCA9IHBhcnNlci5pbmRleDtcbiAgICBjb25zdCBkYXRhID0gcGFyc2VyLnJlYWRfdW50aWwoLzxcXC9zY3JpcHRcXHMqPi8sIHBhcnNlcl9lcnJvcnMudW5jbG9zZWRfc2NyaXB0KTtcbiAgICBpZiAocGFyc2VyLmluZGV4ID49IHBhcnNlci50ZW1wbGF0ZS5sZW5ndGgpIHtcbiAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMudW5jbG9zZWRfc2NyaXB0KTtcbiAgICB9XG4gICAgY29uc3Qgc291cmNlID0gcGFyc2VyLnRlbXBsYXRlLnNsaWNlKDAsIHNjcmlwdF9zdGFydCkucmVwbGFjZSgvW15cXG5dL2csICcgJykgKyBkYXRhO1xuICAgIHBhcnNlci5yZWFkKC88XFwvc2NyaXB0XFxzKj4vKTtcbiAgICBsZXQgYXN0O1xuICAgIHRyeSB7XG4gICAgICAgIGFzdCA9IHBhcnNlJDIoc291cmNlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycikge1xuICAgICAgICBwYXJzZXIuYWNvcm5fZXJyb3IoZXJyKTtcbiAgICB9XG4gICAgLy8gVE9ETyBpcyB0aGlzIG5lY2Vzc2FyeT9cbiAgICBhc3Quc3RhcnQgPSBzY3JpcHRfc3RhcnQ7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogJ1NjcmlwdCcsXG4gICAgICAgIHN0YXJ0LFxuICAgICAgICBlbmQ6IHBhcnNlci5pbmRleCxcbiAgICAgICAgY29udGV4dDogZ2V0X2NvbnRleHQocGFyc2VyLCBhdHRyaWJ1dGVzLCBzdGFydCksXG4gICAgICAgIGNvbnRlbnQ6IGFzdFxuICAgIH07XG59XG5cbnZhciBNSU5fU0laRSA9IDE2ICogMTAyNDtcbnZhciBTYWZlVWludDMyQXJyYXkgPSB0eXBlb2YgVWludDMyQXJyYXkgIT09ICd1bmRlZmluZWQnID8gVWludDMyQXJyYXkgOiBBcnJheTsgLy8gZmFsbGJhY2sgb24gQXJyYXkgd2hlbiBUeXBlZEFycmF5IGlzIG5vdCBzdXBwb3J0ZWRcblxudmFyIGFkb3B0QnVmZmVyID0gZnVuY3Rpb24gYWRvcHRCdWZmZXIoYnVmZmVyLCBzaXplKSB7XG4gICAgaWYgKGJ1ZmZlciA9PT0gbnVsbCB8fCBidWZmZXIubGVuZ3RoIDwgc2l6ZSkge1xuICAgICAgICByZXR1cm4gbmV3IFNhZmVVaW50MzJBcnJheShNYXRoLm1heChzaXplICsgMTAyNCwgTUlOX1NJWkUpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYnVmZmVyO1xufTtcblxuLy8gQ1NTIFN5bnRheCBNb2R1bGUgTGV2ZWwgM1xuLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy1zeW50YXgtMy9cbnZhciBUWVBFID0ge1xuICAgIEVPRjogMCwgICAgICAgICAgICAgICAgIC8vIDxFT0YtdG9rZW4+XG4gICAgSWRlbnQ6IDEsICAgICAgICAgICAgICAgLy8gPGlkZW50LXRva2VuPlxuICAgIEZ1bmN0aW9uOiAyLCAgICAgICAgICAgIC8vIDxmdW5jdGlvbi10b2tlbj5cbiAgICBBdEtleXdvcmQ6IDMsICAgICAgICAgICAvLyA8YXQta2V5d29yZC10b2tlbj5cbiAgICBIYXNoOiA0LCAgICAgICAgICAgICAgICAvLyA8aGFzaC10b2tlbj5cbiAgICBTdHJpbmc6IDUsICAgICAgICAgICAgICAvLyA8c3RyaW5nLXRva2VuPlxuICAgIEJhZFN0cmluZzogNiwgICAgICAgICAgIC8vIDxiYWQtc3RyaW5nLXRva2VuPlxuICAgIFVybDogNywgICAgICAgICAgICAgICAgIC8vIDx1cmwtdG9rZW4+XG4gICAgQmFkVXJsOiA4LCAgICAgICAgICAgICAgLy8gPGJhZC11cmwtdG9rZW4+XG4gICAgRGVsaW06IDksICAgICAgICAgICAgICAgLy8gPGRlbGltLXRva2VuPlxuICAgIE51bWJlcjogMTAsICAgICAgICAgICAgIC8vIDxudW1iZXItdG9rZW4+XG4gICAgUGVyY2VudGFnZTogMTEsICAgICAgICAgLy8gPHBlcmNlbnRhZ2UtdG9rZW4+XG4gICAgRGltZW5zaW9uOiAxMiwgICAgICAgICAgLy8gPGRpbWVuc2lvbi10b2tlbj5cbiAgICBXaGl0ZVNwYWNlOiAxMywgICAgICAgICAvLyA8d2hpdGVzcGFjZS10b2tlbj5cbiAgICBDRE86IDE0LCAgICAgICAgICAgICAgICAvLyA8Q0RPLXRva2VuPlxuICAgIENEQzogMTUsICAgICAgICAgICAgICAgIC8vIDxDREMtdG9rZW4+XG4gICAgQ29sb246IDE2LCAgICAgICAgICAgICAgLy8gPGNvbG9uLXRva2VuPiAgICAgOlxuICAgIFNlbWljb2xvbjogMTcsICAgICAgICAgIC8vIDxzZW1pY29sb24tdG9rZW4+IDtcbiAgICBDb21tYTogMTgsICAgICAgICAgICAgICAvLyA8Y29tbWEtdG9rZW4+ICAgICAsXG4gICAgTGVmdFNxdWFyZUJyYWNrZXQ6IDE5LCAgLy8gPFstdG9rZW4+XG4gICAgUmlnaHRTcXVhcmVCcmFja2V0OiAyMCwgLy8gPF0tdG9rZW4+XG4gICAgTGVmdFBhcmVudGhlc2lzOiAyMSwgICAgLy8gPCgtdG9rZW4+XG4gICAgUmlnaHRQYXJlbnRoZXNpczogMjIsICAgLy8gPCktdG9rZW4+XG4gICAgTGVmdEN1cmx5QnJhY2tldDogMjMsICAgLy8gPHstdG9rZW4+XG4gICAgUmlnaHRDdXJseUJyYWNrZXQ6IDI0LCAgLy8gPH0tdG9rZW4+XG4gICAgQ29tbWVudDogMjVcbn07XG5cbnZhciBOQU1FID0gT2JqZWN0LmtleXMoVFlQRSkucmVkdWNlKGZ1bmN0aW9uKHJlc3VsdCwga2V5KSB7XG4gICAgcmVzdWx0W1RZUEVba2V5XV0gPSBrZXk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn0sIHt9KTtcblxudmFyIF9jb25zdCA9IHtcbiAgICBUWVBFOiBUWVBFLFxuICAgIE5BTUU6IE5BTUVcbn07XG5cbnZhciBFT0YgPSAwO1xuXG4vLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXN5bnRheC0zL1xuLy8gwqcgNC4yLiBEZWZpbml0aW9uc1xuXG4vLyBkaWdpdFxuLy8gQSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDMwIERJR0lUIFpFUk8gKDApIGFuZCBVKzAwMzkgRElHSVQgTklORSAoOSkuXG5mdW5jdGlvbiBpc0RpZ2l0KGNvZGUpIHtcbiAgICByZXR1cm4gY29kZSA+PSAweDAwMzAgJiYgY29kZSA8PSAweDAwMzk7XG59XG5cbi8vIGhleCBkaWdpdFxuLy8gQSBkaWdpdCwgb3IgYSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDQxIExBVElOIENBUElUQUwgTEVUVEVSIEEgKEEpIGFuZCBVKzAwNDYgTEFUSU4gQ0FQSVRBTCBMRVRURVIgRiAoRiksXG4vLyBvciBhIGNvZGUgcG9pbnQgYmV0d2VlbiBVKzAwNjEgTEFUSU4gU01BTEwgTEVUVEVSIEEgKGEpIGFuZCBVKzAwNjYgTEFUSU4gU01BTEwgTEVUVEVSIEYgKGYpLlxuZnVuY3Rpb24gaXNIZXhEaWdpdCQxKGNvZGUpIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBpc0RpZ2l0KGNvZGUpIHx8IC8vIDAgLi4gOVxuICAgICAgICAoY29kZSA+PSAweDAwNDEgJiYgY29kZSA8PSAweDAwNDYpIHx8IC8vIEEgLi4gRlxuICAgICAgICAoY29kZSA+PSAweDAwNjEgJiYgY29kZSA8PSAweDAwNjYpICAgIC8vIGEgLi4gZlxuICAgICk7XG59XG5cbi8vIHVwcGVyY2FzZSBsZXR0ZXJcbi8vIEEgY29kZSBwb2ludCBiZXR3ZWVuIFUrMDA0MSBMQVRJTiBDQVBJVEFMIExFVFRFUiBBIChBKSBhbmQgVSswMDVBIExBVElOIENBUElUQUwgTEVUVEVSIFogKFopLlxuZnVuY3Rpb24gaXNVcHBlcmNhc2VMZXR0ZXIoY29kZSkge1xuICAgIHJldHVybiBjb2RlID49IDB4MDA0MSAmJiBjb2RlIDw9IDB4MDA1QTtcbn1cblxuLy8gbG93ZXJjYXNlIGxldHRlclxuLy8gQSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDYxIExBVElOIFNNQUxMIExFVFRFUiBBIChhKSBhbmQgVSswMDdBIExBVElOIFNNQUxMIExFVFRFUiBaICh6KS5cbmZ1bmN0aW9uIGlzTG93ZXJjYXNlTGV0dGVyKGNvZGUpIHtcbiAgICByZXR1cm4gY29kZSA+PSAweDAwNjEgJiYgY29kZSA8PSAweDAwN0E7XG59XG5cbi8vIGxldHRlclxuLy8gQW4gdXBwZXJjYXNlIGxldHRlciBvciBhIGxvd2VyY2FzZSBsZXR0ZXIuXG5mdW5jdGlvbiBpc0xldHRlcihjb2RlKSB7XG4gICAgcmV0dXJuIGlzVXBwZXJjYXNlTGV0dGVyKGNvZGUpIHx8IGlzTG93ZXJjYXNlTGV0dGVyKGNvZGUpO1xufVxuXG4vLyBub24tQVNDSUkgY29kZSBwb2ludFxuLy8gQSBjb2RlIHBvaW50IHdpdGggYSB2YWx1ZSBlcXVhbCB0byBvciBncmVhdGVyIHRoYW4gVSswMDgwIDxjb250cm9sPi5cbmZ1bmN0aW9uIGlzTm9uQXNjaWkoY29kZSkge1xuICAgIHJldHVybiBjb2RlID49IDB4MDA4MDtcbn1cblxuLy8gbmFtZS1zdGFydCBjb2RlIHBvaW50XG4vLyBBIGxldHRlciwgYSBub24tQVNDSUkgY29kZSBwb2ludCwgb3IgVSswMDVGIExPVyBMSU5FIChfKS5cbmZ1bmN0aW9uIGlzTmFtZVN0YXJ0KGNvZGUpIHtcbiAgICByZXR1cm4gaXNMZXR0ZXIoY29kZSkgfHwgaXNOb25Bc2NpaShjb2RlKSB8fCBjb2RlID09PSAweDAwNUY7XG59XG5cbi8vIG5hbWUgY29kZSBwb2ludFxuLy8gQSBuYW1lLXN0YXJ0IGNvZGUgcG9pbnQsIGEgZGlnaXQsIG9yIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pLlxuZnVuY3Rpb24gaXNOYW1lKGNvZGUpIHtcbiAgICByZXR1cm4gaXNOYW1lU3RhcnQoY29kZSkgfHwgaXNEaWdpdChjb2RlKSB8fCBjb2RlID09PSAweDAwMkQ7XG59XG5cbi8vIG5vbi1wcmludGFibGUgY29kZSBwb2ludFxuLy8gQSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDAwIE5VTEwgYW5kIFUrMDAwOCBCQUNLU1BBQ0UsIG9yIFUrMDAwQiBMSU5FIFRBQlVMQVRJT04sXG4vLyBvciBhIGNvZGUgcG9pbnQgYmV0d2VlbiBVKzAwMEUgU0hJRlQgT1VUIGFuZCBVKzAwMUYgSU5GT1JNQVRJT04gU0VQQVJBVE9SIE9ORSwgb3IgVSswMDdGIERFTEVURS5cbmZ1bmN0aW9uIGlzTm9uUHJpbnRhYmxlKGNvZGUpIHtcbiAgICByZXR1cm4gKFxuICAgICAgICAoY29kZSA+PSAweDAwMDAgJiYgY29kZSA8PSAweDAwMDgpIHx8XG4gICAgICAgIChjb2RlID09PSAweDAwMEIpIHx8XG4gICAgICAgIChjb2RlID49IDB4MDAwRSAmJiBjb2RlIDw9IDB4MDAxRikgfHxcbiAgICAgICAgKGNvZGUgPT09IDB4MDA3RilcbiAgICApO1xufVxuXG4vLyBuZXdsaW5lXG4vLyBVKzAwMEEgTElORSBGRUVELiBOb3RlIHRoYXQgVSswMDBEIENBUlJJQUdFIFJFVFVSTiBhbmQgVSswMDBDIEZPUk0gRkVFRCBhcmUgbm90IGluY2x1ZGVkIGluIHRoaXMgZGVmaW5pdGlvbixcbi8vIGFzIHRoZXkgYXJlIGNvbnZlcnRlZCB0byBVKzAwMEEgTElORSBGRUVEIGR1cmluZyBwcmVwcm9jZXNzaW5nLlxuLy8gVE9ETzogd2UgZG9lc24ndCBkbyBhIHByZXByb2Nlc3NpbmcsIHNvIGNoZWNrIGEgY29kZSBwb2ludCBmb3IgVSswMDBEIENBUlJJQUdFIFJFVFVSTiBhbmQgVSswMDBDIEZPUk0gRkVFRFxuZnVuY3Rpb24gaXNOZXdsaW5lKGNvZGUpIHtcbiAgICByZXR1cm4gY29kZSA9PT0gMHgwMDBBIHx8IGNvZGUgPT09IDB4MDAwRCB8fCBjb2RlID09PSAweDAwMEM7XG59XG5cbi8vIHdoaXRlc3BhY2Vcbi8vIEEgbmV3bGluZSwgVSswMDA5IENIQVJBQ1RFUiBUQUJVTEFUSU9OLCBvciBVKzAwMjAgU1BBQ0UuXG5mdW5jdGlvbiBpc1doaXRlU3BhY2UoY29kZSkge1xuICAgIHJldHVybiBpc05ld2xpbmUoY29kZSkgfHwgY29kZSA9PT0gMHgwMDIwIHx8IGNvZGUgPT09IDB4MDAwOTtcbn1cblxuLy8gwqcgNC4zLjguIENoZWNrIGlmIHR3byBjb2RlIHBvaW50cyBhcmUgYSB2YWxpZCBlc2NhcGVcbmZ1bmN0aW9uIGlzVmFsaWRFc2NhcGUoZmlyc3QsIHNlY29uZCkge1xuICAgIC8vIElmIHRoZSBmaXJzdCBjb2RlIHBvaW50IGlzIG5vdCBVKzAwNUMgUkVWRVJTRSBTT0xJRFVTIChcXCksIHJldHVybiBmYWxzZS5cbiAgICBpZiAoZmlyc3QgIT09IDB4MDA1Qykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gT3RoZXJ3aXNlLCBpZiB0aGUgc2Vjb25kIGNvZGUgcG9pbnQgaXMgYSBuZXdsaW5lIG9yIEVPRiwgcmV0dXJuIGZhbHNlLlxuICAgIGlmIChpc05ld2xpbmUoc2Vjb25kKSB8fCBzZWNvbmQgPT09IEVPRikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gdHJ1ZS5cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuLy8gwqcgNC4zLjkuIENoZWNrIGlmIHRocmVlIGNvZGUgcG9pbnRzIHdvdWxkIHN0YXJ0IGFuIGlkZW50aWZpZXJcbmZ1bmN0aW9uIGlzSWRlbnRpZmllclN0YXJ0JDEoZmlyc3QsIHNlY29uZCwgdGhpcmQpIHtcbiAgICAvLyBMb29rIGF0IHRoZSBmaXJzdCBjb2RlIHBvaW50OlxuXG4gICAgLy8gVSswMDJEIEhZUEhFTi1NSU5VU1xuICAgIGlmIChmaXJzdCA9PT0gMHgwMDJEKSB7XG4gICAgICAgIC8vIElmIHRoZSBzZWNvbmQgY29kZSBwb2ludCBpcyBhIG5hbWUtc3RhcnQgY29kZSBwb2ludCBvciBhIFUrMDAyRCBIWVBIRU4tTUlOVVMsXG4gICAgICAgIC8vIG9yIHRoZSBzZWNvbmQgYW5kIHRoaXJkIGNvZGUgcG9pbnRzIGFyZSBhIHZhbGlkIGVzY2FwZSwgcmV0dXJuIHRydWUuIE90aGVyd2lzZSwgcmV0dXJuIGZhbHNlLlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgaXNOYW1lU3RhcnQoc2Vjb25kKSB8fFxuICAgICAgICAgICAgc2Vjb25kID09PSAweDAwMkQgfHxcbiAgICAgICAgICAgIGlzVmFsaWRFc2NhcGUoc2Vjb25kLCB0aGlyZClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBuYW1lLXN0YXJ0IGNvZGUgcG9pbnRcbiAgICBpZiAoaXNOYW1lU3RhcnQoZmlyc3QpKSB7XG4gICAgICAgIC8vIFJldHVybiB0cnVlLlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBVKzAwNUMgUkVWRVJTRSBTT0xJRFVTIChcXClcbiAgICBpZiAoZmlyc3QgPT09IDB4MDA1Qykge1xuICAgICAgICAvLyBJZiB0aGUgZmlyc3QgYW5kIHNlY29uZCBjb2RlIHBvaW50cyBhcmUgYSB2YWxpZCBlc2NhcGUsIHJldHVybiB0cnVlLiBPdGhlcndpc2UsIHJldHVybiBmYWxzZS5cbiAgICAgICAgcmV0dXJuIGlzVmFsaWRFc2NhcGUoZmlyc3QsIHNlY29uZCk7XG4gICAgfVxuXG4gICAgLy8gYW55dGhpbmcgZWxzZVxuICAgIC8vIFJldHVybiBmYWxzZS5cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8vIMKnIDQuMy4xMC4gQ2hlY2sgaWYgdGhyZWUgY29kZSBwb2ludHMgd291bGQgc3RhcnQgYSBudW1iZXJcbmZ1bmN0aW9uIGlzTnVtYmVyU3RhcnQoZmlyc3QsIHNlY29uZCwgdGhpcmQpIHtcbiAgICAvLyBMb29rIGF0IHRoZSBmaXJzdCBjb2RlIHBvaW50OlxuXG4gICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKylcbiAgICAvLyBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKVxuICAgIGlmIChmaXJzdCA9PT0gMHgwMDJCIHx8IGZpcnN0ID09PSAweDAwMkQpIHtcbiAgICAgICAgLy8gSWYgdGhlIHNlY29uZCBjb2RlIHBvaW50IGlzIGEgZGlnaXQsIHJldHVybiB0cnVlLlxuICAgICAgICBpZiAoaXNEaWdpdChzZWNvbmQpKSB7XG4gICAgICAgICAgICByZXR1cm4gMjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIHNlY29uZCBjb2RlIHBvaW50IGlzIGEgVSswMDJFIEZVTEwgU1RPUCAoLilcbiAgICAgICAgLy8gYW5kIHRoZSB0aGlyZCBjb2RlIHBvaW50IGlzIGEgZGlnaXQsIHJldHVybiB0cnVlLlxuICAgICAgICAvLyBPdGhlcndpc2UsIHJldHVybiBmYWxzZS5cbiAgICAgICAgcmV0dXJuIHNlY29uZCA9PT0gMHgwMDJFICYmIGlzRGlnaXQodGhpcmQpID8gMyA6IDA7XG4gICAgfVxuXG4gICAgLy8gVSswMDJFIEZVTEwgU1RPUCAoLilcbiAgICBpZiAoZmlyc3QgPT09IDB4MDAyRSkge1xuICAgICAgICAvLyBJZiB0aGUgc2Vjb25kIGNvZGUgcG9pbnQgaXMgYSBkaWdpdCwgcmV0dXJuIHRydWUuIE90aGVyd2lzZSwgcmV0dXJuIGZhbHNlLlxuICAgICAgICByZXR1cm4gaXNEaWdpdChzZWNvbmQpID8gMiA6IDA7XG4gICAgfVxuXG4gICAgLy8gZGlnaXRcbiAgICBpZiAoaXNEaWdpdChmaXJzdCkpIHtcbiAgICAgICAgLy8gUmV0dXJuIHRydWUuXG4gICAgICAgIHJldHVybiAxO1xuICAgIH1cblxuICAgIC8vIGFueXRoaW5nIGVsc2VcbiAgICAvLyBSZXR1cm4gZmFsc2UuXG4gICAgcmV0dXJuIDA7XG59XG5cbi8vXG4vLyBNaXNjXG4vL1xuXG4vLyBkZXRlY3QgQk9NIChodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CeXRlX29yZGVyX21hcmspXG5mdW5jdGlvbiBpc0JPTShjb2RlKSB7XG4gICAgLy8gVVRGLTE2QkVcbiAgICBpZiAoY29kZSA9PT0gMHhGRUZGKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgIH1cblxuICAgIC8vIFVURi0xNkxFXG4gICAgaWYgKGNvZGUgPT09IDB4RkZGRSkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9XG5cbiAgICByZXR1cm4gMDtcbn1cblxuLy8gRmFzdCBjb2RlIGNhdGVnb3J5XG4vL1xuLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy1zeW50YXgvI3Rva2VuaXplci1kZWZpbml0aW9uc1xuLy8gPiBub24tQVNDSUkgY29kZSBwb2ludFxuLy8gPiAgIEEgY29kZSBwb2ludCB3aXRoIGEgdmFsdWUgZXF1YWwgdG8gb3IgZ3JlYXRlciB0aGFuIFUrMDA4MCA8Y29udHJvbD5cbi8vID4gbmFtZS1zdGFydCBjb2RlIHBvaW50XG4vLyA+ICAgQSBsZXR0ZXIsIGEgbm9uLUFTQ0lJIGNvZGUgcG9pbnQsIG9yIFUrMDA1RiBMT1cgTElORSAoXykuXG4vLyA+IG5hbWUgY29kZSBwb2ludFxuLy8gPiAgIEEgbmFtZS1zdGFydCBjb2RlIHBvaW50LCBhIGRpZ2l0LCBvciBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKVxuLy8gVGhhdCBtZWFucyBvbmx5IEFTQ0lJIGNvZGUgcG9pbnRzIGhhcyBhIHNwZWNpYWwgbWVhbmluZyBhbmQgd2UgZGVmaW5lIGEgbWFwcyBmb3IgMC4uMTI3IGNvZGVzIG9ubHlcbnZhciBDQVRFR09SWSA9IG5ldyBBcnJheSgweDgwKTtcbmNoYXJDb2RlQ2F0ZWdvcnkuRW9mID0gMHg4MDtcbmNoYXJDb2RlQ2F0ZWdvcnkuV2hpdGVTcGFjZSA9IDB4ODI7XG5jaGFyQ29kZUNhdGVnb3J5LkRpZ2l0ID0gMHg4MztcbmNoYXJDb2RlQ2F0ZWdvcnkuTmFtZVN0YXJ0ID0gMHg4NDtcbmNoYXJDb2RlQ2F0ZWdvcnkuTm9uUHJpbnRhYmxlID0gMHg4NTtcblxuZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgQ0FURUdPUlkubGVuZ3RoOyBpJDErKykge1xuICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgICBjYXNlIGlzV2hpdGVTcGFjZShpJDEpOlxuICAgICAgICAgICAgQ0FURUdPUllbaSQxXSA9IGNoYXJDb2RlQ2F0ZWdvcnkuV2hpdGVTcGFjZTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgaXNEaWdpdChpJDEpOlxuICAgICAgICAgICAgQ0FURUdPUllbaSQxXSA9IGNoYXJDb2RlQ2F0ZWdvcnkuRGlnaXQ7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIGlzTmFtZVN0YXJ0KGkkMSk6XG4gICAgICAgICAgICBDQVRFR09SWVtpJDFdID0gY2hhckNvZGVDYXRlZ29yeS5OYW1lU3RhcnQ7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIGlzTm9uUHJpbnRhYmxlKGkkMSk6XG4gICAgICAgICAgICBDQVRFR09SWVtpJDFdID0gY2hhckNvZGVDYXRlZ29yeS5Ob25QcmludGFibGU7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgQ0FURUdPUllbaSQxXSA9IGkkMSB8fCBjaGFyQ29kZUNhdGVnb3J5LkVvZjtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNoYXJDb2RlQ2F0ZWdvcnkoY29kZSkge1xuICAgIHJldHVybiBjb2RlIDwgMHg4MCA/IENBVEVHT1JZW2NvZGVdIDogY2hhckNvZGVDYXRlZ29yeS5OYW1lU3RhcnQ7XG59XG52YXIgY2hhckNvZGVEZWZpbml0aW9ucyA9IHtcbiAgICBpc0RpZ2l0OiBpc0RpZ2l0LFxuICAgIGlzSGV4RGlnaXQ6IGlzSGV4RGlnaXQkMSxcbiAgICBpc1VwcGVyY2FzZUxldHRlcjogaXNVcHBlcmNhc2VMZXR0ZXIsXG4gICAgaXNMb3dlcmNhc2VMZXR0ZXI6IGlzTG93ZXJjYXNlTGV0dGVyLFxuICAgIGlzTGV0dGVyOiBpc0xldHRlcixcbiAgICBpc05vbkFzY2lpOiBpc05vbkFzY2lpLFxuICAgIGlzTmFtZVN0YXJ0OiBpc05hbWVTdGFydCxcbiAgICBpc05hbWU6IGlzTmFtZSxcbiAgICBpc05vblByaW50YWJsZTogaXNOb25QcmludGFibGUsXG4gICAgaXNOZXdsaW5lOiBpc05ld2xpbmUsXG4gICAgaXNXaGl0ZVNwYWNlOiBpc1doaXRlU3BhY2UsXG4gICAgaXNWYWxpZEVzY2FwZTogaXNWYWxpZEVzY2FwZSxcbiAgICBpc0lkZW50aWZpZXJTdGFydDogaXNJZGVudGlmaWVyU3RhcnQkMSxcbiAgICBpc051bWJlclN0YXJ0OiBpc051bWJlclN0YXJ0LFxuXG4gICAgaXNCT006IGlzQk9NLFxuICAgIGNoYXJDb2RlQ2F0ZWdvcnk6IGNoYXJDb2RlQ2F0ZWdvcnlcbn07XG5cbnZhciBpc0RpZ2l0JDEgPSBjaGFyQ29kZURlZmluaXRpb25zLmlzRGlnaXQ7XG52YXIgaXNIZXhEaWdpdCQyID0gY2hhckNvZGVEZWZpbml0aW9ucy5pc0hleERpZ2l0O1xudmFyIGlzVXBwZXJjYXNlTGV0dGVyJDEgPSBjaGFyQ29kZURlZmluaXRpb25zLmlzVXBwZXJjYXNlTGV0dGVyO1xudmFyIGlzTmFtZSQxID0gY2hhckNvZGVEZWZpbml0aW9ucy5pc05hbWU7XG52YXIgaXNXaGl0ZVNwYWNlJDEgPSBjaGFyQ29kZURlZmluaXRpb25zLmlzV2hpdGVTcGFjZTtcbnZhciBpc1ZhbGlkRXNjYXBlJDEgPSBjaGFyQ29kZURlZmluaXRpb25zLmlzVmFsaWRFc2NhcGU7XG5cbmZ1bmN0aW9uIGdldENoYXJDb2RlKHNvdXJjZSwgb2Zmc2V0KSB7XG4gICAgcmV0dXJuIG9mZnNldCA8IHNvdXJjZS5sZW5ndGggPyBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpIDogMDtcbn1cblxuZnVuY3Rpb24gZ2V0TmV3bGluZUxlbmd0aChzb3VyY2UsIG9mZnNldCwgY29kZSkge1xuICAgIGlmIChjb2RlID09PSAxMyAvKiBcXHIgKi8gJiYgZ2V0Q2hhckNvZGUoc291cmNlLCBvZmZzZXQgKyAxKSA9PT0gMTAgLyogXFxuICovKSB7XG4gICAgICAgIHJldHVybiAyO1xuICAgIH1cblxuICAgIHJldHVybiAxO1xufVxuXG5mdW5jdGlvbiBjbXBDaGFyKHRlc3RTdHIsIG9mZnNldCwgcmVmZXJlbmNlQ29kZSkge1xuICAgIHZhciBjb2RlID0gdGVzdFN0ci5jaGFyQ29kZUF0KG9mZnNldCk7XG5cbiAgICAvLyBjb2RlLnRvTG93ZXJDYXNlKCkgZm9yIEEuLlpcbiAgICBpZiAoaXNVcHBlcmNhc2VMZXR0ZXIkMShjb2RlKSkge1xuICAgICAgICBjb2RlID0gY29kZSB8IDMyO1xuICAgIH1cblxuICAgIHJldHVybiBjb2RlID09PSByZWZlcmVuY2VDb2RlO1xufVxuXG5mdW5jdGlvbiBjbXBTdHIodGVzdFN0ciwgc3RhcnQsIGVuZCwgcmVmZXJlbmNlU3RyKSB7XG4gICAgaWYgKGVuZCAtIHN0YXJ0ICE9PSByZWZlcmVuY2VTdHIubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoc3RhcnQgPCAwIHx8IGVuZCA+IHRlc3RTdHIubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuICAgICAgICB2YXIgdGVzdENvZGUgPSB0ZXN0U3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgIHZhciByZWZlcmVuY2VDb2RlID0gcmVmZXJlbmNlU3RyLmNoYXJDb2RlQXQoaSAtIHN0YXJ0KTtcblxuICAgICAgICAvLyB0ZXN0Q29kZS50b0xvd2VyQ2FzZSgpIGZvciBBLi5aXG4gICAgICAgIGlmIChpc1VwcGVyY2FzZUxldHRlciQxKHRlc3RDb2RlKSkge1xuICAgICAgICAgICAgdGVzdENvZGUgPSB0ZXN0Q29kZSB8IDMyO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRlc3RDb2RlICE9PSByZWZlcmVuY2VDb2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gZmluZFdoaXRlU3BhY2VTdGFydChzb3VyY2UsIG9mZnNldCkge1xuICAgIGZvciAoOyBvZmZzZXQgPj0gMDsgb2Zmc2V0LS0pIHtcbiAgICAgICAgaWYgKCFpc1doaXRlU3BhY2UkMShzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpKSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb2Zmc2V0ICsgMTtcbn1cblxuZnVuY3Rpb24gZmluZFdoaXRlU3BhY2VFbmQoc291cmNlLCBvZmZzZXQpIHtcbiAgICBmb3IgKDsgb2Zmc2V0IDwgc291cmNlLmxlbmd0aDsgb2Zmc2V0KyspIHtcbiAgICAgICAgaWYgKCFpc1doaXRlU3BhY2UkMShzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpKSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb2Zmc2V0O1xufVxuXG5mdW5jdGlvbiBmaW5kRGVjaW1hbE51bWJlckVuZChzb3VyY2UsIG9mZnNldCkge1xuICAgIGZvciAoOyBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoOyBvZmZzZXQrKykge1xuICAgICAgICBpZiAoIWlzRGlnaXQkMShzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpKSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb2Zmc2V0O1xufVxuXG4vLyDCpyA0LjMuNy4gQ29uc3VtZSBhbiBlc2NhcGVkIGNvZGUgcG9pbnRcbmZ1bmN0aW9uIGNvbnN1bWVFc2NhcGVkKHNvdXJjZSwgb2Zmc2V0KSB7XG4gICAgLy8gSXQgYXNzdW1lcyB0aGF0IHRoZSBVKzAwNUMgUkVWRVJTRSBTT0xJRFVTIChcXCkgaGFzIGFscmVhZHkgYmVlbiBjb25zdW1lZCBhbmRcbiAgICAvLyB0aGF0IHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaGFzIGFscmVhZHkgYmVlbiB2ZXJpZmllZCB0byBiZSBwYXJ0IG9mIGEgdmFsaWQgZXNjYXBlLlxuICAgIG9mZnNldCArPSAyO1xuXG4gICAgLy8gaGV4IGRpZ2l0XG4gICAgaWYgKGlzSGV4RGlnaXQkMihnZXRDaGFyQ29kZShzb3VyY2UsIG9mZnNldCAtIDEpKSkge1xuICAgICAgICAvLyBDb25zdW1lIGFzIG1hbnkgaGV4IGRpZ2l0cyBhcyBwb3NzaWJsZSwgYnV0IG5vIG1vcmUgdGhhbiA1LlxuICAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBtZWFucyAxLTYgaGV4IGRpZ2l0cyBoYXZlIGJlZW4gY29uc3VtZWQgaW4gdG90YWwuXG4gICAgICAgIGZvciAodmFyIG1heE9mZnNldCA9IE1hdGgubWluKHNvdXJjZS5sZW5ndGgsIG9mZnNldCArIDUpOyBvZmZzZXQgPCBtYXhPZmZzZXQ7IG9mZnNldCsrKSB7XG4gICAgICAgICAgICBpZiAoIWlzSGV4RGlnaXQkMihnZXRDaGFyQ29kZShzb3VyY2UsIG9mZnNldCkpKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIHdoaXRlc3BhY2UsIGNvbnN1bWUgaXQgYXMgd2VsbC5cbiAgICAgICAgdmFyIGNvZGUgPSBnZXRDaGFyQ29kZShzb3VyY2UsIG9mZnNldCk7XG4gICAgICAgIGlmIChpc1doaXRlU3BhY2UkMShjb2RlKSkge1xuICAgICAgICAgICAgb2Zmc2V0ICs9IGdldE5ld2xpbmVMZW5ndGgoc291cmNlLCBvZmZzZXQsIGNvZGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG9mZnNldDtcbn1cblxuLy8gwqc0LjMuMTEuIENvbnN1bWUgYSBuYW1lXG4vLyBOb3RlOiBUaGlzIGFsZ29yaXRobSBkb2VzIG5vdCBkbyB0aGUgdmVyaWZpY2F0aW9uIG9mIHRoZSBmaXJzdCBmZXcgY29kZSBwb2ludHMgdGhhdCBhcmUgbmVjZXNzYXJ5XG4vLyB0byBlbnN1cmUgdGhlIHJldHVybmVkIGNvZGUgcG9pbnRzIHdvdWxkIGNvbnN0aXR1dGUgYW4gPGlkZW50LXRva2VuPi4gSWYgdGhhdCBpcyB0aGUgaW50ZW5kZWQgdXNlLFxuLy8gZW5zdXJlIHRoYXQgdGhlIHN0cmVhbSBzdGFydHMgd2l0aCBhbiBpZGVudGlmaWVyIGJlZm9yZSBjYWxsaW5nIHRoaXMgYWxnb3JpdGhtLlxuZnVuY3Rpb24gY29uc3VtZU5hbWUoc291cmNlLCBvZmZzZXQpIHtcbiAgICAvLyBMZXQgcmVzdWx0IGluaXRpYWxseSBiZSBhbiBlbXB0eSBzdHJpbmcuXG4gICAgLy8gUmVwZWF0ZWRseSBjb25zdW1lIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgZnJvbSB0aGUgc3RyZWFtOlxuICAgIGZvciAoOyBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoOyBvZmZzZXQrKykge1xuICAgICAgICB2YXIgY29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCk7XG5cbiAgICAgICAgLy8gbmFtZSBjb2RlIHBvaW50XG4gICAgICAgIGlmIChpc05hbWUkMShjb2RlKSkge1xuICAgICAgICAgICAgLy8gQXBwZW5kIHRoZSBjb2RlIHBvaW50IHRvIHJlc3VsdC5cbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGhlIHN0cmVhbSBzdGFydHMgd2l0aCBhIHZhbGlkIGVzY2FwZVxuICAgICAgICBpZiAoaXNWYWxpZEVzY2FwZSQxKGNvZGUsIGdldENoYXJDb2RlKHNvdXJjZSwgb2Zmc2V0ICsgMSkpKSB7XG4gICAgICAgICAgICAvLyBDb25zdW1lIGFuIGVzY2FwZWQgY29kZSBwb2ludC4gQXBwZW5kIHRoZSByZXR1cm5lZCBjb2RlIHBvaW50IHRvIHJlc3VsdC5cbiAgICAgICAgICAgIG9mZnNldCA9IGNvbnN1bWVFc2NhcGVkKHNvdXJjZSwgb2Zmc2V0KSAtIDE7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFueXRoaW5nIGVsc2VcbiAgICAgICAgLy8gUmVjb25zdW1lIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQuIFJldHVybiByZXN1bHQuXG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiBvZmZzZXQ7XG59XG5cbi8vIMKnNC4zLjEyLiBDb25zdW1lIGEgbnVtYmVyXG5mdW5jdGlvbiBjb25zdW1lTnVtYmVyKHNvdXJjZSwgb2Zmc2V0KSB7XG4gICAgdmFyIGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpO1xuXG4gICAgLy8gMi4gSWYgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBVKzAwMkIgUExVUyBTSUdOICgrKSBvciBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKSxcbiAgICAvLyBjb25zdW1lIGl0IGFuZCBhcHBlbmQgaXQgdG8gcmVwci5cbiAgICBpZiAoY29kZSA9PT0gMHgwMDJCIHx8IGNvZGUgPT09IDB4MDAyRCkge1xuICAgICAgICBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0ICs9IDEpO1xuICAgIH1cblxuICAgIC8vIDMuIFdoaWxlIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgYSBkaWdpdCwgY29uc3VtZSBpdCBhbmQgYXBwZW5kIGl0IHRvIHJlcHIuXG4gICAgaWYgKGlzRGlnaXQkMShjb2RlKSkge1xuICAgICAgICBvZmZzZXQgPSBmaW5kRGVjaW1hbE51bWJlckVuZChzb3VyY2UsIG9mZnNldCArIDEpO1xuICAgICAgICBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KTtcbiAgICB9XG5cbiAgICAvLyA0LiBJZiB0aGUgbmV4dCAyIGlucHV0IGNvZGUgcG9pbnRzIGFyZSBVKzAwMkUgRlVMTCBTVE9QICguKSBmb2xsb3dlZCBieSBhIGRpZ2l0LCB0aGVuOlxuICAgIGlmIChjb2RlID09PSAweDAwMkUgJiYgaXNEaWdpdCQxKHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCArIDEpKSkge1xuICAgICAgICAvLyA0LjEgQ29uc3VtZSB0aGVtLlxuICAgICAgICAvLyA0LjIgQXBwZW5kIHRoZW0gdG8gcmVwci5cbiAgICAgICAgY29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCArPSAyKTtcblxuICAgICAgICAvLyA0LjMgU2V0IHR5cGUgdG8gXCJudW1iZXJcIi5cbiAgICAgICAgLy8gVE9ET1xuXG4gICAgICAgIC8vIDQuNCBXaGlsZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIGEgZGlnaXQsIGNvbnN1bWUgaXQgYW5kIGFwcGVuZCBpdCB0byByZXByLlxuXG4gICAgICAgIG9mZnNldCA9IGZpbmREZWNpbWFsTnVtYmVyRW5kKHNvdXJjZSwgb2Zmc2V0KTtcbiAgICB9XG5cbiAgICAvLyA1LiBJZiB0aGUgbmV4dCAyIG9yIDMgaW5wdXQgY29kZSBwb2ludHMgYXJlIFUrMDA0NSBMQVRJTiBDQVBJVEFMIExFVFRFUiBFIChFKVxuICAgIC8vIG9yIFUrMDA2NSBMQVRJTiBTTUFMTCBMRVRURVIgRSAoZSksIC4uLiAsIGZvbGxvd2VkIGJ5IGEgZGlnaXQsIHRoZW46XG4gICAgaWYgKGNtcENoYXIoc291cmNlLCBvZmZzZXQsIDEwMSAvKiBlICovKSkge1xuICAgICAgICB2YXIgc2lnbiA9IDA7XG4gICAgICAgIGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQgKyAxKTtcblxuICAgICAgICAvLyAuLi4gb3B0aW9uYWxseSBmb2xsb3dlZCBieSBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKSBvciBVKzAwMkIgUExVUyBTSUdOICgrKSAuLi5cbiAgICAgICAgaWYgKGNvZGUgPT09IDB4MDAyRCB8fCBjb2RlID09PSAweDAwMkIpIHtcbiAgICAgICAgICAgIHNpZ24gPSAxO1xuICAgICAgICAgICAgY29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCArIDIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gLi4uIGZvbGxvd2VkIGJ5IGEgZGlnaXRcbiAgICAgICAgaWYgKGlzRGlnaXQkMShjb2RlKSkge1xuICAgICAgICAgICAgLy8gNS4xIENvbnN1bWUgdGhlbS5cbiAgICAgICAgICAgIC8vIDUuMiBBcHBlbmQgdGhlbSB0byByZXByLlxuXG4gICAgICAgICAgICAvLyA1LjMgU2V0IHR5cGUgdG8gXCJudW1iZXJcIi5cbiAgICAgICAgICAgIC8vIFRPRE9cblxuICAgICAgICAgICAgLy8gNS40IFdoaWxlIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgYSBkaWdpdCwgY29uc3VtZSBpdCBhbmQgYXBwZW5kIGl0IHRvIHJlcHIuXG4gICAgICAgICAgICBvZmZzZXQgPSBmaW5kRGVjaW1hbE51bWJlckVuZChzb3VyY2UsIG9mZnNldCArIDEgKyBzaWduICsgMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb2Zmc2V0O1xufVxuXG4vLyDCpyA0LjMuMTQuIENvbnN1bWUgdGhlIHJlbW5hbnRzIG9mIGEgYmFkIHVybFxuLy8gLi4uIGl0cyBzb2xlIHVzZSBpcyB0byBjb25zdW1lIGVub3VnaCBvZiB0aGUgaW5wdXQgc3RyZWFtIHRvIHJlYWNoIGEgcmVjb3ZlcnkgcG9pbnRcbi8vIHdoZXJlIG5vcm1hbCB0b2tlbml6aW5nIGNhbiByZXN1bWUuXG5mdW5jdGlvbiBjb25zdW1lQmFkVXJsUmVtbmFudHMoc291cmNlLCBvZmZzZXQpIHtcbiAgICAvLyBSZXBlYXRlZGx5IGNvbnN1bWUgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBmcm9tIHRoZSBzdHJlYW06XG4gICAgZm9yICg7IG9mZnNldCA8IHNvdXJjZS5sZW5ndGg7IG9mZnNldCsrKSB7XG4gICAgICAgIHZhciBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KTtcblxuICAgICAgICAvLyBVKzAwMjkgUklHSFQgUEFSRU5USEVTSVMgKCkpXG4gICAgICAgIC8vIEVPRlxuICAgICAgICBpZiAoY29kZSA9PT0gMHgwMDI5KSB7XG4gICAgICAgICAgICAvLyBSZXR1cm4uXG4gICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzVmFsaWRFc2NhcGUkMShjb2RlLCBnZXRDaGFyQ29kZShzb3VyY2UsIG9mZnNldCArIDEpKSkge1xuICAgICAgICAgICAgLy8gQ29uc3VtZSBhbiBlc2NhcGVkIGNvZGUgcG9pbnQuXG4gICAgICAgICAgICAvLyBOb3RlOiBUaGlzIGFsbG93cyBhbiBlc2NhcGVkIHJpZ2h0IHBhcmVudGhlc2lzIChcIlxcKVwiKSB0byBiZSBlbmNvdW50ZXJlZFxuICAgICAgICAgICAgLy8gd2l0aG91dCBlbmRpbmcgdGhlIDxiYWQtdXJsLXRva2VuPi4gVGhpcyBpcyBvdGhlcndpc2UgaWRlbnRpY2FsIHRvXG4gICAgICAgICAgICAvLyB0aGUgXCJhbnl0aGluZyBlbHNlXCIgY2xhdXNlLlxuICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZUVzY2FwZWQoc291cmNlLCBvZmZzZXQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG9mZnNldDtcbn1cblxudmFyIHV0aWxzID0ge1xuICAgIGNvbnN1bWVFc2NhcGVkOiBjb25zdW1lRXNjYXBlZCxcbiAgICBjb25zdW1lTmFtZTogY29uc3VtZU5hbWUsXG4gICAgY29uc3VtZU51bWJlcjogY29uc3VtZU51bWJlcixcbiAgICBjb25zdW1lQmFkVXJsUmVtbmFudHM6IGNvbnN1bWVCYWRVcmxSZW1uYW50cyxcblxuICAgIGNtcENoYXI6IGNtcENoYXIsXG4gICAgY21wU3RyOiBjbXBTdHIsXG5cbiAgICBnZXROZXdsaW5lTGVuZ3RoOiBnZXROZXdsaW5lTGVuZ3RoLFxuICAgIGZpbmRXaGl0ZVNwYWNlU3RhcnQ6IGZpbmRXaGl0ZVNwYWNlU3RhcnQsXG4gICAgZmluZFdoaXRlU3BhY2VFbmQ6IGZpbmRXaGl0ZVNwYWNlRW5kXG59O1xuXG52YXIgVFlQRSQxID0gX2NvbnN0LlRZUEU7XG52YXIgTkFNRSQxID0gX2NvbnN0Lk5BTUU7XG5cblxudmFyIGNtcFN0ciQxID0gdXRpbHMuY21wU3RyO1xuXG52YXIgRU9GJDEgPSBUWVBFJDEuRU9GO1xudmFyIFdISVRFU1BBQ0UgPSBUWVBFJDEuV2hpdGVTcGFjZTtcbnZhciBDT01NRU5UID0gVFlQRSQxLkNvbW1lbnQ7XG5cbnZhciBPRkZTRVRfTUFTSyA9IDB4MDBGRkZGRkY7XG52YXIgVFlQRV9TSElGVCA9IDI0O1xuXG52YXIgVG9rZW5TdHJlYW0gPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9mZnNldEFuZFR5cGUgPSBudWxsO1xuICAgIHRoaXMuYmFsYW5jZSA9IG51bGw7XG5cbiAgICB0aGlzLnJlc2V0KCk7XG59O1xuXG5Ub2tlblN0cmVhbS5wcm90b3R5cGUgPSB7XG4gICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmVvZiA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRva2VuSW5kZXggPSAtMTtcbiAgICAgICAgdGhpcy50b2tlblR5cGUgPSAwO1xuICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLmZpcnN0Q2hhck9mZnNldDtcbiAgICAgICAgdGhpcy50b2tlbkVuZCA9IHRoaXMuZmlyc3RDaGFyT2Zmc2V0O1xuICAgIH0sXG5cbiAgICBsb29rdXBUeXBlOiBmdW5jdGlvbihvZmZzZXQpIHtcbiAgICAgICAgb2Zmc2V0ICs9IHRoaXMudG9rZW5JbmRleDtcblxuICAgICAgICBpZiAob2Zmc2V0IDwgdGhpcy50b2tlbkNvdW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vZmZzZXRBbmRUeXBlW29mZnNldF0gPj4gVFlQRV9TSElGVDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBFT0YkMTtcbiAgICB9LFxuICAgIGxvb2t1cE9mZnNldDogZnVuY3Rpb24ob2Zmc2V0KSB7XG4gICAgICAgIG9mZnNldCArPSB0aGlzLnRva2VuSW5kZXg7XG5cbiAgICAgICAgaWYgKG9mZnNldCA8IHRoaXMudG9rZW5Db3VudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub2Zmc2V0QW5kVHlwZVtvZmZzZXQgLSAxXSAmIE9GRlNFVF9NQVNLO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmxlbmd0aDtcbiAgICB9LFxuICAgIGxvb2t1cFZhbHVlOiBmdW5jdGlvbihvZmZzZXQsIHJlZmVyZW5jZVN0cikge1xuICAgICAgICBvZmZzZXQgKz0gdGhpcy50b2tlbkluZGV4O1xuXG4gICAgICAgIGlmIChvZmZzZXQgPCB0aGlzLnRva2VuQ291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiBjbXBTdHIkMShcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZSxcbiAgICAgICAgICAgICAgICB0aGlzLm9mZnNldEFuZFR5cGVbb2Zmc2V0IC0gMV0gJiBPRkZTRVRfTUFTSyxcbiAgICAgICAgICAgICAgICB0aGlzLm9mZnNldEFuZFR5cGVbb2Zmc2V0XSAmIE9GRlNFVF9NQVNLLFxuICAgICAgICAgICAgICAgIHJlZmVyZW5jZVN0clxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuICAgIGdldFRva2VuU3RhcnQ6IGZ1bmN0aW9uKHRva2VuSW5kZXgpIHtcbiAgICAgICAgaWYgKHRva2VuSW5kZXggPT09IHRoaXMudG9rZW5JbmRleCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9rZW5TdGFydDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0b2tlbkluZGV4ID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRva2VuSW5kZXggPCB0aGlzLnRva2VuQ291bnRcbiAgICAgICAgICAgICAgICA/IHRoaXMub2Zmc2V0QW5kVHlwZVt0b2tlbkluZGV4IC0gMV0gJiBPRkZTRVRfTUFTS1xuICAgICAgICAgICAgICAgIDogdGhpcy5vZmZzZXRBbmRUeXBlW3RoaXMudG9rZW5Db3VudF0gJiBPRkZTRVRfTUFTSztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmZpcnN0Q2hhck9mZnNldDtcbiAgICB9LFxuXG4gICAgLy8gVE9ETzogLT4gc2tpcFVudGlsQmFsYW5jZWRcbiAgICBnZXRSYXdMZW5ndGg6IGZ1bmN0aW9uKHN0YXJ0VG9rZW4sIG1vZGUpIHtcbiAgICAgICAgdmFyIGN1cnNvciA9IHN0YXJ0VG9rZW47XG4gICAgICAgIHZhciBiYWxhbmNlRW5kO1xuICAgICAgICB2YXIgb2Zmc2V0ID0gdGhpcy5vZmZzZXRBbmRUeXBlW01hdGgubWF4KGN1cnNvciAtIDEsIDApXSAmIE9GRlNFVF9NQVNLO1xuICAgICAgICB2YXIgdHlwZTtcblxuICAgICAgICBsb29wOlxuICAgICAgICBmb3IgKDsgY3Vyc29yIDwgdGhpcy50b2tlbkNvdW50OyBjdXJzb3IrKykge1xuICAgICAgICAgICAgYmFsYW5jZUVuZCA9IHRoaXMuYmFsYW5jZVtjdXJzb3JdO1xuXG4gICAgICAgICAgICAvLyBzdG9wIHNjYW5uaW5nIG9uIGJhbGFuY2UgZWRnZSB0aGF0IHBvaW50cyB0byBvZmZzZXQgYmVmb3JlIHN0YXJ0IHRva2VuXG4gICAgICAgICAgICBpZiAoYmFsYW5jZUVuZCA8IHN0YXJ0VG9rZW4pIHtcbiAgICAgICAgICAgICAgICBicmVhayBsb29wO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0eXBlID0gdGhpcy5vZmZzZXRBbmRUeXBlW2N1cnNvcl0gPj4gVFlQRV9TSElGVDtcblxuICAgICAgICAgICAgLy8gY2hlY2sgdG9rZW4gaXMgc3RvcCB0eXBlXG4gICAgICAgICAgICBzd2l0Y2ggKG1vZGUodHlwZSwgdGhpcy5zb3VyY2UsIG9mZnNldCkpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrIGxvb3A7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvcisrO1xuICAgICAgICAgICAgICAgICAgICBicmVhayBsb29wO1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy5vZmZzZXRBbmRUeXBlW2N1cnNvcl0gJiBPRkZTRVRfTUFTSztcblxuICAgICAgICAgICAgICAgICAgICAvLyBmYXN0IGZvcndhcmQgdG8gdGhlIGVuZCBvZiBiYWxhbmNlZCBibG9ja1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5iYWxhbmNlW2JhbGFuY2VFbmRdID09PSBjdXJzb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvciA9IGJhbGFuY2VFbmQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjdXJzb3IgLSB0aGlzLnRva2VuSW5kZXg7XG4gICAgfSxcbiAgICBpc0JhbGFuY2VFZGdlOiBmdW5jdGlvbihwb3MpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZVt0aGlzLnRva2VuSW5kZXhdIDwgcG9zO1xuICAgIH0sXG4gICAgaXNEZWxpbTogZnVuY3Rpb24oY29kZSwgb2Zmc2V0KSB7XG4gICAgICAgIGlmIChvZmZzZXQpIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBUeXBlKG9mZnNldCkgPT09IFRZUEUkMS5EZWxpbSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLmNoYXJDb2RlQXQodGhpcy5sb29rdXBPZmZzZXQob2Zmc2V0KSkgPT09IGNvZGVcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgdGhpcy50b2tlblR5cGUgPT09IFRZUEUkMS5EZWxpbSAmJlxuICAgICAgICAgICAgdGhpcy5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLnRva2VuU3RhcnQpID09PSBjb2RlXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIGdldFRva2VuVmFsdWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic3RyaW5nKHRoaXMudG9rZW5TdGFydCwgdGhpcy50b2tlbkVuZCk7XG4gICAgfSxcbiAgICBnZXRUb2tlbkxlbmd0aDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRva2VuRW5kIC0gdGhpcy50b2tlblN0YXJ0O1xuICAgIH0sXG4gICAgc3Vic3RyVG9DdXJzb3I6IGZ1bmN0aW9uKHN0YXJ0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsIHRoaXMudG9rZW5TdGFydCk7XG4gICAgfSxcblxuICAgIHNraXBXUzogZnVuY3Rpb24oKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRva2VuSW5kZXgsIHNraXBUb2tlbkNvdW50ID0gMDsgaSA8IHRoaXMudG9rZW5Db3VudDsgaSsrLCBza2lwVG9rZW5Db3VudCsrKSB7XG4gICAgICAgICAgICBpZiAoKHRoaXMub2Zmc2V0QW5kVHlwZVtpXSA+PiBUWVBFX1NISUZUKSAhPT0gV0hJVEVTUEFDRSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNraXBUb2tlbkNvdW50ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5za2lwKHNraXBUb2tlbkNvdW50KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgc2tpcFNDOiBmdW5jdGlvbigpIHtcbiAgICAgICAgd2hpbGUgKHRoaXMudG9rZW5UeXBlID09PSBXSElURVNQQUNFIHx8IHRoaXMudG9rZW5UeXBlID09PSBDT01NRU5UKSB7XG4gICAgICAgICAgICB0aGlzLm5leHQoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgc2tpcDogZnVuY3Rpb24odG9rZW5Db3VudCkge1xuICAgICAgICB2YXIgbmV4dCA9IHRoaXMudG9rZW5JbmRleCArIHRva2VuQ291bnQ7XG5cbiAgICAgICAgaWYgKG5leHQgPCB0aGlzLnRva2VuQ291bnQpIHtcbiAgICAgICAgICAgIHRoaXMudG9rZW5JbmRleCA9IG5leHQ7XG4gICAgICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLm9mZnNldEFuZFR5cGVbbmV4dCAtIDFdICYgT0ZGU0VUX01BU0s7XG4gICAgICAgICAgICBuZXh0ID0gdGhpcy5vZmZzZXRBbmRUeXBlW25leHRdO1xuICAgICAgICAgICAgdGhpcy50b2tlblR5cGUgPSBuZXh0ID4+IFRZUEVfU0hJRlQ7XG4gICAgICAgICAgICB0aGlzLnRva2VuRW5kID0gbmV4dCAmIE9GRlNFVF9NQVNLO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50b2tlbkluZGV4ID0gdGhpcy50b2tlbkNvdW50O1xuICAgICAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG5leHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbmV4dCA9IHRoaXMudG9rZW5JbmRleCArIDE7XG5cbiAgICAgICAgaWYgKG5leHQgPCB0aGlzLnRva2VuQ291bnQpIHtcbiAgICAgICAgICAgIHRoaXMudG9rZW5JbmRleCA9IG5leHQ7XG4gICAgICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLnRva2VuRW5kO1xuICAgICAgICAgICAgbmV4dCA9IHRoaXMub2Zmc2V0QW5kVHlwZVtuZXh0XTtcbiAgICAgICAgICAgIHRoaXMudG9rZW5UeXBlID0gbmV4dCA+PiBUWVBFX1NISUZUO1xuICAgICAgICAgICAgdGhpcy50b2tlbkVuZCA9IG5leHQgJiBPRkZTRVRfTUFTSztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudG9rZW5JbmRleCA9IHRoaXMudG9rZW5Db3VudDtcbiAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMudG9rZW5UeXBlID0gRU9GJDE7XG4gICAgICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLnRva2VuRW5kID0gdGhpcy5zb3VyY2UubGVuZ3RoO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGZvckVhY2hUb2tlbihmbikge1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgb2Zmc2V0ID0gdGhpcy5maXJzdENoYXJPZmZzZXQ7IGkgPCB0aGlzLnRva2VuQ291bnQ7IGkrKykge1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gb2Zmc2V0O1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLm9mZnNldEFuZFR5cGVbaV07XG4gICAgICAgICAgICB2YXIgZW5kID0gaXRlbSAmIE9GRlNFVF9NQVNLO1xuICAgICAgICAgICAgdmFyIHR5cGUgPSBpdGVtID4+IFRZUEVfU0hJRlQ7XG5cbiAgICAgICAgICAgIG9mZnNldCA9IGVuZDtcblxuICAgICAgICAgICAgZm4odHlwZSwgc3RhcnQsIGVuZCwgaSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZHVtcCgpIHtcbiAgICAgICAgdmFyIHRva2VucyA9IG5ldyBBcnJheSh0aGlzLnRva2VuQ291bnQpO1xuXG4gICAgICAgIHRoaXMuZm9yRWFjaFRva2VuKCh0eXBlLCBzdGFydCwgZW5kLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgdG9rZW5zW2luZGV4XSA9IHtcbiAgICAgICAgICAgICAgICBpZHg6IGluZGV4LFxuICAgICAgICAgICAgICAgIHR5cGU6IE5BTUUkMVt0eXBlXSxcbiAgICAgICAgICAgICAgICBjaHVuazogdGhpcy5zb3VyY2Uuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpLFxuICAgICAgICAgICAgICAgIGJhbGFuY2U6IHRoaXMuYmFsYW5jZVtpbmRleF1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0b2tlbnM7XG4gICAgfVxufTtcblxudmFyIFRva2VuU3RyZWFtXzEgPSBUb2tlblN0cmVhbTtcblxudmFyIFRZUEUkMiA9IF9jb25zdC5UWVBFO1xuXG5cbnZhciBpc05ld2xpbmUkMSA9IGNoYXJDb2RlRGVmaW5pdGlvbnMuaXNOZXdsaW5lO1xudmFyIGlzTmFtZSQyID0gY2hhckNvZGVEZWZpbml0aW9ucy5pc05hbWU7XG52YXIgaXNWYWxpZEVzY2FwZSQyID0gY2hhckNvZGVEZWZpbml0aW9ucy5pc1ZhbGlkRXNjYXBlO1xudmFyIGlzTnVtYmVyU3RhcnQkMSA9IGNoYXJDb2RlRGVmaW5pdGlvbnMuaXNOdW1iZXJTdGFydDtcbnZhciBpc0lkZW50aWZpZXJTdGFydCQyID0gY2hhckNvZGVEZWZpbml0aW9ucy5pc0lkZW50aWZpZXJTdGFydDtcbnZhciBjaGFyQ29kZUNhdGVnb3J5JDEgPSBjaGFyQ29kZURlZmluaXRpb25zLmNoYXJDb2RlQ2F0ZWdvcnk7XG52YXIgaXNCT00kMSA9IGNoYXJDb2RlRGVmaW5pdGlvbnMuaXNCT007XG5cblxudmFyIGNtcFN0ciQyID0gdXRpbHMuY21wU3RyO1xudmFyIGdldE5ld2xpbmVMZW5ndGgkMSA9IHV0aWxzLmdldE5ld2xpbmVMZW5ndGg7XG52YXIgZmluZFdoaXRlU3BhY2VFbmQkMSA9IHV0aWxzLmZpbmRXaGl0ZVNwYWNlRW5kO1xudmFyIGNvbnN1bWVFc2NhcGVkJDEgPSB1dGlscy5jb25zdW1lRXNjYXBlZDtcbnZhciBjb25zdW1lTmFtZSQxID0gdXRpbHMuY29uc3VtZU5hbWU7XG52YXIgY29uc3VtZU51bWJlciQxID0gdXRpbHMuY29uc3VtZU51bWJlcjtcbnZhciBjb25zdW1lQmFkVXJsUmVtbmFudHMkMSA9IHV0aWxzLmNvbnN1bWVCYWRVcmxSZW1uYW50cztcblxudmFyIE9GRlNFVF9NQVNLJDEgPSAweDAwRkZGRkZGO1xudmFyIFRZUEVfU0hJRlQkMSA9IDI0O1xuXG5mdW5jdGlvbiB0b2tlbml6ZShzb3VyY2UsIHN0cmVhbSkge1xuICAgIGZ1bmN0aW9uIGdldENoYXJDb2RlKG9mZnNldCkge1xuICAgICAgICByZXR1cm4gb2Zmc2V0IDwgc291cmNlTGVuZ3RoID8gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KSA6IDA7XG4gICAgfVxuXG4gICAgLy8gwqcgNC4zLjMuIENvbnN1bWUgYSBudW1lcmljIHRva2VuXG4gICAgZnVuY3Rpb24gY29uc3VtZU51bWVyaWNUb2tlbigpIHtcbiAgICAgICAgLy8gQ29uc3VtZSBhIG51bWJlciBhbmQgbGV0IG51bWJlciBiZSB0aGUgcmVzdWx0LlxuICAgICAgICBvZmZzZXQgPSBjb25zdW1lTnVtYmVyJDEoc291cmNlLCBvZmZzZXQpO1xuXG4gICAgICAgIC8vIElmIHRoZSBuZXh0IDMgaW5wdXQgY29kZSBwb2ludHMgd291bGQgc3RhcnQgYW4gaWRlbnRpZmllciwgdGhlbjpcbiAgICAgICAgaWYgKGlzSWRlbnRpZmllclN0YXJ0JDIoZ2V0Q2hhckNvZGUob2Zmc2V0KSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMSksIGdldENoYXJDb2RlKG9mZnNldCArIDIpKSkge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgPGRpbWVuc2lvbi10b2tlbj4gd2l0aCB0aGUgc2FtZSB2YWx1ZSBhbmQgdHlwZSBmbGFnIGFzIG51bWJlciwgYW5kIGEgdW5pdCBzZXQgaW5pdGlhbGx5IHRvIHRoZSBlbXB0eSBzdHJpbmcuXG4gICAgICAgICAgICAvLyBDb25zdW1lIGEgbmFtZS4gU2V0IHRoZSA8ZGltZW5zaW9uLXRva2VuPuKAmXMgdW5pdCB0byB0aGUgcmV0dXJuZWQgdmFsdWUuXG4gICAgICAgICAgICAvLyBSZXR1cm4gdGhlIDxkaW1lbnNpb24tdG9rZW4+LlxuICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5EaW1lbnNpb247XG4gICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lTmFtZSQxKHNvdXJjZSwgb2Zmc2V0KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBVKzAwMjUgUEVSQ0VOVEFHRSBTSUdOICglKSwgY29uc3VtZSBpdC5cbiAgICAgICAgaWYgKGdldENoYXJDb2RlKG9mZnNldCkgPT09IDB4MDAyNSkge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgPHBlcmNlbnRhZ2UtdG9rZW4+IHdpdGggdGhlIHNhbWUgdmFsdWUgYXMgbnVtYmVyLCBhbmQgcmV0dXJuIGl0LlxuICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5QZXJjZW50YWdlO1xuICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBPdGhlcndpc2UsIGNyZWF0ZSBhIDxudW1iZXItdG9rZW4+IHdpdGggdGhlIHNhbWUgdmFsdWUgYW5kIHR5cGUgZmxhZyBhcyBudW1iZXIsIGFuZCByZXR1cm4gaXQuXG4gICAgICAgIHR5cGUgPSBUWVBFJDIuTnVtYmVyO1xuICAgIH1cblxuICAgIC8vIMKnIDQuMy40LiBDb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW5cbiAgICBmdW5jdGlvbiBjb25zdW1lSWRlbnRMaWtlVG9rZW4oKSB7XG4gICAgICAgIGNvbnN0IG5hbWVTdGFydE9mZnNldCA9IG9mZnNldDtcblxuICAgICAgICAvLyBDb25zdW1lIGEgbmFtZSwgYW5kIGxldCBzdHJpbmcgYmUgdGhlIHJlc3VsdC5cbiAgICAgICAgb2Zmc2V0ID0gY29uc3VtZU5hbWUkMShzb3VyY2UsIG9mZnNldCk7XG5cbiAgICAgICAgLy8gSWYgc3RyaW5n4oCZcyB2YWx1ZSBpcyBhbiBBU0NJSSBjYXNlLWluc2Vuc2l0aXZlIG1hdGNoIGZvciBcInVybFwiLFxuICAgICAgICAvLyBhbmQgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBVKzAwMjggTEVGVCBQQVJFTlRIRVNJUyAoKCksIGNvbnN1bWUgaXQuXG4gICAgICAgIGlmIChjbXBTdHIkMihzb3VyY2UsIG5hbWVTdGFydE9mZnNldCwgb2Zmc2V0LCAndXJsJykgJiYgZ2V0Q2hhckNvZGUob2Zmc2V0KSA9PT0gMHgwMDI4KSB7XG4gICAgICAgICAgICAvLyBXaGlsZSB0aGUgbmV4dCB0d28gaW5wdXQgY29kZSBwb2ludHMgYXJlIHdoaXRlc3BhY2UsIGNvbnN1bWUgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludC5cbiAgICAgICAgICAgIG9mZnNldCA9IGZpbmRXaGl0ZVNwYWNlRW5kJDEoc291cmNlLCBvZmZzZXQgKyAxKTtcblxuICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgb25lIG9yIHR3byBpbnB1dCBjb2RlIHBvaW50cyBhcmUgVSswMDIyIFFVT1RBVElPTiBNQVJLIChcIiksIFUrMDAyNyBBUE9TVFJPUEhFICgnKSxcbiAgICAgICAgICAgIC8vIG9yIHdoaXRlc3BhY2UgZm9sbG93ZWQgYnkgVSswMDIyIFFVT1RBVElPTiBNQVJLIChcIikgb3IgVSswMDI3IEFQT1NUUk9QSEUgKCcpLFxuICAgICAgICAgICAgLy8gdGhlbiBjcmVhdGUgYSA8ZnVuY3Rpb24tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byBzdHJpbmcgYW5kIHJldHVybiBpdC5cbiAgICAgICAgICAgIGlmIChnZXRDaGFyQ29kZShvZmZzZXQpID09PSAweDAwMjIgfHxcbiAgICAgICAgICAgICAgICBnZXRDaGFyQ29kZShvZmZzZXQpID09PSAweDAwMjcpIHtcbiAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkZ1bmN0aW9uO1xuICAgICAgICAgICAgICAgIG9mZnNldCA9IG5hbWVTdGFydE9mZnNldCArIDQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBPdGhlcndpc2UsIGNvbnN1bWUgYSB1cmwgdG9rZW4sIGFuZCByZXR1cm4gaXQuXG4gICAgICAgICAgICBjb25zdW1lVXJsVG9rZW4oKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBVKzAwMjggTEVGVCBQQVJFTlRIRVNJUyAoKCksIGNvbnN1bWUgaXQuXG4gICAgICAgIC8vIENyZWF0ZSBhIDxmdW5jdGlvbi10b2tlbj4gd2l0aCBpdHMgdmFsdWUgc2V0IHRvIHN0cmluZyBhbmQgcmV0dXJuIGl0LlxuICAgICAgICBpZiAoZ2V0Q2hhckNvZGUob2Zmc2V0KSA9PT0gMHgwMDI4KSB7XG4gICAgICAgICAgICB0eXBlID0gVFlQRSQyLkZ1bmN0aW9uO1xuICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBPdGhlcndpc2UsIGNyZWF0ZSBhbiA8aWRlbnQtdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byBzdHJpbmcgYW5kIHJldHVybiBpdC5cbiAgICAgICAgdHlwZSA9IFRZUEUkMi5JZGVudDtcbiAgICB9XG5cbiAgICAvLyDCpyA0LjMuNS4gQ29uc3VtZSBhIHN0cmluZyB0b2tlblxuICAgIGZ1bmN0aW9uIGNvbnN1bWVTdHJpbmdUb2tlbihlbmRpbmdDb2RlUG9pbnQpIHtcbiAgICAgICAgLy8gVGhpcyBhbGdvcml0aG0gbWF5IGJlIGNhbGxlZCB3aXRoIGFuIGVuZGluZyBjb2RlIHBvaW50LCB3aGljaCBkZW5vdGVzIHRoZSBjb2RlIHBvaW50XG4gICAgICAgIC8vIHRoYXQgZW5kcyB0aGUgc3RyaW5nLiBJZiBhbiBlbmRpbmcgY29kZSBwb2ludCBpcyBub3Qgc3BlY2lmaWVkLFxuICAgICAgICAvLyB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50IGlzIHVzZWQuXG4gICAgICAgIGlmICghZW5kaW5nQ29kZVBvaW50KSB7XG4gICAgICAgICAgICBlbmRpbmdDb2RlUG9pbnQgPSBnZXRDaGFyQ29kZShvZmZzZXQrKyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJbml0aWFsbHkgY3JlYXRlIGEgPHN0cmluZy10b2tlbj4gd2l0aCBpdHMgdmFsdWUgc2V0IHRvIHRoZSBlbXB0eSBzdHJpbmcuXG4gICAgICAgIHR5cGUgPSBUWVBFJDIuU3RyaW5nO1xuXG4gICAgICAgIC8vIFJlcGVhdGVkbHkgY29uc3VtZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGZyb20gdGhlIHN0cmVhbTpcbiAgICAgICAgZm9yICg7IG9mZnNldCA8IHNvdXJjZS5sZW5ndGg7IG9mZnNldCsrKSB7XG4gICAgICAgICAgICB2YXIgY29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCk7XG5cbiAgICAgICAgICAgIHN3aXRjaCAoY2hhckNvZGVDYXRlZ29yeSQxKGNvZGUpKSB7XG4gICAgICAgICAgICAgICAgLy8gZW5kaW5nIGNvZGUgcG9pbnRcbiAgICAgICAgICAgICAgICBjYXNlIGVuZGluZ0NvZGVQb2ludDpcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSA8c3RyaW5nLXRva2VuPi5cbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgICAgIC8vIEVPRlxuICAgICAgICAgICAgICAgIGNhc2UgY2hhckNvZGVDYXRlZ29yeSQxLkVvZjpcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHBhcnNlIGVycm9yLiBSZXR1cm4gdGhlIDxzdHJpbmctdG9rZW4+LlxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAvLyBuZXdsaW5lXG4gICAgICAgICAgICAgICAgY2FzZSBjaGFyQ29kZUNhdGVnb3J5JDEuV2hpdGVTcGFjZTpcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmV3bGluZSQxKGNvZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgcGFyc2UgZXJyb3IuIFJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgPGJhZC1zdHJpbmctdG9rZW4+LCBhbmQgcmV0dXJuIGl0LlxuICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IGdldE5ld2xpbmVMZW5ndGgkMShzb3VyY2UsIG9mZnNldCwgY29kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkJhZFN0cmluZztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIC8vIFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFxcKVxuICAgICAgICAgICAgICAgIGNhc2UgMHgwMDVDOlxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIEVPRiwgZG8gbm90aGluZy5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9mZnNldCA9PT0gc291cmNlLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRDb2RlID0gZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBpZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIGEgbmV3bGluZSwgY29uc3VtZSBpdC5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmV3bGluZSQxKG5leHRDb2RlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IGdldE5ld2xpbmVMZW5ndGgkMShzb3VyY2UsIG9mZnNldCArIDEsIG5leHRDb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1ZhbGlkRXNjYXBlJDIoY29kZSwgbmV4dENvZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsICh0aGUgc3RyZWFtIHN0YXJ0cyB3aXRoIGEgdmFsaWQgZXNjYXBlKSBjb25zdW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhbiBlc2NhcGVkIGNvZGUgcG9pbnQgYW5kIGFwcGVuZCB0aGUgcmV0dXJuZWQgY29kZSBwb2ludCB0b1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIDxzdHJpbmctdG9rZW4+4oCZcyB2YWx1ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IGNvbnN1bWVFc2NhcGVkJDEoc291cmNlLCBvZmZzZXQpIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIC8vIGFueXRoaW5nIGVsc2VcbiAgICAgICAgICAgICAgICAvLyBBcHBlbmQgdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludCB0byB0aGUgPHN0cmluZy10b2tlbj7igJlzIHZhbHVlLlxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gwqcgNC4zLjYuIENvbnN1bWUgYSB1cmwgdG9rZW5cbiAgICAvLyBOb3RlOiBUaGlzIGFsZ29yaXRobSBhc3N1bWVzIHRoYXQgdGhlIGluaXRpYWwgXCJ1cmwoXCIgaGFzIGFscmVhZHkgYmVlbiBjb25zdW1lZC5cbiAgICAvLyBUaGlzIGFsZ29yaXRobSBhbHNvIGFzc3VtZXMgdGhhdCBpdOKAmXMgYmVpbmcgY2FsbGVkIHRvIGNvbnN1bWUgYW4gXCJ1bnF1b3RlZFwiIHZhbHVlLCBsaWtlIHVybChmb28pLlxuICAgIC8vIEEgcXVvdGVkIHZhbHVlLCBsaWtlIHVybChcImZvb1wiKSwgaXMgcGFyc2VkIGFzIGEgPGZ1bmN0aW9uLXRva2VuPi4gQ29uc3VtZSBhbiBpZGVudC1saWtlIHRva2VuXG4gICAgLy8gYXV0b21hdGljYWxseSBoYW5kbGVzIHRoaXMgZGlzdGluY3Rpb247IHRoaXMgYWxnb3JpdGhtIHNob3VsZG7igJl0IGJlIGNhbGxlZCBkaXJlY3RseSBvdGhlcndpc2UuXG4gICAgZnVuY3Rpb24gY29uc3VtZVVybFRva2VuKCkge1xuICAgICAgICAvLyBJbml0aWFsbHkgY3JlYXRlIGEgPHVybC10b2tlbj4gd2l0aCBpdHMgdmFsdWUgc2V0IHRvIHRoZSBlbXB0eSBzdHJpbmcuXG4gICAgICAgIHR5cGUgPSBUWVBFJDIuVXJsO1xuXG4gICAgICAgIC8vIENvbnN1bWUgYXMgbXVjaCB3aGl0ZXNwYWNlIGFzIHBvc3NpYmxlLlxuICAgICAgICBvZmZzZXQgPSBmaW5kV2hpdGVTcGFjZUVuZCQxKHNvdXJjZSwgb2Zmc2V0KTtcblxuICAgICAgICAvLyBSZXBlYXRlZGx5IGNvbnN1bWUgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBmcm9tIHRoZSBzdHJlYW06XG4gICAgICAgIGZvciAoOyBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoOyBvZmZzZXQrKykge1xuICAgICAgICAgICAgdmFyIGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKGNoYXJDb2RlQ2F0ZWdvcnkkMShjb2RlKSkge1xuICAgICAgICAgICAgICAgIC8vIFUrMDAyOSBSSUdIVCBQQVJFTlRIRVNJUyAoKSlcbiAgICAgICAgICAgICAgICBjYXNlIDB4MDAyOTpcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSA8dXJsLXRva2VuPi5cbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgICAgIC8vIEVPRlxuICAgICAgICAgICAgICAgIGNhc2UgY2hhckNvZGVDYXRlZ29yeSQxLkVvZjpcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHBhcnNlIGVycm9yLiBSZXR1cm4gdGhlIDx1cmwtdG9rZW4+LlxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAvLyB3aGl0ZXNwYWNlXG4gICAgICAgICAgICAgICAgY2FzZSBjaGFyQ29kZUNhdGVnb3J5JDEuV2hpdGVTcGFjZTpcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29uc3VtZSBhcyBtdWNoIHdoaXRlc3BhY2UgYXMgcG9zc2libGUuXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IGZpbmRXaGl0ZVNwYWNlRW5kJDEoc291cmNlLCBvZmZzZXQpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgVSswMDI5IFJJR0hUIFBBUkVOVEhFU0lTICgpKSBvciBFT0YsXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnN1bWUgaXQgYW5kIHJldHVybiB0aGUgPHVybC10b2tlbj5cbiAgICAgICAgICAgICAgICAgICAgLy8gKGlmIEVPRiB3YXMgZW5jb3VudGVyZWQsIHRoaXMgaXMgYSBwYXJzZSBlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChnZXRDaGFyQ29kZShvZmZzZXQpID09PSAweDAwMjkgfHwgb2Zmc2V0ID49IHNvdXJjZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPCBzb3VyY2UubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UsIGNvbnN1bWUgdGhlIHJlbW5hbnRzIG9mIGEgYmFkIHVybCwgY3JlYXRlIGEgPGJhZC11cmwtdG9rZW4+LFxuICAgICAgICAgICAgICAgICAgICAvLyBhbmQgcmV0dXJuIGl0LlxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lQmFkVXJsUmVtbmFudHMkMShzb3VyY2UsIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSBUWVBFJDIuQmFkVXJsO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAvLyBVKzAwMjIgUVVPVEFUSU9OIE1BUksgKFwiKVxuICAgICAgICAgICAgICAgIC8vIFUrMDAyNyBBUE9TVFJPUEhFICgnKVxuICAgICAgICAgICAgICAgIC8vIFUrMDAyOCBMRUZUIFBBUkVOVEhFU0lTICgoKVxuICAgICAgICAgICAgICAgIC8vIG5vbi1wcmludGFibGUgY29kZSBwb2ludFxuICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIyOlxuICAgICAgICAgICAgICAgIGNhc2UgMHgwMDI3OlxuICAgICAgICAgICAgICAgIGNhc2UgMHgwMDI4OlxuICAgICAgICAgICAgICAgIGNhc2UgY2hhckNvZGVDYXRlZ29yeSQxLk5vblByaW50YWJsZTpcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHBhcnNlIGVycm9yLiBDb25zdW1lIHRoZSByZW1uYW50cyBvZiBhIGJhZCB1cmwsXG4gICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIDxiYWQtdXJsLXRva2VuPiwgYW5kIHJldHVybiBpdC5cbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZUJhZFVybFJlbW5hbnRzJDEoc291cmNlLCBvZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkJhZFVybDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgLy8gVSswMDVDIFJFVkVSU0UgU09MSURVUyAoXFwpXG4gICAgICAgICAgICAgICAgY2FzZSAweDAwNUM6XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzdHJlYW0gc3RhcnRzIHdpdGggYSB2YWxpZCBlc2NhcGUsIGNvbnN1bWUgYW4gZXNjYXBlZCBjb2RlIHBvaW50IGFuZFxuICAgICAgICAgICAgICAgICAgICAvLyBhcHBlbmQgdGhlIHJldHVybmVkIGNvZGUgcG9pbnQgdG8gdGhlIDx1cmwtdG9rZW4+4oCZcyB2YWx1ZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzVmFsaWRFc2NhcGUkMihjb2RlLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IGNvbnN1bWVFc2NhcGVkJDEoc291cmNlLCBvZmZzZXQpIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCB0aGlzIGlzIGEgcGFyc2UgZXJyb3IuIENvbnN1bWUgdGhlIHJlbW5hbnRzIG9mIGEgYmFkIHVybCxcbiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgPGJhZC11cmwtdG9rZW4+LCBhbmQgcmV0dXJuIGl0LlxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lQmFkVXJsUmVtbmFudHMkMShzb3VyY2UsIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSBUWVBFJDIuQmFkVXJsO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAvLyBhbnl0aGluZyBlbHNlXG4gICAgICAgICAgICAgICAgLy8gQXBwZW5kIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQgdG8gdGhlIDx1cmwtdG9rZW4+4oCZcyB2YWx1ZS5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmICghc3RyZWFtKSB7XG4gICAgICAgIHN0cmVhbSA9IG5ldyBUb2tlblN0cmVhbV8xKCk7XG4gICAgfVxuXG4gICAgLy8gZW5zdXJlIHNvdXJjZSBpcyBhIHN0cmluZ1xuICAgIHNvdXJjZSA9IFN0cmluZyhzb3VyY2UgfHwgJycpO1xuXG4gICAgdmFyIHNvdXJjZUxlbmd0aCA9IHNvdXJjZS5sZW5ndGg7XG4gICAgdmFyIG9mZnNldEFuZFR5cGUgPSBhZG9wdEJ1ZmZlcihzdHJlYW0ub2Zmc2V0QW5kVHlwZSwgc291cmNlTGVuZ3RoICsgMSk7IC8vICsxIGJlY2F1c2Ugb2YgZW9mLXRva2VuXG4gICAgdmFyIGJhbGFuY2UgPSBhZG9wdEJ1ZmZlcihzdHJlYW0uYmFsYW5jZSwgc291cmNlTGVuZ3RoICsgMSk7XG4gICAgdmFyIHRva2VuQ291bnQgPSAwO1xuICAgIHZhciBzdGFydCA9IGlzQk9NJDEoZ2V0Q2hhckNvZGUoMCkpO1xuICAgIHZhciBvZmZzZXQgPSBzdGFydDtcbiAgICB2YXIgYmFsYW5jZUNsb3NlVHlwZSA9IDA7XG4gICAgdmFyIGJhbGFuY2VTdGFydCA9IDA7XG4gICAgdmFyIGJhbGFuY2VQcmV2ID0gMDtcblxuICAgIC8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LTMvI2NvbnN1bWUtdG9rZW5cbiAgICAvLyDCpyA0LjMuMS4gQ29uc3VtZSBhIHRva2VuXG4gICAgd2hpbGUgKG9mZnNldCA8IHNvdXJjZUxlbmd0aCkge1xuICAgICAgICB2YXIgY29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCk7XG4gICAgICAgIHZhciB0eXBlID0gMDtcblxuICAgICAgICBiYWxhbmNlW3Rva2VuQ291bnRdID0gc291cmNlTGVuZ3RoO1xuXG4gICAgICAgIHN3aXRjaCAoY2hhckNvZGVDYXRlZ29yeSQxKGNvZGUpKSB7XG4gICAgICAgICAgICAvLyB3aGl0ZXNwYWNlXG4gICAgICAgICAgICBjYXNlIGNoYXJDb2RlQ2F0ZWdvcnkkMS5XaGl0ZVNwYWNlOlxuICAgICAgICAgICAgICAgIC8vIENvbnN1bWUgYXMgbXVjaCB3aGl0ZXNwYWNlIGFzIHBvc3NpYmxlLiBSZXR1cm4gYSA8d2hpdGVzcGFjZS10b2tlbj4uXG4gICAgICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5XaGl0ZVNwYWNlO1xuICAgICAgICAgICAgICAgIG9mZnNldCA9IGZpbmRXaGl0ZVNwYWNlRW5kJDEoc291cmNlLCBvZmZzZXQgKyAxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVSswMDIyIFFVT1RBVElPTiBNQVJLIChcIilcbiAgICAgICAgICAgIGNhc2UgMHgwMDIyOlxuICAgICAgICAgICAgICAgIC8vIENvbnN1bWUgYSBzdHJpbmcgdG9rZW4gYW5kIHJldHVybiBpdC5cbiAgICAgICAgICAgICAgICBjb25zdW1lU3RyaW5nVG9rZW4oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVSswMDIzIE5VTUJFUiBTSUdOICgjKVxuICAgICAgICAgICAgY2FzZSAweDAwMjM6XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBhIG5hbWUgY29kZSBwb2ludCBvciB0aGUgbmV4dCB0d28gaW5wdXQgY29kZSBwb2ludHMgYXJlIGEgdmFsaWQgZXNjYXBlLCB0aGVuOlxuICAgICAgICAgICAgICAgIGlmIChpc05hbWUkMihnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSkgfHwgaXNWYWxpZEVzY2FwZSQyKGdldENoYXJDb2RlKG9mZnNldCArIDEpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgPGhhc2gtdG9rZW4+LlxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkhhc2g7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgMyBpbnB1dCBjb2RlIHBvaW50cyB3b3VsZCBzdGFydCBhbiBpZGVudGlmaWVyLCBzZXQgdGhlIDxoYXNoLXRva2VuPuKAmXMgdHlwZSBmbGFnIHRvIFwiaWRcIi5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKGlzSWRlbnRpZmllclN0YXJ0KGdldENoYXJDb2RlKG9mZnNldCArIDEpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMykpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAvLyBUT0RPOiBzZXQgaWQgZmxhZ1xuICAgICAgICAgICAgICAgICAgICAvLyB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ29uc3VtZSBhIG5hbWUsIGFuZCBzZXQgdGhlIDxoYXNoLXRva2VuPuKAmXMgdmFsdWUgdG8gdGhlIHJldHVybmVkIHN0cmluZy5cbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZU5hbWUkMShzb3VyY2UsIG9mZnNldCArIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiB0aGUgPGhhc2gtdG9rZW4+LlxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgcmV0dXJuIGEgPGRlbGltLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC5cbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5EZWxpbTtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFUrMDAyNyBBUE9TVFJPUEhFICgnKVxuICAgICAgICAgICAgY2FzZSAweDAwMjc6XG4gICAgICAgICAgICAgICAgLy8gQ29uc3VtZSBhIHN0cmluZyB0b2tlbiBhbmQgcmV0dXJuIGl0LlxuICAgICAgICAgICAgICAgIGNvbnN1bWVTdHJpbmdUb2tlbigpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAvLyBVKzAwMjggTEVGVCBQQVJFTlRIRVNJUyAoKClcbiAgICAgICAgICAgIGNhc2UgMHgwMDI4OlxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDwoLXRva2VuPi5cbiAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkxlZnRQYXJlbnRoZXNpcztcbiAgICAgICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVSswMDI5IFJJR0hUIFBBUkVOVEhFU0lTICgpKVxuICAgICAgICAgICAgY2FzZSAweDAwMjk6XG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPCktdG9rZW4+LlxuICAgICAgICAgICAgICAgIHR5cGUgPSBUWVBFJDIuUmlnaHRQYXJlbnRoZXNpcztcbiAgICAgICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKylcbiAgICAgICAgICAgIGNhc2UgMHgwMDJCOlxuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYSBudW1iZXIsIC4uLlxuICAgICAgICAgICAgICAgIGlmIChpc051bWJlclN0YXJ0JDEoY29kZSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMSksIGdldENoYXJDb2RlKG9mZnNldCArIDIpKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyAuLi4gcmVjb25zdW1lIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQsIGNvbnN1bWUgYSBudW1lcmljIHRva2VuLCBhbmQgcmV0dXJuIGl0LlxuICAgICAgICAgICAgICAgICAgICBjb25zdW1lTnVtZXJpY1Rva2VuKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LlxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkRlbGltO1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFUrMDAyQyBDT01NQSAoLClcbiAgICAgICAgICAgIGNhc2UgMHgwMDJDOlxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDxjb21tYS10b2tlbj4uXG4gICAgICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5Db21tYTtcbiAgICAgICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVSswMDJEIEhZUEhFTi1NSU5VUyAoLSlcbiAgICAgICAgICAgIGNhc2UgMHgwMDJEOlxuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYSBudW1iZXIsIHJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGEgbnVtZXJpYyB0b2tlbiwgYW5kIHJldHVybiBpdC5cbiAgICAgICAgICAgICAgICBpZiAoaXNOdW1iZXJTdGFydCQxKGNvZGUsIGdldENoYXJDb2RlKG9mZnNldCArIDEpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3VtZU51bWVyaWNUb2tlbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIG5leHQgMiBpbnB1dCBjb2RlIHBvaW50cyBhcmUgVSswMDJEIEhZUEhFTi1NSU5VUyBVKzAwM0UgR1JFQVRFUi1USEFOIFNJR04gKC0+KSwgY29uc3VtZSB0aGVtIGFuZCByZXR1cm4gYSA8Q0RDLXRva2VuPi5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGdldENoYXJDb2RlKG9mZnNldCArIDEpID09PSAweDAwMkQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENoYXJDb2RlKG9mZnNldCArIDIpID09PSAweDAwM0UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBUWVBFJDIuQ0RDO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ICsgMztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIGlucHV0IHN0cmVhbSBzdGFydHMgd2l0aCBhbiBpZGVudGlmaWVyLCAuLi5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0lkZW50aWZpZXJTdGFydCQyKGNvZGUsIGdldENoYXJDb2RlKG9mZnNldCArIDEpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAuLi4gcmVjb25zdW1lIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQsIGNvbnN1bWUgYW4gaWRlbnQtbGlrZSB0b2tlbiwgYW5kIHJldHVybiBpdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lSWRlbnRMaWtlVG9rZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBUWVBFJDIuRGVsaW07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFUrMDAyRSBGVUxMIFNUT1AgKC4pXG4gICAgICAgICAgICBjYXNlIDB4MDAyRTpcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgaW5wdXQgc3RyZWFtIHN0YXJ0cyB3aXRoIGEgbnVtYmVyLCAuLi5cbiAgICAgICAgICAgICAgICBpZiAoaXNOdW1iZXJTdGFydCQxKGNvZGUsIGdldENoYXJDb2RlKG9mZnNldCArIDEpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gLi4uIHJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGEgbnVtZXJpYyB0b2tlbiwgYW5kIHJldHVybiBpdC5cbiAgICAgICAgICAgICAgICAgICAgY29uc3VtZU51bWVyaWNUb2tlbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgcmV0dXJuIGEgPGRlbGltLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC5cbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5EZWxpbTtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFUrMDAyRiBTT0xJRFVTICgvKVxuICAgICAgICAgICAgY2FzZSAweDAwMkY6XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgdHdvIGlucHV0IGNvZGUgcG9pbnQgYXJlIFUrMDAyRiBTT0xJRFVTICgvKSBmb2xsb3dlZCBieSBhIFUrMDAyQSBBU1RFUklTSyAoKiksXG4gICAgICAgICAgICAgICAgaWYgKGdldENoYXJDb2RlKG9mZnNldCArIDEpID09PSAweDAwMkEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gLi4uIGNvbnN1bWUgdGhlbSBhbmQgYWxsIGZvbGxvd2luZyBjb2RlIHBvaW50cyB1cCB0byBhbmQgaW5jbHVkaW5nIHRoZSBmaXJzdCBVKzAwMkEgQVNURVJJU0sgKCopXG4gICAgICAgICAgICAgICAgICAgIC8vIGZvbGxvd2VkIGJ5IGEgVSswMDJGIFNPTElEVVMgKC8pLCBvciB1cCB0byBhbiBFT0YgY29kZSBwb2ludC5cbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5Db21tZW50O1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBzb3VyY2UuaW5kZXhPZignKi8nLCBvZmZzZXQgKyAyKSArIDI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IHNvdXJjZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkRlbGltO1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFUrMDAzQSBDT0xPTiAoOilcbiAgICAgICAgICAgIGNhc2UgMHgwMDNBOlxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDxjb2xvbi10b2tlbj4uXG4gICAgICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5Db2xvbjtcbiAgICAgICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVSswMDNCIFNFTUlDT0xPTiAoOylcbiAgICAgICAgICAgIGNhc2UgMHgwMDNCOlxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDxzZW1pY29sb24tdG9rZW4+LlxuICAgICAgICAgICAgICAgIHR5cGUgPSBUWVBFJDIuU2VtaWNvbG9uO1xuICAgICAgICAgICAgICAgIG9mZnNldCsrO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAvLyBVKzAwM0MgTEVTUy1USEFOIFNJR04gKDwpXG4gICAgICAgICAgICBjYXNlIDB4MDAzQzpcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCAzIGlucHV0IGNvZGUgcG9pbnRzIGFyZSBVKzAwMjEgRVhDTEFNQVRJT04gTUFSSyBVKzAwMkQgSFlQSEVOLU1JTlVTIFUrMDAyRCBIWVBIRU4tTUlOVVMgKCEtLSksIC4uLlxuICAgICAgICAgICAgICAgIGlmIChnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSA9PT0gMHgwMDIxICYmXG4gICAgICAgICAgICAgICAgICAgIGdldENoYXJDb2RlKG9mZnNldCArIDIpID09PSAweDAwMkQgJiZcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMykgPT09IDB4MDAyRCkge1xuICAgICAgICAgICAgICAgICAgICAvLyAuLi4gY29uc3VtZSB0aGVtIGFuZCByZXR1cm4gYSA8Q0RPLXRva2VuPi5cbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5DRE87XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldCArIDQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LlxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkRlbGltO1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVSswMDQwIENPTU1FUkNJQUwgQVQgKEApXG4gICAgICAgICAgICBjYXNlIDB4MDA0MDpcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCAzIGlucHV0IGNvZGUgcG9pbnRzIHdvdWxkIHN0YXJ0IGFuIGlkZW50aWZpZXIsIC4uLlxuICAgICAgICAgICAgICAgIGlmIChpc0lkZW50aWZpZXJTdGFydCQyKGdldENoYXJDb2RlKG9mZnNldCArIDEpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMykpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIC4uLiBjb25zdW1lIGEgbmFtZSwgY3JlYXRlIGFuIDxhdC1rZXl3b3JkLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIHJldHVybmVkIHZhbHVlLCBhbmQgcmV0dXJuIGl0LlxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkF0S2V5d29yZDtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZU5hbWUkMShzb3VyY2UsIG9mZnNldCArIDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgcmV0dXJuIGEgPGRlbGltLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC5cbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IFRZUEUkMi5EZWxpbTtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFUrMDA1QiBMRUZUIFNRVUFSRSBCUkFDS0VUIChbKVxuICAgICAgICAgICAgY2FzZSAweDAwNUI6XG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPFstdG9rZW4+LlxuICAgICAgICAgICAgICAgIHR5cGUgPSBUWVBFJDIuTGVmdFNxdWFyZUJyYWNrZXQ7XG4gICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFxcKVxuICAgICAgICAgICAgY2FzZSAweDAwNUM6XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIGlucHV0IHN0cmVhbSBzdGFydHMgd2l0aCBhIHZhbGlkIGVzY2FwZSwgLi4uXG4gICAgICAgICAgICAgICAgaWYgKGlzVmFsaWRFc2NhcGUkMihjb2RlLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gLi4uIHJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW4sIGFuZCByZXR1cm4gaXQuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN1bWVJZGVudExpa2VUb2tlbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgdGhpcyBpcyBhIHBhcnNlIGVycm9yLiBSZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LlxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkRlbGltO1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFUrMDA1RCBSSUdIVCBTUVVBUkUgQlJBQ0tFVCAoXSlcbiAgICAgICAgICAgIGNhc2UgMHgwMDVEOlxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDxdLXRva2VuPi5cbiAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLlJpZ2h0U3F1YXJlQnJhY2tldDtcbiAgICAgICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVSswMDdCIExFRlQgQ1VSTFkgQlJBQ0tFVCAoeylcbiAgICAgICAgICAgIGNhc2UgMHgwMDdCOlxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDx7LXRva2VuPi5cbiAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkxlZnRDdXJseUJyYWNrZXQ7XG4gICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFUrMDA3RCBSSUdIVCBDVVJMWSBCUkFDS0VUICh9KVxuICAgICAgICAgICAgY2FzZSAweDAwN0Q6XG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPH0tdG9rZW4+LlxuICAgICAgICAgICAgICAgIHR5cGUgPSBUWVBFJDIuUmlnaHRDdXJseUJyYWNrZXQ7XG4gICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIGRpZ2l0XG4gICAgICAgICAgICBjYXNlIGNoYXJDb2RlQ2F0ZWdvcnkkMS5EaWdpdDpcbiAgICAgICAgICAgICAgICAvLyBSZWNvbnN1bWUgdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludCwgY29uc3VtZSBhIG51bWVyaWMgdG9rZW4sIGFuZCByZXR1cm4gaXQuXG4gICAgICAgICAgICAgICAgY29uc3VtZU51bWVyaWNUb2tlbigpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAvLyBuYW1lLXN0YXJ0IGNvZGUgcG9pbnRcbiAgICAgICAgICAgIGNhc2UgY2hhckNvZGVDYXRlZ29yeSQxLk5hbWVTdGFydDpcbiAgICAgICAgICAgICAgICAvLyBSZWNvbnN1bWUgdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludCwgY29uc3VtZSBhbiBpZGVudC1saWtlIHRva2VuLCBhbmQgcmV0dXJuIGl0LlxuICAgICAgICAgICAgICAgIGNvbnN1bWVJZGVudExpa2VUb2tlbigpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAvLyBFT0ZcbiAgICAgICAgICAgIGNhc2UgY2hhckNvZGVDYXRlZ29yeSQxLkVvZjpcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYW4gPEVPRi10b2tlbj4uXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIGFueXRoaW5nIGVsc2VcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPGRlbGltLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC5cbiAgICAgICAgICAgICAgICB0eXBlID0gVFlQRSQyLkRlbGltO1xuICAgICAgICAgICAgICAgIG9mZnNldCsrO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlIGJhbGFuY2VDbG9zZVR5cGU6XG4gICAgICAgICAgICAgICAgYmFsYW5jZVByZXYgPSBiYWxhbmNlU3RhcnQgJiBPRkZTRVRfTUFTSyQxO1xuICAgICAgICAgICAgICAgIGJhbGFuY2VTdGFydCA9IGJhbGFuY2VbYmFsYW5jZVByZXZdO1xuICAgICAgICAgICAgICAgIGJhbGFuY2VDbG9zZVR5cGUgPSBiYWxhbmNlU3RhcnQgPj4gVFlQRV9TSElGVCQxO1xuICAgICAgICAgICAgICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBiYWxhbmNlUHJldjtcbiAgICAgICAgICAgICAgICBiYWxhbmNlW2JhbGFuY2VQcmV2KytdID0gdG9rZW5Db3VudDtcbiAgICAgICAgICAgICAgICBmb3IgKDsgYmFsYW5jZVByZXYgPCB0b2tlbkNvdW50OyBiYWxhbmNlUHJldisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlW2JhbGFuY2VQcmV2XSA9PT0gc291cmNlTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWxhbmNlW2JhbGFuY2VQcmV2XSA9IHRva2VuQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgVFlQRSQyLkxlZnRQYXJlbnRoZXNpczpcbiAgICAgICAgICAgIGNhc2UgVFlQRSQyLkZ1bmN0aW9uOlxuICAgICAgICAgICAgICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBiYWxhbmNlU3RhcnQ7XG4gICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IFRZUEUkMi5SaWdodFBhcmVudGhlc2lzO1xuICAgICAgICAgICAgICAgIGJhbGFuY2VTdGFydCA9IChiYWxhbmNlQ2xvc2VUeXBlIDw8IFRZUEVfU0hJRlQkMSkgfCB0b2tlbkNvdW50O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFRZUEUkMi5MZWZ0U3F1YXJlQnJhY2tldDpcbiAgICAgICAgICAgICAgICBiYWxhbmNlW3Rva2VuQ291bnRdID0gYmFsYW5jZVN0YXJ0O1xuICAgICAgICAgICAgICAgIGJhbGFuY2VDbG9zZVR5cGUgPSBUWVBFJDIuUmlnaHRTcXVhcmVCcmFja2V0O1xuICAgICAgICAgICAgICAgIGJhbGFuY2VTdGFydCA9IChiYWxhbmNlQ2xvc2VUeXBlIDw8IFRZUEVfU0hJRlQkMSkgfCB0b2tlbkNvdW50O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFRZUEUkMi5MZWZ0Q3VybHlCcmFja2V0OlxuICAgICAgICAgICAgICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBiYWxhbmNlU3RhcnQ7XG4gICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IFRZUEUkMi5SaWdodEN1cmx5QnJhY2tldDtcbiAgICAgICAgICAgICAgICBiYWxhbmNlU3RhcnQgPSAoYmFsYW5jZUNsb3NlVHlwZSA8PCBUWVBFX1NISUZUJDEpIHwgdG9rZW5Db3VudDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIG9mZnNldEFuZFR5cGVbdG9rZW5Db3VudCsrXSA9ICh0eXBlIDw8IFRZUEVfU0hJRlQkMSkgfCBvZmZzZXQ7XG4gICAgfVxuXG4gICAgLy8gZmluYWxpemUgYnVmZmVyc1xuICAgIG9mZnNldEFuZFR5cGVbdG9rZW5Db3VudF0gPSAoVFlQRSQyLkVPRiA8PCBUWVBFX1NISUZUJDEpIHwgb2Zmc2V0OyAvLyA8RU9GLXRva2VuPlxuICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBzb3VyY2VMZW5ndGg7XG4gICAgYmFsYW5jZVtzb3VyY2VMZW5ndGhdID0gc291cmNlTGVuZ3RoOyAvLyBwcmV2ZW50cyBmYWxzZSBwb3NpdGl2ZSBiYWxhbmNlIG1hdGNoIHdpdGggYW55IHRva2VuXG4gICAgd2hpbGUgKGJhbGFuY2VTdGFydCAhPT0gMCkge1xuICAgICAgICBiYWxhbmNlUHJldiA9IGJhbGFuY2VTdGFydCAmIE9GRlNFVF9NQVNLJDE7XG4gICAgICAgIGJhbGFuY2VTdGFydCA9IGJhbGFuY2VbYmFsYW5jZVByZXZdO1xuICAgICAgICBiYWxhbmNlW2JhbGFuY2VQcmV2XSA9IHNvdXJjZUxlbmd0aDtcbiAgICB9XG5cbiAgICAvLyB1cGRhdGUgc3RyZWFtXG4gICAgc3RyZWFtLnNvdXJjZSA9IHNvdXJjZTtcbiAgICBzdHJlYW0uZmlyc3RDaGFyT2Zmc2V0ID0gc3RhcnQ7XG4gICAgc3RyZWFtLm9mZnNldEFuZFR5cGUgPSBvZmZzZXRBbmRUeXBlO1xuICAgIHN0cmVhbS50b2tlbkNvdW50ID0gdG9rZW5Db3VudDtcbiAgICBzdHJlYW0uYmFsYW5jZSA9IGJhbGFuY2U7XG4gICAgc3RyZWFtLnJlc2V0KCk7XG4gICAgc3RyZWFtLm5leHQoKTtcblxuICAgIHJldHVybiBzdHJlYW07XG59XG5cbi8vIGV4dGVuZCB0b2tlbml6ZXIgd2l0aCBjb25zdGFudHNcbk9iamVjdC5rZXlzKF9jb25zdCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICB0b2tlbml6ZVtrZXldID0gX2NvbnN0W2tleV07XG59KTtcblxuLy8gZXh0ZW5kIHRva2VuaXplciB3aXRoIHN0YXRpYyBtZXRob2RzIGZyb20gdXRpbHNcbk9iamVjdC5rZXlzKGNoYXJDb2RlRGVmaW5pdGlvbnMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgdG9rZW5pemVba2V5XSA9IGNoYXJDb2RlRGVmaW5pdGlvbnNba2V5XTtcbn0pO1xuT2JqZWN0LmtleXModXRpbHMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgdG9rZW5pemVba2V5XSA9IHV0aWxzW2tleV07XG59KTtcblxudmFyIHRva2VuaXplciA9IHRva2VuaXplO1xuXG52YXIgaXNCT00kMiA9IHRva2VuaXplci5pc0JPTTtcblxudmFyIE4gPSAxMDtcbnZhciBGID0gMTI7XG52YXIgUiA9IDEzO1xuXG5mdW5jdGlvbiBjb21wdXRlTGluZXNBbmRDb2x1bW5zKGhvc3QsIHNvdXJjZSkge1xuICAgIHZhciBzb3VyY2VMZW5ndGggPSBzb3VyY2UubGVuZ3RoO1xuICAgIHZhciBsaW5lcyA9IGFkb3B0QnVmZmVyKGhvc3QubGluZXMsIHNvdXJjZUxlbmd0aCk7IC8vICsxXG4gICAgdmFyIGxpbmUgPSBob3N0LnN0YXJ0TGluZTtcbiAgICB2YXIgY29sdW1ucyA9IGFkb3B0QnVmZmVyKGhvc3QuY29sdW1ucywgc291cmNlTGVuZ3RoKTtcbiAgICB2YXIgY29sdW1uID0gaG9zdC5zdGFydENvbHVtbjtcbiAgICB2YXIgc3RhcnRPZmZzZXQgPSBzb3VyY2UubGVuZ3RoID4gMCA/IGlzQk9NJDIoc291cmNlLmNoYXJDb2RlQXQoMCkpIDogMDtcblxuICAgIGZvciAodmFyIGkgPSBzdGFydE9mZnNldDsgaSA8IHNvdXJjZUxlbmd0aDsgaSsrKSB7IC8vIC0xXG4gICAgICAgIHZhciBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQoaSk7XG5cbiAgICAgICAgbGluZXNbaV0gPSBsaW5lO1xuICAgICAgICBjb2x1bW5zW2ldID0gY29sdW1uKys7XG5cbiAgICAgICAgaWYgKGNvZGUgPT09IE4gfHwgY29kZSA9PT0gUiB8fCBjb2RlID09PSBGKSB7XG4gICAgICAgICAgICBpZiAoY29kZSA9PT0gUiAmJiBpICsgMSA8IHNvdXJjZUxlbmd0aCAmJiBzb3VyY2UuY2hhckNvZGVBdChpICsgMSkgPT09IE4pIHtcbiAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgbGluZXNbaV0gPSBsaW5lO1xuICAgICAgICAgICAgICAgIGNvbHVtbnNbaV0gPSBjb2x1bW47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxpbmUrKztcbiAgICAgICAgICAgIGNvbHVtbiA9IDE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsaW5lc1tpXSA9IGxpbmU7XG4gICAgY29sdW1uc1tpXSA9IGNvbHVtbjtcblxuICAgIGhvc3QubGluZXMgPSBsaW5lcztcbiAgICBob3N0LmNvbHVtbnMgPSBjb2x1bW5zO1xufVxuXG52YXIgT2Zmc2V0VG9Mb2NhdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubGluZXMgPSBudWxsO1xuICAgIHRoaXMuY29sdW1ucyA9IG51bGw7XG4gICAgdGhpcy5saW5lc0FuZENvbHVtbnNDb21wdXRlZCA9IGZhbHNlO1xufTtcblxuT2Zmc2V0VG9Mb2NhdGlvbi5wcm90b3R5cGUgPSB7XG4gICAgc2V0U291cmNlOiBmdW5jdGlvbihzb3VyY2UsIHN0YXJ0T2Zmc2V0LCBzdGFydExpbmUsIHN0YXJ0Q29sdW1uKSB7XG4gICAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgICB0aGlzLnN0YXJ0T2Zmc2V0ID0gdHlwZW9mIHN0YXJ0T2Zmc2V0ID09PSAndW5kZWZpbmVkJyA/IDAgOiBzdGFydE9mZnNldDtcbiAgICAgICAgdGhpcy5zdGFydExpbmUgPSB0eXBlb2Ygc3RhcnRMaW5lID09PSAndW5kZWZpbmVkJyA/IDEgOiBzdGFydExpbmU7XG4gICAgICAgIHRoaXMuc3RhcnRDb2x1bW4gPSB0eXBlb2Ygc3RhcnRDb2x1bW4gPT09ICd1bmRlZmluZWQnID8gMSA6IHN0YXJ0Q29sdW1uO1xuICAgICAgICB0aGlzLmxpbmVzQW5kQ29sdW1uc0NvbXB1dGVkID0gZmFsc2U7XG4gICAgfSxcblxuICAgIGVuc3VyZUxpbmVzQW5kQ29sdW1uc0NvbXB1dGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLmxpbmVzQW5kQ29sdW1uc0NvbXB1dGVkKSB7XG4gICAgICAgICAgICBjb21wdXRlTGluZXNBbmRDb2x1bW5zKHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICAgICAgICAgIHRoaXMubGluZXNBbmRDb2x1bW5zQ29tcHV0ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBnZXRMb2NhdGlvbjogZnVuY3Rpb24ob2Zmc2V0LCBmaWxlbmFtZSkge1xuICAgICAgICB0aGlzLmVuc3VyZUxpbmVzQW5kQ29sdW1uc0NvbXB1dGVkKCk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNvdXJjZTogZmlsZW5hbWUsXG4gICAgICAgICAgICBvZmZzZXQ6IHRoaXMuc3RhcnRPZmZzZXQgKyBvZmZzZXQsXG4gICAgICAgICAgICBsaW5lOiB0aGlzLmxpbmVzW29mZnNldF0sXG4gICAgICAgICAgICBjb2x1bW46IHRoaXMuY29sdW1uc1tvZmZzZXRdXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZXRMb2NhdGlvblJhbmdlOiBmdW5jdGlvbihzdGFydCwgZW5kLCBmaWxlbmFtZSkge1xuICAgICAgICB0aGlzLmVuc3VyZUxpbmVzQW5kQ29sdW1uc0NvbXB1dGVkKCk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNvdXJjZTogZmlsZW5hbWUsXG4gICAgICAgICAgICBzdGFydDoge1xuICAgICAgICAgICAgICAgIG9mZnNldDogdGhpcy5zdGFydE9mZnNldCArIHN0YXJ0LFxuICAgICAgICAgICAgICAgIGxpbmU6IHRoaXMubGluZXNbc3RhcnRdLFxuICAgICAgICAgICAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW5zW3N0YXJ0XVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVuZDoge1xuICAgICAgICAgICAgICAgIG9mZnNldDogdGhpcy5zdGFydE9mZnNldCArIGVuZCxcbiAgICAgICAgICAgICAgICBsaW5lOiB0aGlzLmxpbmVzW2VuZF0sXG4gICAgICAgICAgICAgICAgY29sdW1uOiB0aGlzLmNvbHVtbnNbZW5kXVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbn07XG5cbnZhciBPZmZzZXRUb0xvY2F0aW9uXzEgPSBPZmZzZXRUb0xvY2F0aW9uO1xuXG52YXIgY3JlYXRlQ3VzdG9tRXJyb3IgPSBmdW5jdGlvbiBjcmVhdGVDdXN0b21FcnJvcihuYW1lLCBtZXNzYWdlKSB7XG4gICAgLy8gdXNlIE9iamVjdC5jcmVhdGUoKSwgYmVjYXVzZSBzb21lIFZNcyBwcmV2ZW50IHNldHRpbmcgbGluZS9jb2x1bW4gb3RoZXJ3aXNlXG4gICAgLy8gKGlPUyBTYWZhcmkgMTAgZXZlbiB0aHJvd3MgYW4gZXhjZXB0aW9uKVxuICAgIHZhciBlcnJvciA9IE9iamVjdC5jcmVhdGUoU3ludGF4RXJyb3IucHJvdG90eXBlKTtcbiAgICB2YXIgZXJyb3JTdGFjayA9IG5ldyBFcnJvcigpO1xuXG4gICAgZXJyb3IubmFtZSA9IG5hbWU7XG4gICAgZXJyb3IubWVzc2FnZSA9IG1lc3NhZ2U7XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXJyb3IsICdzdGFjaycsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoZXJyb3JTdGFjay5zdGFjayB8fCAnJykucmVwbGFjZSgvXiguK1xcbil7MSwzfS8sIG5hbWUgKyAnOiAnICsgbWVzc2FnZSArICdcXG4nKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGVycm9yO1xufTtcblxudmFyIE1BWF9MSU5FX0xFTkdUSCA9IDEwMDtcbnZhciBPRkZTRVRfQ09SUkVDVElPTiA9IDYwO1xudmFyIFRBQl9SRVBMQUNFTUVOVCA9ICcgICAgJztcblxuZnVuY3Rpb24gc291cmNlRnJhZ21lbnQoZXJyb3IsIGV4dHJhTGluZXMpIHtcbiAgICBmdW5jdGlvbiBwcm9jZXNzTGluZXMoc3RhcnQsIGVuZCkge1xuICAgICAgICByZXR1cm4gbGluZXMuc2xpY2Uoc3RhcnQsIGVuZCkubWFwKGZ1bmN0aW9uKGxpbmUsIGlkeCkge1xuICAgICAgICAgICAgdmFyIG51bSA9IFN0cmluZyhzdGFydCArIGlkeCArIDEpO1xuXG4gICAgICAgICAgICB3aGlsZSAobnVtLmxlbmd0aCA8IG1heE51bUxlbmd0aCkge1xuICAgICAgICAgICAgICAgIG51bSA9ICcgJyArIG51bTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG51bSArICcgfCcgKyBsaW5lO1xuICAgICAgICB9KS5qb2luKCdcXG4nKTtcbiAgICB9XG5cbiAgICB2YXIgbGluZXMgPSBlcnJvci5zb3VyY2Uuc3BsaXQoL1xcclxcbj98XFxufFxcZi8pO1xuICAgIHZhciBsaW5lID0gZXJyb3IubGluZTtcbiAgICB2YXIgY29sdW1uID0gZXJyb3IuY29sdW1uO1xuICAgIHZhciBzdGFydExpbmUgPSBNYXRoLm1heCgxLCBsaW5lIC0gZXh0cmFMaW5lcykgLSAxO1xuICAgIHZhciBlbmRMaW5lID0gTWF0aC5taW4obGluZSArIGV4dHJhTGluZXMsIGxpbmVzLmxlbmd0aCArIDEpO1xuICAgIHZhciBtYXhOdW1MZW5ndGggPSBNYXRoLm1heCg0LCBTdHJpbmcoZW5kTGluZSkubGVuZ3RoKSArIDE7XG4gICAgdmFyIGN1dExlZnQgPSAwO1xuXG4gICAgLy8gY29sdW1uIGNvcnJlY3Rpb24gYWNjb3JkaW5nIHRvIHJlcGxhY2VkIHRhYiBiZWZvcmUgY29sdW1uXG4gICAgY29sdW1uICs9IChUQUJfUkVQTEFDRU1FTlQubGVuZ3RoIC0gMSkgKiAobGluZXNbbGluZSAtIDFdLnN1YnN0cigwLCBjb2x1bW4gLSAxKS5tYXRjaCgvXFx0L2cpIHx8IFtdKS5sZW5ndGg7XG5cbiAgICBpZiAoY29sdW1uID4gTUFYX0xJTkVfTEVOR1RIKSB7XG4gICAgICAgIGN1dExlZnQgPSBjb2x1bW4gLSBPRkZTRVRfQ09SUkVDVElPTiArIDM7XG4gICAgICAgIGNvbHVtbiA9IE9GRlNFVF9DT1JSRUNUSU9OIC0gMjtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBpID0gc3RhcnRMaW5lOyBpIDw9IGVuZExpbmU7IGkrKykge1xuICAgICAgICBpZiAoaSA+PSAwICYmIGkgPCBsaW5lcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxpbmVzW2ldID0gbGluZXNbaV0ucmVwbGFjZSgvXFx0L2csIFRBQl9SRVBMQUNFTUVOVCk7XG4gICAgICAgICAgICBsaW5lc1tpXSA9XG4gICAgICAgICAgICAgICAgKGN1dExlZnQgPiAwICYmIGxpbmVzW2ldLmxlbmd0aCA+IGN1dExlZnQgPyAnXFx1MjAyNicgOiAnJykgK1xuICAgICAgICAgICAgICAgIGxpbmVzW2ldLnN1YnN0cihjdXRMZWZ0LCBNQVhfTElORV9MRU5HVEggLSAyKSArXG4gICAgICAgICAgICAgICAgKGxpbmVzW2ldLmxlbmd0aCA+IGN1dExlZnQgKyBNQVhfTElORV9MRU5HVEggLSAxID8gJ1xcdTIwMjYnIDogJycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIFtcbiAgICAgICAgcHJvY2Vzc0xpbmVzKHN0YXJ0TGluZSwgbGluZSksXG4gICAgICAgIG5ldyBBcnJheShjb2x1bW4gKyBtYXhOdW1MZW5ndGggKyAyKS5qb2luKCctJykgKyAnXicsXG4gICAgICAgIHByb2Nlc3NMaW5lcyhsaW5lLCBlbmRMaW5lKVxuICAgIF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJ1xcbicpO1xufVxuXG52YXIgU3ludGF4RXJyb3IkMSA9IGZ1bmN0aW9uKG1lc3NhZ2UsIHNvdXJjZSwgb2Zmc2V0LCBsaW5lLCBjb2x1bW4pIHtcbiAgICB2YXIgZXJyb3IgPSBjcmVhdGVDdXN0b21FcnJvcignU3ludGF4RXJyb3InLCBtZXNzYWdlKTtcblxuICAgIGVycm9yLnNvdXJjZSA9IHNvdXJjZTtcbiAgICBlcnJvci5vZmZzZXQgPSBvZmZzZXQ7XG4gICAgZXJyb3IubGluZSA9IGxpbmU7XG4gICAgZXJyb3IuY29sdW1uID0gY29sdW1uO1xuXG4gICAgZXJyb3Iuc291cmNlRnJhZ21lbnQgPSBmdW5jdGlvbihleHRyYUxpbmVzKSB7XG4gICAgICAgIHJldHVybiBzb3VyY2VGcmFnbWVudChlcnJvciwgaXNOYU4oZXh0cmFMaW5lcykgPyAwIDogZXh0cmFMaW5lcyk7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXJyb3IsICdmb3JtYXR0ZWRNZXNzYWdlJywge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAnUGFyc2UgZXJyb3I6ICcgKyBlcnJvci5tZXNzYWdlICsgJ1xcbicgK1xuICAgICAgICAgICAgICAgIHNvdXJjZUZyYWdtZW50KGVycm9yLCAyKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gZm9yIGJhY2t3YXJkIGNhcGFiaWxpdHlcbiAgICBlcnJvci5wYXJzZUVycm9yID0ge1xuICAgICAgICBvZmZzZXQ6IG9mZnNldCxcbiAgICAgICAgbGluZTogbGluZSxcbiAgICAgICAgY29sdW1uOiBjb2x1bW5cbiAgICB9O1xuXG4gICAgcmV0dXJuIGVycm9yO1xufTtcblxudmFyIF9TeW50YXhFcnJvciA9IFN5bnRheEVycm9yJDE7XG5cbi8vXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Rcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxuLy8gICAgICAgICAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS84pSAaGVhZCDilIJcbi8vICAgICAgICAgICAgIOKUgiAgICAgICAgICAgICAg4pSCIHRhaWzilIDilLzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcbi8vICAgICAgICAgICAgIOKUgiAgICAgICAgICAgICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSYICAgICAgICAgICAgICDilIJcbi8vICAgICAgICAgICAgIOKWvCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKWvFxuLy8gICAgICAgICAgICBpdGVtICAgICAgICBpdGVtICAgICAgICBpdGVtICAgICAgICBpdGVtXG4vLyAgICAgICAgICDilIzilIDilIDilIDilIDilIDilIDilJAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSQICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUkCAgICDilIzilIDilIDilIDilIDilIDilIDilJBcbi8vICBudWxsIOKXgOKUgOKUgOKUvOKUgHByZXYg4pSC4peA4pSA4pSA4pSA4pS84pSAcHJldiDilILil4DilIDilIDilIDilLzilIBwcmV2IOKUguKXgOKUgOKUgOKUgOKUvOKUgHByZXYg4pSCXG4vLyAgICAgICAgICDilIIgbmV4dOKUgOKUvOKUgOKUgOKUgOKWtuKUgiBuZXh04pSA4pS84pSA4pSA4pSA4pa24pSCIG5leHTilIDilLzilIDilIDilIDilrbilIIgbmV4dOKUgOKUvOKUgOKUgOKWtiBudWxsXG4vLyAgICAgICAgICDilJzilIDilIDilIDilIDilIDilIDilKQgICAg4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSkICAgIOKUnOKUgOKUgOKUgOKUgOKUgOKUgOKUpCAgICDilJzilIDilIDilIDilIDilIDilIDilKRcbi8vICAgICAgICAgIOKUgiBkYXRhIOKUgiAgICDilIIgZGF0YSDilIIgICAg4pSCIGRhdGEg4pSCICAgIOKUgiBkYXRhIOKUglxuLy8gICAgICAgICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSYICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUmCAgICDilJTilIDilIDilIDilIDilIDilIDilJggICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSYXG4vL1xuXG5mdW5jdGlvbiBjcmVhdGVJdGVtKGRhdGEpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICBkYXRhOiBkYXRhXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gYWxsb2NhdGVDdXJzb3Iobm9kZSwgcHJldiwgbmV4dCkge1xuICAgIHZhciBjdXJzb3I7XG5cbiAgICBpZiAoY3Vyc29ycyAhPT0gbnVsbCkge1xuICAgICAgICBjdXJzb3IgPSBjdXJzb3JzO1xuICAgICAgICBjdXJzb3JzID0gY3Vyc29ycy5jdXJzb3I7XG4gICAgICAgIGN1cnNvci5wcmV2ID0gcHJldjtcbiAgICAgICAgY3Vyc29yLm5leHQgPSBuZXh0O1xuICAgICAgICBjdXJzb3IuY3Vyc29yID0gbm9kZS5jdXJzb3I7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY3Vyc29yID0ge1xuICAgICAgICAgICAgcHJldjogcHJldixcbiAgICAgICAgICAgIG5leHQ6IG5leHQsXG4gICAgICAgICAgICBjdXJzb3I6IG5vZGUuY3Vyc29yXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgbm9kZS5jdXJzb3IgPSBjdXJzb3I7XG5cbiAgICByZXR1cm4gY3Vyc29yO1xufVxuXG5mdW5jdGlvbiByZWxlYXNlQ3Vyc29yKG5vZGUpIHtcbiAgICB2YXIgY3Vyc29yID0gbm9kZS5jdXJzb3I7XG5cbiAgICBub2RlLmN1cnNvciA9IGN1cnNvci5jdXJzb3I7XG4gICAgY3Vyc29yLnByZXYgPSBudWxsO1xuICAgIGN1cnNvci5uZXh0ID0gbnVsbDtcbiAgICBjdXJzb3IuY3Vyc29yID0gY3Vyc29ycztcbiAgICBjdXJzb3JzID0gY3Vyc29yO1xufVxuXG52YXIgY3Vyc29ycyA9IG51bGw7XG52YXIgTGlzdCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY3Vyc29yID0gbnVsbDtcbiAgICB0aGlzLmhlYWQgPSBudWxsO1xuICAgIHRoaXMudGFpbCA9IG51bGw7XG59O1xuXG5MaXN0LmNyZWF0ZUl0ZW0gPSBjcmVhdGVJdGVtO1xuTGlzdC5wcm90b3R5cGUuY3JlYXRlSXRlbSA9IGNyZWF0ZUl0ZW07XG5cbkxpc3QucHJvdG90eXBlLnVwZGF0ZUN1cnNvcnMgPSBmdW5jdGlvbihwcmV2T2xkLCBwcmV2TmV3LCBuZXh0T2xkLCBuZXh0TmV3KSB7XG4gICAgdmFyIGN1cnNvciA9IHRoaXMuY3Vyc29yO1xuXG4gICAgd2hpbGUgKGN1cnNvciAhPT0gbnVsbCkge1xuICAgICAgICBpZiAoY3Vyc29yLnByZXYgPT09IHByZXZPbGQpIHtcbiAgICAgICAgICAgIGN1cnNvci5wcmV2ID0gcHJldk5ldztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjdXJzb3IubmV4dCA9PT0gbmV4dE9sZCkge1xuICAgICAgICAgICAgY3Vyc29yLm5leHQgPSBuZXh0TmV3O1xuICAgICAgICB9XG5cbiAgICAgICAgY3Vyc29yID0gY3Vyc29yLmN1cnNvcjtcbiAgICB9XG59O1xuXG5MaXN0LnByb3RvdHlwZS5nZXRTaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNpemUgPSAwO1xuICAgIHZhciBjdXJzb3IgPSB0aGlzLmhlYWQ7XG5cbiAgICB3aGlsZSAoY3Vyc29yKSB7XG4gICAgICAgIHNpemUrKztcbiAgICAgICAgY3Vyc29yID0gY3Vyc29yLm5leHQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNpemU7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5mcm9tQXJyYXkgPSBmdW5jdGlvbihhcnJheSkge1xuICAgIHZhciBjdXJzb3IgPSBudWxsO1xuXG4gICAgdGhpcy5oZWFkID0gbnVsbDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBjcmVhdGVJdGVtKGFycmF5W2ldKTtcblxuICAgICAgICBpZiAoY3Vyc29yICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjdXJzb3IubmV4dCA9IGl0ZW07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmhlYWQgPSBpdGVtO1xuICAgICAgICB9XG5cbiAgICAgICAgaXRlbS5wcmV2ID0gY3Vyc29yO1xuICAgICAgICBjdXJzb3IgPSBpdGVtO1xuICAgIH1cblxuICAgIHRoaXMudGFpbCA9IGN1cnNvcjtcblxuICAgIHJldHVybiB0aGlzO1xufTtcblxuTGlzdC5wcm90b3R5cGUudG9BcnJheSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjdXJzb3IgPSB0aGlzLmhlYWQ7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuXG4gICAgd2hpbGUgKGN1cnNvcikge1xuICAgICAgICByZXN1bHQucHVzaChjdXJzb3IuZGF0YSk7XG4gICAgICAgIGN1cnNvciA9IGN1cnNvci5uZXh0O1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG5MaXN0LnByb3RvdHlwZS50b0pTT04gPSBMaXN0LnByb3RvdHlwZS50b0FycmF5O1xuXG5MaXN0LnByb3RvdHlwZS5pc0VtcHR5ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuaGVhZCA9PT0gbnVsbDtcbn07XG5cbkxpc3QucHJvdG90eXBlLmZpcnN0ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuaGVhZCAmJiB0aGlzLmhlYWQuZGF0YTtcbn07XG5cbkxpc3QucHJvdG90eXBlLmxhc3QgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy50YWlsICYmIHRoaXMudGFpbC5kYXRhO1xufTtcblxuTGlzdC5wcm90b3R5cGUuZWFjaCA9IGZ1bmN0aW9uKGZuLCBjb250ZXh0KSB7XG4gICAgdmFyIGl0ZW07XG5cbiAgICBpZiAoY29udGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnRleHQgPSB0aGlzO1xuICAgIH1cblxuICAgIC8vIHB1c2ggY3Vyc29yXG4gICAgdmFyIGN1cnNvciA9IGFsbG9jYXRlQ3Vyc29yKHRoaXMsIG51bGwsIHRoaXMuaGVhZCk7XG5cbiAgICB3aGlsZSAoY3Vyc29yLm5leHQgIT09IG51bGwpIHtcbiAgICAgICAgaXRlbSA9IGN1cnNvci5uZXh0O1xuICAgICAgICBjdXJzb3IubmV4dCA9IGl0ZW0ubmV4dDtcblxuICAgICAgICBmbi5jYWxsKGNvbnRleHQsIGl0ZW0uZGF0YSwgaXRlbSwgdGhpcyk7XG4gICAgfVxuXG4gICAgLy8gcG9wIGN1cnNvclxuICAgIHJlbGVhc2VDdXJzb3IodGhpcyk7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5mb3JFYWNoID0gTGlzdC5wcm90b3R5cGUuZWFjaDtcblxuTGlzdC5wcm90b3R5cGUuZWFjaFJpZ2h0ID0gZnVuY3Rpb24oZm4sIGNvbnRleHQpIHtcbiAgICB2YXIgaXRlbTtcblxuICAgIGlmIChjb250ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGV4dCA9IHRoaXM7XG4gICAgfVxuXG4gICAgLy8gcHVzaCBjdXJzb3JcbiAgICB2YXIgY3Vyc29yID0gYWxsb2NhdGVDdXJzb3IodGhpcywgdGhpcy50YWlsLCBudWxsKTtcblxuICAgIHdoaWxlIChjdXJzb3IucHJldiAhPT0gbnVsbCkge1xuICAgICAgICBpdGVtID0gY3Vyc29yLnByZXY7XG4gICAgICAgIGN1cnNvci5wcmV2ID0gaXRlbS5wcmV2O1xuXG4gICAgICAgIGZuLmNhbGwoY29udGV4dCwgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKTtcbiAgICB9XG5cbiAgICAvLyBwb3AgY3Vyc29yXG4gICAgcmVsZWFzZUN1cnNvcih0aGlzKTtcbn07XG5cbkxpc3QucHJvdG90eXBlLmZvckVhY2hSaWdodCA9IExpc3QucHJvdG90eXBlLmVhY2hSaWdodDtcblxuTGlzdC5wcm90b3R5cGUucmVkdWNlID0gZnVuY3Rpb24oZm4sIGluaXRpYWxWYWx1ZSwgY29udGV4dCkge1xuICAgIHZhciBpdGVtO1xuXG4gICAgaWYgKGNvbnRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb250ZXh0ID0gdGhpcztcbiAgICB9XG5cbiAgICAvLyBwdXNoIGN1cnNvclxuICAgIHZhciBjdXJzb3IgPSBhbGxvY2F0ZUN1cnNvcih0aGlzLCBudWxsLCB0aGlzLmhlYWQpO1xuICAgIHZhciBhY2MgPSBpbml0aWFsVmFsdWU7XG5cbiAgICB3aGlsZSAoY3Vyc29yLm5leHQgIT09IG51bGwpIHtcbiAgICAgICAgaXRlbSA9IGN1cnNvci5uZXh0O1xuICAgICAgICBjdXJzb3IubmV4dCA9IGl0ZW0ubmV4dDtcblxuICAgICAgICBhY2MgPSBmbi5jYWxsKGNvbnRleHQsIGFjYywgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKTtcbiAgICB9XG5cbiAgICAvLyBwb3AgY3Vyc29yXG4gICAgcmVsZWFzZUN1cnNvcih0aGlzKTtcblxuICAgIHJldHVybiBhY2M7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5yZWR1Y2VSaWdodCA9IGZ1bmN0aW9uKGZuLCBpbml0aWFsVmFsdWUsIGNvbnRleHQpIHtcbiAgICB2YXIgaXRlbTtcblxuICAgIGlmIChjb250ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGV4dCA9IHRoaXM7XG4gICAgfVxuXG4gICAgLy8gcHVzaCBjdXJzb3JcbiAgICB2YXIgY3Vyc29yID0gYWxsb2NhdGVDdXJzb3IodGhpcywgdGhpcy50YWlsLCBudWxsKTtcbiAgICB2YXIgYWNjID0gaW5pdGlhbFZhbHVlO1xuXG4gICAgd2hpbGUgKGN1cnNvci5wcmV2ICE9PSBudWxsKSB7XG4gICAgICAgIGl0ZW0gPSBjdXJzb3IucHJldjtcbiAgICAgICAgY3Vyc29yLnByZXYgPSBpdGVtLnByZXY7XG5cbiAgICAgICAgYWNjID0gZm4uY2FsbChjb250ZXh0LCBhY2MsIGl0ZW0uZGF0YSwgaXRlbSwgdGhpcyk7XG4gICAgfVxuXG4gICAgLy8gcG9wIGN1cnNvclxuICAgIHJlbGVhc2VDdXJzb3IodGhpcyk7XG5cbiAgICByZXR1cm4gYWNjO1xufTtcblxuTGlzdC5wcm90b3R5cGUubmV4dFVudGlsID0gZnVuY3Rpb24oc3RhcnQsIGZuLCBjb250ZXh0KSB7XG4gICAgaWYgKHN0YXJ0ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgaXRlbTtcblxuICAgIGlmIChjb250ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGV4dCA9IHRoaXM7XG4gICAgfVxuXG4gICAgLy8gcHVzaCBjdXJzb3JcbiAgICB2YXIgY3Vyc29yID0gYWxsb2NhdGVDdXJzb3IodGhpcywgbnVsbCwgc3RhcnQpO1xuXG4gICAgd2hpbGUgKGN1cnNvci5uZXh0ICE9PSBudWxsKSB7XG4gICAgICAgIGl0ZW0gPSBjdXJzb3IubmV4dDtcbiAgICAgICAgY3Vyc29yLm5leHQgPSBpdGVtLm5leHQ7XG5cbiAgICAgICAgaWYgKGZuLmNhbGwoY29udGV4dCwgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBwb3AgY3Vyc29yXG4gICAgcmVsZWFzZUN1cnNvcih0aGlzKTtcbn07XG5cbkxpc3QucHJvdG90eXBlLnByZXZVbnRpbCA9IGZ1bmN0aW9uKHN0YXJ0LCBmbiwgY29udGV4dCkge1xuICAgIGlmIChzdGFydCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGl0ZW07XG5cbiAgICBpZiAoY29udGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnRleHQgPSB0aGlzO1xuICAgIH1cblxuICAgIC8vIHB1c2ggY3Vyc29yXG4gICAgdmFyIGN1cnNvciA9IGFsbG9jYXRlQ3Vyc29yKHRoaXMsIHN0YXJ0LCBudWxsKTtcblxuICAgIHdoaWxlIChjdXJzb3IucHJldiAhPT0gbnVsbCkge1xuICAgICAgICBpdGVtID0gY3Vyc29yLnByZXY7XG4gICAgICAgIGN1cnNvci5wcmV2ID0gaXRlbS5wcmV2O1xuXG4gICAgICAgIGlmIChmbi5jYWxsKGNvbnRleHQsIGl0ZW0uZGF0YSwgaXRlbSwgdGhpcykpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gcG9wIGN1cnNvclxuICAgIHJlbGVhc2VDdXJzb3IodGhpcyk7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5zb21lID0gZnVuY3Rpb24oZm4sIGNvbnRleHQpIHtcbiAgICB2YXIgY3Vyc29yID0gdGhpcy5oZWFkO1xuXG4gICAgaWYgKGNvbnRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb250ZXh0ID0gdGhpcztcbiAgICB9XG5cbiAgICB3aGlsZSAoY3Vyc29yICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChmbi5jYWxsKGNvbnRleHQsIGN1cnNvci5kYXRhLCBjdXJzb3IsIHRoaXMpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGN1cnNvciA9IGN1cnNvci5uZXh0O1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbn07XG5cbkxpc3QucHJvdG90eXBlLm1hcCA9IGZ1bmN0aW9uKGZuLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdCA9IG5ldyBMaXN0KCk7XG4gICAgdmFyIGN1cnNvciA9IHRoaXMuaGVhZDtcblxuICAgIGlmIChjb250ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGV4dCA9IHRoaXM7XG4gICAgfVxuXG4gICAgd2hpbGUgKGN1cnNvciAhPT0gbnVsbCkge1xuICAgICAgICByZXN1bHQuYXBwZW5kRGF0YShmbi5jYWxsKGNvbnRleHQsIGN1cnNvci5kYXRhLCBjdXJzb3IsIHRoaXMpKTtcbiAgICAgICAgY3Vyc29yID0gY3Vyc29yLm5leHQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbkxpc3QucHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uKGZuLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdCA9IG5ldyBMaXN0KCk7XG4gICAgdmFyIGN1cnNvciA9IHRoaXMuaGVhZDtcblxuICAgIGlmIChjb250ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGV4dCA9IHRoaXM7XG4gICAgfVxuXG4gICAgd2hpbGUgKGN1cnNvciAhPT0gbnVsbCkge1xuICAgICAgICBpZiAoZm4uY2FsbChjb250ZXh0LCBjdXJzb3IuZGF0YSwgY3Vyc29yLCB0aGlzKSkge1xuICAgICAgICAgICAgcmVzdWx0LmFwcGVuZERhdGEoY3Vyc29yLmRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGN1cnNvciA9IGN1cnNvci5uZXh0O1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuaGVhZCA9IG51bGw7XG4gICAgdGhpcy50YWlsID0gbnVsbDtcbn07XG5cbkxpc3QucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IExpc3QoKTtcbiAgICB2YXIgY3Vyc29yID0gdGhpcy5oZWFkO1xuXG4gICAgd2hpbGUgKGN1cnNvciAhPT0gbnVsbCkge1xuICAgICAgICByZXN1bHQuaW5zZXJ0KGNyZWF0ZUl0ZW0oY3Vyc29yLmRhdGEpKTtcbiAgICAgICAgY3Vyc29yID0gY3Vyc29yLm5leHQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbkxpc3QucHJvdG90eXBlLnByZXBlbmQgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgLy8gICAgICBoZWFkXG4gICAgLy8gICAgXlxuICAgIC8vIGl0ZW1cbiAgICB0aGlzLnVwZGF0ZUN1cnNvcnMobnVsbCwgaXRlbSwgdGhpcy5oZWFkLCBpdGVtKTtcblxuICAgIC8vIGluc2VydCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBsaXN0XG4gICAgaWYgKHRoaXMuaGVhZCAhPT0gbnVsbCkge1xuICAgICAgICAvLyBuZXcgaXRlbSA8LSBmaXJzdCBpdGVtXG4gICAgICAgIHRoaXMuaGVhZC5wcmV2ID0gaXRlbTtcblxuICAgICAgICAvLyBuZXcgaXRlbSAtPiBmaXJzdCBpdGVtXG4gICAgICAgIGl0ZW0ubmV4dCA9IHRoaXMuaGVhZDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBpZiBsaXN0IGhhcyBubyBoZWFkLCB0aGVuIGl0IGFsc28gaGFzIG5vIHRhaWxcbiAgICAgICAgLy8gaW4gdGhpcyBjYXNlIHRhaWwgcG9pbnRzIHRvIHRoZSBuZXcgaXRlbVxuICAgICAgICB0aGlzLnRhaWwgPSBpdGVtO1xuICAgIH1cblxuICAgIC8vIGhlYWQgYWx3YXlzIHBvaW50cyB0byBuZXcgaXRlbVxuICAgIHRoaXMuaGVhZCA9IGl0ZW07XG5cbiAgICByZXR1cm4gdGhpcztcbn07XG5cbkxpc3QucHJvdG90eXBlLnByZXBlbmREYXRhID0gZnVuY3Rpb24oZGF0YSkge1xuICAgIHJldHVybiB0aGlzLnByZXBlbmQoY3JlYXRlSXRlbShkYXRhKSk7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5hcHBlbmQgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgcmV0dXJuIHRoaXMuaW5zZXJ0KGl0ZW0pO1xufTtcblxuTGlzdC5wcm90b3R5cGUuYXBwZW5kRGF0YSA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICByZXR1cm4gdGhpcy5pbnNlcnQoY3JlYXRlSXRlbShkYXRhKSk7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbihpdGVtLCBiZWZvcmUpIHtcbiAgICBpZiAoYmVmb3JlICE9PSB1bmRlZmluZWQgJiYgYmVmb3JlICE9PSBudWxsKSB7XG4gICAgICAgIC8vIHByZXYgICBiZWZvcmVcbiAgICAgICAgLy8gICAgICBeXG4gICAgICAgIC8vICAgICBpdGVtXG4gICAgICAgIHRoaXMudXBkYXRlQ3Vyc29ycyhiZWZvcmUucHJldiwgaXRlbSwgYmVmb3JlLCBpdGVtKTtcblxuICAgICAgICBpZiAoYmVmb3JlLnByZXYgPT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIGluc2VydCB0byB0aGUgYmVnaW5uaW5nIG9mIGxpc3RcbiAgICAgICAgICAgIGlmICh0aGlzLmhlYWQgIT09IGJlZm9yZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYmVmb3JlIGRvZXNuXFwndCBiZWxvbmcgdG8gbGlzdCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzaW5jZSBoZWFkIHBvaW50cyB0byBiZWZvcmUgdGhlcmVmb3JlIGxpc3QgZG9lc24ndCBlbXB0eVxuICAgICAgICAgICAgLy8gbm8gbmVlZCB0byBjaGVjayB0YWlsXG4gICAgICAgICAgICB0aGlzLmhlYWQgPSBpdGVtO1xuICAgICAgICAgICAgYmVmb3JlLnByZXYgPSBpdGVtO1xuICAgICAgICAgICAgaXRlbS5uZXh0ID0gYmVmb3JlO1xuXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUN1cnNvcnMobnVsbCwgaXRlbSk7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIC8vIGluc2VydCBiZXR3ZWVuIHR3byBpdGVtc1xuICAgICAgICAgICAgYmVmb3JlLnByZXYubmV4dCA9IGl0ZW07XG4gICAgICAgICAgICBpdGVtLnByZXYgPSBiZWZvcmUucHJldjtcblxuICAgICAgICAgICAgYmVmb3JlLnByZXYgPSBpdGVtO1xuICAgICAgICAgICAgaXRlbS5uZXh0ID0gYmVmb3JlO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gdGFpbFxuICAgICAgICAvLyAgICAgIF5cbiAgICAgICAgLy8gICAgICBpdGVtXG4gICAgICAgIHRoaXMudXBkYXRlQ3Vyc29ycyh0aGlzLnRhaWwsIGl0ZW0sIG51bGwsIGl0ZW0pO1xuXG4gICAgICAgIC8vIGluc2VydCB0byB0aGUgZW5kaW5nIG9mIHRoZSBsaXN0XG4gICAgICAgIGlmICh0aGlzLnRhaWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIGxhc3QgaXRlbSAtPiBuZXcgaXRlbVxuICAgICAgICAgICAgdGhpcy50YWlsLm5leHQgPSBpdGVtO1xuXG4gICAgICAgICAgICAvLyBsYXN0IGl0ZW0gPC0gbmV3IGl0ZW1cbiAgICAgICAgICAgIGl0ZW0ucHJldiA9IHRoaXMudGFpbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGlmIGxpc3QgaGFzIG5vIHRhaWwsIHRoZW4gaXQgYWxzbyBoYXMgbm8gaGVhZFxuICAgICAgICAgICAgLy8gaW4gdGhpcyBjYXNlIGhlYWQgcG9pbnRzIHRvIG5ldyBpdGVtXG4gICAgICAgICAgICB0aGlzLmhlYWQgPSBpdGVtO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGFpbCBhbHdheXMgcG9pbnRzIHRvIG5ldyBpdGVtXG4gICAgICAgIHRoaXMudGFpbCA9IGl0ZW07XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5pbnNlcnREYXRhID0gZnVuY3Rpb24oZGF0YSwgYmVmb3JlKSB7XG4gICAgcmV0dXJuIHRoaXMuaW5zZXJ0KGNyZWF0ZUl0ZW0oZGF0YSksIGJlZm9yZSk7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgLy8gICAgICBpdGVtXG4gICAgLy8gICAgICAgXlxuICAgIC8vIHByZXYgICAgIG5leHRcbiAgICB0aGlzLnVwZGF0ZUN1cnNvcnMoaXRlbSwgaXRlbS5wcmV2LCBpdGVtLCBpdGVtLm5leHQpO1xuXG4gICAgaWYgKGl0ZW0ucHJldiAhPT0gbnVsbCkge1xuICAgICAgICBpdGVtLnByZXYubmV4dCA9IGl0ZW0ubmV4dDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5oZWFkICE9PSBpdGVtKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2l0ZW0gZG9lc25cXCd0IGJlbG9uZyB0byBsaXN0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmhlYWQgPSBpdGVtLm5leHQ7XG4gICAgfVxuXG4gICAgaWYgKGl0ZW0ubmV4dCAhPT0gbnVsbCkge1xuICAgICAgICBpdGVtLm5leHQucHJldiA9IGl0ZW0ucHJldjtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy50YWlsICE9PSBpdGVtKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2l0ZW0gZG9lc25cXCd0IGJlbG9uZyB0byBsaXN0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRhaWwgPSBpdGVtLnByZXY7XG4gICAgfVxuXG4gICAgaXRlbS5wcmV2ID0gbnVsbDtcbiAgICBpdGVtLm5leHQgPSBudWxsO1xuXG4gICAgcmV0dXJuIGl0ZW07XG59O1xuXG5MaXN0LnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oZGF0YSkge1xuICAgIHRoaXMuaW5zZXJ0KGNyZWF0ZUl0ZW0oZGF0YSkpO1xufTtcblxuTGlzdC5wcm90b3R5cGUucG9wID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMudGFpbCAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmUodGhpcy50YWlsKTtcbiAgICB9XG59O1xuXG5MaXN0LnByb3RvdHlwZS51bnNoaWZ0ID0gZnVuY3Rpb24oZGF0YSkge1xuICAgIHRoaXMucHJlcGVuZChjcmVhdGVJdGVtKGRhdGEpKTtcbn07XG5cbkxpc3QucHJvdG90eXBlLnNoaWZ0ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuaGVhZCAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmUodGhpcy5oZWFkKTtcbiAgICB9XG59O1xuXG5MaXN0LnByb3RvdHlwZS5wcmVwZW5kTGlzdCA9IGZ1bmN0aW9uKGxpc3QpIHtcbiAgICByZXR1cm4gdGhpcy5pbnNlcnRMaXN0KGxpc3QsIHRoaXMuaGVhZCk7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5hcHBlbmRMaXN0ID0gZnVuY3Rpb24obGlzdCkge1xuICAgIHJldHVybiB0aGlzLmluc2VydExpc3QobGlzdCk7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5pbnNlcnRMaXN0ID0gZnVuY3Rpb24obGlzdCwgYmVmb3JlKSB7XG4gICAgLy8gaWdub3JlIGVtcHR5IGxpc3RzXG4gICAgaWYgKGxpc3QuaGVhZCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBpZiAoYmVmb3JlICE9PSB1bmRlZmluZWQgJiYgYmVmb3JlICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMudXBkYXRlQ3Vyc29ycyhiZWZvcmUucHJldiwgbGlzdC50YWlsLCBiZWZvcmUsIGxpc3QuaGVhZCk7XG5cbiAgICAgICAgLy8gaW5zZXJ0IGluIHRoZSBtaWRkbGUgb2YgZGlzdCBsaXN0XG4gICAgICAgIGlmIChiZWZvcmUucHJldiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gYmVmb3JlLnByZXYgPC0+IGxpc3QuaGVhZFxuICAgICAgICAgICAgYmVmb3JlLnByZXYubmV4dCA9IGxpc3QuaGVhZDtcbiAgICAgICAgICAgIGxpc3QuaGVhZC5wcmV2ID0gYmVmb3JlLnByZXY7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmhlYWQgPSBsaXN0LmhlYWQ7XG4gICAgICAgIH1cblxuICAgICAgICBiZWZvcmUucHJldiA9IGxpc3QudGFpbDtcbiAgICAgICAgbGlzdC50YWlsLm5leHQgPSBiZWZvcmU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JzKHRoaXMudGFpbCwgbGlzdC50YWlsLCBudWxsLCBsaXN0LmhlYWQpO1xuXG4gICAgICAgIC8vIGluc2VydCB0byBlbmQgb2YgdGhlIGxpc3RcbiAgICAgICAgaWYgKHRoaXMudGFpbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gaWYgZGVzdGluYXRpb24gbGlzdCBoYXMgYSB0YWlsLCB0aGVuIGl0IGFsc28gaGFzIGEgaGVhZCxcbiAgICAgICAgICAgIC8vIGJ1dCBoZWFkIGRvZXNuJ3QgY2hhbmdlXG5cbiAgICAgICAgICAgIC8vIGRlc3QgdGFpbCAtPiBzb3VyY2UgaGVhZFxuICAgICAgICAgICAgdGhpcy50YWlsLm5leHQgPSBsaXN0LmhlYWQ7XG5cbiAgICAgICAgICAgIC8vIGRlc3QgdGFpbCA8LSBzb3VyY2UgaGVhZFxuICAgICAgICAgICAgbGlzdC5oZWFkLnByZXYgPSB0aGlzLnRhaWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBpZiBsaXN0IGhhcyBubyBhIHRhaWwsIHRoZW4gaXQgYWxzbyBoYXMgbm8gYSBoZWFkXG4gICAgICAgICAgICAvLyBpbiB0aGlzIGNhc2UgcG9pbnRzIGhlYWQgdG8gbmV3IGl0ZW1cbiAgICAgICAgICAgIHRoaXMuaGVhZCA9IGxpc3QuaGVhZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRhaWwgYWx3YXlzIHN0YXJ0IHBvaW50IHRvIG5ldyBpdGVtXG4gICAgICAgIHRoaXMudGFpbCA9IGxpc3QudGFpbDtcbiAgICB9XG5cbiAgICBsaXN0LmhlYWQgPSBudWxsO1xuICAgIGxpc3QudGFpbCA9IG51bGw7XG5cbiAgICByZXR1cm4gdGhpcztcbn07XG5cbkxpc3QucHJvdG90eXBlLnJlcGxhY2UgPSBmdW5jdGlvbihvbGRJdGVtLCBuZXdJdGVtT3JMaXN0KSB7XG4gICAgaWYgKCdoZWFkJyBpbiBuZXdJdGVtT3JMaXN0KSB7XG4gICAgICAgIHRoaXMuaW5zZXJ0TGlzdChuZXdJdGVtT3JMaXN0LCBvbGRJdGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmluc2VydChuZXdJdGVtT3JMaXN0LCBvbGRJdGVtKTtcbiAgICB9XG5cbiAgICB0aGlzLnJlbW92ZShvbGRJdGVtKTtcbn07XG5cbnZhciBMaXN0XzEgPSBMaXN0O1xuXG52YXIgVFlQRSQzID0gdG9rZW5pemVyLlRZUEU7XG52YXIgV0hJVEVTUEFDRSQxID0gVFlQRSQzLldoaXRlU3BhY2U7XG52YXIgQ09NTUVOVCQxID0gVFlQRSQzLkNvbW1lbnQ7XG5cbnZhciBzZXF1ZW5jZSA9IGZ1bmN0aW9uIHJlYWRTZXF1ZW5jZShyZWNvZ25pemVyKSB7XG4gICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7XG4gICAgdmFyIGNoaWxkID0gbnVsbDtcbiAgICB2YXIgY29udGV4dCA9IHtcbiAgICAgICAgcmVjb2duaXplcjogcmVjb2duaXplcixcbiAgICAgICAgc3BhY2U6IG51bGwsXG4gICAgICAgIGlnbm9yZVdTOiBmYWxzZSxcbiAgICAgICAgaWdub3JlV1NBZnRlcjogZmFsc2VcbiAgICB9O1xuXG4gICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuXG4gICAgd2hpbGUgKCF0aGlzLnNjYW5uZXIuZW9mKSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5zY2FubmVyLnRva2VuVHlwZSkge1xuICAgICAgICAgICAgY2FzZSBDT01NRU5UJDE6XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcblxuICAgICAgICAgICAgY2FzZSBXSElURVNQQUNFJDE6XG4gICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuaWdub3JlV1MpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNwYWNlID0gdGhpcy5XaGl0ZVNwYWNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY2hpbGQgPSByZWNvZ25pemVyLmdldE5vZGUuY2FsbCh0aGlzLCBjb250ZXh0KTtcblxuICAgICAgICBpZiAoY2hpbGQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29udGV4dC5zcGFjZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChjb250ZXh0LnNwYWNlKTtcbiAgICAgICAgICAgIGNvbnRleHQuc3BhY2UgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7XG5cbiAgICAgICAgaWYgKGNvbnRleHQuaWdub3JlV1NBZnRlcikge1xuICAgICAgICAgICAgY29udGV4dC5pZ25vcmVXU0FmdGVyID0gZmFsc2U7XG4gICAgICAgICAgICBjb250ZXh0Lmlnbm9yZVdTID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRleHQuaWdub3JlV1MgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjaGlsZHJlbjtcbn07XG5cbnZhciB7IGZpbmRXaGl0ZVNwYWNlU3RhcnQ6IGZpbmRXaGl0ZVNwYWNlU3RhcnQkMSwgY21wU3RyOiBjbXBTdHIkMyB9ID0gdXRpbHM7XG5cbnZhciBub29wID0gZnVuY3Rpb24oKSB7fTtcblxudmFyIFRZUEUkNCA9IF9jb25zdC5UWVBFO1xudmFyIE5BTUUkMiA9IF9jb25zdC5OQU1FO1xudmFyIFdISVRFU1BBQ0UkMiA9IFRZUEUkNC5XaGl0ZVNwYWNlO1xudmFyIENPTU1FTlQkMiA9IFRZUEUkNC5Db21tZW50O1xudmFyIElERU5UID0gVFlQRSQ0LklkZW50O1xudmFyIEZVTkNUSU9OID0gVFlQRSQ0LkZ1bmN0aW9uO1xudmFyIFVSTCQxID0gVFlQRSQ0LlVybDtcbnZhciBIQVNIID0gVFlQRSQ0Lkhhc2g7XG52YXIgUEVSQ0VOVEFHRSA9IFRZUEUkNC5QZXJjZW50YWdlO1xudmFyIE5VTUJFUiA9IFRZUEUkNC5OdW1iZXI7XG52YXIgTlVNQkVSU0lHTiA9IDB4MDAyMzsgLy8gVSswMDIzIE5VTUJFUiBTSUdOICgjKVxudmFyIE5VTEwgPSAwO1xuXG5mdW5jdGlvbiBjcmVhdGVQYXJzZUNvbnRleHQobmFtZSkge1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbbmFtZV0oKTtcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBwcm9jZXNzQ29uZmlnKGNvbmZpZykge1xuICAgIHZhciBwYXJzZXJDb25maWcgPSB7XG4gICAgICAgIGNvbnRleHQ6IHt9LFxuICAgICAgICBzY29wZToge30sXG4gICAgICAgIGF0cnVsZToge30sXG4gICAgICAgIHBzZXVkbzoge31cbiAgICB9O1xuXG4gICAgaWYgKGNvbmZpZy5wYXJzZUNvbnRleHQpIHtcbiAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBjb25maWcucGFyc2VDb250ZXh0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjb25maWcucGFyc2VDb250ZXh0W25hbWVdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnZnVuY3Rpb24nOlxuICAgICAgICAgICAgICAgICAgICBwYXJzZXJDb25maWcuY29udGV4dFtuYW1lXSA9IGNvbmZpZy5wYXJzZUNvbnRleHRbbmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VyQ29uZmlnLmNvbnRleHRbbmFtZV0gPSBjcmVhdGVQYXJzZUNvbnRleHQoY29uZmlnLnBhcnNlQ29udGV4dFtuYW1lXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5zY29wZSkge1xuICAgICAgICBmb3IgKHZhciBuYW1lIGluIGNvbmZpZy5zY29wZSkge1xuICAgICAgICAgICAgcGFyc2VyQ29uZmlnLnNjb3BlW25hbWVdID0gY29uZmlnLnNjb3BlW25hbWVdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5hdHJ1bGUpIHtcbiAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBjb25maWcuYXRydWxlKSB7XG4gICAgICAgICAgICB2YXIgYXRydWxlID0gY29uZmlnLmF0cnVsZVtuYW1lXTtcblxuICAgICAgICAgICAgaWYgKGF0cnVsZS5wYXJzZSkge1xuICAgICAgICAgICAgICAgIHBhcnNlckNvbmZpZy5hdHJ1bGVbbmFtZV0gPSBhdHJ1bGUucGFyc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY29uZmlnLnBzZXVkbykge1xuICAgICAgICBmb3IgKHZhciBuYW1lIGluIGNvbmZpZy5wc2V1ZG8pIHtcbiAgICAgICAgICAgIHZhciBwc2V1ZG8gPSBjb25maWcucHNldWRvW25hbWVdO1xuXG4gICAgICAgICAgICBpZiAocHNldWRvLnBhcnNlKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VyQ29uZmlnLnBzZXVkb1tuYW1lXSA9IHBzZXVkby5wYXJzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjb25maWcubm9kZSkge1xuICAgICAgICBmb3IgKHZhciBuYW1lIGluIGNvbmZpZy5ub2RlKSB7XG4gICAgICAgICAgICBwYXJzZXJDb25maWdbbmFtZV0gPSBjb25maWcubm9kZVtuYW1lXS5wYXJzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwYXJzZXJDb25maWc7XG59XG5cbnZhciBjcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGVQYXJzZXIoY29uZmlnKSB7XG4gICAgdmFyIHBhcnNlciA9IHtcbiAgICAgICAgc2Nhbm5lcjogbmV3IFRva2VuU3RyZWFtXzEoKSxcbiAgICAgICAgbG9jYXRpb25NYXA6IG5ldyBPZmZzZXRUb0xvY2F0aW9uXzEoKSxcblxuICAgICAgICBmaWxlbmFtZTogJzx1bmtub3duPicsXG4gICAgICAgIG5lZWRQb3NpdGlvbnM6IGZhbHNlLFxuICAgICAgICBvblBhcnNlRXJyb3I6IG5vb3AsXG4gICAgICAgIG9uUGFyc2VFcnJvclRocm93OiBmYWxzZSxcbiAgICAgICAgcGFyc2VBdHJ1bGVQcmVsdWRlOiB0cnVlLFxuICAgICAgICBwYXJzZVJ1bGVQcmVsdWRlOiB0cnVlLFxuICAgICAgICBwYXJzZVZhbHVlOiB0cnVlLFxuICAgICAgICBwYXJzZUN1c3RvbVByb3BlcnR5OiBmYWxzZSxcblxuICAgICAgICByZWFkU2VxdWVuY2U6IHNlcXVlbmNlLFxuXG4gICAgICAgIGNyZWF0ZUxpc3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0XzEoKTtcbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlU2luZ2xlTm9kZUxpc3Q6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdF8xKCkuYXBwZW5kRGF0YShub2RlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0Rmlyc3RMaXN0Tm9kZTogZnVuY3Rpb24obGlzdCkge1xuICAgICAgICAgICAgcmV0dXJuIGxpc3QgJiYgbGlzdC5maXJzdCgpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRMYXN0TGlzdE5vZGU6IGZ1bmN0aW9uKGxpc3QpIHtcbiAgICAgICAgICAgIHJldHVybiBsaXN0Lmxhc3QoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwYXJzZVdpdGhGYWxsYmFjazogZnVuY3Rpb24oY29uc3VtZXIsIGZhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgc3RhcnRUb2tlbiA9IHRoaXMuc2Nhbm5lci50b2tlbkluZGV4O1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdW1lci5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uUGFyc2VFcnJvclRocm93KSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGZhbGxiYWNrTm9kZSA9IGZhbGxiYWNrLmNhbGwodGhpcywgc3RhcnRUb2tlbik7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm9uUGFyc2VFcnJvclRocm93ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uUGFyc2VFcnJvcihlLCBmYWxsYmFja05vZGUpO1xuICAgICAgICAgICAgICAgIHRoaXMub25QYXJzZUVycm9yVGhyb3cgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxsYmFja05vZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgbG9va3VwTm9uV1NUeXBlOiBmdW5jdGlvbihvZmZzZXQpIHtcbiAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IHRoaXMuc2Nhbm5lci5sb29rdXBUeXBlKG9mZnNldCsrKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSAhPT0gV0hJVEVTUEFDRSQyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gd2hpbGUgKHR5cGUgIT09IE5VTEwpO1xuXG4gICAgICAgICAgICByZXR1cm4gTlVMTDtcbiAgICAgICAgfSxcblxuICAgICAgICBlYXQ6IGZ1bmN0aW9uKHRva2VuVHlwZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci50b2tlblR5cGUgIT09IHRva2VuVHlwZSkge1xuICAgICAgICAgICAgICAgIHZhciBvZmZzZXQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IE5BTUUkMlt0b2tlblR5cGVdICsgJyBpcyBleHBlY3RlZCc7XG5cbiAgICAgICAgICAgICAgICAvLyB0d2VhayBtZXNzYWdlIGFuZCBvZmZzZXRcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIElERU5UOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiBpZGVudGlmaWVyIGlzIGV4cGVjdGVkIGJ1dCB0aGVyZSBpcyBhIGZ1bmN0aW9uIG9yIHVybFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci50b2tlblR5cGUgPT09IEZVTkNUSU9OIHx8IHRoaXMuc2Nhbm5lci50b2tlblR5cGUgPT09IFVSTCQxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy5zY2FubmVyLnRva2VuRW5kIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ0lkZW50aWZpZXIgaXMgZXhwZWN0ZWQgYnV0IGZ1bmN0aW9uIGZvdW5kJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdJZGVudGlmaWVyIGlzIGV4cGVjdGVkJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgSEFTSDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjYW5uZXIuaXNEZWxpbShOVU1CRVJTSUdOKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdOYW1lIGlzIGV4cGVjdGVkJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgUEVSQ0VOVEFHRTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlID09PSBOVU1CRVIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSB0aGlzLnNjYW5uZXIudG9rZW5FbmQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdQZXJjZW50IHNpZ24gaXMgZXhwZWN0ZWQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gdGVzdCB0eXBlIGlzIHBhcnQgb2YgYW5vdGhlciB0b2tlbiBzaG93IGVycm9yIGZvciBjdXJyZW50IHBvc2l0aW9uICsgMVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZS5nLiBlYXQoSFlQSEVOTUlOVVMpIHdpbGwgZmFpbCBvbiBcIi1mb29cIiwgYnV0IHBvaW50aW5nIG9uIFwiLVwiIGlzIG9kZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLnNjYW5uZXIudG9rZW5TdGFydCkgPT09IHRva2VuVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldCArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcihtZXNzYWdlLCBvZmZzZXQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbnN1bWU6IGZ1bmN0aW9uKHRva2VuVHlwZSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5zY2FubmVyLmdldFRva2VuVmFsdWUoKTtcblxuICAgICAgICAgICAgdGhpcy5lYXQodG9rZW5UeXBlKTtcblxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBjb25zdW1lRnVuY3Rpb25OYW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBuYW1lID0gdGhpcy5zY2FubmVyLnNvdXJjZS5zdWJzdHJpbmcodGhpcy5zY2FubmVyLnRva2VuU3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlbkVuZCAtIDEpO1xuXG4gICAgICAgICAgICB0aGlzLmVhdChGVU5DVElPTik7XG5cbiAgICAgICAgICAgIHJldHVybiBuYW1lO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldExvY2F0aW9uOiBmdW5jdGlvbihzdGFydCwgZW5kKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5uZWVkUG9zaXRpb25zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYXRpb25NYXAuZ2V0TG9jYXRpb25SYW5nZShcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgIGVuZCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9LFxuICAgICAgICBnZXRMb2NhdGlvbkZyb21MaXN0OiBmdW5jdGlvbihsaXN0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5uZWVkUG9zaXRpb25zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGhlYWQgPSB0aGlzLmdldEZpcnN0TGlzdE5vZGUobGlzdCk7XG4gICAgICAgICAgICAgICAgdmFyIHRhaWwgPSB0aGlzLmdldExhc3RMaXN0Tm9kZShsaXN0KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhdGlvbk1hcC5nZXRMb2NhdGlvblJhbmdlKFxuICAgICAgICAgICAgICAgICAgICBoZWFkICE9PSBudWxsID8gaGVhZC5sb2Muc3RhcnQub2Zmc2V0IC0gdGhpcy5sb2NhdGlvbk1hcC5zdGFydE9mZnNldCA6IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICB0YWlsICE9PSBudWxsID8gdGFpbC5sb2MuZW5kLm9mZnNldCAtIHRoaXMubG9jYXRpb25NYXAuc3RhcnRPZmZzZXQgOiB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbihtZXNzYWdlLCBvZmZzZXQpIHtcbiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHR5cGVvZiBvZmZzZXQgIT09ICd1bmRlZmluZWQnICYmIG9mZnNldCA8IHRoaXMuc2Nhbm5lci5zb3VyY2UubGVuZ3RoXG4gICAgICAgICAgICAgICAgPyB0aGlzLmxvY2F0aW9uTWFwLmdldExvY2F0aW9uKG9mZnNldClcbiAgICAgICAgICAgICAgICA6IHRoaXMuc2Nhbm5lci5lb2ZcbiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmxvY2F0aW9uTWFwLmdldExvY2F0aW9uKGZpbmRXaGl0ZVNwYWNlU3RhcnQkMSh0aGlzLnNjYW5uZXIuc291cmNlLCB0aGlzLnNjYW5uZXIuc291cmNlLmxlbmd0aCAtIDEpKVxuICAgICAgICAgICAgICAgICAgICA6IHRoaXMubG9jYXRpb25NYXAuZ2V0TG9jYXRpb24odGhpcy5zY2FubmVyLnRva2VuU3RhcnQpO1xuXG4gICAgICAgICAgICB0aHJvdyBuZXcgX1N5bnRheEVycm9yKFxuICAgICAgICAgICAgICAgIG1lc3NhZ2UgfHwgJ1VuZXhwZWN0ZWQgaW5wdXQnLFxuICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5zb3VyY2UsXG4gICAgICAgICAgICAgICAgbG9jYXRpb24ub2Zmc2V0LFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uLmxpbmUsXG4gICAgICAgICAgICAgICAgbG9jYXRpb24uY29sdW1uXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGNvbmZpZyA9IHByb2Nlc3NDb25maWcoY29uZmlnIHx8IHt9KTtcbiAgICBmb3IgKHZhciBrZXkgaW4gY29uZmlnKSB7XG4gICAgICAgIHBhcnNlcltrZXldID0gY29uZmlnW2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uKHNvdXJjZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgICAgICB2YXIgY29udGV4dCA9IG9wdGlvbnMuY29udGV4dCB8fCAnZGVmYXVsdCc7XG4gICAgICAgIHZhciBvbkNvbW1lbnQgPSBvcHRpb25zLm9uQ29tbWVudDtcbiAgICAgICAgdmFyIGFzdDtcblxuICAgICAgICB0b2tlbml6ZXIoc291cmNlLCBwYXJzZXIuc2Nhbm5lcik7XG4gICAgICAgIHBhcnNlci5sb2NhdGlvbk1hcC5zZXRTb3VyY2UoXG4gICAgICAgICAgICBzb3VyY2UsXG4gICAgICAgICAgICBvcHRpb25zLm9mZnNldCxcbiAgICAgICAgICAgIG9wdGlvbnMubGluZSxcbiAgICAgICAgICAgIG9wdGlvbnMuY29sdW1uXG4gICAgICAgICk7XG5cbiAgICAgICAgcGFyc2VyLmZpbGVuYW1lID0gb3B0aW9ucy5maWxlbmFtZSB8fCAnPHVua25vd24+JztcbiAgICAgICAgcGFyc2VyLm5lZWRQb3NpdGlvbnMgPSBCb29sZWFuKG9wdGlvbnMucG9zaXRpb25zKTtcbiAgICAgICAgcGFyc2VyLm9uUGFyc2VFcnJvciA9IHR5cGVvZiBvcHRpb25zLm9uUGFyc2VFcnJvciA9PT0gJ2Z1bmN0aW9uJyA/IG9wdGlvbnMub25QYXJzZUVycm9yIDogbm9vcDtcbiAgICAgICAgcGFyc2VyLm9uUGFyc2VFcnJvclRocm93ID0gZmFsc2U7XG4gICAgICAgIHBhcnNlci5wYXJzZUF0cnVsZVByZWx1ZGUgPSAncGFyc2VBdHJ1bGVQcmVsdWRlJyBpbiBvcHRpb25zID8gQm9vbGVhbihvcHRpb25zLnBhcnNlQXRydWxlUHJlbHVkZSkgOiB0cnVlO1xuICAgICAgICBwYXJzZXIucGFyc2VSdWxlUHJlbHVkZSA9ICdwYXJzZVJ1bGVQcmVsdWRlJyBpbiBvcHRpb25zID8gQm9vbGVhbihvcHRpb25zLnBhcnNlUnVsZVByZWx1ZGUpIDogdHJ1ZTtcbiAgICAgICAgcGFyc2VyLnBhcnNlVmFsdWUgPSAncGFyc2VWYWx1ZScgaW4gb3B0aW9ucyA/IEJvb2xlYW4ob3B0aW9ucy5wYXJzZVZhbHVlKSA6IHRydWU7XG4gICAgICAgIHBhcnNlci5wYXJzZUN1c3RvbVByb3BlcnR5ID0gJ3BhcnNlQ3VzdG9tUHJvcGVydHknIGluIG9wdGlvbnMgPyBCb29sZWFuKG9wdGlvbnMucGFyc2VDdXN0b21Qcm9wZXJ0eSkgOiBmYWxzZTtcblxuICAgICAgICBpZiAoIXBhcnNlci5jb250ZXh0Lmhhc093blByb3BlcnR5KGNvbnRleHQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gY29udGV4dCBgJyArIGNvbnRleHQgKyAnYCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiBvbkNvbW1lbnQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHBhcnNlci5zY2FubmVyLmZvckVhY2hUb2tlbigodHlwZSwgc3RhcnQsIGVuZCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSBDT01NRU5UJDIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jID0gcGFyc2VyLmdldExvY2F0aW9uKHN0YXJ0LCBlbmQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNtcFN0ciQzKHNvdXJjZSwgZW5kIC0gMiwgZW5kLCAnKi8nKVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBzb3VyY2Uuc2xpY2Uoc3RhcnQgKyAyLCBlbmQgLSAyKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBzb3VyY2Uuc2xpY2Uoc3RhcnQgKyAyLCBlbmQpO1xuXG4gICAgICAgICAgICAgICAgICAgIG9uQ29tbWVudCh2YWx1ZSwgbG9jKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFzdCA9IHBhcnNlci5jb250ZXh0W2NvbnRleHRdLmNhbGwocGFyc2VyLCBvcHRpb25zKTtcblxuICAgICAgICBpZiAoIXBhcnNlci5zY2FubmVyLmVvZikge1xuICAgICAgICAgICAgcGFyc2VyLmVycm9yKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXN0O1xuICAgIH07XG59O1xuXG52YXIgY21wQ2hhciQxID0gdG9rZW5pemVyLmNtcENoYXI7XG52YXIgY21wU3RyJDQgPSB0b2tlbml6ZXIuY21wU3RyO1xudmFyIFRZUEUkNSA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgSURFTlQkMSA9IFRZUEUkNS5JZGVudDtcbnZhciBTVFJJTkcgPSBUWVBFJDUuU3RyaW5nO1xudmFyIE5VTUJFUiQxID0gVFlQRSQ1Lk51bWJlcjtcbnZhciBGVU5DVElPTiQxID0gVFlQRSQ1LkZ1bmN0aW9uO1xudmFyIFVSTCQyID0gVFlQRSQ1LlVybDtcbnZhciBIQVNIJDEgPSBUWVBFJDUuSGFzaDtcbnZhciBESU1FTlNJT04gPSBUWVBFJDUuRGltZW5zaW9uO1xudmFyIFBFUkNFTlRBR0UkMSA9IFRZUEUkNS5QZXJjZW50YWdlO1xudmFyIExFRlRQQVJFTlRIRVNJUyA9IFRZUEUkNS5MZWZ0UGFyZW50aGVzaXM7XG52YXIgTEVGVFNRVUFSRUJSQUNLRVQgPSBUWVBFJDUuTGVmdFNxdWFyZUJyYWNrZXQ7XG52YXIgQ09NTUEgPSBUWVBFJDUuQ29tbWE7XG52YXIgREVMSU0gPSBUWVBFJDUuRGVsaW07XG52YXIgTlVNQkVSU0lHTiQxID0gMHgwMDIzOyAgLy8gVSswMDIzIE5VTUJFUiBTSUdOICgjKVxudmFyIEFTVEVSSVNLID0gMHgwMDJBOyAgICAvLyBVKzAwMkEgQVNURVJJU0sgKCopXG52YXIgUExVU1NJR04gPSAweDAwMkI7ICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspXG52YXIgSFlQSEVOTUlOVVMgPSAweDAwMkQ7IC8vIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pXG52YXIgU09MSURVUyA9IDB4MDAyRjsgICAgIC8vIFUrMDAyRiBTT0xJRFVTICgvKVxudmFyIFUgPSAweDAwNzU7ICAgICAgICAgICAvLyBVKzAwNzUgTEFUSU4gU01BTEwgTEVUVEVSIFUgKHUpXG5cbnZhciBfZGVmYXVsdCA9IGZ1bmN0aW9uIGRlZmF1bHRSZWNvZ25pemVyKGNvbnRleHQpIHtcbiAgICBzd2l0Y2ggKHRoaXMuc2Nhbm5lci50b2tlblR5cGUpIHtcbiAgICAgICAgY2FzZSBIQVNIJDE6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5IYXNoKCk7XG5cbiAgICAgICAgY2FzZSBDT01NQTpcbiAgICAgICAgICAgIGNvbnRleHQuc3BhY2UgPSBudWxsO1xuICAgICAgICAgICAgY29udGV4dC5pZ25vcmVXU0FmdGVyID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLk9wZXJhdG9yKCk7XG5cbiAgICAgICAgY2FzZSBMRUZUUEFSRU5USEVTSVM6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5QYXJlbnRoZXNlcyh0aGlzLnJlYWRTZXF1ZW5jZSwgY29udGV4dC5yZWNvZ25pemVyKTtcblxuICAgICAgICBjYXNlIExFRlRTUVVBUkVCUkFDS0VUOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuQnJhY2tldHModGhpcy5yZWFkU2VxdWVuY2UsIGNvbnRleHQucmVjb2duaXplcik7XG5cbiAgICAgICAgY2FzZSBTVFJJTkc6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5TdHJpbmcoKTtcblxuICAgICAgICBjYXNlIERJTUVOU0lPTjpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLkRpbWVuc2lvbigpO1xuXG4gICAgICAgIGNhc2UgUEVSQ0VOVEFHRSQxOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuUGVyY2VudGFnZSgpO1xuXG4gICAgICAgIGNhc2UgTlVNQkVSJDE6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5OdW1iZXIoKTtcblxuICAgICAgICBjYXNlIEZVTkNUSU9OJDE6XG4gICAgICAgICAgICByZXR1cm4gY21wU3RyJDQodGhpcy5zY2FubmVyLnNvdXJjZSwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlbkVuZCwgJ3VybCgnKVxuICAgICAgICAgICAgICAgID8gdGhpcy5VcmwoKVxuICAgICAgICAgICAgICAgIDogdGhpcy5GdW5jdGlvbih0aGlzLnJlYWRTZXF1ZW5jZSwgY29udGV4dC5yZWNvZ25pemVyKTtcblxuICAgICAgICBjYXNlIFVSTCQyOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuVXJsKCk7XG5cbiAgICAgICAgY2FzZSBJREVOVCQxOlxuICAgICAgICAgICAgLy8gY2hlY2sgZm9yIHVuaWNvZGUgcmFuZ2UsIGl0IHNob3VsZCBzdGFydCB3aXRoIHUrIG9yIFUrXG4gICAgICAgICAgICBpZiAoY21wQ2hhciQxKHRoaXMuc2Nhbm5lci5zb3VyY2UsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0LCBVKSAmJlxuICAgICAgICAgICAgICAgIGNtcENoYXIkMSh0aGlzLnNjYW5uZXIuc291cmNlLCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCArIDEsIFBMVVNTSUdOKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlVuaWNvZGVSYW5nZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5JZGVudGlmaWVyKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgY2FzZSBERUxJTTpcbiAgICAgICAgICAgIHZhciBjb2RlID0gdGhpcy5zY2FubmVyLnNvdXJjZS5jaGFyQ29kZUF0KHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KTtcblxuICAgICAgICAgICAgaWYgKGNvZGUgPT09IFNPTElEVVMgfHxcbiAgICAgICAgICAgICAgICBjb2RlID09PSBBU1RFUklTSyB8fFxuICAgICAgICAgICAgICAgIGNvZGUgPT09IFBMVVNTSUdOIHx8XG4gICAgICAgICAgICAgICAgY29kZSA9PT0gSFlQSEVOTUlOVVMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5PcGVyYXRvcigpOyAvLyBUT0RPOiByZXBsYWNlIHdpdGggRGVsaW1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVE9ETzogcHJvZHVjZSBhIG5vZGUgd2l0aCBEZWxpbSBub2RlIHR5cGVcblxuICAgICAgICAgICAgaWYgKGNvZGUgPT09IE5VTUJFUlNJR04kMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0hleCBvciBpZGVudGlmaWVyIGlzIGV4cGVjdGVkJywgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQgKyAxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufTtcblxudmFyIGF0cnVsZVByZWx1ZGUgPSB7XG4gICAgZ2V0Tm9kZTogX2RlZmF1bHRcbn07XG5cbnZhciBUWVBFJDYgPSB0b2tlbml6ZXIuVFlQRTtcblxudmFyIERFTElNJDEgPSBUWVBFJDYuRGVsaW07XG52YXIgSURFTlQkMiA9IFRZUEUkNi5JZGVudDtcbnZhciBESU1FTlNJT04kMSA9IFRZUEUkNi5EaW1lbnNpb247XG52YXIgUEVSQ0VOVEFHRSQyID0gVFlQRSQ2LlBlcmNlbnRhZ2U7XG52YXIgTlVNQkVSJDIgPSBUWVBFJDYuTnVtYmVyO1xudmFyIEhBU0gkMiA9IFRZUEUkNi5IYXNoO1xudmFyIENPTE9OID0gVFlQRSQ2LkNvbG9uO1xudmFyIExFRlRTUVVBUkVCUkFDS0VUJDEgPSBUWVBFJDYuTGVmdFNxdWFyZUJyYWNrZXQ7XG52YXIgTlVNQkVSU0lHTiQyID0gMHgwMDIzOyAgICAgIC8vIFUrMDAyMyBOVU1CRVIgU0lHTiAoIylcbnZhciBBU1RFUklTSyQxID0gMHgwMDJBOyAgICAgICAgLy8gVSswMDJBIEFTVEVSSVNLICgqKVxudmFyIFBMVVNTSUdOJDEgPSAweDAwMkI7ICAgICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKVxudmFyIFNPTElEVVMkMSA9IDB4MDAyRjsgICAgICAgICAvLyBVKzAwMkYgU09MSURVUyAoLylcbnZhciBGVUxMU1RPUCA9IDB4MDAyRTsgICAgICAgIC8vIFUrMDAyRSBGVUxMIFNUT1AgKC4pXG52YXIgR1JFQVRFUlRIQU5TSUdOID0gMHgwMDNFOyAvLyBVKzAwM0UgR1JFQVRFUi1USEFOIFNJR04gKD4pXG52YXIgVkVSVElDQUxMSU5FID0gMHgwMDdDOyAgICAvLyBVKzAwN0MgVkVSVElDQUwgTElORSAofClcbnZhciBUSUxERSA9IDB4MDA3RTsgICAgICAgICAgIC8vIFUrMDA3RSBUSUxERSAofilcblxuZnVuY3Rpb24gZ2V0Tm9kZShjb250ZXh0KSB7XG4gICAgc3dpdGNoICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlKSB7XG4gICAgICAgIGNhc2UgTEVGVFNRVUFSRUJSQUNLRVQkMTpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLkF0dHJpYnV0ZVNlbGVjdG9yKCk7XG5cbiAgICAgICAgY2FzZSBIQVNIJDI6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5JZFNlbGVjdG9yKCk7XG5cbiAgICAgICAgY2FzZSBDT0xPTjpcbiAgICAgICAgICAgIGlmICh0aGlzLnNjYW5uZXIubG9va3VwVHlwZSgxKSA9PT0gQ09MT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Qc2V1ZG9FbGVtZW50U2VsZWN0b3IoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUHNldWRvQ2xhc3NTZWxlY3RvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIGNhc2UgSURFTlQkMjpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLlR5cGVTZWxlY3RvcigpO1xuXG4gICAgICAgIGNhc2UgTlVNQkVSJDI6XG4gICAgICAgIGNhc2UgUEVSQ0VOVEFHRSQyOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuUGVyY2VudGFnZSgpO1xuXG4gICAgICAgIGNhc2UgRElNRU5TSU9OJDE6XG4gICAgICAgICAgICAvLyB0aHJvd3Mgd2hlbiAuMTIzaWRlbnRcbiAgICAgICAgICAgIGlmICh0aGlzLnNjYW5uZXIuc291cmNlLmNoYXJDb2RlQXQodGhpcy5zY2FubmVyLnRva2VuU3RhcnQpID09PSBGVUxMU1RPUCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0lkZW50aWZpZXIgaXMgZXhwZWN0ZWQnLCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCArIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSBERUxJTSQxOlxuICAgICAgICAgICAgdmFyIGNvZGUgPSB0aGlzLnNjYW5uZXIuc291cmNlLmNoYXJDb2RlQXQodGhpcy5zY2FubmVyLnRva2VuU3RhcnQpO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKGNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFBMVVNTSUdOJDE6XG4gICAgICAgICAgICAgICAgY2FzZSBHUkVBVEVSVEhBTlNJR046XG4gICAgICAgICAgICAgICAgY2FzZSBUSUxERTpcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5zcGFjZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQuaWdub3JlV1NBZnRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkNvbWJpbmF0b3IoKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgU09MSURVUyQxOiAgLy8gL2RlZXAvXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkNvbWJpbmF0b3IoKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgRlVMTFNUT1A6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkNsYXNzU2VsZWN0b3IoKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgQVNURVJJU0skMTpcbiAgICAgICAgICAgICAgICBjYXNlIFZFUlRJQ0FMTElORTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuVHlwZVNlbGVjdG9yKCk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIE5VTUJFUlNJR04kMjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuSWRTZWxlY3RvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59XG52YXIgc2VsZWN0b3IgPSB7XG4gICAgZ2V0Tm9kZTogZ2V0Tm9kZVxufTtcblxuLy8gbGVnYWN5IElFIGZ1bmN0aW9uXG4vLyBleHByZXNzaW9uKCA8YW55LXZhbHVlPiApXG52YXIgZXhwcmVzc2lvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KFxuICAgICAgICB0aGlzLlJhdyh0aGlzLnNjYW5uZXIudG9rZW5JbmRleCwgbnVsbCwgZmFsc2UpXG4gICAgKTtcbn07XG5cbnZhciBUWVBFJDcgPSB0b2tlbml6ZXIuVFlQRTtcblxudmFyIFdoaXRlU3BhY2UgPSBUWVBFJDcuV2hpdGVTcGFjZTtcbnZhciBTZW1pY29sb24gPSBUWVBFJDcuU2VtaWNvbG9uO1xudmFyIExlZnRDdXJseUJyYWNrZXQgPSBUWVBFJDcuTGVmdEN1cmx5QnJhY2tldDtcbnZhciBEZWxpbSA9IFRZUEUkNy5EZWxpbTtcbnZhciBFWENMQU1BVElPTk1BUksgPSAweDAwMjE7IC8vIFUrMDAyMSBFWENMQU1BVElPTiBNQVJLICghKVxuXG5mdW5jdGlvbiBnZXRPZmZzZXRFeGNsdWRlV1MoKSB7XG4gICAgaWYgKHRoaXMuc2Nhbm5lci50b2tlbkluZGV4ID4gMCkge1xuICAgICAgICBpZiAodGhpcy5zY2FubmVyLmxvb2t1cFR5cGUoLTEpID09PSBXaGl0ZVNwYWNlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zY2FubmVyLnRva2VuSW5kZXggPiAxXG4gICAgICAgICAgICAgICAgPyB0aGlzLnNjYW5uZXIuZ2V0VG9rZW5TdGFydCh0aGlzLnNjYW5uZXIudG9rZW5JbmRleCAtIDEpXG4gICAgICAgICAgICAgICAgOiB0aGlzLnNjYW5uZXIuZmlyc3RDaGFyT2Zmc2V0O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xufVxuXG4vLyAwLCAwLCBmYWxzZVxuZnVuY3Rpb24gYmFsYW5jZUVuZCgpIHtcbiAgICByZXR1cm4gMDtcbn1cblxuLy8gTEVGVENVUkxZQlJBQ0tFVCwgMCwgZmFsc2VcbmZ1bmN0aW9uIGxlZnRDdXJseUJyYWNrZXQodG9rZW5UeXBlKSB7XG4gICAgcmV0dXJuIHRva2VuVHlwZSA9PT0gTGVmdEN1cmx5QnJhY2tldCA/IDEgOiAwO1xufVxuXG4vLyBMRUZUQ1VSTFlCUkFDS0VULCBTRU1JQ09MT04sIGZhbHNlXG5mdW5jdGlvbiBsZWZ0Q3VybHlCcmFja2V0T3JTZW1pY29sb24odG9rZW5UeXBlKSB7XG4gICAgcmV0dXJuIHRva2VuVHlwZSA9PT0gTGVmdEN1cmx5QnJhY2tldCB8fCB0b2tlblR5cGUgPT09IFNlbWljb2xvbiA/IDEgOiAwO1xufVxuXG4vLyBFWENMQU1BVElPTk1BUkssIFNFTUlDT0xPTiwgZmFsc2VcbmZ1bmN0aW9uIGV4Y2xhbWF0aW9uTWFya09yU2VtaWNvbG9uKHRva2VuVHlwZSwgc291cmNlLCBvZmZzZXQpIHtcbiAgICBpZiAodG9rZW5UeXBlID09PSBEZWxpbSAmJiBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpID09PSBFWENMQU1BVElPTk1BUkspIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRva2VuVHlwZSA9PT0gU2VtaWNvbG9uID8gMSA6IDA7XG59XG5cbi8vIDAsIFNFTUlDT0xPTiwgdHJ1ZVxuZnVuY3Rpb24gc2VtaWNvbG9uSW5jbHVkZWQodG9rZW5UeXBlKSB7XG4gICAgcmV0dXJuIHRva2VuVHlwZSA9PT0gU2VtaWNvbG9uID8gMiA6IDA7XG59XG5cbnZhciBSYXcgPSB7XG4gICAgbmFtZTogJ1JhdycsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIHZhbHVlOiBTdHJpbmdcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbihzdGFydFRva2VuLCBtb2RlLCBleGNsdWRlV2hpdGVTcGFjZSkge1xuICAgICAgICB2YXIgc3RhcnRPZmZzZXQgPSB0aGlzLnNjYW5uZXIuZ2V0VG9rZW5TdGFydChzdGFydFRva2VuKTtcbiAgICAgICAgdmFyIGVuZE9mZnNldDtcblxuICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcChcbiAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5nZXRSYXdMZW5ndGgoc3RhcnRUb2tlbiwgbW9kZSB8fCBiYWxhbmNlRW5kKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChleGNsdWRlV2hpdGVTcGFjZSAmJiB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCA+IHN0YXJ0T2Zmc2V0KSB7XG4gICAgICAgICAgICBlbmRPZmZzZXQgPSBnZXRPZmZzZXRFeGNsdWRlV1MuY2FsbCh0aGlzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVuZE9mZnNldCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdSYXcnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0T2Zmc2V0LCBlbmRPZmZzZXQpLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuc2Nhbm5lci5zb3VyY2Uuc3Vic3RyaW5nKHN0YXJ0T2Zmc2V0LCBlbmRPZmZzZXQpXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNodW5rKG5vZGUudmFsdWUpO1xuICAgIH0sXG5cbiAgICBtb2RlOiB7XG4gICAgICAgIGRlZmF1bHQ6IGJhbGFuY2VFbmQsXG4gICAgICAgIGxlZnRDdXJseUJyYWNrZXQ6IGxlZnRDdXJseUJyYWNrZXQsXG4gICAgICAgIGxlZnRDdXJseUJyYWNrZXRPclNlbWljb2xvbjogbGVmdEN1cmx5QnJhY2tldE9yU2VtaWNvbG9uLFxuICAgICAgICBleGNsYW1hdGlvbk1hcmtPclNlbWljb2xvbjogZXhjbGFtYXRpb25NYXJrT3JTZW1pY29sb24sXG4gICAgICAgIHNlbWljb2xvbkluY2x1ZGVkOiBzZW1pY29sb25JbmNsdWRlZFxuICAgIH1cbn07XG5cbnZhciBUWVBFJDggPSB0b2tlbml6ZXIuVFlQRTtcbnZhciByYXdNb2RlID0gUmF3Lm1vZGU7XG5cbnZhciBDT01NQSQxID0gVFlQRSQ4LkNvbW1hO1xudmFyIFdISVRFU1BBQ0UkMyA9IFRZUEUkOC5XaGl0ZVNwYWNlO1xuXG4vLyB2YXIoIDxpZGVudD4gLCA8dmFsdWU+PyApXG52YXIgX3ZhciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY3JlYXRlTGlzdCgpO1xuXG4gICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuXG4gICAgLy8gTk9URTogRG9uJ3QgY2hlY2sgbW9yZSB0aGFuIGEgZmlyc3QgYXJndW1lbnQgaXMgYW4gaWRlbnQsIHJlc3QgY2hlY2tzIGFyZSBmb3IgbGV4ZXJcbiAgICBjaGlsZHJlbi5wdXNoKHRoaXMuSWRlbnRpZmllcigpKTtcblxuICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcblxuICAgIGlmICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlID09PSBDT01NQSQxKSB7XG4gICAgICAgIGNoaWxkcmVuLnB1c2godGhpcy5PcGVyYXRvcigpKTtcblxuICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gdGhpcy5zY2FubmVyLnRva2VuSW5kZXg7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5wYXJzZUN1c3RvbVByb3BlcnR5XG4gICAgICAgICAgICA/IHRoaXMuVmFsdWUobnVsbClcbiAgICAgICAgICAgIDogdGhpcy5SYXcodGhpcy5zY2FubmVyLnRva2VuSW5kZXgsIHJhd01vZGUuZXhjbGFtYXRpb25NYXJrT3JTZW1pY29sb24sIGZhbHNlKTtcblxuICAgICAgICBpZiAodmFsdWUudHlwZSA9PT0gJ1ZhbHVlJyAmJiB2YWx1ZS5jaGlsZHJlbi5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIGZvciAobGV0IG9mZnNldCA9IHN0YXJ0SW5kZXggLSB0aGlzLnNjYW5uZXIudG9rZW5JbmRleDsgb2Zmc2V0IDw9IDA7IG9mZnNldCsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci5sb29rdXBUeXBlKG9mZnNldCkgPT09IFdISVRFU1BBQ0UkMykge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5jaGlsZHJlbi5hcHBlbmREYXRhKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdXaGl0ZVNwYWNlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYzogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnICdcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNoaWxkcmVuLnB1c2godmFsdWUpO1xuICAgIH1cblxuICAgIHJldHVybiBjaGlsZHJlbjtcbn07XG5cbnZhciB2YWx1ZSA9IHtcbiAgICBnZXROb2RlOiBfZGVmYXVsdCxcbiAgICAnZXhwcmVzc2lvbic6IGV4cHJlc3Npb24sXG4gICAgJ3Zhcic6IF92YXJcbn07XG5cbnZhciBzY29wZSA9IHtcbiAgICBBdHJ1bGVQcmVsdWRlOiBhdHJ1bGVQcmVsdWRlLFxuICAgIFNlbGVjdG9yOiBzZWxlY3RvcixcbiAgICBWYWx1ZTogdmFsdWVcbn07XG5cbnZhciBmb250RmFjZSA9IHtcbiAgICBwYXJzZToge1xuICAgICAgICBwcmVsdWRlOiBudWxsLFxuICAgICAgICBibG9jazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5CbG9jayh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbnZhciBUWVBFJDkgPSB0b2tlbml6ZXIuVFlQRTtcblxudmFyIFNUUklORyQxID0gVFlQRSQ5LlN0cmluZztcbnZhciBJREVOVCQzID0gVFlQRSQ5LklkZW50O1xudmFyIFVSTCQzID0gVFlQRSQ5LlVybDtcbnZhciBGVU5DVElPTiQyID0gVFlQRSQ5LkZ1bmN0aW9uO1xudmFyIExFRlRQQVJFTlRIRVNJUyQxID0gVFlQRSQ5LkxlZnRQYXJlbnRoZXNpcztcblxudmFyIF9pbXBvcnQgPSB7XG4gICAgcGFyc2U6IHtcbiAgICAgICAgcHJlbHVkZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTtcblxuICAgICAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc2Nhbm5lci50b2tlblR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFNUUklORyQxOlxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuU3RyaW5nKCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgVVJMJDM6XG4gICAgICAgICAgICAgICAgY2FzZSBGVU5DVElPTiQyOlxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuVXJsKCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1N0cmluZyBvciB1cmwoKSBpcyBleHBlY3RlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5sb29rdXBOb25XU1R5cGUoMCkgPT09IElERU5UJDMgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cE5vbldTVHlwZSgwKSA9PT0gTEVGVFBBUkVOVEhFU0lTJDEpIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuV2hpdGVTcGFjZSgpKTtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuTWVkaWFRdWVyeUxpc3QoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbjtcbiAgICAgICAgfSxcbiAgICAgICAgYmxvY2s6IG51bGxcbiAgICB9XG59O1xuXG52YXIgbWVkaWEgPSB7XG4gICAgcGFyc2U6IHtcbiAgICAgICAgcHJlbHVkZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVTaW5nbGVOb2RlTGlzdChcbiAgICAgICAgICAgICAgICB0aGlzLk1lZGlhUXVlcnlMaXN0KClcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIGJsb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLkJsb2NrKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbnZhciBwYWdlID0ge1xuICAgIHBhcnNlOiB7XG4gICAgICAgIHByZWx1ZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2luZ2xlTm9kZUxpc3QoXG4gICAgICAgICAgICAgICAgdGhpcy5TZWxlY3Rvckxpc3QoKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgYmxvY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2sodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG52YXIgVFlQRSRhID0gdG9rZW5pemVyLlRZUEU7XG5cbnZhciBXSElURVNQQUNFJDQgPSBUWVBFJGEuV2hpdGVTcGFjZTtcbnZhciBDT01NRU5UJDMgPSBUWVBFJGEuQ29tbWVudDtcbnZhciBJREVOVCQ0ID0gVFlQRSRhLklkZW50O1xudmFyIEZVTkNUSU9OJDMgPSBUWVBFJGEuRnVuY3Rpb247XG52YXIgQ09MT04kMSA9IFRZUEUkYS5Db2xvbjtcbnZhciBMRUZUUEFSRU5USEVTSVMkMiA9IFRZUEUkYS5MZWZ0UGFyZW50aGVzaXM7XG5cbmZ1bmN0aW9uIGNvbnN1bWVSYXcoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlU2luZ2xlTm9kZUxpc3QoXG4gICAgICAgIHRoaXMuUmF3KHRoaXMuc2Nhbm5lci50b2tlbkluZGV4LCBudWxsLCBmYWxzZSlcbiAgICApO1xufVxuXG5mdW5jdGlvbiBwYXJlbnRoZXNlcygpIHtcbiAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG5cbiAgICBpZiAodGhpcy5zY2FubmVyLnRva2VuVHlwZSA9PT0gSURFTlQkNCAmJlxuICAgICAgICB0aGlzLmxvb2t1cE5vbldTVHlwZSgxKSA9PT0gQ09MT04kMSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVTaW5nbGVOb2RlTGlzdChcbiAgICAgICAgICAgIHRoaXMuRGVjbGFyYXRpb24oKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiByZWFkU2VxdWVuY2UuY2FsbCh0aGlzKTtcbn1cblxuZnVuY3Rpb24gcmVhZFNlcXVlbmNlKCkge1xuICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY3JlYXRlTGlzdCgpO1xuICAgIHZhciBzcGFjZSA9IG51bGw7XG4gICAgdmFyIGNoaWxkO1xuXG4gICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuXG4gICAgc2NhbjpcbiAgICB3aGlsZSAoIXRoaXMuc2Nhbm5lci5lb2YpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlKSB7XG4gICAgICAgICAgICBjYXNlIFdISVRFU1BBQ0UkNDpcbiAgICAgICAgICAgICAgICBzcGFjZSA9IHRoaXMuV2hpdGVTcGFjZSgpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICBjYXNlIENPTU1FTlQkMzpcbiAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICBjYXNlIEZVTkNUSU9OJDM6XG4gICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLkZ1bmN0aW9uKGNvbnN1bWVSYXcsIHRoaXMuc2NvcGUuQXRydWxlUHJlbHVkZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgSURFTlQkNDpcbiAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuSWRlbnRpZmllcigpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIExFRlRQQVJFTlRIRVNJUyQyOlxuICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5QYXJlbnRoZXNlcyhwYXJlbnRoZXNlcywgdGhpcy5zY29wZS5BdHJ1bGVQcmVsdWRlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhayBzY2FuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNwYWNlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHNwYWNlKTtcbiAgICAgICAgICAgIHNwYWNlID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgIH1cblxuICAgIHJldHVybiBjaGlsZHJlbjtcbn1cblxudmFyIHN1cHBvcnRzID0ge1xuICAgIHBhcnNlOiB7XG4gICAgICAgIHByZWx1ZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gcmVhZFNlcXVlbmNlLmNhbGwodGhpcyk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmdldEZpcnN0TGlzdE5vZGUoY2hpbGRyZW4pID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcignQ29uZGl0aW9uIGlzIGV4cGVjdGVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbjtcbiAgICAgICAgfSxcbiAgICAgICAgYmxvY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2soZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxudmFyIGF0cnVsZSA9IHtcbiAgICAnZm9udC1mYWNlJzogZm9udEZhY2UsXG4gICAgJ2ltcG9ydCc6IF9pbXBvcnQsXG4gICAgJ21lZGlhJzogbWVkaWEsXG4gICAgJ3BhZ2UnOiBwYWdlLFxuICAgICdzdXBwb3J0cyc6IHN1cHBvcnRzXG59O1xuXG52YXIgZGlyID0ge1xuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2luZ2xlTm9kZUxpc3QoXG4gICAgICAgICAgICB0aGlzLklkZW50aWZpZXIoKVxuICAgICAgICApO1xuICAgIH1cbn07XG5cbnZhciBoYXMkMSA9IHtcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KFxuICAgICAgICAgICAgdGhpcy5TZWxlY3Rvckxpc3QoKVxuICAgICAgICApO1xuICAgIH1cbn07XG5cbnZhciBsYW5nID0ge1xuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2luZ2xlTm9kZUxpc3QoXG4gICAgICAgICAgICB0aGlzLklkZW50aWZpZXIoKVxuICAgICAgICApO1xuICAgIH1cbn07XG5cbnZhciBzZWxlY3Rvckxpc3QgPSB7XG4gICAgcGFyc2U6IGZ1bmN0aW9uIHNlbGVjdG9yTGlzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2luZ2xlTm9kZUxpc3QoXG4gICAgICAgICAgICB0aGlzLlNlbGVjdG9yTGlzdCgpXG4gICAgICAgICk7XG4gICAgfVxufTtcblxudmFyIG1hdGNoZXMgPSBzZWxlY3Rvckxpc3Q7XG5cbnZhciBub3QgPSBzZWxlY3Rvckxpc3Q7XG5cbnZhciBBTExPV19PRl9DTEFVU0UgPSB0cnVlO1xuXG52YXIgbnRoV2l0aE9mQ2xhdXNlID0ge1xuICAgIHBhcnNlOiBmdW5jdGlvbiBudGhXaXRoT2ZDbGF1c2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KFxuICAgICAgICAgICAgdGhpcy5OdGgoQUxMT1dfT0ZfQ0xBVVNFKVxuICAgICAgICApO1xuICAgIH1cbn07XG5cbnZhciBudGhDaGlsZCA9IG50aFdpdGhPZkNsYXVzZTtcblxudmFyIG50aExhc3RDaGlsZCA9IG50aFdpdGhPZkNsYXVzZTtcblxudmFyIERJU0FMTE9XX09GX0NMQVVTRSA9IGZhbHNlO1xuXG52YXIgbnRoID0ge1xuICAgIHBhcnNlOiBmdW5jdGlvbiBudGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KFxuICAgICAgICAgICAgdGhpcy5OdGgoRElTQUxMT1dfT0ZfQ0xBVVNFKVxuICAgICAgICApO1xuICAgIH1cbn07XG5cbnZhciBudGhMYXN0T2ZUeXBlID0gbnRoO1xuXG52YXIgbnRoT2ZUeXBlID0gbnRoO1xuXG52YXIgc2xvdHRlZCA9IHtcbiAgICBwYXJzZTogZnVuY3Rpb24gY29tcG91bmRTZWxlY3RvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2luZ2xlTm9kZUxpc3QoXG4gICAgICAgICAgICB0aGlzLlNlbGVjdG9yKClcbiAgICAgICAgKTtcbiAgICB9XG59O1xuXG52YXIgcHNldWRvID0ge1xuICAgICdkaXInOiBkaXIsXG4gICAgJ2hhcyc6IGhhcyQxLFxuICAgICdsYW5nJzogbGFuZyxcbiAgICAnbWF0Y2hlcyc6IG1hdGNoZXMsXG4gICAgJ25vdCc6IG5vdCxcbiAgICAnbnRoLWNoaWxkJzogbnRoQ2hpbGQsXG4gICAgJ250aC1sYXN0LWNoaWxkJzogbnRoTGFzdENoaWxkLFxuICAgICdudGgtbGFzdC1vZi10eXBlJzogbnRoTGFzdE9mVHlwZSxcbiAgICAnbnRoLW9mLXR5cGUnOiBudGhPZlR5cGUsXG4gICAgJ3Nsb3R0ZWQnOiBzbG90dGVkXG59O1xuXG52YXIgY21wQ2hhciQyID0gdG9rZW5pemVyLmNtcENoYXI7XG52YXIgaXNEaWdpdCQyID0gdG9rZW5pemVyLmlzRGlnaXQ7XG52YXIgVFlQRSRiID0gdG9rZW5pemVyLlRZUEU7XG5cbnZhciBXSElURVNQQUNFJDUgPSBUWVBFJGIuV2hpdGVTcGFjZTtcbnZhciBDT01NRU5UJDQgPSBUWVBFJGIuQ29tbWVudDtcbnZhciBJREVOVCQ1ID0gVFlQRSRiLklkZW50O1xudmFyIE5VTUJFUiQzID0gVFlQRSRiLk51bWJlcjtcbnZhciBESU1FTlNJT04kMiA9IFRZUEUkYi5EaW1lbnNpb247XG52YXIgUExVU1NJR04kMiA9IDB4MDAyQjsgICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKylcbnZhciBIWVBIRU5NSU5VUyQxID0gMHgwMDJEOyAvLyBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKVxudmFyIE4kMSA9IDB4MDA2RTsgICAgICAgICAgIC8vIFUrMDA2RSBMQVRJTiBTTUFMTCBMRVRURVIgTiAobilcbnZhciBESVNBTExPV19TSUdOID0gdHJ1ZTtcbnZhciBBTExPV19TSUdOID0gZmFsc2U7XG5cbmZ1bmN0aW9uIGNoZWNrSW50ZWdlcihvZmZzZXQsIGRpc2FsbG93U2lnbikge1xuICAgIHZhciBwb3MgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCArIG9mZnNldDtcbiAgICB2YXIgY29kZSA9IHRoaXMuc2Nhbm5lci5zb3VyY2UuY2hhckNvZGVBdChwb3MpO1xuXG4gICAgaWYgKGNvZGUgPT09IFBMVVNTSUdOJDIgfHwgY29kZSA9PT0gSFlQSEVOTUlOVVMkMSkge1xuICAgICAgICBpZiAoZGlzYWxsb3dTaWduKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yKCdOdW1iZXIgc2lnbiBpcyBub3QgYWxsb3dlZCcpO1xuICAgICAgICB9XG4gICAgICAgIHBvcysrO1xuICAgIH1cblxuICAgIGZvciAoOyBwb3MgPCB0aGlzLnNjYW5uZXIudG9rZW5FbmQ7IHBvcysrKSB7XG4gICAgICAgIGlmICghaXNEaWdpdCQyKHRoaXMuc2Nhbm5lci5zb3VyY2UuY2hhckNvZGVBdChwb3MpKSkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcignSW50ZWdlciBpcyBleHBlY3RlZCcsIHBvcyk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNoZWNrVG9rZW5Jc0ludGVnZXIoZGlzYWxsb3dTaWduKSB7XG4gICAgcmV0dXJuIGNoZWNrSW50ZWdlci5jYWxsKHRoaXMsIDAsIGRpc2FsbG93U2lnbik7XG59XG5cbmZ1bmN0aW9uIGV4cGVjdENoYXJDb2RlKG9mZnNldCwgY29kZSkge1xuICAgIGlmICghY21wQ2hhciQyKHRoaXMuc2Nhbm5lci5zb3VyY2UsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0ICsgb2Zmc2V0LCBjb2RlKSkge1xuICAgICAgICB2YXIgbXNnID0gJyc7XG5cbiAgICAgICAgc3dpdGNoIChjb2RlKSB7XG4gICAgICAgICAgICBjYXNlIE4kMTpcbiAgICAgICAgICAgICAgICBtc2cgPSAnTiBpcyBleHBlY3RlZCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEhZUEhFTk1JTlVTJDE6XG4gICAgICAgICAgICAgICAgbXNnID0gJ0h5cGhlbk1pbnVzIGlzIGV4cGVjdGVkJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZXJyb3IobXNnLCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCArIG9mZnNldCk7XG4gICAgfVxufVxuXG4vLyAuLi4gPHNpZ25lZC1pbnRlZ2VyPlxuLy8gLi4uIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPlxuZnVuY3Rpb24gY29uc3VtZUIoKSB7XG4gICAgdmFyIG9mZnNldCA9IDA7XG4gICAgdmFyIHNpZ24gPSAwO1xuICAgIHZhciB0eXBlID0gdGhpcy5zY2FubmVyLnRva2VuVHlwZTtcblxuICAgIHdoaWxlICh0eXBlID09PSBXSElURVNQQUNFJDUgfHwgdHlwZSA9PT0gQ09NTUVOVCQ0KSB7XG4gICAgICAgIHR5cGUgPSB0aGlzLnNjYW5uZXIubG9va3VwVHlwZSgrK29mZnNldCk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGUgIT09IE5VTUJFUiQzKSB7XG4gICAgICAgIGlmICh0aGlzLnNjYW5uZXIuaXNEZWxpbShQTFVTU0lHTiQyLCBvZmZzZXQpIHx8XG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIuaXNEZWxpbShIWVBIRU5NSU5VUyQxLCBvZmZzZXQpKSB7XG4gICAgICAgICAgICBzaWduID0gdGhpcy5zY2FubmVyLmlzRGVsaW0oUExVU1NJR04kMiwgb2Zmc2V0KSA/IFBMVVNTSUdOJDIgOiBIWVBIRU5NSU5VUyQxO1xuXG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgdHlwZSA9IHRoaXMuc2Nhbm5lci5sb29rdXBUeXBlKCsrb2Zmc2V0KTtcbiAgICAgICAgICAgIH0gd2hpbGUgKHR5cGUgPT09IFdISVRFU1BBQ0UkNSB8fCB0eXBlID09PSBDT01NRU5UJDQpO1xuXG4gICAgICAgICAgICBpZiAodHlwZSAhPT0gTlVNQkVSJDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcChvZmZzZXQpO1xuICAgICAgICAgICAgICAgIGNoZWNrVG9rZW5Jc0ludGVnZXIuY2FsbCh0aGlzLCBESVNBTExPV19TSUdOKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9mZnNldCA+IDApIHtcbiAgICAgICAgdGhpcy5zY2FubmVyLnNraXAob2Zmc2V0KTtcbiAgICB9XG5cbiAgICBpZiAoc2lnbiA9PT0gMCkge1xuICAgICAgICB0eXBlID0gdGhpcy5zY2FubmVyLnNvdXJjZS5jaGFyQ29kZUF0KHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KTtcbiAgICAgICAgaWYgKHR5cGUgIT09IFBMVVNTSUdOJDIgJiYgdHlwZSAhPT0gSFlQSEVOTUlOVVMkMSkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcignTnVtYmVyIHNpZ24gaXMgZXhwZWN0ZWQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNoZWNrVG9rZW5Jc0ludGVnZXIuY2FsbCh0aGlzLCBzaWduICE9PSAwKTtcbiAgICByZXR1cm4gc2lnbiA9PT0gSFlQSEVOTUlOVVMkMSA/ICctJyArIHRoaXMuY29uc3VtZShOVU1CRVIkMykgOiB0aGlzLmNvbnN1bWUoTlVNQkVSJDMpO1xufVxuXG4vLyBBbitCIG1pY3Jvc3ludGF4IGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3Mtc3ludGF4LTMvI2FuYlxudmFyIEFuUGx1c0IgPSB7XG4gICAgbmFtZTogJ0FuUGx1c0InLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICBhOiBbU3RyaW5nLCBudWxsXSxcbiAgICAgICAgYjogW1N0cmluZywgbnVsbF1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgYnJhY2Utc3R5bGUqL1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcbiAgICAgICAgdmFyIGEgPSBudWxsO1xuICAgICAgICB2YXIgYiA9IG51bGw7XG5cbiAgICAgICAgLy8gPGludGVnZXI+XG4gICAgICAgIGlmICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlID09PSBOVU1CRVIkMykge1xuICAgICAgICAgICAgY2hlY2tUb2tlbklzSW50ZWdlci5jYWxsKHRoaXMsIEFMTE9XX1NJR04pO1xuICAgICAgICAgICAgYiA9IHRoaXMuY29uc3VtZShOVU1CRVIkMyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAtblxuICAgICAgICAvLyAtbiA8c2lnbmVkLWludGVnZXI+XG4gICAgICAgIC8vIC1uIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPlxuICAgICAgICAvLyAtbi0gPHNpZ25sZXNzLWludGVnZXI+XG4gICAgICAgIC8vIDxkYXNobmRhc2hkaWdpdC1pZGVudD5cbiAgICAgICAgZWxzZSBpZiAodGhpcy5zY2FubmVyLnRva2VuVHlwZSA9PT0gSURFTlQkNSAmJiBjbXBDaGFyJDIodGhpcy5zY2FubmVyLnNvdXJjZSwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQsIEhZUEhFTk1JTlVTJDEpKSB7XG4gICAgICAgICAgICBhID0gJy0xJztcblxuICAgICAgICAgICAgZXhwZWN0Q2hhckNvZGUuY2FsbCh0aGlzLCAxLCBOJDEpO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc2Nhbm5lci5nZXRUb2tlbkxlbmd0aCgpKSB7XG4gICAgICAgICAgICAgICAgLy8gLW5cbiAgICAgICAgICAgICAgICAvLyAtbiA8c2lnbmVkLWludGVnZXI+XG4gICAgICAgICAgICAgICAgLy8gLW4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICBiID0gY29uc3VtZUIuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAvLyAtbi0gPHNpZ25sZXNzLWludGVnZXI+XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3RDaGFyQ29kZS5jYWxsKHRoaXMsIDIsIEhZUEhFTk1JTlVTJDEpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcblxuICAgICAgICAgICAgICAgICAgICBjaGVja1Rva2VuSXNJbnRlZ2VyLmNhbGwodGhpcywgRElTQUxMT1dfU0lHTik7XG5cbiAgICAgICAgICAgICAgICAgICAgYiA9ICctJyArIHRoaXMuY29uc3VtZShOVU1CRVIkMyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgLy8gPGRhc2huZGFzaGRpZ2l0LWlkZW50PlxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdENoYXJDb2RlLmNhbGwodGhpcywgMiwgSFlQSEVOTUlOVVMkMSk7XG4gICAgICAgICAgICAgICAgICAgIGNoZWNrSW50ZWdlci5jYWxsKHRoaXMsIDMsIERJU0FMTE9XX1NJR04pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGIgPSB0aGlzLnNjYW5uZXIuc3Vic3RyVG9DdXJzb3Ioc3RhcnQgKyAyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vICcrJz8gblxuICAgICAgICAvLyAnKyc/IG4gPHNpZ25lZC1pbnRlZ2VyPlxuICAgICAgICAvLyAnKyc/IG4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+XG4gICAgICAgIC8vICcrJz8gbi0gPHNpZ25sZXNzLWludGVnZXI+XG4gICAgICAgIC8vICcrJz8gPG5kYXNoZGlnaXQtaWRlbnQ+XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc2Nhbm5lci50b2tlblR5cGUgPT09IElERU5UJDUgfHwgKHRoaXMuc2Nhbm5lci5pc0RlbGltKFBMVVNTSUdOJDIpICYmIHRoaXMuc2Nhbm5lci5sb29rdXBUeXBlKDEpID09PSBJREVOVCQ1KSkge1xuICAgICAgICAgICAgdmFyIHNpZ24gPSAwO1xuICAgICAgICAgICAgYSA9ICcxJztcblxuICAgICAgICAgICAgLy8ganVzdCBpZ25vcmUgYSBwbHVzXG4gICAgICAgICAgICBpZiAodGhpcy5zY2FubmVyLmlzRGVsaW0oUExVU1NJR04kMikpIHtcbiAgICAgICAgICAgICAgICBzaWduID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBleHBlY3RDaGFyQ29kZS5jYWxsKHRoaXMsIDAsIE4kMSk7XG5cbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zY2FubmVyLmdldFRva2VuTGVuZ3RoKCkpIHtcbiAgICAgICAgICAgICAgICAvLyAnKyc/IG5cbiAgICAgICAgICAgICAgICAvLyAnKyc/IG4gPHNpZ25lZC1pbnRlZ2VyPlxuICAgICAgICAgICAgICAgIC8vICcrJz8gbiBbJysnIHwgJy0nXSA8c2lnbmxlc3MtaW50ZWdlcj5cbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIGIgPSBjb25zdW1lQi5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIC8vICcrJz8gbi0gPHNpZ25sZXNzLWludGVnZXI+XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICBleHBlY3RDaGFyQ29kZS5jYWxsKHRoaXMsIDEsIEhZUEhFTk1JTlVTJDEpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcblxuICAgICAgICAgICAgICAgICAgICBjaGVja1Rva2VuSXNJbnRlZ2VyLmNhbGwodGhpcywgRElTQUxMT1dfU0lHTik7XG5cbiAgICAgICAgICAgICAgICAgICAgYiA9ICctJyArIHRoaXMuY29uc3VtZShOVU1CRVIkMyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgLy8gJysnPyA8bmRhc2hkaWdpdC1pZGVudD5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBleHBlY3RDaGFyQ29kZS5jYWxsKHRoaXMsIDEsIEhZUEhFTk1JTlVTJDEpO1xuICAgICAgICAgICAgICAgICAgICBjaGVja0ludGVnZXIuY2FsbCh0aGlzLCAyLCBESVNBTExPV19TSUdOKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcblxuICAgICAgICAgICAgICAgICAgICBiID0gdGhpcy5zY2FubmVyLnN1YnN0clRvQ3Vyc29yKHN0YXJ0ICsgc2lnbiArIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gPG5kYXNoZGlnaXQtZGltZW5zaW9uPlxuICAgICAgICAvLyA8bmRhc2gtZGltZW5zaW9uPiA8c2lnbmxlc3MtaW50ZWdlcj5cbiAgICAgICAgLy8gPG4tZGltZW5zaW9uPlxuICAgICAgICAvLyA8bi1kaW1lbnNpb24+IDxzaWduZWQtaW50ZWdlcj5cbiAgICAgICAgLy8gPG4tZGltZW5zaW9uPiBbJysnIHwgJy0nXSA8c2lnbmxlc3MtaW50ZWdlcj5cbiAgICAgICAgZWxzZSBpZiAodGhpcy5zY2FubmVyLnRva2VuVHlwZSA9PT0gRElNRU5TSU9OJDIpIHtcbiAgICAgICAgICAgIHZhciBjb2RlID0gdGhpcy5zY2FubmVyLnNvdXJjZS5jaGFyQ29kZUF0KHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KTtcbiAgICAgICAgICAgIHZhciBzaWduID0gY29kZSA9PT0gUExVU1NJR04kMiB8fCBjb2RlID09PSBIWVBIRU5NSU5VUyQxO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQgKyBzaWduOyBpIDwgdGhpcy5zY2FubmVyLnRva2VuRW5kOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzRGlnaXQkMih0aGlzLnNjYW5uZXIuc291cmNlLmNoYXJDb2RlQXQoaSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGkgPT09IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0ICsgc2lnbikge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0ludGVnZXIgaXMgZXhwZWN0ZWQnLCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCArIHNpZ24pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBleHBlY3RDaGFyQ29kZS5jYWxsKHRoaXMsIGkgLSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCwgTiQxKTtcbiAgICAgICAgICAgIGEgPSB0aGlzLnNjYW5uZXIuc291cmNlLnN1YnN0cmluZyhzdGFydCwgaSk7XG5cbiAgICAgICAgICAgIC8vIDxuLWRpbWVuc2lvbj5cbiAgICAgICAgICAgIC8vIDxuLWRpbWVuc2lvbj4gPHNpZ25lZC1pbnRlZ2VyPlxuICAgICAgICAgICAgLy8gPG4tZGltZW5zaW9uPiBbJysnIHwgJy0nXSA8c2lnbmxlc3MtaW50ZWdlcj5cbiAgICAgICAgICAgIGlmIChpICsgMSA9PT0gdGhpcy5zY2FubmVyLnRva2VuRW5kKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICBiID0gY29uc3VtZUIuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0Q2hhckNvZGUuY2FsbCh0aGlzLCBpIC0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQgKyAxLCBIWVBIRU5NSU5VUyQxKTtcblxuICAgICAgICAgICAgICAgIC8vIDxuZGFzaC1kaW1lbnNpb24+IDxzaWdubGVzcy1pbnRlZ2VyPlxuICAgICAgICAgICAgICAgIGlmIChpICsgMiA9PT0gdGhpcy5zY2FubmVyLnRva2VuRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tUb2tlbklzSW50ZWdlci5jYWxsKHRoaXMsIERJU0FMTE9XX1NJR04pO1xuICAgICAgICAgICAgICAgICAgICBiID0gJy0nICsgdGhpcy5jb25zdW1lKE5VTUJFUiQzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gPG5kYXNoZGlnaXQtZGltZW5zaW9uPlxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjaGVja0ludGVnZXIuY2FsbCh0aGlzLCBpIC0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQgKyAyLCBESVNBTExPV19TSUdOKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMuc2Nhbm5lci5zdWJzdHJUb0N1cnNvcihpICsgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lcnJvcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGEgIT09IG51bGwgJiYgYS5jaGFyQ29kZUF0KDApID09PSBQTFVTU0lHTiQyKSB7XG4gICAgICAgICAgICBhID0gYS5zdWJzdHIoMSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYiAhPT0gbnVsbCAmJiBiLmNoYXJDb2RlQXQoMCkgPT09IFBMVVNTSUdOJDIpIHtcbiAgICAgICAgICAgIGIgPSBiLnN1YnN0cigxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnQW5QbHVzQicsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KSxcbiAgICAgICAgICAgIGE6IGEsXG4gICAgICAgICAgICBiOiBiXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB2YXIgYSA9IG5vZGUuYSAhPT0gbnVsbCAmJiBub2RlLmEgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIGIgPSBub2RlLmIgIT09IG51bGwgJiYgbm9kZS5iICE9PSB1bmRlZmluZWQ7XG5cbiAgICAgICAgaWYgKGEpIHtcbiAgICAgICAgICAgIHRoaXMuY2h1bmsoXG4gICAgICAgICAgICAgICAgbm9kZS5hID09PSAnKzEnID8gJytuJyA6IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgb3BlcmF0b3ItbGluZWJyZWFrLCBpbmRlbnRcbiAgICAgICAgICAgICAgICBub2RlLmEgPT09ICAnMScgPyAgJ24nIDogLy8gZXNsaW50LWRpc2FibGUtbGluZSBvcGVyYXRvci1saW5lYnJlYWssIGluZGVudFxuICAgICAgICAgICAgICAgIG5vZGUuYSA9PT0gJy0xJyA/ICctbicgOiAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG9wZXJhdG9yLWxpbmVicmVhaywgaW5kZW50XG4gICAgICAgICAgICAgICAgbm9kZS5hICsgJ24nICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgb3BlcmF0b3ItbGluZWJyZWFrLCBpbmRlbnRcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChiKSB7XG4gICAgICAgICAgICAgICAgYiA9IFN0cmluZyhub2RlLmIpO1xuICAgICAgICAgICAgICAgIGlmIChiLmNoYXJBdCgwKSA9PT0gJy0nIHx8IGIuY2hhckF0KDApID09PSAnKycpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaHVuayhiLmNoYXJBdCgwKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2h1bmsoYi5zdWJzdHIoMSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2h1bmsoJysnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaHVuayhiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNodW5rKFN0cmluZyhub2RlLmIpKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbnZhciBUWVBFJGMgPSB0b2tlbml6ZXIuVFlQRTtcbnZhciByYXdNb2RlJDEgPSBSYXcubW9kZTtcblxudmFyIEFUS0VZV09SRCA9IFRZUEUkYy5BdEtleXdvcmQ7XG52YXIgU0VNSUNPTE9OID0gVFlQRSRjLlNlbWljb2xvbjtcbnZhciBMRUZUQ1VSTFlCUkFDS0VUID0gVFlQRSRjLkxlZnRDdXJseUJyYWNrZXQ7XG52YXIgUklHSFRDVVJMWUJSQUNLRVQgPSBUWVBFJGMuUmlnaHRDdXJseUJyYWNrZXQ7XG5cbmZ1bmN0aW9uIGNvbnN1bWVSYXckMShzdGFydFRva2VuKSB7XG4gICAgcmV0dXJuIHRoaXMuUmF3KHN0YXJ0VG9rZW4sIHJhd01vZGUkMS5sZWZ0Q3VybHlCcmFja2V0T3JTZW1pY29sb24sIHRydWUpO1xufVxuXG5mdW5jdGlvbiBpc0RlY2xhcmF0aW9uQmxvY2tBdHJ1bGUoKSB7XG4gICAgZm9yICh2YXIgb2Zmc2V0ID0gMSwgdHlwZTsgdHlwZSA9IHRoaXMuc2Nhbm5lci5sb29rdXBUeXBlKG9mZnNldCk7IG9mZnNldCsrKSB7XG4gICAgICAgIGlmICh0eXBlID09PSBSSUdIVENVUkxZQlJBQ0tFVCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZSA9PT0gTEVGVENVUkxZQlJBQ0tFVCB8fFxuICAgICAgICAgICAgdHlwZSA9PT0gQVRLRVlXT1JEKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbnZhciBBdHJ1bGUgPSB7XG4gICAgbmFtZTogJ0F0cnVsZScsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIG5hbWU6IFN0cmluZyxcbiAgICAgICAgcHJlbHVkZTogWydBdHJ1bGVQcmVsdWRlJywgJ1JhdycsIG51bGxdLFxuICAgICAgICBibG9jazogWydCbG9jaycsIG51bGxdXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuICAgICAgICB2YXIgbmFtZTtcbiAgICAgICAgdmFyIG5hbWVMb3dlckNhc2U7XG4gICAgICAgIHZhciBwcmVsdWRlID0gbnVsbDtcbiAgICAgICAgdmFyIGJsb2NrID0gbnVsbDtcblxuICAgICAgICB0aGlzLmVhdChBVEtFWVdPUkQpO1xuXG4gICAgICAgIG5hbWUgPSB0aGlzLnNjYW5uZXIuc3Vic3RyVG9DdXJzb3Ioc3RhcnQgKyAxKTtcbiAgICAgICAgbmFtZUxvd2VyQ2FzZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuXG4gICAgICAgIC8vIHBhcnNlIHByZWx1ZGVcbiAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci5lb2YgPT09IGZhbHNlICYmXG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIudG9rZW5UeXBlICE9PSBMRUZUQ1VSTFlCUkFDS0VUICYmXG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIudG9rZW5UeXBlICE9PSBTRU1JQ09MT04pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcnNlQXRydWxlUHJlbHVkZSkge1xuICAgICAgICAgICAgICAgIHByZWx1ZGUgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuQXRydWxlUHJlbHVkZS5iaW5kKHRoaXMsIG5hbWUpLCBjb25zdW1lUmF3JDEpO1xuXG4gICAgICAgICAgICAgICAgLy8gdHVybiBlbXB0eSBBdHJ1bGVQcmVsdWRlIGludG8gbnVsbFxuICAgICAgICAgICAgICAgIGlmIChwcmVsdWRlLnR5cGUgPT09ICdBdHJ1bGVQcmVsdWRlJyAmJiBwcmVsdWRlLmNoaWxkcmVuLmhlYWQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJlbHVkZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwcmVsdWRlID0gY29uc3VtZVJhdyQxLmNhbGwodGhpcywgdGhpcy5zY2FubmVyLnRva2VuSW5kZXgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKHRoaXMuc2Nhbm5lci50b2tlblR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgU0VNSUNPTE9OOlxuICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgTEVGVENVUkxZQlJBQ0tFVDpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hdHJ1bGUuaGFzT3duUHJvcGVydHkobmFtZUxvd2VyQ2FzZSkgJiZcbiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHRoaXMuYXRydWxlW25hbWVMb3dlckNhc2VdLmJsb2NrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrID0gdGhpcy5hdHJ1bGVbbmFtZUxvd2VyQ2FzZV0uYmxvY2suY2FsbCh0aGlzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBzaG91bGQgY29uc3VtZSBibG9jayBjb250ZW50IGFzIFJhdz9cbiAgICAgICAgICAgICAgICAgICAgYmxvY2sgPSB0aGlzLkJsb2NrKGlzRGVjbGFyYXRpb25CbG9ja0F0cnVsZS5jYWxsKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnQXRydWxlJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQpLFxuICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgIHByZWx1ZGU6IHByZWx1ZGUsXG4gICAgICAgICAgICBibG9jazogYmxvY2tcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2h1bmsoJ0AnKTtcbiAgICAgICAgdGhpcy5jaHVuayhub2RlLm5hbWUpO1xuXG4gICAgICAgIGlmIChub2RlLnByZWx1ZGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuY2h1bmsoJyAnKTtcbiAgICAgICAgICAgIHRoaXMubm9kZShub2RlLnByZWx1ZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vZGUuYmxvY2spIHtcbiAgICAgICAgICAgIHRoaXMubm9kZShub2RlLmJsb2NrKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2h1bmsoJzsnKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgd2Fsa0NvbnRleHQ6ICdhdHJ1bGUnXG59O1xuXG52YXIgVFlQRSRkID0gdG9rZW5pemVyLlRZUEU7XG5cbnZhciBTRU1JQ09MT04kMSA9IFRZUEUkZC5TZW1pY29sb247XG52YXIgTEVGVENVUkxZQlJBQ0tFVCQxID0gVFlQRSRkLkxlZnRDdXJseUJyYWNrZXQ7XG5cbnZhciBBdHJ1bGVQcmVsdWRlID0ge1xuICAgIG5hbWU6ICdBdHJ1bGVQcmVsdWRlJyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgY2hpbGRyZW46IFtbXV1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9IG51bGw7XG5cbiAgICAgICAgaWYgKG5hbWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuYXRydWxlLmhhc093blByb3BlcnR5KG5hbWUpICYmXG4gICAgICAgICAgICB0eXBlb2YgdGhpcy5hdHJ1bGVbbmFtZV0ucHJlbHVkZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgLy8gY3VzdG9tIGNvbnN1bWVyXG4gICAgICAgICAgICBjaGlsZHJlbiA9IHRoaXMuYXRydWxlW25hbWVdLnByZWx1ZGUuY2FsbCh0aGlzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGRlZmF1bHQgY29uc3VtZXJcbiAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5yZWFkU2VxdWVuY2UodGhpcy5zY29wZS5BdHJ1bGVQcmVsdWRlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcblxuICAgICAgICBpZiAodGhpcy5zY2FubmVyLmVvZiAhPT0gdHJ1ZSAmJlxuICAgICAgICAgICAgdGhpcy5zY2FubmVyLnRva2VuVHlwZSAhPT0gTEVGVENVUkxZQlJBQ0tFVCQxICYmXG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIudG9rZW5UeXBlICE9PSBTRU1JQ09MT04kMSkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcignU2VtaWNvbG9uIG9yIGJsb2NrIGlzIGV4cGVjdGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2hpbGRyZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0F0cnVsZVByZWx1ZGUnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uRnJvbUxpc3QoY2hpbGRyZW4pLFxuICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNoaWxkcmVuKG5vZGUpO1xuICAgIH0sXG4gICAgd2Fsa0NvbnRleHQ6ICdhdHJ1bGVQcmVsdWRlJ1xufTtcblxudmFyIFRZUEUkZSA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgSURFTlQkNiA9IFRZUEUkZS5JZGVudDtcbnZhciBTVFJJTkckMiA9IFRZUEUkZS5TdHJpbmc7XG52YXIgQ09MT04kMiA9IFRZUEUkZS5Db2xvbjtcbnZhciBMRUZUU1FVQVJFQlJBQ0tFVCQyID0gVFlQRSRlLkxlZnRTcXVhcmVCcmFja2V0O1xudmFyIFJJR0hUU1FVQVJFQlJBQ0tFVCA9IFRZUEUkZS5SaWdodFNxdWFyZUJyYWNrZXQ7XG52YXIgRE9MTEFSU0lHTiA9IDB4MDAyNDsgICAgICAgLy8gVSswMDI0IERPTExBUiBTSUdOICgkKVxudmFyIEFTVEVSSVNLJDIgPSAweDAwMkE7ICAgICAgICAgLy8gVSswMDJBIEFTVEVSSVNLICgqKVxudmFyIEVRVUFMU1NJR04gPSAweDAwM0Q7ICAgICAgIC8vIFUrMDAzRCBFUVVBTFMgU0lHTiAoPSlcbnZhciBDSVJDVU1GTEVYQUNDRU5UID0gMHgwMDVFOyAvLyBVKzAwNUUgKF4pXG52YXIgVkVSVElDQUxMSU5FJDEgPSAweDAwN0M7ICAgICAvLyBVKzAwN0MgVkVSVElDQUwgTElORSAofClcbnZhciBUSUxERSQxID0gMHgwMDdFOyAgICAgICAgICAgIC8vIFUrMDA3RSBUSUxERSAofilcblxuZnVuY3Rpb24gZ2V0QXR0cmlidXRlTmFtZSgpIHtcbiAgICBpZiAodGhpcy5zY2FubmVyLmVvZikge1xuICAgICAgICB0aGlzLmVycm9yKCdVbmV4cGVjdGVkIGVuZCBvZiBpbnB1dCcpO1xuICAgIH1cblxuICAgIHZhciBzdGFydCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuICAgIHZhciBleHBlY3RJZGVudCA9IGZhbHNlO1xuICAgIHZhciBjaGVja0NvbG9uID0gdHJ1ZTtcblxuICAgIGlmICh0aGlzLnNjYW5uZXIuaXNEZWxpbShBU1RFUklTSyQyKSkge1xuICAgICAgICBleHBlY3RJZGVudCA9IHRydWU7XG4gICAgICAgIGNoZWNrQ29sb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLnNjYW5uZXIuaXNEZWxpbShWRVJUSUNBTExJTkUkMSkpIHtcbiAgICAgICAgdGhpcy5lYXQoSURFTlQkNik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2Nhbm5lci5pc0RlbGltKFZFUlRJQ0FMTElORSQxKSkge1xuICAgICAgICBpZiAodGhpcy5zY2FubmVyLnNvdXJjZS5jaGFyQ29kZUF0KHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0ICsgMSkgIT09IEVRVUFMU1NJR04pIHtcbiAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICB0aGlzLmVhdChJREVOVCQ2KTtcbiAgICAgICAgfSBlbHNlIGlmIChleHBlY3RJZGVudCkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcignSWRlbnRpZmllciBpcyBleHBlY3RlZCcsIHRoaXMuc2Nhbm5lci50b2tlbkVuZCk7XG4gICAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGV4cGVjdElkZW50KSB7XG4gICAgICAgIHRoaXMuZXJyb3IoJ1ZlcnRpY2FsIGxpbmUgaXMgZXhwZWN0ZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoY2hlY2tDb2xvbiAmJiB0aGlzLnNjYW5uZXIudG9rZW5UeXBlID09PSBDT0xPTiQyKSB7XG4gICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgIHRoaXMuZWF0KElERU5UJDYpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdJZGVudGlmaWVyJyxcbiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgIG5hbWU6IHRoaXMuc2Nhbm5lci5zdWJzdHJUb0N1cnNvcihzdGFydClcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBnZXRPcGVyYXRvcigpIHtcbiAgICB2YXIgc3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcbiAgICB2YXIgY29kZSA9IHRoaXMuc2Nhbm5lci5zb3VyY2UuY2hhckNvZGVBdChzdGFydCk7XG5cbiAgICBpZiAoY29kZSAhPT0gRVFVQUxTU0lHTiAmJiAgICAgICAgLy8gPVxuICAgICAgICBjb2RlICE9PSBUSUxERSQxICYmICAgICAgICAgICAgIC8vIH49XG4gICAgICAgIGNvZGUgIT09IENJUkNVTUZMRVhBQ0NFTlQgJiYgIC8vIF49XG4gICAgICAgIGNvZGUgIT09IERPTExBUlNJR04gJiYgICAgICAgIC8vICQ9XG4gICAgICAgIGNvZGUgIT09IEFTVEVSSVNLJDIgJiYgICAgICAgICAgLy8gKj1cbiAgICAgICAgY29kZSAhPT0gVkVSVElDQUxMSU5FJDEgICAgICAgICAvLyB8PVxuICAgICkge1xuICAgICAgICB0aGlzLmVycm9yKCdBdHRyaWJ1dGUgc2VsZWN0b3IgKD0sIH49LCBePSwgJD0sICo9LCB8PSkgaXMgZXhwZWN0ZWQnKTtcbiAgICB9XG5cbiAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuXG4gICAgaWYgKGNvZGUgIT09IEVRVUFMU1NJR04pIHtcbiAgICAgICAgaWYgKCF0aGlzLnNjYW5uZXIuaXNEZWxpbShFUVVBTFNTSUdOKSkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcignRXF1YWwgc2lnbiBpcyBleHBlY3RlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5zY2FubmVyLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KTtcbn1cblxuLy8gJ1snIDx3cS1uYW1lPiAnXSdcbi8vICdbJyA8d3EtbmFtZT4gPGF0dHItbWF0Y2hlcj4gWyA8c3RyaW5nLXRva2VuPiB8IDxpZGVudC10b2tlbj4gXSA8YXR0ci1tb2RpZmllcj4/ICddJ1xudmFyIEF0dHJpYnV0ZVNlbGVjdG9yID0ge1xuICAgIG5hbWU6ICdBdHRyaWJ1dGVTZWxlY3RvcicsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIG5hbWU6ICdJZGVudGlmaWVyJyxcbiAgICAgICAgbWF0Y2hlcjogW1N0cmluZywgbnVsbF0sXG4gICAgICAgIHZhbHVlOiBbJ1N0cmluZycsICdJZGVudGlmaWVyJywgbnVsbF0sXG4gICAgICAgIGZsYWdzOiBbU3RyaW5nLCBudWxsXVxuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcbiAgICAgICAgdmFyIG5hbWU7XG4gICAgICAgIHZhciBtYXRjaGVyID0gbnVsbDtcbiAgICAgICAgdmFyIHZhbHVlID0gbnVsbDtcbiAgICAgICAgdmFyIGZsYWdzID0gbnVsbDtcblxuICAgICAgICB0aGlzLmVhdChMRUZUU1FVQVJFQlJBQ0tFVCQyKTtcbiAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuXG4gICAgICAgIG5hbWUgPSBnZXRBdHRyaWJ1dGVOYW1lLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcblxuICAgICAgICBpZiAodGhpcy5zY2FubmVyLnRva2VuVHlwZSAhPT0gUklHSFRTUVVBUkVCUkFDS0VUKSB7XG4gICAgICAgICAgICAvLyBhdm9pZCBjYXNlIGBbbmFtZSBpXWBcbiAgICAgICAgICAgIGlmICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlICE9PSBJREVOVCQ2KSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hlciA9IGdldE9wZXJhdG9yLmNhbGwodGhpcyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG5cbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuc2Nhbm5lci50b2tlblR5cGUgPT09IFNUUklORyQyXG4gICAgICAgICAgICAgICAgICAgID8gdGhpcy5TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICA6IHRoaXMuSWRlbnRpZmllcigpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBhdHRyaWJ1dGUgZmxhZ3NcbiAgICAgICAgICAgIGlmICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlID09PSBJREVOVCQ2KSB7XG4gICAgICAgICAgICAgICAgZmxhZ3MgPSB0aGlzLnNjYW5uZXIuZ2V0VG9rZW5WYWx1ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVhdChSSUdIVFNRVUFSRUJSQUNLRVQpO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnQXR0cmlidXRlU2VsZWN0b3InLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgbWF0Y2hlcjogbWF0Y2hlcixcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgIGZsYWdzOiBmbGFnc1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdmFyIGZsYWdzUHJlZml4ID0gJyAnO1xuXG4gICAgICAgIHRoaXMuY2h1bmsoJ1snKTtcbiAgICAgICAgdGhpcy5ub2RlKG5vZGUubmFtZSk7XG5cbiAgICAgICAgaWYgKG5vZGUubWF0Y2hlciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5jaHVuayhub2RlLm1hdGNoZXIpO1xuXG4gICAgICAgICAgICBpZiAobm9kZS52YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZShub2RlLnZhbHVlKTtcblxuICAgICAgICAgICAgICAgIC8vIHNwYWNlIGJldHdlZW4gc3RyaW5nIGFuZCBmbGFncyBpcyBub3QgcmVxdWlyZWRcbiAgICAgICAgICAgICAgICBpZiAobm9kZS52YWx1ZS50eXBlID09PSAnU3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBmbGFnc1ByZWZpeCA9ICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChub2RlLmZsYWdzICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmNodW5rKGZsYWdzUHJlZml4KTtcbiAgICAgICAgICAgIHRoaXMuY2h1bmsobm9kZS5mbGFncyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNodW5rKCddJyk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkZiA9IHRva2VuaXplci5UWVBFO1xudmFyIHJhd01vZGUkMiA9IFJhdy5tb2RlO1xuXG52YXIgV0hJVEVTUEFDRSQ2ID0gVFlQRSRmLldoaXRlU3BhY2U7XG52YXIgQ09NTUVOVCQ1ID0gVFlQRSRmLkNvbW1lbnQ7XG52YXIgU0VNSUNPTE9OJDIgPSBUWVBFJGYuU2VtaWNvbG9uO1xudmFyIEFUS0VZV09SRCQxID0gVFlQRSRmLkF0S2V5d29yZDtcbnZhciBMRUZUQ1VSTFlCUkFDS0VUJDIgPSBUWVBFJGYuTGVmdEN1cmx5QnJhY2tldDtcbnZhciBSSUdIVENVUkxZQlJBQ0tFVCQxID0gVFlQRSRmLlJpZ2h0Q3VybHlCcmFja2V0O1xuXG5mdW5jdGlvbiBjb25zdW1lUmF3JDIoc3RhcnRUb2tlbikge1xuICAgIHJldHVybiB0aGlzLlJhdyhzdGFydFRva2VuLCBudWxsLCB0cnVlKTtcbn1cbmZ1bmN0aW9uIGNvbnN1bWVSdWxlKCkge1xuICAgIHJldHVybiB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuUnVsZSwgY29uc3VtZVJhdyQyKTtcbn1cbmZ1bmN0aW9uIGNvbnN1bWVSYXdEZWNsYXJhdGlvbihzdGFydFRva2VuKSB7XG4gICAgcmV0dXJuIHRoaXMuUmF3KHN0YXJ0VG9rZW4sIHJhd01vZGUkMi5zZW1pY29sb25JbmNsdWRlZCwgdHJ1ZSk7XG59XG5mdW5jdGlvbiBjb25zdW1lRGVjbGFyYXRpb24oKSB7XG4gICAgaWYgKHRoaXMuc2Nhbm5lci50b2tlblR5cGUgPT09IFNFTUlDT0xPTiQyKSB7XG4gICAgICAgIHJldHVybiBjb25zdW1lUmF3RGVjbGFyYXRpb24uY2FsbCh0aGlzLCB0aGlzLnNjYW5uZXIudG9rZW5JbmRleCk7XG4gICAgfVxuXG4gICAgdmFyIG5vZGUgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuRGVjbGFyYXRpb24sIGNvbnN1bWVSYXdEZWNsYXJhdGlvbik7XG5cbiAgICBpZiAodGhpcy5zY2FubmVyLnRva2VuVHlwZSA9PT0gU0VNSUNPTE9OJDIpIHtcbiAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbm9kZTtcbn1cblxudmFyIEJsb2NrID0ge1xuICAgIG5hbWU6ICdCbG9jaycsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIGNoaWxkcmVuOiBbW1xuICAgICAgICAgICAgJ0F0cnVsZScsXG4gICAgICAgICAgICAnUnVsZScsXG4gICAgICAgICAgICAnRGVjbGFyYXRpb24nXG4gICAgICAgIF1dXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oaXNEZWNsYXJhdGlvbikge1xuICAgICAgICB2YXIgY29uc3VtZXIgPSBpc0RlY2xhcmF0aW9uID8gY29uc3VtZURlY2xhcmF0aW9uIDogY29uc3VtZVJ1bGU7XG5cbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY3JlYXRlTGlzdCgpO1xuXG4gICAgICAgIHRoaXMuZWF0KExFRlRDVVJMWUJSQUNLRVQkMik7XG5cbiAgICAgICAgc2NhbjpcbiAgICAgICAgd2hpbGUgKCF0aGlzLnNjYW5uZXIuZW9mKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc2Nhbm5lci50b2tlblR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFJJR0hUQ1VSTFlCUkFDS0VUJDE6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47XG5cbiAgICAgICAgICAgICAgICBjYXNlIFdISVRFU1BBQ0UkNjpcbiAgICAgICAgICAgICAgICBjYXNlIENPTU1FTlQkNTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIEFUS0VZV09SRCQxOlxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMucGFyc2VXaXRoRmFsbGJhY2sodGhpcy5BdHJ1bGUsIGNvbnN1bWVSYXckMikpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goY29uc3VtZXIuY2FsbCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuc2Nhbm5lci5lb2YpIHtcbiAgICAgICAgICAgIHRoaXMuZWF0KFJJR0hUQ1VSTFlCUkFDS0VUJDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdCbG9jaycsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuaygneycpO1xuICAgICAgICB0aGlzLmNoaWxkcmVuKG5vZGUsIGZ1bmN0aW9uKHByZXYpIHtcbiAgICAgICAgICAgIGlmIChwcmV2LnR5cGUgPT09ICdEZWNsYXJhdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNodW5rKCc7Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNodW5rKCd9Jyk7XG4gICAgfSxcbiAgICB3YWxrQ29udGV4dDogJ2Jsb2NrJ1xufTtcblxudmFyIFRZUEUkZyA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgTEVGVFNRVUFSRUJSQUNLRVQkMyA9IFRZUEUkZy5MZWZ0U3F1YXJlQnJhY2tldDtcbnZhciBSSUdIVFNRVUFSRUJSQUNLRVQkMSA9IFRZUEUkZy5SaWdodFNxdWFyZUJyYWNrZXQ7XG5cbnZhciBCcmFja2V0cyA9IHtcbiAgICBuYW1lOiAnQnJhY2tldHMnLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICBjaGlsZHJlbjogW1tdXVxuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKHJlYWRTZXF1ZW5jZSwgcmVjb2duaXplcikge1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gbnVsbDtcblxuICAgICAgICB0aGlzLmVhdChMRUZUU1FVQVJFQlJBQ0tFVCQzKTtcblxuICAgICAgICBjaGlsZHJlbiA9IHJlYWRTZXF1ZW5jZS5jYWxsKHRoaXMsIHJlY29nbml6ZXIpO1xuXG4gICAgICAgIGlmICghdGhpcy5zY2FubmVyLmVvZikge1xuICAgICAgICAgICAgdGhpcy5lYXQoUklHSFRTUVVBUkVCUkFDS0VUJDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdCcmFja2V0cycsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuaygnWycpO1xuICAgICAgICB0aGlzLmNoaWxkcmVuKG5vZGUpO1xuICAgICAgICB0aGlzLmNodW5rKCddJyk7XG4gICAgfVxufTtcblxudmFyIENEQyA9IHRva2VuaXplci5UWVBFLkNEQztcblxudmFyIENEQ18xID0ge1xuICAgIG5hbWU6ICdDREMnLFxuICAgIHN0cnVjdHVyZTogW10sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcblxuICAgICAgICB0aGlzLmVhdChDREMpOyAvLyAtLT5cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0NEQycsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmNodW5rKCctLT4nKTtcbiAgICB9XG59O1xuXG52YXIgQ0RPID0gdG9rZW5pemVyLlRZUEUuQ0RPO1xuXG52YXIgQ0RPXzEgPSB7XG4gICAgbmFtZTogJ0NETycsXG4gICAgc3RydWN0dXJlOiBbXSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuXG4gICAgICAgIHRoaXMuZWF0KENETyk7IC8vIDwhLS1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0NETycsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmNodW5rKCc8IS0tJyk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkaCA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgSURFTlQkNyA9IFRZUEUkaC5JZGVudDtcbnZhciBGVUxMU1RPUCQxID0gMHgwMDJFOyAvLyBVKzAwMkUgRlVMTCBTVE9QICguKVxuXG4vLyAnLicgaWRlbnRcbnZhciBDbGFzc1NlbGVjdG9yID0ge1xuICAgIG5hbWU6ICdDbGFzc1NlbGVjdG9yJyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgbmFtZTogU3RyaW5nXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghdGhpcy5zY2FubmVyLmlzRGVsaW0oRlVMTFNUT1AkMSkpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0Z1bGwgc3RvcCBpcyBleHBlY3RlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0NsYXNzU2VsZWN0b3InLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0IC0gMSwgdGhpcy5zY2FubmVyLnRva2VuRW5kKSxcbiAgICAgICAgICAgIG5hbWU6IHRoaXMuY29uc3VtZShJREVOVCQ3KVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuaygnLicpO1xuICAgICAgICB0aGlzLmNodW5rKG5vZGUubmFtZSk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkaSA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgSURFTlQkOCA9IFRZUEUkaS5JZGVudDtcbnZhciBQTFVTU0lHTiQzID0gMHgwMDJCOyAgICAgICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKylcbnZhciBTT0xJRFVTJDIgPSAweDAwMkY7ICAgICAgICAgLy8gVSswMDJGIFNPTElEVVMgKC8pXG52YXIgR1JFQVRFUlRIQU5TSUdOJDEgPSAweDAwM0U7IC8vIFUrMDAzRSBHUkVBVEVSLVRIQU4gU0lHTiAoPilcbnZhciBUSUxERSQyID0gMHgwMDdFOyAgICAgICAgICAgLy8gVSswMDdFIFRJTERFICh+KVxuXG4vLyArIHwgPiB8IH4gfCAvZGVlcC9cbnZhciBDb21iaW5hdG9yID0ge1xuICAgIG5hbWU6ICdDb21iaW5hdG9yJyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgbmFtZTogU3RyaW5nXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuICAgICAgICB2YXIgY29kZSA9IHRoaXMuc2Nhbm5lci5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLnNjYW5uZXIudG9rZW5TdGFydCk7XG5cbiAgICAgICAgc3dpdGNoIChjb2RlKSB7XG4gICAgICAgICAgICBjYXNlIEdSRUFURVJUSEFOU0lHTiQxOlxuICAgICAgICAgICAgY2FzZSBQTFVTU0lHTiQzOlxuICAgICAgICAgICAgY2FzZSBUSUxERSQyOlxuICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgU09MSURVUyQyOlxuICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zY2FubmVyLnRva2VuVHlwZSAhPT0gSURFTlQkOCB8fCB0aGlzLnNjYW5uZXIubG9va3VwVmFsdWUoMCwgJ2RlZXAnKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcignSWRlbnRpZmllciBgZGVlcGAgaXMgZXhwZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNjYW5uZXIuaXNEZWxpbShTT0xJRFVTJDIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1NvbGlkdXMgaXMgZXhwZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0NvbWJpbmF0b3IgaXMgZXhwZWN0ZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnQ29tYmluYXRvcicsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KSxcbiAgICAgICAgICAgIG5hbWU6IHRoaXMuc2Nhbm5lci5zdWJzdHJUb0N1cnNvcihzdGFydClcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2h1bmsobm9kZS5uYW1lKTtcbiAgICB9XG59O1xuXG52YXIgVFlQRSRqID0gdG9rZW5pemVyLlRZUEU7XG5cbnZhciBDT01NRU5UJDYgPSBUWVBFJGouQ29tbWVudDtcbnZhciBBU1RFUklTSyQzID0gMHgwMDJBOyAgICAgICAgLy8gVSswMDJBIEFTVEVSSVNLICgqKVxudmFyIFNPTElEVVMkMyA9IDB4MDAyRjsgICAgICAgICAvLyBVKzAwMkYgU09MSURVUyAoLylcblxuLy8gJy8qJyAuKiAnKi8nXG52YXIgQ29tbWVudCA9IHtcbiAgICBuYW1lOiAnQ29tbWVudCcsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIHZhbHVlOiBTdHJpbmdcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG4gICAgICAgIHZhciBlbmQgPSB0aGlzLnNjYW5uZXIudG9rZW5FbmQ7XG5cbiAgICAgICAgdGhpcy5lYXQoQ09NTUVOVCQ2KTtcblxuICAgICAgICBpZiAoKGVuZCAtIHN0YXJ0ICsgMikgPj0gMiAmJlxuICAgICAgICAgICAgdGhpcy5zY2FubmVyLnNvdXJjZS5jaGFyQ29kZUF0KGVuZCAtIDIpID09PSBBU1RFUklTSyQzICYmXG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIuc291cmNlLmNoYXJDb2RlQXQoZW5kIC0gMSkgPT09IFNPTElEVVMkMykge1xuICAgICAgICAgICAgZW5kIC09IDI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0NvbW1lbnQnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5zY2FubmVyLnNvdXJjZS5zdWJzdHJpbmcoc3RhcnQgKyAyLCBlbmQpXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNodW5rKCcvKicpO1xuICAgICAgICB0aGlzLmNodW5rKG5vZGUudmFsdWUpO1xuICAgICAgICB0aGlzLmNodW5rKCcqLycpO1xuICAgIH1cbn07XG5cbnZhciBoYXNPd25Qcm9wZXJ0eSQxID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcbnZhciBrZXl3b3JkcyQyID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbnZhciBwcm9wZXJ0aWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbnZhciBIWVBIRU5NSU5VUyQyID0gNDU7IC8vICctJy5jaGFyQ29kZUF0KClcblxuZnVuY3Rpb24gaXNDdXN0b21Qcm9wZXJ0eShzdHIsIG9mZnNldCkge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCAwO1xuXG4gICAgcmV0dXJuIHN0ci5sZW5ndGggLSBvZmZzZXQgPj0gMiAmJlxuICAgICAgICAgICBzdHIuY2hhckNvZGVBdChvZmZzZXQpID09PSBIWVBIRU5NSU5VUyQyICYmXG4gICAgICAgICAgIHN0ci5jaGFyQ29kZUF0KG9mZnNldCArIDEpID09PSBIWVBIRU5NSU5VUyQyO1xufVxuXG5mdW5jdGlvbiBnZXRWZW5kb3JQcmVmaXgoc3RyLCBvZmZzZXQpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfHwgMDtcblxuICAgIC8vIHZlcmRvciBwcmVmaXggc2hvdWxkIGJlIGF0IGxlYXN0IDMgY2hhcnMgbGVuZ3RoXG4gICAgaWYgKHN0ci5sZW5ndGggLSBvZmZzZXQgPj0gMykge1xuICAgICAgICAvLyB2ZW5kb3IgcHJlZml4IHN0YXJ0cyB3aXRoIGh5cGVyIG1pbnVzIGZvbGxvd2luZyBub24taHlwZXIgbWludXNcbiAgICAgICAgaWYgKHN0ci5jaGFyQ29kZUF0KG9mZnNldCkgPT09IEhZUEhFTk1JTlVTJDIgJiZcbiAgICAgICAgICAgIHN0ci5jaGFyQ29kZUF0KG9mZnNldCArIDEpICE9PSBIWVBIRU5NSU5VUyQyKSB7XG4gICAgICAgICAgICAvLyB2ZW5kb3IgcHJlZml4IHNob3VsZCBjb250YWluIGEgaHlwZXIgbWludXMgYXQgdGhlIGVuZGluZ1xuICAgICAgICAgICAgdmFyIHNlY29uZERhc2hJbmRleCA9IHN0ci5pbmRleE9mKCctJywgb2Zmc2V0ICsgMik7XG5cbiAgICAgICAgICAgIGlmIChzZWNvbmREYXNoSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcob2Zmc2V0LCBzZWNvbmREYXNoSW5kZXggKyAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAnJztcbn1cblxuZnVuY3Rpb24gZ2V0S2V5d29yZERlc2NyaXB0b3Ioa2V5d29yZCkge1xuICAgIGlmIChoYXNPd25Qcm9wZXJ0eSQxLmNhbGwoa2V5d29yZHMkMiwga2V5d29yZCkpIHtcbiAgICAgICAgcmV0dXJuIGtleXdvcmRzJDJba2V5d29yZF07XG4gICAgfVxuXG4gICAgdmFyIG5hbWUgPSBrZXl3b3JkLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBpZiAoaGFzT3duUHJvcGVydHkkMS5jYWxsKGtleXdvcmRzJDIsIG5hbWUpKSB7XG4gICAgICAgIHJldHVybiBrZXl3b3JkcyQyW2tleXdvcmRdID0ga2V5d29yZHMkMltuYW1lXTtcbiAgICB9XG5cbiAgICB2YXIgY3VzdG9tID0gaXNDdXN0b21Qcm9wZXJ0eShuYW1lLCAwKTtcbiAgICB2YXIgdmVuZG9yID0gIWN1c3RvbSA/IGdldFZlbmRvclByZWZpeChuYW1lLCAwKSA6ICcnO1xuXG4gICAgcmV0dXJuIGtleXdvcmRzJDJba2V5d29yZF0gPSBPYmplY3QuZnJlZXplKHtcbiAgICAgICAgYmFzZW5hbWU6IG5hbWUuc3Vic3RyKHZlbmRvci5sZW5ndGgpLFxuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICB2ZW5kb3I6IHZlbmRvcixcbiAgICAgICAgcHJlZml4OiB2ZW5kb3IsXG4gICAgICAgIGN1c3RvbTogY3VzdG9tXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldFByb3BlcnR5RGVzY3JpcHRvcihwcm9wZXJ0eSkge1xuICAgIGlmIChoYXNPd25Qcm9wZXJ0eSQxLmNhbGwocHJvcGVydGllcywgcHJvcGVydHkpKSB7XG4gICAgICAgIHJldHVybiBwcm9wZXJ0aWVzW3Byb3BlcnR5XTtcbiAgICB9XG5cbiAgICB2YXIgbmFtZSA9IHByb3BlcnR5O1xuICAgIHZhciBoYWNrID0gcHJvcGVydHlbMF07XG5cbiAgICBpZiAoaGFjayA9PT0gJy8nKSB7XG4gICAgICAgIGhhY2sgPSBwcm9wZXJ0eVsxXSA9PT0gJy8nID8gJy8vJyA6ICcvJztcbiAgICB9IGVsc2UgaWYgKGhhY2sgIT09ICdfJyAmJlxuICAgICAgICAgICAgICAgaGFjayAhPT0gJyonICYmXG4gICAgICAgICAgICAgICBoYWNrICE9PSAnJCcgJiZcbiAgICAgICAgICAgICAgIGhhY2sgIT09ICcjJyAmJlxuICAgICAgICAgICAgICAgaGFjayAhPT0gJysnICYmXG4gICAgICAgICAgICAgICBoYWNrICE9PSAnJicpIHtcbiAgICAgICAgaGFjayA9ICcnO1xuICAgIH1cblxuICAgIHZhciBjdXN0b20gPSBpc0N1c3RvbVByb3BlcnR5KG5hbWUsIGhhY2subGVuZ3RoKTtcblxuICAgIC8vIHJlLXVzZSByZXN1bHQgd2hlbiBwb3NzaWJsZSAodGhlIHNhbWUgYXMgZm9yIGxvd2VyIGNhc2UpXG4gICAgaWYgKCFjdXN0b20pIHtcbiAgICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5JDEuY2FsbChwcm9wZXJ0aWVzLCBuYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuIHByb3BlcnRpZXNbcHJvcGVydHldID0gcHJvcGVydGllc1tuYW1lXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciB2ZW5kb3IgPSAhY3VzdG9tID8gZ2V0VmVuZG9yUHJlZml4KG5hbWUsIGhhY2subGVuZ3RoKSA6ICcnO1xuICAgIHZhciBwcmVmaXggPSBuYW1lLnN1YnN0cigwLCBoYWNrLmxlbmd0aCArIHZlbmRvci5sZW5ndGgpO1xuXG4gICAgcmV0dXJuIHByb3BlcnRpZXNbcHJvcGVydHldID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIGJhc2VuYW1lOiBuYW1lLnN1YnN0cihwcmVmaXgubGVuZ3RoKSxcbiAgICAgICAgbmFtZTogbmFtZS5zdWJzdHIoaGFjay5sZW5ndGgpLFxuICAgICAgICBoYWNrOiBoYWNrLFxuICAgICAgICB2ZW5kb3I6IHZlbmRvcixcbiAgICAgICAgcHJlZml4OiBwcmVmaXgsXG4gICAgICAgIGN1c3RvbTogY3VzdG9tXG4gICAgfSk7XG59XG5cbnZhciBuYW1lcyA9IHtcbiAgICBrZXl3b3JkOiBnZXRLZXl3b3JkRGVzY3JpcHRvcixcbiAgICBwcm9wZXJ0eTogZ2V0UHJvcGVydHlEZXNjcmlwdG9yLFxuICAgIGlzQ3VzdG9tUHJvcGVydHk6IGlzQ3VzdG9tUHJvcGVydHksXG4gICAgdmVuZG9yUHJlZml4OiBnZXRWZW5kb3JQcmVmaXhcbn07XG5cbnZhciBpc0N1c3RvbVByb3BlcnR5JDEgPSBuYW1lcy5pc0N1c3RvbVByb3BlcnR5O1xudmFyIFRZUEUkayA9IHRva2VuaXplci5UWVBFO1xudmFyIHJhd01vZGUkMyA9IFJhdy5tb2RlO1xuXG52YXIgSURFTlQkOSA9IFRZUEUkay5JZGVudDtcbnZhciBIQVNIJDMgPSBUWVBFJGsuSGFzaDtcbnZhciBDT0xPTiQzID0gVFlQRSRrLkNvbG9uO1xudmFyIFNFTUlDT0xPTiQzID0gVFlQRSRrLlNlbWljb2xvbjtcbnZhciBERUxJTSQyID0gVFlQRSRrLkRlbGltO1xudmFyIFdISVRFU1BBQ0UkNyA9IFRZUEUkay5XaGl0ZVNwYWNlO1xudmFyIEVYQ0xBTUFUSU9OTUFSSyQxID0gMHgwMDIxOyAvLyBVKzAwMjEgRVhDTEFNQVRJT04gTUFSSyAoISlcbnZhciBOVU1CRVJTSUdOJDMgPSAweDAwMjM7ICAgICAgLy8gVSswMDIzIE5VTUJFUiBTSUdOICgjKVxudmFyIERPTExBUlNJR04kMSA9IDB4MDAyNDsgICAgICAvLyBVKzAwMjQgRE9MTEFSIFNJR04gKCQpXG52YXIgQU1QRVJTQU5EID0gMHgwMDI2OyAgICAgICAvLyBVKzAwMjYgQU5QRVJTQU5EICgmKVxudmFyIEFTVEVSSVNLJDQgPSAweDAwMkE7ICAgICAgICAvLyBVKzAwMkEgQVNURVJJU0sgKCopXG52YXIgUExVU1NJR04kNCA9IDB4MDAyQjsgICAgICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspXG52YXIgU09MSURVUyQ0ID0gMHgwMDJGOyAgICAgICAgIC8vIFUrMDAyRiBTT0xJRFVTICgvKVxuXG5mdW5jdGlvbiBjb25zdW1lVmFsdWVSYXcoc3RhcnRUb2tlbikge1xuICAgIHJldHVybiB0aGlzLlJhdyhzdGFydFRva2VuLCByYXdNb2RlJDMuZXhjbGFtYXRpb25NYXJrT3JTZW1pY29sb24sIHRydWUpO1xufVxuXG5mdW5jdGlvbiBjb25zdW1lQ3VzdG9tUHJvcGVydHlSYXcoc3RhcnRUb2tlbikge1xuICAgIHJldHVybiB0aGlzLlJhdyhzdGFydFRva2VuLCByYXdNb2RlJDMuZXhjbGFtYXRpb25NYXJrT3JTZW1pY29sb24sIGZhbHNlKTtcbn1cblxuZnVuY3Rpb24gY29uc3VtZVZhbHVlKCkge1xuICAgIHZhciBzdGFydFZhbHVlVG9rZW4gPSB0aGlzLnNjYW5uZXIudG9rZW5JbmRleDtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLlZhbHVlKCk7XG5cbiAgICBpZiAodmFsdWUudHlwZSAhPT0gJ1JhdycgJiZcbiAgICAgICAgdGhpcy5zY2FubmVyLmVvZiA9PT0gZmFsc2UgJiZcbiAgICAgICAgdGhpcy5zY2FubmVyLnRva2VuVHlwZSAhPT0gU0VNSUNPTE9OJDMgJiZcbiAgICAgICAgdGhpcy5zY2FubmVyLmlzRGVsaW0oRVhDTEFNQVRJT05NQVJLJDEpID09PSBmYWxzZSAmJlxuICAgICAgICB0aGlzLnNjYW5uZXIuaXNCYWxhbmNlRWRnZShzdGFydFZhbHVlVG9rZW4pID09PSBmYWxzZSkge1xuICAgICAgICB0aGlzLmVycm9yKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xufVxuXG52YXIgRGVjbGFyYXRpb24gPSB7XG4gICAgbmFtZTogJ0RlY2xhcmF0aW9uJyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgaW1wb3J0YW50OiBbQm9vbGVhbiwgU3RyaW5nXSxcbiAgICAgICAgcHJvcGVydHk6IFN0cmluZyxcbiAgICAgICAgdmFsdWU6IFsnVmFsdWUnLCAnUmF3J11cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG4gICAgICAgIHZhciBzdGFydFRva2VuID0gdGhpcy5zY2FubmVyLnRva2VuSW5kZXg7XG4gICAgICAgIHZhciBwcm9wZXJ0eSA9IHJlYWRQcm9wZXJ0eS5jYWxsKHRoaXMpO1xuICAgICAgICB2YXIgY3VzdG9tUHJvcGVydHkgPSBpc0N1c3RvbVByb3BlcnR5JDEocHJvcGVydHkpO1xuICAgICAgICB2YXIgcGFyc2VWYWx1ZSA9IGN1c3RvbVByb3BlcnR5ID8gdGhpcy5wYXJzZUN1c3RvbVByb3BlcnR5IDogdGhpcy5wYXJzZVZhbHVlO1xuICAgICAgICB2YXIgY29uc3VtZVJhdyA9IGN1c3RvbVByb3BlcnR5ID8gY29uc3VtZUN1c3RvbVByb3BlcnR5UmF3IDogY29uc3VtZVZhbHVlUmF3O1xuICAgICAgICB2YXIgaW1wb3J0YW50ID0gZmFsc2U7XG4gICAgICAgIHZhciB2YWx1ZTtcblxuICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG4gICAgICAgIHRoaXMuZWF0KENPTE9OJDMpO1xuXG4gICAgICAgIGNvbnN0IHZhbHVlU3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5JbmRleDtcblxuICAgICAgICBpZiAoIWN1c3RvbVByb3BlcnR5KSB7XG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFyc2VWYWx1ZSkge1xuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKGNvbnN1bWVWYWx1ZSwgY29uc3VtZVJhdyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YWx1ZSA9IGNvbnN1bWVSYXcuY2FsbCh0aGlzLCB0aGlzLnNjYW5uZXIudG9rZW5JbmRleCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3VzdG9tUHJvcGVydHkgJiYgdmFsdWUudHlwZSA9PT0gJ1ZhbHVlJyAmJiB2YWx1ZS5jaGlsZHJlbi5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIGZvciAobGV0IG9mZnNldCA9IHZhbHVlU3RhcnQgLSB0aGlzLnNjYW5uZXIudG9rZW5JbmRleDsgb2Zmc2V0IDw9IDA7IG9mZnNldCsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci5sb29rdXBUeXBlKG9mZnNldCkgPT09IFdISVRFU1BBQ0UkNykge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5jaGlsZHJlbi5hcHBlbmREYXRhKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdXaGl0ZVNwYWNlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYzogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnICdcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNjYW5uZXIuaXNEZWxpbShFWENMQU1BVElPTk1BUkskMSkpIHtcbiAgICAgICAgICAgIGltcG9ydGFudCA9IGdldEltcG9ydGFudC5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRG8gbm90IGluY2x1ZGUgc2VtaWNvbG9uIHRvIHJhbmdlIHBlciBzcGVjXG4gICAgICAgIC8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LyNkZWNsYXJhdGlvbi1kaWFncmFtXG5cbiAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci5lb2YgPT09IGZhbHNlICYmXG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIudG9rZW5UeXBlICE9PSBTRU1JQ09MT04kMyAmJlxuICAgICAgICAgICAgdGhpcy5zY2FubmVyLmlzQmFsYW5jZUVkZ2Uoc3RhcnRUb2tlbikgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0RlY2xhcmF0aW9uJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQpLFxuICAgICAgICAgICAgaW1wb3J0YW50OiBpbXBvcnRhbnQsXG4gICAgICAgICAgICBwcm9wZXJ0eTogcHJvcGVydHksXG4gICAgICAgICAgICB2YWx1ZTogdmFsdWVcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2h1bmsobm9kZS5wcm9wZXJ0eSk7XG4gICAgICAgIHRoaXMuY2h1bmsoJzonKTtcbiAgICAgICAgdGhpcy5ub2RlKG5vZGUudmFsdWUpO1xuXG4gICAgICAgIGlmIChub2RlLmltcG9ydGFudCkge1xuICAgICAgICAgICAgdGhpcy5jaHVuayhub2RlLmltcG9ydGFudCA9PT0gdHJ1ZSA/ICchaW1wb3J0YW50JyA6ICchJyArIG5vZGUuaW1wb3J0YW50KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgd2Fsa0NvbnRleHQ6ICdkZWNsYXJhdGlvbidcbn07XG5cbmZ1bmN0aW9uIHJlYWRQcm9wZXJ0eSgpIHtcbiAgICB2YXIgc3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcblxuICAgIC8vIGhhY2tzXG4gICAgaWYgKHRoaXMuc2Nhbm5lci50b2tlblR5cGUgPT09IERFTElNJDIpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnNjYW5uZXIuc291cmNlLmNoYXJDb2RlQXQodGhpcy5zY2FubmVyLnRva2VuU3RhcnQpKSB7XG4gICAgICAgICAgICBjYXNlIEFTVEVSSVNLJDQ6XG4gICAgICAgICAgICBjYXNlIERPTExBUlNJR04kMTpcbiAgICAgICAgICAgIGNhc2UgUExVU1NJR04kNDpcbiAgICAgICAgICAgIGNhc2UgTlVNQkVSU0lHTiQzOlxuICAgICAgICAgICAgY2FzZSBBTVBFUlNBTkQ6XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVE9ETzogbm90IHN1cmUgd2Ugc2hvdWxkIHN1cHBvcnQgdGhpcyBoYWNrXG4gICAgICAgICAgICBjYXNlIFNPTElEVVMkNDpcbiAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjYW5uZXIuaXNEZWxpbShTT0xJRFVTJDQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2Nhbm5lci50b2tlblR5cGUgPT09IEhBU0gkMykge1xuICAgICAgICB0aGlzLmVhdChIQVNIJDMpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZWF0KElERU5UJDkpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnNjYW5uZXIuc3Vic3RyVG9DdXJzb3Ioc3RhcnQpO1xufVxuXG4vLyAhIHdzKiBpbXBvcnRhbnRcbmZ1bmN0aW9uIGdldEltcG9ydGFudCgpIHtcbiAgICB0aGlzLmVhdChERUxJTSQyKTtcbiAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG5cbiAgICB2YXIgaW1wb3J0YW50ID0gdGhpcy5jb25zdW1lKElERU5UJDkpO1xuXG4gICAgLy8gc3RvcmUgb3JpZ2luYWwgdmFsdWUgaW4gY2FzZSBpdCBkaWZmZXIgZnJvbSBgaW1wb3J0YW50YFxuICAgIC8vIGZvciBiZXR0ZXIgb3JpZ2luYWwgc291cmNlIHJlc3RvcmluZyBhbmQgaGFja3MgbGlrZSBgIWllYCBzdXBwb3J0XG4gICAgcmV0dXJuIGltcG9ydGFudCA9PT0gJ2ltcG9ydGFudCcgPyB0cnVlIDogaW1wb3J0YW50O1xufVxuXG52YXIgVFlQRSRsID0gdG9rZW5pemVyLlRZUEU7XG52YXIgcmF3TW9kZSQ0ID0gUmF3Lm1vZGU7XG5cbnZhciBXSElURVNQQUNFJDggPSBUWVBFJGwuV2hpdGVTcGFjZTtcbnZhciBDT01NRU5UJDcgPSBUWVBFJGwuQ29tbWVudDtcbnZhciBTRU1JQ09MT04kNCA9IFRZUEUkbC5TZW1pY29sb247XG5cbmZ1bmN0aW9uIGNvbnN1bWVSYXckMyhzdGFydFRva2VuKSB7XG4gICAgcmV0dXJuIHRoaXMuUmF3KHN0YXJ0VG9rZW4sIHJhd01vZGUkNC5zZW1pY29sb25JbmNsdWRlZCwgdHJ1ZSk7XG59XG5cbnZhciBEZWNsYXJhdGlvbkxpc3QgPSB7XG4gICAgbmFtZTogJ0RlY2xhcmF0aW9uTGlzdCcsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIGNoaWxkcmVuOiBbW1xuICAgICAgICAgICAgJ0RlY2xhcmF0aW9uJ1xuICAgICAgICBdXVxuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTtcblxuICAgICAgICBcbiAgICAgICAgd2hpbGUgKCF0aGlzLnNjYW5uZXIuZW9mKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc2Nhbm5lci50b2tlblR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFdISVRFU1BBQ0UkODpcbiAgICAgICAgICAgICAgICBjYXNlIENPTU1FTlQkNzpcbiAgICAgICAgICAgICAgICBjYXNlIFNFTUlDT0xPTiQ0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2godGhpcy5wYXJzZVdpdGhGYWxsYmFjayh0aGlzLkRlY2xhcmF0aW9uLCBjb25zdW1lUmF3JDMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnRGVjbGFyYXRpb25MaXN0JyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbkZyb21MaXN0KGNoaWxkcmVuKSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaGlsZHJlbihub2RlLCBmdW5jdGlvbihwcmV2KSB7XG4gICAgICAgICAgICBpZiAocHJldi50eXBlID09PSAnRGVjbGFyYXRpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaHVuaygnOycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG52YXIgY29uc3VtZU51bWJlciQyID0gdXRpbHMuY29uc3VtZU51bWJlcjtcbnZhciBUWVBFJG0gPSB0b2tlbml6ZXIuVFlQRTtcblxudmFyIERJTUVOU0lPTiQzID0gVFlQRSRtLkRpbWVuc2lvbjtcblxudmFyIERpbWVuc2lvbiA9IHtcbiAgICBuYW1lOiAnRGltZW5zaW9uJyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgdmFsdWU6IFN0cmluZyxcbiAgICAgICAgdW5pdDogU3RyaW5nXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuICAgICAgICB2YXIgbnVtYmVyRW5kID0gY29uc3VtZU51bWJlciQyKHRoaXMuc2Nhbm5lci5zb3VyY2UsIHN0YXJ0KTtcblxuICAgICAgICB0aGlzLmVhdChESU1FTlNJT04kMyk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdEaW1lbnNpb24nLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5zY2FubmVyLnNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsIG51bWJlckVuZCksXG4gICAgICAgICAgICB1bml0OiB0aGlzLnNjYW5uZXIuc291cmNlLnN1YnN0cmluZyhudW1iZXJFbmQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuayhub2RlLnZhbHVlKTtcbiAgICAgICAgdGhpcy5jaHVuayhub2RlLnVuaXQpO1xuICAgIH1cbn07XG5cbnZhciBUWVBFJG4gPSB0b2tlbml6ZXIuVFlQRTtcblxudmFyIFJJR0hUUEFSRU5USEVTSVMgPSBUWVBFJG4uUmlnaHRQYXJlbnRoZXNpcztcblxuLy8gPGZ1bmN0aW9uLXRva2VuPiA8c2VxdWVuY2U+IClcbnZhciBfRnVuY3Rpb24gPSB7XG4gICAgbmFtZTogJ0Z1bmN0aW9uJyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgbmFtZTogU3RyaW5nLFxuICAgICAgICBjaGlsZHJlbjogW1tdXVxuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKHJlYWRTZXF1ZW5jZSwgcmVjb2duaXplcikge1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcbiAgICAgICAgdmFyIG5hbWUgPSB0aGlzLmNvbnN1bWVGdW5jdGlvbk5hbWUoKTtcbiAgICAgICAgdmFyIG5hbWVMb3dlckNhc2UgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHZhciBjaGlsZHJlbjtcblxuICAgICAgICBjaGlsZHJlbiA9IHJlY29nbml6ZXIuaGFzT3duUHJvcGVydHkobmFtZUxvd2VyQ2FzZSlcbiAgICAgICAgICAgID8gcmVjb2duaXplcltuYW1lTG93ZXJDYXNlXS5jYWxsKHRoaXMsIHJlY29nbml6ZXIpXG4gICAgICAgICAgICA6IHJlYWRTZXF1ZW5jZS5jYWxsKHRoaXMsIHJlY29nbml6ZXIpO1xuXG4gICAgICAgIGlmICghdGhpcy5zY2FubmVyLmVvZikge1xuICAgICAgICAgICAgdGhpcy5lYXQoUklHSFRQQVJFTlRIRVNJUyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0Z1bmN0aW9uJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQpLFxuICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuayhub2RlLm5hbWUpO1xuICAgICAgICB0aGlzLmNodW5rKCcoJyk7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7XG4gICAgICAgIHRoaXMuY2h1bmsoJyknKTtcbiAgICB9LFxuICAgIHdhbGtDb250ZXh0OiAnZnVuY3Rpb24nXG59O1xuXG52YXIgVFlQRSRvID0gdG9rZW5pemVyLlRZUEU7XG5cbnZhciBIQVNIJDQgPSBUWVBFJG8uSGFzaDtcblxuLy8gJyMnIGlkZW50XG52YXIgSGFzaCA9IHtcbiAgICBuYW1lOiAnSGFzaCcsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIHZhbHVlOiBTdHJpbmdcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG5cbiAgICAgICAgdGhpcy5lYXQoSEFTSCQ0KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0hhc2gnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5zY2FubmVyLnN1YnN0clRvQ3Vyc29yKHN0YXJ0ICsgMSlcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2h1bmsoJyMnKTtcbiAgICAgICAgdGhpcy5jaHVuayhub2RlLnZhbHVlKTtcbiAgICB9XG59O1xuXG52YXIgVFlQRSRwID0gdG9rZW5pemVyLlRZUEU7XG5cbnZhciBJREVOVCRhID0gVFlQRSRwLklkZW50O1xuXG52YXIgSWRlbnRpZmllciA9IHtcbiAgICBuYW1lOiAnSWRlbnRpZmllcicsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIG5hbWU6IFN0cmluZ1xuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5FbmQpLFxuICAgICAgICAgICAgbmFtZTogdGhpcy5jb25zdW1lKElERU5UJGEpXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNodW5rKG5vZGUubmFtZSk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkcSA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgSEFTSCQ1ID0gVFlQRSRxLkhhc2g7XG5cbi8vIDxoYXNoLXRva2VuPlxudmFyIElkU2VsZWN0b3IgPSB7XG4gICAgbmFtZTogJ0lkU2VsZWN0b3InLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICBuYW1lOiBTdHJpbmdcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG5cbiAgICAgICAgLy8gVE9ETzogY2hlY2sgdmFsdWUgaXMgYW4gaWRlbnRcbiAgICAgICAgdGhpcy5lYXQoSEFTSCQ1KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0lkU2VsZWN0b3InLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICBuYW1lOiB0aGlzLnNjYW5uZXIuc3Vic3RyVG9DdXJzb3Ioc3RhcnQgKyAxKVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuaygnIycpO1xuICAgICAgICB0aGlzLmNodW5rKG5vZGUubmFtZSk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkciA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgSURFTlQkYiA9IFRZUEUkci5JZGVudDtcbnZhciBOVU1CRVIkNCA9IFRZUEUkci5OdW1iZXI7XG52YXIgRElNRU5TSU9OJDQgPSBUWVBFJHIuRGltZW5zaW9uO1xudmFyIExFRlRQQVJFTlRIRVNJUyQzID0gVFlQRSRyLkxlZnRQYXJlbnRoZXNpcztcbnZhciBSSUdIVFBBUkVOVEhFU0lTJDEgPSBUWVBFJHIuUmlnaHRQYXJlbnRoZXNpcztcbnZhciBDT0xPTiQ0ID0gVFlQRSRyLkNvbG9uO1xudmFyIERFTElNJDMgPSBUWVBFJHIuRGVsaW07XG5cbnZhciBNZWRpYUZlYXR1cmUgPSB7XG4gICAgbmFtZTogJ01lZGlhRmVhdHVyZScsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIG5hbWU6IFN0cmluZyxcbiAgICAgICAgdmFsdWU6IFsnSWRlbnRpZmllcicsICdOdW1iZXInLCAnRGltZW5zaW9uJywgJ1JhdGlvJywgbnVsbF1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG4gICAgICAgIHZhciBuYW1lO1xuICAgICAgICB2YXIgdmFsdWUgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuZWF0KExFRlRQQVJFTlRIRVNJUyQzKTtcbiAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuXG4gICAgICAgIG5hbWUgPSB0aGlzLmNvbnN1bWUoSURFTlQkYik7XG4gICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcblxuICAgICAgICBpZiAodGhpcy5zY2FubmVyLnRva2VuVHlwZSAhPT0gUklHSFRQQVJFTlRIRVNJUyQxKSB7XG4gICAgICAgICAgICB0aGlzLmVhdChDT0xPTiQ0KTtcbiAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcblxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBOVU1CRVIkNDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwTm9uV1NUeXBlKDEpID09PSBERUxJTSQzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuUmF0aW8oKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5OdW1iZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBESU1FTlNJT04kNDpcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLkRpbWVuc2lvbigpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgSURFTlQkYjpcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLklkZW50aWZpZXIoKTtcblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ051bWJlciwgZGltZW5zaW9uLCByYXRpbyBvciBpZGVudGlmaWVyIGlzIGV4cGVjdGVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWF0KFJJR0hUUEFSRU5USEVTSVMkMSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdNZWRpYUZlYXR1cmUnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgdmFsdWU6IHZhbHVlXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNodW5rKCcoJyk7XG4gICAgICAgIHRoaXMuY2h1bmsobm9kZS5uYW1lKTtcbiAgICAgICAgaWYgKG5vZGUudmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuY2h1bmsoJzonKTtcbiAgICAgICAgICAgIHRoaXMubm9kZShub2RlLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNodW5rKCcpJyk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkcyA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgV0hJVEVTUEFDRSQ5ID0gVFlQRSRzLldoaXRlU3BhY2U7XG52YXIgQ09NTUVOVCQ4ID0gVFlQRSRzLkNvbW1lbnQ7XG52YXIgSURFTlQkYyA9IFRZUEUkcy5JZGVudDtcbnZhciBMRUZUUEFSRU5USEVTSVMkNCA9IFRZUEUkcy5MZWZ0UGFyZW50aGVzaXM7XG5cbnZhciBNZWRpYVF1ZXJ5ID0ge1xuICAgIG5hbWU6ICdNZWRpYVF1ZXJ5JyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgY2hpbGRyZW46IFtbXG4gICAgICAgICAgICAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICAnTWVkaWFGZWF0dXJlJyxcbiAgICAgICAgICAgICdXaGl0ZVNwYWNlJ1xuICAgICAgICBdXVxuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG5cbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7XG4gICAgICAgIHZhciBjaGlsZCA9IG51bGw7XG4gICAgICAgIHZhciBzcGFjZSA9IG51bGw7XG5cbiAgICAgICAgc2NhbjpcbiAgICAgICAgd2hpbGUgKCF0aGlzLnNjYW5uZXIuZW9mKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc2Nhbm5lci50b2tlblR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIENPTU1FTlQkODpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICBjYXNlIFdISVRFU1BBQ0UkOTpcbiAgICAgICAgICAgICAgICAgICAgc3BhY2UgPSB0aGlzLldoaXRlU3BhY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICBjYXNlIElERU5UJGM6XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5JZGVudGlmaWVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBMRUZUUEFSRU5USEVTSVMkNDpcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLk1lZGlhRmVhdHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzcGFjZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goc3BhY2UpO1xuICAgICAgICAgICAgICAgIHNwYWNlID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2hpbGQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0lkZW50aWZpZXIgb3IgcGFyZW50aGVzaXMgaXMgZXhwZWN0ZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnTWVkaWFRdWVyeScsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksXG4gICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW5cbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7XG4gICAgfVxufTtcblxudmFyIENPTU1BJDIgPSB0b2tlbml6ZXIuVFlQRS5Db21tYTtcblxudmFyIE1lZGlhUXVlcnlMaXN0ID0ge1xuICAgIG5hbWU6ICdNZWRpYVF1ZXJ5TGlzdCcsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIGNoaWxkcmVuOiBbW1xuICAgICAgICAgICAgJ01lZGlhUXVlcnknXG4gICAgICAgIF1dXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24ocmVsYXRpdmUpIHtcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7XG5cbiAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuXG4gICAgICAgIHdoaWxlICghdGhpcy5zY2FubmVyLmVvZikge1xuICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLk1lZGlhUXVlcnkocmVsYXRpdmUpKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci50b2tlblR5cGUgIT09IENPTU1BJDIpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnTWVkaWFRdWVyeUxpc3QnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uRnJvbUxpc3QoY2hpbGRyZW4pLFxuICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNoaWxkcmVuKG5vZGUsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5jaHVuaygnLCcpO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG52YXIgTnRoID0ge1xuICAgIG5hbWU6ICdOdGgnLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICBudGg6IFsnQW5QbHVzQicsICdJZGVudGlmaWVyJ10sXG4gICAgICAgIHNlbGVjdG9yOiBbJ1NlbGVjdG9yTGlzdCcsIG51bGxdXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oYWxsb3dPZkNsYXVzZSkge1xuICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG5cbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG4gICAgICAgIHZhciBlbmQgPSBzdGFydDtcbiAgICAgICAgdmFyIHNlbGVjdG9yID0gbnVsbDtcbiAgICAgICAgdmFyIHF1ZXJ5O1xuXG4gICAgICAgIGlmICh0aGlzLnNjYW5uZXIubG9va3VwVmFsdWUoMCwgJ29kZCcpIHx8IHRoaXMuc2Nhbm5lci5sb29rdXBWYWx1ZSgwLCAnZXZlbicpKSB7XG4gICAgICAgICAgICBxdWVyeSA9IHRoaXMuSWRlbnRpZmllcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcXVlcnkgPSB0aGlzLkFuUGx1c0IoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcblxuICAgICAgICBpZiAoYWxsb3dPZkNsYXVzZSAmJiB0aGlzLnNjYW5uZXIubG9va3VwVmFsdWUoMCwgJ29mJykpIHtcbiAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG5cbiAgICAgICAgICAgIHNlbGVjdG9yID0gdGhpcy5TZWxlY3Rvckxpc3QoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMubmVlZFBvc2l0aW9ucykge1xuICAgICAgICAgICAgICAgIGVuZCA9IHRoaXMuZ2V0TGFzdExpc3ROb2RlKHNlbGVjdG9yLmNoaWxkcmVuKS5sb2MuZW5kLm9mZnNldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm5lZWRQb3NpdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBlbmQgPSBxdWVyeS5sb2MuZW5kLm9mZnNldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnTnRoJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgZW5kKSxcbiAgICAgICAgICAgIG50aDogcXVlcnksXG4gICAgICAgICAgICBzZWxlY3Rvcjogc2VsZWN0b3JcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMubm9kZShub2RlLm50aCk7XG4gICAgICAgIGlmIChub2RlLnNlbGVjdG9yICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmNodW5rKCcgb2YgJyk7XG4gICAgICAgICAgICB0aGlzLm5vZGUobm9kZS5zZWxlY3Rvcik7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG52YXIgTlVNQkVSJDUgPSB0b2tlbml6ZXIuVFlQRS5OdW1iZXI7XG5cbnZhciBfTnVtYmVyID0ge1xuICAgIG5hbWU6ICdOdW1iZXInLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICB2YWx1ZTogU3RyaW5nXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnTnVtYmVyJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbih0aGlzLnNjYW5uZXIudG9rZW5TdGFydCwgdGhpcy5zY2FubmVyLnRva2VuRW5kKSxcbiAgICAgICAgICAgIHZhbHVlOiB0aGlzLmNvbnN1bWUoTlVNQkVSJDUpXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNodW5rKG5vZGUudmFsdWUpO1xuICAgIH1cbn07XG5cbi8vICcvJyB8ICcqJyB8ICcsJyB8ICc6JyB8ICcrJyB8ICctJ1xudmFyIE9wZXJhdG9yID0ge1xuICAgIG5hbWU6ICdPcGVyYXRvcicsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIHZhbHVlOiBTdHJpbmdcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG5cbiAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ09wZXJhdG9yJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQpLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuc2Nhbm5lci5zdWJzdHJUb0N1cnNvcihzdGFydClcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2h1bmsobm9kZS52YWx1ZSk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkdCA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgTEVGVFBBUkVOVEhFU0lTJDUgPSBUWVBFJHQuTGVmdFBhcmVudGhlc2lzO1xudmFyIFJJR0hUUEFSRU5USEVTSVMkMiA9IFRZUEUkdC5SaWdodFBhcmVudGhlc2lzO1xuXG52YXIgUGFyZW50aGVzZXMgPSB7XG4gICAgbmFtZTogJ1BhcmVudGhlc2VzJyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgY2hpbGRyZW46IFtbXV1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbihyZWFkU2VxdWVuY2UsIHJlY29nbml6ZXIpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5lYXQoTEVGVFBBUkVOVEhFU0lTJDUpO1xuXG4gICAgICAgIGNoaWxkcmVuID0gcmVhZFNlcXVlbmNlLmNhbGwodGhpcywgcmVjb2duaXplcik7XG5cbiAgICAgICAgaWYgKCF0aGlzLnNjYW5uZXIuZW9mKSB7XG4gICAgICAgICAgICB0aGlzLmVhdChSSUdIVFBBUkVOVEhFU0lTJDIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdQYXJlbnRoZXNlcycsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuaygnKCcpO1xuICAgICAgICB0aGlzLmNoaWxkcmVuKG5vZGUpO1xuICAgICAgICB0aGlzLmNodW5rKCcpJyk7XG4gICAgfVxufTtcblxudmFyIGNvbnN1bWVOdW1iZXIkMyA9IHV0aWxzLmNvbnN1bWVOdW1iZXI7XG52YXIgVFlQRSR1ID0gdG9rZW5pemVyLlRZUEU7XG5cbnZhciBQRVJDRU5UQUdFJDMgPSBUWVBFJHUuUGVyY2VudGFnZTtcblxudmFyIFBlcmNlbnRhZ2UgPSB7XG4gICAgbmFtZTogJ1BlcmNlbnRhZ2UnLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICB2YWx1ZTogU3RyaW5nXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuICAgICAgICB2YXIgbnVtYmVyRW5kID0gY29uc3VtZU51bWJlciQzKHRoaXMuc2Nhbm5lci5zb3VyY2UsIHN0YXJ0KTtcblxuICAgICAgICB0aGlzLmVhdChQRVJDRU5UQUdFJDMpO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnUGVyY2VudGFnZScsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KSxcbiAgICAgICAgICAgIHZhbHVlOiB0aGlzLnNjYW5uZXIuc291cmNlLnN1YnN0cmluZyhzdGFydCwgbnVtYmVyRW5kKVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuayhub2RlLnZhbHVlKTtcbiAgICAgICAgdGhpcy5jaHVuaygnJScpO1xuICAgIH1cbn07XG5cbnZhciBUWVBFJHYgPSB0b2tlbml6ZXIuVFlQRTtcblxudmFyIElERU5UJGQgPSBUWVBFJHYuSWRlbnQ7XG52YXIgRlVOQ1RJT04kNCA9IFRZUEUkdi5GdW5jdGlvbjtcbnZhciBDT0xPTiQ1ID0gVFlQRSR2LkNvbG9uO1xudmFyIFJJR0hUUEFSRU5USEVTSVMkMyA9IFRZUEUkdi5SaWdodFBhcmVudGhlc2lzO1xuXG4vLyA6IFsgPGlkZW50PiB8IDxmdW5jdGlvbi10b2tlbj4gPGFueS12YWx1ZT4/ICkgXVxudmFyIFBzZXVkb0NsYXNzU2VsZWN0b3IgPSB7XG4gICAgbmFtZTogJ1BzZXVkb0NsYXNzU2VsZWN0b3InLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICBuYW1lOiBTdHJpbmcsXG4gICAgICAgIGNoaWxkcmVuOiBbWydSYXcnXSwgbnVsbF1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9IG51bGw7XG4gICAgICAgIHZhciBuYW1lO1xuICAgICAgICB2YXIgbmFtZUxvd2VyQ2FzZTtcblxuICAgICAgICB0aGlzLmVhdChDT0xPTiQ1KTtcblxuICAgICAgICBpZiAodGhpcy5zY2FubmVyLnRva2VuVHlwZSA9PT0gRlVOQ1RJT04kNCkge1xuICAgICAgICAgICAgbmFtZSA9IHRoaXMuY29uc3VtZUZ1bmN0aW9uTmFtZSgpO1xuICAgICAgICAgICAgbmFtZUxvd2VyQ2FzZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMucHNldWRvLmhhc093blByb3BlcnR5KG5hbWVMb3dlckNhc2UpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5wc2V1ZG9bbmFtZUxvd2VyQ2FzZV0uY2FsbCh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIuc2tpcFNDKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7XG4gICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5SYXcodGhpcy5zY2FubmVyLnRva2VuSW5kZXgsIG51bGwsIGZhbHNlKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZWF0KFJJR0hUUEFSRU5USEVTSVMkMyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuYW1lID0gdGhpcy5jb25zdW1lKElERU5UJGQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdQc2V1ZG9DbGFzc1NlbGVjdG9yJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQpLFxuICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuaygnOicpO1xuICAgICAgICB0aGlzLmNodW5rKG5vZGUubmFtZSk7XG5cbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuY2h1bmsoJygnKTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7XG4gICAgICAgICAgICB0aGlzLmNodW5rKCcpJyk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHdhbGtDb250ZXh0OiAnZnVuY3Rpb24nXG59O1xuXG52YXIgVFlQRSR3ID0gdG9rZW5pemVyLlRZUEU7XG5cbnZhciBJREVOVCRlID0gVFlQRSR3LklkZW50O1xudmFyIEZVTkNUSU9OJDUgPSBUWVBFJHcuRnVuY3Rpb247XG52YXIgQ09MT04kNiA9IFRZUEUkdy5Db2xvbjtcbnZhciBSSUdIVFBBUkVOVEhFU0lTJDQgPSBUWVBFJHcuUmlnaHRQYXJlbnRoZXNpcztcblxuLy8gOjogWyA8aWRlbnQ+IHwgPGZ1bmN0aW9uLXRva2VuPiA8YW55LXZhbHVlPj8gKSBdXG52YXIgUHNldWRvRWxlbWVudFNlbGVjdG9yID0ge1xuICAgIG5hbWU6ICdQc2V1ZG9FbGVtZW50U2VsZWN0b3InLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICBuYW1lOiBTdHJpbmcsXG4gICAgICAgIGNoaWxkcmVuOiBbWydSYXcnXSwgbnVsbF1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9IG51bGw7XG4gICAgICAgIHZhciBuYW1lO1xuICAgICAgICB2YXIgbmFtZUxvd2VyQ2FzZTtcblxuICAgICAgICB0aGlzLmVhdChDT0xPTiQ2KTtcbiAgICAgICAgdGhpcy5lYXQoQ09MT04kNik7XG5cbiAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci50b2tlblR5cGUgPT09IEZVTkNUSU9OJDUpIHtcbiAgICAgICAgICAgIG5hbWUgPSB0aGlzLmNvbnN1bWVGdW5jdGlvbk5hbWUoKTtcbiAgICAgICAgICAgIG5hbWVMb3dlckNhc2UgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnBzZXVkby5oYXNPd25Qcm9wZXJ0eShuYW1lTG93ZXJDYXNlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IHRoaXMucHNldWRvW25hbWVMb3dlckNhc2VdLmNhbGwodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IHRoaXMuY3JlYXRlTGlzdCgpO1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuUmF3KHRoaXMuc2Nhbm5lci50b2tlbkluZGV4LCBudWxsLCBmYWxzZSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmVhdChSSUdIVFBBUkVOVEhFU0lTJDQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmFtZSA9IHRoaXMuY29uc3VtZShJREVOVCRlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnUHNldWRvRWxlbWVudFNlbGVjdG9yJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQpLFxuICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuaygnOjonKTtcbiAgICAgICAgdGhpcy5jaHVuayhub2RlLm5hbWUpO1xuXG4gICAgICAgIGlmIChub2RlLmNoaWxkcmVuICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmNodW5rKCcoJyk7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuKG5vZGUpO1xuICAgICAgICAgICAgdGhpcy5jaHVuaygnKScpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB3YWxrQ29udGV4dDogJ2Z1bmN0aW9uJ1xufTtcblxudmFyIGlzRGlnaXQkMyA9IHRva2VuaXplci5pc0RpZ2l0O1xudmFyIFRZUEUkeCA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgTlVNQkVSJDYgPSBUWVBFJHguTnVtYmVyO1xudmFyIERFTElNJDQgPSBUWVBFJHguRGVsaW07XG52YXIgU09MSURVUyQ1ID0gMHgwMDJGOyAgLy8gVSswMDJGIFNPTElEVVMgKC8pXG52YXIgRlVMTFNUT1AkMiA9IDB4MDAyRTsgLy8gVSswMDJFIEZVTEwgU1RPUCAoLilcblxuLy8gVGVybXMgb2YgPHJhdGlvPiBzaG91bGQgYmUgYSBwb3NpdGl2ZSBudW1iZXJzIChub3QgemVybyBvciBuZWdhdGl2ZSlcbi8vIChzZWUgaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL21lZGlhcXVlcmllcy0zLyN2YWx1ZXMpXG4vLyBIb3dldmVyLCAtby1taW4tZGV2aWNlLXBpeGVsLXJhdGlvIHRha2VzIGZyYWN0aW9uYWwgdmFsdWVzIGFzIGEgcmF0aW8ncyB0ZXJtXG4vLyBhbmQgdGhpcyBpcyB1c2luZyBieSB2YXJpb3VzIHNpdGVzLiBUaGVyZWZvcmUgd2UgcmVsYXggY2hlY2tpbmcgb24gcGFyc2Vcbi8vIHRvIHRlc3QgYSB0ZXJtIGlzIHVuc2lnbmVkIG51bWJlciB3aXRob3V0IGFuIGV4cG9uZW50IHBhcnQuXG4vLyBBZGRpdGlvbmFsIGNoZWNraW5nIG1heSBiZSBhcHBsaWVkIG9uIGxleGVyIHZhbGlkYXRpb24uXG5mdW5jdGlvbiBjb25zdW1lTnVtYmVyJDQoKSB7XG4gICAgdGhpcy5zY2FubmVyLnNraXBXUygpO1xuXG4gICAgdmFyIHZhbHVlID0gdGhpcy5jb25zdW1lKE5VTUJFUiQ2KTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGNvZGUgPSB2YWx1ZS5jaGFyQ29kZUF0KGkpO1xuICAgICAgICBpZiAoIWlzRGlnaXQkMyhjb2RlKSAmJiBjb2RlICE9PSBGVUxMU1RPUCQyKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yKCdVbnNpZ25lZCBudW1iZXIgaXMgZXhwZWN0ZWQnLCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCAtIHZhbHVlLmxlbmd0aCArIGkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKE51bWJlcih2YWx1ZSkgPT09IDApIHtcbiAgICAgICAgdGhpcy5lcnJvcignWmVybyBudW1iZXIgaXMgbm90IGFsbG93ZWQnLCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCAtIHZhbHVlLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xufVxuXG4vLyA8cG9zaXRpdmUtaW50ZWdlcj4gUyogJy8nIFMqIDxwb3NpdGl2ZS1pbnRlZ2VyPlxudmFyIFJhdGlvID0ge1xuICAgIG5hbWU6ICdSYXRpbycsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIGxlZnQ6IFN0cmluZyxcbiAgICAgICAgcmlnaHQ6IFN0cmluZ1xuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcbiAgICAgICAgdmFyIGxlZnQgPSBjb25zdW1lTnVtYmVyJDQuY2FsbCh0aGlzKTtcbiAgICAgICAgdmFyIHJpZ2h0O1xuXG4gICAgICAgIHRoaXMuc2Nhbm5lci5za2lwV1MoKTtcblxuICAgICAgICBpZiAoIXRoaXMuc2Nhbm5lci5pc0RlbGltKFNPTElEVVMkNSkpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1NvbGlkdXMgaXMgZXhwZWN0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVhdChERUxJTSQ0KTtcbiAgICAgICAgcmlnaHQgPSBjb25zdW1lTnVtYmVyJDQuY2FsbCh0aGlzKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ1JhdGlvJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQpLFxuICAgICAgICAgICAgbGVmdDogbGVmdCxcbiAgICAgICAgICAgIHJpZ2h0OiByaWdodFxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuayhub2RlLmxlZnQpO1xuICAgICAgICB0aGlzLmNodW5rKCcvJyk7XG4gICAgICAgIHRoaXMuY2h1bmsobm9kZS5yaWdodCk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkeSA9IHRva2VuaXplci5UWVBFO1xudmFyIHJhd01vZGUkNSA9IFJhdy5tb2RlO1xuXG52YXIgTEVGVENVUkxZQlJBQ0tFVCQzID0gVFlQRSR5LkxlZnRDdXJseUJyYWNrZXQ7XG5cbmZ1bmN0aW9uIGNvbnN1bWVSYXckNChzdGFydFRva2VuKSB7XG4gICAgcmV0dXJuIHRoaXMuUmF3KHN0YXJ0VG9rZW4sIHJhd01vZGUkNS5sZWZ0Q3VybHlCcmFja2V0LCB0cnVlKTtcbn1cblxuZnVuY3Rpb24gY29uc3VtZVByZWx1ZGUoKSB7XG4gICAgdmFyIHByZWx1ZGUgPSB0aGlzLlNlbGVjdG9yTGlzdCgpO1xuXG4gICAgaWYgKHByZWx1ZGUudHlwZSAhPT0gJ1JhdycgJiZcbiAgICAgICAgdGhpcy5zY2FubmVyLmVvZiA9PT0gZmFsc2UgJiZcbiAgICAgICAgdGhpcy5zY2FubmVyLnRva2VuVHlwZSAhPT0gTEVGVENVUkxZQlJBQ0tFVCQzKSB7XG4gICAgICAgIHRoaXMuZXJyb3IoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcHJlbHVkZTtcbn1cblxudmFyIFJ1bGUgPSB7XG4gICAgbmFtZTogJ1J1bGUnLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICBwcmVsdWRlOiBbJ1NlbGVjdG9yTGlzdCcsICdSYXcnXSxcbiAgICAgICAgYmxvY2s6IFsnQmxvY2snXVxuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3RhcnRUb2tlbiA9IHRoaXMuc2Nhbm5lci50b2tlbkluZGV4O1xuICAgICAgICB2YXIgc3RhcnRPZmZzZXQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcbiAgICAgICAgdmFyIHByZWx1ZGU7XG4gICAgICAgIHZhciBibG9jaztcblxuICAgICAgICBpZiAodGhpcy5wYXJzZVJ1bGVQcmVsdWRlKSB7XG4gICAgICAgICAgICBwcmVsdWRlID0gdGhpcy5wYXJzZVdpdGhGYWxsYmFjayhjb25zdW1lUHJlbHVkZSwgY29uc3VtZVJhdyQ0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHByZWx1ZGUgPSBjb25zdW1lUmF3JDQuY2FsbCh0aGlzLCBzdGFydFRva2VuKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJsb2NrID0gdGhpcy5CbG9jayh0cnVlKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ1J1bGUnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0T2Zmc2V0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICBwcmVsdWRlOiBwcmVsdWRlLFxuICAgICAgICAgICAgYmxvY2s6IGJsb2NrXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLm5vZGUobm9kZS5wcmVsdWRlKTtcbiAgICAgICAgdGhpcy5ub2RlKG5vZGUuYmxvY2spO1xuICAgIH0sXG4gICAgd2Fsa0NvbnRleHQ6ICdydWxlJ1xufTtcblxudmFyIFNlbGVjdG9yID0ge1xuICAgIG5hbWU6ICdTZWxlY3RvcicsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIGNoaWxkcmVuOiBbW1xuICAgICAgICAgICAgJ1R5cGVTZWxlY3RvcicsXG4gICAgICAgICAgICAnSWRTZWxlY3RvcicsXG4gICAgICAgICAgICAnQ2xhc3NTZWxlY3RvcicsXG4gICAgICAgICAgICAnQXR0cmlidXRlU2VsZWN0b3InLFxuICAgICAgICAgICAgJ1BzZXVkb0NsYXNzU2VsZWN0b3InLFxuICAgICAgICAgICAgJ1BzZXVkb0VsZW1lbnRTZWxlY3RvcicsXG4gICAgICAgICAgICAnQ29tYmluYXRvcicsXG4gICAgICAgICAgICAnV2hpdGVTcGFjZSdcbiAgICAgICAgXV1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5yZWFkU2VxdWVuY2UodGhpcy5zY29wZS5TZWxlY3Rvcik7XG5cbiAgICAgICAgLy8gbm90aGluZyB3ZXJlIGNvbnN1bWVkXG4gICAgICAgIGlmICh0aGlzLmdldEZpcnN0TGlzdE5vZGUoY2hpbGRyZW4pID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yKCdTZWxlY3RvciBpcyBleHBlY3RlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdTZWxlY3RvcicsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksXG4gICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW5cbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkeiA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgQ09NTUEkMyA9IFRZUEUkei5Db21tYTtcblxudmFyIFNlbGVjdG9yTGlzdCA9IHtcbiAgICBuYW1lOiAnU2VsZWN0b3JMaXN0JyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgY2hpbGRyZW46IFtbXG4gICAgICAgICAgICAnU2VsZWN0b3InLFxuICAgICAgICAgICAgJ1JhdydcbiAgICAgICAgXV1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7XG5cbiAgICAgICAgd2hpbGUgKCF0aGlzLnNjYW5uZXIuZW9mKSB7XG4gICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuU2VsZWN0b3IoKSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlID09PSBDT01NQSQzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ1NlbGVjdG9yTGlzdCcsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksXG4gICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW5cbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4obm9kZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmNodW5rKCcsJyk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgd2Fsa0NvbnRleHQ6ICdzZWxlY3Rvcidcbn07XG5cbnZhciBTVFJJTkckMyA9IHRva2VuaXplci5UWVBFLlN0cmluZztcblxudmFyIF9TdHJpbmcgPSB7XG4gICAgbmFtZTogJ1N0cmluZycsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIHZhbHVlOiBTdHJpbmdcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdTdHJpbmcnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5FbmQpLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuY29uc3VtZShTVFJJTkckMylcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2h1bmsobm9kZS52YWx1ZSk7XG4gICAgfVxufTtcblxudmFyIFRZUEUkQSA9IHRva2VuaXplci5UWVBFO1xuXG52YXIgV0hJVEVTUEFDRSRhID0gVFlQRSRBLldoaXRlU3BhY2U7XG52YXIgQ09NTUVOVCQ5ID0gVFlQRSRBLkNvbW1lbnQ7XG52YXIgQVRLRVlXT1JEJDIgPSBUWVBFJEEuQXRLZXl3b3JkO1xudmFyIENETyQxID0gVFlQRSRBLkNETztcbnZhciBDREMkMSA9IFRZUEUkQS5DREM7XG52YXIgRVhDTEFNQVRJT05NQVJLJDIgPSAweDAwMjE7IC8vIFUrMDAyMSBFWENMQU1BVElPTiBNQVJLICghKVxuXG5mdW5jdGlvbiBjb25zdW1lUmF3JDUoc3RhcnRUb2tlbikge1xuICAgIHJldHVybiB0aGlzLlJhdyhzdGFydFRva2VuLCBudWxsLCBmYWxzZSk7XG59XG5cbnZhciBTdHlsZVNoZWV0ID0ge1xuICAgIG5hbWU6ICdTdHlsZVNoZWV0JyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgY2hpbGRyZW46IFtbXG4gICAgICAgICAgICAnQ29tbWVudCcsXG4gICAgICAgICAgICAnQ0RPJyxcbiAgICAgICAgICAgICdDREMnLFxuICAgICAgICAgICAgJ0F0cnVsZScsXG4gICAgICAgICAgICAnUnVsZScsXG4gICAgICAgICAgICAnUmF3J1xuICAgICAgICBdXVxuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydDtcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7XG4gICAgICAgIHZhciBjaGlsZDtcblxuICAgICAgICBcbiAgICAgICAgd2hpbGUgKCF0aGlzLnNjYW5uZXIuZW9mKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc2Nhbm5lci50b2tlblR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFdISVRFU1BBQ0UkYTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICBjYXNlIENPTU1FTlQkOTpcbiAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlIGNvbW1lbnRzIGV4Y2VwdCBleGNsYW1hdGlvbiBjb21tZW50cyAoaS5lLiAvKiEgLi4gKi8pIG9uIHRvcCBsZXZlbFxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zY2FubmVyLnNvdXJjZS5jaGFyQ29kZUF0KHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0ICsgMikgIT09IEVYQ0xBTUFUSU9OTUFSSyQyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuQ29tbWVudCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgQ0RPJDE6IC8vIDwhLS1cbiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLkNETygpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgQ0RDJDE6IC8vIC0tPlxuICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuQ0RDKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgLy8gQ1NTIFN5bnRheCBNb2R1bGUgTGV2ZWwgM1xuICAgICAgICAgICAgICAgIC8vIMKnMi4yIEVycm9yIGhhbmRsaW5nXG4gICAgICAgICAgICAgICAgLy8gQXQgdGhlIFwidG9wIGxldmVsXCIgb2YgYSBzdHlsZXNoZWV0LCBhbiA8YXQta2V5d29yZC10b2tlbj4gc3RhcnRzIGFuIGF0LXJ1bGUuXG4gICAgICAgICAgICAgICAgY2FzZSBBVEtFWVdPUkQkMjpcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuQXRydWxlLCBjb25zdW1lUmF3JDUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIC8vIEFueXRoaW5nIGVsc2Ugc3RhcnRzIGEgcXVhbGlmaWVkIHJ1bGUgLi4uXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuUnVsZSwgY29uc3VtZVJhdyQ1KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ1N0eWxlU2hlZXQnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW5cbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdlbmVyYXRlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7XG4gICAgfSxcbiAgICB3YWxrQ29udGV4dDogJ3N0eWxlc2hlZXQnXG59O1xuXG52YXIgVFlQRSRCID0gdG9rZW5pemVyLlRZUEU7XG5cbnZhciBJREVOVCRmID0gVFlQRSRCLklkZW50O1xudmFyIEFTVEVSSVNLJDUgPSAweDAwMkE7ICAgICAvLyBVKzAwMkEgQVNURVJJU0sgKCopXG52YXIgVkVSVElDQUxMSU5FJDIgPSAweDAwN0M7IC8vIFUrMDA3QyBWRVJUSUNBTCBMSU5FICh8KVxuXG5mdW5jdGlvbiBlYXRJZGVudGlmaWVyT3JBc3RlcmlzaygpIHtcbiAgICBpZiAodGhpcy5zY2FubmVyLnRva2VuVHlwZSAhPT0gSURFTlQkZiAmJlxuICAgICAgICB0aGlzLnNjYW5uZXIuaXNEZWxpbShBU1RFUklTSyQ1KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5lcnJvcignSWRlbnRpZmllciBvciBhc3RlcmlzayBpcyBleHBlY3RlZCcpO1xuICAgIH1cblxuICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG59XG5cbi8vIGlkZW50XG4vLyBpZGVudHxpZGVudFxuLy8gaWRlbnR8KlxuLy8gKlxuLy8gKnxpZGVudFxuLy8gKnwqXG4vLyB8aWRlbnRcbi8vIHwqXG52YXIgVHlwZVNlbGVjdG9yID0ge1xuICAgIG5hbWU6ICdUeXBlU2VsZWN0b3InLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICBuYW1lOiBTdHJpbmdcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zY2FubmVyLnRva2VuU3RhcnQ7XG5cbiAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci5pc0RlbGltKFZFUlRJQ0FMTElORSQyKSkge1xuICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgIGVhdElkZW50aWZpZXJPckFzdGVyaXNrLmNhbGwodGhpcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlYXRJZGVudGlmaWVyT3JBc3Rlcmlzay5jYWxsKHRoaXMpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zY2FubmVyLmlzRGVsaW0oVkVSVElDQUxMSU5FJDIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgICBlYXRJZGVudGlmaWVyT3JBc3Rlcmlzay5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdUeXBlU2VsZWN0b3InLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICBuYW1lOiB0aGlzLnNjYW5uZXIuc3Vic3RyVG9DdXJzb3Ioc3RhcnQpXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNodW5rKG5vZGUubmFtZSk7XG4gICAgfVxufTtcblxudmFyIGlzSGV4RGlnaXQkMyA9IHRva2VuaXplci5pc0hleERpZ2l0O1xudmFyIGNtcENoYXIkMyA9IHRva2VuaXplci5jbXBDaGFyO1xudmFyIFRZUEUkQyA9IHRva2VuaXplci5UWVBFO1xudmFyIE5BTUUkMyA9IHRva2VuaXplci5OQU1FO1xuXG52YXIgSURFTlQkZyA9IFRZUEUkQy5JZGVudDtcbnZhciBOVU1CRVIkNyA9IFRZUEUkQy5OdW1iZXI7XG52YXIgRElNRU5TSU9OJDUgPSBUWVBFJEMuRGltZW5zaW9uO1xudmFyIFBMVVNTSUdOJDUgPSAweDAwMkI7ICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKVxudmFyIEhZUEhFTk1JTlVTJDMgPSAweDAwMkQ7ICAvLyBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKVxudmFyIFFVRVNUSU9OTUFSSyA9IDB4MDAzRjsgLy8gVSswMDNGIFFVRVNUSU9OIE1BUksgKD8pXG52YXIgVSQxID0gMHgwMDc1OyAgICAgICAgICAgIC8vIFUrMDA3NSBMQVRJTiBTTUFMTCBMRVRURVIgVSAodSlcblxuZnVuY3Rpb24gZWF0SGV4U2VxdWVuY2Uob2Zmc2V0LCBhbGxvd0Rhc2gpIHtcbiAgICBmb3IgKHZhciBwb3MgPSB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCArIG9mZnNldCwgbGVuID0gMDsgcG9zIDwgdGhpcy5zY2FubmVyLnRva2VuRW5kOyBwb3MrKykge1xuICAgICAgICB2YXIgY29kZSA9IHRoaXMuc2Nhbm5lci5zb3VyY2UuY2hhckNvZGVBdChwb3MpO1xuXG4gICAgICAgIGlmIChjb2RlID09PSBIWVBIRU5NSU5VUyQzICYmIGFsbG93RGFzaCAmJiBsZW4gIT09IDApIHtcbiAgICAgICAgICAgIGlmIChlYXRIZXhTZXF1ZW5jZS5jYWxsKHRoaXMsIG9mZnNldCArIGxlbiArIDEsIGZhbHNlKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpc0hleERpZ2l0JDMoY29kZSkpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoXG4gICAgICAgICAgICAgICAgYWxsb3dEYXNoICYmIGxlbiAhPT0gMFxuICAgICAgICAgICAgICAgICAgICA/ICdIeXBoZW5NaW51cycgKyAobGVuIDwgNiA/ICcgb3IgaGV4IGRpZ2l0JyA6ICcnKSArICcgaXMgZXhwZWN0ZWQnXG4gICAgICAgICAgICAgICAgICAgIDogKGxlbiA8IDYgPyAnSGV4IGRpZ2l0IGlzIGV4cGVjdGVkJyA6ICdVbmV4cGVjdGVkIGlucHV0JyksXG4gICAgICAgICAgICAgICAgcG9zXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCsrbGVuID4gNikge1xuICAgICAgICAgICAgdGhpcy5lcnJvcignVG9vIG1hbnkgaGV4IGRpZ2l0cycsIHBvcyk7XG4gICAgICAgIH0gICAgfVxuXG4gICAgdGhpcy5zY2FubmVyLm5leHQoKTtcbiAgICByZXR1cm4gbGVuO1xufVxuXG5mdW5jdGlvbiBlYXRRdWVzdGlvbk1hcmtTZXF1ZW5jZShtYXgpIHtcbiAgICB2YXIgY291bnQgPSAwO1xuXG4gICAgd2hpbGUgKHRoaXMuc2Nhbm5lci5pc0RlbGltKFFVRVNUSU9OTUFSSykpIHtcbiAgICAgICAgaWYgKCsrY291bnQgPiBtYXgpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1RvbyBtYW55IHF1ZXN0aW9uIG1hcmtzJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc3RhcnRzV2l0aChjb2RlKSB7XG4gICAgaWYgKHRoaXMuc2Nhbm5lci5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLnNjYW5uZXIudG9rZW5TdGFydCkgIT09IGNvZGUpIHtcbiAgICAgICAgdGhpcy5lcnJvcihOQU1FJDNbY29kZV0gKyAnIGlzIGV4cGVjdGVkJyk7XG4gICAgfVxufVxuXG4vLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXN5bnRheC8jdXJhbmdlXG4vLyBJbmZvcm1hbGx5LCB0aGUgPHVyYW5nZT4gcHJvZHVjdGlvbiBoYXMgdGhyZWUgZm9ybXM6XG4vLyBVKzAwMDFcbi8vICAgICAgRGVmaW5lcyBhIHJhbmdlIGNvbnNpc3Rpbmcgb2YgYSBzaW5nbGUgY29kZSBwb2ludCwgaW4gdGhpcyBjYXNlIHRoZSBjb2RlIHBvaW50IFwiMVwiLlxuLy8gVSswMDAxLTAwZmZcbi8vICAgICAgRGVmaW5lcyBhIHJhbmdlIG9mIGNvZGVwb2ludHMgYmV0d2VlbiB0aGUgZmlyc3QgYW5kIHRoZSBzZWNvbmQgdmFsdWUsIGluIHRoaXMgY2FzZVxuLy8gICAgICB0aGUgcmFuZ2UgYmV0d2VlbiBcIjFcIiBhbmQgXCJmZlwiICgyNTUgaW4gZGVjaW1hbCkgaW5jbHVzaXZlLlxuLy8gVSswMD8/XG4vLyAgICAgIERlZmluZXMgYSByYW5nZSBvZiBjb2RlcG9pbnRzIHdoZXJlIHRoZSBcIj9cIiBjaGFyYWN0ZXJzIHJhbmdlIG92ZXIgYWxsIGhleCBkaWdpdHMsXG4vLyAgICAgIGluIHRoaXMgY2FzZSBkZWZpbmluZyB0aGUgc2FtZSBhcyB0aGUgdmFsdWUgVSswMDAwLTAwZmYuXG4vLyBJbiBlYWNoIGZvcm0sIGEgbWF4aW11bSBvZiA2IGRpZ2l0cyBpcyBhbGxvd2VkIGZvciBlYWNoIGhleGFkZWNpbWFsIG51bWJlciAoaWYgeW91IHRyZWF0IFwiP1wiIGFzIGEgaGV4YWRlY2ltYWwgZGlnaXQpLlxuLy9cbi8vIDx1cmFuZ2U+ID1cbi8vICAgdSAnKycgPGlkZW50LXRva2VuPiAnPycqIHxcbi8vICAgdSA8ZGltZW5zaW9uLXRva2VuPiAnPycqIHxcbi8vICAgdSA8bnVtYmVyLXRva2VuPiAnPycqIHxcbi8vICAgdSA8bnVtYmVyLXRva2VuPiA8ZGltZW5zaW9uLXRva2VuPiB8XG4vLyAgIHUgPG51bWJlci10b2tlbj4gPG51bWJlci10b2tlbj4gfFxuLy8gICB1ICcrJyAnPycrXG5mdW5jdGlvbiBzY2FuVW5pY29kZVJhbmdlKCkge1xuICAgIHZhciBoZXhMZW5ndGggPSAwO1xuXG4gICAgLy8gdSAnKycgPGlkZW50LXRva2VuPiAnPycqXG4gICAgLy8gdSAnKycgJz8nK1xuICAgIGlmICh0aGlzLnNjYW5uZXIuaXNEZWxpbShQTFVTU0lHTiQ1KSkge1xuICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuXG4gICAgICAgIGlmICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlID09PSBJREVOVCRnKSB7XG4gICAgICAgICAgICBoZXhMZW5ndGggPSBlYXRIZXhTZXF1ZW5jZS5jYWxsKHRoaXMsIDAsIHRydWUpO1xuICAgICAgICAgICAgaWYgKGhleExlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBlYXRRdWVzdGlvbk1hcmtTZXF1ZW5jZS5jYWxsKHRoaXMsIDYgLSBoZXhMZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc2Nhbm5lci5pc0RlbGltKFFVRVNUSU9OTUFSSykpIHtcbiAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5uZXh0KCk7XG4gICAgICAgICAgICBlYXRRdWVzdGlvbk1hcmtTZXF1ZW5jZS5jYWxsKHRoaXMsIDUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lcnJvcignSGV4IGRpZ2l0IG9yIHF1ZXN0aW9uIG1hcmsgaXMgZXhwZWN0ZWQnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIHUgPG51bWJlci10b2tlbj4gJz8nKlxuICAgIC8vIHUgPG51bWJlci10b2tlbj4gPGRpbWVuc2lvbi10b2tlbj5cbiAgICAvLyB1IDxudW1iZXItdG9rZW4+IDxudW1iZXItdG9rZW4+XG4gICAgaWYgKHRoaXMuc2Nhbm5lci50b2tlblR5cGUgPT09IE5VTUJFUiQ3KSB7XG4gICAgICAgIHN0YXJ0c1dpdGguY2FsbCh0aGlzLCBQTFVTU0lHTiQ1KTtcbiAgICAgICAgaGV4TGVuZ3RoID0gZWF0SGV4U2VxdWVuY2UuY2FsbCh0aGlzLCAxLCB0cnVlKTtcblxuICAgICAgICBpZiAodGhpcy5zY2FubmVyLmlzRGVsaW0oUVVFU1RJT05NQVJLKSkge1xuICAgICAgICAgICAgZWF0UXVlc3Rpb25NYXJrU2VxdWVuY2UuY2FsbCh0aGlzLCA2IC0gaGV4TGVuZ3RoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlID09PSBESU1FTlNJT04kNSB8fFxuICAgICAgICAgICAgdGhpcy5zY2FubmVyLnRva2VuVHlwZSA9PT0gTlVNQkVSJDcpIHtcbiAgICAgICAgICAgIHN0YXJ0c1dpdGguY2FsbCh0aGlzLCBIWVBIRU5NSU5VUyQzKTtcbiAgICAgICAgICAgIGVhdEhleFNlcXVlbmNlLmNhbGwodGhpcywgMSwgZmFsc2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIHUgPGRpbWVuc2lvbi10b2tlbj4gJz8nKlxuICAgIGlmICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlID09PSBESU1FTlNJT04kNSkge1xuICAgICAgICBzdGFydHNXaXRoLmNhbGwodGhpcywgUExVU1NJR04kNSk7XG4gICAgICAgIGhleExlbmd0aCA9IGVhdEhleFNlcXVlbmNlLmNhbGwodGhpcywgMSwgdHJ1ZSk7XG5cbiAgICAgICAgaWYgKGhleExlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGVhdFF1ZXN0aW9uTWFya1NlcXVlbmNlLmNhbGwodGhpcywgNiAtIGhleExlbmd0aCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5lcnJvcigpO1xufVxuXG52YXIgVW5pY29kZVJhbmdlID0ge1xuICAgIG5hbWU6ICdVbmljb2RlUmFuZ2UnLFxuICAgIHN0cnVjdHVyZToge1xuICAgICAgICB2YWx1ZTogU3RyaW5nXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuXG4gICAgICAgIC8vIFUgb3IgdVxuICAgICAgICBpZiAoIWNtcENoYXIkMyh0aGlzLnNjYW5uZXIuc291cmNlLCBzdGFydCwgVSQxKSkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcignVSBpcyBleHBlY3RlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFjbXBDaGFyJDModGhpcy5zY2FubmVyLnNvdXJjZSwgc3RhcnQgKyAxLCBQTFVTU0lHTiQ1KSkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcignUGx1cyBzaWduIGlzIGV4cGVjdGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNjYW5uZXIubmV4dCgpO1xuICAgICAgICBzY2FuVW5pY29kZVJhbmdlLmNhbGwodGhpcyk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6ICdVbmljb2RlUmFuZ2UnLFxuICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCksXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5zY2FubmVyLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuayhub2RlLnZhbHVlKTtcbiAgICB9XG59O1xuXG52YXIgaXNXaGl0ZVNwYWNlJDIgPSB0b2tlbml6ZXIuaXNXaGl0ZVNwYWNlO1xudmFyIGNtcFN0ciQ1ID0gdG9rZW5pemVyLmNtcFN0cjtcbnZhciBUWVBFJEQgPSB0b2tlbml6ZXIuVFlQRTtcblxudmFyIEZVTkNUSU9OJDYgPSBUWVBFJEQuRnVuY3Rpb247XG52YXIgVVJMJDQgPSBUWVBFJEQuVXJsO1xudmFyIFJJR0hUUEFSRU5USEVTSVMkNSA9IFRZUEUkRC5SaWdodFBhcmVudGhlc2lzO1xuXG4vLyA8dXJsLXRva2VuPiB8IDxmdW5jdGlvbi10b2tlbj4gPHN0cmluZz4gKVxudmFyIFVybCA9IHtcbiAgICBuYW1lOiAnVXJsJyxcbiAgICBzdHJ1Y3R1cmU6IHtcbiAgICAgICAgdmFsdWU6IFsnU3RyaW5nJywgJ1JhdyddXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuICAgICAgICB2YXIgdmFsdWU7XG5cbiAgICAgICAgc3dpdGNoICh0aGlzLnNjYW5uZXIudG9rZW5UeXBlKSB7XG4gICAgICAgICAgICBjYXNlIFVSTCQ0OlxuICAgICAgICAgICAgICAgIHZhciByYXdTdGFydCA9IHN0YXJ0ICsgNDtcbiAgICAgICAgICAgICAgICB2YXIgcmF3RW5kID0gdGhpcy5zY2FubmVyLnRva2VuRW5kIC0gMTtcblxuICAgICAgICAgICAgICAgIHdoaWxlIChyYXdTdGFydCA8IHJhd0VuZCAmJiBpc1doaXRlU3BhY2UkMih0aGlzLnNjYW5uZXIuc291cmNlLmNoYXJDb2RlQXQocmF3U3RhcnQpKSkge1xuICAgICAgICAgICAgICAgICAgICByYXdTdGFydCsrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHdoaWxlIChyYXdTdGFydCA8IHJhd0VuZCAmJiBpc1doaXRlU3BhY2UkMih0aGlzLnNjYW5uZXIuc291cmNlLmNoYXJDb2RlQXQocmF3RW5kIC0gMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhd0VuZC0tO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhbHVlID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUmF3JyxcbiAgICAgICAgICAgICAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHJhd1N0YXJ0LCByYXdFbmQpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zY2FubmVyLnNvdXJjZS5zdWJzdHJpbmcocmF3U3RhcnQsIHJhd0VuZClcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5lYXQoVVJMJDQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIEZVTkNUSU9OJDY6XG4gICAgICAgICAgICAgICAgaWYgKCFjbXBTdHIkNSh0aGlzLnNjYW5uZXIuc291cmNlLCB0aGlzLnNjYW5uZXIudG9rZW5TdGFydCwgdGhpcy5zY2FubmVyLnRva2VuRW5kLCAndXJsKCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0Z1bmN0aW9uIG5hbWUgbXVzdCBiZSBgdXJsYCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuZWF0KEZVTkNUSU9OJDYpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2Nhbm5lci5za2lwU0MoKTtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FubmVyLnNraXBTQygpO1xuICAgICAgICAgICAgICAgIHRoaXMuZWF0KFJJR0hUUEFSRU5USEVTSVMkNSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcignVXJsIG9yIEZ1bmN0aW9uIGlzIGV4cGVjdGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ1VybCcsXG4gICAgICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0KSxcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgICB9O1xuICAgIH0sXG4gICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgdGhpcy5jaHVuaygndXJsJyk7XG4gICAgICAgIHRoaXMuY2h1bmsoJygnKTtcbiAgICAgICAgdGhpcy5ub2RlKG5vZGUudmFsdWUpO1xuICAgICAgICB0aGlzLmNodW5rKCcpJyk7XG4gICAgfVxufTtcblxudmFyIFZhbHVlID0ge1xuICAgIG5hbWU6ICdWYWx1ZScsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIGNoaWxkcmVuOiBbW11dXG4gICAgfSxcbiAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuc2Nhbm5lci50b2tlblN0YXJ0O1xuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLnJlYWRTZXF1ZW5jZSh0aGlzLnNjb3BlLlZhbHVlKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ1ZhbHVlJyxcbiAgICAgICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy5zY2FubmVyLnRva2VuU3RhcnQpLFxuICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNoaWxkcmVuKG5vZGUpO1xuICAgIH1cbn07XG5cbnZhciBXSElURVNQQUNFJGIgPSB0b2tlbml6ZXIuVFlQRS5XaGl0ZVNwYWNlO1xudmFyIFNQQUNFID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgdHlwZTogJ1doaXRlU3BhY2UnLFxuICAgIGxvYzogbnVsbCxcbiAgICB2YWx1ZTogJyAnXG59KTtcblxudmFyIFdoaXRlU3BhY2UkMSA9IHtcbiAgICBuYW1lOiAnV2hpdGVTcGFjZScsXG4gICAgc3RydWN0dXJlOiB7XG4gICAgICAgIHZhbHVlOiBTdHJpbmdcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5lYXQoV0hJVEVTUEFDRSRiKTtcbiAgICAgICAgcmV0dXJuIFNQQUNFO1xuXG4gICAgICAgIC8vIHJldHVybiB7XG4gICAgICAgIC8vICAgICB0eXBlOiAnV2hpdGVTcGFjZScsXG4gICAgICAgIC8vICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24odGhpcy5zY2FubmVyLnRva2VuU3RhcnQsIHRoaXMuc2Nhbm5lci50b2tlbkVuZCksXG4gICAgICAgIC8vICAgICB2YWx1ZTogdGhpcy5jb25zdW1lKFdISVRFU1BBQ0UpXG4gICAgICAgIC8vIH07XG4gICAgfSxcbiAgICBnZW5lcmF0ZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB0aGlzLmNodW5rKG5vZGUudmFsdWUpO1xuICAgIH1cbn07XG5cbnZhciBub2RlID0ge1xuICAgIEFuUGx1c0I6IEFuUGx1c0IsXG4gICAgQXRydWxlOiBBdHJ1bGUsXG4gICAgQXRydWxlUHJlbHVkZTogQXRydWxlUHJlbHVkZSxcbiAgICBBdHRyaWJ1dGVTZWxlY3RvcjogQXR0cmlidXRlU2VsZWN0b3IsXG4gICAgQmxvY2s6IEJsb2NrLFxuICAgIEJyYWNrZXRzOiBCcmFja2V0cyxcbiAgICBDREM6IENEQ18xLFxuICAgIENETzogQ0RPXzEsXG4gICAgQ2xhc3NTZWxlY3RvcjogQ2xhc3NTZWxlY3RvcixcbiAgICBDb21iaW5hdG9yOiBDb21iaW5hdG9yLFxuICAgIENvbW1lbnQ6IENvbW1lbnQsXG4gICAgRGVjbGFyYXRpb246IERlY2xhcmF0aW9uLFxuICAgIERlY2xhcmF0aW9uTGlzdDogRGVjbGFyYXRpb25MaXN0LFxuICAgIERpbWVuc2lvbjogRGltZW5zaW9uLFxuICAgIEZ1bmN0aW9uOiBfRnVuY3Rpb24sXG4gICAgSGFzaDogSGFzaCxcbiAgICBJZGVudGlmaWVyOiBJZGVudGlmaWVyLFxuICAgIElkU2VsZWN0b3I6IElkU2VsZWN0b3IsXG4gICAgTWVkaWFGZWF0dXJlOiBNZWRpYUZlYXR1cmUsXG4gICAgTWVkaWFRdWVyeTogTWVkaWFRdWVyeSxcbiAgICBNZWRpYVF1ZXJ5TGlzdDogTWVkaWFRdWVyeUxpc3QsXG4gICAgTnRoOiBOdGgsXG4gICAgTnVtYmVyOiBfTnVtYmVyLFxuICAgIE9wZXJhdG9yOiBPcGVyYXRvcixcbiAgICBQYXJlbnRoZXNlczogUGFyZW50aGVzZXMsXG4gICAgUGVyY2VudGFnZTogUGVyY2VudGFnZSxcbiAgICBQc2V1ZG9DbGFzc1NlbGVjdG9yOiBQc2V1ZG9DbGFzc1NlbGVjdG9yLFxuICAgIFBzZXVkb0VsZW1lbnRTZWxlY3RvcjogUHNldWRvRWxlbWVudFNlbGVjdG9yLFxuICAgIFJhdGlvOiBSYXRpbyxcbiAgICBSYXc6IFJhdyxcbiAgICBSdWxlOiBSdWxlLFxuICAgIFNlbGVjdG9yOiBTZWxlY3RvcixcbiAgICBTZWxlY3Rvckxpc3Q6IFNlbGVjdG9yTGlzdCxcbiAgICBTdHJpbmc6IF9TdHJpbmcsXG4gICAgU3R5bGVTaGVldDogU3R5bGVTaGVldCxcbiAgICBUeXBlU2VsZWN0b3I6IFR5cGVTZWxlY3RvcixcbiAgICBVbmljb2RlUmFuZ2U6IFVuaWNvZGVSYW5nZSxcbiAgICBVcmw6IFVybCxcbiAgICBWYWx1ZTogVmFsdWUsXG4gICAgV2hpdGVTcGFjZTogV2hpdGVTcGFjZSQxXG59O1xuXG52YXIgcGFyc2VyID0ge1xuICAgIHBhcnNlQ29udGV4dDoge1xuICAgICAgICBkZWZhdWx0OiAnU3R5bGVTaGVldCcsXG4gICAgICAgIHN0eWxlc2hlZXQ6ICdTdHlsZVNoZWV0JyxcbiAgICAgICAgYXRydWxlOiAnQXRydWxlJyxcbiAgICAgICAgYXRydWxlUHJlbHVkZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXRydWxlUHJlbHVkZShvcHRpb25zLmF0cnVsZSA/IFN0cmluZyhvcHRpb25zLmF0cnVsZSkgOiBudWxsKTtcbiAgICAgICAgfSxcbiAgICAgICAgbWVkaWFRdWVyeUxpc3Q6ICdNZWRpYVF1ZXJ5TGlzdCcsXG4gICAgICAgIG1lZGlhUXVlcnk6ICdNZWRpYVF1ZXJ5JyxcbiAgICAgICAgcnVsZTogJ1J1bGUnLFxuICAgICAgICBzZWxlY3Rvckxpc3Q6ICdTZWxlY3Rvckxpc3QnLFxuICAgICAgICBzZWxlY3RvcjogJ1NlbGVjdG9yJyxcbiAgICAgICAgYmxvY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2sodHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRlY2xhcmF0aW9uTGlzdDogJ0RlY2xhcmF0aW9uTGlzdCcsXG4gICAgICAgIGRlY2xhcmF0aW9uOiAnRGVjbGFyYXRpb24nLFxuICAgICAgICB2YWx1ZTogJ1ZhbHVlJ1xuICAgIH0sXG4gICAgc2NvcGU6IHNjb3BlLFxuICAgIGF0cnVsZTogYXRydWxlLFxuICAgIHBzZXVkbzogcHNldWRvLFxuICAgIG5vZGU6IG5vZGVcbn07XG5cbnZhciBwYXJzZXIkMSA9IGNyZWF0ZShwYXJzZXIpO1xuXG5mdW5jdGlvbiByZWFkX3N0eWxlKHBhcnNlciwgc3RhcnQsIGF0dHJpYnV0ZXMpIHtcbiAgICBjb25zdCBjb250ZW50X3N0YXJ0ID0gcGFyc2VyLmluZGV4O1xuICAgIGNvbnN0IHN0eWxlcyA9IHBhcnNlci5yZWFkX3VudGlsKC88XFwvc3R5bGVcXHMqPi8sIHBhcnNlcl9lcnJvcnMudW5jbG9zZWRfc3R5bGUpO1xuICAgIGlmIChwYXJzZXIuaW5kZXggPj0gcGFyc2VyLnRlbXBsYXRlLmxlbmd0aCkge1xuICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy51bmNsb3NlZF9zdHlsZSk7XG4gICAgfVxuICAgIGNvbnN0IGNvbnRlbnRfZW5kID0gcGFyc2VyLmluZGV4O1xuICAgIGxldCBhc3Q7XG4gICAgdHJ5IHtcbiAgICAgICAgYXN0ID0gcGFyc2VyJDEoc3R5bGVzLCB7XG4gICAgICAgICAgICBwb3NpdGlvbnM6IHRydWUsXG4gICAgICAgICAgICBvZmZzZXQ6IGNvbnRlbnRfc3RhcnQsXG4gICAgICAgICAgICBvblBhcnNlRXJyb3IoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgaWYgKGVyci5uYW1lID09PSAnU3ludGF4RXJyb3InKSB7XG4gICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5jc3Nfc3ludGF4X2Vycm9yKGVyci5tZXNzYWdlKSwgZXJyLm9mZnNldCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShhc3QpKTtcbiAgICAvLyB0aWR5IHVwIEFTVFxuICAgIHdhbGsoYXN0LCB7XG4gICAgICAgIGVudGVyOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgLy8gcmVwbGFjZSBgcmVmOmFgIG5vZGVzXG4gICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnU2VsZWN0b3InKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBub2RlLmNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gbm9kZS5jaGlsZHJlbltpICsgMV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc19yZWZfc2VsZWN0b3IoYSwgYikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLmludmFsaWRfcmVmX3NlbGVjdG9yLCBhLmxvYy5zdGFydC5vZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0RlY2xhcmF0aW9uJyAmJiBub2RlLnZhbHVlLnR5cGUgPT09ICdWYWx1ZScgJiYgbm9kZS52YWx1ZS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5pbnZhbGlkX2RlY2xhcmF0aW9uLCBub2RlLnN0YXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdQc2V1ZG9DbGFzc1NlbGVjdG9yJyAmJiBub2RlLm5hbWUgPT09ICdnbG9iYWwnICYmIG5vZGUuY2hpbGRyZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5lbXB0eV9nbG9iYWxfc2VsZWN0b3IsIG5vZGUubG9jLnN0YXJ0Lm9mZnNldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobm9kZS5sb2MpIHtcbiAgICAgICAgICAgICAgICBub2RlLnN0YXJ0ID0gbm9kZS5sb2Muc3RhcnQub2Zmc2V0O1xuICAgICAgICAgICAgICAgIG5vZGUuZW5kID0gbm9kZS5sb2MuZW5kLm9mZnNldDtcbiAgICAgICAgICAgICAgICBkZWxldGUgbm9kZS5sb2M7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBwYXJzZXIucmVhZCgvPFxcL3N0eWxlXFxzKj4vKTtcbiAgICBjb25zdCBlbmQgPSBwYXJzZXIuaW5kZXg7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogJ1N0eWxlJyxcbiAgICAgICAgc3RhcnQsXG4gICAgICAgIGVuZCxcbiAgICAgICAgYXR0cmlidXRlcyxcbiAgICAgICAgY2hpbGRyZW46IGFzdC5jaGlsZHJlbixcbiAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgc3RhcnQ6IGNvbnRlbnRfc3RhcnQsXG4gICAgICAgICAgICBlbmQ6IGNvbnRlbnRfZW5kLFxuICAgICAgICAgICAgc3R5bGVzXG4gICAgICAgIH1cbiAgICB9O1xufVxuZnVuY3Rpb24gaXNfcmVmX3NlbGVjdG9yKGEsIGIpIHtcbiAgICBpZiAoIWIpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gKGEudHlwZSA9PT0gJ1R5cGVTZWxlY3RvcicgJiZcbiAgICAgICAgYS5uYW1lID09PSAncmVmJyAmJlxuICAgICAgICBiLnR5cGUgPT09ICdQc2V1ZG9DbGFzc1NlbGVjdG9yJyk7XG59XG5cbi8vIGh0dHBzOi8vZGV2LnczLm9yZy9odG1sNS9odG1sLWF1dGhvci9jaGFycmVmXG52YXIgZW50aXRpZXMgPSB7XG4gICAgQ291bnRlckNsb2Nrd2lzZUNvbnRvdXJJbnRlZ3JhbDogODc1NSxcbiAgICBDbG9ja3dpc2VDb250b3VySW50ZWdyYWw6IDg3NTQsXG4gICAgRG91YmxlTG9uZ0xlZnRSaWdodEFycm93OiAxMDIzNCxcbiAgICBEaWFjcml0aWNhbERvdWJsZUFjdXRlOiA3MzMsXG4gICAgTm90U3F1YXJlU3VwZXJzZXRFcXVhbDogODkzMSxcbiAgICBDbG9zZUN1cmx5RG91YmxlUXVvdGU6IDgyMjEsXG4gICAgRG91YmxlQ29udG91ckludGVncmFsOiA4NzUxLFxuICAgIEZpbGxlZFZlcnlTbWFsbFNxdWFyZTogOTY0MixcbiAgICBOZWdhdGl2ZVZlcnlUaGluU3BhY2U6IDgyMDMsXG4gICAgTm90UHJlY2VkZXNTbGFudEVxdWFsOiA4OTI4LFxuICAgIE5vdFJpZ2h0VHJpYW5nbGVFcXVhbDogODk0MSxcbiAgICBOb3RTdWNjZWVkc1NsYW50RXF1YWw6IDg5MjksXG4gICAgQ2FwaXRhbERpZmZlcmVudGlhbEQ6IDg1MTcsXG4gICAgRG91YmxlTGVmdFJpZ2h0QXJyb3c6IDg2NjAsXG4gICAgRG91YmxlTG9uZ1JpZ2h0QXJyb3c6IDEwMjMzLFxuICAgIEVtcHR5VmVyeVNtYWxsU3F1YXJlOiA5NjQzLFxuICAgIE5lc3RlZEdyZWF0ZXJHcmVhdGVyOiA4ODExLFxuICAgIE5vdERvdWJsZVZlcnRpY2FsQmFyOiA4NzQyLFxuICAgIE5vdExlZnRUcmlhbmdsZUVxdWFsOiA4OTQwLFxuICAgIE5vdFNxdWFyZVN1YnNldEVxdWFsOiA4OTMwLFxuICAgIE9wZW5DdXJseURvdWJsZVF1b3RlOiA4MjIwLFxuICAgIFJldmVyc2VVcEVxdWlsaWJyaXVtOiAxMDYwNyxcbiAgICBEb3VibGVMb25nTGVmdEFycm93OiAxMDIzMixcbiAgICBEb3duTGVmdFJpZ2h0VmVjdG9yOiAxMDU3NixcbiAgICBMZWZ0QXJyb3dSaWdodEFycm93OiA4NjQ2LFxuICAgIE5lZ2F0aXZlTWVkaXVtU3BhY2U6IDgyMDMsXG4gICAgUmlnaHRBcnJvd0xlZnRBcnJvdzogODY0NCxcbiAgICBTcXVhcmVTdXBlcnNldEVxdWFsOiA4ODUwLFxuICAgIGxlZnRyaWdodHNxdWlnYXJyb3c6IDg2MjEsXG4gICAgRG93blJpZ2h0VGVlVmVjdG9yOiAxMDU5MSxcbiAgICBEb3duUmlnaHRWZWN0b3JCYXI6IDEwNTgzLFxuICAgIExvbmdMZWZ0UmlnaHRBcnJvdzogMTAyMzEsXG4gICAgTG9uZ2xlZnRyaWdodGFycm93OiAxMDIzNCxcbiAgICBOZWdhdGl2ZVRoaWNrU3BhY2U6IDgyMDMsXG4gICAgUHJlY2VkZXNTbGFudEVxdWFsOiA4ODI4LFxuICAgIFJldmVyc2VFcXVpbGlicml1bTogODY1MSxcbiAgICBSaWdodERvdWJsZUJyYWNrZXQ6IDEwMjE1LFxuICAgIFJpZ2h0RG93blRlZVZlY3RvcjogMTA1ODksXG4gICAgUmlnaHREb3duVmVjdG9yQmFyOiAxMDU4MSxcbiAgICBSaWdodFRyaWFuZ2xlRXF1YWw6IDg4ODUsXG4gICAgU3F1YXJlSW50ZXJzZWN0aW9uOiA4ODUxLFxuICAgIFN1Y2NlZWRzU2xhbnRFcXVhbDogODgyOSxcbiAgICBibGFja3RyaWFuZ2xlcmlnaHQ6IDk2NTYsXG4gICAgbG9uZ2xlZnRyaWdodGFycm93OiAxMDIzMSxcbiAgICBEb3VibGVVcERvd25BcnJvdzogODY2MSxcbiAgICBEb3VibGVWZXJ0aWNhbEJhcjogODc0MSxcbiAgICBEb3duTGVmdFRlZVZlY3RvcjogMTA1OTAsXG4gICAgRG93bkxlZnRWZWN0b3JCYXI6IDEwNTgyLFxuICAgIEZpbGxlZFNtYWxsU3F1YXJlOiA5NzI0LFxuICAgIEdyZWF0ZXJTbGFudEVxdWFsOiAxMDg3OCxcbiAgICBMZWZ0RG91YmxlQnJhY2tldDogMTAyMTQsXG4gICAgTGVmdERvd25UZWVWZWN0b3I6IDEwNTkzLFxuICAgIExlZnREb3duVmVjdG9yQmFyOiAxMDU4NSxcbiAgICBMZWZ0VHJpYW5nbGVFcXVhbDogODg4NCxcbiAgICBOZWdhdGl2ZVRoaW5TcGFjZTogODIwMyxcbiAgICBOb3RSZXZlcnNlRWxlbWVudDogODcxNixcbiAgICBOb3RUaWxkZUZ1bGxFcXVhbDogODc3NSxcbiAgICBSaWdodEFuZ2xlQnJhY2tldDogMTAyMTcsXG4gICAgUmlnaHRVcERvd25WZWN0b3I6IDEwNTc1LFxuICAgIFNxdWFyZVN1YnNldEVxdWFsOiA4ODQ5LFxuICAgIFZlcnRpY2FsU2VwYXJhdG9yOiAxMDA3MixcbiAgICBibGFja3RyaWFuZ2xlZG93bjogOTY2MixcbiAgICBibGFja3RyaWFuZ2xlbGVmdDogOTY2NixcbiAgICBsZWZ0cmlnaHRoYXJwb29uczogODY1MSxcbiAgICByaWdodGxlZnRoYXJwb29uczogODY1MixcbiAgICB0d29oZWFkcmlnaHRhcnJvdzogODYwOCxcbiAgICBEaWFjcml0aWNhbEFjdXRlOiAxODAsXG4gICAgRGlhY3JpdGljYWxHcmF2ZTogOTYsXG4gICAgRGlhY3JpdGljYWxUaWxkZTogNzMyLFxuICAgIERvdWJsZVJpZ2h0QXJyb3c6IDg2NTgsXG4gICAgRG93bkFycm93VXBBcnJvdzogODY5MyxcbiAgICBFbXB0eVNtYWxsU3F1YXJlOiA5NzIzLFxuICAgIEdyZWF0ZXJFcXVhbExlc3M6IDg5MjMsXG4gICAgR3JlYXRlckZ1bGxFcXVhbDogODgwNyxcbiAgICBMZWZ0QW5nbGVCcmFja2V0OiAxMDIxNixcbiAgICBMZWZ0VXBEb3duVmVjdG9yOiAxMDU3NyxcbiAgICBMZXNzRXF1YWxHcmVhdGVyOiA4OTIyLFxuICAgIE5vbkJyZWFraW5nU3BhY2U6IDE2MCxcbiAgICBOb3RSaWdodFRyaWFuZ2xlOiA4OTM5LFxuICAgIE5vdFN1cGVyc2V0RXF1YWw6IDg4NDEsXG4gICAgUmlnaHRUcmlhbmdsZUJhcjogMTA3MDQsXG4gICAgUmlnaHRVcFRlZVZlY3RvcjogMTA1ODgsXG4gICAgUmlnaHRVcFZlY3RvckJhcjogMTA1ODAsXG4gICAgVW5kZXJQYXJlbnRoZXNpczogOTE4MSxcbiAgICBVcEFycm93RG93bkFycm93OiA4NjQ1LFxuICAgIGNpcmNsZWFycm93cmlnaHQ6IDg2MzUsXG4gICAgZG93bmhhcnBvb25yaWdodDogODY0MixcbiAgICBudHJpYW5nbGVyaWdodGVxOiA4OTQxLFxuICAgIHJpZ2h0aGFycG9vbmRvd246IDg2NDEsXG4gICAgcmlnaHRyaWdodGFycm93czogODY0OSxcbiAgICB0d29oZWFkbGVmdGFycm93OiA4NjA2LFxuICAgIHZhcnRyaWFuZ2xlcmlnaHQ6IDg4ODMsXG4gICAgQ2xvc2VDdXJseVF1b3RlOiA4MjE3LFxuICAgIENvbnRvdXJJbnRlZ3JhbDogODc1MCxcbiAgICBEb3VibGVEb3duQXJyb3c6IDg2NTksXG4gICAgRG91YmxlTGVmdEFycm93OiA4NjU2LFxuICAgIERvd25SaWdodFZlY3RvcjogODY0MSxcbiAgICBMZWZ0UmlnaHRWZWN0b3I6IDEwNTc0LFxuICAgIExlZnRUcmlhbmdsZUJhcjogMTA3MDMsXG4gICAgTGVmdFVwVGVlVmVjdG9yOiAxMDU5MixcbiAgICBMZWZ0VXBWZWN0b3JCYXI6IDEwNTg0LFxuICAgIExvd2VyUmlnaHRBcnJvdzogODYwMCxcbiAgICBOb3RHcmVhdGVyRXF1YWw6IDg4MTcsXG4gICAgTm90R3JlYXRlclRpbGRlOiA4ODIxLFxuICAgIE5vdExlZnRUcmlhbmdsZTogODkzOCxcbiAgICBPdmVyUGFyZW50aGVzaXM6IDkxODAsXG4gICAgUmlnaHREb3duVmVjdG9yOiA4NjQyLFxuICAgIFNob3J0UmlnaHRBcnJvdzogODU5NCxcbiAgICBVcHBlclJpZ2h0QXJyb3c6IDg1OTksXG4gICAgYmlndHJpYW5nbGVkb3duOiA5NjYxLFxuICAgIGNpcmNsZWFycm93bGVmdDogODYzNCxcbiAgICBjdXJ2ZWFycm93cmlnaHQ6IDg2MzEsXG4gICAgZG93bmhhcnBvb25sZWZ0OiA4NjQzLFxuICAgIGxlZnRoYXJwb29uZG93bjogODYzNyxcbiAgICBsZWZ0cmlnaHRhcnJvd3M6IDg2NDYsXG4gICAgbkxlZnRyaWdodGFycm93OiA4NjU0LFxuICAgIG5sZWZ0cmlnaHRhcnJvdzogODYyMixcbiAgICBudHJpYW5nbGVsZWZ0ZXE6IDg5NDAsXG4gICAgcmlnaHRsZWZ0YXJyb3dzOiA4NjQ0LFxuICAgIHJpZ2h0c3F1aWdhcnJvdzogODYwNSxcbiAgICByaWdodHRocmVldGltZXM6IDg5MDgsXG4gICAgc3RyYWlnaHRlcHNpbG9uOiAxMDEzLFxuICAgIHRyaWFuZ2xlcmlnaHRlcTogODg4NSxcbiAgICB2YXJ0cmlhbmdsZWxlZnQ6IDg4ODIsXG4gICAgRGlhY3JpdGljYWxEb3Q6IDcyOSxcbiAgICBEb3VibGVSaWdodFRlZTogODg3MixcbiAgICBEb3duTGVmdFZlY3RvcjogODYzNyxcbiAgICBHcmVhdGVyR3JlYXRlcjogMTA5MTQsXG4gICAgSG9yaXpvbnRhbExpbmU6IDk0NzIsXG4gICAgSW52aXNpYmxlQ29tbWE6IDgyOTEsXG4gICAgSW52aXNpYmxlVGltZXM6IDgyOTAsXG4gICAgTGVmdERvd25WZWN0b3I6IDg2NDMsXG4gICAgTGVmdFJpZ2h0QXJyb3c6IDg1OTYsXG4gICAgTGVmdHJpZ2h0YXJyb3c6IDg2NjAsXG4gICAgTGVzc1NsYW50RXF1YWw6IDEwODc3LFxuICAgIExvbmdSaWdodEFycm93OiAxMDIzMCxcbiAgICBMb25ncmlnaHRhcnJvdzogMTAyMzMsXG4gICAgTG93ZXJMZWZ0QXJyb3c6IDg2MDEsXG4gICAgTmVzdGVkTGVzc0xlc3M6IDg4MTAsXG4gICAgTm90R3JlYXRlckxlc3M6IDg4MjUsXG4gICAgTm90TGVzc0dyZWF0ZXI6IDg4MjQsXG4gICAgTm90U3Vic2V0RXF1YWw6IDg4NDAsXG4gICAgTm90VmVydGljYWxCYXI6IDg3NDAsXG4gICAgT3BlbkN1cmx5UXVvdGU6IDgyMTYsXG4gICAgUmV2ZXJzZUVsZW1lbnQ6IDg3MTUsXG4gICAgUmlnaHRUZWVWZWN0b3I6IDEwNTg3LFxuICAgIFJpZ2h0VmVjdG9yQmFyOiAxMDU3OSxcbiAgICBTaG9ydERvd25BcnJvdzogODU5NSxcbiAgICBTaG9ydExlZnRBcnJvdzogODU5MixcbiAgICBTcXVhcmVTdXBlcnNldDogODg0OCxcbiAgICBUaWxkZUZ1bGxFcXVhbDogODc3MyxcbiAgICBVcHBlckxlZnRBcnJvdzogODU5OCxcbiAgICBaZXJvV2lkdGhTcGFjZTogODIwMyxcbiAgICBjdXJ2ZWFycm93bGVmdDogODYzMCxcbiAgICBkb3VibGViYXJ3ZWRnZTogODk2NixcbiAgICBkb3duZG93bmFycm93czogODY1MCxcbiAgICBob29rcmlnaHRhcnJvdzogODYxOCxcbiAgICBsZWZ0bGVmdGFycm93czogODY0NyxcbiAgICBsZWZ0cmlnaHRhcnJvdzogODU5NixcbiAgICBsZWZ0dGhyZWV0aW1lczogODkwNyxcbiAgICBsb25ncmlnaHRhcnJvdzogMTAyMzAsXG4gICAgbG9vcGFycm93cmlnaHQ6IDg2MjAsXG4gICAgbnNob3J0cGFyYWxsZWw6IDg3NDIsXG4gICAgbnRyaWFuZ2xlcmlnaHQ6IDg5MzksXG4gICAgcmlnaHRhcnJvd3RhaWw6IDg2MTEsXG4gICAgcmlnaHRoYXJwb29udXA6IDg2NDAsXG4gICAgdHJpYW5nbGVsZWZ0ZXE6IDg4ODQsXG4gICAgdXBoYXJwb29ucmlnaHQ6IDg2MzgsXG4gICAgQXBwbHlGdW5jdGlvbjogODI4OSxcbiAgICBEaWZmZXJlbnRpYWxEOiA4NTE4LFxuICAgIERvdWJsZUxlZnRUZWU6IDEwOTgwLFxuICAgIERvdWJsZVVwQXJyb3c6IDg2NTcsXG4gICAgTGVmdFRlZVZlY3RvcjogMTA1ODYsXG4gICAgTGVmdFZlY3RvckJhcjogMTA1NzgsXG4gICAgTGVzc0Z1bGxFcXVhbDogODgwNixcbiAgICBMb25nTGVmdEFycm93OiAxMDIyOSxcbiAgICBMb25nbGVmdGFycm93OiAxMDIzMixcbiAgICBOb3RUaWxkZUVxdWFsOiA4NzcyLFxuICAgIE5vdFRpbGRlVGlsZGU6IDg3NzcsXG4gICAgUG9pbmNhcmVwbGFuZTogODQ2MCxcbiAgICBQcmVjZWRlc0VxdWFsOiAxMDkyNyxcbiAgICBQcmVjZWRlc1RpbGRlOiA4ODMwLFxuICAgIFJpZ2h0QXJyb3dCYXI6IDg2NzcsXG4gICAgUmlnaHRUZWVBcnJvdzogODYxNCxcbiAgICBSaWdodFRyaWFuZ2xlOiA4ODgzLFxuICAgIFJpZ2h0VXBWZWN0b3I6IDg2MzgsXG4gICAgU3VjY2VlZHNFcXVhbDogMTA5MjgsXG4gICAgU3VjY2VlZHNUaWxkZTogODgzMSxcbiAgICBTdXBlcnNldEVxdWFsOiA4ODM5LFxuICAgIFVwRXF1aWxpYnJpdW06IDEwNjA2LFxuICAgIFZlcnRpY2FsVGlsZGU6IDg3NjgsXG4gICAgVmVyeVRoaW5TcGFjZTogODIwMixcbiAgICBiaWd0cmlhbmdsZXVwOiA5NjUxLFxuICAgIGJsYWNrdHJpYW5nbGU6IDk2NTIsXG4gICAgZGl2aWRlb250aW1lczogODkwMyxcbiAgICBmYWxsaW5nZG90c2VxOiA4Nzg2LFxuICAgIGhvb2tsZWZ0YXJyb3c6IDg2MTcsXG4gICAgbGVmdGFycm93dGFpbDogODYxMCxcbiAgICBsZWZ0aGFycG9vbnVwOiA4NjM2LFxuICAgIGxvbmdsZWZ0YXJyb3c6IDEwMjI5LFxuICAgIGxvb3BhcnJvd2xlZnQ6IDg2MTksXG4gICAgbWVhc3VyZWRhbmdsZTogODczNyxcbiAgICBudHJpYW5nbGVsZWZ0OiA4OTM4LFxuICAgIHNob3J0cGFyYWxsZWw6IDg3NDEsXG4gICAgc21hbGxzZXRtaW51czogODcyNixcbiAgICB0cmlhbmdsZXJpZ2h0OiA5NjU3LFxuICAgIHVwaGFycG9vbmxlZnQ6IDg2MzksXG4gICAgRG93bkFycm93QmFyOiAxMDUxNSxcbiAgICBEb3duVGVlQXJyb3c6IDg2MTUsXG4gICAgRXhwb25lbnRpYWxFOiA4NTE5LFxuICAgIEdyZWF0ZXJFcXVhbDogODgwNSxcbiAgICBHcmVhdGVyVGlsZGU6IDg4MTksXG4gICAgSGlsYmVydFNwYWNlOiA4NDU5LFxuICAgIEh1bXBEb3duSHVtcDogODc4MixcbiAgICBJbnRlcnNlY3Rpb246IDg4OTgsXG4gICAgTGVmdEFycm93QmFyOiA4Njc2LFxuICAgIExlZnRUZWVBcnJvdzogODYxMixcbiAgICBMZWZ0VHJpYW5nbGU6IDg4ODIsXG4gICAgTGVmdFVwVmVjdG9yOiA4NjM5LFxuICAgIE5vdENvbmdydWVudDogODgwMixcbiAgICBOb3RMZXNzRXF1YWw6IDg4MTYsXG4gICAgTm90TGVzc1RpbGRlOiA4ODIwLFxuICAgIFByb3BvcnRpb25hbDogODczMyxcbiAgICBSaWdodENlaWxpbmc6IDg5NjksXG4gICAgUm91bmRJbXBsaWVzOiAxMDYwOCxcbiAgICBTaG9ydFVwQXJyb3c6IDg1OTMsXG4gICAgU3F1YXJlU3Vic2V0OiA4ODQ3LFxuICAgIFVuZGVyQnJhY2tldDogOTE0MSxcbiAgICBWZXJ0aWNhbExpbmU6IDEyNCxcbiAgICBibGFja2xvemVuZ2U6IDEwNzMxLFxuICAgIGV4cG9uZW50aWFsZTogODUxOSxcbiAgICByaXNpbmdkb3RzZXE6IDg3ODcsXG4gICAgdHJpYW5nbGVkb3duOiA5NjYzLFxuICAgIHRyaWFuZ2xlbGVmdDogOTY2NyxcbiAgICBDaXJjbGVNaW51czogODg1NCxcbiAgICBDaXJjbGVUaW1lczogODg1NSxcbiAgICBFcXVpbGlicml1bTogODY1MixcbiAgICBHcmVhdGVyTGVzczogODgyMyxcbiAgICBMZWZ0Q2VpbGluZzogODk2OCxcbiAgICBMZXNzR3JlYXRlcjogODgyMixcbiAgICBNZWRpdW1TcGFjZTogODI4NyxcbiAgICBOb3RQcmVjZWRlczogODgzMixcbiAgICBOb3RTdWNjZWVkczogODgzMyxcbiAgICBPdmVyQnJhY2tldDogOTE0MCxcbiAgICBSaWdodFZlY3RvcjogODY0MCxcbiAgICBScmlnaHRhcnJvdzogODY2NyxcbiAgICBSdWxlRGVsYXllZDogMTA3NDAsXG4gICAgU21hbGxDaXJjbGU6IDg3MjgsXG4gICAgU3F1YXJlVW5pb246IDg4NTIsXG4gICAgU3Vic2V0RXF1YWw6IDg4MzgsXG4gICAgVXBEb3duQXJyb3c6IDg1OTcsXG4gICAgVXBkb3duYXJyb3c6IDg2NjEsXG4gICAgVmVydGljYWxCYXI6IDg3MzksXG4gICAgYmFja2Vwc2lsb246IDEwMTQsXG4gICAgYmxhY2tzcXVhcmU6IDk2NDIsXG4gICAgY2lyY2xlZGNpcmM6IDg4NTgsXG4gICAgY2lyY2xlZGRhc2g6IDg4NjEsXG4gICAgY3VybHllcXByZWM6IDg5MjYsXG4gICAgY3VybHllcXN1Y2M6IDg5MjcsXG4gICAgZGlhbW9uZHN1aXQ6IDk4MzAsXG4gICAgZXFzbGFudGxlc3M6IDEwOTAxLFxuICAgIGV4cGVjdGF0aW9uOiA4NDk2LFxuICAgIG5SaWdodGFycm93OiA4NjU1LFxuICAgIG5yaWdodGFycm93OiA4NjAzLFxuICAgIHByZWNjdXJseWVxOiA4ODI4LFxuICAgIHByZWNuYXBwcm94OiAxMDkzNyxcbiAgICBxdWF0ZXJuaW9uczogODQ2MSxcbiAgICBzdHJhaWdodHBoaTogOTgxLFxuICAgIHN1Y2NjdXJseWVxOiA4ODI5LFxuICAgIHN1Y2NuYXBwcm94OiAxMDkzOCxcbiAgICB0aGlja2FwcHJveDogODc3NixcbiAgICB1cGRvd25hcnJvdzogODU5NyxcbiAgICBCZXJub3VsbGlzOiA4NDkyLFxuICAgIENpcmNsZVBsdXM6IDg4NTMsXG4gICAgRXF1YWxUaWxkZTogODc3MCxcbiAgICBGb3VyaWVydHJmOiA4NDk3LFxuICAgIEltYWdpbmFyeUk6IDg1MjAsXG4gICAgTGFwbGFjZXRyZjogODQ2NixcbiAgICBMZWZ0VmVjdG9yOiA4NjM2LFxuICAgIExsZWZ0YXJyb3c6IDg2NjYsXG4gICAgTm90RWxlbWVudDogODcxMyxcbiAgICBOb3RHcmVhdGVyOiA4ODE1LFxuICAgIFByb3BvcnRpb246IDg3NTksXG4gICAgUmlnaHRBcnJvdzogODU5NCxcbiAgICBSaWdodEZsb29yOiA4OTcxLFxuICAgIFJpZ2h0YXJyb3c6IDg2NTgsXG4gICAgVGlsZGVFcXVhbDogODc3MSxcbiAgICBUaWxkZVRpbGRlOiA4Nzc2LFxuICAgIFVuZGVyQnJhY2U6IDkxODMsXG4gICAgVXBBcnJvd0JhcjogMTA1MTQsXG4gICAgVXBUZWVBcnJvdzogODYxMyxcbiAgICBjaXJjbGVkYXN0OiA4ODU5LFxuICAgIGNvbXBsZW1lbnQ6IDg3MDUsXG4gICAgY3VybHl3ZWRnZTogODkxMSxcbiAgICBlcXNsYW50Z3RyOiAxMDkwMixcbiAgICBndHJlcXFsZXNzOiAxMDg5MixcbiAgICBsZXNzYXBwcm94OiAxMDg4NSxcbiAgICBsZXNzZXFxZ3RyOiAxMDg5MSxcbiAgICBsbW91c3RhY2hlOiA5MTM2LFxuICAgIGxvbmdtYXBzdG86IDEwMjM2LFxuICAgIG1hcHN0b2Rvd246IDg2MTUsXG4gICAgbWFwc3RvbGVmdDogODYxMixcbiAgICBuTGVmdGFycm93OiA4NjUzLFxuICAgIG5sZWZ0YXJyb3c6IDg2MDIsXG4gICAgcHJlY2FwcHJveDogMTA5MzUsXG4gICAgcmlnaHRhcnJvdzogODU5NCxcbiAgICBybW91c3RhY2hlOiA5MTM3LFxuICAgIHNxc3Vic2V0ZXE6IDg4NDksXG4gICAgc3FzdXBzZXRlcTogODg1MCxcbiAgICBzdWJzZXRuZXFxOiAxMDk1NSxcbiAgICBzdWNjYXBwcm94OiAxMDkzNixcbiAgICBzdXBzZXRuZXFxOiAxMDk1NixcbiAgICB1cHVwYXJyb3dzOiA4NjQ4LFxuICAgIHZhcmVwc2lsb246IDk0OSxcbiAgICB2YXJub3RoaW5nOiA4NzA5LFxuICAgIEJhY2tzbGFzaDogODcyNixcbiAgICBDZW50ZXJEb3Q6IDE4MyxcbiAgICBDaXJjbGVEb3Q6IDg4NTcsXG4gICAgQ29uZ3J1ZW50OiA4ODAxLFxuICAgIENvcHJvZHVjdDogODcyMCxcbiAgICBEb3VibGVEb3Q6IDE2OCxcbiAgICBEb3duQXJyb3c6IDg1OTUsXG4gICAgRG93bkJyZXZlOiA3ODUsXG4gICAgRG93bmFycm93OiA4NjU5LFxuICAgIEh1bXBFcXVhbDogODc4MyxcbiAgICBMZWZ0QXJyb3c6IDg1OTIsXG4gICAgTGVmdEZsb29yOiA4OTcwLFxuICAgIExlZnRhcnJvdzogODY1NixcbiAgICBMZXNzVGlsZGU6IDg4MTgsXG4gICAgTWVsbGludHJmOiA4NDk5LFxuICAgIE1pbnVzUGx1czogODcyMyxcbiAgICBOb3RDdXBDYXA6IDg4MTMsXG4gICAgTm90RXhpc3RzOiA4NzA4LFxuICAgIE92ZXJCcmFjZTogOTE4MixcbiAgICBQbHVzTWludXM6IDE3NyxcbiAgICBUaGVyZWZvcmU6IDg3NTYsXG4gICAgVGhpblNwYWNlOiA4MjAxLFxuICAgIFRyaXBsZURvdDogODQxMSxcbiAgICBVbmlvblBsdXM6IDg4NDYsXG4gICAgYmFja3ByaW1lOiA4MjQ1LFxuICAgIGJhY2tzaW1lcTogODkwOSxcbiAgICBiaWdvdGltZXM6IDEwNzU0LFxuICAgIGNlbnRlcmRvdDogMTgzLFxuICAgIGNoZWNrbWFyazogMTAwMDMsXG4gICAgY29tcGxleGVzOiA4NDUwLFxuICAgIGRvdHNxdWFyZTogODg2NSxcbiAgICBkb3duYXJyb3c6IDg1OTUsXG4gICAgZ3RyYXBwcm94OiAxMDg4NixcbiAgICBndHJlcWxlc3M6IDg5MjMsXG4gICAgaGVhcnRzdWl0OiA5ODI5LFxuICAgIGxlZnRhcnJvdzogODU5MixcbiAgICBsZXNzZXFndHI6IDg5MjIsXG4gICAgbnBhcmFsbGVsOiA4NzQyLFxuICAgIG5zaG9ydG1pZDogODc0MCxcbiAgICBuc3Vic2V0ZXE6IDg4NDAsXG4gICAgbnN1cHNldGVxOiA4ODQxLFxuICAgIHBpdGNoZm9yazogODkxNixcbiAgICByYXRpb25hbHM6IDg0NzQsXG4gICAgc3BhZGVzdWl0OiA5ODI0LFxuICAgIHN1YnNldGVxcTogMTA5NDksXG4gICAgc3Vic2V0bmVxOiA4ODQyLFxuICAgIHN1cHNldGVxcTogMTA5NTAsXG4gICAgc3Vwc2V0bmVxOiA4ODQzLFxuICAgIHRoZXJlZm9yZTogODc1NixcbiAgICB0cmlhbmdsZXE6IDg3OTYsXG4gICAgdmFycHJvcHRvOiA4NzMzLFxuICAgIEREb3RyYWhkOiAxMDUxMyxcbiAgICBEb3RFcXVhbDogODc4NCxcbiAgICBJbnRlZ3JhbDogODc0NyxcbiAgICBMZXNzTGVzczogMTA5MTMsXG4gICAgTm90RXF1YWw6IDg4MDAsXG4gICAgTm90VGlsZGU6IDg3NjksXG4gICAgUGFydGlhbEQ6IDg3MDYsXG4gICAgUHJlY2VkZXM6IDg4MjYsXG4gICAgUmlnaHRUZWU6IDg4NjYsXG4gICAgU3VjY2VlZHM6IDg4MjcsXG4gICAgU3VjaFRoYXQ6IDg3MTUsXG4gICAgU3VwZXJzZXQ6IDg4MzUsXG4gICAgVWFycm9jaXI6IDEwNTY5LFxuICAgIFVuZGVyQmFyOiA4MTgsXG4gICAgYW5kc2xvcGU6IDEwODQwLFxuICAgIGFuZ21zZGFhOiAxMDY2NCxcbiAgICBhbmdtc2RhYjogMTA2NjUsXG4gICAgYW5nbXNkYWM6IDEwNjY2LFxuICAgIGFuZ21zZGFkOiAxMDY2NyxcbiAgICBhbmdtc2RhZTogMTA2NjgsXG4gICAgYW5nbXNkYWY6IDEwNjY5LFxuICAgIGFuZ21zZGFnOiAxMDY3MCxcbiAgICBhbmdtc2RhaDogMTA2NzEsXG4gICAgYW5ncnR2YmQ6IDEwNjUzLFxuICAgIGFwcHJveGVxOiA4Nzc4LFxuICAgIGF3Y29uaW50OiA4NzU1LFxuICAgIGJhY2tjb25nOiA4NzgwLFxuICAgIGJhcndlZGdlOiA4OTY1LFxuICAgIGJicmt0YnJrOiA5MTQyLFxuICAgIGJpZ29wbHVzOiAxMDc1MyxcbiAgICBiaWdzcWN1cDogMTA3NTgsXG4gICAgYmlndXBsdXM6IDEwNzU2LFxuICAgIGJpZ3dlZGdlOiA4ODk2LFxuICAgIGJveG1pbnVzOiA4ODYzLFxuICAgIGJveHRpbWVzOiA4ODY0LFxuICAgIGNhcGJyY3VwOiAxMDgyNSxcbiAgICBjaXJjbGVkUjogMTc0LFxuICAgIGNpcmNsZWRTOiA5NDE2LFxuICAgIGNpcmZuaW50OiAxMDc2OCxcbiAgICBjbHVic3VpdDogOTgyNyxcbiAgICBjdXBicmNhcDogMTA4MjQsXG4gICAgY3VybHl2ZWU6IDg5MTAsXG4gICAgY3djb25pbnQ6IDg3NTQsXG4gICAgZG90ZXFkb3Q6IDg3ODUsXG4gICAgZG90bWludXM6IDg3NjAsXG4gICAgZHJia2Fyb3c6IDEwNTEyLFxuICAgIGR6aWdyYXJyOiAxMDIzOSxcbiAgICBlbGludGVyczogOTE5MSxcbiAgICBlbXB0eXNldDogODcwOSxcbiAgICBlcXZwYXJzbDogMTA3MjUsXG4gICAgZnBhcnRpbnQ6IDEwNzY1LFxuICAgIGdlcXNsYW50OiAxMDg3OCxcbiAgICBnZXNkb3RvbDogMTA4ODQsXG4gICAgZ25hcHByb3g6IDEwODkwLFxuICAgIGhrc2Vhcm93OiAxMDUzMyxcbiAgICBoa3N3YXJvdzogMTA1MzQsXG4gICAgaW1hZ2xpbmU6IDg0NjQsXG4gICAgaW1hZ3BhcnQ6IDg0NjUsXG4gICAgaW5maW50aWU6IDEwNzE3LFxuICAgIGludGVnZXJzOiA4NDg0LFxuICAgIGludGVyY2FsOiA4ODkwLFxuICAgIGludGxhcmhrOiAxMDc3NSxcbiAgICBsYWVtcHR5djogMTA2NzYsXG4gICAgbGRydXNoYXI6IDEwNTcxLFxuICAgIGxlcXNsYW50OiAxMDg3NyxcbiAgICBsZXNkb3RvcjogMTA4ODMsXG4gICAgbGxjb3JuZXI6IDg5OTAsXG4gICAgbG5hcHByb3g6IDEwODg5LFxuICAgIGxyY29ybmVyOiA4OTkxLFxuICAgIGx1cmRzaGFyOiAxMDU3MCxcbiAgICBtYXBzdG91cDogODYxMyxcbiAgICBtdWx0aW1hcDogODg4OCxcbiAgICBuYXR1cmFsczogODQ2OSxcbiAgICBvdGltZXNhczogMTA4MDYsXG4gICAgcGFyYWxsZWw6IDg3NDEsXG4gICAgcGx1c2FjaXI6IDEwNzg3LFxuICAgIHBvaW50aW50OiAxMDc3MyxcbiAgICBwcmVjbmVxcTogMTA5MzMsXG4gICAgcHJlY25zaW06IDg5MzYsXG4gICAgcHJvZmFsYXI6IDkwMDYsXG4gICAgcHJvZmxpbmU6IDg5NzgsXG4gICAgcHJvZnN1cmY6IDg5NzksXG4gICAgcmFlbXB0eXY6IDEwNjc1LFxuICAgIHJlYWxwYXJ0OiA4NDc2LFxuICAgIHJwcG9saW50OiAxMDc3MCxcbiAgICBydHJpbHRyaTogMTA3MDIsXG4gICAgc2Nwb2xpbnQ6IDEwNzcxLFxuICAgIHNldG1pbnVzOiA4NzI2LFxuICAgIHNob3J0bWlkOiA4NzM5LFxuICAgIHNtZXBhcnNsOiAxMDcyNCxcbiAgICBzcXN1YnNldDogODg0NyxcbiAgICBzcXN1cHNldDogODg0OCxcbiAgICBzdWJzZXRlcTogODgzOCxcbiAgICBzdWNjbmVxcTogMTA5MzQsXG4gICAgc3VjY25zaW06IDg5MzcsXG4gICAgc3Vwc2V0ZXE6IDg4MzksXG4gICAgdGhldGFzeW06IDk3NyxcbiAgICB0aGlja3NpbTogODc2NCxcbiAgICB0aW1lc2JhcjogMTA4MDEsXG4gICAgdHJpYW5nbGU6IDk2NTMsXG4gICAgdHJpbWludXM6IDEwODEwLFxuICAgIHRycGV6aXVtOiA5MTg2LFxuICAgIHVsY29ybmVyOiA4OTg4LFxuICAgIHVyY29ybmVyOiA4OTg5LFxuICAgIHZhcmthcHBhOiAxMDA4LFxuICAgIHZhcnNpZ21hOiA5NjIsXG4gICAgdmFydGhldGE6IDk3NyxcbiAgICBCZWNhdXNlOiA4NzU3LFxuICAgIENheWxleXM6IDg0OTMsXG4gICAgQ2NvbmludDogODc1MixcbiAgICBDZWRpbGxhOiAxODQsXG4gICAgRGlhbW9uZDogODkwMCxcbiAgICBEb3duVGVlOiA4ODY4LFxuICAgIEVsZW1lbnQ6IDg3MTIsXG4gICAgRXBzaWxvbjogOTE3LFxuICAgIEltcGxpZXM6IDg2NTgsXG4gICAgTGVmdFRlZTogODg2NyxcbiAgICBOZXdMaW5lOiAxMCxcbiAgICBOb0JyZWFrOiA4Mjg4LFxuICAgIE5vdExlc3M6IDg4MTQsXG4gICAgT21pY3JvbjogOTI3LFxuICAgIE92ZXJCYXI6IDE3NSxcbiAgICBQcm9kdWN0OiA4NzE5LFxuICAgIFVwQXJyb3c6IDg1OTMsXG4gICAgVXBhcnJvdzogODY1NyxcbiAgICBVcHNpbG9uOiA5MzMsXG4gICAgYWxlZnN5bTogODUwMSxcbiAgICBhbmdydHZiOiA4ODk0LFxuICAgIGFuZ3phcnI6IDkwODQsXG4gICAgYXN5bXBlcTogODc4MSxcbiAgICBiYWNrc2ltOiA4NzY1LFxuICAgIGJlY2F1c2U6IDg3NTcsXG4gICAgYmVtcHR5djogMTA2NzIsXG4gICAgYmV0d2VlbjogODgxMixcbiAgICBiaWdjaXJjOiA5NzExLFxuICAgIGJpZ29kb3Q6IDEwNzUyLFxuICAgIGJpZ3N0YXI6IDk3MzMsXG4gICAgYm94cGx1czogODg2MixcbiAgICBjY3Vwc3NtOiAxMDgzMixcbiAgICBjZW1wdHl2OiAxMDY3NCxcbiAgICBjaXJzY2lyOiAxMDY5MCxcbiAgICBjb2xvbmVxOiA4Nzg4LFxuICAgIGNvbmdkb3Q6IDEwODYxLFxuICAgIGN1ZGFycmw6IDEwNTUyLFxuICAgIGN1ZGFycnI6IDEwNTQ5LFxuICAgIGN1bGFycnA6IDEwNTU3LFxuICAgIGN1cmFycm06IDEwNTU2LFxuICAgIGRia2Fyb3c6IDEwNTExLFxuICAgIGRkYWdnZXI6IDgyMjUsXG4gICAgZGRvdHNlcTogMTA4NzEsXG4gICAgZGVtcHR5djogMTA2NzMsXG4gICAgZGlhbW9uZDogODkwMCxcbiAgICBkaWdhbW1hOiA5ODksXG4gICAgZG90cGx1czogODcyNCxcbiAgICBkd2FuZ2xlOiAxMDY2MixcbiAgICBlcHNpbG9uOiA5NDksXG4gICAgZXFjb2xvbjogODc4OSxcbiAgICBlcXVpdkREOiAxMDg3MixcbiAgICBnZXNkb3RvOiAxMDg4MixcbiAgICBndHF1ZXN0OiAxMDg3NixcbiAgICBndHJsZXNzOiA4ODIzLFxuICAgIGhhcnJjaXI6IDEwNTY4LFxuICAgIGludHByb2Q6IDEwODEyLFxuICAgIGlzaW5kb3Q6IDg5NDksXG4gICAgbGFycmJmczogMTA1MjcsXG4gICAgbGFycnNpbTogMTA2MTEsXG4gICAgbGJya3NsZDogMTA2MzksXG4gICAgbGJya3NsdTogMTA2MzcsXG4gICAgbGRyZGhhcjogMTA1OTksXG4gICAgbGVzZG90bzogMTA4ODEsXG4gICAgbGVzc2RvdDogODkxOCxcbiAgICBsZXNzZ3RyOiA4ODIyLFxuICAgIGxlc3NzaW06IDg4MTgsXG4gICAgbG90aW1lczogMTA4MDQsXG4gICAgbG96ZW5nZTogOTY3NCxcbiAgICBsdHF1ZXN0OiAxMDg3NSxcbiAgICBsdXJ1aGFyOiAxMDU5OCxcbiAgICBtYWx0ZXNlOiAxMDAxNixcbiAgICBtaW51c2R1OiAxMDc5NCxcbiAgICBuYXBwcm94OiA4Nzc3LFxuICAgIG5hdHVyYWw6IDk4MzgsXG4gICAgbmVhcnJvdzogODU5OSxcbiAgICBuZXhpc3RzOiA4NzA4LFxuICAgIG5vdGludmE6IDg3MTMsXG4gICAgbm90aW52YjogODk1MSxcbiAgICBub3RpbnZjOiA4OTUwLFxuICAgIG5vdG5pdmE6IDg3MTYsXG4gICAgbm90bml2YjogODk1OCxcbiAgICBub3RuaXZjOiA4OTU3LFxuICAgIG5wb2xpbnQ6IDEwNzcyLFxuICAgIG5zcXN1YmU6IDg5MzAsXG4gICAgbnNxc3VwZTogODkzMSxcbiAgICBudmluZmluOiAxMDcxOCxcbiAgICBud2Fycm93OiA4NTk4LFxuICAgIG9sY3Jvc3M6IDEwNjgzLFxuICAgIG9taWNyb246IDk1OSxcbiAgICBvcmRlcm9mOiA4NTAwLFxuICAgIG9yc2xvcGU6IDEwODM5LFxuICAgIHBlcnRlbms6IDgyNDEsXG4gICAgcGxhbmNraDogODQ2MixcbiAgICBwbHVzY2lyOiAxMDc4NixcbiAgICBwbHVzc2ltOiAxMDc5MCxcbiAgICBwbHVzdHdvOiAxMDc5MSxcbiAgICBwcmVjc2ltOiA4ODMwLFxuICAgIHF1YXRpbnQ6IDEwNzc0LFxuICAgIHF1ZXN0ZXE6IDg3OTksXG4gICAgcmFycmJmczogMTA1MjgsXG4gICAgcmFycnNpbTogMTA2MTIsXG4gICAgcmJya3NsZDogMTA2MzgsXG4gICAgcmJya3NsdTogMTA2NDAsXG4gICAgcmRsZGhhcjogMTA2MDEsXG4gICAgcmVhbGluZTogODQ3NSxcbiAgICByb3RpbWVzOiAxMDgwNSxcbiAgICBydWx1aGFyOiAxMDYwMCxcbiAgICBzZWFycm93OiA4NjAwLFxuICAgIHNpbXBsdXM6IDEwNzg4LFxuICAgIHNpbXJhcnI6IDEwNjEwLFxuICAgIHN1YmVkb3Q6IDEwOTQ3LFxuICAgIHN1Ym11bHQ6IDEwOTQ1LFxuICAgIHN1YnBsdXM6IDEwOTQzLFxuICAgIHN1YnJhcnI6IDEwNjE3LFxuICAgIHN1Y2NzaW06IDg4MzEsXG4gICAgc3VwZHN1YjogMTA5NjgsXG4gICAgc3VwZWRvdDogMTA5NDgsXG4gICAgc3VwaHN1YjogMTA5NjcsXG4gICAgc3VwbGFycjogMTA2MTksXG4gICAgc3VwbXVsdDogMTA5NDYsXG4gICAgc3VwcGx1czogMTA5NDQsXG4gICAgc3dhcnJvdzogODYwMSxcbiAgICB0b3Bmb3JrOiAxMDk3MCxcbiAgICB0cmlwbHVzOiAxMDgwOSxcbiAgICB0cml0aW1lOiAxMDgxMSxcbiAgICB1cGFycm93OiA4NTkzLFxuICAgIHVwc2lsb246IDk2NSxcbiAgICB1d2FuZ2xlOiAxMDY2MyxcbiAgICB2emlnemFnOiAxMDY1MCxcbiAgICB6aWdyYXJyOiA4NjY5LFxuICAgIEFhY3V0ZTogMTkzLFxuICAgIEFicmV2ZTogMjU4LFxuICAgIEFncmF2ZTogMTkyLFxuICAgIEFzc2lnbjogODc4OCxcbiAgICBBdGlsZGU6IDE5NSxcbiAgICBCYXJ3ZWQ6IDg5NjYsXG4gICAgQnVtcGVxOiA4NzgyLFxuICAgIENhY3V0ZTogMjYyLFxuICAgIENjYXJvbjogMjY4LFxuICAgIENjZWRpbDogMTk5LFxuICAgIENvbG9uZTogMTA4NjgsXG4gICAgQ29uaW50OiA4NzUxLFxuICAgIEN1cENhcDogODc4MSxcbiAgICBEYWdnZXI6IDgyMjUsXG4gICAgRGNhcm9uOiAyNzAsXG4gICAgRG90RG90OiA4NDEyLFxuICAgIERzdHJvazogMjcyLFxuICAgIEVhY3V0ZTogMjAxLFxuICAgIEVjYXJvbjogMjgyLFxuICAgIEVncmF2ZTogMjAwLFxuICAgIEV4aXN0czogODcwNyxcbiAgICBGb3JBbGw6IDg3MDQsXG4gICAgR2FtbWFkOiA5ODgsXG4gICAgR2JyZXZlOiAyODYsXG4gICAgR2NlZGlsOiAyOTAsXG4gICAgSEFSRGN5OiAxMDY2LFxuICAgIEhzdHJvazogMjk0LFxuICAgIElhY3V0ZTogMjA1LFxuICAgIElncmF2ZTogMjA0LFxuICAgIEl0aWxkZTogMjk2LFxuICAgIEpzZXJjeTogMTAzMixcbiAgICBLY2VkaWw6IDMxMCxcbiAgICBMYWN1dGU6IDMxMyxcbiAgICBMYW1iZGE6IDkyMyxcbiAgICBMY2Fyb246IDMxNyxcbiAgICBMY2VkaWw6IDMxNSxcbiAgICBMbWlkb3Q6IDMxOSxcbiAgICBMc3Ryb2s6IDMyMSxcbiAgICBOYWN1dGU6IDMyMyxcbiAgICBOY2Fyb246IDMyNyxcbiAgICBOY2VkaWw6IDMyNSxcbiAgICBOdGlsZGU6IDIwOSxcbiAgICBPYWN1dGU6IDIxMSxcbiAgICBPZGJsYWM6IDMzNixcbiAgICBPZ3JhdmU6IDIxMCxcbiAgICBPc2xhc2g6IDIxNixcbiAgICBPdGlsZGU6IDIxMyxcbiAgICBPdGltZXM6IDEwODA3LFxuICAgIFJhY3V0ZTogMzQwLFxuICAgIFJhcnJ0bDogMTA1MTgsXG4gICAgUmNhcm9uOiAzNDQsXG4gICAgUmNlZGlsOiAzNDIsXG4gICAgU0hDSGN5OiAxMDY1LFxuICAgIFNPRlRjeTogMTA2OCxcbiAgICBTYWN1dGU6IDM0NixcbiAgICBTY2Fyb246IDM1MixcbiAgICBTY2VkaWw6IDM1MCxcbiAgICBTcXVhcmU6IDk2MzMsXG4gICAgU3Vic2V0OiA4OTEyLFxuICAgIFN1cHNldDogODkxMyxcbiAgICBUY2Fyb246IDM1NixcbiAgICBUY2VkaWw6IDM1NCxcbiAgICBUc3Ryb2s6IDM1OCxcbiAgICBVYWN1dGU6IDIxOCxcbiAgICBVYnJldmU6IDM2NCxcbiAgICBVZGJsYWM6IDM2OCxcbiAgICBVZ3JhdmU6IDIxNyxcbiAgICBVdGlsZGU6IDM2MCxcbiAgICBWZGFzaGw6IDEwOTgyLFxuICAgIFZlcmJhcjogODIxNCxcbiAgICBWdmRhc2g6IDg4NzQsXG4gICAgWWFjdXRlOiAyMjEsXG4gICAgWmFjdXRlOiAzNzcsXG4gICAgWmNhcm9uOiAzODEsXG4gICAgYWFjdXRlOiAyMjUsXG4gICAgYWJyZXZlOiAyNTksXG4gICAgYWdyYXZlOiAyMjQsXG4gICAgYW5kYW5kOiAxMDgzNyxcbiAgICBhbmdtc2Q6IDg3MzcsXG4gICAgYW5nc3BoOiA4NzM4LFxuICAgIGFwYWNpcjogMTA4NjMsXG4gICAgYXBwcm94OiA4Nzc2LFxuICAgIGF0aWxkZTogMjI3LFxuICAgIGJhcnZlZTogODg5MyxcbiAgICBiYXJ3ZWQ6IDg5NjUsXG4gICAgYmVjYXVzOiA4NzU3LFxuICAgIGJlcm5vdTogODQ5MixcbiAgICBiaWdjYXA6IDg4OTgsXG4gICAgYmlnY3VwOiA4ODk5LFxuICAgIGJpZ3ZlZTogODg5NyxcbiAgICBia2Fyb3c6IDEwNTA5LFxuICAgIGJvdHRvbTogODg2OSxcbiAgICBib3d0aWU6IDg5MDQsXG4gICAgYm94Ym94OiAxMDY5NyxcbiAgICBicHJpbWU6IDgyNDUsXG4gICAgYnJ2YmFyOiAxNjYsXG4gICAgYnVsbGV0OiA4MjI2LFxuICAgIGJ1bXBlcTogODc4MyxcbiAgICBjYWN1dGU6IDI2MyxcbiAgICBjYXBhbmQ6IDEwODIwLFxuICAgIGNhcGNhcDogMTA4MjcsXG4gICAgY2FwY3VwOiAxMDgyMyxcbiAgICBjYXBkb3Q6IDEwODE2LFxuICAgIGNjYXJvbjogMjY5LFxuICAgIGNjZWRpbDogMjMxLFxuICAgIGNpcmNlcTogODc5MSxcbiAgICBjaXJtaWQ6IDEwOTkxLFxuICAgIGNvbG9uZTogODc4OCxcbiAgICBjb21tYXQ6IDY0LFxuICAgIGNvbXBmbjogODcyOCxcbiAgICBjb25pbnQ6IDg3NTAsXG4gICAgY29wcm9kOiA4NzIwLFxuICAgIGNvcHlzcjogODQ3MSxcbiAgICBjdWxhcnI6IDg2MzAsXG4gICAgY3VwY2FwOiAxMDgyMixcbiAgICBjdXBjdXA6IDEwODI2LFxuICAgIGN1cGRvdDogODg0NSxcbiAgICBjdXJhcnI6IDg2MzEsXG4gICAgY3VycmVuOiAxNjQsXG4gICAgY3lsY3R5OiA5MDA1LFxuICAgIGRhZ2dlcjogODIyNCxcbiAgICBkYWxldGg6IDg1MDQsXG4gICAgZGNhcm9uOiAyNzEsXG4gICAgZGZpc2h0OiAxMDYyMyxcbiAgICBkaXZpZGU6IDI0NyxcbiAgICBkaXZvbng6IDg5MDMsXG4gICAgZGxjb3JuOiA4OTkwLFxuICAgIGRsY3JvcDogODk3MyxcbiAgICBkb2xsYXI6IDM2LFxuICAgIGRyY29ybjogODk5MSxcbiAgICBkcmNyb3A6IDg5NzIsXG4gICAgZHN0cm9rOiAyNzMsXG4gICAgZWFjdXRlOiAyMzMsXG4gICAgZWFzdGVyOiAxMDg2MixcbiAgICBlY2Fyb246IDI4MyxcbiAgICBlY29sb246IDg3ODksXG4gICAgZWdyYXZlOiAyMzIsXG4gICAgZWdzZG90OiAxMDkwNCxcbiAgICBlbHNkb3Q6IDEwOTAzLFxuICAgIGVtcHR5djogODcwOSxcbiAgICBlbXNwMTM6IDgxOTYsXG4gICAgZW1zcDE0OiA4MTk3LFxuICAgIGVwYXJzbDogMTA3MjMsXG4gICAgZXFjaXJjOiA4NzkwLFxuICAgIGVxdWFsczogNjEsXG4gICAgZXF1ZXN0OiA4Nzk5LFxuICAgIGZlbWFsZTogOTc5MixcbiAgICBmZmlsaWc6IDY0MjU5LFxuICAgIGZmbGxpZzogNjQyNjAsXG4gICAgZm9yYWxsOiA4NzA0LFxuICAgIGZyYWMxMjogMTg5LFxuICAgIGZyYWMxMzogODUzMSxcbiAgICBmcmFjMTQ6IDE4OCxcbiAgICBmcmFjMTU6IDg1MzMsXG4gICAgZnJhYzE2OiA4NTM3LFxuICAgIGZyYWMxODogODUzOSxcbiAgICBmcmFjMjM6IDg1MzIsXG4gICAgZnJhYzI1OiA4NTM0LFxuICAgIGZyYWMzNDogMTkwLFxuICAgIGZyYWMzNTogODUzNSxcbiAgICBmcmFjMzg6IDg1NDAsXG4gICAgZnJhYzQ1OiA4NTM2LFxuICAgIGZyYWM1NjogODUzOCxcbiAgICBmcmFjNTg6IDg1NDEsXG4gICAgZnJhYzc4OiA4NTQyLFxuICAgIGdhY3V0ZTogNTAxLFxuICAgIGdhbW1hZDogOTg5LFxuICAgIGdicmV2ZTogMjg3LFxuICAgIGdlc2RvdDogMTA4ODAsXG4gICAgZ2VzbGVzOiAxMDkwMCxcbiAgICBndGxQYXI6IDEwNjQ1LFxuICAgIGd0cmFycjogMTA2MTYsXG4gICAgZ3RyZG90OiA4OTE5LFxuICAgIGd0cnNpbTogODgxOSxcbiAgICBoYWlyc3A6IDgyMDIsXG4gICAgaGFtaWx0OiA4NDU5LFxuICAgIGhhcmRjeTogMTA5OCxcbiAgICBoZWFydHM6IDk4MjksXG4gICAgaGVsbGlwOiA4MjMwLFxuICAgIGhlcmNvbjogODg4OSxcbiAgICBob210aHQ6IDg3NjMsXG4gICAgaG9yYmFyOiA4MjEzLFxuICAgIGhzbGFzaDogODQ2MyxcbiAgICBoc3Ryb2s6IDI5NSxcbiAgICBoeWJ1bGw6IDgyNTksXG4gICAgaHlwaGVuOiA4MjA4LFxuICAgIGlhY3V0ZTogMjM3LFxuICAgIGlncmF2ZTogMjM2LFxuICAgIGlpaWludDogMTA3NjQsXG4gICAgaWluZmluOiAxMDcxNixcbiAgICBpbmNhcmU6IDg0NTMsXG4gICAgaW5vZG90OiAzMDUsXG4gICAgaW50Y2FsOiA4ODkwLFxuICAgIGlxdWVzdDogMTkxLFxuICAgIGlzaW5zdjogODk0NyxcbiAgICBpdGlsZGU6IDI5NyxcbiAgICBqc2VyY3k6IDExMTIsXG4gICAga2FwcGF2OiAxMDA4LFxuICAgIGtjZWRpbDogMzExLFxuICAgIGtncmVlbjogMzEyLFxuICAgIGxBdGFpbDogMTA1MjMsXG4gICAgbGFjdXRlOiAzMTQsXG4gICAgbGFncmFuOiA4NDY2LFxuICAgIGxhbWJkYTogOTU1LFxuICAgIGxhbmdsZTogMTAyMTYsXG4gICAgbGFycmZzOiAxMDUyNSxcbiAgICBsYXJyaGs6IDg2MTcsXG4gICAgbGFycmxwOiA4NjE5LFxuICAgIGxhcnJwbDogMTA1NTMsXG4gICAgbGFycnRsOiA4NjEwLFxuICAgIGxhdGFpbDogMTA1MjEsXG4gICAgbGJyYWNlOiAxMjMsXG4gICAgbGJyYWNrOiA5MSxcbiAgICBsY2Fyb246IDMxOCxcbiAgICBsY2VkaWw6IDMxNixcbiAgICBsZHF1b3I6IDgyMjIsXG4gICAgbGVzZG90OiAxMDg3OSxcbiAgICBsZXNnZXM6IDEwODk5LFxuICAgIGxmaXNodDogMTA2MjAsXG4gICAgbGZsb29yOiA4OTcwLFxuICAgIGxoYXJ1bDogMTA2MDIsXG4gICAgbGxoYXJkOiAxMDYwMyxcbiAgICBsbWlkb3Q6IDMyMCxcbiAgICBsbW91c3Q6IDkxMzYsXG4gICAgbG9wbHVzOiAxMDc5NyxcbiAgICBsb3dhc3Q6IDg3MjcsXG4gICAgbG93YmFyOiA5NSxcbiAgICBscGFybHQ6IDEwNjQzLFxuICAgIGxyaGFyZDogMTA2MDUsXG4gICAgbHNhcXVvOiA4MjQ5LFxuICAgIGxzcXVvcjogODIxOCxcbiAgICBsc3Ryb2s6IDMyMixcbiAgICBsdGhyZWU6IDg5MDcsXG4gICAgbHRpbWVzOiA4OTA1LFxuICAgIGx0bGFycjogMTA2MTQsXG4gICAgbHRyUGFyOiAxMDY0NixcbiAgICBtYXBzdG86IDg2MTQsXG4gICAgbWFya2VyOiA5NjQ2LFxuICAgIG1jb21tYTogMTA3OTMsXG4gICAgbWlkYXN0OiA0MixcbiAgICBtaWRjaXI6IDEwOTkyLFxuICAgIG1pZGRvdDogMTgzLFxuICAgIG1pbnVzYjogODg2MyxcbiAgICBtaW51c2Q6IDg3NjAsXG4gICAgbW5wbHVzOiA4NzIzLFxuICAgIG1vZGVsczogODg3MSxcbiAgICBtc3Rwb3M6IDg3NjYsXG4gICAgblZEYXNoOiA4ODc5LFxuICAgIG5WZGFzaDogODg3OCxcbiAgICBuYWN1dGU6IDMyNCxcbiAgICBuY2Fyb246IDMyOCxcbiAgICBuY2VkaWw6IDMyNixcbiAgICBuZWFyaGs6IDEwNTMyLFxuICAgIG5lcXVpdjogODgwMixcbiAgICBuZXNlYXI6IDEwNTM2LFxuICAgIG5leGlzdDogODcwOCxcbiAgICBubHRyaWU6IDg5NDAsXG4gICAgbnByY3VlOiA4OTI4LFxuICAgIG5ydHJpZTogODk0MSxcbiAgICBuc2NjdWU6IDg5MjksXG4gICAgbnNpbWVxOiA4NzcyLFxuICAgIG50aWxkZTogMjQxLFxuICAgIG51bWVybzogODQ3MCxcbiAgICBudkRhc2g6IDg4NzcsXG4gICAgbnZIYXJyOiAxMDUwMCxcbiAgICBudmRhc2g6IDg4NzYsXG4gICAgbnZsQXJyOiAxMDQ5OCxcbiAgICBudnJBcnI6IDEwNDk5LFxuICAgIG53YXJoazogMTA1MzEsXG4gICAgbnduZWFyOiAxMDUzNSxcbiAgICBvYWN1dGU6IDI0MyxcbiAgICBvZGJsYWM6IDMzNyxcbiAgICBvZHNvbGQ6IDEwNjg0LFxuICAgIG9ncmF2ZTogMjQyLFxuICAgIG9taW51czogODg1NCxcbiAgICBvcmlnb2Y6IDg4ODYsXG4gICAgb3NsYXNoOiAyNDgsXG4gICAgb3RpbGRlOiAyNDUsXG4gICAgb3RpbWVzOiA4ODU1LFxuICAgIHBhcnNpbTogMTA5OTUsXG4gICAgcGVyY250OiAzNyxcbiAgICBwZXJpb2Q6IDQ2LFxuICAgIHBlcm1pbDogODI0MCxcbiAgICBwaG1tYXQ6IDg0OTksXG4gICAgcGxhbmNrOiA4NDYzLFxuICAgIHBsYW5rdjogODQ2MyxcbiAgICBwbHVzZG86IDg3MjQsXG4gICAgcGx1c2R1OiAxMDc4OSxcbiAgICBwbHVzbW46IDE3NyxcbiAgICBwcmVjZXE6IDEwOTI3LFxuICAgIHByaW1lczogODQ3MyxcbiAgICBwcm5zaW06IDg5MzYsXG4gICAgcHJvcHRvOiA4NzMzLFxuICAgIHBydXJlbDogODg4MCxcbiAgICBwdW5jc3A6IDgyMDAsXG4gICAgcXByaW1lOiA4Mjc5LFxuICAgIHJBdGFpbDogMTA1MjQsXG4gICAgcmFjdXRlOiAzNDEsXG4gICAgcmFuZ2xlOiAxMDIxNyxcbiAgICByYXJyYXA6IDEwNjEzLFxuICAgIHJhcnJmczogMTA1MjYsXG4gICAgcmFycmhrOiA4NjE4LFxuICAgIHJhcnJscDogODYyMCxcbiAgICByYXJycGw6IDEwNTY1LFxuICAgIHJhcnJ0bDogODYxMSxcbiAgICByYXRhaWw6IDEwNTIyLFxuICAgIHJicmFjZTogMTI1LFxuICAgIHJicmFjazogOTMsXG4gICAgcmNhcm9uOiAzNDUsXG4gICAgcmNlZGlsOiAzNDMsXG4gICAgcmRxdW9yOiA4MjIxLFxuICAgIHJmaXNodDogMTA2MjEsXG4gICAgcmZsb29yOiA4OTcxLFxuICAgIHJoYXJ1bDogMTA2MDQsXG4gICAgcm1vdXN0OiA5MTM3LFxuICAgIHJvcGx1czogMTA3OTgsXG4gICAgcnBhcmd0OiAxMDY0NCxcbiAgICByc2FxdW86IDgyNTAsXG4gICAgcnNxdW9yOiA4MjE3LFxuICAgIHJ0aHJlZTogODkwOCxcbiAgICBydGltZXM6IDg5MDYsXG4gICAgc2FjdXRlOiAzNDcsXG4gICAgc2Nhcm9uOiAzNTMsXG4gICAgc2NlZGlsOiAzNTEsXG4gICAgc2Nuc2ltOiA4OTM3LFxuICAgIHNlYXJoazogMTA1MzMsXG4gICAgc2Vzd2FyOiAxMDUzNyxcbiAgICBzZnJvd246IDg5OTQsXG4gICAgc2hjaGN5OiAxMDk3LFxuICAgIHNpZ21hZjogOTYyLFxuICAgIHNpZ21hdjogOTYyLFxuICAgIHNpbWRvdDogMTA4NTgsXG4gICAgc21hc2hwOiAxMDgwMyxcbiAgICBzb2Z0Y3k6IDExMDAsXG4gICAgc29sYmFyOiA5MDIzLFxuICAgIHNwYWRlczogOTgyNCxcbiAgICBzcXN1YmU6IDg4NDksXG4gICAgc3FzdXBlOiA4ODUwLFxuICAgIHNxdWFyZTogOTYzMyxcbiAgICBzcXVhcmY6IDk2NDIsXG4gICAgc3NldG1uOiA4NzI2LFxuICAgIHNzbWlsZTogODk5NSxcbiAgICBzc3RhcmY6IDg5MDIsXG4gICAgc3ViZG90OiAxMDk0MSxcbiAgICBzdWJzZXQ6IDg4MzQsXG4gICAgc3Vic2ltOiAxMDk1MSxcbiAgICBzdWJzdWI6IDEwOTY1LFxuICAgIHN1YnN1cDogMTA5NjMsXG4gICAgc3VjY2VxOiAxMDkyOCxcbiAgICBzdXBkb3Q6IDEwOTQyLFxuICAgIHN1cHNldDogODgzNSxcbiAgICBzdXBzaW06IDEwOTUyLFxuICAgIHN1cHN1YjogMTA5NjQsXG4gICAgc3Vwc3VwOiAxMDk2NixcbiAgICBzd2FyaGs6IDEwNTM0LFxuICAgIHN3bndhcjogMTA1MzgsXG4gICAgdGFyZ2V0OiA4OTgyLFxuICAgIHRjYXJvbjogMzU3LFxuICAgIHRjZWRpbDogMzU1LFxuICAgIHRlbHJlYzogODk4MSxcbiAgICB0aGVyZTQ6IDg3NTYsXG4gICAgdGhldGF2OiA5NzcsXG4gICAgdGhpbnNwOiA4MjAxLFxuICAgIHRoa3NpbTogODc2NCxcbiAgICB0aW1lc2I6IDg4NjQsXG4gICAgdGltZXNkOiAxMDgwMCxcbiAgICB0b3Bib3Q6IDkwMTQsXG4gICAgdG9wY2lyOiAxMDk5MyxcbiAgICB0cHJpbWU6IDgyNDQsXG4gICAgdHJpZG90OiA5NzA4LFxuICAgIHRzdHJvazogMzU5LFxuICAgIHVhY3V0ZTogMjUwLFxuICAgIHVicmV2ZTogMzY1LFxuICAgIHVkYmxhYzogMzY5LFxuICAgIHVmaXNodDogMTA2MjIsXG4gICAgdWdyYXZlOiAyNDksXG4gICAgdWxjb3JuOiA4OTg4LFxuICAgIHVsY3JvcDogODk3NSxcbiAgICB1cmNvcm46IDg5ODksXG4gICAgdXJjcm9wOiA4OTc0LFxuICAgIHV0aWxkZTogMzYxLFxuICAgIHZhbmdydDogMTA2NTIsXG4gICAgdmFycGhpOiA5NjYsXG4gICAgdmFycmhvOiAxMDA5LFxuICAgIHZlZWJhcjogODg5MSxcbiAgICB2ZWxsaXA6IDg5NDIsXG4gICAgdmVyYmFyOiAxMjQsXG4gICAgd2VkYmFyOiAxMDg0NyxcbiAgICB3ZWRnZXE6IDg3OTMsXG4gICAgd2VpZXJwOiA4NDcyLFxuICAgIHdyZWF0aDogODc2OCxcbiAgICB4b3BsdXM6IDEwNzUzLFxuICAgIHhvdGltZTogMTA3NTQsXG4gICAgeHNxY3VwOiAxMDc1OCxcbiAgICB4dXBsdXM6IDEwNzU2LFxuICAgIHh3ZWRnZTogODg5NixcbiAgICB5YWN1dGU6IDI1MyxcbiAgICB6YWN1dGU6IDM3OCxcbiAgICB6Y2Fyb246IDM4MixcbiAgICB6ZWV0cmY6IDg0ODgsXG4gICAgQUVsaWc6IDE5OCxcbiAgICBBY2lyYzogMTk0LFxuICAgIEFscGhhOiA5MTMsXG4gICAgQW1hY3I6IDI1NixcbiAgICBBb2dvbjogMjYwLFxuICAgIEFyaW5nOiAxOTcsXG4gICAgQnJldmU6IDcyOCxcbiAgICBDY2lyYzogMjY0LFxuICAgIENvbG9uOiA4NzU5LFxuICAgIENyb3NzOiAxMDc5OSxcbiAgICBEYXNodjogMTA5ODAsXG4gICAgRGVsdGE6IDkxNixcbiAgICBFY2lyYzogMjAyLFxuICAgIEVtYWNyOiAyNzQsXG4gICAgRW9nb246IDI4MCxcbiAgICBFcXVhbDogMTA4NjksXG4gICAgR2FtbWE6IDkxNSxcbiAgICBHY2lyYzogMjg0LFxuICAgIEhhY2VrOiA3MTEsXG4gICAgSGNpcmM6IDI5MixcbiAgICBJSmxpZzogMzA2LFxuICAgIEljaXJjOiAyMDYsXG4gICAgSW1hY3I6IDI5OCxcbiAgICBJb2dvbjogMzAyLFxuICAgIEl1a2N5OiAxMDMwLFxuICAgIEpjaXJjOiAzMDgsXG4gICAgSnVrY3k6IDEwMjgsXG4gICAgS2FwcGE6IDkyMixcbiAgICBPRWxpZzogMzM4LFxuICAgIE9jaXJjOiAyMTIsXG4gICAgT21hY3I6IDMzMixcbiAgICBPbWVnYTogOTM3LFxuICAgIFByaW1lOiA4MjQzLFxuICAgIFJCYXJyOiAxMDUxMixcbiAgICBTY2lyYzogMzQ4LFxuICAgIFNpZ21hOiA5MzEsXG4gICAgVEhPUk46IDIyMixcbiAgICBUUkFERTogODQ4MixcbiAgICBUU0hjeTogMTAzNSxcbiAgICBUaGV0YTogOTIwLFxuICAgIFRpbGRlOiA4NzY0LFxuICAgIFVicmN5OiAxMDM4LFxuICAgIFVjaXJjOiAyMTksXG4gICAgVW1hY3I6IDM2MixcbiAgICBVbmlvbjogODg5OSxcbiAgICBVb2dvbjogMzcwLFxuICAgIFVwVGVlOiA4ODY5LFxuICAgIFVyaW5nOiAzNjYsXG4gICAgVkRhc2g6IDg4NzUsXG4gICAgVmRhc2g6IDg4NzMsXG4gICAgV2NpcmM6IDM3MixcbiAgICBXZWRnZTogODg5NixcbiAgICBZY2lyYzogMzc0LFxuICAgIGFjaXJjOiAyMjYsXG4gICAgYWN1dGU6IDE4MCxcbiAgICBhZWxpZzogMjMwLFxuICAgIGFsZXBoOiA4NTAxLFxuICAgIGFscGhhOiA5NDUsXG4gICAgYW1hY3I6IDI1NyxcbiAgICBhbWFsZzogMTA4MTUsXG4gICAgYW5nbGU6IDg3MzYsXG4gICAgYW5ncnQ6IDg3MzUsXG4gICAgYW5nc3Q6IDg0OTEsXG4gICAgYW9nb246IDI2MSxcbiAgICBhcmluZzogMjI5LFxuICAgIGFzeW1wOiA4Nzc2LFxuICAgIGF3aW50OiAxMDc2OSxcbiAgICBiY29uZzogODc4MCxcbiAgICBiZHF1bzogODIyMixcbiAgICBiZXBzaTogMTAxNCxcbiAgICBibGFuazogOTI1MSxcbiAgICBibGsxMjogOTYxOCxcbiAgICBibGsxNDogOTYxNyxcbiAgICBibGszNDogOTYxOSxcbiAgICBibG9jazogOTYwOCxcbiAgICBib3hETDogOTU1OSxcbiAgICBib3hEUjogOTU1NixcbiAgICBib3hEbDogOTU1OCxcbiAgICBib3hEcjogOTU1NSxcbiAgICBib3hIRDogOTU3NCxcbiAgICBib3hIVTogOTU3NyxcbiAgICBib3hIZDogOTU3MixcbiAgICBib3hIdTogOTU3NSxcbiAgICBib3hVTDogOTU2NSxcbiAgICBib3hVUjogOTU2MixcbiAgICBib3hVbDogOTU2NCxcbiAgICBib3hVcjogOTU2MSxcbiAgICBib3hWSDogOTU4MCxcbiAgICBib3hWTDogOTU3MSxcbiAgICBib3hWUjogOTU2OCxcbiAgICBib3hWaDogOTU3OSxcbiAgICBib3hWbDogOTU3MCxcbiAgICBib3hWcjogOTU2NyxcbiAgICBib3hkTDogOTU1NyxcbiAgICBib3hkUjogOTU1NCxcbiAgICBib3hkbDogOTQ4OCxcbiAgICBib3hkcjogOTQ4NCxcbiAgICBib3hoRDogOTU3MyxcbiAgICBib3hoVTogOTU3NixcbiAgICBib3hoZDogOTUxNixcbiAgICBib3hodTogOTUyNCxcbiAgICBib3h1TDogOTU2MyxcbiAgICBib3h1UjogOTU2MCxcbiAgICBib3h1bDogOTQ5NixcbiAgICBib3h1cjogOTQ5MixcbiAgICBib3h2SDogOTU3OCxcbiAgICBib3h2TDogOTU2OSxcbiAgICBib3h2UjogOTU2NixcbiAgICBib3h2aDogOTUzMixcbiAgICBib3h2bDogOTUwOCxcbiAgICBib3h2cjogOTUwMCxcbiAgICBicmV2ZTogNzI4LFxuICAgIGJzZW1pOiA4MjcxLFxuICAgIGJzaW1lOiA4OTA5LFxuICAgIGJzb2xiOiAxMDY5MyxcbiAgICBidW1wRTogMTA5MjYsXG4gICAgYnVtcGU6IDg3ODMsXG4gICAgY2FyZXQ6IDgyNTcsXG4gICAgY2Fyb246IDcxMSxcbiAgICBjY2FwczogMTA4MjksXG4gICAgY2NpcmM6IDI2NSxcbiAgICBjY3VwczogMTA4MjgsXG4gICAgY2VkaWw6IDE4NCxcbiAgICBjaGVjazogMTAwMDMsXG4gICAgY2x1YnM6IDk4MjcsXG4gICAgY29sb246IDU4LFxuICAgIGNvbW1hOiA0NCxcbiAgICBjcmFycjogODYyOSxcbiAgICBjcm9zczogMTAwMDcsXG4gICAgY3N1YmU6IDEwOTYxLFxuICAgIGNzdXBlOiAxMDk2MixcbiAgICBjdGRvdDogODk0MyxcbiAgICBjdWVwcjogODkyNixcbiAgICBjdWVzYzogODkyNyxcbiAgICBjdXBvcjogMTA4MjEsXG4gICAgY3V2ZWU6IDg5MTAsXG4gICAgY3V3ZWQ6IDg5MTEsXG4gICAgY3dpbnQ6IDg3NTMsXG4gICAgZGFzaHY6IDg4NjcsXG4gICAgZGJsYWM6IDczMyxcbiAgICBkZGFycjogODY1MCxcbiAgICBkZWx0YTogOTQ4LFxuICAgIGRoYXJsOiA4NjQzLFxuICAgIGRoYXJyOiA4NjQyLFxuICAgIGRpYW1zOiA5ODMwLFxuICAgIGRpc2luOiA4OTQ2LFxuICAgIGRvdGVxOiA4Nzg0LFxuICAgIGR0ZG90OiA4OTQ1LFxuICAgIGR0cmlmOiA5NjYyLFxuICAgIGR1YXJyOiA4NjkzLFxuICAgIGR1aGFyOiAxMDYwNyxcbiAgICBlRERvdDogMTA4NzEsXG4gICAgZWNpcmM6IDIzNCxcbiAgICBlZkRvdDogODc4NixcbiAgICBlbWFjcjogMjc1LFxuICAgIGVtcHR5OiA4NzA5LFxuICAgIGVvZ29uOiAyODEsXG4gICAgZXBsdXM6IDEwODY1LFxuICAgIGVwc2l2OiA5NDksXG4gICAgZXFzaW06IDg3NzAsXG4gICAgZXF1aXY6IDg4MDEsXG4gICAgZXJEb3Q6IDg3ODcsXG4gICAgZXJhcnI6IDEwNjA5LFxuICAgIGVzZG90OiA4Nzg0LFxuICAgIGV4aXN0OiA4NzA3LFxuICAgIGZmbGlnOiA2NDI1NixcbiAgICBmaWxpZzogNjQyNTcsXG4gICAgZmxsaWc6IDY0MjU4LFxuICAgIGZsdG5zOiA5NjQ5LFxuICAgIGZvcmt2OiAxMDk2OSxcbiAgICBmcmFzbDogODI2MCxcbiAgICBmcm93bjogODk5NCxcbiAgICBnYW1tYTogOTQ3LFxuICAgIGdjaXJjOiAyODUsXG4gICAgZ2VzY2M6IDEwOTIxLFxuICAgIGdpbWVsOiA4NTAzLFxuICAgIGduZXFxOiA4ODA5LFxuICAgIGduc2ltOiA4OTM1LFxuICAgIGdyYXZlOiA5NixcbiAgICBnc2ltZTogMTA4OTQsXG4gICAgZ3NpbWw6IDEwODk2LFxuICAgIGd0Y2lyOiAxMDg3NCxcbiAgICBndGRvdDogODkxOSxcbiAgICBoYXJydzogODYyMSxcbiAgICBoY2lyYzogMjkzLFxuICAgIGhvYXJyOiA4NzAzLFxuICAgIGljaXJjOiAyMzgsXG4gICAgaWV4Y2w6IDE2MSxcbiAgICBpaWludDogODc0OSxcbiAgICBpaW90YTogODQ4OSxcbiAgICBpamxpZzogMzA3LFxuICAgIGltYWNyOiAyOTksXG4gICAgaW1hZ2U6IDg0NjUsXG4gICAgaW1hdGg6IDMwNSxcbiAgICBpbXBlZDogNDM3LFxuICAgIGluZmluOiA4NzM0LFxuICAgIGlvZ29uOiAzMDMsXG4gICAgaXByb2Q6IDEwODEyLFxuICAgIGlzaW5FOiA4OTUzLFxuICAgIGlzaW5zOiA4OTQ4LFxuICAgIGlzaW52OiA4NzEyLFxuICAgIGl1a2N5OiAxMTEwLFxuICAgIGpjaXJjOiAzMDksXG4gICAgam1hdGg6IDU2NyxcbiAgICBqdWtjeTogMTEwOCxcbiAgICBrYXBwYTogOTU0LFxuICAgIGxBYXJyOiA4NjY2LFxuICAgIGxCYXJyOiAxMDUxMCxcbiAgICBsYW5nZDogMTA2NDEsXG4gICAgbGFxdW86IDE3MSxcbiAgICBsYXJyYjogODY3NixcbiAgICBsYmFycjogMTA1MDgsXG4gICAgbGJicms6IDEwMDk4LFxuICAgIGxicmtlOiAxMDYzNSxcbiAgICBsY2VpbDogODk2OCxcbiAgICBsZHF1bzogODIyMCxcbiAgICBsZXNjYzogMTA5MjAsXG4gICAgbGhhcmQ6IDg2MzcsXG4gICAgbGhhcnU6IDg2MzYsXG4gICAgbGhibGs6IDk2MDQsXG4gICAgbGxhcnI6IDg2NDcsXG4gICAgbGx0cmk6IDk3MjIsXG4gICAgbG5lcXE6IDg4MDgsXG4gICAgbG5zaW06IDg5MzQsXG4gICAgbG9hbmc6IDEwMjIwLFxuICAgIGxvYXJyOiA4NzAxLFxuICAgIGxvYnJrOiAxMDIxNCxcbiAgICBsb3BhcjogMTA2MjksXG4gICAgbHJhcnI6IDg2NDYsXG4gICAgbHJoYXI6IDg2NTEsXG4gICAgbHJ0cmk6IDg4OTUsXG4gICAgbHNpbWU6IDEwODkzLFxuICAgIGxzaW1nOiAxMDg5NSxcbiAgICBsc3F1bzogODIxNixcbiAgICBsdGNpcjogMTA4NzMsXG4gICAgbHRkb3Q6IDg5MTgsXG4gICAgbHRyaWU6IDg4ODQsXG4gICAgbHRyaWY6IDk2NjYsXG4gICAgbUREb3Q6IDg3NjIsXG4gICAgbWRhc2g6IDgyMTIsXG4gICAgbWljcm86IDE4MSxcbiAgICBtaW51czogODcyMixcbiAgICBtdW1hcDogODg4OCxcbiAgICBuYWJsYTogODcxMSxcbiAgICBuYXBvczogMzI5LFxuICAgIG5hdHVyOiA5ODM4LFxuICAgIG5jb25nOiA4Nzc1LFxuICAgIG5kYXNoOiA4MjExLFxuICAgIG5lQXJyOiA4NjYzLFxuICAgIG5lYXJyOiA4NTk5LFxuICAgIG5nc2ltOiA4ODIxLFxuICAgIG5oQXJyOiA4NjU0LFxuICAgIG5oYXJyOiA4NjIyLFxuICAgIG5ocGFyOiAxMDk5NCxcbiAgICBubEFycjogODY1MyxcbiAgICBubGFycjogODYwMixcbiAgICBubGVzczogODgxNCxcbiAgICBubHNpbTogODgyMCxcbiAgICBubHRyaTogODkzOCxcbiAgICBub3RpbjogODcxMyxcbiAgICBub3RuaTogODcxNixcbiAgICBucHJlYzogODgzMixcbiAgICBuckFycjogODY1NSxcbiAgICBucmFycjogODYwMyxcbiAgICBucnRyaTogODkzOSxcbiAgICBuc2ltZTogODc3MixcbiAgICBuc21pZDogODc0MCxcbiAgICBuc3BhcjogODc0MixcbiAgICBuc3ViZTogODg0MCxcbiAgICBuc3VjYzogODgzMyxcbiAgICBuc3VwZTogODg0MSxcbiAgICBudW1zcDogODE5OSxcbiAgICBud0FycjogODY2MixcbiAgICBud2FycjogODU5OCxcbiAgICBvY2lyYzogMjQ0LFxuICAgIG9kYXNoOiA4ODYxLFxuICAgIG9lbGlnOiAzMzksXG4gICAgb2ZjaXI6IDEwNjg3LFxuICAgIG9oYmFyOiAxMDY3NyxcbiAgICBvbGFycjogODYzNCxcbiAgICBvbGNpcjogMTA2ODYsXG4gICAgb2xpbmU6IDgyNTQsXG4gICAgb21hY3I6IDMzMyxcbiAgICBvbWVnYTogOTY5LFxuICAgIG9wZXJwOiAxMDY4MSxcbiAgICBvcGx1czogODg1MyxcbiAgICBvcmFycjogODYzNSxcbiAgICBvcmRlcjogODUwMCxcbiAgICBvdmJhcjogOTAyMSxcbiAgICBwYXJzbDogMTEwMDUsXG4gICAgcGhvbmU6IDk3NDIsXG4gICAgcGx1c2I6IDg4NjIsXG4gICAgcGx1c2U6IDEwODY2LFxuICAgIHBvdW5kOiAxNjMsXG4gICAgcHJjdWU6IDg4MjgsXG4gICAgcHJpbWU6IDgyNDIsXG4gICAgcHJuYXA6IDEwOTM3LFxuICAgIHByc2ltOiA4ODMwLFxuICAgIHF1ZXN0OiA2MyxcbiAgICByQWFycjogODY2NyxcbiAgICByQmFycjogMTA1MTEsXG4gICAgcmFkaWM6IDg3MzAsXG4gICAgcmFuZ2Q6IDEwNjQyLFxuICAgIHJhbmdlOiAxMDY2MSxcbiAgICByYXF1bzogMTg3LFxuICAgIHJhcnJiOiA4Njc3LFxuICAgIHJhcnJjOiAxMDU0NyxcbiAgICByYXJydzogODYwNSxcbiAgICByYXRpbzogODc1OCxcbiAgICByYmFycjogMTA1MDksXG4gICAgcmJicms6IDEwMDk5LFxuICAgIHJicmtlOiAxMDYzNixcbiAgICByY2VpbDogODk2OSxcbiAgICByZHF1bzogODIyMSxcbiAgICByZWFsczogODQ3NyxcbiAgICByaGFyZDogODY0MSxcbiAgICByaGFydTogODY0MCxcbiAgICBybGFycjogODY0NCxcbiAgICBybGhhcjogODY1MixcbiAgICBybm1pZDogMTA5OTAsXG4gICAgcm9hbmc6IDEwMjIxLFxuICAgIHJvYXJyOiA4NzAyLFxuICAgIHJvYnJrOiAxMDIxNSxcbiAgICByb3BhcjogMTA2MzAsXG4gICAgcnJhcnI6IDg2NDksXG4gICAgcnNxdW86IDgyMTcsXG4gICAgcnRyaWU6IDg4ODUsXG4gICAgcnRyaWY6IDk2NTYsXG4gICAgc2JxdW86IDgyMTgsXG4gICAgc2NjdWU6IDg4MjksXG4gICAgc2NpcmM6IDM0OSxcbiAgICBzY25hcDogMTA5MzgsXG4gICAgc2NzaW06IDg4MzEsXG4gICAgc2RvdGI6IDg4NjUsXG4gICAgc2RvdGU6IDEwODU0LFxuICAgIHNlQXJyOiA4NjY0LFxuICAgIHNlYXJyOiA4NjAwLFxuICAgIHNldG1uOiA4NzI2LFxuICAgIHNoYXJwOiA5ODM5LFxuICAgIHNpZ21hOiA5NjMsXG4gICAgc2ltZXE6IDg3NzEsXG4gICAgc2ltZ0U6IDEwOTEyLFxuICAgIHNpbWxFOiAxMDkxMSxcbiAgICBzaW1uZTogODc3NCxcbiAgICBzbGFycjogODU5MixcbiAgICBzbWlsZTogODk5NSxcbiAgICBzcWNhcDogODg1MSxcbiAgICBzcWN1cDogODg1MixcbiAgICBzcXN1YjogODg0NyxcbiAgICBzcXN1cDogODg0OCxcbiAgICBzcmFycjogODU5NCxcbiAgICBzdGFyZjogOTczMyxcbiAgICBzdHJuczogMTc1LFxuICAgIHN1Ym5FOiAxMDk1NSxcbiAgICBzdWJuZTogODg0MixcbiAgICBzdXBuRTogMTA5NTYsXG4gICAgc3VwbmU6IDg4NDMsXG4gICAgc3dBcnI6IDg2NjUsXG4gICAgc3dhcnI6IDg2MDEsXG4gICAgc3psaWc6IDIyMyxcbiAgICB0aGV0YTogOTUyLFxuICAgIHRoa2FwOiA4Nzc2LFxuICAgIHRob3JuOiAyNTQsXG4gICAgdGlsZGU6IDczMixcbiAgICB0aW1lczogMjE1LFxuICAgIHRyYWRlOiA4NDgyLFxuICAgIHRyaXNiOiAxMDcwMSxcbiAgICB0c2hjeTogMTExNSxcbiAgICB0d2l4dDogODgxMixcbiAgICB1YnJjeTogMTExOCxcbiAgICB1Y2lyYzogMjUxLFxuICAgIHVkYXJyOiA4NjQ1LFxuICAgIHVkaGFyOiAxMDYwNixcbiAgICB1aGFybDogODYzOSxcbiAgICB1aGFycjogODYzOCxcbiAgICB1aGJsazogOTYwMCxcbiAgICB1bHRyaTogOTcyMCxcbiAgICB1bWFjcjogMzYzLFxuICAgIHVvZ29uOiAzNzEsXG4gICAgdXBsdXM6IDg4NDYsXG4gICAgdXBzaWg6IDk3OCxcbiAgICB1cmluZzogMzY3LFxuICAgIHVydHJpOiA5NzIxLFxuICAgIHV0ZG90OiA4OTQ0LFxuICAgIHV0cmlmOiA5NjUyLFxuICAgIHV1YXJyOiA4NjQ4LFxuICAgIHZCYXJ2OiAxMDk4NSxcbiAgICB2RGFzaDogODg3MixcbiAgICB2YXJwaTogOTgyLFxuICAgIHZkYXNoOiA4ODY2LFxuICAgIHZlZWVxOiA4Nzk0LFxuICAgIHZsdHJpOiA4ODgyLFxuICAgIHZwcm9wOiA4NzMzLFxuICAgIHZydHJpOiA4ODgzLFxuICAgIHdjaXJjOiAzNzMsXG4gICAgd2VkZ2U6IDg3NDMsXG4gICAgeGNpcmM6IDk3MTEsXG4gICAgeGR0cmk6IDk2NjEsXG4gICAgeGhBcnI6IDEwMjM0LFxuICAgIHhoYXJyOiAxMDIzMSxcbiAgICB4bEFycjogMTAyMzIsXG4gICAgeGxhcnI6IDEwMjI5LFxuICAgIHhvZG90OiAxMDc1MixcbiAgICB4ckFycjogMTAyMzMsXG4gICAgeHJhcnI6IDEwMjMwLFxuICAgIHh1dHJpOiA5NjUxLFxuICAgIHljaXJjOiAzNzUsXG4gICAgQW9wZjogMTIwMTIwLFxuICAgIEFzY3I6IDExOTk2NCxcbiAgICBBdW1sOiAxOTYsXG4gICAgQmFydjogMTA5ODMsXG4gICAgQmV0YTogOTE0LFxuICAgIEJvcGY6IDEyMDEyMSxcbiAgICBCc2NyOiA4NDkyLFxuICAgIENIY3k6IDEwNjMsXG4gICAgQ09QWTogMTY5LFxuICAgIENkb3Q6IDI2NixcbiAgICBDb3BmOiA4NDUwLFxuICAgIENzY3I6IDExOTk2NixcbiAgICBESmN5OiAxMDI2LFxuICAgIERTY3k6IDEwMjksXG4gICAgRFpjeTogMTAzOSxcbiAgICBEYXJyOiA4NjA5LFxuICAgIERvcGY6IDEyMDEyMyxcbiAgICBEc2NyOiAxMTk5NjcsXG4gICAgRWRvdDogMjc4LFxuICAgIEVvcGY6IDEyMDEyNCxcbiAgICBFc2NyOiA4NDk2LFxuICAgIEVzaW06IDEwODY3LFxuICAgIEV1bWw6IDIwMyxcbiAgICBGb3BmOiAxMjAxMjUsXG4gICAgRnNjcjogODQ5NyxcbiAgICBHSmN5OiAxMDI3LFxuICAgIEdkb3Q6IDI4OCxcbiAgICBHb3BmOiAxMjAxMjYsXG4gICAgR3NjcjogMTE5OTcwLFxuICAgIEhvcGY6IDg0NjEsXG4gICAgSHNjcjogODQ1OSxcbiAgICBJRWN5OiAxMDQ1LFxuICAgIElPY3k6IDEwMjUsXG4gICAgSWRvdDogMzA0LFxuICAgIElvcGY6IDEyMDEyOCxcbiAgICBJb3RhOiA5MjEsXG4gICAgSXNjcjogODQ2NCxcbiAgICBJdW1sOiAyMDcsXG4gICAgSm9wZjogMTIwMTI5LFxuICAgIEpzY3I6IDExOTk3MyxcbiAgICBLSGN5OiAxMDYxLFxuICAgIEtKY3k6IDEwMzYsXG4gICAgS29wZjogMTIwMTMwLFxuICAgIEtzY3I6IDExOTk3NCxcbiAgICBMSmN5OiAxMDMzLFxuICAgIExhbmc6IDEwMjE4LFxuICAgIExhcnI6IDg2MDYsXG4gICAgTG9wZjogMTIwMTMxLFxuICAgIExzY3I6IDg0NjYsXG4gICAgTW9wZjogMTIwMTMyLFxuICAgIE1zY3I6IDg0OTksXG4gICAgTkpjeTogMTAzNCxcbiAgICBOb3BmOiA4NDY5LFxuICAgIE5zY3I6IDExOTk3NyxcbiAgICBPb3BmOiAxMjAxMzQsXG4gICAgT3NjcjogMTE5OTc4LFxuICAgIE91bWw6IDIxNCxcbiAgICBQb3BmOiA4NDczLFxuICAgIFBzY3I6IDExOTk3OSxcbiAgICBRVU9UOiAzNCxcbiAgICBRb3BmOiA4NDc0LFxuICAgIFFzY3I6IDExOTk4MCxcbiAgICBSYW5nOiAxMDIxOSxcbiAgICBSYXJyOiA4NjA4LFxuICAgIFJvcGY6IDg0NzcsXG4gICAgUnNjcjogODQ3NSxcbiAgICBTSGN5OiAxMDY0LFxuICAgIFNvcGY6IDEyMDEzOCxcbiAgICBTcXJ0OiA4NzMwLFxuICAgIFNzY3I6IDExOTk4MixcbiAgICBTdGFyOiA4OTAyLFxuICAgIFRTY3k6IDEwNjIsXG4gICAgVG9wZjogMTIwMTM5LFxuICAgIFRzY3I6IDExOTk4MyxcbiAgICBVYXJyOiA4NjA3LFxuICAgIFVvcGY6IDEyMDE0MCxcbiAgICBVcHNpOiA5NzgsXG4gICAgVXNjcjogMTE5OTg0LFxuICAgIFV1bWw6IDIyMCxcbiAgICBWYmFyOiAxMDk4NyxcbiAgICBWZXJ0OiA4MjE0LFxuICAgIFZvcGY6IDEyMDE0MSxcbiAgICBWc2NyOiAxMTk5ODUsXG4gICAgV29wZjogMTIwMTQyLFxuICAgIFdzY3I6IDExOTk4NixcbiAgICBYb3BmOiAxMjAxNDMsXG4gICAgWHNjcjogMTE5OTg3LFxuICAgIFlBY3k6IDEwNzEsXG4gICAgWUljeTogMTAzMSxcbiAgICBZVWN5OiAxMDcwLFxuICAgIFlvcGY6IDEyMDE0NCxcbiAgICBZc2NyOiAxMTk5ODgsXG4gICAgWXVtbDogMzc2LFxuICAgIFpIY3k6IDEwNDYsXG4gICAgWmRvdDogMzc5LFxuICAgIFpldGE6IDkxOCxcbiAgICBab3BmOiA4NDg0LFxuICAgIFpzY3I6IDExOTk4OSxcbiAgICBhbmRkOiAxMDg0NCxcbiAgICBhbmR2OiAxMDg0MixcbiAgICBhbmdlOiAxMDY2MCxcbiAgICBhb3BmOiAxMjAxNDYsXG4gICAgYXBpZDogODc3OSxcbiAgICBhcG9zOiAzOSxcbiAgICBhc2NyOiAxMTk5OTAsXG4gICAgYXVtbDogMjI4LFxuICAgIGJOb3Q6IDEwOTg5LFxuICAgIGJicms6IDkxNDEsXG4gICAgYmV0YTogOTQ2LFxuICAgIGJldGg6IDg1MDIsXG4gICAgYm5vdDogODk3NixcbiAgICBib3BmOiAxMjAxNDcsXG4gICAgYm94SDogOTU1MixcbiAgICBib3hWOiA5NTUzLFxuICAgIGJveGg6IDk0NzIsXG4gICAgYm94djogOTQ3NCxcbiAgICBic2NyOiAxMTk5OTEsXG4gICAgYnNpbTogODc2NSxcbiAgICBic29sOiA5MixcbiAgICBidWxsOiA4MjI2LFxuICAgIGJ1bXA6IDg3ODIsXG4gICAgY2RvdDogMjY3LFxuICAgIGNlbnQ6IDE2MixcbiAgICBjaGN5OiAxMDk1LFxuICAgIGNpckU6IDEwNjkxLFxuICAgIGNpcmM6IDcxMCxcbiAgICBjaXJlOiA4NzkxLFxuICAgIGNvbXA6IDg3MDUsXG4gICAgY29uZzogODc3MyxcbiAgICBjb3BmOiAxMjAxNDgsXG4gICAgY29weTogMTY5LFxuICAgIGNzY3I6IDExOTk5MixcbiAgICBjc3ViOiAxMDk1OSxcbiAgICBjc3VwOiAxMDk2MCxcbiAgICBkQXJyOiA4NjU5LFxuICAgIGRIYXI6IDEwNTk3LFxuICAgIGRhcnI6IDg1OTUsXG4gICAgZGFzaDogODIwOCxcbiAgICBkaWFtOiA4OTAwLFxuICAgIGRqY3k6IDExMDYsXG4gICAgZG9wZjogMTIwMTQ5LFxuICAgIGRzY3I6IDExOTk5MyxcbiAgICBkc2N5OiAxMTA5LFxuICAgIGRzb2w6IDEwNzQyLFxuICAgIGR0cmk6IDk2NjMsXG4gICAgZHpjeTogMTExOSxcbiAgICBlRG90OiA4Nzg1LFxuICAgIGVjaXI6IDg3OTAsXG4gICAgZWRvdDogMjc5LFxuICAgIGVtc3A6IDgxOTUsXG4gICAgZW5zcDogODE5NCxcbiAgICBlb3BmOiAxMjAxNTAsXG4gICAgZXBhcjogODkxNyxcbiAgICBlcHNpOiAxMDEzLFxuICAgIGVzY3I6IDg0OTUsXG4gICAgZXNpbTogODc3MCxcbiAgICBldW1sOiAyMzUsXG4gICAgZXVybzogODM2NCxcbiAgICBleGNsOiAzMyxcbiAgICBmbGF0OiA5ODM3LFxuICAgIGZub2Y6IDQwMixcbiAgICBmb3BmOiAxMjAxNTEsXG4gICAgZm9yazogODkxNixcbiAgICBmc2NyOiAxMTk5OTUsXG4gICAgZ2RvdDogMjg5LFxuICAgIGdlcXE6IDg4MDcsXG4gICAgZ2pjeTogMTEwNyxcbiAgICBnbmFwOiAxMDg5MCxcbiAgICBnbmVxOiAxMDg4OCxcbiAgICBnb3BmOiAxMjAxNTIsXG4gICAgZ3NjcjogODQ1OCxcbiAgICBnc2ltOiA4ODE5LFxuICAgIGd0Y2M6IDEwOTE5LFxuICAgIGhBcnI6IDg2NjAsXG4gICAgaGFsZjogMTg5LFxuICAgIGhhcnI6IDg1OTYsXG4gICAgaGJhcjogODQ2MyxcbiAgICBob3BmOiAxMjAxNTMsXG4gICAgaHNjcjogMTE5OTk3LFxuICAgIGllY3k6IDEwNzcsXG4gICAgaW1vZjogODg4NyxcbiAgICBpb2N5OiAxMTA1LFxuICAgIGlvcGY6IDEyMDE1NCxcbiAgICBpb3RhOiA5NTMsXG4gICAgaXNjcjogMTE5OTk4LFxuICAgIGlzaW46IDg3MTIsXG4gICAgaXVtbDogMjM5LFxuICAgIGpvcGY6IDEyMDE1NSxcbiAgICBqc2NyOiAxMTk5OTksXG4gICAga2hjeTogMTA5MyxcbiAgICBramN5OiAxMTE2LFxuICAgIGtvcGY6IDEyMDE1NixcbiAgICBrc2NyOiAxMjAwMDAsXG4gICAgbEFycjogODY1NixcbiAgICBsSGFyOiAxMDU5NCxcbiAgICBsYW5nOiAxMDIxNixcbiAgICBsYXJyOiA4NTkyLFxuICAgIGxhdGU6IDEwOTI1LFxuICAgIGxjdWI6IDEyMyxcbiAgICBsZGNhOiAxMDU1MCxcbiAgICBsZHNoOiA4NjI2LFxuICAgIGxlcXE6IDg4MDYsXG4gICAgbGpjeTogMTExMyxcbiAgICBsbmFwOiAxMDg4OSxcbiAgICBsbmVxOiAxMDg4NyxcbiAgICBsb3BmOiAxMjAxNTcsXG4gICAgbG96ZjogMTA3MzEsXG4gICAgbHBhcjogNDAsXG4gICAgbHNjcjogMTIwMDAxLFxuICAgIGxzaW06IDg4MTgsXG4gICAgbHNxYjogOTEsXG4gICAgbHRjYzogMTA5MTgsXG4gICAgbHRyaTogOTY2NyxcbiAgICBtYWNyOiAxNzUsXG4gICAgbWFsZTogOTc5NCxcbiAgICBtYWx0OiAxMDAxNixcbiAgICBtbGNwOiAxMDk3MSxcbiAgICBtbGRyOiA4MjMwLFxuICAgIG1vcGY6IDEyMDE1OCxcbiAgICBtc2NyOiAxMjAwMDIsXG4gICAgbmJzcDogMTYwLFxuICAgIG5jYXA6IDEwODE5LFxuICAgIG5jdXA6IDEwODE4LFxuICAgIG5nZXE6IDg4MTcsXG4gICAgbmd0cjogODgxNSxcbiAgICBuaXNkOiA4OTU0LFxuICAgIG5qY3k6IDExMTQsXG4gICAgbmxkcjogODIyOSxcbiAgICBubGVxOiA4ODE2LFxuICAgIG5taWQ6IDg3NDAsXG4gICAgbm9wZjogMTIwMTU5LFxuICAgIG5wYXI6IDg3NDIsXG4gICAgbnNjcjogMTIwMDAzLFxuICAgIG5zaW06IDg3NjksXG4gICAgbnN1YjogODgzNixcbiAgICBuc3VwOiA4ODM3LFxuICAgIG50Z2w6IDg4MjUsXG4gICAgbnRsZzogODgyNCxcbiAgICBvYXN0OiA4ODU5LFxuICAgIG9jaXI6IDg4NTgsXG4gICAgb2RpdjogMTA4MDgsXG4gICAgb2RvdDogODg1NyxcbiAgICBvZ29uOiA3MzEsXG4gICAgb2ludDogODc1MCxcbiAgICBvbWlkOiAxMDY3OCxcbiAgICBvb3BmOiAxMjAxNjAsXG4gICAgb3BhcjogMTA2NzksXG4gICAgb3JkZjogMTcwLFxuICAgIG9yZG06IDE4NixcbiAgICBvcm9yOiAxMDgzOCxcbiAgICBvc2NyOiA4NTAwLFxuICAgIG9zb2w6IDg4NTYsXG4gICAgb3VtbDogMjQ2LFxuICAgIHBhcmE6IDE4MixcbiAgICBwYXJ0OiA4NzA2LFxuICAgIHBlcnA6IDg4NjksXG4gICAgcGhpdjogOTY2LFxuICAgIHBsdXM6IDQzLFxuICAgIHBvcGY6IDEyMDE2MSxcbiAgICBwcmFwOiAxMDkzNSxcbiAgICBwcmVjOiA4ODI2LFxuICAgIHBybkU6IDEwOTMzLFxuICAgIHByb2Q6IDg3MTksXG4gICAgcHJvcDogODczMyxcbiAgICBwc2NyOiAxMjAwMDUsXG4gICAgcWludDogMTA3NjQsXG4gICAgcW9wZjogMTIwMTYyLFxuICAgIHFzY3I6IDEyMDAwNixcbiAgICBxdW90OiAzNCxcbiAgICByQXJyOiA4NjU4LFxuICAgIHJIYXI6IDEwNTk2LFxuICAgIHJhY2U6IDEwNzE0LFxuICAgIHJhbmc6IDEwMjE3LFxuICAgIHJhcnI6IDg1OTQsXG4gICAgcmN1YjogMTI1LFxuICAgIHJkY2E6IDEwNTUxLFxuICAgIHJkc2g6IDg2MjcsXG4gICAgcmVhbDogODQ3NixcbiAgICByZWN0OiA5NjQ1LFxuICAgIHJob3Y6IDEwMDksXG4gICAgcmluZzogNzMwLFxuICAgIHJvcGY6IDEyMDE2MyxcbiAgICBycGFyOiA0MSxcbiAgICByc2NyOiAxMjAwMDcsXG4gICAgcnNxYjogOTMsXG4gICAgcnRyaTogOTY1NyxcbiAgICBzY2FwOiAxMDkzNixcbiAgICBzY25FOiAxMDkzNCxcbiAgICBzZG90OiA4OTAxLFxuICAgIHNlY3Q6IDE2NyxcbiAgICBzZW1pOiA1OSxcbiAgICBzZXh0OiAxMDAzOCxcbiAgICBzaGN5OiAxMDk2LFxuICAgIHNpbWU6IDg3NzEsXG4gICAgc2ltZzogMTA5MTAsXG4gICAgc2ltbDogMTA5MDksXG4gICAgc21pZDogODczOSxcbiAgICBzbXRlOiAxMDkyNCxcbiAgICBzb2xiOiAxMDY5MixcbiAgICBzb3BmOiAxMjAxNjQsXG4gICAgc3BhcjogODc0MSxcbiAgICBzcXVmOiA5NjQyLFxuICAgIHNzY3I6IDEyMDAwOCxcbiAgICBzdGFyOiA5NzM0LFxuICAgIHN1YkU6IDEwOTQ5LFxuICAgIHN1YmU6IDg4MzgsXG4gICAgc3VjYzogODgyNyxcbiAgICBzdW5nOiA5ODM0LFxuICAgIHN1cDE6IDE4NSxcbiAgICBzdXAyOiAxNzgsXG4gICAgc3VwMzogMTc5LFxuICAgIHN1cEU6IDEwOTUwLFxuICAgIHN1cGU6IDg4MzksXG4gICAgdGJyazogOTE0MCxcbiAgICB0ZG90OiA4NDExLFxuICAgIHRpbnQ6IDg3NDksXG4gICAgdG9lYTogMTA1MzYsXG4gICAgdG9wZjogMTIwMTY1LFxuICAgIHRvc2E6IDEwNTM3LFxuICAgIHRyaWU6IDg3OTYsXG4gICAgdHNjcjogMTIwMDA5LFxuICAgIHRzY3k6IDEwOTQsXG4gICAgdUFycjogODY1NyxcbiAgICB1SGFyOiAxMDU5NSxcbiAgICB1YXJyOiA4NTkzLFxuICAgIHVvcGY6IDEyMDE2NixcbiAgICB1cHNpOiA5NjUsXG4gICAgdXNjcjogMTIwMDEwLFxuICAgIHV0cmk6IDk2NTMsXG4gICAgdXVtbDogMjUyLFxuICAgIHZBcnI6IDg2NjEsXG4gICAgdkJhcjogMTA5ODQsXG4gICAgdmFycjogODU5NyxcbiAgICB2ZXJ0OiAxMjQsXG4gICAgdm9wZjogMTIwMTY3LFxuICAgIHZzY3I6IDEyMDAxMSxcbiAgICB3b3BmOiAxMjAxNjgsXG4gICAgd3NjcjogMTIwMDEyLFxuICAgIHhjYXA6IDg4OTgsXG4gICAgeGN1cDogODg5OSxcbiAgICB4bWFwOiAxMDIzNixcbiAgICB4bmlzOiA4OTU1LFxuICAgIHhvcGY6IDEyMDE2OSxcbiAgICB4c2NyOiAxMjAwMTMsXG4gICAgeHZlZTogODg5NyxcbiAgICB5YWN5OiAxMTAzLFxuICAgIHlpY3k6IDExMTEsXG4gICAgeW9wZjogMTIwMTcwLFxuICAgIHlzY3I6IDEyMDAxNCxcbiAgICB5dWN5OiAxMTAyLFxuICAgIHl1bWw6IDI1NSxcbiAgICB6ZG90OiAzODAsXG4gICAgemV0YTogOTUwLFxuICAgIHpoY3k6IDEwNzgsXG4gICAgem9wZjogMTIwMTcxLFxuICAgIHpzY3I6IDEyMDAxNSxcbiAgICB6d25qOiA4MjA0LFxuICAgIEFNUDogMzgsXG4gICAgQWN5OiAxMDQwLFxuICAgIEFmcjogMTIwMDY4LFxuICAgIEFuZDogMTA4MzUsXG4gICAgQmN5OiAxMDQxLFxuICAgIEJmcjogMTIwMDY5LFxuICAgIENhcDogODkxNCxcbiAgICBDZnI6IDg0OTMsXG4gICAgQ2hpOiA5MzUsXG4gICAgQ3VwOiA4OTE1LFxuICAgIERjeTogMTA0NCxcbiAgICBEZWw6IDg3MTEsXG4gICAgRGZyOiAxMjAwNzEsXG4gICAgRG90OiAxNjgsXG4gICAgRU5HOiAzMzAsXG4gICAgRVRIOiAyMDgsXG4gICAgRWN5OiAxMDY5LFxuICAgIEVmcjogMTIwMDcyLFxuICAgIEV0YTogOTE5LFxuICAgIEZjeTogMTA2MCxcbiAgICBGZnI6IDEyMDA3MyxcbiAgICBHY3k6IDEwNDMsXG4gICAgR2ZyOiAxMjAwNzQsXG4gICAgSGF0OiA5NCxcbiAgICBIZnI6IDg0NjAsXG4gICAgSWN5OiAxMDQ4LFxuICAgIElmcjogODQ2NSxcbiAgICBJbnQ6IDg3NDgsXG4gICAgSmN5OiAxMDQ5LFxuICAgIEpmcjogMTIwMDc3LFxuICAgIEtjeTogMTA1MCxcbiAgICBLZnI6IDEyMDA3OCxcbiAgICBMY3k6IDEwNTEsXG4gICAgTGZyOiAxMjAwNzksXG4gICAgTHNoOiA4NjI0LFxuICAgIE1hcDogMTA1MDEsXG4gICAgTWN5OiAxMDUyLFxuICAgIE1mcjogMTIwMDgwLFxuICAgIE5jeTogMTA1MyxcbiAgICBOZnI6IDEyMDA4MSxcbiAgICBOb3Q6IDEwOTg4LFxuICAgIE9jeTogMTA1NCxcbiAgICBPZnI6IDEyMDA4MixcbiAgICBQY3k6IDEwNTUsXG4gICAgUGZyOiAxMjAwODMsXG4gICAgUGhpOiA5MzQsXG4gICAgUHNpOiA5MzYsXG4gICAgUWZyOiAxMjAwODQsXG4gICAgUkVHOiAxNzQsXG4gICAgUmN5OiAxMDU2LFxuICAgIFJmcjogODQ3NixcbiAgICBSaG86IDkyOSxcbiAgICBSc2g6IDg2MjUsXG4gICAgU2N5OiAxMDU3LFxuICAgIFNmcjogMTIwMDg2LFxuICAgIFN1YjogODkxMixcbiAgICBTdW06IDg3MjEsXG4gICAgU3VwOiA4OTEzLFxuICAgIFRhYjogOSxcbiAgICBUYXU6IDkzMixcbiAgICBUY3k6IDEwNTgsXG4gICAgVGZyOiAxMjAwODcsXG4gICAgVWN5OiAxMDU5LFxuICAgIFVmcjogMTIwMDg4LFxuICAgIFZjeTogMTA0MixcbiAgICBWZWU6IDg4OTcsXG4gICAgVmZyOiAxMjAwODksXG4gICAgV2ZyOiAxMjAwOTAsXG4gICAgWGZyOiAxMjAwOTEsXG4gICAgWWN5OiAxMDY3LFxuICAgIFlmcjogMTIwMDkyLFxuICAgIFpjeTogMTA0NyxcbiAgICBaZnI6IDg0ODgsXG4gICAgYWNkOiA4NzY3LFxuICAgIGFjeTogMTA3MixcbiAgICBhZnI6IDEyMDA5NCxcbiAgICBhbXA6IDM4LFxuICAgIGFuZDogODc0MyxcbiAgICBhbmc6IDg3MzYsXG4gICAgYXBFOiAxMDg2NCxcbiAgICBhcGU6IDg3NzgsXG4gICAgYXN0OiA0MixcbiAgICBiY3k6IDEwNzMsXG4gICAgYmZyOiAxMjAwOTUsXG4gICAgYm90OiA4ODY5LFxuICAgIGNhcDogODc0NSxcbiAgICBjZnI6IDEyMDA5NixcbiAgICBjaGk6IDk2NyxcbiAgICBjaXI6IDk2NzUsXG4gICAgY3VwOiA4NzQ2LFxuICAgIGRjeTogMTA3NixcbiAgICBkZWc6IDE3NixcbiAgICBkZnI6IDEyMDA5NyxcbiAgICBkaWU6IDE2OCxcbiAgICBkaXY6IDI0NyxcbiAgICBkb3Q6IDcyOSxcbiAgICBlY3k6IDExMDEsXG4gICAgZWZyOiAxMjAwOTgsXG4gICAgZWdzOiAxMDkwMixcbiAgICBlbGw6IDg0NjcsXG4gICAgZWxzOiAxMDkwMSxcbiAgICBlbmc6IDMzMSxcbiAgICBldGE6IDk1MSxcbiAgICBldGg6IDI0MCxcbiAgICBmY3k6IDEwOTIsXG4gICAgZmZyOiAxMjAwOTksXG4gICAgZ0VsOiAxMDg5MixcbiAgICBnYXA6IDEwODg2LFxuICAgIGdjeTogMTA3NSxcbiAgICBnZWw6IDg5MjMsXG4gICAgZ2VxOiA4ODA1LFxuICAgIGdlczogMTA4NzgsXG4gICAgZ2ZyOiAxMjAxMDAsXG4gICAgZ2dnOiA4OTIxLFxuICAgIGdsRTogMTA4OTgsXG4gICAgZ2xhOiAxMDkxNyxcbiAgICBnbGo6IDEwOTE2LFxuICAgIGduRTogODgwOSxcbiAgICBnbmU6IDEwODg4LFxuICAgIGhmcjogMTIwMTAxLFxuICAgIGljeTogMTA4MCxcbiAgICBpZmY6IDg2NjAsXG4gICAgaWZyOiAxMjAxMDIsXG4gICAgaW50OiA4NzQ3LFxuICAgIGpjeTogMTA4MSxcbiAgICBqZnI6IDEyMDEwMyxcbiAgICBrY3k6IDEwODIsXG4gICAga2ZyOiAxMjAxMDQsXG4gICAgbEVnOiAxMDg5MSxcbiAgICBsYXA6IDEwODg1LFxuICAgIGxhdDogMTA5MjMsXG4gICAgbGN5OiAxMDgzLFxuICAgIGxlZzogODkyMixcbiAgICBsZXE6IDg4MDQsXG4gICAgbGVzOiAxMDg3NyxcbiAgICBsZnI6IDEyMDEwNSxcbiAgICBsZ0U6IDEwODk3LFxuICAgIGxuRTogODgwOCxcbiAgICBsbmU6IDEwODg3LFxuICAgIGxvejogOTY3NCxcbiAgICBscm06IDgyMDYsXG4gICAgbHNoOiA4NjI0LFxuICAgIG1hcDogODYxNCxcbiAgICBtY3k6IDEwODQsXG4gICAgbWZyOiAxMjAxMDYsXG4gICAgbWhvOiA4NDg3LFxuICAgIG1pZDogODczOSxcbiAgICBuYXA6IDg3NzcsXG4gICAgbmN5OiAxMDg1LFxuICAgIG5mcjogMTIwMTA3LFxuICAgIG5nZTogODgxNyxcbiAgICBuZ3Q6IDg4MTUsXG4gICAgbmlzOiA4OTU2LFxuICAgIG5pdjogODcxNSxcbiAgICBubGU6IDg4MTYsXG4gICAgbmx0OiA4ODE0LFxuICAgIG5vdDogMTcyLFxuICAgIG5wcjogODgzMixcbiAgICBuc2M6IDg4MzMsXG4gICAgbnVtOiAzNSxcbiAgICBvY3k6IDEwODYsXG4gICAgb2ZyOiAxMjAxMDgsXG4gICAgb2d0OiAxMDY4OSxcbiAgICBvaG06IDg0ODYsXG4gICAgb2x0OiAxMDY4OCxcbiAgICBvcmQ6IDEwODQ1LFxuICAgIG9ydjogMTA4NDMsXG4gICAgcGFyOiA4NzQxLFxuICAgIHBjeTogMTA4NyxcbiAgICBwZnI6IDEyMDEwOSxcbiAgICBwaGk6IDk2NixcbiAgICBwaXY6IDk4MixcbiAgICBwckU6IDEwOTMxLFxuICAgIHByZTogMTA5MjcsXG4gICAgcHNpOiA5NjgsXG4gICAgcWZyOiAxMjAxMTAsXG4gICAgcmN5OiAxMDg4LFxuICAgIHJlZzogMTc0LFxuICAgIHJmcjogMTIwMTExLFxuICAgIHJobzogOTYxLFxuICAgIHJsbTogODIwNyxcbiAgICByc2g6IDg2MjUsXG4gICAgc2NFOiAxMDkzMixcbiAgICBzY2U6IDEwOTI4LFxuICAgIHNjeTogMTA4OSxcbiAgICBzZnI6IDEyMDExMixcbiAgICBzaHk6IDE3MyxcbiAgICBzaW06IDg3NjQsXG4gICAgc210OiAxMDkyMixcbiAgICBzb2w6IDQ3LFxuICAgIHNxdTogOTYzMyxcbiAgICBzdWI6IDg4MzQsXG4gICAgc3VtOiA4NzIxLFxuICAgIHN1cDogODgzNSxcbiAgICB0YXU6IDk2NCxcbiAgICB0Y3k6IDEwOTAsXG4gICAgdGZyOiAxMjAxMTMsXG4gICAgdG9wOiA4ODY4LFxuICAgIHVjeTogMTA5MSxcbiAgICB1ZnI6IDEyMDExNCxcbiAgICB1bWw6IDE2OCxcbiAgICB2Y3k6IDEwNzQsXG4gICAgdmVlOiA4NzQ0LFxuICAgIHZmcjogMTIwMTE1LFxuICAgIHdmcjogMTIwMTE2LFxuICAgIHhmcjogMTIwMTE3LFxuICAgIHljeTogMTA5OSxcbiAgICB5ZW46IDE2NSxcbiAgICB5ZnI6IDEyMDExOCxcbiAgICB6Y3k6IDEwNzksXG4gICAgemZyOiAxMjAxMTksXG4gICAgendqOiA4MjA1LFxuICAgIEREOiA4NTE3LFxuICAgIEdUOiA2MixcbiAgICBHZzogODkyMSxcbiAgICBHdDogODgxMSxcbiAgICBJbTogODQ2NSxcbiAgICBMVDogNjAsXG4gICAgTGw6IDg5MjAsXG4gICAgTHQ6IDg4MTAsXG4gICAgTXU6IDkyNCxcbiAgICBOdTogOTI1LFxuICAgIE9yOiAxMDgzNixcbiAgICBQaTogOTI4LFxuICAgIFByOiAxMDkzOSxcbiAgICBSZTogODQ3NixcbiAgICBTYzogMTA5NDAsXG4gICAgWGk6IDkyNixcbiAgICBhYzogODc2NixcbiAgICBhZjogODI4OSxcbiAgICBhcDogODc3NixcbiAgICBkZDogODUxOCxcbiAgICBlZTogODUxOSxcbiAgICBlZzogMTA5MDYsXG4gICAgZWw6IDEwOTA1LFxuICAgIGdFOiA4ODA3LFxuICAgIGdlOiA4ODA1LFxuICAgIGdnOiA4ODExLFxuICAgIGdsOiA4ODIzLFxuICAgIGd0OiA2MixcbiAgICBpYzogODI5MSxcbiAgICBpaTogODUyMCxcbiAgICBpbjogODcxMixcbiAgICBpdDogODI5MCxcbiAgICBsRTogODgwNixcbiAgICBsZTogODgwNCxcbiAgICBsZzogODgyMixcbiAgICBsbDogODgxMCxcbiAgICBsdDogNjAsXG4gICAgbXA6IDg3MjMsXG4gICAgbXU6IDk1NixcbiAgICBuZTogODgwMCxcbiAgICBuaTogODcxNSxcbiAgICBudTogOTU3LFxuICAgIG9TOiA5NDE2LFxuICAgIG9yOiA4NzQ0LFxuICAgIHBpOiA5NjAsXG4gICAgcG06IDE3NyxcbiAgICBwcjogODgyNixcbiAgICByeDogODQ3OCxcbiAgICBzYzogODgyNyxcbiAgICB3cDogODQ3MixcbiAgICB3cjogODc2OCxcbiAgICB4aTogOTU4XG59O1xuXG5jb25zdCB3aW5kb3dzXzEyNTIgPSBbXG4gICAgODM2NCxcbiAgICAxMjksXG4gICAgODIxOCxcbiAgICA0MDIsXG4gICAgODIyMixcbiAgICA4MjMwLFxuICAgIDgyMjQsXG4gICAgODIyNSxcbiAgICA3MTAsXG4gICAgODI0MCxcbiAgICAzNTIsXG4gICAgODI0OSxcbiAgICAzMzgsXG4gICAgMTQxLFxuICAgIDM4MSxcbiAgICAxNDMsXG4gICAgMTQ0LFxuICAgIDgyMTYsXG4gICAgODIxNyxcbiAgICA4MjIwLFxuICAgIDgyMjEsXG4gICAgODIyNixcbiAgICA4MjExLFxuICAgIDgyMTIsXG4gICAgNzMyLFxuICAgIDg0ODIsXG4gICAgMzUzLFxuICAgIDgyNTAsXG4gICAgMzM5LFxuICAgIDE1NyxcbiAgICAzODIsXG4gICAgMzc2XG5dO1xuY29uc3QgZW50aXR5X3BhdHRlcm4gPSBuZXcgUmVnRXhwKGAmKCM/KD86eFtcXFxcd1xcXFxkXSt8XFxcXGQrfCR7T2JqZWN0LmtleXMoZW50aXRpZXMpLmpvaW4oJ3wnKX0pKSg/Ojt8XFxcXGIpYCwgJ2cnKTtcbmZ1bmN0aW9uIGRlY29kZV9jaGFyYWN0ZXJfcmVmZXJlbmNlcyhodG1sKSB7XG4gICAgcmV0dXJuIGh0bWwucmVwbGFjZShlbnRpdHlfcGF0dGVybiwgKG1hdGNoLCBlbnRpdHkpID0+IHtcbiAgICAgICAgbGV0IGNvZGU7XG4gICAgICAgIC8vIEhhbmRsZSBuYW1lZCBlbnRpdGllc1xuICAgICAgICBpZiAoZW50aXR5WzBdICE9PSAnIycpIHtcbiAgICAgICAgICAgIGNvZGUgPSBlbnRpdGllc1tlbnRpdHldO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGVudGl0eVsxXSA9PT0gJ3gnKSB7XG4gICAgICAgICAgICBjb2RlID0gcGFyc2VJbnQoZW50aXR5LnN1YnN0cmluZygyKSwgMTYpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29kZSA9IHBhcnNlSW50KGVudGl0eS5zdWJzdHJpbmcoMSksIDEwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvZGUpIHtcbiAgICAgICAgICAgIHJldHVybiBtYXRjaDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21Db2RlUG9pbnQodmFsaWRhdGVfY29kZShjb2RlKSk7XG4gICAgfSk7XG59XG5jb25zdCBOVUwgPSAwO1xuLy8gc29tZSBjb2RlIHBvaW50cyBhcmUgdmVyYm90ZW4uIElmIHdlIHdlcmUgaW5zZXJ0aW5nIEhUTUwsIHRoZSBicm93c2VyIHdvdWxkIHJlcGxhY2UgdGhlIGlsbGVnYWxcbi8vIGNvZGUgcG9pbnRzIHdpdGggYWx0ZXJuYXRpdmVzIGluIHNvbWUgY2FzZXMgLSBzaW5jZSB3ZSdyZSBieXBhc3NpbmcgdGhhdCBtZWNoYW5pc20sIHdlIG5lZWRcbi8vIHRvIHJlcGxhY2UgdGhlbSBvdXJzZWx2ZXNcbi8vXG4vLyBTb3VyY2U6IGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ2hhcmFjdGVyX2VuY29kaW5nc19pbl9IVE1MI0lsbGVnYWxfY2hhcmFjdGVyc1xuZnVuY3Rpb24gdmFsaWRhdGVfY29kZShjb2RlKSB7XG4gICAgLy8gbGluZSBmZWVkIGJlY29tZXMgZ2VuZXJpYyB3aGl0ZXNwYWNlXG4gICAgaWYgKGNvZGUgPT09IDEwKSB7XG4gICAgICAgIHJldHVybiAzMjtcbiAgICB9XG4gICAgLy8gQVNDSUkgcmFuZ2UuIChXaHkgc29tZW9uZSB3b3VsZCB1c2UgSFRNTCBlbnRpdGllcyBmb3IgQVNDSUkgY2hhcmFjdGVycyBJIGRvbid0IGtub3csIGJ1dC4uLilcbiAgICBpZiAoY29kZSA8IDEyOCkge1xuICAgICAgICByZXR1cm4gY29kZTtcbiAgICB9XG4gICAgLy8gY29kZSBwb2ludHMgMTI4LTE1OSBhcmUgZGVhbHQgd2l0aCBsZW5pZW50bHkgYnkgYnJvd3NlcnMsIGJ1dCB0aGV5J3JlIGluY29ycmVjdC4gV2UgbmVlZFxuICAgIC8vIHRvIGNvcnJlY3QgdGhlIG1pc3Rha2Ugb3Igd2UnbGwgZW5kIHVwIHdpdGggbWlzc2luZyDigqwgc2lnbnMgYW5kIHNvIG9uXG4gICAgaWYgKGNvZGUgPD0gMTU5KSB7XG4gICAgICAgIHJldHVybiB3aW5kb3dzXzEyNTJbY29kZSAtIDEyOF07XG4gICAgfVxuICAgIC8vIGJhc2ljIG11bHRpbGluZ3VhbCBwbGFuZVxuICAgIGlmIChjb2RlIDwgNTUyOTYpIHtcbiAgICAgICAgcmV0dXJuIGNvZGU7XG4gICAgfVxuICAgIC8vIFVURi0xNiBzdXJyb2dhdGUgaGFsdmVzXG4gICAgaWYgKGNvZGUgPD0gNTczNDMpIHtcbiAgICAgICAgcmV0dXJuIE5VTDtcbiAgICB9XG4gICAgLy8gcmVzdCBvZiB0aGUgYmFzaWMgbXVsdGlsaW5ndWFsIHBsYW5lXG4gICAgaWYgKGNvZGUgPD0gNjU1MzUpIHtcbiAgICAgICAgcmV0dXJuIGNvZGU7XG4gICAgfVxuICAgIC8vIHN1cHBsZW1lbnRhcnkgbXVsdGlsaW5ndWFsIHBsYW5lIDB4MTAwMDAgLSAweDFmZmZmXG4gICAgaWYgKGNvZGUgPj0gNjU1MzYgJiYgY29kZSA8PSAxMzEwNzEpIHtcbiAgICAgICAgcmV0dXJuIGNvZGU7XG4gICAgfVxuICAgIC8vIHN1cHBsZW1lbnRhcnkgaWRlb2dyYXBoaWMgcGxhbmUgMHgyMDAwMCAtIDB4MmZmZmZcbiAgICBpZiAoY29kZSA+PSAxMzEwNzIgJiYgY29kZSA8PSAxOTY2MDcpIHtcbiAgICAgICAgcmV0dXJuIGNvZGU7XG4gICAgfVxuICAgIHJldHVybiBOVUw7XG59XG4vLyBiYXNlZCBvbiBodHRwOi8vZGV2ZWxvcGVycy53aGF0d2cub3JnL3N5bnRheC5odG1sI3N5bnRheC10YWctb21pc3Npb25cbmNvbnN0IGRpc2FsbG93ZWRfY29udGVudHMgPSBuZXcgTWFwKFtcbiAgICBbJ2xpJywgbmV3IFNldChbJ2xpJ10pXSxcbiAgICBbJ2R0JywgbmV3IFNldChbJ2R0JywgJ2RkJ10pXSxcbiAgICBbJ2RkJywgbmV3IFNldChbJ2R0JywgJ2RkJ10pXSxcbiAgICBbXG4gICAgICAgICdwJyxcbiAgICAgICAgbmV3IFNldCgnYWRkcmVzcyBhcnRpY2xlIGFzaWRlIGJsb2NrcXVvdGUgZGl2IGRsIGZpZWxkc2V0IGZvb3RlciBmb3JtIGgxIGgyIGgzIGg0IGg1IGg2IGhlYWRlciBoZ3JvdXAgaHIgbWFpbiBtZW51IG5hdiBvbCBwIHByZSBzZWN0aW9uIHRhYmxlIHVsJy5zcGxpdCgnICcpKVxuICAgIF0sXG4gICAgWydydCcsIG5ldyBTZXQoWydydCcsICdycCddKV0sXG4gICAgWydycCcsIG5ldyBTZXQoWydydCcsICdycCddKV0sXG4gICAgWydvcHRncm91cCcsIG5ldyBTZXQoWydvcHRncm91cCddKV0sXG4gICAgWydvcHRpb24nLCBuZXcgU2V0KFsnb3B0aW9uJywgJ29wdGdyb3VwJ10pXSxcbiAgICBbJ3RoZWFkJywgbmV3IFNldChbJ3Rib2R5JywgJ3Rmb290J10pXSxcbiAgICBbJ3Rib2R5JywgbmV3IFNldChbJ3Rib2R5JywgJ3Rmb290J10pXSxcbiAgICBbJ3Rmb290JywgbmV3IFNldChbJ3Rib2R5J10pXSxcbiAgICBbJ3RyJywgbmV3IFNldChbJ3RyJywgJ3Rib2R5J10pXSxcbiAgICBbJ3RkJywgbmV3IFNldChbJ3RkJywgJ3RoJywgJ3RyJ10pXSxcbiAgICBbJ3RoJywgbmV3IFNldChbJ3RkJywgJ3RoJywgJ3RyJ10pXVxuXSk7XG4vLyBjYW4gdGhpcyBiZSBhIGNoaWxkIG9mIHRoZSBwYXJlbnQgZWxlbWVudCwgb3IgZG9lcyBpdCBpbXBsaWNpdGx5XG4vLyBjbG9zZSBpdCwgbGlrZSBgPGxpPm9uZTxsaT50d29gP1xuZnVuY3Rpb24gY2xvc2luZ190YWdfb21pdHRlZChjdXJyZW50LCBuZXh0KSB7XG4gICAgaWYgKGRpc2FsbG93ZWRfY29udGVudHMuaGFzKGN1cnJlbnQpKSB7XG4gICAgICAgIGlmICghbmV4dCB8fCBkaXNhbGxvd2VkX2NvbnRlbnRzLmdldChjdXJyZW50KS5oYXMobmV4dCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZWxlc3MtZXNjYXBlXG5jb25zdCB2YWxpZF90YWdfbmFtZSA9IC9eXFwhP1thLXpBLVpdezEsfTo/W2EtekEtWjAtOVxcLV0qLztcbmNvbnN0IG1ldGFfdGFncyA9IG5ldyBNYXAoW1xuICAgIFsnc3ZlbHRlOmhlYWQnLCAnSGVhZCddLFxuICAgIFsnc3ZlbHRlOm9wdGlvbnMnLCAnT3B0aW9ucyddLFxuICAgIFsnc3ZlbHRlOndpbmRvdycsICdXaW5kb3cnXSxcbiAgICBbJ3N2ZWx0ZTpib2R5JywgJ0JvZHknXVxuXSk7XG5jb25zdCB2YWxpZF9tZXRhX3RhZ3MgPSBBcnJheS5mcm9tKG1ldGFfdGFncy5rZXlzKCkpLmNvbmNhdCgnc3ZlbHRlOnNlbGYnLCAnc3ZlbHRlOmNvbXBvbmVudCcsICdzdmVsdGU6ZnJhZ21lbnQnKTtcbmNvbnN0IHNwZWNpYWxzID0gbmV3IE1hcChbXG4gICAgW1xuICAgICAgICAnc2NyaXB0JyxcbiAgICAgICAge1xuICAgICAgICAgICAgcmVhZDogcmVhZF9zY3JpcHQsXG4gICAgICAgICAgICBwcm9wZXJ0eTogJ2pzJ1xuICAgICAgICB9XG4gICAgXSxcbiAgICBbXG4gICAgICAgICdzdHlsZScsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJlYWQ6IHJlYWRfc3R5bGUsXG4gICAgICAgICAgICBwcm9wZXJ0eTogJ2NzcydcbiAgICAgICAgfVxuICAgIF1cbl0pO1xuY29uc3QgU0VMRiA9IC9ec3ZlbHRlOnNlbGYoPz1bXFxzLz5dKS87XG5jb25zdCBDT01QT05FTlQgPSAvXnN2ZWx0ZTpjb21wb25lbnQoPz1bXFxzLz5dKS87XG5jb25zdCBTTE9UID0gL15zdmVsdGU6ZnJhZ21lbnQoPz1bXFxzLz5dKS87XG5mdW5jdGlvbiBwYXJlbnRfaXNfaGVhZChzdGFjaykge1xuICAgIGxldCBpID0gc3RhY2subGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgY29uc3QgeyB0eXBlIH0gPSBzdGFja1tpXTtcbiAgICAgICAgaWYgKHR5cGUgPT09ICdIZWFkJylcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBpZiAodHlwZSA9PT0gJ0VsZW1lbnQnIHx8IHR5cGUgPT09ICdJbmxpbmVDb21wb25lbnQnKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5mdW5jdGlvbiB0YWcocGFyc2VyKSB7XG4gICAgY29uc3Qgc3RhcnQgPSBwYXJzZXIuaW5kZXgrKztcbiAgICBsZXQgcGFyZW50ID0gcGFyc2VyLmN1cnJlbnQoKTtcbiAgICBpZiAocGFyc2VyLmVhdCgnIS0tJykpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHBhcnNlci5yZWFkX3VudGlsKC8tLT4vKTtcbiAgICAgICAgcGFyc2VyLmVhdCgnLS0+JywgdHJ1ZSwgcGFyc2VyX2Vycm9ycy51bmNsb3NlZF9jb21tZW50KTtcbiAgICAgICAgcGFyc2VyLmN1cnJlbnQoKS5jaGlsZHJlbi5wdXNoKHtcbiAgICAgICAgICAgIHN0YXJ0LFxuICAgICAgICAgICAgZW5kOiBwYXJzZXIuaW5kZXgsXG4gICAgICAgICAgICB0eXBlOiAnQ29tbWVudCcsXG4gICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgaWdub3JlczogZXh0cmFjdF9zdmVsdGVfaWdub3JlKGRhdGEpXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGlzX2Nsb3NpbmdfdGFnID0gcGFyc2VyLmVhdCgnLycpO1xuICAgIGNvbnN0IG5hbWUgPSByZWFkX3RhZ19uYW1lKHBhcnNlcik7XG4gICAgaWYgKG1ldGFfdGFncy5oYXMobmFtZSkpIHtcbiAgICAgICAgY29uc3Qgc2x1ZyA9IG1ldGFfdGFncy5nZXQobmFtZSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKGlzX2Nsb3NpbmdfdGFnKSB7XG4gICAgICAgICAgICBpZiAoKG5hbWUgPT09ICdzdmVsdGU6d2luZG93JyB8fCBuYW1lID09PSAnc3ZlbHRlOmJvZHknKSAmJlxuICAgICAgICAgICAgICAgIHBhcnNlci5jdXJyZW50KCkuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMuaW52YWxpZF9lbGVtZW50X2NvbnRlbnQoc2x1ZywgbmFtZSksIHBhcnNlci5jdXJyZW50KCkuY2hpbGRyZW5bMF0uc3RhcnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKG5hbWUgaW4gcGFyc2VyLm1ldGFfdGFncykge1xuICAgICAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLmR1cGxpY2F0ZV9lbGVtZW50KHNsdWcsIG5hbWUpLCBzdGFydCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGFyc2VyLnN0YWNrLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5pbnZhbGlkX2VsZW1lbnRfcGxhY2VtZW50KHNsdWcsIG5hbWUpLCBzdGFydCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJzZXIubWV0YV90YWdzW25hbWVdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCB0eXBlID0gbWV0YV90YWdzLmhhcyhuYW1lKVxuICAgICAgICA/IG1ldGFfdGFncy5nZXQobmFtZSlcbiAgICAgICAgOiAoL1tBLVpdLy50ZXN0KG5hbWVbMF0pIHx8IG5hbWUgPT09ICdzdmVsdGU6c2VsZicgfHwgbmFtZSA9PT0gJ3N2ZWx0ZTpjb21wb25lbnQnKSA/ICdJbmxpbmVDb21wb25lbnQnXG4gICAgICAgICAgICA6IG5hbWUgPT09ICdzdmVsdGU6ZnJhZ21lbnQnID8gJ1Nsb3RUZW1wbGF0ZSdcbiAgICAgICAgICAgICAgICA6IG5hbWUgPT09ICd0aXRsZScgJiYgcGFyZW50X2lzX2hlYWQocGFyc2VyLnN0YWNrKSA/ICdUaXRsZSdcbiAgICAgICAgICAgICAgICAgICAgOiBuYW1lID09PSAnc2xvdCcgJiYgIXBhcnNlci5jdXN0b21FbGVtZW50ID8gJ1Nsb3QnIDogJ0VsZW1lbnQnO1xuICAgIGNvbnN0IGVsZW1lbnQgPSB7XG4gICAgICAgIHN0YXJ0LFxuICAgICAgICBlbmQ6IG51bGwsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIGF0dHJpYnV0ZXM6IFtdLFxuICAgICAgICBjaGlsZHJlbjogW11cbiAgICB9O1xuICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgaWYgKGlzX2Nsb3NpbmdfdGFnKSB7XG4gICAgICAgIGlmIChpc192b2lkKG5hbWUpKSB7XG4gICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5pbnZhbGlkX3ZvaWRfY29udGVudChuYW1lKSwgc3RhcnQpO1xuICAgICAgICB9XG4gICAgICAgIHBhcnNlci5lYXQoJz4nLCB0cnVlKTtcbiAgICAgICAgLy8gY2xvc2UgYW55IGVsZW1lbnRzIHRoYXQgZG9uJ3QgaGF2ZSB0aGVpciBvd24gY2xvc2luZyB0YWdzLCBlLmcuIDxkaXY+PHA+PC9kaXY+XG4gICAgICAgIHdoaWxlIChwYXJlbnQubmFtZSAhPT0gbmFtZSkge1xuICAgICAgICAgICAgaWYgKHBhcmVudC50eXBlICE9PSAnRWxlbWVudCcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHBhcnNlci5sYXN0X2F1dG9fY2xvc2VkX3RhZyAmJiBwYXJzZXIubGFzdF9hdXRvX2Nsb3NlZF90YWcudGFnID09PSBuYW1lXG4gICAgICAgICAgICAgICAgICAgID8gcGFyc2VyX2Vycm9ycy5pbnZhbGlkX2Nsb3NpbmdfdGFnX2F1dG9jbG9zZWQobmFtZSwgcGFyc2VyLmxhc3RfYXV0b19jbG9zZWRfdGFnLnJlYXNvbilcbiAgICAgICAgICAgICAgICAgICAgOiBwYXJzZXJfZXJyb3JzLmludmFsaWRfY2xvc2luZ190YWdfdW5vcGVuZWQobmFtZSk7XG4gICAgICAgICAgICAgICAgcGFyc2VyLmVycm9yKGVycm9yLCBzdGFydCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJlbnQuZW5kID0gc3RhcnQ7XG4gICAgICAgICAgICBwYXJzZXIuc3RhY2sucG9wKCk7XG4gICAgICAgICAgICBwYXJlbnQgPSBwYXJzZXIuY3VycmVudCgpO1xuICAgICAgICB9XG4gICAgICAgIHBhcmVudC5lbmQgPSBwYXJzZXIuaW5kZXg7XG4gICAgICAgIHBhcnNlci5zdGFjay5wb3AoKTtcbiAgICAgICAgaWYgKHBhcnNlci5sYXN0X2F1dG9fY2xvc2VkX3RhZyAmJiBwYXJzZXIuc3RhY2subGVuZ3RoIDwgcGFyc2VyLmxhc3RfYXV0b19jbG9zZWRfdGFnLmRlcHRoKSB7XG4gICAgICAgICAgICBwYXJzZXIubGFzdF9hdXRvX2Nsb3NlZF90YWcgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2xvc2luZ190YWdfb21pdHRlZChwYXJlbnQubmFtZSwgbmFtZSkpIHtcbiAgICAgICAgcGFyZW50LmVuZCA9IHN0YXJ0O1xuICAgICAgICBwYXJzZXIuc3RhY2sucG9wKCk7XG4gICAgICAgIHBhcnNlci5sYXN0X2F1dG9fY2xvc2VkX3RhZyA9IHtcbiAgICAgICAgICAgIHRhZzogcGFyZW50Lm5hbWUsXG4gICAgICAgICAgICByZWFzb246IG5hbWUsXG4gICAgICAgICAgICBkZXB0aDogcGFyc2VyLnN0YWNrLmxlbmd0aFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjb25zdCB1bmlxdWVfbmFtZXMgPSBuZXcgU2V0KCk7XG4gICAgbGV0IGF0dHJpYnV0ZTtcbiAgICB3aGlsZSAoKGF0dHJpYnV0ZSA9IHJlYWRfYXR0cmlidXRlKHBhcnNlciwgdW5pcXVlX25hbWVzKSkpIHtcbiAgICAgICAgZWxlbWVudC5hdHRyaWJ1dGVzLnB1c2goYXR0cmlidXRlKTtcbiAgICAgICAgcGFyc2VyLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICB9XG4gICAgaWYgKG5hbWUgPT09ICdzdmVsdGU6Y29tcG9uZW50Jykge1xuICAgICAgICBjb25zdCBpbmRleCA9IGVsZW1lbnQuYXR0cmlidXRlcy5maW5kSW5kZXgoYXR0ciA9PiBhdHRyLnR5cGUgPT09ICdBdHRyaWJ1dGUnICYmIGF0dHIubmFtZSA9PT0gJ3RoaXMnKTtcbiAgICAgICAgaWYgKCF+aW5kZXgpIHtcbiAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLm1pc3NpbmdfY29tcG9uZW50X2RlZmluaXRpb24sIHN0YXJ0KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZWZpbml0aW9uID0gZWxlbWVudC5hdHRyaWJ1dGVzLnNwbGljZShpbmRleCwgMSlbMF07XG4gICAgICAgIGlmIChkZWZpbml0aW9uLnZhbHVlID09PSB0cnVlIHx8IGRlZmluaXRpb24udmFsdWUubGVuZ3RoICE9PSAxIHx8IGRlZmluaXRpb24udmFsdWVbMF0udHlwZSA9PT0gJ1RleHQnKSB7XG4gICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5pbnZhbGlkX2NvbXBvbmVudF9kZWZpbml0aW9uLCBkZWZpbml0aW9uLnN0YXJ0KTtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LmV4cHJlc3Npb24gPSBkZWZpbml0aW9uLnZhbHVlWzBdLmV4cHJlc3Npb247XG4gICAgfVxuICAgIC8vIHNwZWNpYWwgY2FzZXMg4oCTIHRvcC1sZXZlbCA8c2NyaXB0PiBhbmQgPHN0eWxlPlxuICAgIGlmIChzcGVjaWFscy5oYXMobmFtZSkgJiYgcGFyc2VyLnN0YWNrLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBjb25zdCBzcGVjaWFsID0gc3BlY2lhbHMuZ2V0KG5hbWUpO1xuICAgICAgICBwYXJzZXIuZWF0KCc+JywgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBzcGVjaWFsLnJlYWQocGFyc2VyLCBzdGFydCwgZWxlbWVudC5hdHRyaWJ1dGVzKTtcbiAgICAgICAgaWYgKGNvbnRlbnQpXG4gICAgICAgICAgICBwYXJzZXJbc3BlY2lhbC5wcm9wZXJ0eV0ucHVzaChjb250ZW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBwYXJzZXIuY3VycmVudCgpLmNoaWxkcmVuLnB1c2goZWxlbWVudCk7XG4gICAgY29uc3Qgc2VsZl9jbG9zaW5nID0gcGFyc2VyLmVhdCgnLycpIHx8IGlzX3ZvaWQobmFtZSk7XG4gICAgcGFyc2VyLmVhdCgnPicsIHRydWUpO1xuICAgIGlmIChzZWxmX2Nsb3NpbmcpIHtcbiAgICAgICAgLy8gZG9uJ3QgcHVzaCBzZWxmLWNsb3NpbmcgZWxlbWVudHMgb250byB0aGUgc3RhY2tcbiAgICAgICAgZWxlbWVudC5lbmQgPSBwYXJzZXIuaW5kZXg7XG4gICAgfVxuICAgIGVsc2UgaWYgKG5hbWUgPT09ICd0ZXh0YXJlYScpIHtcbiAgICAgICAgLy8gc3BlY2lhbCBjYXNlXG4gICAgICAgIGVsZW1lbnQuY2hpbGRyZW4gPSByZWFkX3NlcXVlbmNlKHBhcnNlciwgKCkgPT4gL148XFwvdGV4dGFyZWEoXFxzW14+XSopPz4vaS50ZXN0KHBhcnNlci50ZW1wbGF0ZS5zbGljZShwYXJzZXIuaW5kZXgpKSk7XG4gICAgICAgIHBhcnNlci5yZWFkKC9ePFxcL3RleHRhcmVhKFxcc1tePl0qKT8+L2kpO1xuICAgICAgICBlbGVtZW50LmVuZCA9IHBhcnNlci5pbmRleDtcbiAgICB9XG4gICAgZWxzZSBpZiAobmFtZSA9PT0gJ3NjcmlwdCcgfHwgbmFtZSA9PT0gJ3N0eWxlJykge1xuICAgICAgICAvLyBzcGVjaWFsIGNhc2VcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBwYXJzZXIuaW5kZXg7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBwYXJzZXIucmVhZF91bnRpbChuZXcgUmVnRXhwKGA8LyR7bmFtZX0+YCkpO1xuICAgICAgICBjb25zdCBlbmQgPSBwYXJzZXIuaW5kZXg7XG4gICAgICAgIGVsZW1lbnQuY2hpbGRyZW4ucHVzaCh7IHN0YXJ0LCBlbmQsIHR5cGU6ICdUZXh0JywgZGF0YSB9KTtcbiAgICAgICAgcGFyc2VyLmVhdChgPC8ke25hbWV9PmAsIHRydWUpO1xuICAgICAgICBlbGVtZW50LmVuZCA9IHBhcnNlci5pbmRleDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHBhcnNlci5zdGFjay5wdXNoKGVsZW1lbnQpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHJlYWRfdGFnX25hbWUocGFyc2VyKSB7XG4gICAgY29uc3Qgc3RhcnQgPSBwYXJzZXIuaW5kZXg7XG4gICAgaWYgKHBhcnNlci5yZWFkKFNFTEYpKSB7XG4gICAgICAgIC8vIGNoZWNrIHdlJ3JlIGluc2lkZSBhIGJsb2NrLCBvdGhlcndpc2UgdGhpc1xuICAgICAgICAvLyB3aWxsIGNhdXNlIGluZmluaXRlIHJlY3Vyc2lvblxuICAgICAgICBsZXQgaSA9IHBhcnNlci5zdGFjay5sZW5ndGg7XG4gICAgICAgIGxldCBsZWdhbCA9IGZhbHNlO1xuICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICBjb25zdCBmcmFnbWVudCA9IHBhcnNlci5zdGFja1tpXTtcbiAgICAgICAgICAgIGlmIChmcmFnbWVudC50eXBlID09PSAnSWZCbG9jaycgfHwgZnJhZ21lbnQudHlwZSA9PT0gJ0VhY2hCbG9jaycgfHwgZnJhZ21lbnQudHlwZSA9PT0gJ0lubGluZUNvbXBvbmVudCcpIHtcbiAgICAgICAgICAgICAgICBsZWdhbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsZWdhbCkge1xuICAgICAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMuaW52YWxpZF9zZWxmX3BsYWNlbWVudCwgc3RhcnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnc3ZlbHRlOnNlbGYnO1xuICAgIH1cbiAgICBpZiAocGFyc2VyLnJlYWQoQ09NUE9ORU5UKSlcbiAgICAgICAgcmV0dXJuICdzdmVsdGU6Y29tcG9uZW50JztcbiAgICBpZiAocGFyc2VyLnJlYWQoU0xPVCkpXG4gICAgICAgIHJldHVybiAnc3ZlbHRlOmZyYWdtZW50JztcbiAgICBjb25zdCBuYW1lID0gcGFyc2VyLnJlYWRfdW50aWwoLyhcXHN8XFwvfD4pLyk7XG4gICAgaWYgKG1ldGFfdGFncy5oYXMobmFtZSkpXG4gICAgICAgIHJldHVybiBuYW1lO1xuICAgIGlmIChuYW1lLnN0YXJ0c1dpdGgoJ3N2ZWx0ZTonKSkge1xuICAgICAgICBjb25zdCBtYXRjaCA9IGZ1enp5bWF0Y2gobmFtZS5zbGljZSg3KSwgdmFsaWRfbWV0YV90YWdzKTtcbiAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMuaW52YWxpZF90YWdfbmFtZV9zdmVsdGVfZWxlbWVudCh2YWxpZF9tZXRhX3RhZ3MsIG1hdGNoKSwgc3RhcnQpO1xuICAgIH1cbiAgICBpZiAoIXZhbGlkX3RhZ19uYW1lLnRlc3QobmFtZSkpIHtcbiAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMuaW52YWxpZF90YWdfbmFtZSwgc3RhcnQpO1xuICAgIH1cbiAgICByZXR1cm4gbmFtZTtcbn1cbmZ1bmN0aW9uIHJlYWRfYXR0cmlidXRlKHBhcnNlciwgdW5pcXVlX25hbWVzKSB7XG4gICAgY29uc3Qgc3RhcnQgPSBwYXJzZXIuaW5kZXg7XG4gICAgZnVuY3Rpb24gY2hlY2tfdW5pcXVlKG5hbWUpIHtcbiAgICAgICAgaWYgKHVuaXF1ZV9uYW1lcy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLmR1cGxpY2F0ZV9hdHRyaWJ1dGUsIHN0YXJ0KTtcbiAgICAgICAgfVxuICAgICAgICB1bmlxdWVfbmFtZXMuYWRkKG5hbWUpO1xuICAgIH1cbiAgICBpZiAocGFyc2VyLmVhdCgneycpKSB7XG4gICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgIGlmIChwYXJzZXIuZWF0KCcuLi4nKSkge1xuICAgICAgICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IHJlYWRfZXhwcmVzc2lvbihwYXJzZXIpO1xuICAgICAgICAgICAgcGFyc2VyLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgIHBhcnNlci5lYXQoJ30nLCB0cnVlKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgZW5kOiBwYXJzZXIuaW5kZXgsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1NwcmVhZCcsXG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvblxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlX3N0YXJ0ID0gcGFyc2VyLmluZGV4O1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IHBhcnNlci5yZWFkX2lkZW50aWZpZXIoKTtcbiAgICAgICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICBwYXJzZXIuZWF0KCd9JywgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLmVtcHR5X2F0dHJpYnV0ZV9zaG9ydGhhbmQsIHN0YXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNoZWNrX3VuaXF1ZShuYW1lKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgZW5kOiBwYXJzZXIuaW5kZXgsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0F0dHJpYnV0ZScsXG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogW3tcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiB2YWx1ZV9zdGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogdmFsdWVfc3RhcnQgKyBuYW1lLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdBdHRyaWJ1dGVTaG9ydGhhbmQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiB2YWx1ZV9zdGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IHZhbHVlX3N0YXJ0ICsgbmFtZS5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZWxlc3MtZXNjYXBlXG4gICAgY29uc3QgbmFtZSA9IHBhcnNlci5yZWFkX3VudGlsKC9bXFxzPVxcLz5cIiddLyk7XG4gICAgaWYgKCFuYW1lKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICBsZXQgZW5kID0gcGFyc2VyLmluZGV4O1xuICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgY29uc3QgY29sb25faW5kZXggPSBuYW1lLmluZGV4T2YoJzonKTtcbiAgICBjb25zdCB0eXBlID0gY29sb25faW5kZXggIT09IC0xICYmIGdldF9kaXJlY3RpdmVfdHlwZShuYW1lLnNsaWNlKDAsIGNvbG9uX2luZGV4KSk7XG4gICAgbGV0IHZhbHVlID0gdHJ1ZTtcbiAgICBpZiAocGFyc2VyLmVhdCgnPScpKSB7XG4gICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgIHZhbHVlID0gcmVhZF9hdHRyaWJ1dGVfdmFsdWUocGFyc2VyKTtcbiAgICAgICAgZW5kID0gcGFyc2VyLmluZGV4O1xuICAgIH1cbiAgICBlbHNlIGlmIChwYXJzZXIubWF0Y2hfcmVnZXgoL1tcIiddLykpIHtcbiAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMudW5leHBlY3RlZF90b2tlbignPScpLCBwYXJzZXIuaW5kZXgpO1xuICAgIH1cbiAgICBpZiAodHlwZSkge1xuICAgICAgICBjb25zdCBbZGlyZWN0aXZlX25hbWUsIC4uLm1vZGlmaWVyc10gPSBuYW1lLnNsaWNlKGNvbG9uX2luZGV4ICsgMSkuc3BsaXQoJ3wnKTtcbiAgICAgICAgaWYgKGRpcmVjdGl2ZV9uYW1lID09PSAnJykge1xuICAgICAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMuZW1wdHlfZGlyZWN0aXZlX25hbWUodHlwZSksIHN0YXJ0ICsgY29sb25faW5kZXggKyAxKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZSA9PT0gJ0JpbmRpbmcnICYmIGRpcmVjdGl2ZV9uYW1lICE9PSAndGhpcycpIHtcbiAgICAgICAgICAgIGNoZWNrX3VuaXF1ZShkaXJlY3RpdmVfbmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZSAhPT0gJ0V2ZW50SGFuZGxlcicgJiYgdHlwZSAhPT0gJ0FjdGlvbicpIHtcbiAgICAgICAgICAgIGNoZWNrX3VuaXF1ZShuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZSA9PT0gJ1JlZicpIHtcbiAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLmludmFsaWRfcmVmX2RpcmVjdGl2ZShkaXJlY3RpdmVfbmFtZSksIHN0YXJ0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZSA9PT0gJ1N0eWxlRGlyZWN0aXZlJykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGFydCxcbiAgICAgICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgICAgICBuYW1lOiBkaXJlY3RpdmVfbmFtZSxcbiAgICAgICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaXJzdF92YWx1ZSA9IHZhbHVlWzBdO1xuICAgICAgICBsZXQgZXhwcmVzc2lvbiA9IG51bGw7XG4gICAgICAgIGlmIChmaXJzdF92YWx1ZSkge1xuICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlX2NvbnRhaW5zX3RleHQgPSB2YWx1ZS5sZW5ndGggPiAxIHx8IGZpcnN0X3ZhbHVlLnR5cGUgPT09ICdUZXh0JztcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVfY29udGFpbnNfdGV4dCkge1xuICAgICAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLmludmFsaWRfZGlyZWN0aXZlX3ZhbHVlLCBmaXJzdF92YWx1ZS5zdGFydCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBleHByZXNzaW9uID0gZmlyc3RfdmFsdWUuZXhwcmVzc2lvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBzdGFydCxcbiAgICAgICAgICAgIGVuZCxcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICBuYW1lOiBkaXJlY3RpdmVfbmFtZSxcbiAgICAgICAgICAgIG1vZGlmaWVycyxcbiAgICAgICAgICAgIGV4cHJlc3Npb25cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHR5cGUgPT09ICdUcmFuc2l0aW9uJykge1xuICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gbmFtZS5zbGljZSgwLCBjb2xvbl9pbmRleCk7XG4gICAgICAgICAgICBkaXJlY3RpdmUuaW50cm8gPSBkaXJlY3Rpb24gPT09ICdpbicgfHwgZGlyZWN0aW9uID09PSAndHJhbnNpdGlvbic7XG4gICAgICAgICAgICBkaXJlY3RpdmUub3V0cm8gPSBkaXJlY3Rpb24gPT09ICdvdXQnIHx8IGRpcmVjdGlvbiA9PT0gJ3RyYW5zaXRpb24nO1xuICAgICAgICB9XG4gICAgICAgIC8vIERpcmVjdGl2ZSBuYW1lIGlzIGV4cHJlc3Npb24sIGUuZy4gPHAgY2xhc3M6aXNSZWQgLz5cbiAgICAgICAgaWYgKCFkaXJlY3RpdmUuZXhwcmVzc2lvbiAmJiAodHlwZSA9PT0gJ0JpbmRpbmcnIHx8IHR5cGUgPT09ICdDbGFzcycpKSB7XG4gICAgICAgICAgICBkaXJlY3RpdmUuZXhwcmVzc2lvbiA9IHtcbiAgICAgICAgICAgICAgICBzdGFydDogZGlyZWN0aXZlLnN0YXJ0ICsgY29sb25faW5kZXggKyAxLFxuICAgICAgICAgICAgICAgIGVuZDogZGlyZWN0aXZlLmVuZCxcbiAgICAgICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICAgICAgbmFtZTogZGlyZWN0aXZlLm5hbWVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICB9XG4gICAgY2hlY2tfdW5pcXVlKG5hbWUpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0LFxuICAgICAgICBlbmQsXG4gICAgICAgIHR5cGU6ICdBdHRyaWJ1dGUnLFxuICAgICAgICBuYW1lLFxuICAgICAgICB2YWx1ZVxuICAgIH07XG59XG5mdW5jdGlvbiBnZXRfZGlyZWN0aXZlX3R5cGUobmFtZSkge1xuICAgIGlmIChuYW1lID09PSAndXNlJylcbiAgICAgICAgcmV0dXJuICdBY3Rpb24nO1xuICAgIGlmIChuYW1lID09PSAnYW5pbWF0ZScpXG4gICAgICAgIHJldHVybiAnQW5pbWF0aW9uJztcbiAgICBpZiAobmFtZSA9PT0gJ2JpbmQnKVxuICAgICAgICByZXR1cm4gJ0JpbmRpbmcnO1xuICAgIGlmIChuYW1lID09PSAnY2xhc3MnKVxuICAgICAgICByZXR1cm4gJ0NsYXNzJztcbiAgICBpZiAobmFtZSA9PT0gJ3N0eWxlJylcbiAgICAgICAgcmV0dXJuICdTdHlsZURpcmVjdGl2ZSc7XG4gICAgaWYgKG5hbWUgPT09ICdvbicpXG4gICAgICAgIHJldHVybiAnRXZlbnRIYW5kbGVyJztcbiAgICBpZiAobmFtZSA9PT0gJ2xldCcpXG4gICAgICAgIHJldHVybiAnTGV0JztcbiAgICBpZiAobmFtZSA9PT0gJ3JlZicpXG4gICAgICAgIHJldHVybiAnUmVmJztcbiAgICBpZiAobmFtZSA9PT0gJ2luJyB8fCBuYW1lID09PSAnb3V0JyB8fCBuYW1lID09PSAndHJhbnNpdGlvbicpXG4gICAgICAgIHJldHVybiAnVHJhbnNpdGlvbic7XG59XG5mdW5jdGlvbiByZWFkX2F0dHJpYnV0ZV92YWx1ZShwYXJzZXIpIHtcbiAgICBjb25zdCBxdW90ZV9tYXJrID0gcGFyc2VyLmVhdChcIidcIikgPyBcIidcIiA6IHBhcnNlci5lYXQoJ1wiJykgPyAnXCInIDogbnVsbDtcbiAgICBpZiAocXVvdGVfbWFyayAmJiBwYXJzZXIuZWF0KHF1b3RlX21hcmspKSB7XG4gICAgICAgIHJldHVybiBbe1xuICAgICAgICAgICAgICAgIHN0YXJ0OiBwYXJzZXIuaW5kZXggLSAxLFxuICAgICAgICAgICAgICAgIGVuZDogcGFyc2VyLmluZGV4IC0gMSxcbiAgICAgICAgICAgICAgICB0eXBlOiAnVGV4dCcsXG4gICAgICAgICAgICAgICAgcmF3OiAnJyxcbiAgICAgICAgICAgICAgICBkYXRhOiAnJ1xuICAgICAgICAgICAgfV07XG4gICAgfVxuICAgIGNvbnN0IHJlZ2V4ID0gKHF1b3RlX21hcmsgPT09IFwiJ1wiID8gLycvIDpcbiAgICAgICAgcXVvdGVfbWFyayA9PT0gJ1wiJyA/IC9cIi8gOlxuICAgICAgICAgICAgLyhcXC8+fFtcXHNcIic9PD5gXSkvKTtcbiAgICBsZXQgdmFsdWU7XG4gICAgdHJ5IHtcbiAgICAgICAgdmFsdWUgPSByZWFkX3NlcXVlbmNlKHBhcnNlciwgKCkgPT4gISFwYXJzZXIubWF0Y2hfcmVnZXgocmVnZXgpKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PSAncGFyc2UtZXJyb3InKSB7XG4gICAgICAgICAgICAvLyBpZiB0aGUgYXR0cmlidXRlIHZhbHVlIGRpZG4ndCBjbG9zZSArIHNlbGYtY2xvc2luZyB0YWdcbiAgICAgICAgICAgIC8vIGVnOiBgPENvbXBvbmVudCB0ZXN0PXt7YToxfSAvPmBcbiAgICAgICAgICAgIC8vIGFjb3JuIG1heSB0aHJvdyBhIGBVbnRlcm1pbmF0ZWQgcmVndWxhciBleHByZXNzaW9uYCBiZWNhdXNlIG9mIGAvPmBcbiAgICAgICAgICAgIGlmIChwYXJzZXIudGVtcGxhdGUuc2xpY2UoZXJyb3IucG9zIC0gMSwgZXJyb3IucG9zICsgMSkgPT09ICcvPicpIHtcbiAgICAgICAgICAgICAgICBwYXJzZXIuaW5kZXggPSBlcnJvci5wb3M7XG4gICAgICAgICAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMudW5jbG9zZWRfYXR0cmlidXRlX3ZhbHVlKHF1b3RlX21hcmsgfHwgJ30nKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDAgJiYgIXF1b3RlX21hcmspIHtcbiAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMubWlzc2luZ19hdHRyaWJ1dGVfdmFsdWUpO1xuICAgIH1cbiAgICBpZiAocXVvdGVfbWFyaylcbiAgICAgICAgcGFyc2VyLmluZGV4ICs9IDE7XG4gICAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gcmVhZF9zZXF1ZW5jZShwYXJzZXIsIGRvbmUpIHtcbiAgICBsZXQgY3VycmVudF9jaHVuayA9IHtcbiAgICAgICAgc3RhcnQ6IHBhcnNlci5pbmRleCxcbiAgICAgICAgZW5kOiBudWxsLFxuICAgICAgICB0eXBlOiAnVGV4dCcsXG4gICAgICAgIHJhdzogJycsXG4gICAgICAgIGRhdGE6IG51bGxcbiAgICB9O1xuICAgIGNvbnN0IGNodW5rcyA9IFtdO1xuICAgIGZ1bmN0aW9uIGZsdXNoKGVuZCkge1xuICAgICAgICBpZiAoY3VycmVudF9jaHVuay5yYXcpIHtcbiAgICAgICAgICAgIGN1cnJlbnRfY2h1bmsuZGF0YSA9IGRlY29kZV9jaGFyYWN0ZXJfcmVmZXJlbmNlcyhjdXJyZW50X2NodW5rLnJhdyk7XG4gICAgICAgICAgICBjdXJyZW50X2NodW5rLmVuZCA9IGVuZDtcbiAgICAgICAgICAgIGNodW5rcy5wdXNoKGN1cnJlbnRfY2h1bmspO1xuICAgICAgICB9XG4gICAgfVxuICAgIHdoaWxlIChwYXJzZXIuaW5kZXggPCBwYXJzZXIudGVtcGxhdGUubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VyLmluZGV4O1xuICAgICAgICBpZiAoZG9uZSgpKSB7XG4gICAgICAgICAgICBmbHVzaChwYXJzZXIuaW5kZXgpO1xuICAgICAgICAgICAgcmV0dXJuIGNodW5rcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwYXJzZXIuZWF0KCd7JykpIHtcbiAgICAgICAgICAgIGZsdXNoKHBhcnNlci5pbmRleCAtIDEpO1xuICAgICAgICAgICAgcGFyc2VyLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSByZWFkX2V4cHJlc3Npb24ocGFyc2VyKTtcbiAgICAgICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICBwYXJzZXIuZWF0KCd9JywgdHJ1ZSk7XG4gICAgICAgICAgICBjaHVua3MucHVzaCh7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IGluZGV4LFxuICAgICAgICAgICAgICAgIGVuZDogcGFyc2VyLmluZGV4LFxuICAgICAgICAgICAgICAgIHR5cGU6ICdNdXN0YWNoZVRhZycsXG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjdXJyZW50X2NodW5rID0ge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiBwYXJzZXIuaW5kZXgsXG4gICAgICAgICAgICAgICAgZW5kOiBudWxsLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdUZXh0JyxcbiAgICAgICAgICAgICAgICByYXc6ICcnLFxuICAgICAgICAgICAgICAgIGRhdGE6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjdXJyZW50X2NodW5rLnJhdyArPSBwYXJzZXIudGVtcGxhdGVbcGFyc2VyLmluZGV4KytdO1xuICAgICAgICB9XG4gICAgfVxuICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLnVuZXhwZWN0ZWRfZW9mKTtcbn1cblxuY29uc3QgU1FVQVJFX0JSQUNLRVRfT1BFTiA9ICdbJy5jaGFyQ29kZUF0KDApO1xuY29uc3QgU1FVQVJFX0JSQUNLRVRfQ0xPU0UgPSAnXScuY2hhckNvZGVBdCgwKTtcbmNvbnN0IENVUkxZX0JSQUNLRVRfT1BFTiA9ICd7Jy5jaGFyQ29kZUF0KDApO1xuY29uc3QgQ1VSTFlfQlJBQ0tFVF9DTE9TRSA9ICd9Jy5jaGFyQ29kZUF0KDApO1xuZnVuY3Rpb24gaXNfYnJhY2tldF9vcGVuKGNvZGUpIHtcbiAgICByZXR1cm4gY29kZSA9PT0gU1FVQVJFX0JSQUNLRVRfT1BFTiB8fCBjb2RlID09PSBDVVJMWV9CUkFDS0VUX09QRU47XG59XG5mdW5jdGlvbiBpc19icmFja2V0X2Nsb3NlKGNvZGUpIHtcbiAgICByZXR1cm4gY29kZSA9PT0gU1FVQVJFX0JSQUNLRVRfQ0xPU0UgfHwgY29kZSA9PT0gQ1VSTFlfQlJBQ0tFVF9DTE9TRTtcbn1cbmZ1bmN0aW9uIGlzX2JyYWNrZXRfcGFpcihvcGVuLCBjbG9zZSkge1xuICAgIHJldHVybiAoKG9wZW4gPT09IFNRVUFSRV9CUkFDS0VUX09QRU4gJiYgY2xvc2UgPT09IFNRVUFSRV9CUkFDS0VUX0NMT1NFKSB8fFxuICAgICAgICAob3BlbiA9PT0gQ1VSTFlfQlJBQ0tFVF9PUEVOICYmIGNsb3NlID09PSBDVVJMWV9CUkFDS0VUX0NMT1NFKSk7XG59XG5mdW5jdGlvbiBnZXRfYnJhY2tldF9jbG9zZShvcGVuKSB7XG4gICAgaWYgKG9wZW4gPT09IFNRVUFSRV9CUkFDS0VUX09QRU4pIHtcbiAgICAgICAgcmV0dXJuIFNRVUFSRV9CUkFDS0VUX0NMT1NFO1xuICAgIH1cbiAgICBpZiAob3BlbiA9PT0gQ1VSTFlfQlJBQ0tFVF9PUEVOKSB7XG4gICAgICAgIHJldHVybiBDVVJMWV9CUkFDS0VUX0NMT1NFO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVhZF9jb250ZXh0KHBhcnNlcikge1xuICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VyLmluZGV4O1xuICAgIGxldCBpID0gcGFyc2VyLmluZGV4O1xuICAgIGNvbnN0IGNvZGUgPSBmdWxsX2NoYXJfY29kZV9hdChwYXJzZXIudGVtcGxhdGUsIGkpO1xuICAgIGlmIChpc0lkZW50aWZpZXJTdGFydChjb2RlLCB0cnVlKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLFxuICAgICAgICAgICAgbmFtZTogcGFyc2VyLnJlYWRfaWRlbnRpZmllcigpLFxuICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICBlbmQ6IHBhcnNlci5pbmRleFxuICAgICAgICB9O1xuICAgIH1cbiAgICBpZiAoIWlzX2JyYWNrZXRfb3Blbihjb2RlKSkge1xuICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy51bmV4cGVjdGVkX3Rva2VuX2Rlc3RydWN0dXJlKTtcbiAgICB9XG4gICAgY29uc3QgYnJhY2tldF9zdGFjayA9IFtjb2RlXTtcbiAgICBpICs9IGNvZGUgPD0gMHhmZmZmID8gMSA6IDI7XG4gICAgd2hpbGUgKGkgPCBwYXJzZXIudGVtcGxhdGUubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGNvZGUgPSBmdWxsX2NoYXJfY29kZV9hdChwYXJzZXIudGVtcGxhdGUsIGkpO1xuICAgICAgICBpZiAoaXNfYnJhY2tldF9vcGVuKGNvZGUpKSB7XG4gICAgICAgICAgICBicmFja2V0X3N0YWNrLnB1c2goY29kZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXNfYnJhY2tldF9jbG9zZShjb2RlKSkge1xuICAgICAgICAgICAgaWYgKCFpc19icmFja2V0X3BhaXIoYnJhY2tldF9zdGFja1ticmFja2V0X3N0YWNrLmxlbmd0aCAtIDFdLCBjb2RlKSkge1xuICAgICAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLnVuZXhwZWN0ZWRfdG9rZW4oU3RyaW5nLmZyb21DaGFyQ29kZShnZXRfYnJhY2tldF9jbG9zZShicmFja2V0X3N0YWNrW2JyYWNrZXRfc3RhY2subGVuZ3RoIC0gMV0pKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJhY2tldF9zdGFjay5wb3AoKTtcbiAgICAgICAgICAgIGlmIChicmFja2V0X3N0YWNrLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGkgKz0gY29kZSA8PSAweGZmZmYgPyAxIDogMjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpICs9IGNvZGUgPD0gMHhmZmZmID8gMSA6IDI7XG4gICAgfVxuICAgIHBhcnNlci5pbmRleCA9IGk7XG4gICAgY29uc3QgcGF0dGVybl9zdHJpbmcgPSBwYXJzZXIudGVtcGxhdGUuc2xpY2Uoc3RhcnQsIGkpO1xuICAgIHRyeSB7XG4gICAgICAgIC8vIHRoZSBsZW5ndGggb2YgdGhlIGBzcGFjZV93aXRoX25ld2xpbmVgIGhhcyB0byBiZSBzdGFydCAtIDFcbiAgICAgICAgLy8gYmVjYXVzZSB3ZSBhZGRlZCBhIGAoYCBpbiBmcm9udCBvZiB0aGUgcGF0dGVybl9zdHJpbmcsXG4gICAgICAgIC8vIHdoaWNoIHNoaWZ0ZWQgdGhlIGVudGlyZSBzdHJpbmcgdG8gcmlnaHQgYnkgMVxuICAgICAgICAvLyBzbyB3ZSBvZmZzZXQgaXQgYnkgcmVtb3ZpbmcgMSBjaGFyYWN0ZXIgaW4gdGhlIGBzcGFjZV93aXRoX25ld2xpbmVgXG4gICAgICAgIC8vIHRvIGFjaGlldmUgdGhhdCwgd2UgcmVtb3ZlIHRoZSAxc3Qgc3BhY2UgZW5jb3VudGVyZWQsXG4gICAgICAgIC8vIHNvIGl0IHdpbGwgbm90IGFmZmVjdCB0aGUgYGNvbHVtbmAgb2YgdGhlIG5vZGVcbiAgICAgICAgbGV0IHNwYWNlX3dpdGhfbmV3bGluZSA9IHBhcnNlci50ZW1wbGF0ZS5zbGljZSgwLCBzdGFydCkucmVwbGFjZSgvW15cXG5dL2csICcgJyk7XG4gICAgICAgIGNvbnN0IGZpcnN0X3NwYWNlID0gc3BhY2Vfd2l0aF9uZXdsaW5lLmluZGV4T2YoJyAnKTtcbiAgICAgICAgc3BhY2Vfd2l0aF9uZXdsaW5lID0gc3BhY2Vfd2l0aF9uZXdsaW5lLnNsaWNlKDAsIGZpcnN0X3NwYWNlKSArIHNwYWNlX3dpdGhfbmV3bGluZS5zbGljZShmaXJzdF9zcGFjZSArIDEpO1xuICAgICAgICByZXR1cm4gcGFyc2VfZXhwcmVzc2lvbl9hdChgJHtzcGFjZV93aXRoX25ld2xpbmV9KCR7cGF0dGVybl9zdHJpbmd9ID0gMSlgLCBzdGFydCAtIDEpLmxlZnQ7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBwYXJzZXIuYWNvcm5fZXJyb3IoZXJyb3IpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gdHJpbV9zdGFydChzdHIpIHtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2Uoc3RhcnRfd2hpdGVzcGFjZSwgJycpO1xufVxuZnVuY3Rpb24gdHJpbV9lbmQoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKGVuZF93aGl0ZXNwYWNlLCAnJyk7XG59XG5cbmZ1bmN0aW9uIHRvX3N0cmluZyhub2RlKSB7XG4gICAgc3dpdGNoIChub2RlLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnSWZCbG9jayc6XG4gICAgICAgICAgICByZXR1cm4gJ3sjaWZ9IGJsb2NrJztcbiAgICAgICAgY2FzZSAnVGhlbkJsb2NrJzpcbiAgICAgICAgICAgIHJldHVybiAnezp0aGVufSBibG9jayc7XG4gICAgICAgIGNhc2UgJ0Vsc2VCbG9jayc6XG4gICAgICAgICAgICByZXR1cm4gJ3s6ZWxzZX0gYmxvY2snO1xuICAgICAgICBjYXNlICdQZW5kaW5nQmxvY2snOlxuICAgICAgICBjYXNlICdBd2FpdEJsb2NrJzpcbiAgICAgICAgICAgIHJldHVybiAneyNhd2FpdH0gYmxvY2snO1xuICAgICAgICBjYXNlICdDYXRjaEJsb2NrJzpcbiAgICAgICAgICAgIHJldHVybiAnezpjYXRjaH0gYmxvY2snO1xuICAgICAgICBjYXNlICdFYWNoQmxvY2snOlxuICAgICAgICAgICAgcmV0dXJuICd7I2VhY2h9IGJsb2NrJztcbiAgICAgICAgY2FzZSAnUmF3TXVzdGFjaGVUYWcnOlxuICAgICAgICAgICAgcmV0dXJuICd7QGh0bWx9IGJsb2NrJztcbiAgICAgICAgY2FzZSAnRGVidWdUYWcnOlxuICAgICAgICAgICAgcmV0dXJuICd7QGRlYnVnfSBibG9jayc7XG4gICAgICAgIGNhc2UgJ0NvbnN0VGFnJzpcbiAgICAgICAgICAgIHJldHVybiAne0Bjb25zdH0gdGFnJztcbiAgICAgICAgY2FzZSAnRWxlbWVudCc6XG4gICAgICAgIGNhc2UgJ0lubGluZUNvbXBvbmVudCc6XG4gICAgICAgIGNhc2UgJ1Nsb3QnOlxuICAgICAgICBjYXNlICdUaXRsZSc6XG4gICAgICAgICAgICByZXR1cm4gYDwke25vZGUubmFtZX0+IHRhZ2A7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gbm9kZS50eXBlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gdHJpbV93aGl0ZXNwYWNlKGJsb2NrLCB0cmltX2JlZm9yZSwgdHJpbV9hZnRlcikge1xuICAgIGlmICghYmxvY2suY2hpbGRyZW4gfHwgYmxvY2suY2hpbGRyZW4ubGVuZ3RoID09PSAwKVxuICAgICAgICByZXR1cm47IC8vIEF3YWl0QmxvY2tcbiAgICBjb25zdCBmaXJzdF9jaGlsZCA9IGJsb2NrLmNoaWxkcmVuWzBdO1xuICAgIGNvbnN0IGxhc3RfY2hpbGQgPSBibG9jay5jaGlsZHJlbltibG9jay5jaGlsZHJlbi5sZW5ndGggLSAxXTtcbiAgICBpZiAoZmlyc3RfY2hpbGQudHlwZSA9PT0gJ1RleHQnICYmIHRyaW1fYmVmb3JlKSB7XG4gICAgICAgIGZpcnN0X2NoaWxkLmRhdGEgPSB0cmltX3N0YXJ0KGZpcnN0X2NoaWxkLmRhdGEpO1xuICAgICAgICBpZiAoIWZpcnN0X2NoaWxkLmRhdGEpXG4gICAgICAgICAgICBibG9jay5jaGlsZHJlbi5zaGlmdCgpO1xuICAgIH1cbiAgICBpZiAobGFzdF9jaGlsZC50eXBlID09PSAnVGV4dCcgJiYgdHJpbV9hZnRlcikge1xuICAgICAgICBsYXN0X2NoaWxkLmRhdGEgPSB0cmltX2VuZChsYXN0X2NoaWxkLmRhdGEpO1xuICAgICAgICBpZiAoIWxhc3RfY2hpbGQuZGF0YSlcbiAgICAgICAgICAgIGJsb2NrLmNoaWxkcmVuLnBvcCgpO1xuICAgIH1cbiAgICBpZiAoYmxvY2suZWxzZSkge1xuICAgICAgICB0cmltX3doaXRlc3BhY2UoYmxvY2suZWxzZSwgdHJpbV9iZWZvcmUsIHRyaW1fYWZ0ZXIpO1xuICAgIH1cbiAgICBpZiAoZmlyc3RfY2hpbGQuZWxzZWlmKSB7XG4gICAgICAgIHRyaW1fd2hpdGVzcGFjZShmaXJzdF9jaGlsZCwgdHJpbV9iZWZvcmUsIHRyaW1fYWZ0ZXIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG11c3RhY2hlKHBhcnNlcikge1xuICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VyLmluZGV4O1xuICAgIHBhcnNlci5pbmRleCArPSAxO1xuICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgLy8gey9pZn0sIHsvZWFjaH0sIHsvYXdhaXR9IG9yIHsva2V5fVxuICAgIGlmIChwYXJzZXIuZWF0KCcvJykpIHtcbiAgICAgICAgbGV0IGJsb2NrID0gcGFyc2VyLmN1cnJlbnQoKTtcbiAgICAgICAgbGV0IGV4cGVjdGVkO1xuICAgICAgICBpZiAoY2xvc2luZ190YWdfb21pdHRlZChibG9jay5uYW1lKSkge1xuICAgICAgICAgICAgYmxvY2suZW5kID0gc3RhcnQ7XG4gICAgICAgICAgICBwYXJzZXIuc3RhY2sucG9wKCk7XG4gICAgICAgICAgICBibG9jayA9IHBhcnNlci5jdXJyZW50KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJsb2NrLnR5cGUgPT09ICdFbHNlQmxvY2snIHx8IGJsb2NrLnR5cGUgPT09ICdQZW5kaW5nQmxvY2snIHx8IGJsb2NrLnR5cGUgPT09ICdUaGVuQmxvY2snIHx8IGJsb2NrLnR5cGUgPT09ICdDYXRjaEJsb2NrJykge1xuICAgICAgICAgICAgYmxvY2suZW5kID0gc3RhcnQ7XG4gICAgICAgICAgICBwYXJzZXIuc3RhY2sucG9wKCk7XG4gICAgICAgICAgICBibG9jayA9IHBhcnNlci5jdXJyZW50KCk7XG4gICAgICAgICAgICBleHBlY3RlZCA9ICdhd2FpdCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJsb2NrLnR5cGUgPT09ICdJZkJsb2NrJykge1xuICAgICAgICAgICAgZXhwZWN0ZWQgPSAnaWYnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGJsb2NrLnR5cGUgPT09ICdFYWNoQmxvY2snKSB7XG4gICAgICAgICAgICBleHBlY3RlZCA9ICdlYWNoJztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChibG9jay50eXBlID09PSAnQXdhaXRCbG9jaycpIHtcbiAgICAgICAgICAgIGV4cGVjdGVkID0gJ2F3YWl0JztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChibG9jay50eXBlID09PSAnS2V5QmxvY2snKSB7XG4gICAgICAgICAgICBleHBlY3RlZCA9ICdrZXknO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMudW5leHBlY3RlZF9ibG9ja19jbG9zZSk7XG4gICAgICAgIH1cbiAgICAgICAgcGFyc2VyLmVhdChleHBlY3RlZCwgdHJ1ZSk7XG4gICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgIHBhcnNlci5lYXQoJ30nLCB0cnVlKTtcbiAgICAgICAgd2hpbGUgKGJsb2NrLmVsc2VpZikge1xuICAgICAgICAgICAgYmxvY2suZW5kID0gcGFyc2VyLmluZGV4O1xuICAgICAgICAgICAgcGFyc2VyLnN0YWNrLnBvcCgpO1xuICAgICAgICAgICAgYmxvY2sgPSBwYXJzZXIuY3VycmVudCgpO1xuICAgICAgICAgICAgaWYgKGJsb2NrLmVsc2UpIHtcbiAgICAgICAgICAgICAgICBibG9jay5lbHNlLmVuZCA9IHN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHN0cmlwIGxlYWRpbmcvdHJhaWxpbmcgd2hpdGVzcGFjZSBhcyBuZWNlc3NhcnlcbiAgICAgICAgY29uc3QgY2hhcl9iZWZvcmUgPSBwYXJzZXIudGVtcGxhdGVbYmxvY2suc3RhcnQgLSAxXTtcbiAgICAgICAgY29uc3QgY2hhcl9hZnRlciA9IHBhcnNlci50ZW1wbGF0ZVtwYXJzZXIuaW5kZXhdO1xuICAgICAgICBjb25zdCB0cmltX2JlZm9yZSA9ICFjaGFyX2JlZm9yZSB8fCB3aGl0ZXNwYWNlLnRlc3QoY2hhcl9iZWZvcmUpO1xuICAgICAgICBjb25zdCB0cmltX2FmdGVyID0gIWNoYXJfYWZ0ZXIgfHwgd2hpdGVzcGFjZS50ZXN0KGNoYXJfYWZ0ZXIpO1xuICAgICAgICB0cmltX3doaXRlc3BhY2UoYmxvY2ssIHRyaW1fYmVmb3JlLCB0cmltX2FmdGVyKTtcbiAgICAgICAgYmxvY2suZW5kID0gcGFyc2VyLmluZGV4O1xuICAgICAgICBwYXJzZXIuc3RhY2sucG9wKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHBhcnNlci5lYXQoJzplbHNlJykpIHtcbiAgICAgICAgaWYgKHBhcnNlci5lYXQoJ2lmJykpIHtcbiAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXJfZXJyb3JzLmludmFsaWRfZWxzZWlmKTtcbiAgICAgICAgfVxuICAgICAgICBwYXJzZXIuYWxsb3dfd2hpdGVzcGFjZSgpO1xuICAgICAgICAvLyA6ZWxzZSBpZlxuICAgICAgICBpZiAocGFyc2VyLmVhdCgnaWYnKSkge1xuICAgICAgICAgICAgY29uc3QgYmxvY2sgPSBwYXJzZXIuY3VycmVudCgpO1xuICAgICAgICAgICAgaWYgKGJsb2NrLnR5cGUgIT09ICdJZkJsb2NrJykge1xuICAgICAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXIuc3RhY2suc29tZShibG9jayA9PiBibG9jay50eXBlID09PSAnSWZCbG9jaycpXG4gICAgICAgICAgICAgICAgICAgID8gcGFyc2VyX2Vycm9ycy5pbnZhbGlkX2Vsc2VpZl9wbGFjZW1lbnRfdW5jbG9zZWRfYmxvY2sodG9fc3RyaW5nKGJsb2NrKSlcbiAgICAgICAgICAgICAgICAgICAgOiBwYXJzZXJfZXJyb3JzLmludmFsaWRfZWxzZWlmX3BsYWNlbWVudF9vdXRzaWRlX2lmKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhcnNlci5yZXF1aXJlX3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSByZWFkX2V4cHJlc3Npb24ocGFyc2VyKTtcbiAgICAgICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICBwYXJzZXIuZWF0KCd9JywgdHJ1ZSk7XG4gICAgICAgICAgICBibG9jay5lbHNlID0ge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiBwYXJzZXIuaW5kZXgsXG4gICAgICAgICAgICAgICAgZW5kOiBudWxsLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdFbHNlQmxvY2snLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBwYXJzZXIuaW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnSWZCbG9jaycsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWY6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcGFyc2VyLnN0YWNrLnB1c2goYmxvY2suZWxzZS5jaGlsZHJlblswXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyA6ZWxzZVxuICAgICAgICAgICAgY29uc3QgYmxvY2sgPSBwYXJzZXIuY3VycmVudCgpO1xuICAgICAgICAgICAgaWYgKGJsb2NrLnR5cGUgIT09ICdJZkJsb2NrJyAmJiBibG9jay50eXBlICE9PSAnRWFjaEJsb2NrJykge1xuICAgICAgICAgICAgICAgIHBhcnNlci5lcnJvcihwYXJzZXIuc3RhY2suc29tZShibG9jayA9PiBibG9jay50eXBlID09PSAnSWZCbG9jaycgfHwgYmxvY2sudHlwZSA9PT0gJ0VhY2hCbG9jaycpXG4gICAgICAgICAgICAgICAgICAgID8gcGFyc2VyX2Vycm9ycy5pbnZhbGlkX2Vsc2VfcGxhY2VtZW50X3VuY2xvc2VkX2Jsb2NrKHRvX3N0cmluZyhibG9jaykpXG4gICAgICAgICAgICAgICAgICAgIDogcGFyc2VyX2Vycm9ycy5pbnZhbGlkX2Vsc2VfcGxhY2VtZW50X291dHNpZGVfaWYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFyc2VyLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgIHBhcnNlci5lYXQoJ30nLCB0cnVlKTtcbiAgICAgICAgICAgIGJsb2NrLmVsc2UgPSB7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IHBhcnNlci5pbmRleCxcbiAgICAgICAgICAgICAgICBlbmQ6IG51bGwsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0Vsc2VCbG9jaycsXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcGFyc2VyLnN0YWNrLnB1c2goYmxvY2suZWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAocGFyc2VyLm1hdGNoKCc6dGhlbicpIHx8IHBhcnNlci5tYXRjaCgnOmNhdGNoJykpIHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBwYXJzZXIuY3VycmVudCgpO1xuICAgICAgICBjb25zdCBpc190aGVuID0gcGFyc2VyLmVhdCgnOnRoZW4nKSB8fCAhcGFyc2VyLmVhdCgnOmNhdGNoJyk7XG4gICAgICAgIGlmIChpc190aGVuKSB7XG4gICAgICAgICAgICBpZiAoYmxvY2sudHlwZSAhPT0gJ1BlbmRpbmdCbG9jaycpIHtcbiAgICAgICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyLnN0YWNrLnNvbWUoYmxvY2sgPT4gYmxvY2sudHlwZSA9PT0gJ1BlbmRpbmdCbG9jaycpXG4gICAgICAgICAgICAgICAgICAgID8gcGFyc2VyX2Vycm9ycy5pbnZhbGlkX3RoZW5fcGxhY2VtZW50X3VuY2xvc2VkX2Jsb2NrKHRvX3N0cmluZyhibG9jaykpXG4gICAgICAgICAgICAgICAgICAgIDogcGFyc2VyX2Vycm9ycy5pbnZhbGlkX3RoZW5fcGxhY2VtZW50X3dpdGhvdXRfYXdhaXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGJsb2NrLnR5cGUgIT09ICdUaGVuQmxvY2snICYmIGJsb2NrLnR5cGUgIT09ICdQZW5kaW5nQmxvY2snKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlci5zdGFjay5zb21lKGJsb2NrID0+IGJsb2NrLnR5cGUgPT09ICdUaGVuQmxvY2snIHx8IGJsb2NrLnR5cGUgPT09ICdQZW5kaW5nQmxvY2snKVxuICAgICAgICAgICAgICAgICAgICA/IHBhcnNlcl9lcnJvcnMuaW52YWxpZF9jYXRjaF9wbGFjZW1lbnRfdW5jbG9zZWRfYmxvY2sodG9fc3RyaW5nKGJsb2NrKSlcbiAgICAgICAgICAgICAgICAgICAgOiBwYXJzZXJfZXJyb3JzLmludmFsaWRfY2F0Y2hfcGxhY2VtZW50X3dpdGhvdXRfYXdhaXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmVuZCA9IHN0YXJ0O1xuICAgICAgICBwYXJzZXIuc3RhY2sucG9wKCk7XG4gICAgICAgIGNvbnN0IGF3YWl0X2Jsb2NrID0gcGFyc2VyLmN1cnJlbnQoKTtcbiAgICAgICAgaWYgKCFwYXJzZXIuZWF0KCd9JykpIHtcbiAgICAgICAgICAgIHBhcnNlci5yZXF1aXJlX3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgIGF3YWl0X2Jsb2NrW2lzX3RoZW4gPyAndmFsdWUnIDogJ2Vycm9yJ10gPSByZWFkX2NvbnRleHQocGFyc2VyKTtcbiAgICAgICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICBwYXJzZXIuZWF0KCd9JywgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3X2Jsb2NrID0ge1xuICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICBlbmQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBpc190aGVuID8gJ1RoZW5CbG9jaycgOiAnQ2F0Y2hCbG9jaycsXG4gICAgICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgICAgICBza2lwOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICBhd2FpdF9ibG9ja1tpc190aGVuID8gJ3RoZW4nIDogJ2NhdGNoJ10gPSBuZXdfYmxvY2s7XG4gICAgICAgIHBhcnNlci5zdGFjay5wdXNoKG5ld19ibG9jayk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHBhcnNlci5lYXQoJyMnKSkge1xuICAgICAgICAvLyB7I2lmIGZvb30sIHsjZWFjaCBmb299IG9yIHsjYXdhaXQgZm9vfVxuICAgICAgICBsZXQgdHlwZTtcbiAgICAgICAgaWYgKHBhcnNlci5lYXQoJ2lmJykpIHtcbiAgICAgICAgICAgIHR5cGUgPSAnSWZCbG9jayc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocGFyc2VyLmVhdCgnZWFjaCcpKSB7XG4gICAgICAgICAgICB0eXBlID0gJ0VhY2hCbG9jayc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocGFyc2VyLmVhdCgnYXdhaXQnKSkge1xuICAgICAgICAgICAgdHlwZSA9ICdBd2FpdEJsb2NrJztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwYXJzZXIuZWF0KCdrZXknKSkge1xuICAgICAgICAgICAgdHlwZSA9ICdLZXlCbG9jayc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5leHBlY3RlZF9ibG9ja190eXBlKTtcbiAgICAgICAgfVxuICAgICAgICBwYXJzZXIucmVxdWlyZV93aGl0ZXNwYWNlKCk7XG4gICAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSByZWFkX2V4cHJlc3Npb24ocGFyc2VyKTtcbiAgICAgICAgY29uc3QgYmxvY2sgPSB0eXBlID09PSAnQXdhaXRCbG9jaycgP1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHN0YXJ0LFxuICAgICAgICAgICAgICAgIGVuZDogbnVsbCxcbiAgICAgICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgICAgIGV4cHJlc3Npb24sXG4gICAgICAgICAgICAgICAgdmFsdWU6IG51bGwsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgICAgICAgcGVuZGluZzoge1xuICAgICAgICAgICAgICAgICAgICBzdGFydDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgZW5kOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUGVuZGluZ0Jsb2NrJyxcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxuICAgICAgICAgICAgICAgICAgICBza2lwOiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGVuOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBlbmQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdUaGVuQmxvY2snLFxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgICAgICAgICAgICAgIHNraXA6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNhdGNoOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBlbmQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdDYXRjaEJsb2NrJyxcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxuICAgICAgICAgICAgICAgICAgICBza2lwOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSA6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgZW5kOiBudWxsLFxuICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvbixcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW11cbiAgICAgICAgICAgIH07XG4gICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgIC8vIHsjZWFjaH0gYmxvY2tzIG11c3QgZGVjbGFyZSBhIGNvbnRleHQg4oCTIHsjZWFjaCBsaXN0IGFzIGl0ZW19XG4gICAgICAgIGlmICh0eXBlID09PSAnRWFjaEJsb2NrJykge1xuICAgICAgICAgICAgcGFyc2VyLmVhdCgnYXMnLCB0cnVlKTtcbiAgICAgICAgICAgIHBhcnNlci5yZXF1aXJlX3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgIGJsb2NrLmNvbnRleHQgPSByZWFkX2NvbnRleHQocGFyc2VyKTtcbiAgICAgICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICBpZiAocGFyc2VyLmVhdCgnLCcpKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VyLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgICAgICBibG9jay5pbmRleCA9IHBhcnNlci5yZWFkX2lkZW50aWZpZXIoKTtcbiAgICAgICAgICAgICAgICBpZiAoIWJsb2NrLmluZGV4KVxuICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5leHBlY3RlZF9uYW1lKTtcbiAgICAgICAgICAgICAgICBwYXJzZXIuYWxsb3dfd2hpdGVzcGFjZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBhcnNlci5lYXQoJygnKSkge1xuICAgICAgICAgICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICAgICAgYmxvY2sua2V5ID0gcmVhZF9leHByZXNzaW9uKHBhcnNlcik7XG4gICAgICAgICAgICAgICAgcGFyc2VyLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgICAgICBwYXJzZXIuZWF0KCcpJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgcGFyc2VyLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhd2FpdF9ibG9ja19zaG9ydGhhbmQgPSB0eXBlID09PSAnQXdhaXRCbG9jaycgJiYgcGFyc2VyLmVhdCgndGhlbicpO1xuICAgICAgICBpZiAoYXdhaXRfYmxvY2tfc2hvcnRoYW5kKSB7XG4gICAgICAgICAgICBpZiAocGFyc2VyLm1hdGNoX3JlZ2V4KC9cXHMqfS8pKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VyLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhcnNlci5yZXF1aXJlX3doaXRlc3BhY2UoKTtcbiAgICAgICAgICAgICAgICBibG9jay52YWx1ZSA9IHJlYWRfY29udGV4dChwYXJzZXIpO1xuICAgICAgICAgICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYXdhaXRfYmxvY2tfY2F0Y2hfc2hvcnRoYW5kID0gIWF3YWl0X2Jsb2NrX3Nob3J0aGFuZCAmJiB0eXBlID09PSAnQXdhaXRCbG9jaycgJiYgcGFyc2VyLmVhdCgnY2F0Y2gnKTtcbiAgICAgICAgaWYgKGF3YWl0X2Jsb2NrX2NhdGNoX3Nob3J0aGFuZCkge1xuICAgICAgICAgICAgaWYgKHBhcnNlci5tYXRjaF9yZWdleCgvXFxzKn0vKSkge1xuICAgICAgICAgICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXJzZXIucmVxdWlyZV93aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICAgICAgYmxvY2suZXJyb3IgPSByZWFkX2NvbnRleHQocGFyc2VyKTtcbiAgICAgICAgICAgICAgICBwYXJzZXIuYWxsb3dfd2hpdGVzcGFjZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHBhcnNlci5lYXQoJ30nLCB0cnVlKTtcbiAgICAgICAgcGFyc2VyLmN1cnJlbnQoKS5jaGlsZHJlbi5wdXNoKGJsb2NrKTtcbiAgICAgICAgcGFyc2VyLnN0YWNrLnB1c2goYmxvY2spO1xuICAgICAgICBpZiAodHlwZSA9PT0gJ0F3YWl0QmxvY2snKSB7XG4gICAgICAgICAgICBsZXQgY2hpbGRfYmxvY2s7XG4gICAgICAgICAgICBpZiAoYXdhaXRfYmxvY2tfc2hvcnRoYW5kKSB7XG4gICAgICAgICAgICAgICAgYmxvY2sudGhlbi5za2lwID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY2hpbGRfYmxvY2sgPSBibG9jay50aGVuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYXdhaXRfYmxvY2tfY2F0Y2hfc2hvcnRoYW5kKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2F0Y2guc2tpcCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNoaWxkX2Jsb2NrID0gYmxvY2suY2F0Y2g7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBibG9jay5wZW5kaW5nLnNraXAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBjaGlsZF9ibG9jayA9IGJsb2NrLnBlbmRpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaGlsZF9ibG9jay5zdGFydCA9IHBhcnNlci5pbmRleDtcbiAgICAgICAgICAgIHBhcnNlci5zdGFjay5wdXNoKGNoaWxkX2Jsb2NrKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChwYXJzZXIuZWF0KCdAaHRtbCcpKSB7XG4gICAgICAgIC8vIHtAaHRtbCBjb250ZW50fSB0YWdcbiAgICAgICAgcGFyc2VyLnJlcXVpcmVfd2hpdGVzcGFjZSgpO1xuICAgICAgICBjb25zdCBleHByZXNzaW9uID0gcmVhZF9leHByZXNzaW9uKHBhcnNlcik7XG4gICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgIHBhcnNlci5lYXQoJ30nLCB0cnVlKTtcbiAgICAgICAgcGFyc2VyLmN1cnJlbnQoKS5jaGlsZHJlbi5wdXNoKHtcbiAgICAgICAgICAgIHN0YXJ0LFxuICAgICAgICAgICAgZW5kOiBwYXJzZXIuaW5kZXgsXG4gICAgICAgICAgICB0eXBlOiAnUmF3TXVzdGFjaGVUYWcnLFxuICAgICAgICAgICAgZXhwcmVzc2lvblxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSBpZiAocGFyc2VyLmVhdCgnQGRlYnVnJykpIHtcbiAgICAgICAgbGV0IGlkZW50aWZpZXJzO1xuICAgICAgICAvLyBJbXBsaWVzIHtAZGVidWd9IHdoaWNoIGluZGljYXRlcyBcImRlYnVnIGFsbFwiXG4gICAgICAgIGlmIChwYXJzZXIucmVhZCgvXFxzKn0vKSkge1xuICAgICAgICAgICAgaWRlbnRpZmllcnMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSByZWFkX2V4cHJlc3Npb24ocGFyc2VyKTtcbiAgICAgICAgICAgIGlkZW50aWZpZXJzID0gZXhwcmVzc2lvbi50eXBlID09PSAnU2VxdWVuY2VFeHByZXNzaW9uJ1xuICAgICAgICAgICAgICAgID8gZXhwcmVzc2lvbi5leHByZXNzaW9uc1xuICAgICAgICAgICAgICAgIDogW2V4cHJlc3Npb25dO1xuICAgICAgICAgICAgaWRlbnRpZmllcnMuZm9yRWFjaChub2RlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlICE9PSAnSWRlbnRpZmllcicpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMuaW52YWxpZF9kZWJ1Z19hcmdzLCBub2RlLnN0YXJ0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHBhcnNlci5hbGxvd193aGl0ZXNwYWNlKCk7XG4gICAgICAgICAgICBwYXJzZXIuZWF0KCd9JywgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcGFyc2VyLmN1cnJlbnQoKS5jaGlsZHJlbi5wdXNoKHtcbiAgICAgICAgICAgIHN0YXJ0LFxuICAgICAgICAgICAgZW5kOiBwYXJzZXIuaW5kZXgsXG4gICAgICAgICAgICB0eXBlOiAnRGVidWdUYWcnLFxuICAgICAgICAgICAgaWRlbnRpZmllcnNcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHBhcnNlci5lYXQoJ0Bjb25zdCcpKSB7XG4gICAgICAgIC8vIHtAY29uc3QgYSA9IGJ9XG4gICAgICAgIHBhcnNlci5yZXF1aXJlX3doaXRlc3BhY2UoKTtcbiAgICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IHJlYWRfZXhwcmVzc2lvbihwYXJzZXIpO1xuICAgICAgICBpZiAoIShleHByZXNzaW9uLnR5cGUgPT09ICdBc3NpZ25tZW50RXhwcmVzc2lvbicgJiYgZXhwcmVzc2lvbi5vcGVyYXRvciA9PT0gJz0nKSkge1xuICAgICAgICAgICAgcGFyc2VyLmVycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiAnaW52YWxpZC1jb25zdC1hcmdzJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAne0Bjb25zdCAuLi59IG11c3QgYmUgYW4gYXNzaWdubWVudC4nXG4gICAgICAgICAgICB9LCBzdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgcGFyc2VyLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICAgICAgcGFyc2VyLmVhdCgnfScsIHRydWUpO1xuICAgICAgICBwYXJzZXIuY3VycmVudCgpLmNoaWxkcmVuLnB1c2goe1xuICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICBlbmQ6IHBhcnNlci5pbmRleCxcbiAgICAgICAgICAgIHR5cGU6ICdDb25zdFRhZycsXG4gICAgICAgICAgICBleHByZXNzaW9uXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IHJlYWRfZXhwcmVzc2lvbihwYXJzZXIpO1xuICAgICAgICBwYXJzZXIuYWxsb3dfd2hpdGVzcGFjZSgpO1xuICAgICAgICBwYXJzZXIuZWF0KCd9JywgdHJ1ZSk7XG4gICAgICAgIHBhcnNlci5jdXJyZW50KCkuY2hpbGRyZW4ucHVzaCh7XG4gICAgICAgICAgICBzdGFydCxcbiAgICAgICAgICAgIGVuZDogcGFyc2VyLmluZGV4LFxuICAgICAgICAgICAgdHlwZTogJ011c3RhY2hlVGFnJyxcbiAgICAgICAgICAgIGV4cHJlc3Npb25cbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB0ZXh0KHBhcnNlcikge1xuICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VyLmluZGV4O1xuICAgIGxldCBkYXRhID0gJyc7XG4gICAgd2hpbGUgKHBhcnNlci5pbmRleCA8IHBhcnNlci50ZW1wbGF0ZS5sZW5ndGggJiZcbiAgICAgICAgIXBhcnNlci5tYXRjaCgnPCcpICYmXG4gICAgICAgICFwYXJzZXIubWF0Y2goJ3snKSkge1xuICAgICAgICBkYXRhICs9IHBhcnNlci50ZW1wbGF0ZVtwYXJzZXIuaW5kZXgrK107XG4gICAgfVxuICAgIGNvbnN0IG5vZGUgPSB7XG4gICAgICAgIHN0YXJ0LFxuICAgICAgICBlbmQ6IHBhcnNlci5pbmRleCxcbiAgICAgICAgdHlwZTogJ1RleHQnLFxuICAgICAgICByYXc6IGRhdGEsXG4gICAgICAgIGRhdGE6IGRlY29kZV9jaGFyYWN0ZXJfcmVmZXJlbmNlcyhkYXRhKVxuICAgIH07XG4gICAgcGFyc2VyLmN1cnJlbnQoKS5jaGlsZHJlbi5wdXNoKG5vZGUpO1xufVxuXG5mdW5jdGlvbiBmcmFnbWVudChwYXJzZXIpIHtcbiAgICBpZiAocGFyc2VyLm1hdGNoKCc8JykpIHtcbiAgICAgICAgcmV0dXJuIHRhZztcbiAgICB9XG4gICAgaWYgKHBhcnNlci5tYXRjaCgneycpKSB7XG4gICAgICAgIHJldHVybiBtdXN0YWNoZTtcbiAgICB9XG4gICAgcmV0dXJuIHRleHQ7XG59XG5cbmZ1bmN0aW9uIGdldExvY2F0b3Ioc291cmNlLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cbiAgICB2YXIgb2Zmc2V0TGluZSA9IG9wdGlvbnMub2Zmc2V0TGluZSB8fCAwO1xuICAgIHZhciBvZmZzZXRDb2x1bW4gPSBvcHRpb25zLm9mZnNldENvbHVtbiB8fCAwO1xuICAgIHZhciBvcmlnaW5hbExpbmVzID0gc291cmNlLnNwbGl0KCdcXG4nKTtcbiAgICB2YXIgc3RhcnQgPSAwO1xuICAgIHZhciBsaW5lUmFuZ2VzID0gb3JpZ2luYWxMaW5lcy5tYXAoZnVuY3Rpb24gKGxpbmUsIGkpIHtcbiAgICAgICAgdmFyIGVuZCA9IHN0YXJ0ICsgbGluZS5sZW5ndGggKyAxO1xuICAgICAgICB2YXIgcmFuZ2UgPSB7IHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIGxpbmU6IGkgfTtcbiAgICAgICAgc3RhcnQgPSBlbmQ7XG4gICAgICAgIHJldHVybiByYW5nZTtcbiAgICB9KTtcbiAgICB2YXIgaSA9IDA7XG4gICAgZnVuY3Rpb24gcmFuZ2VDb250YWlucyhyYW5nZSwgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0IDw9IGluZGV4ICYmIGluZGV4IDwgcmFuZ2UuZW5kO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZXRMb2NhdGlvbihyYW5nZSwgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHsgbGluZTogb2Zmc2V0TGluZSArIHJhbmdlLmxpbmUsIGNvbHVtbjogb2Zmc2V0Q29sdW1uICsgaW5kZXggLSByYW5nZS5zdGFydCwgY2hhcmFjdGVyOiBpbmRleCB9O1xuICAgIH1cbiAgICBmdW5jdGlvbiBsb2NhdGUoc2VhcmNoLCBzdGFydEluZGV4KSB7XG4gICAgICAgIGlmICh0eXBlb2Ygc2VhcmNoID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgc2VhcmNoID0gc291cmNlLmluZGV4T2Yoc2VhcmNoLCBzdGFydEluZGV4IHx8IDApO1xuICAgICAgICB9XG4gICAgICAgIHZhciByYW5nZSA9IGxpbmVSYW5nZXNbaV07XG4gICAgICAgIHZhciBkID0gc2VhcmNoID49IHJhbmdlLmVuZCA/IDEgOiAtMTtcbiAgICAgICAgd2hpbGUgKHJhbmdlKSB7XG4gICAgICAgICAgICBpZiAocmFuZ2VDb250YWlucyhyYW5nZSwgc2VhcmNoKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TG9jYXRpb24ocmFuZ2UsIHNlYXJjaCk7XG4gICAgICAgICAgICBpICs9IGQ7XG4gICAgICAgICAgICByYW5nZSA9IGxpbmVSYW5nZXNbaV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxvY2F0ZTtcbn1cbmZ1bmN0aW9uIGxvY2F0ZShzb3VyY2UsIHNlYXJjaCwgb3B0aW9ucykge1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdsb2NhdGUgdGFrZXMgYSB7IHN0YXJ0SW5kZXgsIG9mZnNldExpbmUsIG9mZnNldENvbHVtbiB9IG9iamVjdCBhcyB0aGUgdGhpcmQgYXJndW1lbnQnKTtcbiAgICB9XG4gICAgcmV0dXJuIGdldExvY2F0b3Ioc291cmNlLCBvcHRpb25zKShzZWFyY2gsIG9wdGlvbnMgJiYgb3B0aW9ucy5zdGFydEluZGV4KTtcbn1cblxuZnVuY3Rpb24gdGFic190b19zcGFjZXMoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9eXFx0Ky8sIG1hdGNoID0+IG1hdGNoLnNwbGl0KCdcXHQnKS5qb2luKCcgICcpKTtcbn1cbmZ1bmN0aW9uIGdldF9jb2RlX2ZyYW1lKHNvdXJjZSwgbGluZSwgY29sdW1uKSB7XG4gICAgY29uc3QgbGluZXMgPSBzb3VyY2Uuc3BsaXQoJ1xcbicpO1xuICAgIGNvbnN0IGZyYW1lX3N0YXJ0ID0gTWF0aC5tYXgoMCwgbGluZSAtIDIpO1xuICAgIGNvbnN0IGZyYW1lX2VuZCA9IE1hdGgubWluKGxpbmUgKyAzLCBsaW5lcy5sZW5ndGgpO1xuICAgIGNvbnN0IGRpZ2l0cyA9IFN0cmluZyhmcmFtZV9lbmQgKyAxKS5sZW5ndGg7XG4gICAgcmV0dXJuIGxpbmVzXG4gICAgICAgIC5zbGljZShmcmFtZV9zdGFydCwgZnJhbWVfZW5kKVxuICAgICAgICAubWFwKChzdHIsIGkpID0+IHtcbiAgICAgICAgY29uc3QgaXNFcnJvckxpbmUgPSBmcmFtZV9zdGFydCArIGkgPT09IGxpbmU7XG4gICAgICAgIGNvbnN0IGxpbmVfbnVtID0gU3RyaW5nKGkgKyBmcmFtZV9zdGFydCArIDEpLnBhZFN0YXJ0KGRpZ2l0cywgJyAnKTtcbiAgICAgICAgaWYgKGlzRXJyb3JMaW5lKSB7XG4gICAgICAgICAgICBjb25zdCBpbmRpY2F0b3IgPSAnICcucmVwZWF0KGRpZ2l0cyArIDIgKyB0YWJzX3RvX3NwYWNlcyhzdHIuc2xpY2UoMCwgY29sdW1uKSkubGVuZ3RoKSArICdeJztcbiAgICAgICAgICAgIHJldHVybiBgJHtsaW5lX251bX06ICR7dGFic190b19zcGFjZXMoc3RyKX1cXG4ke2luZGljYXRvcn1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHtsaW5lX251bX06ICR7dGFic190b19zcGFjZXMoc3RyKX1gO1xuICAgIH0pXG4gICAgICAgIC5qb2luKCdcXG4nKTtcbn1cblxuY2xhc3MgQ29tcGlsZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5tZXNzYWdlfSAoJHt0aGlzLnN0YXJ0LmxpbmV9OiR7dGhpcy5zdGFydC5jb2x1bW59KVxcbiR7dGhpcy5mcmFtZX1gO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UsIHByb3BzKSB7XG4gICAgY29uc3QgZXJyb3IgPSBuZXcgQ29tcGlsZUVycm9yKG1lc3NhZ2UpO1xuICAgIGVycm9yLm5hbWUgPSBwcm9wcy5uYW1lO1xuICAgIGNvbnN0IHN0YXJ0ID0gbG9jYXRlKHByb3BzLnNvdXJjZSwgcHJvcHMuc3RhcnQsIHsgb2Zmc2V0TGluZTogMSB9KTtcbiAgICBjb25zdCBlbmQgPSBsb2NhdGUocHJvcHMuc291cmNlLCBwcm9wcy5lbmQgfHwgcHJvcHMuc3RhcnQsIHsgb2Zmc2V0TGluZTogMSB9KTtcbiAgICBlcnJvci5jb2RlID0gcHJvcHMuY29kZTtcbiAgICBlcnJvci5zdGFydCA9IHN0YXJ0O1xuICAgIGVycm9yLmVuZCA9IGVuZDtcbiAgICBlcnJvci5wb3MgPSBwcm9wcy5zdGFydDtcbiAgICBlcnJvci5maWxlbmFtZSA9IHByb3BzLmZpbGVuYW1lO1xuICAgIGVycm9yLmZyYW1lID0gZ2V0X2NvZGVfZnJhbWUocHJvcHMuc291cmNlLCBzdGFydC5saW5lIC0gMSwgc3RhcnQuY29sdW1uKTtcbiAgICB0aHJvdyBlcnJvcjtcbn1cblxuY2xhc3MgUGFyc2VyJDEge1xuICAgIGNvbnN0cnVjdG9yKHRlbXBsYXRlLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgICB0aGlzLnN0YWNrID0gW107XG4gICAgICAgIHRoaXMuY3NzID0gW107XG4gICAgICAgIHRoaXMuanMgPSBbXTtcbiAgICAgICAgdGhpcy5tZXRhX3RhZ3MgPSB7fTtcbiAgICAgICAgaWYgKHR5cGVvZiB0ZW1wbGF0ZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RlbXBsYXRlIG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgvXFxzKyQvLCAnJyk7XG4gICAgICAgIHRoaXMuZmlsZW5hbWUgPSBvcHRpb25zLmZpbGVuYW1lO1xuICAgICAgICB0aGlzLmN1c3RvbUVsZW1lbnQgPSBvcHRpb25zLmN1c3RvbUVsZW1lbnQ7XG4gICAgICAgIHRoaXMuaHRtbCA9IHtcbiAgICAgICAgICAgIHN0YXJ0OiBudWxsLFxuICAgICAgICAgICAgZW5kOiBudWxsLFxuICAgICAgICAgICAgdHlwZTogJ0ZyYWdtZW50JyxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBbXVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnN0YWNrLnB1c2godGhpcy5odG1sKTtcbiAgICAgICAgbGV0IHN0YXRlID0gZnJhZ21lbnQ7XG4gICAgICAgIHdoaWxlICh0aGlzLmluZGV4IDwgdGhpcy50ZW1wbGF0ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHN0YXRlID0gc3RhdGUodGhpcykgfHwgZnJhZ21lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuY3VycmVudCgpO1xuICAgICAgICAgICAgY29uc3QgdHlwZSA9IGN1cnJlbnQudHlwZSA9PT0gJ0VsZW1lbnQnID8gYDwke2N1cnJlbnQubmFtZX0+YCA6ICdCbG9jayc7XG4gICAgICAgICAgICBjb25zdCBzbHVnID0gY3VycmVudC50eXBlID09PSAnRWxlbWVudCcgPyAnZWxlbWVudCcgOiAnYmxvY2snO1xuICAgICAgICAgICAgdGhpcy5lcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogYHVuY2xvc2VkLSR7c2x1Z31gLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGAke3R5cGV9IHdhcyBsZWZ0IG9wZW5gXG4gICAgICAgICAgICB9LCBjdXJyZW50LnN0YXJ0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdGUgIT09IGZyYWdtZW50KSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiAndW5leHBlY3RlZC1lb2YnLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdVbmV4cGVjdGVkIGVuZCBvZiBpbnB1dCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmh0bWwuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICBsZXQgc3RhcnQgPSB0aGlzLmh0bWwuY2hpbGRyZW5bMF0uc3RhcnQ7XG4gICAgICAgICAgICB3aGlsZSAod2hpdGVzcGFjZS50ZXN0KHRlbXBsYXRlW3N0YXJ0XSkpXG4gICAgICAgICAgICAgICAgc3RhcnQgKz0gMTtcbiAgICAgICAgICAgIGxldCBlbmQgPSB0aGlzLmh0bWwuY2hpbGRyZW5bdGhpcy5odG1sLmNoaWxkcmVuLmxlbmd0aCAtIDFdLmVuZDtcbiAgICAgICAgICAgIHdoaWxlICh3aGl0ZXNwYWNlLnRlc3QodGVtcGxhdGVbZW5kIC0gMV0pKVxuICAgICAgICAgICAgICAgIGVuZCAtPSAxO1xuICAgICAgICAgICAgdGhpcy5odG1sLnN0YXJ0ID0gc3RhcnQ7XG4gICAgICAgICAgICB0aGlzLmh0bWwuZW5kID0gZW5kO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5odG1sLnN0YXJ0ID0gdGhpcy5odG1sLmVuZCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3VycmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXTtcbiAgICB9XG4gICAgYWNvcm5fZXJyb3IoZXJyKSB7XG4gICAgICAgIHRoaXMuZXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogJ3BhcnNlLWVycm9yJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlLnJlcGxhY2UoLyBcXChcXGQrOlxcZCtcXCkkLywgJycpXG4gICAgICAgIH0sIGVyci5wb3MpO1xuICAgIH1cbiAgICBlcnJvcih7IGNvZGUsIG1lc3NhZ2UgfSwgaW5kZXggPSB0aGlzLmluZGV4KSB7XG4gICAgICAgIGVycm9yKG1lc3NhZ2UsIHtcbiAgICAgICAgICAgIG5hbWU6ICdQYXJzZUVycm9yJyxcbiAgICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgICBzb3VyY2U6IHRoaXMudGVtcGxhdGUsXG4gICAgICAgICAgICBzdGFydDogaW5kZXgsXG4gICAgICAgICAgICBmaWxlbmFtZTogdGhpcy5maWxlbmFtZVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWF0KHN0ciwgcmVxdWlyZWQsIGVycm9yKSB7XG4gICAgICAgIGlmICh0aGlzLm1hdGNoKHN0cikpIHtcbiAgICAgICAgICAgIHRoaXMuaW5kZXggKz0gc3RyLmxlbmd0aDtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXF1aXJlZCkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcihlcnJvciB8fFxuICAgICAgICAgICAgICAgICh0aGlzLmluZGV4ID09PSB0aGlzLnRlbXBsYXRlLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICA/IHBhcnNlcl9lcnJvcnMudW5leHBlY3RlZF9lb2ZfdG9rZW4oc3RyKVxuICAgICAgICAgICAgICAgICAgICA6IHBhcnNlcl9lcnJvcnMudW5leHBlY3RlZF90b2tlbihzdHIpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBtYXRjaChzdHIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGVtcGxhdGUuc2xpY2UodGhpcy5pbmRleCwgdGhpcy5pbmRleCArIHN0ci5sZW5ndGgpID09PSBzdHI7XG4gICAgfVxuICAgIG1hdGNoX3JlZ2V4KHBhdHRlcm4pIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWModGhpcy50ZW1wbGF0ZS5zbGljZSh0aGlzLmluZGV4KSk7XG4gICAgICAgIGlmICghbWF0Y2ggfHwgbWF0Y2guaW5kZXggIT09IDApXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIG1hdGNoWzBdO1xuICAgIH1cbiAgICBhbGxvd193aGl0ZXNwYWNlKCkge1xuICAgICAgICB3aGlsZSAodGhpcy5pbmRleCA8IHRoaXMudGVtcGxhdGUubGVuZ3RoICYmXG4gICAgICAgICAgICB3aGl0ZXNwYWNlLnRlc3QodGhpcy50ZW1wbGF0ZVt0aGlzLmluZGV4XSkpIHtcbiAgICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZWFkKHBhdHRlcm4pIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5tYXRjaF9yZWdleChwYXR0ZXJuKTtcbiAgICAgICAgaWYgKHJlc3VsdClcbiAgICAgICAgICAgIHRoaXMuaW5kZXggKz0gcmVzdWx0Lmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgcmVhZF9pZGVudGlmaWVyKGFsbG93X3Jlc2VydmVkID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLmluZGV4O1xuICAgICAgICBsZXQgaSA9IHRoaXMuaW5kZXg7XG4gICAgICAgIGNvbnN0IGNvZGUgPSBmdWxsX2NoYXJfY29kZV9hdCh0aGlzLnRlbXBsYXRlLCBpKTtcbiAgICAgICAgaWYgKCFpc0lkZW50aWZpZXJTdGFydChjb2RlLCB0cnVlKSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpICs9IGNvZGUgPD0gMHhmZmZmID8gMSA6IDI7XG4gICAgICAgIHdoaWxlIChpIDwgdGhpcy50ZW1wbGF0ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSBmdWxsX2NoYXJfY29kZV9hdCh0aGlzLnRlbXBsYXRlLCBpKTtcbiAgICAgICAgICAgIGlmICghaXNJZGVudGlmaWVyQ2hhcihjb2RlLCB0cnVlKSlcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGkgKz0gY29kZSA8PSAweGZmZmYgPyAxIDogMjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpZGVudGlmaWVyID0gdGhpcy50ZW1wbGF0ZS5zbGljZSh0aGlzLmluZGV4LCB0aGlzLmluZGV4ID0gaSk7XG4gICAgICAgIGlmICghYWxsb3dfcmVzZXJ2ZWQgJiYgcmVzZXJ2ZWQuaGFzKGlkZW50aWZpZXIpKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiAndW5leHBlY3RlZC1yZXNlcnZlZC13b3JkJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBgJyR7aWRlbnRpZmllcn0nIGlzIGEgcmVzZXJ2ZWQgd29yZCBpbiBKYXZhU2NyaXB0IGFuZCBjYW5ub3QgYmUgdXNlZCBoZXJlYFxuICAgICAgICAgICAgfSwgc3RhcnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpZGVudGlmaWVyO1xuICAgIH1cbiAgICByZWFkX3VudGlsKHBhdHRlcm4sIGVycm9yX21lc3NhZ2UpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5kZXggPj0gdGhpcy50ZW1wbGF0ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoZXJyb3JfbWVzc2FnZSB8fCB7XG4gICAgICAgICAgICAgICAgY29kZTogJ3VuZXhwZWN0ZWQtZW9mJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVW5leHBlY3RlZCBlbmQgb2YgaW5wdXQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdGFydCA9IHRoaXMuaW5kZXg7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gcGF0dGVybi5leGVjKHRoaXMudGVtcGxhdGUuc2xpY2Uoc3RhcnQpKTtcbiAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICB0aGlzLmluZGV4ID0gc3RhcnQgKyBtYXRjaC5pbmRleDtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRlbXBsYXRlLnNsaWNlKHN0YXJ0LCB0aGlzLmluZGV4KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluZGV4ID0gdGhpcy50ZW1wbGF0ZS5sZW5ndGg7XG4gICAgICAgIHJldHVybiB0aGlzLnRlbXBsYXRlLnNsaWNlKHN0YXJ0KTtcbiAgICB9XG4gICAgcmVxdWlyZV93aGl0ZXNwYWNlKCkge1xuICAgICAgICBpZiAoIXdoaXRlc3BhY2UudGVzdCh0aGlzLnRlbXBsYXRlW3RoaXMuaW5kZXhdKSkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogJ21pc3Npbmctd2hpdGVzcGFjZScsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0V4cGVjdGVkIHdoaXRlc3BhY2UnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFsbG93X3doaXRlc3BhY2UoKTtcbiAgICB9XG59XG5mdW5jdGlvbiBwYXJzZSQzKHRlbXBsYXRlLCBvcHRpb25zID0ge30pIHtcbiAgICBjb25zdCBwYXJzZXIgPSBuZXcgUGFyc2VyJDEodGVtcGxhdGUsIG9wdGlvbnMpO1xuICAgIC8vIFRPRE8gd2UgbWF5IHdhbnQgdG8gYWxsb3cgbXVsdGlwbGUgPHN0eWxlPiB0YWdzIOKAlFxuICAgIC8vIG9uZSBzY29wZWQsIG9uZSBnbG9iYWwuIGZvciBub3csIG9ubHkgYWxsb3cgb25lXG4gICAgaWYgKHBhcnNlci5jc3MubGVuZ3RoID4gMSkge1xuICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5kdXBsaWNhdGVfc3R5bGUsIHBhcnNlci5jc3NbMV0uc3RhcnQpO1xuICAgIH1cbiAgICBjb25zdCBpbnN0YW5jZV9zY3JpcHRzID0gcGFyc2VyLmpzLmZpbHRlcihzY3JpcHQgPT4gc2NyaXB0LmNvbnRleHQgPT09ICdkZWZhdWx0Jyk7XG4gICAgY29uc3QgbW9kdWxlX3NjcmlwdHMgPSBwYXJzZXIuanMuZmlsdGVyKHNjcmlwdCA9PiBzY3JpcHQuY29udGV4dCA9PT0gJ21vZHVsZScpO1xuICAgIGlmIChpbnN0YW5jZV9zY3JpcHRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgcGFyc2VyLmVycm9yKHBhcnNlcl9lcnJvcnMuaW52YWxpZF9zY3JpcHRfaW5zdGFuY2UsIGluc3RhbmNlX3NjcmlwdHNbMV0uc3RhcnQpO1xuICAgIH1cbiAgICBpZiAobW9kdWxlX3NjcmlwdHMubGVuZ3RoID4gMSkge1xuICAgICAgICBwYXJzZXIuZXJyb3IocGFyc2VyX2Vycm9ycy5pbnZhbGlkX3NjcmlwdF9tb2R1bGUsIG1vZHVsZV9zY3JpcHRzWzFdLnN0YXJ0KTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaHRtbDogcGFyc2VyLmh0bWwsXG4gICAgICAgIGNzczogcGFyc2VyLmNzc1swXSxcbiAgICAgICAgaW5zdGFuY2U6IGluc3RhbmNlX3NjcmlwdHNbMF0sXG4gICAgICAgIG1vZHVsZTogbW9kdWxlX3NjcmlwdHNbMF1cbiAgICB9O1xufVxuXG5mdW5jdGlvbiBpc19oZWFkKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZSAmJiBub2RlLnR5cGUgPT09ICdNZW1iZXJFeHByZXNzaW9uJyAmJiBub2RlLm9iamVjdC5uYW1lID09PSAnQF9kb2N1bWVudCcgJiYgbm9kZS5wcm9wZXJ0eS5uYW1lID09PSAnaGVhZCc7XG59XG5cbmNsYXNzIEJsb2NrJDEge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMuYmluZGluZ19ncm91cF9pbml0aWFsaXNlZCA9IG5ldyBTZXQoKTtcbiAgICAgICAgdGhpcy5ldmVudF9saXN0ZW5lcnMgPSBbXTtcbiAgICAgICAgdGhpcy52YXJpYWJsZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuaGFzX3VwZGF0ZV9tZXRob2QgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wYXJlbnQgPSBvcHRpb25zLnBhcmVudDtcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IG9wdGlvbnMucmVuZGVyZXI7XG4gICAgICAgIHRoaXMubmFtZSA9IG9wdGlvbnMubmFtZTtcbiAgICAgICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlO1xuICAgICAgICB0aGlzLmNvbW1lbnQgPSBvcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgIHRoaXMud3JhcHBlcnMgPSBbXTtcbiAgICAgICAgLy8gZm9yIGtleWVkIGVhY2ggYmxvY2tzXG4gICAgICAgIHRoaXMua2V5ID0gb3B0aW9ucy5rZXk7XG4gICAgICAgIHRoaXMuZmlyc3QgPSBudWxsO1xuICAgICAgICB0aGlzLmJpbmRpbmdzID0gb3B0aW9ucy5iaW5kaW5ncztcbiAgICAgICAgdGhpcy5jaHVua3MgPSB7XG4gICAgICAgICAgICBkZWNsYXJhdGlvbnM6IFtdLFxuICAgICAgICAgICAgaW5pdDogW10sXG4gICAgICAgICAgICBjcmVhdGU6IFtdLFxuICAgICAgICAgICAgY2xhaW06IFtdLFxuICAgICAgICAgICAgaHlkcmF0ZTogW10sXG4gICAgICAgICAgICBtb3VudDogW10sXG4gICAgICAgICAgICBtZWFzdXJlOiBbXSxcbiAgICAgICAgICAgIGZpeDogW10sXG4gICAgICAgICAgICBhbmltYXRlOiBbXSxcbiAgICAgICAgICAgIGludHJvOiBbXSxcbiAgICAgICAgICAgIHVwZGF0ZTogW10sXG4gICAgICAgICAgICBvdXRybzogW10sXG4gICAgICAgICAgICBkZXN0cm95OiBbXVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhc19hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oYXNfaW50cm9fbWV0aG9kID0gZmFsc2U7IC8vIGEgYmxvY2sgY291bGQgaGF2ZSBhbiBpbnRybyBtZXRob2QgYnV0IG5vdCBpbnRybyB0cmFuc2l0aW9ucywgZS5nLiBpZiBhIHNpYmxpbmcgYmxvY2sgaGFzIGludHJvc1xuICAgICAgICB0aGlzLmhhc19vdXRyb19tZXRob2QgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vdXRyb3MgPSAwO1xuICAgICAgICB0aGlzLmdldF91bmlxdWVfbmFtZSA9IHRoaXMucmVuZGVyZXIuY29tcG9uZW50LmdldF91bmlxdWVfbmFtZV9tYWtlcigpO1xuICAgICAgICB0aGlzLmFsaWFzZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGlmICh0aGlzLmtleSlcbiAgICAgICAgICAgIHRoaXMuYWxpYXNlcy5zZXQoJ2tleScsIHRoaXMuZ2V0X3VuaXF1ZV9uYW1lKCdrZXknKSk7XG4gICAgfVxuICAgIGFzc2lnbl92YXJpYWJsZV9uYW1lcygpIHtcbiAgICAgICAgY29uc3Qgc2VlbiA9IG5ldyBTZXQoKTtcbiAgICAgICAgY29uc3QgZHVwZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIGxldCBpID0gdGhpcy53cmFwcGVycy5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IHdyYXBwZXIgPSB0aGlzLndyYXBwZXJzW2ldO1xuICAgICAgICAgICAgaWYgKCF3cmFwcGVyLnZhcilcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIGlmIChzZWVuLmhhcyh3cmFwcGVyLnZhci5uYW1lKSkge1xuICAgICAgICAgICAgICAgIGR1cGVzLmFkZCh3cmFwcGVyLnZhci5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlZW4uYWRkKHdyYXBwZXIudmFyLm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvdW50cyA9IG5ldyBNYXAoKTtcbiAgICAgICAgaSA9IHRoaXMud3JhcHBlcnMubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gdGhpcy53cmFwcGVyc1tpXTtcbiAgICAgICAgICAgIGlmICghd3JhcHBlci52YXIpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBsZXQgc3VmZml4ID0gJyc7XG4gICAgICAgICAgICBpZiAoZHVwZXMuaGFzKHdyYXBwZXIudmFyLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IGNvdW50cy5nZXQod3JhcHBlci52YXIubmFtZSkgfHwgMDtcbiAgICAgICAgICAgICAgICBjb3VudHMuc2V0KHdyYXBwZXIudmFyLm5hbWUsIGkgKyAxKTtcbiAgICAgICAgICAgICAgICBzdWZmaXggPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd3JhcHBlci52YXIubmFtZSA9IHRoaXMuZ2V0X3VuaXF1ZV9uYW1lKHdyYXBwZXIudmFyLm5hbWUgKyBzdWZmaXgpLm5hbWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWRkX2RlcGVuZGVuY2llcyhkZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgZGVwZW5kZW5jaWVzLmZvckVhY2goZGVwZW5kZW5jeSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRlcGVuZGVuY2llcy5hZGQoZGVwZW5kZW5jeSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmhhc191cGRhdGVfbWV0aG9kID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMucGFyZW50KSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudC5hZGRfZGVwZW5kZW5jaWVzKGRlcGVuZGVuY2llcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWRkX2VsZW1lbnQoaWQsIHJlbmRlcl9zdGF0ZW1lbnQsIGNsYWltX3N0YXRlbWVudCwgcGFyZW50X25vZGUsIG5vX2RldGFjaCkge1xuICAgICAgICB0aGlzLmFkZF92YXJpYWJsZShpZCk7XG4gICAgICAgIHRoaXMuY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYCR7aWR9ID0gJHtyZW5kZXJfc3RhdGVtZW50fTtgKTtcbiAgICAgICAgaWYgKHRoaXMucmVuZGVyZXIub3B0aW9ucy5oeWRyYXRhYmxlKSB7XG4gICAgICAgICAgICB0aGlzLmNodW5rcy5jbGFpbS5wdXNoKGIgYCR7aWR9ID0gJHtjbGFpbV9zdGF0ZW1lbnQgfHwgcmVuZGVyX3N0YXRlbWVudH07YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcmVudF9ub2RlKSB7XG4gICAgICAgICAgICB0aGlzLmNodW5rcy5tb3VudC5wdXNoKGIgYEBhcHBlbmQoJHtwYXJlbnRfbm9kZX0sICR7aWR9KTtgKTtcbiAgICAgICAgICAgIGlmIChpc19oZWFkKHBhcmVudF9ub2RlKSAmJiAhbm9fZGV0YWNoKVxuICAgICAgICAgICAgICAgIHRoaXMuY2h1bmtzLmRlc3Ryb3kucHVzaChiIGBAZGV0YWNoKCR7aWR9KTtgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2h1bmtzLm1vdW50LnB1c2goYiBgQGluc2VydCgjdGFyZ2V0LCAke2lkfSwgI2FuY2hvcik7YCk7XG4gICAgICAgICAgICBpZiAoIW5vX2RldGFjaClcbiAgICAgICAgICAgICAgICB0aGlzLmNodW5rcy5kZXN0cm95LnB1c2goYiBgaWYgKGRldGFjaGluZykgQGRldGFjaCgke2lkfSk7YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWRkX2ludHJvKGxvY2FsKSB7XG4gICAgICAgIHRoaXMuaGFzX2ludHJvcyA9IHRoaXMuaGFzX2ludHJvX21ldGhvZCA9IHRydWU7XG4gICAgICAgIGlmICghbG9jYWwgJiYgdGhpcy5wYXJlbnQpXG4gICAgICAgICAgICB0aGlzLnBhcmVudC5hZGRfaW50cm8oKTtcbiAgICB9XG4gICAgYWRkX291dHJvKGxvY2FsKSB7XG4gICAgICAgIHRoaXMuaGFzX291dHJvcyA9IHRoaXMuaGFzX291dHJvX21ldGhvZCA9IHRydWU7XG4gICAgICAgIHRoaXMub3V0cm9zICs9IDE7XG4gICAgICAgIGlmICghbG9jYWwgJiYgdGhpcy5wYXJlbnQpXG4gICAgICAgICAgICB0aGlzLnBhcmVudC5hZGRfb3V0cm8oKTtcbiAgICB9XG4gICAgYWRkX2FuaW1hdGlvbigpIHtcbiAgICAgICAgdGhpcy5oYXNfYW5pbWF0aW9uID0gdHJ1ZTtcbiAgICB9XG4gICAgYWRkX3ZhcmlhYmxlKGlkLCBpbml0KSB7XG4gICAgICAgIGlmICh0aGlzLnZhcmlhYmxlcy5oYXMoaWQubmFtZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVmFyaWFibGUgJyR7aWQubmFtZX0nIGFscmVhZHkgaW5pdGlhbGlzZWQgd2l0aCBhIGRpZmZlcmVudCB2YWx1ZWApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudmFyaWFibGVzLnNldChpZC5uYW1lLCB7IGlkLCBpbml0IH0pO1xuICAgIH1cbiAgICBhbGlhcyhuYW1lKSB7XG4gICAgICAgIGlmICghdGhpcy5hbGlhc2VzLmhhcyhuYW1lKSkge1xuICAgICAgICAgICAgdGhpcy5hbGlhc2VzLnNldChuYW1lLCB0aGlzLmdldF91bmlxdWVfbmFtZShuYW1lKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuYWxpYXNlcy5nZXQobmFtZSk7XG4gICAgfVxuICAgIGNoaWxkKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCbG9jayQxKE9iamVjdC5hc3NpZ24oe30sIHRoaXMsIHsga2V5OiBudWxsIH0sIG9wdGlvbnMsIHsgcGFyZW50OiB0aGlzIH0pKTtcbiAgICB9XG4gICAgZ2V0X2NvbnRlbnRzKGtleSkge1xuICAgICAgICBjb25zdCB7IGRldiB9ID0gdGhpcy5yZW5kZXJlci5vcHRpb25zO1xuICAgICAgICBpZiAodGhpcy5oYXNfb3V0cm9zKSB7XG4gICAgICAgICAgICB0aGlzLmFkZF92YXJpYWJsZSh7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogJyNjdXJyZW50JyB9KTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNodW5rcy5pbnRyby5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaHVua3MuaW50cm8ucHVzaChiIGAjY3VycmVudCA9IHRydWU7YCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaHVua3MubW91bnQucHVzaChiIGAjY3VycmVudCA9IHRydWU7YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5jaHVua3Mub3V0cm8ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2h1bmtzLm91dHJvLnB1c2goYiBgI2N1cnJlbnQgPSBmYWxzZTtgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5hdXRvZm9jdXMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmF1dG9mb2N1cy5jb25kaXRpb25fZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2h1bmtzLm1vdW50LnB1c2goYiBgaWYgKCR7dGhpcy5hdXRvZm9jdXMuY29uZGl0aW9uX2V4cHJlc3Npb259KSAke3RoaXMuYXV0b2ZvY3VzLmVsZW1lbnRfdmFyfS5mb2N1cygpO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaHVua3MubW91bnQucHVzaChiIGAke3RoaXMuYXV0b2ZvY3VzLmVsZW1lbnRfdmFyfS5mb2N1cygpO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVuZGVyX2xpc3RlbmVycygpO1xuICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0ge307XG4gICAgICAgIGNvbnN0IG5vb3AgPSB4IGBAbm9vcGA7XG4gICAgICAgIHByb3BlcnRpZXMua2V5ID0ga2V5O1xuICAgICAgICBpZiAodGhpcy5maXJzdCkge1xuICAgICAgICAgICAgcHJvcGVydGllcy5maXJzdCA9IHggYG51bGxgO1xuICAgICAgICAgICAgdGhpcy5jaHVua3MuaHlkcmF0ZS5wdXNoKGIgYHRoaXMuZmlyc3QgPSAke3RoaXMuZmlyc3R9O2ApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNodW5rcy5jcmVhdGUubGVuZ3RoID09PSAwICYmIHRoaXMuY2h1bmtzLmh5ZHJhdGUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLmNyZWF0ZSA9IG5vb3A7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBoeWRyYXRlID0gdGhpcy5jaHVua3MuaHlkcmF0ZS5sZW5ndGggPiAwICYmICh0aGlzLnJlbmRlcmVyLm9wdGlvbnMuaHlkcmF0YWJsZVxuICAgICAgICAgICAgICAgID8gYiBgdGhpcy5oKCk7YFxuICAgICAgICAgICAgICAgIDogdGhpcy5jaHVua3MuaHlkcmF0ZSk7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLmNyZWF0ZSA9IHggYGZ1bmN0aW9uICNjcmVhdGUoKSB7XG5cdFx0XHRcdCR7dGhpcy5jaHVua3MuY3JlYXRlfVxuXHRcdFx0XHQke2h5ZHJhdGV9XG5cdFx0XHR9YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5yZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUgfHwgdGhpcy5jaHVua3MuY2xhaW0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2h1bmtzLmNsYWltLmxlbmd0aCA9PT0gMCAmJiB0aGlzLmNodW5rcy5oeWRyYXRlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMuY2xhaW0gPSBub29wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcHJvcGVydGllcy5jbGFpbSA9IHggYGZ1bmN0aW9uICNjbGFpbSgjbm9kZXMpIHtcblx0XHRcdFx0XHQke3RoaXMuY2h1bmtzLmNsYWltfVxuXHRcdFx0XHRcdCR7dGhpcy5yZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUgJiYgdGhpcy5jaHVua3MuaHlkcmF0ZS5sZW5ndGggPiAwICYmIGIgYHRoaXMuaCgpO2B9XG5cdFx0XHRcdH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmVyLm9wdGlvbnMuaHlkcmF0YWJsZSAmJiB0aGlzLmNodW5rcy5oeWRyYXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHByb3BlcnRpZXMuaHlkcmF0ZSA9IHggYGZ1bmN0aW9uICNoeWRyYXRlKCkge1xuXHRcdFx0XHQke3RoaXMuY2h1bmtzLmh5ZHJhdGV9XG5cdFx0XHR9YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jaHVua3MubW91bnQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLm1vdW50ID0gbm9vcDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmV2ZW50X2xpc3RlbmVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHByb3BlcnRpZXMubW91bnQgPSB4IGBmdW5jdGlvbiAjbW91bnQoI3RhcmdldCwgI2FuY2hvcikge1xuXHRcdFx0XHQke3RoaXMuY2h1bmtzLm1vdW50fVxuXHRcdFx0fWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLm1vdW50ID0geCBgZnVuY3Rpb24gI21vdW50KCN0YXJnZXQsICNhbmNob3IpIHtcblx0XHRcdFx0JHt0aGlzLmNodW5rcy5tb3VudH1cblx0XHRcdH1gO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmhhc191cGRhdGVfbWV0aG9kIHx8IHRoaXMubWFpbnRhaW5fY29udGV4dCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2h1bmtzLnVwZGF0ZS5sZW5ndGggPT09IDAgJiYgIXRoaXMubWFpbnRhaW5fY29udGV4dCkge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMudXBkYXRlID0gbm9vcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IHRoaXMubWFpbnRhaW5fY29udGV4dCA/IHggYCNuZXdfY3R4YCA6IHggYCNjdHhgO1xuICAgICAgICAgICAgICAgIGxldCBkaXJ0eSA9IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiAnI2RpcnR5JyB9O1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZW5kZXJlci5jb250ZXh0X292ZXJmbG93ICYmICF0aGlzLnBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICBkaXJ0eSA9IHsgdHlwZTogJ0FycmF5UGF0dGVybicsIGVsZW1lbnRzOiBbZGlydHldIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMudXBkYXRlID0geCBgZnVuY3Rpb24gI3VwZGF0ZSgke2N0eH0sICR7ZGlydHl9KSB7XG5cdFx0XHRcdFx0JHt0aGlzLm1haW50YWluX2NvbnRleHQgJiYgYiBgI2N0eCA9ICR7Y3R4fTtgfVxuXHRcdFx0XHRcdCR7dGhpcy5jaHVua3MudXBkYXRlfVxuXHRcdFx0XHR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5oYXNfYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLm1lYXN1cmUgPSB4IGBmdW5jdGlvbiAjbWVhc3VyZSgpIHtcblx0XHRcdFx0JHt0aGlzLmNodW5rcy5tZWFzdXJlfVxuXHRcdFx0fWA7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLmZpeCA9IHggYGZ1bmN0aW9uICNmaXgoKSB7XG5cdFx0XHRcdCR7dGhpcy5jaHVua3MuZml4fVxuXHRcdFx0fWA7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLmFuaW1hdGUgPSB4IGBmdW5jdGlvbiAjYW5pbWF0ZSgpIHtcblx0XHRcdFx0JHt0aGlzLmNodW5rcy5hbmltYXRlfVxuXHRcdFx0fWA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaGFzX2ludHJvX21ldGhvZCB8fCB0aGlzLmhhc19vdXRyb19tZXRob2QpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNodW5rcy5pbnRyby5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLmludHJvID0gbm9vcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMuaW50cm8gPSB4IGBmdW5jdGlvbiAjaW50cm8oI2xvY2FsKSB7XG5cdFx0XHRcdFx0JHt0aGlzLmhhc19vdXRyb3MgJiYgYiBgaWYgKCNjdXJyZW50KSByZXR1cm47YH1cblx0XHRcdFx0XHQke3RoaXMuY2h1bmtzLmludHJvfVxuXHRcdFx0XHR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNodW5rcy5vdXRyby5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm91dHJvID0gbm9vcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMub3V0cm8gPSB4IGBmdW5jdGlvbiAjb3V0cm8oI2xvY2FsKSB7XG5cdFx0XHRcdFx0JHt0aGlzLmNodW5rcy5vdXRyb31cblx0XHRcdFx0fWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2h1bmtzLmRlc3Ryb3kubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLmRlc3Ryb3kgPSBub29wO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcHJvcGVydGllcy5kZXN0cm95ID0geCBgZnVuY3Rpb24gI2Rlc3Ryb3koZGV0YWNoaW5nKSB7XG5cdFx0XHRcdCR7dGhpcy5jaHVua3MuZGVzdHJveX1cblx0XHRcdH1gO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5yZW5kZXJlci5jb21wb25lbnQuY29tcGlsZV9vcHRpb25zLmRldikge1xuICAgICAgICAgICAgLy8gYWxsb3cgc2hvcnRoYW5kIG5hbWVzXG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gcHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5ID0gcHJvcGVydGllc1tuYW1lXTtcbiAgICAgICAgICAgICAgICBpZiAocHJvcGVydHkpXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5LmlkID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXR1cm5fdmFsdWUgPSB4IGB7XG5cdFx0XHRrZXk6ICR7cHJvcGVydGllcy5rZXl9LFxuXHRcdFx0Zmlyc3Q6ICR7cHJvcGVydGllcy5maXJzdH0sXG5cdFx0XHRjOiAke3Byb3BlcnRpZXMuY3JlYXRlfSxcblx0XHRcdGw6ICR7cHJvcGVydGllcy5jbGFpbX0sXG5cdFx0XHRoOiAke3Byb3BlcnRpZXMuaHlkcmF0ZX0sXG5cdFx0XHRtOiAke3Byb3BlcnRpZXMubW91bnR9LFxuXHRcdFx0cDogJHtwcm9wZXJ0aWVzLnVwZGF0ZX0sXG5cdFx0XHRyOiAke3Byb3BlcnRpZXMubWVhc3VyZX0sXG5cdFx0XHRmOiAke3Byb3BlcnRpZXMuZml4fSxcblx0XHRcdGE6ICR7cHJvcGVydGllcy5hbmltYXRlfSxcblx0XHRcdGk6ICR7cHJvcGVydGllcy5pbnRyb30sXG5cdFx0XHRvOiAke3Byb3BlcnRpZXMub3V0cm99LFxuXHRcdFx0ZDogJHtwcm9wZXJ0aWVzLmRlc3Ryb3l9XG5cdFx0fWA7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gZGV2ICYmIHRoaXMuZ2V0X3VuaXF1ZV9uYW1lKCdibG9jaycpO1xuICAgICAgICBjb25zdCBib2R5ID0gYiBgXG5cdFx0XHQke3RoaXMuY2h1bmtzLmRlY2xhcmF0aW9uc31cblxuXHRcdFx0JHtBcnJheS5mcm9tKHRoaXMudmFyaWFibGVzLnZhbHVlcygpKS5tYXAoKHsgaWQsIGluaXQgfSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGluaXRcbiAgICAgICAgICAgICAgICA/IGIgYGxldCAke2lkfSA9ICR7aW5pdH1gXG4gICAgICAgICAgICAgICAgOiBiIGBsZXQgJHtpZH1gO1xuICAgICAgICB9KX1cblxuXHRcdFx0JHt0aGlzLmNodW5rcy5pbml0fVxuXG5cdFx0XHQke2RldlxuICAgICAgICAgICAgPyBiIGBcblx0XHRcdFx0XHRjb25zdCAke2Jsb2NrfSA9ICR7cmV0dXJuX3ZhbHVlfTtcblx0XHRcdFx0XHRAZGlzcGF0Y2hfZGV2KFwiU3ZlbHRlUmVnaXN0ZXJCbG9ja1wiLCB7XG5cdFx0XHRcdFx0XHRibG9jazogJHtibG9ja30sXG5cdFx0XHRcdFx0XHRpZDogJHt0aGlzLm5hbWUgfHwgJ2NyZWF0ZV9mcmFnbWVudCd9Lm5hbWUsXG5cdFx0XHRcdFx0XHR0eXBlOiBcIiR7dGhpcy50eXBlfVwiLFxuXHRcdFx0XHRcdFx0c291cmNlOiBcIiR7dGhpcy5jb21tZW50ID8gdGhpcy5jb21tZW50LnJlcGxhY2UoL1wiL2csICdcXFxcXCInKSA6ICcnfVwiLFxuXHRcdFx0XHRcdFx0Y3R4OiAjY3R4XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0cmV0dXJuICR7YmxvY2t9O2BcbiAgICAgICAgICAgIDogYiBgXG5cdFx0XHRcdFx0cmV0dXJuICR7cmV0dXJuX3ZhbHVlfTtgfVxuXHRcdGA7XG4gICAgICAgIHJldHVybiBib2R5O1xuICAgIH1cbiAgICBoYXNfY29udGVudCgpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5maXJzdCB8fFxuICAgICAgICAgICAgdGhpcy5ldmVudF9saXN0ZW5lcnMubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5jaHVua3MuaW50cm8ubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5jaHVua3Mub3V0cm8ubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5jaHVua3MuY3JlYXRlLmxlbmd0aCA+IDAgfHxcbiAgICAgICAgICAgIHRoaXMuY2h1bmtzLmh5ZHJhdGUubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5jaHVua3MuY2xhaW0ubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5jaHVua3MubW91bnQubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5jaHVua3MudXBkYXRlLmxlbmd0aCA+IDAgfHxcbiAgICAgICAgICAgIHRoaXMuY2h1bmtzLmRlc3Ryb3kubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5oYXNfYW5pbWF0aW9uO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMua2V5ICYmIHRoaXMuZ2V0X3VuaXF1ZV9uYW1lKCdrZXknKTtcbiAgICAgICAgY29uc3QgYXJncyA9IFt4IGAjY3R4YF07XG4gICAgICAgIGlmIChrZXkpXG4gICAgICAgICAgICBhcmdzLnVuc2hpZnQoa2V5KTtcbiAgICAgICAgY29uc3QgZm4gPSBiIGBmdW5jdGlvbiAke3RoaXMubmFtZX0oJHthcmdzfSkge1xuXHRcdFx0JHt0aGlzLmdldF9jb250ZW50cyhrZXkpfVxuXHRcdH1gO1xuICAgICAgICByZXR1cm4gdGhpcy5jb21tZW50XG4gICAgICAgICAgICA/IGIgYFxuXHRcdFx0XHQvLyAke3RoaXMuY29tbWVudH1cblx0XHRcdFx0JHtmbn1gXG4gICAgICAgICAgICA6IGZuO1xuICAgIH1cbiAgICByZW5kZXJfbGlzdGVuZXJzKGNodW5rID0gJycpIHtcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRfbGlzdGVuZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuYWRkX3ZhcmlhYmxlKHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiAnI21vdW50ZWQnIH0pO1xuICAgICAgICAgICAgdGhpcy5jaHVua3MuZGVzdHJveS5wdXNoKGIgYCNtb3VudGVkID0gZmFsc2VgKTtcbiAgICAgICAgICAgIGNvbnN0IGRpc3Bvc2UgPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLFxuICAgICAgICAgICAgICAgIG5hbWU6IGAjZGlzcG9zZSR7Y2h1bmt9YFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuYWRkX3ZhcmlhYmxlKGRpc3Bvc2UpO1xuICAgICAgICAgICAgaWYgKHRoaXMuZXZlbnRfbGlzdGVuZXJzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2h1bmtzLm1vdW50LnB1c2goYiBgXG5cdFx0XHRcdFx0XHRpZiAoISNtb3VudGVkKSB7XG5cdFx0XHRcdFx0XHRcdCR7ZGlzcG9zZX0gPSAke3RoaXMuZXZlbnRfbGlzdGVuZXJzWzBdfTtcblx0XHRcdFx0XHRcdFx0I21vdW50ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIHRoaXMuY2h1bmtzLmRlc3Ryb3kucHVzaChiIGAke2Rpc3Bvc2V9KCk7YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNodW5rcy5tb3VudC5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICghI21vdW50ZWQpIHtcblx0XHRcdFx0XHRcdCR7ZGlzcG9zZX0gPSBbXG5cdFx0XHRcdFx0XHRcdCR7dGhpcy5ldmVudF9saXN0ZW5lcnN9XG5cdFx0XHRcdFx0XHRdO1xuXHRcdFx0XHRcdFx0I21vdW50ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0YCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaHVua3MuZGVzdHJveS5wdXNoKGIgYEBydW5fYWxsKCR7ZGlzcG9zZX0pO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5jbGFzcyBXcmFwcGVyIHtcbiAgICBjb25zdHJ1Y3RvcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSkge1xuICAgICAgICB0aGlzLm5vZGUgPSBub2RlO1xuICAgICAgICAvLyBtYWtlIHRoZXNlIG5vbi1lbnVtZXJhYmxlIHNvIHRoYXQgdGhleSBjYW4gYmUgbG9nZ2VkIHNlbnNpYmx5XG4gICAgICAgIC8vIChUT0RPIGluIGRldiBvbmx5PylcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywge1xuICAgICAgICAgICAgcmVuZGVyZXI6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogcmVuZGVyZXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXJlbnQ6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogcGFyZW50XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNhbl91c2VfaW5uZXJodG1sID0gIXJlbmRlcmVyLm9wdGlvbnMuaHlkcmF0YWJsZTtcbiAgICAgICAgdGhpcy5pc19zdGF0aWNfY29udGVudCA9ICFyZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGU7XG4gICAgICAgIGJsb2NrLndyYXBwZXJzLnB1c2godGhpcyk7XG4gICAgfVxuICAgIGNhbm5vdF91c2VfaW5uZXJodG1sKCkge1xuICAgICAgICB0aGlzLmNhbl91c2VfaW5uZXJodG1sID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudClcbiAgICAgICAgICAgIHRoaXMucGFyZW50LmNhbm5vdF91c2VfaW5uZXJodG1sKCk7XG4gICAgfVxuICAgIG5vdF9zdGF0aWNfY29udGVudCgpIHtcbiAgICAgICAgdGhpcy5pc19zdGF0aWNfY29udGVudCA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5wYXJlbnQpXG4gICAgICAgICAgICB0aGlzLnBhcmVudC5ub3Rfc3RhdGljX2NvbnRlbnQoKTtcbiAgICB9XG4gICAgZ2V0X29yX2NyZWF0ZV9hbmNob3IoYmxvY2ssIHBhcmVudF9ub2RlLCBwYXJlbnRfbm9kZXMpIHtcbiAgICAgICAgLy8gVE9ETyB1c2UgdGhpcyBpbiBFYWNoQmxvY2sgYW5kIElmQmxvY2sg4oCUIHRyaWNreSBiZWNhdXNlXG4gICAgICAgIC8vIGNoaWxkcmVuIG5lZWQgdG8gYmUgY3JlYXRlZCBmaXJzdFxuICAgICAgICBjb25zdCBuZWVkc19hbmNob3IgPSB0aGlzLm5leHQgPyAhdGhpcy5uZXh0LmlzX2RvbV9ub2RlKCkgOiAhcGFyZW50X25vZGUgfHwgIXRoaXMucGFyZW50LmlzX2RvbV9ub2RlKCk7XG4gICAgICAgIGNvbnN0IGFuY2hvciA9IG5lZWRzX2FuY2hvclxuICAgICAgICAgICAgPyBibG9jay5nZXRfdW5pcXVlX25hbWUoYCR7dGhpcy52YXIubmFtZX1fYW5jaG9yYClcbiAgICAgICAgICAgIDogKHRoaXMubmV4dCAmJiB0aGlzLm5leHQudmFyKSB8fCB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogJ251bGwnIH07XG4gICAgICAgIGlmIChuZWVkc19hbmNob3IpIHtcbiAgICAgICAgICAgIGJsb2NrLmFkZF9lbGVtZW50KGFuY2hvciwgeCBgQGVtcHR5KClgLCBwYXJlbnRfbm9kZXMgJiYgeCBgQGVtcHR5KClgLCBwYXJlbnRfbm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFuY2hvcjtcbiAgICB9XG4gICAgZ2V0X3VwZGF0ZV9tb3VudF9ub2RlKGFuY2hvcikge1xuICAgICAgICByZXR1cm4gKCh0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5pc19kb21fbm9kZSgpKVxuICAgICAgICAgICAgPyB0aGlzLnBhcmVudC52YXJcbiAgICAgICAgICAgIDogeCBgJHthbmNob3J9LnBhcmVudE5vZGVgKTtcbiAgICB9XG4gICAgaXNfZG9tX25vZGUoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5ub2RlLnR5cGUgPT09ICdFbGVtZW50JyB8fFxuICAgICAgICAgICAgdGhpcy5ub2RlLnR5cGUgPT09ICdUZXh0JyB8fFxuICAgICAgICAgICAgdGhpcy5ub2RlLnR5cGUgPT09ICdNdXN0YWNoZVRhZycpO1xuICAgIH1cbiAgICByZW5kZXIoX2Jsb2NrLCBfcGFyZW50X25vZGUsIF9wYXJlbnRfbm9kZXMpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoJ1dyYXBwZXIgY2xhc3MgaXMgbm90IHJlbmRlcmFibGUnKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZV9kZWJ1Z2dpbmdfY29tbWVudChub2RlLCBjb21wb25lbnQpIHtcbiAgICBjb25zdCB7IGxvY2F0ZSwgc291cmNlIH0gPSBjb21wb25lbnQ7XG4gICAgbGV0IGMgPSBub2RlLnN0YXJ0O1xuICAgIGlmIChub2RlLnR5cGUgPT09ICdFbHNlQmxvY2snKSB7XG4gICAgICAgIHdoaWxlIChzb3VyY2VbYyAtIDFdICE9PSAneycpXG4gICAgICAgICAgICBjIC09IDE7XG4gICAgICAgIHdoaWxlIChzb3VyY2VbYyAtIDFdID09PSAneycpXG4gICAgICAgICAgICBjIC09IDE7XG4gICAgfVxuICAgIGxldCBkO1xuICAgIGlmIChub2RlLnR5cGUgPT09ICdJbmxpbmVDb21wb25lbnQnIHx8IG5vZGUudHlwZSA9PT0gJ0VsZW1lbnQnIHx8IG5vZGUudHlwZSA9PT0gJ1Nsb3RUZW1wbGF0ZScpIHtcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICBkID0gbm9kZS5jaGlsZHJlblswXS5zdGFydDtcbiAgICAgICAgICAgIHdoaWxlIChzb3VyY2VbZCAtIDFdICE9PSAnPicpXG4gICAgICAgICAgICAgICAgZCAtPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZCA9IG5vZGUuc3RhcnQ7XG4gICAgICAgICAgICB3aGlsZSAoc291cmNlW2RdICE9PSAnPicpXG4gICAgICAgICAgICAgICAgZCArPSAxO1xuICAgICAgICAgICAgZCArPSAxO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gJ1RleHQnIHx8IG5vZGUudHlwZSA9PT0gJ0NvbW1lbnQnKSB7XG4gICAgICAgIGQgPSBub2RlLmVuZDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgZCA9IG5vZGUuZXhwcmVzc2lvbiA/IG5vZGUuZXhwcmVzc2lvbi5ub2RlLmVuZCA6IGM7XG4gICAgICAgIHdoaWxlIChzb3VyY2VbZF0gIT09ICd9JyAmJiBkIDw9IHNvdXJjZS5sZW5ndGgpXG4gICAgICAgICAgICBkICs9IDE7XG4gICAgICAgIHdoaWxlIChzb3VyY2VbZF0gPT09ICd9JylcbiAgICAgICAgICAgIGQgKz0gMTtcbiAgICB9XG4gICAgY29uc3Qgc3RhcnQgPSBsb2NhdGUoYyk7XG4gICAgY29uc3QgbG9jID0gYCgke3N0YXJ0LmxpbmV9OiR7c3RhcnQuY29sdW1ufSlgO1xuICAgIHJldHVybiBgJHtsb2N9ICR7c291cmNlLnNsaWNlKGMsIGQpfWAucmVwbGFjZSgvXFxzL2csICcgJyk7XG59XG5cbmNsYXNzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIF9zY29wZSwgaW5mbykge1xuICAgICAgICB0aGlzLnN0YXJ0ID0gaW5mby5zdGFydDtcbiAgICAgICAgdGhpcy5lbmQgPSBpbmZvLmVuZDtcbiAgICAgICAgdGhpcy50eXBlID0gaW5mby50eXBlO1xuICAgICAgICAvLyB0aGlzIG1ha2VzIHByb3BlcnRpZXMgbm9uLWVudW1lcmFibGUsIHdoaWNoIG1ha2VzIGxvZ2dpbmdcbiAgICAgICAgLy8gYmVhcmFibGUuIG1pZ2h0IGhhdmUgYSBwZXJmb3JtYW5jZSBjb3N0LiBUT0RPIHJlbW92ZSBpbiBwcm9kP1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7XG4gICAgICAgICAgICBjb21wb25lbnQ6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogY29tcG9uZW50XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGFyZW50OiB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHBhcmVudFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2Fubm90X3VzZV9pbm5lcmh0bWwoKSB7XG4gICAgICAgIGlmICh0aGlzLmNhbl91c2VfaW5uZXJodG1sICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5jYW5fdXNlX2lubmVyaHRtbCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50KVxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50LmNhbm5vdF91c2VfaW5uZXJodG1sKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZmluZF9uZWFyZXN0KHNlbGVjdG9yKSB7XG4gICAgICAgIGlmIChzZWxlY3Rvci50ZXN0KHRoaXMudHlwZSkpXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgaWYgKHRoaXMucGFyZW50KVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmZpbmRfbmVhcmVzdChzZWxlY3Rvcik7XG4gICAgfVxuICAgIGdldF9zdGF0aWNfYXR0cmlidXRlX3ZhbHVlKG5hbWUpIHtcbiAgICAgICAgY29uc3QgYXR0cmlidXRlID0gdGhpcy5hdHRyaWJ1dGVzICYmIHRoaXMuYXR0cmlidXRlcy5maW5kKChhdHRyKSA9PiBhdHRyLnR5cGUgPT09ICdBdHRyaWJ1dGUnICYmIGF0dHIubmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lKTtcbiAgICAgICAgaWYgKCFhdHRyaWJ1dGUpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKGF0dHJpYnV0ZS5pc190cnVlKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmIChhdHRyaWJ1dGUuY2h1bmtzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgaWYgKGF0dHJpYnV0ZS5jaHVua3MubGVuZ3RoID09PSAxICYmIGF0dHJpYnV0ZS5jaHVua3NbMF0udHlwZSA9PT0gJ1RleHQnKSB7XG4gICAgICAgICAgICByZXR1cm4gYXR0cmlidXRlLmNodW5rc1swXS5kYXRhO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBoYXNfYW5jZXN0b3IodHlwZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQgP1xuICAgICAgICAgICAgdGhpcy5wYXJlbnQudHlwZSA9PT0gdHlwZSB8fCB0aGlzLnBhcmVudC5oYXNfYW5jZXN0b3IodHlwZSkgOlxuICAgICAgICAgICAgZmFsc2U7XG4gICAgfVxufVxuXG4vLyBBbGwgY29tcGlsZXIgd2FybmluZ3Mgc2hvdWxkIGJlIGxpc3RlZCBhbmQgYWNjZXNzZWQgZnJvbSBoZXJlXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG52YXIgY29tcGlsZXJfd2FybmluZ3MgPSB7XG4gICAgY3VzdG9tX2VsZW1lbnRfbm9fdGFnOiB7XG4gICAgICAgIGNvZGU6ICdjdXN0b20tZWxlbWVudC1uby10YWcnLFxuICAgICAgICBtZXNzYWdlOiAnTm8gY3VzdG9tIGVsZW1lbnQgXFwndGFnXFwnIG9wdGlvbiB3YXMgc3BlY2lmaWVkLiBUbyBhdXRvbWF0aWNhbGx5IHJlZ2lzdGVyIGEgY3VzdG9tIGVsZW1lbnQsIHNwZWNpZnkgYSBuYW1lIHdpdGggYSBoeXBoZW4gaW4gaXQsIGUuZy4gPHN2ZWx0ZTpvcHRpb25zIHRhZz1cIm15LXRoaW5nXCIvPi4gVG8gaGlkZSB0aGlzIHdhcm5pbmcsIHVzZSA8c3ZlbHRlOm9wdGlvbnMgdGFnPXtudWxsfS8+J1xuICAgIH0sXG4gICAgdW51c2VkX2V4cG9ydF9sZXQ6IChjb21wb25lbnQsIHByb3BlcnR5KSA9PiAoe1xuICAgICAgICBjb2RlOiAndW51c2VkLWV4cG9ydC1sZXQnLFxuICAgICAgICBtZXNzYWdlOiBgJHtjb21wb25lbnR9IGhhcyB1bnVzZWQgZXhwb3J0IHByb3BlcnR5ICcke3Byb3BlcnR5fScuIElmIGl0IGlzIGZvciBleHRlcm5hbCByZWZlcmVuY2Ugb25seSwgcGxlYXNlIGNvbnNpZGVyIHVzaW5nIFxcYGV4cG9ydCBjb25zdCAke3Byb3BlcnR5fVxcYGBcbiAgICB9KSxcbiAgICBtb2R1bGVfc2NyaXB0X3JlYWN0aXZlX2RlY2xhcmF0aW9uOiB7XG4gICAgICAgIGNvZGU6ICdtb2R1bGUtc2NyaXB0LXJlYWN0aXZlLWRlY2xhcmF0aW9uJyxcbiAgICAgICAgbWVzc2FnZTogJyQ6IGhhcyBubyBlZmZlY3QgaW4gYSBtb2R1bGUgc2NyaXB0J1xuICAgIH0sXG4gICAgbm9uX3RvcF9sZXZlbF9yZWFjdGl2ZV9kZWNsYXJhdGlvbjoge1xuICAgICAgICBjb2RlOiAnbm9uLXRvcC1sZXZlbC1yZWFjdGl2ZS1kZWNsYXJhdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6ICckOiBoYXMgbm8gZWZmZWN0IG91dHNpZGUgb2YgdGhlIHRvcC1sZXZlbCdcbiAgICB9LFxuICAgIG1vZHVsZV9zY3JpcHRfdmFyaWFibGVfcmVhY3RpdmVfZGVjbGFyYXRpb246IChuYW1lcykgPT4gKHtcbiAgICAgICAgY29kZTogJ21vZHVsZS1zY3JpcHQtcmVhY3RpdmUtZGVjbGFyYXRpb24nLFxuICAgICAgICBtZXNzYWdlOiBgJHtuYW1lcy5tYXAobmFtZSA9PiBgXCIke25hbWV9XCJgKS5qb2luKCcsICcpfSAke25hbWVzLmxlbmd0aCA+IDEgPyAnYXJlJyA6ICdpcyd9IGRlY2xhcmVkIGluIGEgbW9kdWxlIHNjcmlwdCBhbmQgd2lsbCBub3QgYmUgcmVhY3RpdmVgXG4gICAgfSksXG4gICAgbWlzc2luZ19kZWNsYXJhdGlvbjogKG5hbWUsIGhhc19zY3JpcHQpID0+ICh7XG4gICAgICAgIGNvZGU6ICdtaXNzaW5nLWRlY2xhcmF0aW9uJyxcbiAgICAgICAgbWVzc2FnZTogYCcke25hbWV9JyBpcyBub3QgZGVmaW5lZGAgKyAoaGFzX3NjcmlwdCA/ICcnIDogYC4gQ29uc2lkZXIgYWRkaW5nIGEgPHNjcmlwdD4gYmxvY2sgd2l0aCAnZXhwb3J0IGxldCAke25hbWV9JyB0byBkZWNsYXJlIGEgcHJvcGApXG4gICAgfSksXG4gICAgbWlzc2luZ19jdXN0b21fZWxlbWVudF9jb21waWxlX29wdGlvbnM6IHtcbiAgICAgICAgY29kZTogJ21pc3NpbmctY3VzdG9tLWVsZW1lbnQtY29tcGlsZS1vcHRpb25zJyxcbiAgICAgICAgbWVzc2FnZTogXCJUaGUgJ3RhZycgb3B0aW9uIGlzIHVzZWQgd2hlbiBnZW5lcmF0aW5nIGEgY3VzdG9tIGVsZW1lbnQuIERpZCB5b3UgZm9yZ2V0IHRoZSAnY3VzdG9tRWxlbWVudDogdHJ1ZScgY29tcGlsZSBvcHRpb24/XCJcbiAgICB9LFxuICAgIGNzc191bnVzZWRfc2VsZWN0b3I6IChzZWxlY3RvcikgPT4gKHtcbiAgICAgICAgY29kZTogJ2Nzcy11bnVzZWQtc2VsZWN0b3InLFxuICAgICAgICBtZXNzYWdlOiBgVW51c2VkIENTUyBzZWxlY3RvciBcIiR7c2VsZWN0b3J9XCJgXG4gICAgfSksXG4gICAgZW1wdHlfYmxvY2s6IHtcbiAgICAgICAgY29kZTogJ2VtcHR5LWJsb2NrJyxcbiAgICAgICAgbWVzc2FnZTogJ0VtcHR5IGJsb2NrJ1xuICAgIH0sXG4gICAgcmVhY3RpdmVfY29tcG9uZW50OiAobmFtZSkgPT4gKHtcbiAgICAgICAgY29kZTogJ3JlYWN0aXZlLWNvbXBvbmVudCcsXG4gICAgICAgIG1lc3NhZ2U6IGA8JHtuYW1lfS8+IHdpbGwgbm90IGJlIHJlYWN0aXZlIGlmICR7bmFtZX0gY2hhbmdlcy4gVXNlIDxzdmVsdGU6Y29tcG9uZW50IHRoaXM9eyR7bmFtZX19Lz4gaWYgeW91IHdhbnQgdGhpcyByZWFjdGl2aXR5LmBcbiAgICB9KSxcbiAgICBjb21wb25lbnRfbmFtZV9sb3dlcmNhc2U6IChuYW1lKSA9PiAoe1xuICAgICAgICBjb2RlOiAnY29tcG9uZW50LW5hbWUtbG93ZXJjYXNlJyxcbiAgICAgICAgbWVzc2FnZTogYDwke25hbWV9PiB3aWxsIGJlIHRyZWF0ZWQgYXMgYW4gSFRNTCBlbGVtZW50IHVubGVzcyBpdCBiZWdpbnMgd2l0aCBhIGNhcGl0YWwgbGV0dGVyYFxuICAgIH0pLFxuICAgIGF2b2lkX2lzOiB7XG4gICAgICAgIGNvZGU6ICdhdm9pZC1pcycsXG4gICAgICAgIG1lc3NhZ2U6ICdUaGUgXFwnaXNcXCcgYXR0cmlidXRlIGlzIG5vdCBzdXBwb3J0ZWQgY3Jvc3MtYnJvd3NlciBhbmQgc2hvdWxkIGJlIGF2b2lkZWQnXG4gICAgfSxcbiAgICBpbnZhbGlkX2h0bWxfYXR0cmlidXRlOiAobmFtZSwgc3VnZ2VzdGlvbikgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtaHRtbC1hdHRyaWJ1dGUnLFxuICAgICAgICBtZXNzYWdlOiBgJyR7bmFtZX0nIGlzIG5vdCBhIHZhbGlkIEhUTUwgYXR0cmlidXRlLiBEaWQgeW91IG1lYW4gJyR7c3VnZ2VzdGlvbn0nP2BcbiAgICB9KSxcbiAgICBhMTF5X2FyaWFfYXR0cmlidXRlczogKG5hbWUpID0+ICh7XG4gICAgICAgIGNvZGU6ICdhMTF5LWFyaWEtYXR0cmlidXRlcycsXG4gICAgICAgIG1lc3NhZ2U6IGBBMTF5OiA8JHtuYW1lfT4gc2hvdWxkIG5vdCBoYXZlIGFyaWEtKiBhdHRyaWJ1dGVzYFxuICAgIH0pLFxuICAgIGExMXlfdW5rbm93bl9hcmlhX2F0dHJpYnV0ZTogKGF0dHJpYnV0ZSwgc3VnZ2VzdGlvbikgPT4gKHtcbiAgICAgICAgY29kZTogJ2ExMXktdW5rbm93bi1hcmlhLWF0dHJpYnV0ZScsXG4gICAgICAgIG1lc3NhZ2U6IGBBMTF5OiBVbmtub3duIGFyaWEgYXR0cmlidXRlICdhcmlhLSR7YXR0cmlidXRlfSdgICsgKHN1Z2dlc3Rpb24gPyBgIChkaWQgeW91IG1lYW4gJyR7c3VnZ2VzdGlvbn0nPylgIDogJycpXG4gICAgfSksXG4gICAgYTExeV9oaWRkZW46IChuYW1lKSA9PiAoe1xuICAgICAgICBjb2RlOiAnYTExeS1oaWRkZW4nLFxuICAgICAgICBtZXNzYWdlOiBgQTExeTogPCR7bmFtZX0+IGVsZW1lbnQgc2hvdWxkIG5vdCBiZSBoaWRkZW5gXG4gICAgfSksXG4gICAgYTExeV9taXNwbGFjZWRfcm9sZTogKG5hbWUpID0+ICh7XG4gICAgICAgIGNvZGU6ICdhMTF5LW1pc3BsYWNlZC1yb2xlJyxcbiAgICAgICAgbWVzc2FnZTogYEExMXk6IDwke25hbWV9PiBzaG91bGQgbm90IGhhdmUgcm9sZSBhdHRyaWJ1dGVgXG4gICAgfSksXG4gICAgYTExeV91bmtub3duX3JvbGU6IChyb2xlLCBzdWdnZXN0aW9uKSA9PiAoe1xuICAgICAgICBjb2RlOiAnYTExeS11bmtub3duLXJvbGUnLFxuICAgICAgICBtZXNzYWdlOiBgQTExeTogVW5rbm93biByb2xlICcke3JvbGV9J2AgKyAoc3VnZ2VzdGlvbiA/IGAgKGRpZCB5b3UgbWVhbiAnJHtzdWdnZXN0aW9ufSc/KWAgOiAnJylcbiAgICB9KSxcbiAgICBhMTF5X25vX3JlZHVuZGFudF9yb2xlczogKHJvbGUpID0+ICh7XG4gICAgICAgIGNvZGU6ICdhMTF5LW5vLXJlZHVuZGFudC1yb2xlcycsXG4gICAgICAgIG1lc3NhZ2U6IGBBMTF5OiBSZWR1bmRhbnQgcm9sZSAnJHtyb2xlfSdgXG4gICAgfSksXG4gICAgYTExeV9hY2Nlc3NrZXk6IHtcbiAgICAgICAgY29kZTogJ2ExMXktYWNjZXNza2V5JyxcbiAgICAgICAgbWVzc2FnZTogJ0ExMXk6IEF2b2lkIHVzaW5nIGFjY2Vzc2tleSdcbiAgICB9LFxuICAgIGExMXlfYXV0b2ZvY3VzOiB7XG4gICAgICAgIGNvZGU6ICdhMTF5LWF1dG9mb2N1cycsXG4gICAgICAgIG1lc3NhZ2U6ICdBMTF5OiBBdm9pZCB1c2luZyBhdXRvZm9jdXMnXG4gICAgfSxcbiAgICBhMTF5X21pc3BsYWNlZF9zY29wZToge1xuICAgICAgICBjb2RlOiAnYTExeS1taXNwbGFjZWQtc2NvcGUnLFxuICAgICAgICBtZXNzYWdlOiAnQTExeTogVGhlIHNjb3BlIGF0dHJpYnV0ZSBzaG91bGQgb25seSBiZSB1c2VkIHdpdGggPHRoPiBlbGVtZW50cydcbiAgICB9LFxuICAgIGExMXlfcG9zaXRpdmVfdGFiaW5kZXg6IHtcbiAgICAgICAgY29kZTogJ2ExMXktcG9zaXRpdmUtdGFiaW5kZXgnLFxuICAgICAgICBtZXNzYWdlOiAnQTExeTogYXZvaWQgdGFiaW5kZXggdmFsdWVzIGFib3ZlIHplcm8nXG4gICAgfSxcbiAgICBhMTF5X2ludmFsaWRfYXR0cmlidXRlOiAoaHJlZl9hdHRyaWJ1dGUsIGhyZWZfdmFsdWUpID0+ICh7XG4gICAgICAgIGNvZGU6ICdhMTF5LWludmFsaWQtYXR0cmlidXRlJyxcbiAgICAgICAgbWVzc2FnZTogYEExMXk6ICcke2hyZWZfdmFsdWV9JyBpcyBub3QgYSB2YWxpZCAke2hyZWZfYXR0cmlidXRlfSBhdHRyaWJ1dGVgXG4gICAgfSksXG4gICAgYTExeV9taXNzaW5nX2F0dHJpYnV0ZTogKG5hbWUsIGFydGljbGUsIHNlcXVlbmNlKSA9PiAoe1xuICAgICAgICBjb2RlOiAnYTExeS1taXNzaW5nLWF0dHJpYnV0ZScsXG4gICAgICAgIG1lc3NhZ2U6IGBBMTF5OiA8JHtuYW1lfT4gZWxlbWVudCBzaG91bGQgaGF2ZSAke2FydGljbGV9ICR7c2VxdWVuY2V9IGF0dHJpYnV0ZWBcbiAgICB9KSxcbiAgICBhMTF5X2ltZ19yZWR1bmRhbnRfYWx0OiB7XG4gICAgICAgIGNvZGU6ICdhMTF5LWltZy1yZWR1bmRhbnQtYWx0JyxcbiAgICAgICAgbWVzc2FnZTogJ0ExMXk6IFNjcmVlbnJlYWRlcnMgYWxyZWFkeSBhbm5vdW5jZSA8aW1nPiBlbGVtZW50cyBhcyBhbiBpbWFnZS4nXG4gICAgfSxcbiAgICBhMTF5X2xhYmVsX2hhc19hc3NvY2lhdGVkX2NvbnRyb2w6IHtcbiAgICAgICAgY29kZTogJ2ExMXktbGFiZWwtaGFzLWFzc29jaWF0ZWQtY29udHJvbCcsXG4gICAgICAgIG1lc3NhZ2U6ICdBMTF5OiBBIGZvcm0gbGFiZWwgbXVzdCBiZSBhc3NvY2lhdGVkIHdpdGggYSBjb250cm9sLidcbiAgICB9LFxuICAgIGExMXlfbWVkaWFfaGFzX2NhcHRpb246IHtcbiAgICAgICAgY29kZTogJ2ExMXktbWVkaWEtaGFzLWNhcHRpb24nLFxuICAgICAgICBtZXNzYWdlOiAnQTExeTogPHZpZGVvPiBlbGVtZW50cyBtdXN0IGhhdmUgYSA8dHJhY2sga2luZD1cImNhcHRpb25zXCI+J1xuICAgIH0sXG4gICAgYTExeV9kaXN0cmFjdGluZ19lbGVtZW50czogKG5hbWUpID0+ICh7XG4gICAgICAgIGNvZGU6ICdhMTF5LWRpc3RyYWN0aW5nLWVsZW1lbnRzJyxcbiAgICAgICAgbWVzc2FnZTogYEExMXk6IEF2b2lkIDwke25hbWV9PiBlbGVtZW50c2BcbiAgICB9KSxcbiAgICBhMTF5X3N0cnVjdHVyZV9pbW1lZGlhdGU6IHtcbiAgICAgICAgY29kZTogJ2ExMXktc3RydWN0dXJlJyxcbiAgICAgICAgbWVzc2FnZTogJ0ExMXk6IDxmaWdjYXB0aW9uPiBtdXN0IGJlIGFuIGltbWVkaWF0ZSBjaGlsZCBvZiA8ZmlndXJlPidcbiAgICB9LFxuICAgIGExMXlfc3RydWN0dXJlX2ZpcnN0X29yX2xhc3Q6IHtcbiAgICAgICAgY29kZTogJ2ExMXktc3RydWN0dXJlJyxcbiAgICAgICAgbWVzc2FnZTogJ0ExMXk6IDxmaWdjYXB0aW9uPiBtdXN0IGJlIGZpcnN0IG9yIGxhc3QgY2hpbGQgb2YgPGZpZ3VyZT4nXG4gICAgfSxcbiAgICBhMTF5X21vdXNlX2V2ZW50c19oYXZlX2tleV9ldmVudHM6IChldmVudCwgYWNjb21wYW5pZWRfYnkpID0+ICh7XG4gICAgICAgIGNvZGU6ICdhMTF5LW1vdXNlLWV2ZW50cy1oYXZlLWtleS1ldmVudHMnLFxuICAgICAgICBtZXNzYWdlOiBgQTExeTogb246JHtldmVudH0gbXVzdCBiZSBhY2NvbXBhbmllZCBieSBvbjoke2FjY29tcGFuaWVkX2J5fWBcbiAgICB9KSxcbiAgICBhMTF5X21pc3NpbmdfY29udGVudDogKG5hbWUpID0+ICh7XG4gICAgICAgIGNvZGU6ICdhMTF5LW1pc3NpbmctY29udGVudCcsXG4gICAgICAgIG1lc3NhZ2U6IGBBMTF5OiA8JHtuYW1lfT4gZWxlbWVudCBzaG91bGQgaGF2ZSBjaGlsZCBjb250ZW50YFxuICAgIH0pLFxuICAgIHJlZHVuZGFudF9ldmVudF9tb2RpZmllcl9mb3JfdG91Y2g6IHtcbiAgICAgICAgY29kZTogJ3JlZHVuZGFudC1ldmVudC1tb2RpZmllcicsXG4gICAgICAgIG1lc3NhZ2U6ICdUb3VjaCBldmVudCBoYW5kbGVycyB0aGF0IGRvblxcJ3QgdXNlIHRoZSBcXCdldmVudFxcJyBvYmplY3QgYXJlIHBhc3NpdmUgYnkgZGVmYXVsdCdcbiAgICB9LFxuICAgIHJlZHVuZGFudF9ldmVudF9tb2RpZmllcl9wYXNzaXZlOiB7XG4gICAgICAgIGNvZGU6ICdyZWR1bmRhbnQtZXZlbnQtbW9kaWZpZXInLFxuICAgICAgICBtZXNzYWdlOiAnVGhlIHBhc3NpdmUgbW9kaWZpZXIgb25seSB3b3JrcyB3aXRoIHdoZWVsIGFuZCB0b3VjaCBldmVudHMnXG4gICAgfVxufTtcblxuY2xhc3MgQWJzdHJhY3RCbG9jayBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgfVxuICAgIHdhcm5faWZfZW1wdHlfYmxvY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5jaGlsZHJlbiB8fCB0aGlzLmNoaWxkcmVuLmxlbmd0aCA+IDEpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlblswXTtcbiAgICAgICAgaWYgKCFjaGlsZCB8fCAoY2hpbGQudHlwZSA9PT0gJ1RleHQnICYmICEvW14gXFxyXFxuXFxmXFx2XFx0XS8udGVzdChjaGlsZC5kYXRhKSkpIHtcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Lndhcm4odGhpcywgY29tcGlsZXJfd2FybmluZ3MuZW1wdHlfYmxvY2spO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBmbGF0dGVuX3JlZmVyZW5jZShub2RlKSB7XG4gICAgY29uc3Qgbm9kZXMgPSBbXTtcbiAgICBjb25zdCBwYXJ0cyA9IFtdO1xuICAgIHdoaWxlIChub2RlLnR5cGUgPT09ICdNZW1iZXJFeHByZXNzaW9uJykge1xuICAgICAgICBub2Rlcy51bnNoaWZ0KG5vZGUucHJvcGVydHkpO1xuICAgICAgICBpZiAoIW5vZGUuY29tcHV0ZWQpIHtcbiAgICAgICAgICAgIHBhcnRzLnVuc2hpZnQobm9kZS5wcm9wZXJ0eS5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbXB1dGVkX3Byb3BlcnR5ID0gdG9fc3RyaW5nJDEobm9kZS5wcm9wZXJ0eSk7XG4gICAgICAgICAgICBpZiAoY29tcHV0ZWRfcHJvcGVydHkpIHtcbiAgICAgICAgICAgICAgICBwYXJ0cy51bnNoaWZ0KGBbJHtjb21wdXRlZF9wcm9wZXJ0eX1dYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbm9kZSA9IG5vZGUub2JqZWN0O1xuICAgIH1cbiAgICBjb25zdCBuYW1lID0gbm9kZS50eXBlID09PSAnSWRlbnRpZmllcidcbiAgICAgICAgPyBub2RlLm5hbWVcbiAgICAgICAgOiBub2RlLnR5cGUgPT09ICdUaGlzRXhwcmVzc2lvbicgPyAndGhpcycgOiBudWxsO1xuICAgIG5vZGVzLnVuc2hpZnQobm9kZSk7XG4gICAgcGFydHMudW5zaGlmdChuYW1lKTtcbiAgICByZXR1cm4geyBuYW1lLCBub2RlcywgcGFydHMgfTtcbn1cbmZ1bmN0aW9uIHRvX3N0cmluZyQxKG5vZGUpIHtcbiAgICBzd2l0Y2ggKG5vZGUudHlwZSkge1xuICAgICAgICBjYXNlICdMaXRlcmFsJzpcbiAgICAgICAgICAgIHJldHVybiBTdHJpbmcobm9kZS52YWx1ZSk7XG4gICAgICAgIGNhc2UgJ0lkZW50aWZpZXInOlxuICAgICAgICAgICAgcmV0dXJuIG5vZGUubmFtZTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZV9zY29wZXMoZXhwcmVzc2lvbikge1xuICAgIHJldHVybiBhbmFseXplKGV4cHJlc3Npb24pO1xufVxuXG5mdW5jdGlvbiBnZXRfb2JqZWN0KG5vZGUpIHtcbiAgICB3aGlsZSAobm9kZS50eXBlID09PSAnTWVtYmVyRXhwcmVzc2lvbicpXG4gICAgICAgIG5vZGUgPSBub2RlLm9iamVjdDtcbiAgICByZXR1cm4gbm9kZTtcbn1cblxuY29uc3QgcmVzZXJ2ZWRfa2V5d29yZHMgPSBuZXcgU2V0KFsnJCRwcm9wcycsICckJHJlc3RQcm9wcycsICckJHNsb3RzJ10pO1xuZnVuY3Rpb24gaXNfcmVzZXJ2ZWRfa2V5d29yZChuYW1lKSB7XG4gICAgcmV0dXJuIHJlc2VydmVkX2tleXdvcmRzLmhhcyhuYW1lKTtcbn1cblxuZnVuY3Rpb24gaXNfZHluYW1pYyh2YXJpYWJsZSkge1xuICAgIGlmICh2YXJpYWJsZSkge1xuICAgICAgICBpZiAodmFyaWFibGUubXV0YXRlZCB8fCB2YXJpYWJsZS5yZWFzc2lnbmVkKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGR5bmFtaWMgaW50ZXJuYWwgc3RhdGVcbiAgICAgICAgaWYgKCF2YXJpYWJsZS5tb2R1bGUgJiYgdmFyaWFibGUud3JpdGFibGUgJiYgdmFyaWFibGUuZXhwb3J0X25hbWUpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gd3JpdGFibGUgcHJvcHNcbiAgICAgICAgaWYgKGlzX3Jlc2VydmVkX2tleXdvcmQodmFyaWFibGUubmFtZSkpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBub2Rlc19tYXRjaChhLCBiKSB7XG4gICAgaWYgKCEhYSAhPT0gISFiKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoYSkgIT09IEFycmF5LmlzQXJyYXkoYikpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoYSAmJiB0eXBlb2YgYSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYSkpIHtcbiAgICAgICAgICAgIGlmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIGEuZXZlcnkoKGNoaWxkLCBpKSA9PiBub2Rlc19tYXRjaChjaGlsZCwgYltpXSkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFfa2V5cyA9IE9iamVjdC5rZXlzKGEpLnNvcnQoKTtcbiAgICAgICAgY29uc3QgYl9rZXlzID0gT2JqZWN0LmtleXMoYikuc29ydCgpO1xuICAgICAgICBpZiAoYV9rZXlzLmxlbmd0aCAhPT0gYl9rZXlzLmxlbmd0aClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgbGV0IGkgPSBhX2tleXMubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBhX2tleXNbaV07XG4gICAgICAgICAgICBpZiAoYl9rZXlzW2ldICE9PSBrZXkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3N0YXJ0JyB8fCBrZXkgPT09ICdlbmQnKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgaWYgKCFub2Rlc19tYXRjaChhW2tleV0sIGJba2V5XSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBhID09PSBiO1xufVxuXG5mdW5jdGlvbiBpbnZhbGlkYXRlKHJlbmRlcmVyLCBzY29wZSwgbm9kZSwgbmFtZXMsIG1haW5fZXhlY3V0aW9uX2NvbnRleHQgPSBmYWxzZSkge1xuICAgIGNvbnN0IHsgY29tcG9uZW50IH0gPSByZW5kZXJlcjtcbiAgICBjb25zdCBbaGVhZCwgLi4udGFpbF0gPSBBcnJheS5mcm9tKG5hbWVzKVxuICAgICAgICAuZmlsdGVyKG5hbWUgPT4ge1xuICAgICAgICBjb25zdCBvd25lciA9IHNjb3BlLmZpbmRfb3duZXIobmFtZSk7XG4gICAgICAgIHJldHVybiAhb3duZXIgfHwgb3duZXIgPT09IGNvbXBvbmVudC5pbnN0YW5jZV9zY29wZTtcbiAgICB9KVxuICAgICAgICAubWFwKG5hbWUgPT4gY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KG5hbWUpKVxuICAgICAgICAuZmlsdGVyKHZhcmlhYmxlID0+IHtcbiAgICAgICAgcmV0dXJuIHZhcmlhYmxlICYmICghdmFyaWFibGUuaG9pc3RhYmxlICYmXG4gICAgICAgICAgICAhdmFyaWFibGUuZ2xvYmFsICYmXG4gICAgICAgICAgICAhdmFyaWFibGUubW9kdWxlICYmXG4gICAgICAgICAgICAodmFyaWFibGUucmVmZXJlbmNlZCB8fFxuICAgICAgICAgICAgICAgIHZhcmlhYmxlLnN1YnNjcmliYWJsZSB8fFxuICAgICAgICAgICAgICAgIHZhcmlhYmxlLmlzX3JlYWN0aXZlX2RlcGVuZGVuY3kgfHxcbiAgICAgICAgICAgICAgICB2YXJpYWJsZS5leHBvcnRfbmFtZSB8fFxuICAgICAgICAgICAgICAgIHZhcmlhYmxlLm5hbWVbMF0gPT09ICckJykpO1xuICAgIH0pO1xuICAgIGZ1bmN0aW9uIGdldF9pbnZhbGlkYXRlZCh2YXJpYWJsZSwgbm9kZSkge1xuICAgICAgICBpZiAobWFpbl9leGVjdXRpb25fY29udGV4dCAmJiAhdmFyaWFibGUuc3Vic2NyaWJhYmxlICYmIHZhcmlhYmxlLm5hbWVbMF0gIT09ICckJykge1xuICAgICAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlbmRlcmVyX2ludmFsaWRhdGUocmVuZGVyZXIsIHZhcmlhYmxlLm5hbWUsIHVuZGVmaW5lZCwgbWFpbl9leGVjdXRpb25fY29udGV4dCk7XG4gICAgfVxuICAgIGlmICghaGVhZCkge1xuICAgICAgICByZXR1cm4gbm9kZTtcbiAgICB9XG4gICAgY29tcG9uZW50Lmhhc19yZWFjdGl2ZV9hc3NpZ25tZW50cyA9IHRydWU7XG4gICAgaWYgKG5vZGUudHlwZSA9PT0gJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJyAmJiBub2RlLm9wZXJhdG9yID09PSAnPScgJiYgbm9kZXNfbWF0Y2gobm9kZS5sZWZ0LCBub2RlLnJpZ2h0KSAmJiB0YWlsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gZ2V0X2ludmFsaWRhdGVkKGhlYWQsIG5vZGUpO1xuICAgIH1cbiAgICBjb25zdCBpc19zdG9yZV92YWx1ZSA9IGhlYWQubmFtZVswXSA9PT0gJyQnICYmIGhlYWQubmFtZVsxXSAhPT0gJyQnO1xuICAgIGNvbnN0IGV4dHJhX2FyZ3MgPSB0YWlsLm1hcCh2YXJpYWJsZSA9PiBnZXRfaW52YWxpZGF0ZWQodmFyaWFibGUpKS5maWx0ZXIoQm9vbGVhbik7XG4gICAgaWYgKGlzX3N0b3JlX3ZhbHVlKSB7XG4gICAgICAgIHJldHVybiB4IGBAc2V0X3N0b3JlX3ZhbHVlKCR7aGVhZC5uYW1lLnNsaWNlKDEpfSwgJHtub2RlfSwgJHtoZWFkLm5hbWV9LCAke2V4dHJhX2FyZ3N9KWA7XG4gICAgfVxuICAgIGxldCBpbnZhbGlkYXRlO1xuICAgIGlmICghbWFpbl9leGVjdXRpb25fY29udGV4dCkge1xuICAgICAgICBjb25zdCBwYXNzX3ZhbHVlID0gKGV4dHJhX2FyZ3MubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgKG5vZGUudHlwZSA9PT0gJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJyAmJiBub2RlLmxlZnQudHlwZSAhPT0gJ0lkZW50aWZpZXInKSB8fFxuICAgICAgICAgICAgKG5vZGUudHlwZSA9PT0gJ1VwZGF0ZUV4cHJlc3Npb24nICYmICghbm9kZS5wcmVmaXggfHwgbm9kZS5hcmd1bWVudC50eXBlICE9PSAnSWRlbnRpZmllcicpKSk7XG4gICAgICAgIGlmIChwYXNzX3ZhbHVlKSB7XG4gICAgICAgICAgICBleHRyYV9hcmdzLnVuc2hpZnQoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdJZGVudGlmaWVyJyxcbiAgICAgICAgICAgICAgICBuYW1lOiBoZWFkLm5hbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGludmFsaWRhdGUgPSB4IGAkJGludmFsaWRhdGUoJHtyZW5kZXJlci5jb250ZXh0X2xvb2t1cC5nZXQoaGVhZC5uYW1lKS5pbmRleH0sICR7bm9kZX0sICR7ZXh0cmFfYXJnc30pYDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIHNraXAgYCQkaW52YWxpZGF0ZWAgaWYgaXQgaXMgaW4gdGhlIG1haW4gZXhlY3V0aW9uIGNvbnRleHRcbiAgICAgICAgaW52YWxpZGF0ZSA9IGV4dHJhX2FyZ3MubGVuZ3RoID8gW25vZGUsIC4uLmV4dHJhX2FyZ3NdIDogbm9kZTtcbiAgICB9XG4gICAgaWYgKGhlYWQuc3Vic2NyaWJhYmxlICYmIGhlYWQucmVhc3NpZ25lZCkge1xuICAgICAgICBjb25zdCBzdWJzY3JpYmUgPSBgJCRzdWJzY3JpYmVfJHtoZWFkLm5hbWV9YDtcbiAgICAgICAgaW52YWxpZGF0ZSA9IHggYCR7c3Vic2NyaWJlfSgke2ludmFsaWRhdGV9KWA7XG4gICAgfVxuICAgIHJldHVybiBpbnZhbGlkYXRlO1xufVxuZnVuY3Rpb24gcmVuZGVyZXJfaW52YWxpZGF0ZShyZW5kZXJlciwgbmFtZSwgdmFsdWUsIG1haW5fZXhlY3V0aW9uX2NvbnRleHQgPSBmYWxzZSkge1xuICAgIGNvbnN0IHZhcmlhYmxlID0gcmVuZGVyZXIuY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KG5hbWUpO1xuICAgIGlmICh2YXJpYWJsZSAmJiAodmFyaWFibGUuc3Vic2NyaWJhYmxlICYmICh2YXJpYWJsZS5yZWFzc2lnbmVkIHx8IHZhcmlhYmxlLmV4cG9ydF9uYW1lKSkpIHtcbiAgICAgICAgaWYgKG1haW5fZXhlY3V0aW9uX2NvbnRleHQpIHtcbiAgICAgICAgICAgIHJldHVybiB4IGAke2AkJHN1YnNjcmliZV8ke25hbWV9YH0oJHt2YWx1ZSB8fCBuYW1lfSlgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbWVtYmVyID0gcmVuZGVyZXIuY29udGV4dF9sb29rdXAuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIHggYCR7YCQkc3Vic2NyaWJlXyR7bmFtZX1gfSgkJGludmFsaWRhdGUoJHttZW1iZXIuaW5kZXh9LCAke3ZhbHVlIHx8IG5hbWV9KSlgO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChuYW1lWzBdID09PSAnJCcgJiYgbmFtZVsxXSAhPT0gJyQnKSB7XG4gICAgICAgIHJldHVybiB4IGAke25hbWUuc2xpY2UoMSl9LnNldCgke3ZhbHVlIHx8IG5hbWV9KWA7XG4gICAgfVxuICAgIGlmICh2YXJpYWJsZSAmJiAodmFyaWFibGUubW9kdWxlIHx8ICghdmFyaWFibGUucmVmZXJlbmNlZCAmJlxuICAgICAgICAhdmFyaWFibGUuaXNfcmVhY3RpdmVfZGVwZW5kZW5jeSAmJlxuICAgICAgICAhdmFyaWFibGUuZXhwb3J0X25hbWUgJiZcbiAgICAgICAgIW5hbWUuc3RhcnRzV2l0aCgnJCQnKSkpKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSB8fCBuYW1lO1xuICAgIH1cbiAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgaWYgKG1haW5fZXhlY3V0aW9uX2NvbnRleHQpIHtcbiAgICAgICAgICAgIHJldHVybiB4IGAke3ZhbHVlfWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBtZW1iZXIgPSByZW5kZXJlci5jb250ZXh0X2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICByZXR1cm4geCBgJCRpbnZhbGlkYXRlKCR7bWVtYmVyLmluZGV4fSwgJHt2YWx1ZX0pYDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAobWFpbl9leGVjdXRpb25fY29udGV4dClcbiAgICAgICAgcmV0dXJuO1xuICAgIC8vIGlmIHRoaXMgaXMgYSByZWFjdGl2ZSBkZWNsYXJhdGlvbiwgaW52YWxpZGF0ZSBkZXBlbmRlbmNpZXMgcmVjdXJzaXZlbHlcbiAgICBjb25zdCBkZXBzID0gbmV3IFNldChbbmFtZV0pO1xuICAgIGRlcHMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgY29uc3QgcmVhY3RpdmVfZGVjbGFyYXRpb25zID0gcmVuZGVyZXIuY29tcG9uZW50LnJlYWN0aXZlX2RlY2xhcmF0aW9ucy5maWx0ZXIoeCA9PiB4LmFzc2lnbmVlcy5oYXMobmFtZSkpO1xuICAgICAgICByZWFjdGl2ZV9kZWNsYXJhdGlvbnMuZm9yRWFjaChkZWNsYXJhdGlvbiA9PiB7XG4gICAgICAgICAgICBkZWNsYXJhdGlvbi5kZXBlbmRlbmNpZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICBkZXBzLmFkZChuYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICAvLyBUT0RPIGlkZWFsbHkgZ2xvYmFscyBldGMgd291bGRuJ3QgYmUgaGVyZSBpbiB0aGUgZmlyc3QgcGxhY2VcbiAgICBjb25zdCBmaWx0ZXJlZCA9IEFycmF5LmZyb20oZGVwcykuZmlsdGVyKG4gPT4gcmVuZGVyZXIuY29udGV4dF9sb29rdXAuaGFzKG4pKTtcbiAgICBpZiAoIWZpbHRlcmVkLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIGZpbHRlcmVkXG4gICAgICAgIC5tYXAobiA9PiB4IGAkJGludmFsaWRhdGUoJHtyZW5kZXJlci5jb250ZXh0X2xvb2t1cC5nZXQobikuaW5kZXh9LCAke259KWApXG4gICAgICAgIC5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30sICR7cmhzfWApO1xufVxuXG5mdW5jdGlvbiByZXBsYWNlX29iamVjdChub2RlLCByZXBsYWNlbWVudCkge1xuICAgIGlmIChub2RlLnR5cGUgPT09ICdJZGVudGlmaWVyJylcbiAgICAgICAgcmV0dXJuIHJlcGxhY2VtZW50O1xuICAgIGNvbnN0IGFuY2VzdG9yID0gbm9kZTtcbiAgICBsZXQgcGFyZW50O1xuICAgIHdoaWxlIChub2RlLnR5cGUgPT09ICdNZW1iZXJFeHByZXNzaW9uJykge1xuICAgICAgICBwYXJlbnQgPSBub2RlO1xuICAgICAgICBub2RlID0gbm9kZS5vYmplY3Q7XG4gICAgfVxuICAgIHBhcmVudC5vYmplY3QgPSByZXBsYWNlbWVudDtcbiAgICByZXR1cm4gYW5jZXN0b3I7XG59XG5cbmZ1bmN0aW9uIGlzX2NvbnRleHR1YWwoY29tcG9uZW50LCBzY29wZSwgbmFtZSkge1xuICAgIGlmIChpc19yZXNlcnZlZF9rZXl3b3JkKG5hbWUpKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAvLyBpZiBpdCdzIGEgbmFtZSBiZWxvdyByb290IHNjb3BlLCBpdCdzIGNvbnRleHR1YWxcbiAgICBpZiAoIXNjb3BlLmlzX3RvcF9sZXZlbChuYW1lKSlcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgY29uc3QgdmFyaWFibGUgPSBjb21wb25lbnQudmFyX2xvb2t1cC5nZXQobmFtZSk7XG4gICAgLy8gaG9pc3RhYmxlcywgbW9kdWxlIGRlY2xhcmF0aW9ucywgYW5kIGltcG9ydHMgYXJlIG5vbi1jb250ZXh0dWFsXG4gICAgaWYgKCF2YXJpYWJsZSB8fCB2YXJpYWJsZS5ob2lzdGFibGUpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAvLyBhc3N1bWUgY29udGV4dHVhbFxuICAgIHJldHVybiB0cnVlO1xufVxuXG4vLyBhZGFwdGVkIGZyb20ga2xvbmEgdjIuMC40IC0gaHR0cHM6Ly9naXRodWIuY29tL2x1a2VlZC9rbG9uYVxuLy8gKGMpIEx1a2UgRWR3YXJkcywgdW5kZXIgTUlUIExpY2Vuc2Vcbi8vIFRoZSBzb2xlIG1vZGlmaWNhdGlvbiBpcyB0byBza2lwIGZ1bmN0aW9uIHZhbHVlcyBpbiBvYmplY3RzIHdoZW4gY2xvbmluZywgc28gd2UgZG9uJ3QgYnJlYWsgdGVzdHMuXG5mdW5jdGlvbiBjbG9uZSh2YWwpIHtcbiAgICBsZXQgaywgb3V0LCB0bXA7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgICBvdXQgPSBBcnJheShrID0gdmFsLmxlbmd0aCk7XG4gICAgICAgIHdoaWxlIChrLS0pXG4gICAgICAgICAgICBvdXRba10gPSAodG1wID0gdmFsW2tdKSAmJiB0eXBlb2YgdG1wID09PSAnb2JqZWN0JyA/IGNsb25lKHRtcCkgOiB0bXA7XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsKSA9PT0gJ1tvYmplY3QgT2JqZWN0XScpIHtcbiAgICAgICAgb3V0ID0ge307IC8vIG51bGxcbiAgICAgICAgZm9yIChrIGluIHZhbCkge1xuICAgICAgICAgICAgaWYgKGsgPT09ICdfX3Byb3RvX18nKSB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG91dCwgaywge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2xvbmUodmFsW2tdKSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbFtrXSAhPT0gJ2Z1bmN0aW9uJykgeyAvLyBNT0RJRklDQVRJT046IHNraXAgZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgb3V0W2tdID0gKHRtcCA9IHZhbFtrXSkgJiYgdHlwZW9mIHRtcCA9PT0gJ29iamVjdCcgPyBjbG9uZSh0bXApIDogdG1wO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuICAgIHJldHVybiB2YWw7XG59XG5cbi8vIEFsbCBjb21waWxlciBlcnJvcnMgc2hvdWxkIGJlIGxpc3RlZCBhbmQgYWNjZXNzZWQgZnJvbSBoZXJlXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG52YXIgY29tcGlsZXJfZXJyb3JzID0ge1xuICAgIGludmFsaWRfYmluZGluZ19lbGVtZW50czogKGVsZW1lbnQsIGJpbmRpbmcpID0+ICh7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWJpbmRpbmcnLFxuICAgICAgICBtZXNzYWdlOiBgJyR7YmluZGluZ30nIGlzIG5vdCBhIHZhbGlkIGJpbmRpbmcgb24gPCR7ZWxlbWVudH0+IGVsZW1lbnRzYFxuICAgIH0pLFxuICAgIGludmFsaWRfYmluZGluZ19lbGVtZW50X3dpdGg6IChlbGVtZW50cywgYmluZGluZykgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtYmluZGluZycsXG4gICAgICAgIG1lc3NhZ2U6IGAnJHtiaW5kaW5nfScgYmluZGluZyBjYW4gb25seSBiZSB1c2VkIHdpdGggJHtlbGVtZW50c31gXG4gICAgfSksXG4gICAgaW52YWxpZF9iaW5kaW5nX29uOiAoYmluZGluZywgZWxlbWVudCwgcG9zdCkgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtYmluZGluZycsXG4gICAgICAgIG1lc3NhZ2U6IGAnJHtiaW5kaW5nfScgaXMgbm90IGEgdmFsaWQgYmluZGluZyBvbiAke2VsZW1lbnR9YCArIChwb3N0IHx8ICcnKVxuICAgIH0pLFxuICAgIGludmFsaWRfYmluZGluZ19mb3JlaWduOiAoYmluZGluZykgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtYmluZGluZycsXG4gICAgICAgIG1lc3NhZ2U6IGAnJHtiaW5kaW5nfScgaXMgbm90IGEgdmFsaWQgYmluZGluZy4gRm9yZWlnbiBlbGVtZW50cyBvbmx5IHN1cHBvcnQgYmluZDp0aGlzYFxuICAgIH0pLFxuICAgIGludmFsaWRfYmluZGluZ19ub19jaGVja2JveDogKGJpbmRpbmcsIGlzX3JhZGlvKSA9PiAoe1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1iaW5kaW5nJyxcbiAgICAgICAgbWVzc2FnZTogYCcke2JpbmRpbmd9JyBiaW5kaW5nIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCI+YCArIChpc19yYWRpbyA/ICcg4oCUIGZvciA8aW5wdXQgdHlwZT1cInJhZGlvXCI+LCB1c2UgXFwnZ3JvdXBcXCcgYmluZGluZycgOiAnJylcbiAgICB9KSxcbiAgICBpbnZhbGlkX2JpbmRpbmc6IChiaW5kaW5nKSA9PiAoe1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1iaW5kaW5nJyxcbiAgICAgICAgbWVzc2FnZTogYCcke2JpbmRpbmd9JyBpcyBub3QgYSB2YWxpZCBiaW5kaW5nYFxuICAgIH0pLFxuICAgIGludmFsaWRfYmluZGluZ193aW5kb3c6IChwYXJ0cykgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtYmluZGluZycsXG4gICAgICAgIG1lc3NhZ2U6IGBCaW5kaW5ncyBvbiA8c3ZlbHRlOndpbmRvdz4gbXVzdCBiZSB0byB0b3AtbGV2ZWwgcHJvcGVydGllcywgZS5nLiAnJHtwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXX0nIHJhdGhlciB0aGFuICcke3BhcnRzLmpvaW4oJy4nKX0nYFxuICAgIH0pLFxuICAgIGludmFsaWRfYmluZGluZ19sZXQ6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtYmluZGluZycsXG4gICAgICAgIG1lc3NhZ2U6ICdDYW5ub3QgYmluZCB0byBhIHZhcmlhYmxlIGRlY2xhcmVkIHdpdGggdGhlIGxldDogZGlyZWN0aXZlJ1xuICAgIH0sXG4gICAgaW52YWxpZF9iaW5kaW5nX2F3YWl0OiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWJpbmRpbmcnLFxuICAgICAgICBtZXNzYWdlOiAnQ2Fubm90IGJpbmQgdG8gYSB2YXJpYWJsZSBkZWNsYXJlZCB3aXRoIHsjYXdhaXQgLi4uIHRoZW59IG9yIHs6Y2F0Y2h9IGJsb2NrcydcbiAgICB9LFxuICAgIGludmFsaWRfYmluZGluZ19jb25zdDoge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1iaW5kaW5nJyxcbiAgICAgICAgbWVzc2FnZTogJ0Nhbm5vdCBiaW5kIHRvIGEgdmFyaWFibGUgZGVjbGFyZWQgd2l0aCB7QGNvbnN0IC4uLn0nXG4gICAgfSxcbiAgICBpbnZhbGlkX2JpbmRpbmdfd3JpdGliYWxlOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWJpbmRpbmcnLFxuICAgICAgICBtZXNzYWdlOiAnQ2Fubm90IGJpbmQgdG8gYSB2YXJpYWJsZSB3aGljaCBpcyBub3Qgd3JpdGFibGUnXG4gICAgfSxcbiAgICBiaW5kaW5nX3VuZGVjbGFyZWQ6IChuYW1lKSA9PiAoe1xuICAgICAgICBjb2RlOiAnYmluZGluZy11bmRlY2xhcmVkJyxcbiAgICAgICAgbWVzc2FnZTogYCR7bmFtZX0gaXMgbm90IGRlY2xhcmVkYFxuICAgIH0pLFxuICAgIGludmFsaWRfdHlwZToge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC10eXBlJyxcbiAgICAgICAgbWVzc2FnZTogJ1xcJ3R5cGVcXCcgYXR0cmlidXRlIGNhbm5vdCBiZSBkeW5hbWljIGlmIGlucHV0IHVzZXMgdHdvLXdheSBiaW5kaW5nJ1xuICAgIH0sXG4gICAgbWlzc2luZ190eXBlOiB7XG4gICAgICAgIGNvZGU6ICdtaXNzaW5nLXR5cGUnLFxuICAgICAgICBtZXNzYWdlOiAnXFwndHlwZVxcJyBhdHRyaWJ1dGUgbXVzdCBiZSBzcGVjaWZpZWQnXG4gICAgfSxcbiAgICBkeW5hbWljX211bHRpcGxlX2F0dHJpYnV0ZToge1xuICAgICAgICBjb2RlOiAnZHluYW1pYy1tdWx0aXBsZS1hdHRyaWJ1dGUnLFxuICAgICAgICBtZXNzYWdlOiAnXFwnbXVsdGlwbGVcXCcgYXR0cmlidXRlIGNhbm5vdCBiZSBkeW5hbWljIGlmIHNlbGVjdCB1c2VzIHR3by13YXkgYmluZGluZydcbiAgICB9LFxuICAgIG1pc3NpbmdfY29udGVudGVkaXRhYmxlX2F0dHJpYnV0ZToge1xuICAgICAgICBjb2RlOiAnbWlzc2luZy1jb250ZW50ZWRpdGFibGUtYXR0cmlidXRlJyxcbiAgICAgICAgbWVzc2FnZTogJ1xcJ2NvbnRlbnRlZGl0YWJsZVxcJyBhdHRyaWJ1dGUgaXMgcmVxdWlyZWQgZm9yIHRleHRDb250ZW50IGFuZCBpbm5lckhUTUwgdHdvLXdheSBiaW5kaW5ncydcbiAgICB9LFxuICAgIGR5bmFtaWNfY29udGVudGVkaXRhYmxlX2F0dHJpYnV0ZToge1xuICAgICAgICBjb2RlOiAnZHluYW1pYy1jb250ZW50ZWRpdGFibGUtYXR0cmlidXRlJyxcbiAgICAgICAgbWVzc2FnZTogJ1xcJ2NvbnRlbnRlZGl0YWJsZVxcJyBhdHRyaWJ1dGUgY2Fubm90IGJlIGR5bmFtaWMgaWYgZWxlbWVudCB1c2VzIHR3by13YXkgYmluZGluZydcbiAgICB9LFxuICAgIGludmFsaWRfZXZlbnRfbW9kaWZpZXJfY29tYmluYXRpb246IChtb2RpZmllcjEsIG1vZGlmaWVyMikgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtZXZlbnQtbW9kaWZpZXInLFxuICAgICAgICBtZXNzYWdlOiBgVGhlICcke21vZGlmaWVyMX0nIGFuZCAnJHttb2RpZmllcjJ9JyBtb2RpZmllcnMgY2Fubm90IGJlIHVzZWQgdG9nZXRoZXJgXG4gICAgfSksXG4gICAgaW52YWxpZF9ldmVudF9tb2RpZmllcl9sZWdhY3k6IChtb2RpZmllcikgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtZXZlbnQtbW9kaWZpZXInLFxuICAgICAgICBtZXNzYWdlOiBgVGhlICcke21vZGlmaWVyfScgbW9kaWZpZXIgY2Fubm90IGJlIHVzZWQgaW4gbGVnYWN5IG1vZGVgXG4gICAgfSksXG4gICAgaW52YWxpZF9ldmVudF9tb2RpZmllcjogKHZhbGlkKSA9PiAoe1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1ldmVudC1tb2RpZmllcicsXG4gICAgICAgIG1lc3NhZ2U6IGBWYWxpZCBldmVudCBtb2RpZmllcnMgYXJlICR7dmFsaWR9YFxuICAgIH0pLFxuICAgIGludmFsaWRfZXZlbnRfbW9kaWZpZXJfY29tcG9uZW50OiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWV2ZW50LW1vZGlmaWVyJyxcbiAgICAgICAgbWVzc2FnZTogXCJFdmVudCBtb2RpZmllcnMgb3RoZXIgdGhhbiAnb25jZScgY2FuIG9ubHkgYmUgdXNlZCBvbiBET00gZWxlbWVudHNcIlxuICAgIH0sXG4gICAgdGV4dGFyZWFfZHVwbGljYXRlX3ZhbHVlOiB7XG4gICAgICAgIGNvZGU6ICd0ZXh0YXJlYS1kdXBsaWNhdGUtdmFsdWUnLFxuICAgICAgICBtZXNzYWdlOiAnQSA8dGV4dGFyZWE+IGNhbiBoYXZlIGVpdGhlciBhIHZhbHVlIGF0dHJpYnV0ZSBvciAoZXF1aXZhbGVudGx5KSBjaGlsZCBjb250ZW50LCBidXQgbm90IGJvdGgnXG4gICAgfSxcbiAgICBpbGxlZ2FsX2F0dHJpYnV0ZTogKG5hbWUpID0+ICh7XG4gICAgICAgIGNvZGU6ICdpbGxlZ2FsLWF0dHJpYnV0ZScsXG4gICAgICAgIG1lc3NhZ2U6IGAnJHtuYW1lfScgaXMgbm90IGEgdmFsaWQgYXR0cmlidXRlIG5hbWVgXG4gICAgfSksXG4gICAgaW52YWxpZF9zbG90X2F0dHJpYnV0ZToge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1zbG90LWF0dHJpYnV0ZScsXG4gICAgICAgIG1lc3NhZ2U6ICdzbG90IGF0dHJpYnV0ZSBjYW5ub3QgaGF2ZSBhIGR5bmFtaWMgdmFsdWUnXG4gICAgfSxcbiAgICBkdXBsaWNhdGVfc2xvdF9hdHRyaWJ1dGU6IChuYW1lKSA9PiAoe1xuICAgICAgICBjb2RlOiAnZHVwbGljYXRlLXNsb3QtYXR0cmlidXRlJyxcbiAgICAgICAgbWVzc2FnZTogYER1cGxpY2F0ZSAnJHtuYW1lfScgc2xvdGBcbiAgICB9KSxcbiAgICBpbnZhbGlkX3Nsb3R0ZWRfY29udGVudDoge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1zbG90dGVkLWNvbnRlbnQnLFxuICAgICAgICBtZXNzYWdlOiAnRWxlbWVudCB3aXRoIGEgc2xvdD1cXCcuLi5cXCcgYXR0cmlidXRlIG11c3QgYmUgYSBjaGlsZCBvZiBhIGNvbXBvbmVudCBvciBhIGRlc2NlbmRhbnQgb2YgYSBjdXN0b20gZWxlbWVudCdcbiAgICB9LFxuICAgIGludmFsaWRfYXR0cmlidXRlX2hlYWQ6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtYXR0cmlidXRlJyxcbiAgICAgICAgbWVzc2FnZTogJzxzdmVsdGU6aGVhZD4gc2hvdWxkIG5vdCBoYXZlIGFueSBhdHRyaWJ1dGVzIG9yIGRpcmVjdGl2ZXMnXG4gICAgfSxcbiAgICBpbnZhbGlkX2FjdGlvbjoge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1hY3Rpb24nLFxuICAgICAgICBtZXNzYWdlOiAnQWN0aW9ucyBjYW4gb25seSBiZSBhcHBsaWVkIHRvIERPTSBlbGVtZW50cywgbm90IGNvbXBvbmVudHMnXG4gICAgfSxcbiAgICBpbnZhbGlkX2NsYXNzOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWNsYXNzJyxcbiAgICAgICAgbWVzc2FnZTogJ0NsYXNzZXMgY2FuIG9ubHkgYmUgYXBwbGllZCB0byBET00gZWxlbWVudHMsIG5vdCBjb21wb25lbnRzJ1xuICAgIH0sXG4gICAgaW52YWxpZF90cmFuc2l0aW9uOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLXRyYW5zaXRpb24nLFxuICAgICAgICBtZXNzYWdlOiAnVHJhbnNpdGlvbnMgY2FuIG9ubHkgYmUgYXBwbGllZCB0byBET00gZWxlbWVudHMsIG5vdCBjb21wb25lbnRzJ1xuICAgIH0sXG4gICAgaW52YWxpZF9sZXQ6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtbGV0JyxcbiAgICAgICAgbWVzc2FnZTogJ2xldCBkaXJlY3RpdmUgdmFsdWUgbXVzdCBiZSBhbiBpZGVudGlmaWVyIG9yIGFuIG9iamVjdC9hcnJheSBwYXR0ZXJuJ1xuICAgIH0sXG4gICAgaW52YWxpZF9zbG90X2RpcmVjdGl2ZToge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1zbG90LWRpcmVjdGl2ZScsXG4gICAgICAgIG1lc3NhZ2U6ICc8c2xvdD4gY2Fubm90IGhhdmUgZGlyZWN0aXZlcydcbiAgICB9LFxuICAgIGR5bmFtaWNfc2xvdF9uYW1lOiB7XG4gICAgICAgIGNvZGU6ICdkeW5hbWljLXNsb3QtbmFtZScsXG4gICAgICAgIG1lc3NhZ2U6ICc8c2xvdD4gbmFtZSBjYW5ub3QgYmUgZHluYW1pYydcbiAgICB9LFxuICAgIGludmFsaWRfc2xvdF9uYW1lOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLXNsb3QtbmFtZScsXG4gICAgICAgIG1lc3NhZ2U6ICdkZWZhdWx0IGlzIGEgcmVzZXJ2ZWQgd29yZCDigJQgaXQgY2Fubm90IGJlIHVzZWQgYXMgYSBzbG90IG5hbWUnXG4gICAgfSxcbiAgICBpbnZhbGlkX3Nsb3RfYXR0cmlidXRlX3ZhbHVlX21pc3Npbmc6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtc2xvdC1hdHRyaWJ1dGUnLFxuICAgICAgICBtZXNzYWdlOiAnc2xvdCBhdHRyaWJ1dGUgdmFsdWUgaXMgbWlzc2luZydcbiAgICB9LFxuICAgIGludmFsaWRfc2xvdHRlZF9jb250ZW50X2ZyYWdtZW50OiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLXNsb3R0ZWQtY29udGVudCcsXG4gICAgICAgIG1lc3NhZ2U6ICc8c3ZlbHRlOmZyYWdtZW50PiBtdXN0IGJlIGEgY2hpbGQgb2YgYSBjb21wb25lbnQnXG4gICAgfSxcbiAgICBpbGxlZ2FsX2F0dHJpYnV0ZV90aXRsZToge1xuICAgICAgICBjb2RlOiAnaWxsZWdhbC1hdHRyaWJ1dGUnLFxuICAgICAgICBtZXNzYWdlOiAnPHRpdGxlPiBjYW5ub3QgaGF2ZSBhdHRyaWJ1dGVzJ1xuICAgIH0sXG4gICAgaWxsZWdhbF9zdHJ1Y3R1cmVfdGl0bGU6IHtcbiAgICAgICAgY29kZTogJ2lsbGVnYWwtc3RydWN0dXJlJyxcbiAgICAgICAgbWVzc2FnZTogJzx0aXRsZT4gY2FuIG9ubHkgY29udGFpbiB0ZXh0IGFuZCB7dGFnc30nXG4gICAgfSxcbiAgICBkdXBsaWNhdGVfdHJhbnNpdGlvbjogKGRpcmVjdGl2ZSwgcGFyZW50X2RpcmVjdGl2ZSkgPT4ge1xuICAgICAgICBmdW5jdGlvbiBkZXNjcmliZShfZGlyZWN0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4gX2RpcmVjdGl2ZSA9PT0gJ3RyYW5zaXRpb24nXG4gICAgICAgICAgICAgICAgPyBcImEgJ3RyYW5zaXRpb24nXCJcbiAgICAgICAgICAgICAgICA6IGBhbiAnJHtfZGlyZWN0aXZlfSdgO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkaXJlY3RpdmUgPT09IHBhcmVudF9kaXJlY3RpdmVcbiAgICAgICAgICAgID8gYEFuIGVsZW1lbnQgY2FuIG9ubHkgaGF2ZSBvbmUgJyR7ZGlyZWN0aXZlfScgZGlyZWN0aXZlYFxuICAgICAgICAgICAgOiBgQW4gZWxlbWVudCBjYW5ub3QgaGF2ZSBib3RoICR7ZGVzY3JpYmUocGFyZW50X2RpcmVjdGl2ZSl9IGRpcmVjdGl2ZSBhbmQgJHtkZXNjcmliZShkaXJlY3RpdmUpfSBkaXJlY3RpdmVgO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29kZTogJ2R1cGxpY2F0ZS10cmFuc2l0aW9uJyxcbiAgICAgICAgICAgIG1lc3NhZ2VcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGNvbnRleHR1YWxfc3RvcmU6IHtcbiAgICAgICAgY29kZTogJ2NvbnRleHR1YWwtc3RvcmUnLFxuICAgICAgICBtZXNzYWdlOiAnU3RvcmVzIG11c3QgYmUgZGVjbGFyZWQgYXQgdGhlIHRvcCBsZXZlbCBvZiB0aGUgY29tcG9uZW50ICh0aGlzIG1heSBjaGFuZ2UgaW4gYSBmdXR1cmUgdmVyc2lvbiBvZiBTdmVsdGUpJ1xuICAgIH0sXG4gICAgZGVmYXVsdF9leHBvcnQ6IHtcbiAgICAgICAgY29kZTogJ2RlZmF1bHQtZXhwb3J0JyxcbiAgICAgICAgbWVzc2FnZTogJ0EgY29tcG9uZW50IGNhbm5vdCBoYXZlIGEgZGVmYXVsdCBleHBvcnQnXG4gICAgfSxcbiAgICBpbGxlZ2FsX2RlY2xhcmF0aW9uOiB7XG4gICAgICAgIGNvZGU6ICdpbGxlZ2FsLWRlY2xhcmF0aW9uJyxcbiAgICAgICAgbWVzc2FnZTogJ1RoZSAkIHByZWZpeCBpcyByZXNlcnZlZCwgYW5kIGNhbm5vdCBiZSB1c2VkIGZvciB2YXJpYWJsZSBhbmQgaW1wb3J0IG5hbWVzJ1xuICAgIH0sXG4gICAgaWxsZWdhbF9zdWJzY3JpcHRpb246IHtcbiAgICAgICAgY29kZTogJ2lsbGVnYWwtc3Vic2NyaXB0aW9uJyxcbiAgICAgICAgbWVzc2FnZTogJ0Nhbm5vdCByZWZlcmVuY2Ugc3RvcmUgdmFsdWUgaW5zaWRlIDxzY3JpcHQgY29udGV4dD1cIm1vZHVsZVwiPidcbiAgICB9LFxuICAgIGlsbGVnYWxfZ2xvYmFsOiAobmFtZSkgPT4gKHtcbiAgICAgICAgY29kZTogJ2lsbGVnYWwtZ2xvYmFsJyxcbiAgICAgICAgbWVzc2FnZTogYCR7bmFtZX0gaXMgYW4gaWxsZWdhbCB2YXJpYWJsZSBuYW1lYFxuICAgIH0pLFxuICAgIGN5Y2xpY2FsX3JlYWN0aXZlX2RlY2xhcmF0aW9uOiAoY3ljbGUpID0+ICh7XG4gICAgICAgIGNvZGU6ICdjeWNsaWNhbC1yZWFjdGl2ZS1kZWNsYXJhdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6IGBDeWNsaWNhbCBkZXBlbmRlbmN5IGRldGVjdGVkOiAke2N5Y2xlLmpvaW4oJyDihpIgJyl9YFxuICAgIH0pLFxuICAgIGludmFsaWRfdGFnX3Byb3BlcnR5OiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLXRhZy1wcm9wZXJ0eScsXG4gICAgICAgIG1lc3NhZ2U6IFwidGFnIG5hbWUgbXVzdCBiZSB0d28gb3IgbW9yZSB3b3JkcyBqb2luZWQgYnkgdGhlICctJyBjaGFyYWN0ZXJcIlxuICAgIH0sXG4gICAgaW52YWxpZF90YWdfYXR0cmlidXRlOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLXRhZy1hdHRyaWJ1dGUnLFxuICAgICAgICBtZXNzYWdlOiBcIid0YWcnIG11c3QgYmUgYSBzdHJpbmcgbGl0ZXJhbFwiXG4gICAgfSxcbiAgICBpbnZhbGlkX25hbWVzcGFjZV9wcm9wZXJ0eTogKG5hbWVzcGFjZSwgc3VnZ2VzdGlvbikgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtbmFtZXNwYWNlLXByb3BlcnR5JyxcbiAgICAgICAgbWVzc2FnZTogYEludmFsaWQgbmFtZXNwYWNlICcke25hbWVzcGFjZX0nYCArIChzdWdnZXN0aW9uID8gYCAoZGlkIHlvdSBtZWFuICcke3N1Z2dlc3Rpb259Jz8pYCA6ICcnKVxuICAgIH0pLFxuICAgIGludmFsaWRfbmFtZXNwYWNlX2F0dHJpYnV0ZToge1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1uYW1lc3BhY2UtYXR0cmlidXRlJyxcbiAgICAgICAgbWVzc2FnZTogXCJUaGUgJ25hbWVzcGFjZScgYXR0cmlidXRlIG11c3QgYmUgYSBzdHJpbmcgbGl0ZXJhbCByZXByZXNlbnRpbmcgYSB2YWxpZCBuYW1lc3BhY2VcIlxuICAgIH0sXG4gICAgaW52YWxpZF9hdHRyaWJ1dGVfdmFsdWU6IChuYW1lKSA9PiAoe1xuICAgICAgICBjb2RlOiBgaW52YWxpZC0ke25hbWV9LXZhbHVlYCxcbiAgICAgICAgbWVzc2FnZTogYCR7bmFtZX0gYXR0cmlidXRlIG11c3QgYmUgdHJ1ZSBvciBmYWxzZWBcbiAgICB9KSxcbiAgICBpbnZhbGlkX29wdGlvbnNfYXR0cmlidXRlX3Vua25vd246IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtb3B0aW9ucy1hdHRyaWJ1dGUnLFxuICAgICAgICBtZXNzYWdlOiAnPHN2ZWx0ZTpvcHRpb25zPiB1bmtub3duIGF0dHJpYnV0ZSdcbiAgICB9LFxuICAgIGludmFsaWRfb3B0aW9uc19hdHRyaWJ1dGU6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtb3B0aW9ucy1hdHRyaWJ1dGUnLFxuICAgICAgICBtZXNzYWdlOiBcIjxzdmVsdGU6b3B0aW9ucz4gY2FuIG9ubHkgaGF2ZSBzdGF0aWMgJ3RhZycsICduYW1lc3BhY2UnLCAnYWNjZXNzb3JzJywgJ2ltbXV0YWJsZScgYW5kICdwcmVzZXJ2ZVdoaXRlc3BhY2UnIGF0dHJpYnV0ZXNcIlxuICAgIH0sXG4gICAgY3NzX2ludmFsaWRfZ2xvYmFsOiB7XG4gICAgICAgIGNvZGU6ICdjc3MtaW52YWxpZC1nbG9iYWwnLFxuICAgICAgICBtZXNzYWdlOiAnOmdsb2JhbCguLi4pIGNhbiBiZSBhdCB0aGUgc3RhcnQgb3IgZW5kIG9mIGEgc2VsZWN0b3Igc2VxdWVuY2UsIGJ1dCBub3QgaW4gdGhlIG1pZGRsZSdcbiAgICB9LFxuICAgIGNzc19pbnZhbGlkX2dsb2JhbF9zZWxlY3Rvcjoge1xuICAgICAgICBjb2RlOiAnY3NzLWludmFsaWQtZ2xvYmFsLXNlbGVjdG9yJyxcbiAgICAgICAgbWVzc2FnZTogJzpnbG9iYWwoLi4uKSBtdXN0IGNvbnRhaW4gYSBzaW5nbGUgc2VsZWN0b3InXG4gICAgfSxcbiAgICBkdXBsaWNhdGVfYW5pbWF0aW9uOiB7XG4gICAgICAgIGNvZGU6ICdkdXBsaWNhdGUtYW5pbWF0aW9uJyxcbiAgICAgICAgbWVzc2FnZTogXCJBbiBlbGVtZW50IGNhbiBvbmx5IGhhdmUgb25lICdhbmltYXRlJyBkaXJlY3RpdmVcIlxuICAgIH0sXG4gICAgaW52YWxpZF9hbmltYXRpb25faW1tZWRpYXRlOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWFuaW1hdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6ICdBbiBlbGVtZW50IHRoYXQgdXNlcyB0aGUgYW5pbWF0ZSBkaXJlY3RpdmUgbXVzdCBiZSB0aGUgaW1tZWRpYXRlIGNoaWxkIG9mIGEga2V5ZWQgZWFjaCBibG9jaydcbiAgICB9LFxuICAgIGludmFsaWRfYW5pbWF0aW9uX3NvbGU6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtYW5pbWF0aW9uJyxcbiAgICAgICAgbWVzc2FnZTogJ0FuIGVsZW1lbnQgdGhhdCB1c2VzIHRoZSBhbmltYXRlIGRpcmVjdGl2ZSBtdXN0IGJlIHRoZSBzb2xlIGNoaWxkIG9mIGEga2V5ZWQgZWFjaCBibG9jaydcbiAgICB9LFxuICAgIGludmFsaWRfZGlyZWN0aXZlX3ZhbHVlOiB7XG4gICAgICAgIGNvZGU6ICdpbnZhbGlkLWRpcmVjdGl2ZS12YWx1ZScsXG4gICAgICAgIG1lc3NhZ2U6ICdDYW4gb25seSBiaW5kIHRvIGFuIGlkZW50aWZpZXIgKGUuZy4gYGZvb2ApIG9yIGEgbWVtYmVyIGV4cHJlc3Npb24gKGUuZy4gYGZvby5iYXJgIG9yIGBmb29bYmF6XWApJ1xuICAgIH0sXG4gICAgaW52YWxpZF9jb25zdF9wbGFjZW1lbnQ6IHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtY29uc3QtcGxhY2VtZW50JyxcbiAgICAgICAgbWVzc2FnZTogJ3tAY29uc3R9IG11c3QgYmUgdGhlIGltbWVkaWF0ZSBjaGlsZCBvZiB7I2VhY2h9LCB7OnRoZW59LCB7OmNhdGNofSwgPHN2ZWx0ZTpmcmFnbWVudD4gb3IgPENvbXBvbmVudD4nXG4gICAgfSxcbiAgICBpbnZhbGlkX2NvbnN0X2RlY2xhcmF0aW9uOiAobmFtZSkgPT4gKHtcbiAgICAgICAgY29kZTogJ2ludmFsaWQtY29uc3QtZGVjbGFyYXRpb24nLFxuICAgICAgICBtZXNzYWdlOiBgJyR7bmFtZX0nIGhhcyBhbHJlYWR5IGJlZW4gZGVjbGFyZWRgXG4gICAgfSksXG4gICAgaW52YWxpZF9jb25zdF91cGRhdGU6IChuYW1lKSA9PiAoe1xuICAgICAgICBjb2RlOiAnaW52YWxpZC1jb25zdC11cGRhdGUnLFxuICAgICAgICBtZXNzYWdlOiBgJyR7bmFtZX0nIGlzIGRlY2xhcmVkIHVzaW5nIHtAY29uc3QgLi4ufSBhbmQgaXMgcmVhZC1vbmx5YFxuICAgIH0pLFxuICAgIGN5Y2xpY2FsX2NvbnN0X3RhZ3M6IChjeWNsZSkgPT4gKHtcbiAgICAgICAgY29kZTogJ2N5Y2xpY2FsLWNvbnN0LXRhZ3MnLFxuICAgICAgICBtZXNzYWdlOiBgQ3ljbGljYWwgZGVwZW5kZW5jeSBkZXRlY3RlZDogJHtjeWNsZS5qb2luKCcg4oaSICcpfWBcbiAgICB9KVxufTtcblxuY2xhc3MgRXhwcmVzc2lvbiB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBvd25lciwgdGVtcGxhdGVfc2NvcGUsIGluZm8sIGxhenkpIHtcbiAgICAgICAgdGhpcy50eXBlID0gJ0V4cHJlc3Npb24nO1xuICAgICAgICB0aGlzLnJlZmVyZW5jZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLmNvbnRleHR1YWxfZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLmRlY2xhcmF0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLnVzZXNfY29udGV4dCA9IGZhbHNlO1xuICAgICAgICAvLyBUT0RPIHJldmVydCB0byBkaXJlY3QgcHJvcGVydHkgYWNjZXNzIGluIHByb2Q/XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHtcbiAgICAgICAgICAgIGNvbXBvbmVudDoge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBjb21wb25lbnRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubm9kZSA9IGluZm87XG4gICAgICAgIHRoaXMudGVtcGxhdGVfc2NvcGUgPSB0ZW1wbGF0ZV9zY29wZTtcbiAgICAgICAgdGhpcy5vd25lciA9IG93bmVyO1xuICAgICAgICBjb25zdCB7IGRlcGVuZGVuY2llcywgY29udGV4dHVhbF9kZXBlbmRlbmNpZXMsIHJlZmVyZW5jZXMgfSA9IHRoaXM7XG4gICAgICAgIGxldCB7IG1hcCwgc2NvcGUgfSA9IGNyZWF0ZV9zY29wZXMoaW5mbyk7XG4gICAgICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcbiAgICAgICAgdGhpcy5zY29wZV9tYXAgPSBtYXA7XG4gICAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSB0aGlzO1xuICAgICAgICBsZXQgZnVuY3Rpb25fZXhwcmVzc2lvbjtcbiAgICAgICAgLy8gZGlzY292ZXIgZGVwZW5kZW5jaWVzLCBidXQgZG9uJ3QgY2hhbmdlIHRoZSBjb2RlIHlldFxuICAgICAgICB3YWxrKGluZm8sIHtcbiAgICAgICAgICAgIGVudGVyKG5vZGUsIHBhcmVudCwga2V5KSB7XG4gICAgICAgICAgICAgICAgLy8gZG9uJ3QgbWFuaXB1bGF0ZSBzaG9ydGhhbmQgcHJvcHMgdHdpY2VcbiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAna2V5JyAmJiBwYXJlbnQuc2hvcnRoYW5kKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgLy8gZG9uJ3QgbWFuaXB1bGF0ZSBgaW1wb3J0Lm1ldGFgLCBgbmV3LnRhcmdldGBcbiAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnTWV0YVByb3BlcnR5JylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2tpcCgpO1xuICAgICAgICAgICAgICAgIGlmIChtYXAuaGFzKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlID0gbWFwLmdldChub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFmdW5jdGlvbl9leHByZXNzaW9uICYmIC9GdW5jdGlvbkV4cHJlc3Npb24vLnRlc3Qobm9kZS50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbl9leHByZXNzaW9uID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGlzX3JlZmVyZW5jZShub2RlLCBwYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgbmFtZSwgbm9kZXMgfSA9IGZsYXR0ZW5fcmVmZXJlbmNlKG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VzLmFkZChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmhhcyhuYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVbMF0gPT09ICckJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RvcmVfbmFtZSA9IG5hbWUuc2xpY2UoMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcGxhdGVfc2NvcGUubmFtZXMuaGFzKHN0b3JlX25hbWUpIHx8IHNjb3BlLmhhcyhzdG9yZV9uYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3Iobm9kZSwgY29tcGlsZXJfZXJyb3JzLmNvbnRleHR1YWxfc3RvcmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wbGF0ZV9zY29wZS5pc19sZXQobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25fZXhwcmVzc2lvbikgeyAvLyBUT0RPIHNob3VsZCB0aGlzIGJlIGAhbGF6eWAgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHR1YWxfZGVwZW5kZW5jaWVzLmFkZChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMuYWRkKG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRlbXBsYXRlX3Njb3BlLm5hbWVzLmhhcyhuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbi51c2VzX2NvbnRleHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dHVhbF9kZXBlbmRlbmNpZXMuYWRkKG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3duZXIgPSB0ZW1wbGF0ZV9zY29wZS5nZXRfb3duZXIobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc19pbmRleCA9IG93bmVyLnR5cGUgPT09ICdFYWNoQmxvY2snICYmIG93bmVyLmtleSAmJiBuYW1lID09PSBvd25lci5pbmRleDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbGF6eSB8fCBpc19pbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlX3Njb3BlLmRlcGVuZGVuY2llc19mb3JfbmFtZS5nZXQobmFtZSkuZm9yRWFjaChuYW1lID0+IGRlcGVuZGVuY2llcy5hZGQobmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFsYXp5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmFkZChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5hZGRfcmVmZXJlbmNlKG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lndhcm5faWZfdW5kZWZpbmVkKG5hbWUsIG5vZGVzWzBdLCB0ZW1wbGF0ZV9zY29wZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5za2lwKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHRyYWNrIGFueSBhc3NpZ25tZW50cyBmcm9tIHRlbXBsYXRlIGV4cHJlc3Npb25zIGFzIG11dGFibGVcbiAgICAgICAgICAgICAgICBsZXQgbmFtZXM7XG4gICAgICAgICAgICAgICAgbGV0IGRlZXAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoZnVuY3Rpb25fZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnQXNzaWdubWVudEV4cHJlc3Npb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWVwID0gbm9kZS5sZWZ0LnR5cGUgPT09ICdNZW1iZXJFeHByZXNzaW9uJztcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzID0gZXh0cmFjdF9uYW1lcyhkZWVwID8gZ2V0X29iamVjdChub2RlLmxlZnQpIDogbm9kZS5sZWZ0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdVcGRhdGVFeHByZXNzaW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXMgPSBleHRyYWN0X25hbWVzKGdldF9vYmplY3Qobm9kZS5hcmd1bWVudCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChuYW1lcykge1xuICAgICAgICAgICAgICAgICAgICBuYW1lcy5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBsYXRlX3Njb3BlLm5hbWVzLmhhcyhuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wbGF0ZV9zY29wZS5pc19jb25zdChuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQuZXJyb3Iobm9kZSwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfY29uc3RfdXBkYXRlKG5hbWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVfc2NvcGUuZGVwZW5kZW5jaWVzX2Zvcl9uYW1lLmdldChuYW1lKS5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IGNvbXBvbmVudC52YXJfbG9va3VwLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVbZGVlcCA/ICdtdXRhdGVkJyA6ICdyZWFzc2lnbmVkJ10gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVhY2hfYmxvY2sgPSB0ZW1wbGF0ZV9zY29wZS5nZXRfb3duZXIobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWFjaF9ibG9jay5oYXNfYmluZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQuYWRkX3JlZmVyZW5jZShuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IGNvbXBvbmVudC52YXJfbG9va3VwLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFyaWFibGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlW2RlZXAgPyAnbXV0YXRlZCcgOiAncmVhc3NpZ25lZCddID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlYXZlKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAobWFwLmhhcyhub2RlKSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZSA9IHNjb3BlLnBhcmVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUgPT09IGZ1bmN0aW9uX2V4cHJlc3Npb24pIHtcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25fZXhwcmVzc2lvbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZHluYW1pY19kZXBlbmRlbmNpZXMoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZGVwZW5kZW5jaWVzKS5maWx0ZXIobmFtZSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy50ZW1wbGF0ZV9zY29wZS5pc19sZXQobmFtZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICBpZiAoaXNfcmVzZXJ2ZWRfa2V5d29yZChuYW1lKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gdGhpcy5jb21wb25lbnQudmFyX2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gaXNfZHluYW1pYyh2YXJpYWJsZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBUT0RPIG1vdmUgdGhpcyBpbnRvIGEgcmVuZGVyLWRvbSB3cmFwcGVyP1xuICAgIG1hbmlwdWxhdGUoYmxvY2ssIGN0eCkge1xuICAgICAgICAvLyBUT0RPIGlkZWFsbHkgd2Ugd291bGRuJ3QgZW5kIHVwIGNhbGxpbmcgdGhpcyBtZXRob2RcbiAgICAgICAgLy8gbXVsdGlwbGUgdGltZXNcbiAgICAgICAgaWYgKHRoaXMubWFuaXB1bGF0ZWQpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tYW5pcHVsYXRlZDtcbiAgICAgICAgY29uc3QgeyBjb21wb25lbnQsIGRlY2xhcmF0aW9ucywgc2NvcGVfbWFwOiBtYXAsIHRlbXBsYXRlX3Njb3BlLCBvd25lciB9ID0gdGhpcztcbiAgICAgICAgbGV0IHNjb3BlID0gdGhpcy5zY29wZTtcbiAgICAgICAgbGV0IGZ1bmN0aW9uX2V4cHJlc3Npb247XG4gICAgICAgIGxldCBkZXBlbmRlbmNpZXM7XG4gICAgICAgIGxldCBjb250ZXh0dWFsX2RlcGVuZGVuY2llcztcbiAgICAgICAgY29uc3Qgbm9kZSA9IHdhbGsodGhpcy5ub2RlLCB7XG4gICAgICAgICAgICBlbnRlcihub2RlLCBwYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnUHJvcGVydHknICYmIG5vZGUuc2hvcnRoYW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUudmFsdWUgPSBjbG9uZShub2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5zaG9ydGhhbmQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1hcC5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBtYXAuZ2V0KG5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnSWRlbnRpZmllcicgJiYgaXNfcmVmZXJlbmNlKG5vZGUsIHBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBmbGF0dGVuX3JlZmVyZW5jZShub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmhhcyhuYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZ1bmN0aW9uX2V4cHJlc3Npb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wbGF0ZV9zY29wZS5uYW1lcy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0dWFsX2RlcGVuZGVuY2llcy5hZGQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVfc2NvcGUuZGVwZW5kZW5jaWVzX2Zvcl9uYW1lLmdldChuYW1lKS5mb3JFYWNoKGRlcGVuZGVuY3kgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMuYWRkKGRlcGVuZGVuY3kpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmFkZChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQuYWRkX3JlZmVyZW5jZShuYW1lKTsgLy8gVE9ETyBpcyB0aGlzIHJlZHVuZGFudC9taXNwbGFjZWQ/XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNfY29udGV4dHVhbChjb21wb25lbnQsIHRlbXBsYXRlX3Njb3BlLCBuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVmZXJlbmNlID0gYmxvY2sucmVuZGVyZXIucmVmZXJlbmNlKG5vZGUsIGN0eCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2UocmVmZXJlbmNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNraXAoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFmdW5jdGlvbl9leHByZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdBc3NpZ25tZW50RXhwcmVzc2lvbicpIDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0Z1bmN0aW9uRXhwcmVzc2lvbicgfHwgbm9kZS50eXBlID09PSAnQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbl9leHByZXNzaW9uID0gbm9kZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHR1YWxfZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlYXZlKG5vZGUsIHBhcmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChtYXAuaGFzKG5vZGUpKVxuICAgICAgICAgICAgICAgICAgICBzY29wZSA9IHNjb3BlLnBhcmVudDtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSA9PT0gZnVuY3Rpb25fZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZCA9IGNvbXBvbmVudC5nZXRfdW5pcXVlX25hbWUoc2FuaXRpemUoZ2V0X2Z1bmN0aW9uX25hbWUobm9kZSwgb3duZXIpKSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlY2xhcmF0aW9uID0gYiBgY29uc3QgJHtpZH0gPSAke25vZGV9YDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlcGVuZGVuY2llcy5zaXplID09PSAwICYmIGNvbnRleHR1YWxfZGVwZW5kZW5jaWVzLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGNhbiBob2lzdCB0aGlzIG91dCBvZiB0aGUgY29tcG9uZW50IGNvbXBsZXRlbHlcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5mdWxseV9ob2lzdGVkLnB1c2goZGVjbGFyYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBsYWNlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5hZGRfdmFyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBpZC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVybmFsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvaXN0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VkOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjb250ZXh0dWFsX2RlcGVuZGVuY2llcy5zaXplID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBmdW5jdGlvbiBjYW4gYmUgaG9pc3RlZCBpbnNpZGUgdGhlIGNvbXBvbmVudCBpbml0XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQucGFydGx5X2hvaXN0ZWQucHVzaChkZWNsYXJhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5yZW5kZXJlci5hZGRfdG9fY29udGV4dChpZC5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZShibG9jay5yZW5kZXJlci5yZWZlcmVuY2UoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgYSBjb21ibyBibG9jay9pbml0IHJlY2lwZVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVwcyA9IEFycmF5LmZyb20oY29udGV4dHVhbF9kZXBlbmRlbmNpZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25fZXhwcmVzc2lvbiA9IG5vZGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNfYXJncyA9IGZ1bmN0aW9uX2V4cHJlc3Npb24ucGFyYW1zLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbl9leHByZXNzaW9uLnBhcmFtcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5kZXBzLm1hcChuYW1lID0+ICh7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZSB9KSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZnVuY3Rpb25fZXhwcmVzc2lvbi5wYXJhbXNcbiAgICAgICAgICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZXh0X2FyZ3MgPSBkZXBzLm1hcChuYW1lID0+IGJsb2NrLnJlbmRlcmVyLnJlZmVyZW5jZShuYW1lKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQucGFydGx5X2hvaXN0ZWQucHVzaChkZWNsYXJhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5yZW5kZXJlci5hZGRfdG9fY29udGV4dChpZC5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxlZSA9IGJsb2NrLnJlbmRlcmVyLnJlZmVyZW5jZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2UoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnVuY19kZWNsYXJhdGlvbiA9IGhhc19hcmdzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBiIGBmdW5jdGlvbiAke2lkfSguLi5hcmdzKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuICR7Y2FsbGVlfSgke2NvbnRleHRfYXJnc30sIC4uLmFyZ3MpO1xuXHRcdFx0XHRcdFx0XHR9YFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogYiBgZnVuY3Rpb24gJHtpZH0oKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuICR7Y2FsbGVlfSgke2NvbnRleHRfYXJnc30pO1xuXHRcdFx0XHRcdFx0XHR9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvd25lci50eXBlID09PSAnQXR0cmlidXRlJyAmJiBvd25lci5wYXJlbnQubmFtZSA9PT0gJ3Nsb3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVwX3Njb3BlcyA9IG5ldyBTZXQoZGVwcy5tYXAobmFtZSA9PiB0ZW1wbGF0ZV9zY29wZS5nZXRfb3duZXIobmFtZSkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBuZWFyZXN0IHNjb3Blc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBub2RlID0gb3duZXIucGFyZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChub2RlICYmICFkZXBfc2NvcGVzLmhhcyhub2RlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmNfZXhwcmVzc2lvbiA9IGZ1bmNfZGVjbGFyYXRpb25bMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0lubGluZUNvbXBvbmVudCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPENvbXAgbGV0OmRhdGEgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBsYWNlKGZ1bmNfZXhwcmVzc2lvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB7I2VhY2h9LCB7I2F3YWl0fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdW5jX2lkID0gY29tcG9uZW50LmdldF91bmlxdWVfbmFtZShpZC5uYW1lICsgJ19mdW5jJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrLnJlbmRlcmVyLmFkZF90b19jb250ZXh0KGZ1bmNfaWQubmFtZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbmFtZSAjY3R4IC0+IGNoaWxkX2N0eDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FsayhmdW5jX2V4cHJlc3Npb24sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudGVyKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnSWRlbnRpZmllcicgJiYgbm9kZS5uYW1lID09PSAnI2N0eCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5uYW1lID0gJ2NoaWxkX2N0eCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRvIGdldF94eHhfY29udGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGlsZF9jdHhbeF0gPSBmdW5jdGlvbiAoKSB7IC4uLiB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlX3Njb3BlLmdldF9vd25lcihkZXBzWzBdKS5jb250ZXh0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleTogZnVuY19pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVyOiAoKSA9PiBmdW5jX2V4cHJlc3Npb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0X21vZGlmaWVyOiBub2RlID0+IG5vZGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZShibG9jay5yZW5kZXJlci5yZWZlcmVuY2UoZnVuY19pZCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9ucy5wdXNoKGZ1bmNfZGVjbGFyYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uX2V4cHJlc3Npb24gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0dWFsX2RlcGVuZGVuY2llcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50LnR5cGUgPT09ICdQcm9wZXJ0eScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5tZXRob2QgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnQXNzaWdubWVudEV4cHJlc3Npb24nIHx8IG5vZGUudHlwZSA9PT0gJ1VwZGF0ZUV4cHJlc3Npb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2lnbmVlID0gbm9kZS50eXBlID09PSAnQXNzaWdubWVudEV4cHJlc3Npb24nID8gbm9kZS5sZWZ0IDogbm9kZS5hcmd1bWVudDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0X25hbWUgPSBnZXRfb2JqZWN0KGFzc2lnbmVlKS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaGFzKG9iamVjdF9uYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgLy8gbm9ybWFsbHkgKGBhID0gMWAsIGBiLmMgPSAyYCksIHRoZXJlJ2xsIGJlIGEgc2luZ2xlIG5hbWVcbiAgICAgICAgICAgICAgICAgICAgLy8gKGEgb3IgYikuIEluIGRlc3RydWN0dXJpbmcgY2FzZXMgKGBbZCwgZV0gPSBbZSwgZF1gKSB0aGVyZVxuICAgICAgICAgICAgICAgICAgICAvLyBtYXkgYmUgbW9yZSwgaW4gd2hpY2ggY2FzZSB3ZSBuZWVkIHRvIHRhY2sgdGhlIGV4dHJhIG9uZXNcbiAgICAgICAgICAgICAgICAgICAgLy8gb250byB0aGUgaW5pdGlhbCBmdW5jdGlvbiBjYWxsXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVzID0gbmV3IFNldChleHRyYWN0X25hbWVzKGFzc2lnbmVlKSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYWNlZCA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgbmFtZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IHRlbXBsYXRlX3Njb3BlLmRlcGVuZGVuY2llc19mb3JfbmFtZS5nZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVwZW5kZW5jaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmZvckVhY2gobmFtZSA9PiB0cmFjZWQuYWRkKG5hbWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNlZC5hZGQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZXh0ID0gYmxvY2suYmluZGluZ3MuZ2V0KG9iamVjdF9uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvciBgeyNlYWNoIGFycmF5IGFzIGl0ZW19YFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVwbGFjZSBgaXRlbSA9IDFgIHRvIGBlYWNoX2FycmF5W2VhY2hfaW5kZXhdID0gMWAsIHRoaXMgYWxsb3cgdXMgdG8gbXV0YXRlIHRoZSBhcnJheVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmF0aGVyIHRoYW4gbXV0YXRpbmcgdGhlIGxvY2FsIGBpdGVtYCB2YXJpYWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzbmlwcGV0LCBvYmplY3QsIHByb3BlcnR5IH0gPSBjb250ZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVwbGFjZWQgPSByZXBsYWNlX29iamVjdChhc3NpZ25lZSwgc25pcHBldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnQXNzaWdubWVudEV4cHJlc3Npb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5sZWZ0ID0gcmVwbGFjZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLmFyZ3VtZW50ID0gcmVwbGFjZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0dWFsX2RlcGVuZGVuY2llcy5hZGQob2JqZWN0Lm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dHVhbF9kZXBlbmRlbmNpZXMuYWRkKHByb3BlcnR5Lm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZShpbnZhbGlkYXRlKGJsb2NrLnJlbmRlcmVyLCBzY29wZSwgbm9kZSwgdHJhY2VkKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGRlY2xhcmF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBibG9jay5tYWludGFpbl9jb250ZXh0ID0gdHJ1ZTtcbiAgICAgICAgICAgIGRlY2xhcmF0aW9ucy5mb3JFYWNoKGRlY2xhcmF0aW9uID0+IHtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGRlY2xhcmF0aW9uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAodGhpcy5tYW5pcHVsYXRlZCA9IG5vZGUpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldF9mdW5jdGlvbl9uYW1lKF9ub2RlLCBwYXJlbnQpIHtcbiAgICBpZiAocGFyZW50LnR5cGUgPT09ICdFdmVudEhhbmRsZXInKSB7XG4gICAgICAgIHJldHVybiBgJHtwYXJlbnQubmFtZX1faGFuZGxlcmA7XG4gICAgfVxuICAgIGlmIChwYXJlbnQudHlwZSA9PT0gJ0FjdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIGAke3BhcmVudC5uYW1lfV9mdW5jdGlvbmA7XG4gICAgfVxuICAgIHJldHVybiAnZnVuYyc7XG59XG5cbmZ1bmN0aW9uIHVucGFja19kZXN0cnVjdHVyaW5nKHsgY29udGV4dHMsIG5vZGUsIG1vZGlmaWVyID0gKG5vZGUpID0+IG5vZGUsIGRlZmF1bHRfbW9kaWZpZXIgPSAobm9kZSkgPT4gbm9kZSwgc2NvcGUsIGNvbXBvbmVudCB9KSB7XG4gICAgaWYgKCFub2RlKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKG5vZGUudHlwZSA9PT0gJ0lkZW50aWZpZXInKSB7XG4gICAgICAgIGNvbnRleHRzLnB1c2goe1xuICAgICAgICAgICAga2V5OiBub2RlLFxuICAgICAgICAgICAgbW9kaWZpZXIsXG4gICAgICAgICAgICBkZWZhdWx0X21vZGlmaWVyXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdSZXN0RWxlbWVudCcpIHtcbiAgICAgICAgY29udGV4dHMucHVzaCh7XG4gICAgICAgICAgICBrZXk6IG5vZGUuYXJndW1lbnQsXG4gICAgICAgICAgICBtb2RpZmllcixcbiAgICAgICAgICAgIGRlZmF1bHRfbW9kaWZpZXJcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gJ0FycmF5UGF0dGVybicpIHtcbiAgICAgICAgbm9kZS5lbGVtZW50cy5mb3JFYWNoKChlbGVtZW50LCBpKSA9PiB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudCAmJiBlbGVtZW50LnR5cGUgPT09ICdSZXN0RWxlbWVudCcpIHtcbiAgICAgICAgICAgICAgICB1bnBhY2tfZGVzdHJ1Y3R1cmluZyh7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHRzLFxuICAgICAgICAgICAgICAgICAgICBub2RlOiBlbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBtb2RpZmllcjogKG5vZGUpID0+IHggYCR7bW9kaWZpZXIobm9kZSl9LnNsaWNlKCR7aX0pYCxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdF9tb2RpZmllcixcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUsXG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZWxlbWVudCAmJiBlbGVtZW50LnR5cGUgPT09ICdBc3NpZ25tZW50UGF0dGVybicpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gY29udGV4dHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIG1hcmtfcmVmZXJlbmNlZChlbGVtZW50LnJpZ2h0LCBzY29wZSwgY29tcG9uZW50KTtcbiAgICAgICAgICAgICAgICB1bnBhY2tfZGVzdHJ1Y3R1cmluZyh7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHRzLFxuICAgICAgICAgICAgICAgICAgICBub2RlOiBlbGVtZW50LmxlZnQsXG4gICAgICAgICAgICAgICAgICAgIG1vZGlmaWVyOiAobm9kZSkgPT4geCBgJHttb2RpZmllcihub2RlKX1bJHtpfV1gLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0X21vZGlmaWVyOiAobm9kZSwgdG9fY3R4KSA9PiB4IGAke25vZGV9ICE9PSB1bmRlZmluZWQgPyAke25vZGV9IDogJHt1cGRhdGVfcmVmZXJlbmNlKGNvbnRleHRzLCBuLCBlbGVtZW50LnJpZ2h0LCB0b19jdHgpfWAsXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLFxuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHVucGFja19kZXN0cnVjdHVyaW5nKHtcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dHMsXG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIG1vZGlmaWVyOiAobm9kZSkgPT4geCBgJHttb2RpZmllcihub2RlKX1bJHtpfV1gLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0X21vZGlmaWVyLFxuICAgICAgICAgICAgICAgICAgICBzY29wZSxcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdPYmplY3RQYXR0ZXJuJykge1xuICAgICAgICBjb25zdCB1c2VkX3Byb3BlcnRpZXMgPSBbXTtcbiAgICAgICAgbm9kZS5wcm9wZXJ0aWVzLmZvckVhY2goKHByb3BlcnR5KSA9PiB7XG4gICAgICAgICAgICBpZiAocHJvcGVydHkudHlwZSA9PT0gJ1Jlc3RFbGVtZW50Jykge1xuICAgICAgICAgICAgICAgIHVucGFja19kZXN0cnVjdHVyaW5nKHtcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dHMsXG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IHByb3BlcnR5LmFyZ3VtZW50LFxuICAgICAgICAgICAgICAgICAgICBtb2RpZmllcjogKG5vZGUpID0+IHggYEBvYmplY3Rfd2l0aG91dF9wcm9wZXJ0aWVzKCR7bW9kaWZpZXIobm9kZSl9LCBbJHt1c2VkX3Byb3BlcnRpZXN9XSlgLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0X21vZGlmaWVyLFxuICAgICAgICAgICAgICAgICAgICBzY29wZSxcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBwcm9wZXJ0eS5rZXk7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBwcm9wZXJ0eS52YWx1ZTtcbiAgICAgICAgICAgICAgICB1c2VkX3Byb3BlcnRpZXMucHVzaCh4IGBcIiR7a2V5Lm5hbWV9XCJgKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUudHlwZSA9PT0gJ0Fzc2lnbm1lbnRQYXR0ZXJuJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gY29udGV4dHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBtYXJrX3JlZmVyZW5jZWQodmFsdWUucmlnaHQsIHNjb3BlLCBjb21wb25lbnQpO1xuICAgICAgICAgICAgICAgICAgICB1bnBhY2tfZGVzdHJ1Y3R1cmluZyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0cyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGU6IHZhbHVlLmxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllcjogKG5vZGUpID0+IHggYCR7bW9kaWZpZXIobm9kZSl9LiR7a2V5Lm5hbWV9YCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRfbW9kaWZpZXI6IChub2RlLCB0b19jdHgpID0+IHggYCR7bm9kZX0gIT09IHVuZGVmaW5lZCA/ICR7bm9kZX0gOiAke3VwZGF0ZV9yZWZlcmVuY2UoY29udGV4dHMsIG4sIHZhbHVlLnJpZ2h0LCB0b19jdHgpfWAsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHVucGFja19kZXN0cnVjdHVyaW5nKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllcjogKG5vZGUpID0+IHggYCR7bW9kaWZpZXIobm9kZSl9LiR7a2V5Lm5hbWV9YCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRfbW9kaWZpZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZV9yZWZlcmVuY2UoY29udGV4dHMsIG4sIGV4cHJlc3Npb24sIHRvX2N0eCkge1xuICAgIGNvbnN0IGZpbmRfZnJvbV9jb250ZXh0ID0gKG5vZGUpID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IG47IGkgPCBjb250ZXh0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgeyBrZXkgfSA9IGNvbnRleHRzW2ldO1xuICAgICAgICAgICAgaWYgKG5vZGUubmFtZSA9PT0ga2V5Lm5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBhY2Nlc3MgJyR7bm9kZS5uYW1lfScgYmVmb3JlIGluaXRpYWxpemF0aW9uYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvX2N0eChub2RlLm5hbWUpO1xuICAgIH07XG4gICAgaWYgKGV4cHJlc3Npb24udHlwZSA9PT0gJ0lkZW50aWZpZXInKSB7XG4gICAgICAgIHJldHVybiBmaW5kX2Zyb21fY29udGV4dChleHByZXNzaW9uKTtcbiAgICB9XG4gICAgLy8gTk9URTogYXZvaWQgdW5uZWNlc3NhcnkgZGVlcCBjbG9uZT9cbiAgICBleHByZXNzaW9uID0gY2xvbmUoZXhwcmVzc2lvbik7XG4gICAgd2FsayhleHByZXNzaW9uLCB7XG4gICAgICAgIGVudGVyKG5vZGUsIHBhcmVudCkge1xuICAgICAgICAgICAgaWYgKGlzX3JlZmVyZW5jZShub2RlLCBwYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXBsYWNlKGZpbmRfZnJvbV9jb250ZXh0KG5vZGUpKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNraXAoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBleHByZXNzaW9uO1xufVxuZnVuY3Rpb24gbWFya19yZWZlcmVuY2VkKG5vZGUsIHNjb3BlLCBjb21wb25lbnQpIHtcbiAgICB3YWxrKG5vZGUsIHtcbiAgICAgICAgZW50ZXIobm9kZSwgcGFyZW50KSB7XG4gICAgICAgICAgICBpZiAoaXNfcmVmZXJlbmNlKG5vZGUsIHBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IGZsYXR0ZW5fcmVmZXJlbmNlKG5vZGUpO1xuICAgICAgICAgICAgICAgIGlmICghc2NvcGUuaXNfbGV0KG5hbWUpICYmICFzY29wZS5uYW1lcy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50LmFkZF9yZWZlcmVuY2UobmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmNvbnN0IGFsbG93ZWRfcGFyZW50cyA9IG5ldyBTZXQoWydFYWNoQmxvY2snLCAnQ2F0Y2hCbG9jaycsICdUaGVuQmxvY2snLCAnSW5saW5lQ29tcG9uZW50JywgJ1Nsb3RUZW1wbGF0ZSddKTtcbmNsYXNzIENvbnN0VGFnIGV4dGVuZHMgTm9kZSQxIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgdGhpcy5jb250ZXh0cyA9IFtdO1xuICAgICAgICB0aGlzLmFzc2lnbmVlcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIGlmICghYWxsb3dlZF9wYXJlbnRzLmhhcyhwYXJlbnQudHlwZSkpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5lcnJvcihpbmZvLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9jb25zdF9wbGFjZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubm9kZSA9IGluZm87XG4gICAgICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcbiAgICAgICAgY29uc3QgeyBhc3NpZ25lZXMsIGRlcGVuZGVuY2llcyB9ID0gdGhpcztcbiAgICAgICAgZXh0cmFjdF9pZGVudGlmaWVycyhpbmZvLmV4cHJlc3Npb24ubGVmdCkuZm9yRWFjaCgoeyBuYW1lIH0pID0+IHtcbiAgICAgICAgICAgIGFzc2lnbmVlcy5hZGQobmFtZSk7XG4gICAgICAgICAgICBjb25zdCBvd25lciA9IHRoaXMuc2NvcGUuZ2V0X293bmVyKG5hbWUpO1xuICAgICAgICAgICAgaWYgKG93bmVyID09PSBwYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuZXJyb3IoaW5mbywgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfY29uc3RfZGVjbGFyYXRpb24obmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgd2FsayhpbmZvLmV4cHJlc3Npb24ucmlnaHQsIHtcbiAgICAgICAgICAgIGVudGVyKG5vZGUsIHBhcmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChpc19yZWZlcmVuY2Uobm9kZSwgcGFyZW50KSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZGVudGlmaWVyID0gZ2V0X29iamVjdChub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBpZGVudGlmaWVyO1xuICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMuYWRkKG5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHBhcnNlX2V4cHJlc3Npb24oKSB7XG4gICAgICAgIHVucGFja19kZXN0cnVjdHVyaW5nKHtcbiAgICAgICAgICAgIGNvbnRleHRzOiB0aGlzLmNvbnRleHRzLFxuICAgICAgICAgICAgbm9kZTogdGhpcy5ub2RlLmV4cHJlc3Npb24ubGVmdCxcbiAgICAgICAgICAgIHNjb3BlOiB0aGlzLnNjb3BlLFxuICAgICAgICAgICAgY29tcG9uZW50OiB0aGlzLmNvbXBvbmVudFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5leHByZXNzaW9uID0gbmV3IEV4cHJlc3Npb24odGhpcy5jb21wb25lbnQsIHRoaXMsIHRoaXMuc2NvcGUsIHRoaXMubm9kZS5leHByZXNzaW9uLnJpZ2h0KTtcbiAgICAgICAgdGhpcy5jb250ZXh0cy5mb3JFYWNoKGNvbnRleHQgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3duZXIgPSB0aGlzLnNjb3BlLmdldF9vd25lcihjb250ZXh0LmtleS5uYW1lKTtcbiAgICAgICAgICAgIGlmIChvd25lciAmJiBvd25lci50eXBlID09PSAnQ29uc3RUYWcnICYmIG93bmVyLnBhcmVudCA9PT0gdGhpcy5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5lcnJvcih0aGlzLm5vZGUsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2NvbnN0X2RlY2xhcmF0aW9uKGNvbnRleHQua2V5Lm5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2NvcGUuYWRkKGNvbnRleHQua2V5Lm5hbWUsIHRoaXMuZXhwcmVzc2lvbi5kZXBlbmRlbmNpZXMsIHRoaXMpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmNsYXNzIFBlbmRpbmdCbG9jayBleHRlbmRzIEFic3RyYWN0QmxvY2sge1xuICAgIGNvbnN0cnVjdG9yKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbykge1xuICAgICAgICBzdXBlcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pO1xuICAgICAgICB0aGlzLmNoaWxkcmVuID0gbWFwX2NoaWxkcmVuKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mby5jaGlsZHJlbik7XG4gICAgICAgIGlmICghaW5mby5za2lwKSB7XG4gICAgICAgICAgICB0aGlzLndhcm5faWZfZW1wdHlfYmxvY2soKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgQ2F0Y2hCbG9jayBleHRlbmRzIEFic3RyYWN0QmxvY2sge1xuICAgIGNvbnN0cnVjdG9yKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbykge1xuICAgICAgICBzdXBlcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pO1xuICAgICAgICB0aGlzLnNjb3BlID0gc2NvcGUuY2hpbGQoKTtcbiAgICAgICAgaWYgKHBhcmVudC5jYXRjaF9ub2RlKSB7XG4gICAgICAgICAgICBwYXJlbnQuY2F0Y2hfY29udGV4dHMuZm9yRWFjaChjb250ZXh0ID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLmFkZChjb250ZXh0LmtleS5uYW1lLCBwYXJlbnQuZXhwcmVzc2lvbi5kZXBlbmRlbmNpZXMsIHRoaXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgKFt0aGlzLmNvbnN0X3RhZ3MsIHRoaXMuY2hpbGRyZW5dID0gZ2V0X2NvbnN0X3RhZ3MoaW5mby5jaGlsZHJlbiwgY29tcG9uZW50LCB0aGlzLCBwYXJlbnQpKTtcbiAgICAgICAgaWYgKCFpbmZvLnNraXApIHtcbiAgICAgICAgICAgIHRoaXMud2Fybl9pZl9lbXB0eV9ibG9jaygpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5jbGFzcyBBd2FpdEJsb2NrIGV4dGVuZHMgTm9kZSQxIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgdGhpcy5leHByZXNzaW9uID0gbmV3IEV4cHJlc3Npb24oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgaW5mby5leHByZXNzaW9uKTtcbiAgICAgICAgdGhpcy50aGVuX25vZGUgPSBpbmZvLnZhbHVlO1xuICAgICAgICB0aGlzLmNhdGNoX25vZGUgPSBpbmZvLmVycm9yO1xuICAgICAgICBpZiAodGhpcy50aGVuX25vZGUpIHtcbiAgICAgICAgICAgIHRoaXMudGhlbl9jb250ZXh0cyA9IFtdO1xuICAgICAgICAgICAgdW5wYWNrX2Rlc3RydWN0dXJpbmcoeyBjb250ZXh0czogdGhpcy50aGVuX2NvbnRleHRzLCBub2RlOiBpbmZvLnZhbHVlLCBzY29wZSwgY29tcG9uZW50IH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNhdGNoX25vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuY2F0Y2hfY29udGV4dHMgPSBbXTtcbiAgICAgICAgICAgIHVucGFja19kZXN0cnVjdHVyaW5nKHsgY29udGV4dHM6IHRoaXMuY2F0Y2hfY29udGV4dHMsIG5vZGU6IGluZm8uZXJyb3IsIHNjb3BlLCBjb21wb25lbnQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wZW5kaW5nID0gbmV3IFBlbmRpbmdCbG9jayhjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBpbmZvLnBlbmRpbmcpO1xuICAgICAgICB0aGlzLnRoZW4gPSBuZXcgVGhlbkJsb2NrKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIGluZm8udGhlbik7XG4gICAgICAgIHRoaXMuY2F0Y2ggPSBuZXcgQ2F0Y2hCbG9jayhjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBpbmZvLmNhdGNoKTtcbiAgICB9XG59XG5cbmNsYXNzIEV2ZW50SGFuZGxlciBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHRlbXBsYXRlX3Njb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCB0ZW1wbGF0ZV9zY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMudXNlc19jb250ZXh0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2FuX21ha2VfcGFzc2l2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5hbWUgPSBpbmZvLm5hbWU7XG4gICAgICAgIHRoaXMubW9kaWZpZXJzID0gbmV3IFNldChpbmZvLm1vZGlmaWVycyk7XG4gICAgICAgIGlmIChpbmZvLmV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IG5ldyBFeHByZXNzaW9uKGNvbXBvbmVudCwgdGhpcywgdGVtcGxhdGVfc2NvcGUsIGluZm8uZXhwcmVzc2lvbik7XG4gICAgICAgICAgICB0aGlzLnVzZXNfY29udGV4dCA9IHRoaXMuZXhwcmVzc2lvbi51c2VzX2NvbnRleHQ7XG4gICAgICAgICAgICBpZiAoL0Z1bmN0aW9uRXhwcmVzc2lvbi8udGVzdChpbmZvLmV4cHJlc3Npb24udHlwZSkgJiYgaW5mby5leHByZXNzaW9uLnBhcmFtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIG1ha2UgdGhpcyBkZXRlY3Rpb24gbW9yZSBhY2N1cmF0ZSDigJQgaWYgYGV2ZW50LnByZXZlbnREZWZhdWx0YCBpc24ndCBjYWxsZWQsIGFuZFxuICAgICAgICAgICAgICAgIC8vIGBldmVudGAgaXMgcGFzc2VkIHRvIGFub3RoZXIgZnVuY3Rpb24sIHdlIGNhbiBtYWtlIGl0IHBhc3NpdmVcbiAgICAgICAgICAgICAgICB0aGlzLmNhbl9tYWtlX3Bhc3NpdmUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaW5mby5leHByZXNzaW9uLnR5cGUgPT09ICdJZGVudGlmaWVyJykge1xuICAgICAgICAgICAgICAgIGxldCBub2RlID0gY29tcG9uZW50Lm5vZGVfZm9yX2RlY2xhcmF0aW9uLmdldChpbmZvLmV4cHJlc3Npb24ubmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ1ZhcmlhYmxlRGVjbGFyYXRpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBmb3IgYGNvbnN0IGhhbmRsZUNsaWNrID0gKCkgPT4gey4uLn1gLCB3ZSB3YW50IHRoZSBbYXJyb3ddIGZ1bmN0aW9uIGV4cHJlc3Npb24gbm9kZVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVjbGFyYXRvciA9IG5vZGUuZGVjbGFyYXRpb25zLmZpbmQoZCA9PiBkLmlkLm5hbWUgPT09IGluZm8uZXhwcmVzc2lvbi5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBkZWNsYXJhdG9yICYmIGRlY2xhcmF0b3IuaW5pdDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZSAmJiAobm9kZS50eXBlID09PSAnRnVuY3Rpb25FeHByZXNzaW9uJyB8fCBub2RlLnR5cGUgPT09ICdGdW5jdGlvbkRlY2xhcmF0aW9uJyB8fCBub2RlLnR5cGUgPT09ICdBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbicpICYmIG5vZGUucGFyYW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5fbWFrZV9wYXNzaXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlcl9uYW1lID0gY29tcG9uZW50LmdldF91bmlxdWVfbmFtZShgJHtzYW5pdGl6ZSh0aGlzLm5hbWUpfV9oYW5kbGVyYCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHJlYXNzaWduZWQoKSB7XG4gICAgICAgIGlmICghdGhpcy5leHByZXNzaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuZXhwcmVzc2lvbi5ub2RlO1xuICAgICAgICBpZiAoL0Z1bmN0aW9uRXhwcmVzc2lvbi8udGVzdChub2RlLnR5cGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZXhwcmVzc2lvbi5keW5hbWljX2RlcGVuZGVuY2llcygpLmxlbmd0aCA+IDA7XG4gICAgfVxufVxuXG5jbGFzcyBBY3Rpb24gZXh0ZW5kcyBOb2RlJDEge1xuICAgIGNvbnN0cnVjdG9yKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbykge1xuICAgICAgICBzdXBlcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pO1xuICAgICAgICBjb25zdCBvYmplY3QgPSBpbmZvLm5hbWUuc3BsaXQoJy4nKVswXTtcbiAgICAgICAgY29tcG9uZW50Lndhcm5faWZfdW5kZWZpbmVkKG9iamVjdCwgaW5mbywgc2NvcGUpO1xuICAgICAgICB0aGlzLm5hbWUgPSBpbmZvLm5hbWU7XG4gICAgICAgIGNvbXBvbmVudC5hZGRfcmVmZXJlbmNlKG9iamVjdCk7XG4gICAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IGluZm8uZXhwcmVzc2lvblxuICAgICAgICAgICAgPyBuZXcgRXhwcmVzc2lvbihjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBpbmZvLmV4cHJlc3Npb24pXG4gICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIHRoaXMudGVtcGxhdGVfc2NvcGUgPSBzY29wZTtcbiAgICAgICAgdGhpcy51c2VzX2NvbnRleHQgPSB0aGlzLmV4cHJlc3Npb24gJiYgdGhpcy5leHByZXNzaW9uLnVzZXNfY29udGV4dDtcbiAgICB9XG59XG5cbmNsYXNzIEJvZHkgZXh0ZW5kcyBOb2RlJDEge1xuICAgIGNvbnN0cnVjdG9yKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbykge1xuICAgICAgICBzdXBlcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pO1xuICAgICAgICB0aGlzLmhhbmRsZXJzID0gW107XG4gICAgICAgIHRoaXMuYWN0aW9ucyA9IFtdO1xuICAgICAgICBpbmZvLmF0dHJpYnV0ZXMuZm9yRWFjaCgobm9kZSkgPT4ge1xuICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0V2ZW50SGFuZGxlcicpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZXJzLnB1c2gobmV3IEV2ZW50SGFuZGxlcihjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdBY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zLnB1c2gobmV3IEFjdGlvbihjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuY2xhc3MgQ29tbWVudCQxIGV4dGVuZHMgTm9kZSQxIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgdGhpcy5kYXRhID0gaW5mby5kYXRhO1xuICAgICAgICB0aGlzLmlnbm9yZXMgPSBpbmZvLmlnbm9yZXM7XG4gICAgfVxufVxuXG5jbGFzcyBFbHNlQmxvY2sgZXh0ZW5kcyBBYnN0cmFjdEJsb2NrIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IG1hcF9jaGlsZHJlbihjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBpbmZvLmNoaWxkcmVuKTtcbiAgICAgICAgdGhpcy53YXJuX2lmX2VtcHR5X2Jsb2NrKCk7XG4gICAgfVxufVxuXG5jbGFzcyBFYWNoQmxvY2sgZXh0ZW5kcyBBYnN0cmFjdEJsb2NrIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgdGhpcy5oYXNfYmluZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhhc19pbmRleF9iaW5kaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IG5ldyBFeHByZXNzaW9uKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIGluZm8uZXhwcmVzc2lvbik7XG4gICAgICAgIHRoaXMuY29udGV4dCA9IGluZm8uY29udGV4dC5uYW1lIHx8ICdlYWNoJzsgLy8gVE9ETyB0aGlzIGlzIHVzZWQgdG8gZmFjaWxpdGF0ZSBiaW5kaW5nOyBjdXJyZW50bHkgZmFpbHMgd2l0aCBkZXN0cnVjdHVyaW5nXG4gICAgICAgIHRoaXMuY29udGV4dF9ub2RlID0gaW5mby5jb250ZXh0O1xuICAgICAgICB0aGlzLmluZGV4ID0gaW5mby5pbmRleDtcbiAgICAgICAgdGhpcy5zY29wZSA9IHNjb3BlLmNoaWxkKCk7XG4gICAgICAgIHRoaXMuY29udGV4dHMgPSBbXTtcbiAgICAgICAgdW5wYWNrX2Rlc3RydWN0dXJpbmcoeyBjb250ZXh0czogdGhpcy5jb250ZXh0cywgbm9kZTogaW5mby5jb250ZXh0LCBzY29wZSwgY29tcG9uZW50IH0pO1xuICAgICAgICB0aGlzLmNvbnRleHRzLmZvckVhY2goY29udGV4dCA9PiB7XG4gICAgICAgICAgICB0aGlzLnNjb3BlLmFkZChjb250ZXh0LmtleS5uYW1lLCB0aGlzLmV4cHJlc3Npb24uZGVwZW5kZW5jaWVzLCB0aGlzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLmluZGV4KSB7XG4gICAgICAgICAgICAvLyBpbmRleCBjYW4gb25seSBjaGFuZ2UgaWYgdGhpcyBpcyBhIGtleWVkIGVhY2ggYmxvY2tcbiAgICAgICAgICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IGluZm8ua2V5ID8gdGhpcy5leHByZXNzaW9uLmRlcGVuZGVuY2llcyA6IG5ldyBTZXQoW10pO1xuICAgICAgICAgICAgdGhpcy5zY29wZS5hZGQodGhpcy5pbmRleCwgZGVwZW5kZW5jaWVzLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmtleSA9IGluZm8ua2V5XG4gICAgICAgICAgICA/IG5ldyBFeHByZXNzaW9uKGNvbXBvbmVudCwgdGhpcywgdGhpcy5zY29wZSwgaW5mby5rZXkpXG4gICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIHRoaXMuaGFzX2FuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAoW3RoaXMuY29uc3RfdGFncywgdGhpcy5jaGlsZHJlbl0gPSBnZXRfY29uc3RfdGFncyhpbmZvLmNoaWxkcmVuLCBjb21wb25lbnQsIHRoaXMsIHRoaXMpKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzX2FuaW1hdGlvbikge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLmNoaWxkcmVuLmZpbmQoY2hpbGQgPT4gISFjaGlsZC5hbmltYXRpb24pO1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5lcnJvcihjaGlsZC5hbmltYXRpb24sIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2FuaW1hdGlvbl9zb2xlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy53YXJuX2lmX2VtcHR5X2Jsb2NrKCk7XG4gICAgICAgIHRoaXMuZWxzZSA9IGluZm8uZWxzZVxuICAgICAgICAgICAgPyBuZXcgRWxzZUJsb2NrKGNvbXBvbmVudCwgdGhpcywgdGhpcy5zY29wZSwgaW5mby5lbHNlKVxuICAgICAgICAgICAgOiBudWxsO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc3RyaW5nX2xpdGVyYWwoZGF0YSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdMaXRlcmFsJyxcbiAgICAgICAgdmFsdWU6IGRhdGFcbiAgICB9O1xufVxuY29uc3QgZXNjYXBlZCA9IHtcbiAgICAnXCInOiAnJnF1b3Q7JyxcbiAgICBcIidcIjogJyYjMzk7JyxcbiAgICAnJic6ICcmYW1wOycsXG4gICAgJzwnOiAnJmx0OycsXG4gICAgJz4nOiAnJmd0Oydcbn07XG5mdW5jdGlvbiBlc2NhcGVfaHRtbChodG1sKSB7XG4gICAgcmV0dXJuIFN0cmluZyhodG1sKS5yZXBsYWNlKC9bXCInJjw+XS9nLCBtYXRjaCA9PiBlc2NhcGVkW21hdGNoXSk7XG59XG5mdW5jdGlvbiBlc2NhcGVfdGVtcGxhdGUoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oXFwke3xgfFxcXFwpL2csICdcXFxcJDEnKTtcbn1cblxuZnVuY3Rpb24gYWRkX3RvX3NldChhLCBiKSB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGIuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgYS5hZGQoaXRlbSk7XG4gICAgfSk7XG59XG5cbmNsYXNzIEF0dHJpYnV0ZSBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcbiAgICAgICAgaWYgKGluZm8udHlwZSA9PT0gJ1NwcmVhZCcpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmlzX3NwcmVhZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmlzX3RydWUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IG5ldyBFeHByZXNzaW9uKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIGluZm8uZXhwcmVzc2lvbik7XG4gICAgICAgICAgICB0aGlzLmRlcGVuZGVuY2llcyA9IHRoaXMuZXhwcmVzc2lvbi5kZXBlbmRlbmNpZXM7XG4gICAgICAgICAgICB0aGlzLmNodW5rcyA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmlzX3N0YXRpYyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gaW5mby5uYW1lO1xuICAgICAgICAgICAgdGhpcy5pc190cnVlID0gaW5mby52YWx1ZSA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuaXNfc3RhdGljID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgdGhpcy5jaHVua3MgPSB0aGlzLmlzX3RydWVcbiAgICAgICAgICAgICAgICA/IFtdXG4gICAgICAgICAgICAgICAgOiBpbmZvLnZhbHVlLm1hcChub2RlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ1RleHQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNfc3RhdGljID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSBuZXcgRXhwcmVzc2lvbihjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlLmV4cHJlc3Npb24pO1xuICAgICAgICAgICAgICAgICAgICBhZGRfdG9fc2V0KHRoaXMuZGVwZW5kZW5jaWVzLCBleHByZXNzaW9uLmRlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleHByZXNzaW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldF9kZXBlbmRlbmNpZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzX3NwcmVhZClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cHJlc3Npb24uZHluYW1pY19kZXBlbmRlbmNpZXMoKTtcbiAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLmNodW5rcy5mb3JFYWNoKGNodW5rID0+IHtcbiAgICAgICAgICAgIGlmIChjaHVuay50eXBlID09PSAnRXhwcmVzc2lvbicpIHtcbiAgICAgICAgICAgICAgICBhZGRfdG9fc2V0KGRlcGVuZGVuY2llcywgY2h1bmsuZHluYW1pY19kZXBlbmRlbmNpZXMoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShkZXBlbmRlbmNpZXMpO1xuICAgIH1cbiAgICBnZXRfdmFsdWUoYmxvY2spIHtcbiAgICAgICAgaWYgKHRoaXMuaXNfdHJ1ZSlcbiAgICAgICAgICAgIHJldHVybiB4IGB0cnVlYDtcbiAgICAgICAgaWYgKHRoaXMuY2h1bmtzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIHJldHVybiB4IGBcIlwiYDtcbiAgICAgICAgaWYgKHRoaXMuY2h1bmtzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2h1bmtzWzBdLnR5cGUgPT09ICdUZXh0J1xuICAgICAgICAgICAgICAgID8gc3RyaW5nX2xpdGVyYWwodGhpcy5jaHVua3NbMF0uZGF0YSlcbiAgICAgICAgICAgICAgICA6IHRoaXMuY2h1bmtzWzBdLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICB9XG4gICAgICAgIGxldCBleHByZXNzaW9uID0gdGhpcy5jaHVua3NcbiAgICAgICAgICAgIC5tYXAoY2h1bmsgPT4gY2h1bmsudHlwZSA9PT0gJ1RleHQnID8gc3RyaW5nX2xpdGVyYWwoY2h1bmsuZGF0YSkgOiBjaHVuay5tYW5pcHVsYXRlKGJsb2NrKSlcbiAgICAgICAgICAgIC5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30gKyAke3Joc31gKTtcbiAgICAgICAgaWYgKHRoaXMuY2h1bmtzWzBdLnR5cGUgIT09ICdUZXh0Jykge1xuICAgICAgICAgICAgZXhwcmVzc2lvbiA9IHggYFwiXCIgKyAke2V4cHJlc3Npb259YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXhwcmVzc2lvbjtcbiAgICB9XG4gICAgZ2V0X3N0YXRpY192YWx1ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzX3N0YXRpYylcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gdGhpcy5pc190cnVlXG4gICAgICAgICAgICA/IHRydWVcbiAgICAgICAgICAgIDogdGhpcy5jaHVua3NbMF1cbiAgICAgICAgICAgICAgICAvLyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCBvbmx5IHdoZW4gYGlzX3N0YXRpYyA9IHRydWVgXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNodW5rc1swXS5kYXRhXG4gICAgICAgICAgICAgICAgOiAnJztcbiAgICB9XG4gICAgc2hvdWxkX2NhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc19zdGF0aWNcbiAgICAgICAgICAgID8gZmFsc2VcbiAgICAgICAgICAgIDogdGhpcy5jaHVua3MubGVuZ3RoID09PSAxXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZSB0b2RvOiBwcm9iYWJseSBlcnJvclxuICAgICAgICAgICAgICAgID8gdGhpcy5jaHVua3NbMF0ubm9kZS50eXBlICE9PSAnSWRlbnRpZmllcicgfHwgdGhpcy5zY29wZS5uYW1lcy5oYXModGhpcy5jaHVua3NbMF0ubm9kZS5uYW1lKVxuICAgICAgICAgICAgICAgIDogdHJ1ZTtcbiAgICB9XG59XG5cbi8vIFRPRE8gdGhpcyBzaG91bGQgbGl2ZSBpbiBhIHNwZWNpZmljIGJpbmRpbmdcbmNvbnN0IHJlYWRfb25seV9tZWRpYV9hdHRyaWJ1dGVzID0gbmV3IFNldChbXG4gICAgJ2R1cmF0aW9uJyxcbiAgICAnYnVmZmVyZWQnLFxuICAgICdzZWVrYWJsZScsXG4gICAgJ3BsYXllZCcsXG4gICAgJ3NlZWtpbmcnLFxuICAgICdlbmRlZCcsXG4gICAgJ3ZpZGVvSGVpZ2h0JyxcbiAgICAndmlkZW9XaWR0aCdcbl0pO1xuY2xhc3MgQmluZGluZyBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIGlmIChpbmZvLmV4cHJlc3Npb24udHlwZSAhPT0gJ0lkZW50aWZpZXInICYmIGluZm8uZXhwcmVzc2lvbi50eXBlICE9PSAnTWVtYmVyRXhwcmVzc2lvbicpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5lcnJvcihpbmZvLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9kaXJlY3RpdmVfdmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmFtZSA9IGluZm8ubmFtZTtcbiAgICAgICAgdGhpcy5leHByZXNzaW9uID0gbmV3IEV4cHJlc3Npb24oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgaW5mby5leHByZXNzaW9uKTtcbiAgICAgICAgdGhpcy5yYXdfZXhwcmVzc2lvbiA9IGNsb25lKGluZm8uZXhwcmVzc2lvbik7XG4gICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gZ2V0X29iamVjdCh0aGlzLmV4cHJlc3Npb24ubm9kZSk7XG4gICAgICAgIHRoaXMuaXNfY29udGV4dHVhbCA9IEFycmF5LmZyb20odGhpcy5leHByZXNzaW9uLnJlZmVyZW5jZXMpLnNvbWUobmFtZSA9PiBzY29wZS5uYW1lcy5oYXMobmFtZSkpO1xuICAgICAgICAvLyBtYWtlIHN1cmUgd2UgdHJhY2sgdGhpcyBhcyBhIG11dGFibGUgcmVmXG4gICAgICAgIGlmIChzY29wZS5pc19sZXQobmFtZSkpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5lcnJvcih0aGlzLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX2xldCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc2NvcGUubmFtZXMuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICBpZiAoc2NvcGUuaXNfYXdhaXQobmFtZSkpIHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuZXJyb3IodGhpcywgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfYmluZGluZ19hd2FpdCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNjb3BlLmlzX2NvbnN0KG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmVycm9yKHRoaXMsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2JpbmRpbmdfY29uc3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2NvcGUuZGVwZW5kZW5jaWVzX2Zvcl9uYW1lLmdldChuYW1lKS5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZS5tdXRhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgaWYgKCF2YXJpYWJsZSB8fCB2YXJpYWJsZS5nbG9iYWwpIHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuZXJyb3IodGhpcy5leHByZXNzaW9uLm5vZGUsIGNvbXBpbGVyX2Vycm9ycy5iaW5kaW5nX3VuZGVjbGFyZWQobmFtZSkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhcmlhYmxlW3RoaXMuZXhwcmVzc2lvbi5ub2RlLnR5cGUgPT09ICdNZW1iZXJFeHByZXNzaW9uJyA/ICdtdXRhdGVkJyA6ICdyZWFzc2lnbmVkJ10gPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGluZm8uZXhwcmVzc2lvbi50eXBlID09PSAnSWRlbnRpZmllcicgJiYgIXZhcmlhYmxlLndyaXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmVycm9yKHRoaXMuZXhwcmVzc2lvbi5ub2RlLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX3dyaXRpYmFsZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHR5cGUgPSBwYXJlbnQuZ2V0X3N0YXRpY19hdHRyaWJ1dGVfdmFsdWUoJ3R5cGUnKTtcbiAgICAgICAgdGhpcy5pc19yZWFkb25seSA9XG4gICAgICAgICAgICBkaW1lbnNpb25zLnRlc3QodGhpcy5uYW1lKSB8fFxuICAgICAgICAgICAgICAgIChpc0VsZW1lbnQocGFyZW50KSAmJlxuICAgICAgICAgICAgICAgICAgICAoKHBhcmVudC5pc19tZWRpYV9ub2RlKCkgJiYgcmVhZF9vbmx5X21lZGlhX2F0dHJpYnV0ZXMuaGFzKHRoaXMubmFtZSkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAocGFyZW50Lm5hbWUgPT09ICdpbnB1dCcgJiYgdHlwZSA9PT0gJ2ZpbGUnKSkgLyogVE9ETyBvdGhlcnM/ICovKTtcbiAgICB9XG4gICAgaXNfcmVhZG9ubHlfbWVkaWFfYXR0cmlidXRlKCkge1xuICAgICAgICByZXR1cm4gcmVhZF9vbmx5X21lZGlhX2F0dHJpYnV0ZXMuaGFzKHRoaXMubmFtZSk7XG4gICAgfVxufVxuZnVuY3Rpb24gaXNFbGVtZW50KG5vZGUpIHtcbiAgICByZXR1cm4gISFub2RlLmlzX21lZGlhX25vZGU7XG59XG5cbmNsYXNzIFRyYW5zaXRpb24gZXh0ZW5kcyBOb2RlJDEge1xuICAgIGNvbnN0cnVjdG9yKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbykge1xuICAgICAgICBzdXBlcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pO1xuICAgICAgICBjb21wb25lbnQud2Fybl9pZl91bmRlZmluZWQoaW5mby5uYW1lLCBpbmZvLCBzY29wZSk7XG4gICAgICAgIHRoaXMubmFtZSA9IGluZm8ubmFtZTtcbiAgICAgICAgY29tcG9uZW50LmFkZF9yZWZlcmVuY2UoaW5mby5uYW1lLnNwbGl0KCcuJylbMF0pO1xuICAgICAgICB0aGlzLmRpcmVjdGl2ZSA9IGluZm8uaW50cm8gJiYgaW5mby5vdXRybyA/ICd0cmFuc2l0aW9uJyA6IGluZm8uaW50cm8gPyAnaW4nIDogJ291dCc7XG4gICAgICAgIHRoaXMuaXNfbG9jYWwgPSBpbmZvLm1vZGlmaWVycy5pbmNsdWRlcygnbG9jYWwnKTtcbiAgICAgICAgaWYgKChpbmZvLmludHJvICYmIHBhcmVudC5pbnRybykgfHwgKGluZm8ub3V0cm8gJiYgcGFyZW50Lm91dHJvKSkge1xuICAgICAgICAgICAgY29uc3QgcGFyZW50X3RyYW5zaXRpb24gPSAocGFyZW50LmludHJvIHx8IHBhcmVudC5vdXRybyk7XG4gICAgICAgICAgICBjb21wb25lbnQuZXJyb3IoaW5mbywgY29tcGlsZXJfZXJyb3JzLmR1cGxpY2F0ZV90cmFuc2l0aW9uKHRoaXMuZGlyZWN0aXZlLCBwYXJlbnRfdHJhbnNpdGlvbi5kaXJlY3RpdmUpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmV4cHJlc3Npb24gPSBpbmZvLmV4cHJlc3Npb25cbiAgICAgICAgICAgID8gbmV3IEV4cHJlc3Npb24oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgaW5mby5leHByZXNzaW9uKVxuICAgICAgICAgICAgOiBudWxsO1xuICAgIH1cbn1cblxuY2xhc3MgQW5pbWF0aW9uIGV4dGVuZHMgTm9kZSQxIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgY29tcG9uZW50Lndhcm5faWZfdW5kZWZpbmVkKGluZm8ubmFtZSwgaW5mbywgc2NvcGUpO1xuICAgICAgICB0aGlzLm5hbWUgPSBpbmZvLm5hbWU7XG4gICAgICAgIGNvbXBvbmVudC5hZGRfcmVmZXJlbmNlKGluZm8ubmFtZS5zcGxpdCgnLicpWzBdKTtcbiAgICAgICAgaWYgKHBhcmVudC5hbmltYXRpb24pIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5lcnJvcih0aGlzLCBjb21waWxlcl9lcnJvcnMuZHVwbGljYXRlX2FuaW1hdGlvbik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYmxvY2sgPSBwYXJlbnQucGFyZW50O1xuICAgICAgICBpZiAoIWJsb2NrIHx8IGJsb2NrLnR5cGUgIT09ICdFYWNoQmxvY2snIHx8ICFibG9jay5rZXkpIHtcbiAgICAgICAgICAgIC8vIFRPRE8gY2FuIHdlIHJlbGF4IHRoZSAnaW1tZWRpYXRlIGNoaWxkJyBydWxlP1xuICAgICAgICAgICAgY29tcG9uZW50LmVycm9yKHRoaXMsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2FuaW1hdGlvbl9pbW1lZGlhdGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmhhc19hbmltYXRpb24gPSB0cnVlO1xuICAgICAgICB0aGlzLmV4cHJlc3Npb24gPSBpbmZvLmV4cHJlc3Npb25cbiAgICAgICAgICAgID8gbmV3IEV4cHJlc3Npb24oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgaW5mby5leHByZXNzaW9uLCB0cnVlKVxuICAgICAgICAgICAgOiBudWxsO1xuICAgIH1cbn1cblxuY2xhc3MgQ2xhc3MgZXh0ZW5kcyBOb2RlJDEge1xuICAgIGNvbnN0cnVjdG9yKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbykge1xuICAgICAgICBzdXBlcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pO1xuICAgICAgICB0aGlzLm5hbWUgPSBpbmZvLm5hbWU7XG4gICAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IGluZm8uZXhwcmVzc2lvblxuICAgICAgICAgICAgPyBuZXcgRXhwcmVzc2lvbihjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBpbmZvLmV4cHJlc3Npb24pXG4gICAgICAgICAgICA6IG51bGw7XG4gICAgfVxufVxuXG4vKipcbiAqIFRyYW5zZm9ybXMgYSBsaXN0IG9mIFRleHQgYW5kIE11c3RhY2hlVGFncyBpbnRvIGEgVGVtcGxhdGVMaXRlcmFsIGV4cHJlc3Npb24uXG4gKiBTdGFydC9FbmQgcG9zaXRpb25zIG9uIHRoZSBlbGVtZW50cyBvZiB0aGUgZXhwcmVzc2lvbiBhcmUgbm90IHNldC5cbiAqL1xuZnVuY3Rpb24gbm9kZXNfdG9fdGVtcGxhdGVfbGl0ZXJhbCh2YWx1ZSkge1xuICAgIGNvbnN0IGxpdGVyYWwgPSB7XG4gICAgICAgIHR5cGU6ICdUZW1wbGF0ZUxpdGVyYWwnLFxuICAgICAgICBleHByZXNzaW9uczogW10sXG4gICAgICAgIHF1YXNpczogW11cbiAgICB9O1xuICAgIGxldCBxdWFzaSA9IHtcbiAgICAgICAgdHlwZTogJ1RlbXBsYXRlRWxlbWVudCcsXG4gICAgICAgIHZhbHVlOiB7IHJhdzogJycsIGNvb2tlZDogbnVsbCB9LFxuICAgICAgICB0YWlsOiBmYWxzZVxuICAgIH07XG4gICAgdmFsdWUuZm9yRWFjaCgobm9kZSkgPT4ge1xuICAgICAgICBpZiAobm9kZS50eXBlID09PSAnVGV4dCcpIHtcbiAgICAgICAgICAgIHF1YXNpLnZhbHVlLnJhdyArPSBub2RlLnJhdztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdNdXN0YWNoZVRhZycpIHtcbiAgICAgICAgICAgIGxpdGVyYWwucXVhc2lzLnB1c2gocXVhc2kpO1xuICAgICAgICAgICAgbGl0ZXJhbC5leHByZXNzaW9ucy5wdXNoKG5vZGUuZXhwcmVzc2lvbik7XG4gICAgICAgICAgICBxdWFzaSA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnVGVtcGxhdGVFbGVtZW50JyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogeyByYXc6ICcnLCBjb29rZWQ6IG51bGwgfSxcbiAgICAgICAgICAgICAgICB0YWlsOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHF1YXNpLnRhaWwgPSB0cnVlO1xuICAgIGxpdGVyYWwucXVhc2lzLnB1c2gocXVhc2kpO1xuICAgIHJldHVybiBsaXRlcmFsO1xufVxuXG5jbGFzcyBTdHlsZURpcmVjdGl2ZSBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMubmFtZSA9IGluZm8ubmFtZTtcbiAgICAgICAgLy8gQ29udmVydCB0aGUgdmFsdWUgYXJyYXkgdG8gYW4gZXhwcmVzc2lvbiBzbyBpdCdzIGVhc2llciB0byBoYW5kbGVcbiAgICAgICAgLy8gdGhlIFN0eWxlRGlyZWN0aXZlIGdvaW5nIGZvcndhcmQuXG4gICAgICAgIGlmIChpbmZvLnZhbHVlID09PSB0cnVlIHx8IChpbmZvLnZhbHVlLmxlbmd0aCA9PT0gMSAmJiBpbmZvLnZhbHVlWzBdLnR5cGUgPT09ICdNdXN0YWNoZVRhZycpKSB7XG4gICAgICAgICAgICBjb25zdCBpZGVudGlmaWVyID0gaW5mby52YWx1ZSA9PT0gdHJ1ZVxuICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBpbmZvLmVuZCAtIGluZm8ubmFtZS5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgIGVuZDogaW5mby5lbmQsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGluZm8ubmFtZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA6IGluZm8udmFsdWVbMF0uZXhwcmVzc2lvbjtcbiAgICAgICAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IG5ldyBFeHByZXNzaW9uKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIGlkZW50aWZpZXIpO1xuICAgICAgICAgICAgdGhpcy5zaG91bGRfY2FjaGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHJhd19leHByZXNzaW9uID0gbm9kZXNfdG9fdGVtcGxhdGVfbGl0ZXJhbChpbmZvLnZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IG5ldyBFeHByZXNzaW9uKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIHJhd19leHByZXNzaW9uKTtcbiAgICAgICAgICAgIHRoaXMuc2hvdWxkX2NhY2hlID0gcmF3X2V4cHJlc3Npb24uZXhwcmVzc2lvbnMubGVuZ3RoID4gMDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy8gV2hpdGVzcGFjZSBpbnNpZGUgb25lIG9mIHRoZXNlIGVsZW1lbnRzIHdpbGwgbm90IHJlc3VsdCBpblxuLy8gYSB3aGl0ZXNwYWNlIG5vZGUgYmVpbmcgY3JlYXRlZCBpbiBhbnkgY2lyY3Vtc3RhbmNlcy4gKFRoaXNcbi8vIGxpc3QgaXMgYWxtb3N0IGNlcnRhaW5seSB2ZXJ5IGluY29tcGxldGUpXG5jb25zdCBlbGVtZW50c193aXRob3V0X3RleHQgPSBuZXcgU2V0KFtcbiAgICAnYXVkaW8nLFxuICAgICdkYXRhbGlzdCcsXG4gICAgJ2RsJyxcbiAgICAnb3B0Z3JvdXAnLFxuICAgICdzZWxlY3QnLFxuICAgICd2aWRlbydcbl0pO1xuY2xhc3MgVGV4dCBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMuZGF0YSA9IGluZm8uZGF0YTtcbiAgICAgICAgdGhpcy5zeW50aGV0aWMgPSBpbmZvLnN5bnRoZXRpYyB8fCBmYWxzZTtcbiAgICB9XG4gICAgc2hvdWxkX3NraXAoKSB7XG4gICAgICAgIGlmICgvXFxTLy50ZXN0KHRoaXMuZGF0YSkpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IHBhcmVudF9lbGVtZW50ID0gdGhpcy5maW5kX25lYXJlc3QoLyg/OkVsZW1lbnR8SW5saW5lQ29tcG9uZW50fFNsb3RUZW1wbGF0ZXxIZWFkKS8pO1xuICAgICAgICBpZiAoIXBhcmVudF9lbGVtZW50KVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAocGFyZW50X2VsZW1lbnQudHlwZSA9PT0gJ0hlYWQnKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmIChwYXJlbnRfZWxlbWVudC50eXBlID09PSAnSW5saW5lQ29tcG9uZW50JylcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnRfZWxlbWVudC5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgdGhpcyA9PT0gcGFyZW50X2VsZW1lbnQuY2hpbGRyZW5bMF07XG4gICAgICAgIC8vIHN2ZyBuYW1lc3BhY2UgZXhjbHVzaW9uc1xuICAgICAgICBpZiAoL3N2ZyQvLnRlc3QocGFyZW50X2VsZW1lbnQubmFtZXNwYWNlKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJldiAmJiB0aGlzLnByZXYudHlwZSA9PT0gJ0VsZW1lbnQnICYmIHRoaXMucHJldi5uYW1lID09PSAndHNwYW4nKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyZW50X2VsZW1lbnQubmFtZXNwYWNlIHx8IGVsZW1lbnRzX3dpdGhvdXRfdGV4dC5oYXMocGFyZW50X2VsZW1lbnQubmFtZSk7XG4gICAgfVxufVxuXG4vLyBUaGUgYGZvcmVpZ25gIG5hbWVzcGFjZSBjb3ZlcnMgYWxsIERPTSBpbXBsZW1lbnRhdGlvbnMgdGhhdCBhcmVuJ3QgSFRNTDUuXG4vLyBJdCBvcHRzIG91dCBvZiBIVE1MNS1zcGVjaWZpYyBhMTF5IGNoZWNrcyBhbmQgY2FzZS1pbnNlbnNpdGl2ZSBhdHRyaWJ1dGUgbmFtZXMuXG5jb25zdCBmb3JlaWduID0gJ2h0dHBzOi8vc3ZlbHRlLmRldi9kb2NzI3RlbXBsYXRlLXN5bnRheC1zdmVsdGUtb3B0aW9ucyc7XG5jb25zdCBodG1sID0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwnO1xuY29uc3QgbWF0aG1sID0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUwnO1xuY29uc3Qgc3ZnID0gJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJztcbmNvbnN0IHhsaW5rID0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnO1xuY29uc3QgeG1sID0gJ2h0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSc7XG5jb25zdCB4bWxucyA9ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3htbG5zJztcbmNvbnN0IHZhbGlkX25hbWVzcGFjZXMgPSBbXG4gICAgJ2ZvcmVpZ24nLFxuICAgICdodG1sJyxcbiAgICAnbWF0aG1sJyxcbiAgICAnc3ZnJyxcbiAgICAneGxpbmsnLFxuICAgICd4bWwnLFxuICAgICd4bWxucycsXG4gICAgZm9yZWlnbixcbiAgICBodG1sLFxuICAgIG1hdGhtbCxcbiAgICBzdmcsXG4gICAgeGxpbmssXG4gICAgeG1sLFxuICAgIHhtbG5zXG5dO1xuY29uc3QgbmFtZXNwYWNlcyA9IHsgZm9yZWlnbiwgaHRtbCwgbWF0aG1sLCBzdmcsIHhsaW5rLCB4bWwsIHhtbG5zIH07XG5cbmNvbnN0IGFwcGxpY2FibGUgPSBuZXcgU2V0KFsnSWRlbnRpZmllcicsICdPYmplY3RFeHByZXNzaW9uJywgJ0FycmF5RXhwcmVzc2lvbicsICdQcm9wZXJ0eSddKTtcbmNsYXNzIExldCBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMubmFtZXMgPSBbXTtcbiAgICAgICAgdGhpcy5uYW1lID0geyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6IGluZm8ubmFtZSB9O1xuICAgICAgICBjb25zdCB7IG5hbWVzIH0gPSB0aGlzO1xuICAgICAgICBpZiAoaW5mby5leHByZXNzaW9uKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gaW5mby5leHByZXNzaW9uO1xuICAgICAgICAgICAgd2FsayhpbmZvLmV4cHJlc3Npb24sIHtcbiAgICAgICAgICAgICAgICBlbnRlcihub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghYXBwbGljYWJsZS5oYXMobm9kZS50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihub2RlLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9sZXQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdJZGVudGlmaWVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXMucHVzaChub2RlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHNsaWdodGx5IHVuZm9ydHVuYXRlIGhhY2tcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0FycmF5RXhwcmVzc2lvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUudHlwZSA9ICdBcnJheVBhdHRlcm4nO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdPYmplY3RFeHByZXNzaW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS50eXBlID0gJ09iamVjdFBhdHRlcm4nO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBuYW1lcy5wdXNoKHRoaXMubmFtZS5uYW1lKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY29uc3Qgc3ZnJDEgPSAvXig/OmFsdEdseXBofGFsdEdseXBoRGVmfGFsdEdseXBoSXRlbXxhbmltYXRlfGFuaW1hdGVDb2xvcnxhbmltYXRlTW90aW9ufGFuaW1hdGVUcmFuc2Zvcm18Y2lyY2xlfGNsaXBQYXRofGNvbG9yLXByb2ZpbGV8Y3Vyc29yfGRlZnN8ZGVzY3xkaXNjYXJkfGVsbGlwc2V8ZmVCbGVuZHxmZUNvbG9yTWF0cml4fGZlQ29tcG9uZW50VHJhbnNmZXJ8ZmVDb21wb3NpdGV8ZmVDb252b2x2ZU1hdHJpeHxmZURpZmZ1c2VMaWdodGluZ3xmZURpc3BsYWNlbWVudE1hcHxmZURpc3RhbnRMaWdodHxmZURyb3BTaGFkb3d8ZmVGbG9vZHxmZUZ1bmNBfGZlRnVuY0J8ZmVGdW5jR3xmZUZ1bmNSfGZlR2F1c3NpYW5CbHVyfGZlSW1hZ2V8ZmVNZXJnZXxmZU1lcmdlTm9kZXxmZU1vcnBob2xvZ3l8ZmVPZmZzZXR8ZmVQb2ludExpZ2h0fGZlU3BlY3VsYXJMaWdodGluZ3xmZVNwb3RMaWdodHxmZVRpbGV8ZmVUdXJidWxlbmNlfGZpbHRlcnxmb250fGZvbnQtZmFjZXxmb250LWZhY2UtZm9ybWF0fGZvbnQtZmFjZS1uYW1lfGZvbnQtZmFjZS1zcmN8Zm9udC1mYWNlLXVyaXxmb3JlaWduT2JqZWN0fGd8Z2x5cGh8Z2x5cGhSZWZ8aGF0Y2h8aGF0Y2hwYXRofGhrZXJufGltYWdlfGxpbmV8bGluZWFyR3JhZGllbnR8bWFya2VyfG1hc2t8bWVzaHxtZXNoZ3JhZGllbnR8bWVzaHBhdGNofG1lc2hyb3d8bWV0YWRhdGF8bWlzc2luZy1nbHlwaHxtcGF0aHxwYXRofHBhdHRlcm58cG9seWdvbnxwb2x5bGluZXxyYWRpYWxHcmFkaWVudHxyZWN0fHNldHxzb2xpZGNvbG9yfHN0b3B8c3ZnfHN3aXRjaHxzeW1ib2x8dGV4dHx0ZXh0UGF0aHx0cmVmfHRzcGFufHVua25vd258dXNlfHZpZXd8dmtlcm4pJC87XG5jb25zdCBhcmlhX2F0dHJpYnV0ZXMgPSAnYWN0aXZlZGVzY2VuZGFudCBhdG9taWMgYXV0b2NvbXBsZXRlIGJ1c3kgY2hlY2tlZCBjb2xjb3VudCBjb2xpbmRleCBjb2xzcGFuIGNvbnRyb2xzIGN1cnJlbnQgZGVzY3JpYmVkYnkgZGV0YWlscyBkaXNhYmxlZCBkcm9wZWZmZWN0IGVycm9ybWVzc2FnZSBleHBhbmRlZCBmbG93dG8gZ3JhYmJlZCBoYXNwb3B1cCBoaWRkZW4gaW52YWxpZCBrZXlzaG9ydGN1dHMgbGFiZWwgbGFiZWxsZWRieSBsZXZlbCBsaXZlIG1vZGFsIG11bHRpbGluZSBtdWx0aXNlbGVjdGFibGUgb3JpZW50YXRpb24gb3ducyBwbGFjZWhvbGRlciBwb3NpbnNldCBwcmVzc2VkIHJlYWRvbmx5IHJlbGV2YW50IHJlcXVpcmVkIHJvbGVkZXNjcmlwdGlvbiByb3djb3VudCByb3dpbmRleCByb3dzcGFuIHNlbGVjdGVkIHNldHNpemUgc29ydCB2YWx1ZW1heCB2YWx1ZW1pbiB2YWx1ZW5vdyB2YWx1ZXRleHQnLnNwbGl0KCcgJyk7XG5jb25zdCBhcmlhX2F0dHJpYnV0ZV9zZXQgPSBuZXcgU2V0KGFyaWFfYXR0cmlidXRlcyk7XG5jb25zdCBhcmlhX3JvbGVzID0gJ2FsZXJ0IGFsZXJ0ZGlhbG9nIGFwcGxpY2F0aW9uIGFydGljbGUgYmFubmVyIGJsb2NrcXVvdGUgYnV0dG9uIGNhcHRpb24gY2VsbCBjaGVja2JveCBjb2RlIGNvbHVtbmhlYWRlciBjb21ib2JveCBjb21wbGVtZW50YXJ5IGNvbnRlbnRpbmZvIGRlZmluaXRpb24gZGVsZXRpb24gZGlhbG9nIGRpcmVjdG9yeSBkb2N1bWVudCBlbXBoYXNpcyBmZWVkIGZpZ3VyZSBmb3JtIGdlbmVyaWMgZ3JhcGhpY3MtZG9jdW1lbnQgZ3JhcGhpY3Mtb2JqZWN0IGdyYXBoaWNzLXN5bWJvbCBncmlkIGdyaWRjZWxsIGdyb3VwIGhlYWRpbmcgaW1nIGxpbmsgbGlzdCBsaXN0Ym94IGxpc3RpdGVtIGxvZyBtYWluIG1hcnF1ZWUgbWF0aCBtZXRlciBtZW51IG1lbnViYXIgbWVudWl0ZW0gbWVudWl0ZW1jaGVja2JveCBtZW51aXRlbXJhZGlvIG5hdmlnYXRpb24gbm9uZSBub3RlIG9wdGlvbiBwYXJhZ3JhcGggcHJlc2VudGF0aW9uIHByb2dyZXNzYmFyIHJhZGlvIHJhZGlvZ3JvdXAgcmVnaW9uIHJvdyByb3dncm91cCByb3doZWFkZXIgc2Nyb2xsYmFyIHNlYXJjaCBzZWFyY2hib3ggc2VwYXJhdG9yIHNsaWRlciBzcGluYnV0dG9uIHN0YXR1cyBzdHJvbmcgc3Vic2NyaXB0IHN1cGVyc2NyaXB0IHN3aXRjaCB0YWIgdGFibGUgdGFibGlzdCB0YWJwYW5lbCB0ZXJtIHRleHRib3ggdGltZSB0aW1lciB0b29sYmFyIHRvb2x0aXAgdHJlZSB0cmVlZ3JpZCB0cmVlaXRlbScuc3BsaXQoJyAnKTtcbmNvbnN0IGFyaWFfcm9sZV9zZXQgPSBuZXcgU2V0KGFyaWFfcm9sZXMpO1xuY29uc3QgYTExeV9yZXF1aXJlZF9hdHRyaWJ1dGVzID0ge1xuICAgIGE6IFsnaHJlZiddLFxuICAgIGFyZWE6IFsnYWx0JywgJ2FyaWEtbGFiZWwnLCAnYXJpYS1sYWJlbGxlZGJ5J10sXG4gICAgLy8gaHRtbC1oYXMtbGFuZ1xuICAgIGh0bWw6IFsnbGFuZyddLFxuICAgIC8vIGlmcmFtZS1oYXMtdGl0bGVcbiAgICBpZnJhbWU6IFsndGl0bGUnXSxcbiAgICBpbWc6IFsnYWx0J10sXG4gICAgb2JqZWN0OiBbJ3RpdGxlJywgJ2FyaWEtbGFiZWwnLCAnYXJpYS1sYWJlbGxlZGJ5J11cbn07XG5jb25zdCBhMTF5X2Rpc3RyYWN0aW5nX2VsZW1lbnRzID0gbmV3IFNldChbXG4gICAgJ2JsaW5rJyxcbiAgICAnbWFycXVlZSdcbl0pO1xuY29uc3QgYTExeV9yZXF1aXJlZF9jb250ZW50ID0gbmV3IFNldChbXG4gICAgLy8gYW5jaG9yLWhhcy1jb250ZW50XG4gICAgJ2EnLFxuICAgIC8vIGhlYWRpbmctaGFzLWNvbnRlbnRcbiAgICAnaDEnLFxuICAgICdoMicsXG4gICAgJ2gzJyxcbiAgICAnaDQnLFxuICAgICdoNScsXG4gICAgJ2g2J1xuXSk7XG5jb25zdCBhMTF5X2xhYmVsYWJsZSA9IG5ldyBTZXQoW1xuICAgICdidXR0b24nLFxuICAgICdpbnB1dCcsXG4gICAgJ2tleWdlbicsXG4gICAgJ21ldGVyJyxcbiAgICAnb3V0cHV0JyxcbiAgICAncHJvZ3Jlc3MnLFxuICAgICdzZWxlY3QnLFxuICAgICd0ZXh0YXJlYSdcbl0pO1xuY29uc3QgYTExeV9uZXN0ZWRfaW1wbGljaXRfc2VtYW50aWNzID0gbmV3IE1hcChbXG4gICAgWydoZWFkZXInLCAnYmFubmVyJ10sXG4gICAgWydmb290ZXInLCAnY29udGVudGluZm8nXVxuXSk7XG5jb25zdCBhMTF5X2ltcGxpY2l0X3NlbWFudGljcyA9IG5ldyBNYXAoW1xuICAgIFsnYScsICdsaW5rJ10sXG4gICAgWydhc2lkZScsICdjb21wbGVtZW50YXJ5J10sXG4gICAgWydib2R5JywgJ2RvY3VtZW50J10sXG4gICAgWydkYXRhbGlzdCcsICdsaXN0Ym94J10sXG4gICAgWydkZCcsICdkZWZpbml0aW9uJ10sXG4gICAgWydkZm4nLCAndGVybSddLFxuICAgIFsnZGV0YWlscycsICdncm91cCddLFxuICAgIFsnZHQnLCAndGVybSddLFxuICAgIFsnZmllbGRzZXQnLCAnZ3JvdXAnXSxcbiAgICBbJ2Zvcm0nLCAnZm9ybSddLFxuICAgIFsnaDEnLCAnaGVhZGluZyddLFxuICAgIFsnaDInLCAnaGVhZGluZyddLFxuICAgIFsnaDMnLCAnaGVhZGluZyddLFxuICAgIFsnaDQnLCAnaGVhZGluZyddLFxuICAgIFsnaDUnLCAnaGVhZGluZyddLFxuICAgIFsnaDYnLCAnaGVhZGluZyddLFxuICAgIFsnaHInLCAnc2VwYXJhdG9yJ10sXG4gICAgWydsaScsICdsaXN0aXRlbSddLFxuICAgIFsnbWVudScsICdsaXN0J10sXG4gICAgWyduYXYnLCAnbmF2aWdhdGlvbiddLFxuICAgIFsnb2wnLCAnbGlzdCddLFxuICAgIFsnb3B0Z3JvdXAnLCAnZ3JvdXAnXSxcbiAgICBbJ291dHB1dCcsICdzdGF0dXMnXSxcbiAgICBbJ3Byb2dyZXNzJywgJ3Byb2dyZXNzYmFyJ10sXG4gICAgWydzZWN0aW9uJywgJ3JlZ2lvbiddLFxuICAgIFsnc3VtbWFyeScsICdidXR0b24nXSxcbiAgICBbJ3Rib2R5JywgJ3Jvd2dyb3VwJ10sXG4gICAgWyd0ZXh0YXJlYScsICd0ZXh0Ym94J10sXG4gICAgWyd0Zm9vdCcsICdyb3dncm91cCddLFxuICAgIFsndGhlYWQnLCAncm93Z3JvdXAnXSxcbiAgICBbJ3RyJywgJ3JvdyddLFxuICAgIFsndWwnLCAnbGlzdCddXG5dKTtcbmNvbnN0IGludmlzaWJsZV9lbGVtZW50cyA9IG5ldyBTZXQoWydtZXRhJywgJ2h0bWwnLCAnc2NyaXB0JywgJ3N0eWxlJ10pO1xuY29uc3QgdmFsaWRfbW9kaWZpZXJzID0gbmV3IFNldChbXG4gICAgJ3ByZXZlbnREZWZhdWx0JyxcbiAgICAnc3RvcFByb3BhZ2F0aW9uJyxcbiAgICAnY2FwdHVyZScsXG4gICAgJ29uY2UnLFxuICAgICdwYXNzaXZlJyxcbiAgICAnbm9ucGFzc2l2ZScsXG4gICAgJ3NlbGYnLFxuICAgICd0cnVzdGVkJ1xuXSk7XG5jb25zdCBwYXNzaXZlX2V2ZW50cyA9IG5ldyBTZXQoW1xuICAgICd3aGVlbCcsXG4gICAgJ3RvdWNoc3RhcnQnLFxuICAgICd0b3VjaG1vdmUnLFxuICAgICd0b3VjaGVuZCcsXG4gICAgJ3RvdWNoY2FuY2VsJ1xuXSk7XG5jb25zdCByZWFjdF9hdHRyaWJ1dGVzID0gbmV3IE1hcChbXG4gICAgWydjbGFzc05hbWUnLCAnY2xhc3MnXSxcbiAgICBbJ2h0bWxGb3InLCAnZm9yJ11cbl0pO1xuY29uc3QgYXR0cmlidXRlc190b19jb21wYWN0X3doaXRlc3BhY2UgPSBbJ2NsYXNzJywgJ3N0eWxlJ107XG5mdW5jdGlvbiBpc19wYXJlbnQocGFyZW50LCBlbGVtZW50cykge1xuICAgIGxldCBjaGVjayA9IGZhbHNlO1xuICAgIHdoaWxlIChwYXJlbnQpIHtcbiAgICAgICAgY29uc3QgcGFyZW50X25hbWUgPSBwYXJlbnQubmFtZTtcbiAgICAgICAgaWYgKGVsZW1lbnRzLmluY2x1ZGVzKHBhcmVudF9uYW1lKSkge1xuICAgICAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcmVudC50eXBlID09PSAnRWxlbWVudCcpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7XG4gICAgfVxuICAgIHJldHVybiBjaGVjaztcbn1cbmZ1bmN0aW9uIGdldF9uYW1lc3BhY2UocGFyZW50LCBlbGVtZW50LCBleHBsaWNpdF9uYW1lc3BhY2UpIHtcbiAgICBjb25zdCBwYXJlbnRfZWxlbWVudCA9IHBhcmVudC5maW5kX25lYXJlc3QoL15FbGVtZW50Lyk7XG4gICAgaWYgKCFwYXJlbnRfZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZXhwbGljaXRfbmFtZXNwYWNlIHx8IChzdmckMS50ZXN0KGVsZW1lbnQubmFtZSlcbiAgICAgICAgICAgID8gbmFtZXNwYWNlcy5zdmdcbiAgICAgICAgICAgIDogbnVsbCk7XG4gICAgfVxuICAgIGlmIChwYXJlbnRfZWxlbWVudC5uYW1lc3BhY2UgIT09IG5hbWVzcGFjZXMuZm9yZWlnbikge1xuICAgICAgICBpZiAoc3ZnJDEudGVzdChlbGVtZW50Lm5hbWUudG9Mb3dlckNhc2UoKSkpXG4gICAgICAgICAgICByZXR1cm4gbmFtZXNwYWNlcy5zdmc7XG4gICAgICAgIGlmIChwYXJlbnRfZWxlbWVudC5uYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdmb3JlaWdub2JqZWN0JylcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcGFyZW50X2VsZW1lbnQubmFtZXNwYWNlO1xufVxuY2xhc3MgRWxlbWVudCBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMuYXR0cmlidXRlcyA9IFtdO1xuICAgICAgICB0aGlzLmFjdGlvbnMgPSBbXTtcbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9IFtdO1xuICAgICAgICB0aGlzLmNsYXNzZXMgPSBbXTtcbiAgICAgICAgdGhpcy5zdHlsZXMgPSBbXTtcbiAgICAgICAgdGhpcy5oYW5kbGVycyA9IFtdO1xuICAgICAgICB0aGlzLmxldHMgPSBbXTtcbiAgICAgICAgdGhpcy5pbnRybyA9IG51bGw7XG4gICAgICAgIHRoaXMub3V0cm8gPSBudWxsO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbiA9IG51bGw7XG4gICAgICAgIHRoaXMubmFtZSA9IGluZm8ubmFtZTtcbiAgICAgICAgdGhpcy5uYW1lc3BhY2UgPSBnZXRfbmFtZXNwYWNlKHBhcmVudCwgdGhpcywgY29tcG9uZW50Lm5hbWVzcGFjZSk7XG4gICAgICAgIGlmICh0aGlzLm5hbWVzcGFjZSAhPT0gbmFtZXNwYWNlcy5mb3JlaWduKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5uYW1lID09PSAndGV4dGFyZWEnKSB7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZV9hdHRyaWJ1dGUgPSBpbmZvLmF0dHJpYnV0ZXMuZmluZChub2RlID0+IG5vZGUubmFtZSA9PT0gJ3ZhbHVlJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZV9hdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5lcnJvcih2YWx1ZV9hdHRyaWJ1dGUsIGNvbXBpbGVyX2Vycm9ycy50ZXh0YXJlYV9kdXBsaWNhdGVfdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgYW4gZWdyZWdpb3VzIGhhY2ssIGJ1dCBpdCdzIHRoZSBlYXNpZXN0IHdheSB0byBnZXQgPHRleHRhcmVhPlxuICAgICAgICAgICAgICAgICAgICAvLyBjaGlsZHJlbiB0cmVhdGVkIHRoZSBzYW1lIHdheSBhcyBhIHZhbHVlIGF0dHJpYnV0ZVxuICAgICAgICAgICAgICAgICAgICBpbmZvLmF0dHJpYnV0ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQXR0cmlidXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICd2YWx1ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaW5mby5jaGlsZHJlblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaW5mby5jaGlsZHJlbiA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLm5hbWUgPT09ICdvcHRpb24nKSB7XG4gICAgICAgICAgICAgICAgLy8gU3BlY2lhbCBjYXNlIOKAlCB0cmVhdCB0aGVzZSB0aGUgc2FtZSB3YXk6XG4gICAgICAgICAgICAgICAgLy8gICA8b3B0aW9uPntmb299PC9vcHRpb24+XG4gICAgICAgICAgICAgICAgLy8gICA8b3B0aW9uIHZhbHVlPXtmb299Pntmb299PC9vcHRpb24+XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWVfYXR0cmlidXRlID0gaW5mby5hdHRyaWJ1dGVzLmZpbmQoYXR0cmlidXRlID0+IGF0dHJpYnV0ZS5uYW1lID09PSAndmFsdWUnKTtcbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlX2F0dHJpYnV0ZSkge1xuICAgICAgICAgICAgICAgICAgICBpbmZvLmF0dHJpYnV0ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQXR0cmlidXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICd2YWx1ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaW5mby5jaGlsZHJlbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5bnRoZXRpYzogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGFzX2xldCA9IGluZm8uYXR0cmlidXRlcy5zb21lKG5vZGUgPT4gbm9kZS50eXBlID09PSAnTGV0Jyk7XG4gICAgICAgIGlmIChoYXNfbGV0KSB7XG4gICAgICAgICAgICBzY29wZSA9IHNjb3BlLmNoaWxkKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQmluZGluZyByZWxpZXMgb24gQXR0cmlidXRlLCBkZWZlciBpdHMgZXZhbHVhdGlvblxuICAgICAgICBjb25zdCBvcmRlciA9IFsnQmluZGluZyddOyAvLyBldmVyeXRoaW5nIGVsc2UgaXMgLTFcbiAgICAgICAgaW5mby5hdHRyaWJ1dGVzLnNvcnQoKGEsIGIpID0+IG9yZGVyLmluZGV4T2YoYS50eXBlKSAtIG9yZGVyLmluZGV4T2YoYi50eXBlKSk7XG4gICAgICAgIGluZm8uYXR0cmlidXRlcy5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChub2RlLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdBY3Rpb24nOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbnMucHVzaChuZXcgQWN0aW9uKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIG5vZGUpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnQXR0cmlidXRlJzpcbiAgICAgICAgICAgICAgICBjYXNlICdTcHJlYWQnOlxuICAgICAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIGNhc2VcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubmFtZSA9PT0gJ3htbG5zJylcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZXNwYWNlID0gbm9kZS52YWx1ZVswXS5kYXRhO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMucHVzaChuZXcgQXR0cmlidXRlKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIG5vZGUpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnQmluZGluZyc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZGluZ3MucHVzaChuZXcgQmluZGluZyhjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0NsYXNzJzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc2VzLnB1c2gobmV3IENsYXNzKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIG5vZGUpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnU3R5bGVEaXJlY3RpdmUnOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlcy5wdXNoKG5ldyBTdHlsZURpcmVjdGl2ZShjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0V2ZW50SGFuZGxlcic6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaChuZXcgRXZlbnRIYW5kbGVyKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIG5vZGUpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnTGV0Jzoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsID0gbmV3IExldChjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sZXRzLnB1c2gobCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IG5ldyBTZXQoW2wubmFtZS5uYW1lXSk7XG4gICAgICAgICAgICAgICAgICAgIGwubmFtZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmFkZChuYW1lLCBkZXBlbmRlbmNpZXMsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgJ1RyYW5zaXRpb24nOlxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2l0aW9uID0gbmV3IFRyYW5zaXRpb24oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pbnRybylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludHJvID0gdHJhbnNpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLm91dHJvKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3V0cm8gPSB0cmFuc2l0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlICdBbmltYXRpb24nOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGlvbiA9IG5ldyBBbmltYXRpb24oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTm90IGltcGxlbWVudGVkOiAke25vZGUudHlwZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IG1hcF9jaGlsZHJlbihjb21wb25lbnQsIHRoaXMsIHRoaXMuc2NvcGUsIGluZm8uY2hpbGRyZW4pO1xuICAgICAgICB0aGlzLnZhbGlkYXRlKCk7XG4gICAgICAgIHRoaXMub3B0aW1pc2UoKTtcbiAgICAgICAgY29tcG9uZW50LmFwcGx5X3N0eWxlc2hlZXQodGhpcyk7XG4gICAgfVxuICAgIHZhbGlkYXRlKCkge1xuICAgICAgICBpZiAodGhpcy5jb21wb25lbnQudmFyX2xvb2t1cC5oYXModGhpcy5uYW1lKSAmJiB0aGlzLmNvbXBvbmVudC52YXJfbG9va3VwLmdldCh0aGlzLm5hbWUpLmltcG9ydGVkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudC53YXJuKHRoaXMsIGNvbXBpbGVyX3dhcm5pbmdzLmNvbXBvbmVudF9uYW1lX2xvd2VyY2FzZSh0aGlzLm5hbWUpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZhbGlkYXRlX2F0dHJpYnV0ZXMoKTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZV9ldmVudF9oYW5kbGVycygpO1xuICAgICAgICBpZiAodGhpcy5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZXMuZm9yZWlnbikge1xuICAgICAgICAgICAgdGhpcy52YWxpZGF0ZV9iaW5kaW5nc19mb3JlaWduKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRlX2F0dHJpYnV0ZXNfYTExeSgpO1xuICAgICAgICAgICAgdGhpcy52YWxpZGF0ZV9zcGVjaWFsX2Nhc2VzKCk7XG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRlX2JpbmRpbmdzKCk7XG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRlX2NvbnRlbnQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2YWxpZGF0ZV9hdHRyaWJ1dGVzKCkge1xuICAgICAgICBjb25zdCB7IGNvbXBvbmVudCwgcGFyZW50IH0gPSB0aGlzO1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMuZm9yRWFjaChhdHRyaWJ1dGUgPT4ge1xuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5pc19zcHJlYWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IGF0dHJpYnV0ZS5uYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAvLyBFcnJvcnNcbiAgICAgICAgICAgIGlmICgvKF5bMC05LS5dKXxbXFxeJEAlJiM/IXwoKVtcXF17fV4qK347XS8udGVzdChuYW1lKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoYXR0cmlidXRlLCBjb21waWxlcl9lcnJvcnMuaWxsZWdhbF9hdHRyaWJ1dGUobmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdzbG90Jykge1xuICAgICAgICAgICAgICAgIGlmICghYXR0cmlidXRlLmlzX3N0YXRpYykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGF0dHJpYnV0ZSwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfc2xvdF9hdHRyaWJ1dGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY29tcG9uZW50LnNsb3Rfb3V0bGV0cy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihhdHRyaWJ1dGUsIGNvbXBpbGVyX2Vycm9ycy5kdXBsaWNhdGVfc2xvdF9hdHRyaWJ1dGUobmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGNvZGUgd2FzIHVucmVhY2hhYmxlLiBTdGlsbCBuZWVkZWQ/XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbXBvbmVudC5zbG90X291dGxldHMuYWRkKG5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIShwYXJlbnQudHlwZSA9PT0gJ1Nsb3RUZW1wbGF0ZScgfHwgd2l0aGluX2N1c3RvbV9lbGVtZW50KHBhcmVudCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoYXR0cmlidXRlLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9zbG90dGVkX2NvbnRlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFdhcm5pbmdzXG4gICAgICAgICAgICBpZiAodGhpcy5uYW1lc3BhY2UgIT09IG5hbWVzcGFjZXMuZm9yZWlnbikge1xuICAgICAgICAgICAgICAgIGlmIChuYW1lID09PSAnaXMnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKGF0dHJpYnV0ZSwgY29tcGlsZXJfd2FybmluZ3MuYXZvaWRfaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVhY3RfYXR0cmlidXRlcy5oYXMoYXR0cmlidXRlLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKGF0dHJpYnV0ZSwgY29tcGlsZXJfd2FybmluZ3MuaW52YWxpZF9odG1sX2F0dHJpYnV0ZShhdHRyaWJ1dGUubmFtZSwgcmVhY3RfYXR0cmlidXRlcy5nZXQoYXR0cmlidXRlLm5hbWUpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgdmFsaWRhdGVfYXR0cmlidXRlc19hMTF5KCkge1xuICAgICAgICBjb25zdCB7IGNvbXBvbmVudCB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLmZvckVhY2goYXR0cmlidXRlID0+IHtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUuaXNfc3ByZWFkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBhdHRyaWJ1dGUubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgLy8gYXJpYS1wcm9wc1xuICAgICAgICAgICAgaWYgKG5hbWUuc3RhcnRzV2l0aCgnYXJpYS0nKSkge1xuICAgICAgICAgICAgICAgIGlmIChpbnZpc2libGVfZWxlbWVudHMuaGFzKHRoaXMubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYXJpYS11bnN1cHBvcnRlZC1lbGVtZW50c1xuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQud2FybihhdHRyaWJ1dGUsIGNvbXBpbGVyX3dhcm5pbmdzLmExMXlfYXJpYV9hdHRyaWJ1dGVzKHRoaXMubmFtZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gbmFtZS5zbGljZSg1KTtcbiAgICAgICAgICAgICAgICBpZiAoIWFyaWFfYXR0cmlidXRlX3NldC5oYXModHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBmdXp6eW1hdGNoKHR5cGUsIGFyaWFfYXR0cmlidXRlcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKGF0dHJpYnV0ZSwgY29tcGlsZXJfd2FybmluZ3MuYTExeV91bmtub3duX2FyaWFfYXR0cmlidXRlKHR5cGUsIG1hdGNoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChuYW1lID09PSAnYXJpYS1oaWRkZW4nICYmIC9eaFsxLTZdJC8udGVzdCh0aGlzLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKGF0dHJpYnV0ZSwgY29tcGlsZXJfd2FybmluZ3MuYTExeV9oaWRkZW4odGhpcy5uYW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYXJpYS1yb2xlXG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gJ3JvbGUnKSB7XG4gICAgICAgICAgICAgICAgaWYgKGludmlzaWJsZV9lbGVtZW50cy5oYXModGhpcy5uYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBhcmlhLXVuc3VwcG9ydGVkLWVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKGF0dHJpYnV0ZSwgY29tcGlsZXJfd2FybmluZ3MuYTExeV9taXNwbGFjZWRfcm9sZSh0aGlzLm5hbWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBhdHRyaWJ1dGUuZ2V0X3N0YXRpY192YWx1ZSgpO1xuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgIWFyaWFfcm9sZV9zZXQuaGFzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gZnV6enltYXRjaCh2YWx1ZSwgYXJpYV9yb2xlcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKGF0dHJpYnV0ZSwgY29tcGlsZXJfd2FybmluZ3MuYTExeV91bmtub3duX3JvbGUodmFsdWUsIG1hdGNoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIG5vLXJlZHVuZGFudC1yb2xlc1xuICAgICAgICAgICAgICAgIGNvbnN0IGhhc19yZWR1bmRhbnRfcm9sZSA9IHZhbHVlID09PSBhMTF5X2ltcGxpY2l0X3NlbWFudGljcy5nZXQodGhpcy5uYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uYW1lID09PSB2YWx1ZSB8fCBoYXNfcmVkdW5kYW50X3JvbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lndhcm4oYXR0cmlidXRlLCBjb21waWxlcl93YXJuaW5ncy5hMTF5X25vX3JlZHVuZGFudF9yb2xlcyh2YWx1ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBGb290ZXJzIGFuZCBoZWFkZXJzIGFyZSBzcGVjaWFsIGNhc2VzLCBhbmQgc2hvdWxkIG5vdCBoYXZlIHJlZHVuZGFudCByb2xlcyB1bmxlc3MgdGhleSBhcmUgdGhlIGNoaWxkcmVuIG9mIHNlY3Rpb25zIG9yIGFydGljbGVzLlxuICAgICAgICAgICAgICAgIGNvbnN0IGlzX3BhcmVudF9zZWN0aW9uX29yX2FydGljbGUgPSBpc19wYXJlbnQodGhpcy5wYXJlbnQsIFsnc2VjdGlvbicsICdhcnRpY2xlJ10pO1xuICAgICAgICAgICAgICAgIGlmICghaXNfcGFyZW50X3NlY3Rpb25fb3JfYXJ0aWNsZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNfbmVzdGVkX3JlZHVuZGFudF9yb2xlID0gdmFsdWUgPT09IGExMXlfbmVzdGVkX2ltcGxpY2l0X3NlbWFudGljcy5nZXQodGhpcy5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc19uZXN0ZWRfcmVkdW5kYW50X3JvbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKGF0dHJpYnV0ZSwgY29tcGlsZXJfd2FybmluZ3MuYTExeV9ub19yZWR1bmRhbnRfcm9sZXModmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIG5vLWFjY2Vzcy1rZXlcbiAgICAgICAgICAgIGlmIChuYW1lID09PSAnYWNjZXNza2V5Jykge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKGF0dHJpYnV0ZSwgY29tcGlsZXJfd2FybmluZ3MuYTExeV9hY2Nlc3NrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gbm8tYXV0b2ZvY3VzXG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gJ2F1dG9mb2N1cycpIHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQud2FybihhdHRyaWJ1dGUsIGNvbXBpbGVyX3dhcm5pbmdzLmExMXlfYXV0b2ZvY3VzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHNjb3BlXG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gJ3Njb3BlJyAmJiB0aGlzLm5hbWUgIT09ICd0aCcpIHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQud2FybihhdHRyaWJ1dGUsIGNvbXBpbGVyX3dhcm5pbmdzLmExMXlfbWlzcGxhY2VkX3Njb3BlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHRhYmluZGV4LW5vLXBvc2l0aXZlXG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gJ3RhYmluZGV4Jykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gYXR0cmlidXRlLmdldF9zdGF0aWNfdmFsdWUoKTtcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlIHRvZG8gaXMgdGFiaW5kZXg9dHJ1ZSBjb3JyZWN0IGNhc2U/XG4gICAgICAgICAgICAgICAgaWYgKCFpc05hTih2YWx1ZSkgJiYgK3ZhbHVlID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQud2FybihhdHRyaWJ1dGUsIGNvbXBpbGVyX3dhcm5pbmdzLmExMXlfcG9zaXRpdmVfdGFiaW5kZXgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHZhbGlkYXRlX3NwZWNpYWxfY2FzZXMoKSB7XG4gICAgICAgIGNvbnN0IHsgY29tcG9uZW50LCBhdHRyaWJ1dGVzLCBoYW5kbGVycyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgYXR0cmlidXRlX21hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgY29uc3QgaGFuZGxlcnNfbWFwID0gbmV3IE1hcCgpO1xuICAgICAgICBhdHRyaWJ1dGVzLmZvckVhY2goYXR0cmlidXRlID0+IChhdHRyaWJ1dGVfbWFwLnNldChhdHRyaWJ1dGUubmFtZSwgYXR0cmlidXRlKSkpO1xuICAgICAgICBoYW5kbGVycy5mb3JFYWNoKGhhbmRsZXIgPT4gKGhhbmRsZXJzX21hcC5zZXQoaGFuZGxlci5uYW1lLCBoYW5kbGVyKSkpO1xuICAgICAgICBpZiAodGhpcy5uYW1lID09PSAnYScpIHtcbiAgICAgICAgICAgIGNvbnN0IGhyZWZfYXR0cmlidXRlID0gYXR0cmlidXRlX21hcC5nZXQoJ2hyZWYnKSB8fCBhdHRyaWJ1dGVfbWFwLmdldCgneGxpbms6aHJlZicpO1xuICAgICAgICAgICAgY29uc3QgaWRfYXR0cmlidXRlID0gYXR0cmlidXRlX21hcC5nZXQoJ2lkJyk7XG4gICAgICAgICAgICBjb25zdCBuYW1lX2F0dHJpYnV0ZSA9IGF0dHJpYnV0ZV9tYXAuZ2V0KCduYW1lJyk7XG4gICAgICAgICAgICBpZiAoaHJlZl9hdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBocmVmX3ZhbHVlID0gaHJlZl9hdHRyaWJ1dGUuZ2V0X3N0YXRpY192YWx1ZSgpO1xuICAgICAgICAgICAgICAgIGlmIChocmVmX3ZhbHVlID09PSAnJyB8fCBocmVmX3ZhbHVlID09PSAnIycgfHwgL15cXFcqamF2YXNjcmlwdDovaS50ZXN0KGhyZWZfdmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKGhyZWZfYXR0cmlidXRlLCBjb21waWxlcl93YXJuaW5ncy5hMTF5X2ludmFsaWRfYXR0cmlidXRlKGhyZWZfYXR0cmlidXRlLm5hbWUsIGhyZWZfdmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpZF9hdHRyaWJ1dGVfdmFsaWQgPSBpZF9hdHRyaWJ1dGUgJiYgaWRfYXR0cmlidXRlLmdldF9zdGF0aWNfdmFsdWUoKSAhPT0gJyc7XG4gICAgICAgICAgICAgICAgY29uc3QgbmFtZV9hdHRyaWJ1dGVfdmFsaWQgPSBuYW1lX2F0dHJpYnV0ZSAmJiBuYW1lX2F0dHJpYnV0ZS5nZXRfc3RhdGljX3ZhbHVlKCkgIT09ICcnO1xuICAgICAgICAgICAgICAgIGlmICghaWRfYXR0cmlidXRlX3ZhbGlkICYmICFuYW1lX2F0dHJpYnV0ZV92YWxpZCkge1xuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQud2Fybih0aGlzLCBjb21waWxlcl93YXJuaW5ncy5hMTF5X21pc3NpbmdfYXR0cmlidXRlKCdhJywgJ2FuJywgJ2hyZWYnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcmVxdWlyZWRfYXR0cmlidXRlcyA9IGExMXlfcmVxdWlyZWRfYXR0cmlidXRlc1t0aGlzLm5hbWVdO1xuICAgICAgICAgICAgaWYgKHJlcXVpcmVkX2F0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNfYXR0cmlidXRlID0gcmVxdWlyZWRfYXR0cmlidXRlcy5zb21lKG5hbWUgPT4gYXR0cmlidXRlX21hcC5oYXMobmFtZSkpO1xuICAgICAgICAgICAgICAgIGlmICghaGFzX2F0dHJpYnV0ZSkge1xuICAgICAgICAgICAgICAgICAgICBzaG91bGRfaGF2ZV9hdHRyaWJ1dGUodGhpcywgcmVxdWlyZWRfYXR0cmlidXRlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5hbWUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBhdHRyaWJ1dGVfbWFwLmdldCgndHlwZScpO1xuICAgICAgICAgICAgaWYgKHR5cGUgJiYgdHlwZS5nZXRfc3RhdGljX3ZhbHVlKCkgPT09ICdpbWFnZScpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXF1aXJlZF9hdHRyaWJ1dGVzID0gWydhbHQnLCAnYXJpYS1sYWJlbCcsICdhcmlhLWxhYmVsbGVkYnknXTtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNfYXR0cmlidXRlID0gcmVxdWlyZWRfYXR0cmlidXRlcy5zb21lKG5hbWUgPT4gYXR0cmlidXRlX21hcC5oYXMobmFtZSkpO1xuICAgICAgICAgICAgICAgIGlmICghaGFzX2F0dHJpYnV0ZSkge1xuICAgICAgICAgICAgICAgICAgICBzaG91bGRfaGF2ZV9hdHRyaWJ1dGUodGhpcywgcmVxdWlyZWRfYXR0cmlidXRlcywgJ2lucHV0IHR5cGU9XCJpbWFnZVwiJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5hbWUgPT09ICdpbWcnKSB7XG4gICAgICAgICAgICBjb25zdCBhbHRfYXR0cmlidXRlID0gYXR0cmlidXRlX21hcC5nZXQoJ2FsdCcpO1xuICAgICAgICAgICAgY29uc3QgYXJpYV9oaWRkZW5fYXR0cmlidXRlID0gYXR0cmlidXRlX21hcC5nZXQoJ2FyaWEtaGlkZGVuJyk7XG4gICAgICAgICAgICBjb25zdCBhcmlhX2hpZGRlbl9leGlzdCA9IGFyaWFfaGlkZGVuX2F0dHJpYnV0ZSAmJiBhcmlhX2hpZGRlbl9hdHRyaWJ1dGUuZ2V0X3N0YXRpY192YWx1ZSgpO1xuICAgICAgICAgICAgaWYgKGFsdF9hdHRyaWJ1dGUgJiYgIWFyaWFfaGlkZGVuX2V4aXN0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWx0X3ZhbHVlID0gYWx0X2F0dHJpYnV0ZS5nZXRfc3RhdGljX3ZhbHVlKCk7XG4gICAgICAgICAgICAgICAgaWYgKC9cXGIoaW1hZ2V8cGljdHVyZXxwaG90bylcXGIvaS50ZXN0KGFsdF92YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lndhcm4odGhpcywgY29tcGlsZXJfd2FybmluZ3MuYTExeV9pbWdfcmVkdW5kYW50X2FsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5hbWUgPT09ICdsYWJlbCcpIHtcbiAgICAgICAgICAgIGNvbnN0IGhhc19pbnB1dF9jaGlsZCA9IHRoaXMuY2hpbGRyZW4uc29tZShpID0+IChpIGluc3RhbmNlb2YgRWxlbWVudCAmJiBhMTF5X2xhYmVsYWJsZS5oYXMoaS5uYW1lKSkpO1xuICAgICAgICAgICAgaWYgKCFhdHRyaWJ1dGVfbWFwLmhhcygnZm9yJykgJiYgIWhhc19pbnB1dF9jaGlsZCkge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKHRoaXMsIGNvbXBpbGVyX3dhcm5pbmdzLmExMXlfbGFiZWxfaGFzX2Fzc29jaWF0ZWRfY29udHJvbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubmFtZSA9PT0gJ3ZpZGVvJykge1xuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZV9tYXAuaGFzKCdtdXRlZCcpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGhhc19jYXB0aW9uO1xuICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLmNoaWxkcmVuLmZpbmQoKGkpID0+IGkubmFtZSA9PT0gJ3RyYWNrJyk7XG4gICAgICAgICAgICBpZiAodHJhY2spIHtcbiAgICAgICAgICAgICAgICBoYXNfY2FwdGlvbiA9IHRyYWNrLmF0dHJpYnV0ZXMuZmluZChhID0+IGEubmFtZSA9PT0gJ2tpbmQnICYmIGEuZ2V0X3N0YXRpY192YWx1ZSgpID09PSAnY2FwdGlvbnMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghaGFzX2NhcHRpb24pIHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQud2Fybih0aGlzLCBjb21waWxlcl93YXJuaW5ncy5hMTF5X21lZGlhX2hhc19jYXB0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoYTExeV9kaXN0cmFjdGluZ19lbGVtZW50cy5oYXModGhpcy5uYW1lKSkge1xuICAgICAgICAgICAgLy8gbm8tZGlzdHJhY3RpbmctZWxlbWVudHNcbiAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKHRoaXMsIGNvbXBpbGVyX3dhcm5pbmdzLmExMXlfZGlzdHJhY3RpbmdfZWxlbWVudHModGhpcy5uYW1lKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubmFtZSA9PT0gJ2ZpZ2NhcHRpb24nKSB7XG4gICAgICAgICAgICBsZXQgeyBwYXJlbnQgfSA9IHRoaXM7XG4gICAgICAgICAgICBsZXQgaXNfZmlndXJlX3BhcmVudCA9IGZhbHNlO1xuICAgICAgICAgICAgd2hpbGUgKHBhcmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJlbnQubmFtZSA9PT0gJ2ZpZ3VyZScpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNfZmlndXJlX3BhcmVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocGFyZW50LnR5cGUgPT09ICdFbGVtZW50Jykge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghaXNfZmlndXJlX3BhcmVudCkge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKHRoaXMsIGNvbXBpbGVyX3dhcm5pbmdzLmExMXlfc3RydWN0dXJlX2ltbWVkaWF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubmFtZSA9PT0gJ2ZpZ3VyZScpIHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbi5maWx0ZXIobm9kZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0NvbW1lbnQnKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ1RleHQnKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gL1xcUy8udGVzdChub2RlLmRhdGEpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGNoaWxkcmVuLmZpbmRJbmRleChjaGlsZCA9PiBjaGlsZC5uYW1lID09PSAnZmlnY2FwdGlvbicpO1xuICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSAmJiAoaW5kZXggIT09IDAgJiYgaW5kZXggIT09IGNoaWxkcmVuLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50Lndhcm4oY2hpbGRyZW5baW5kZXhdLCBjb21waWxlcl93YXJuaW5ncy5hMTF5X3N0cnVjdHVyZV9maXJzdF9vcl9sYXN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFuZGxlcnNfbWFwLmhhcygnbW91c2VvdmVyJykgJiYgIWhhbmRsZXJzX21hcC5oYXMoJ2ZvY3VzJykpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKHRoaXMsIGNvbXBpbGVyX3dhcm5pbmdzLmExMXlfbW91c2VfZXZlbnRzX2hhdmVfa2V5X2V2ZW50cygnbW91c2VvdmVyJywgJ2ZvY3VzJykpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYW5kbGVyc19tYXAuaGFzKCdtb3VzZW91dCcpICYmICFoYW5kbGVyc19tYXAuaGFzKCdibHVyJykpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKHRoaXMsIGNvbXBpbGVyX3dhcm5pbmdzLmExMXlfbW91c2VfZXZlbnRzX2hhdmVfa2V5X2V2ZW50cygnbW91c2VvdXQnLCAnYmx1cicpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2YWxpZGF0ZV9iaW5kaW5nc19mb3JlaWduKCkge1xuICAgICAgICB0aGlzLmJpbmRpbmdzLmZvckVhY2goYmluZGluZyA9PiB7XG4gICAgICAgICAgICBpZiAoYmluZGluZy5uYW1lICE9PSAndGhpcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnQuZXJyb3IoYmluZGluZywgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfYmluZGluZ19mb3JlaWduKGJpbmRpbmcubmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgdmFsaWRhdGVfYmluZGluZ3MoKSB7XG4gICAgICAgIGNvbnN0IHsgY29tcG9uZW50IH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBjaGVja190eXBlX2F0dHJpYnV0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IHRoaXMuYXR0cmlidXRlcy5maW5kKChhdHRyaWJ1dGUpID0+IGF0dHJpYnV0ZS5uYW1lID09PSAndHlwZScpO1xuICAgICAgICAgICAgaWYgKCFhdHRyaWJ1dGUpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBpZiAoIWF0dHJpYnV0ZS5pc19zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGF0dHJpYnV0ZSwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfdHlwZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGF0dHJpYnV0ZS5nZXRfc3RhdGljX3ZhbHVlKCk7XG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGF0dHJpYnV0ZSwgY29tcGlsZXJfZXJyb3JzLm1pc3NpbmdfdHlwZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmluZGluZ3MuZm9yRWFjaChiaW5kaW5nID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gYmluZGluZztcbiAgICAgICAgICAgIGlmIChuYW1lID09PSAndmFsdWUnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubmFtZSAhPT0gJ2lucHV0JyAmJlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hbWUgIT09ICd0ZXh0YXJlYScgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYW1lICE9PSAnc2VsZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGJpbmRpbmcsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2JpbmRpbmdfZWxlbWVudHModGhpcy5uYW1lLCAndmFsdWUnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5hbWUgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IHRoaXMuYXR0cmlidXRlcy5maW5kKChhdHRyaWJ1dGUpID0+IGF0dHJpYnV0ZS5uYW1lID09PSAnbXVsdGlwbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZSAmJiAhYXR0cmlidXRlLmlzX3N0YXRpYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihhdHRyaWJ1dGUsIGNvbXBpbGVyX2Vycm9ycy5keW5hbWljX211bHRpcGxlX2F0dHJpYnV0ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNoZWNrX3R5cGVfYXR0cmlidXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAobmFtZSA9PT0gJ2NoZWNrZWQnIHx8IG5hbWUgPT09ICdpbmRldGVybWluYXRlJykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5hbWUgIT09ICdpbnB1dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihiaW5kaW5nLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX2VsZW1lbnRzKHRoaXMubmFtZSwgbmFtZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gY2hlY2tfdHlwZV9hdHRyaWJ1dGUoKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSAhPT0gJ2NoZWNrYm94Jykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGJpbmRpbmcsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2JpbmRpbmdfbm9fY2hlY2tib3gobmFtZSwgdHlwZSA9PT0gJ3JhZGlvJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5hbWUgPT09ICdncm91cCcpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uYW1lICE9PSAnaW5wdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoYmluZGluZywgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfYmluZGluZ19lbGVtZW50cyh0aGlzLm5hbWUsICdncm91cCcpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGNoZWNrX3R5cGVfYXR0cmlidXRlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgIT09ICdjaGVja2JveCcgJiYgdHlwZSAhPT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGJpbmRpbmcsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2JpbmRpbmdfZWxlbWVudF93aXRoKCc8aW5wdXQgdHlwZT1cImNoZWNrYm94XCI+IG9yIDxpbnB1dCB0eXBlPVwicmFkaW9cIj4nLCAnZ3JvdXAnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAobmFtZSA9PT0gJ2ZpbGVzJykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5hbWUgIT09ICdpbnB1dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihiaW5kaW5nLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX2VsZW1lbnRzKHRoaXMubmFtZSwgJ2ZpbGVzJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gY2hlY2tfdHlwZV9hdHRyaWJ1dGUoKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSAhPT0gJ2ZpbGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoYmluZGluZywgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfYmluZGluZ19lbGVtZW50X3dpdGgoJzxpbnB1dCB0eXBlPVwiZmlsZVwiPicsICdmaWxlcycpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChuYW1lID09PSAnb3BlbicpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uYW1lICE9PSAnZGV0YWlscycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihiaW5kaW5nLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX2VsZW1lbnRfd2l0aCgnPGRldGFpbHM+JywgbmFtZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5hbWUgPT09ICdjdXJyZW50VGltZScgfHxcbiAgICAgICAgICAgICAgICBuYW1lID09PSAnZHVyYXRpb24nIHx8XG4gICAgICAgICAgICAgICAgbmFtZSA9PT0gJ3BhdXNlZCcgfHxcbiAgICAgICAgICAgICAgICBuYW1lID09PSAnYnVmZmVyZWQnIHx8XG4gICAgICAgICAgICAgICAgbmFtZSA9PT0gJ3NlZWthYmxlJyB8fFxuICAgICAgICAgICAgICAgIG5hbWUgPT09ICdwbGF5ZWQnIHx8XG4gICAgICAgICAgICAgICAgbmFtZSA9PT0gJ3ZvbHVtZScgfHxcbiAgICAgICAgICAgICAgICBuYW1lID09PSAnbXV0ZWQnIHx8XG4gICAgICAgICAgICAgICAgbmFtZSA9PT0gJ3BsYXliYWNrUmF0ZScgfHxcbiAgICAgICAgICAgICAgICBuYW1lID09PSAnc2Vla2luZycgfHxcbiAgICAgICAgICAgICAgICBuYW1lID09PSAnZW5kZWQnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubmFtZSAhPT0gJ2F1ZGlvJyAmJiB0aGlzLm5hbWUgIT09ICd2aWRlbycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihiaW5kaW5nLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX2VsZW1lbnRfd2l0aCgnYXVkaW8+IG9yIDx2aWRlbz4nLCBuYW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAobmFtZSA9PT0gJ3ZpZGVvSGVpZ2h0JyB8fFxuICAgICAgICAgICAgICAgIG5hbWUgPT09ICd2aWRlb1dpZHRoJykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5hbWUgIT09ICd2aWRlbycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihiaW5kaW5nLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX2VsZW1lbnRfd2l0aCgnPHZpZGVvPicsIG5hbWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChkaW1lbnNpb25zLnRlc3QobmFtZSkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uYW1lID09PSAnc3ZnJyAmJiAobmFtZSA9PT0gJ29mZnNldFdpZHRoJyB8fCBuYW1lID09PSAnb2Zmc2V0SGVpZ2h0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihiaW5kaW5nLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX29uKGJpbmRpbmcubmFtZSwgYDxzdmc+LiBVc2UgJyR7bmFtZS5yZXBsYWNlKCdvZmZzZXQnLCAnY2xpZW50Jyl9JyBpbnN0ZWFkYCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChzdmckMS50ZXN0KHRoaXMubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihiaW5kaW5nLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX29uKGJpbmRpbmcubmFtZSwgJ1NWRyBlbGVtZW50cycpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNfdm9pZCh0aGlzLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoYmluZGluZywgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfYmluZGluZ19vbihiaW5kaW5nLm5hbWUsIGB2b2lkIGVsZW1lbnRzIGxpa2UgPCR7dGhpcy5uYW1lfT4uIFVzZSBhIHdyYXBwZXIgZWxlbWVudCBpbnN0ZWFkYCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5hbWUgPT09ICd0ZXh0Q29udGVudCcgfHxcbiAgICAgICAgICAgICAgICBuYW1lID09PSAnaW5uZXJIVE1MJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRlZGl0YWJsZSA9IHRoaXMuYXR0cmlidXRlcy5maW5kKChhdHRyaWJ1dGUpID0+IGF0dHJpYnV0ZS5uYW1lID09PSAnY29udGVudGVkaXRhYmxlJyk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb250ZW50ZWRpdGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihiaW5kaW5nLCBjb21waWxlcl9lcnJvcnMubWlzc2luZ19jb250ZW50ZWRpdGFibGVfYXR0cmlidXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29udGVudGVkaXRhYmxlICYmICFjb250ZW50ZWRpdGFibGUuaXNfc3RhdGljKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoY29udGVudGVkaXRhYmxlLCBjb21waWxlcl9lcnJvcnMuZHluYW1pY19jb250ZW50ZWRpdGFibGVfYXR0cmlidXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChuYW1lICE9PSAndGhpcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGJpbmRpbmcsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2JpbmRpbmcoYmluZGluZy5uYW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB2YWxpZGF0ZV9jb250ZW50KCkge1xuICAgICAgICBpZiAoIWExMXlfcmVxdWlyZWRfY29udGVudC5oYXModGhpcy5uYW1lKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMuYmluZGluZ3NcbiAgICAgICAgICAgIC5zb21lKChiaW5kaW5nKSA9PiBbJ3RleHRDb250ZW50JywgJ2lubmVySFRNTCddLmluY2x1ZGVzKGJpbmRpbmcubmFtZSkpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Lndhcm4odGhpcywgY29tcGlsZXJfd2FybmluZ3MuYTExeV9taXNzaW5nX2NvbnRlbnQodGhpcy5uYW1lKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmFsaWRhdGVfZXZlbnRfaGFuZGxlcnMoKSB7XG4gICAgICAgIGNvbnN0IHsgY29tcG9uZW50IH0gPSB0aGlzO1xuICAgICAgICB0aGlzLmhhbmRsZXJzLmZvckVhY2goaGFuZGxlciA9PiB7XG4gICAgICAgICAgICBpZiAoaGFuZGxlci5tb2RpZmllcnMuaGFzKCdwYXNzaXZlJykgJiYgaGFuZGxlci5tb2RpZmllcnMuaGFzKCdwcmV2ZW50RGVmYXVsdCcpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihoYW5kbGVyLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9ldmVudF9tb2RpZmllcl9jb21iaW5hdGlvbigncGFzc2l2ZScsICdwcmV2ZW50RGVmYXVsdCcpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoYW5kbGVyLm1vZGlmaWVycy5oYXMoJ3Bhc3NpdmUnKSAmJiBoYW5kbGVyLm1vZGlmaWVycy5oYXMoJ25vbnBhc3NpdmUnKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoaGFuZGxlciwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfZXZlbnRfbW9kaWZpZXJfY29tYmluYXRpb24oJ3Bhc3NpdmUnLCAnbm9ucGFzc2l2ZScpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhhbmRsZXIubW9kaWZpZXJzLmZvckVhY2gobW9kaWZpZXIgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghdmFsaWRfbW9kaWZpZXJzLmhhcyhtb2RpZmllcikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihoYW5kbGVyLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9ldmVudF9tb2RpZmllcihsaXN0KEFycmF5LmZyb20odmFsaWRfbW9kaWZpZXJzKSkpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1vZGlmaWVyID09PSAncGFzc2l2ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhc3NpdmVfZXZlbnRzLmhhcyhoYW5kbGVyLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5jYW5fbWFrZV9wYXNzaXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lndhcm4oaGFuZGxlciwgY29tcGlsZXJfd2FybmluZ3MucmVkdW5kYW50X2V2ZW50X21vZGlmaWVyX2Zvcl90b3VjaCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQud2FybihoYW5kbGVyLCBjb21waWxlcl93YXJuaW5ncy5yZWR1bmRhbnRfZXZlbnRfbW9kaWZpZXJfcGFzc2l2ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5jb21waWxlX29wdGlvbnMubGVnYWN5ICYmIChtb2RpZmllciA9PT0gJ29uY2UnIHx8IG1vZGlmaWVyID09PSAncGFzc2l2ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gdGhpcyBjb3VsZCBiZSBzdXBwb3J0ZWQsIGJ1dCBpdCB3b3VsZCBuZWVkIGEgZmV3IGNoYW5nZXMgdG9cbiAgICAgICAgICAgICAgICAgICAgLy8gaG93IGV2ZW50IGxpc3RlbmVycyB3b3JrXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoaGFuZGxlciwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfZXZlbnRfbW9kaWZpZXJfbGVnYWN5KG1vZGlmaWVyKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAocGFzc2l2ZV9ldmVudHMuaGFzKGhhbmRsZXIubmFtZSkgJiYgaGFuZGxlci5jYW5fbWFrZV9wYXNzaXZlICYmICFoYW5kbGVyLm1vZGlmaWVycy5oYXMoJ3ByZXZlbnREZWZhdWx0JykgJiYgIWhhbmRsZXIubW9kaWZpZXJzLmhhcygnbm9ucGFzc2l2ZScpKSB7XG4gICAgICAgICAgICAgICAgLy8gdG91Y2gvd2hlZWwgZXZlbnRzIHNob3VsZCBiZSBwYXNzaXZlIGJ5IGRlZmF1bHRcbiAgICAgICAgICAgICAgICBoYW5kbGVyLm1vZGlmaWVycy5hZGQoJ3Bhc3NpdmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGlzX21lZGlhX25vZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5hbWUgPT09ICdhdWRpbycgfHwgdGhpcy5uYW1lID09PSAndmlkZW8nO1xuICAgIH1cbiAgICBhZGRfY3NzX2NsYXNzKCkge1xuICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGVzLnNvbWUoYXR0ciA9PiBhdHRyLmlzX3NwcmVhZCkpIHtcbiAgICAgICAgICAgIHRoaXMubmVlZHNfbWFudWFsX3N0eWxlX3Njb3BpbmcgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgaWQgfSA9IHRoaXMuY29tcG9uZW50LnN0eWxlc2hlZXQ7XG4gICAgICAgIGNvbnN0IGNsYXNzX2F0dHJpYnV0ZSA9IHRoaXMuYXR0cmlidXRlcy5maW5kKGEgPT4gYS5uYW1lID09PSAnY2xhc3MnKTtcbiAgICAgICAgaWYgKGNsYXNzX2F0dHJpYnV0ZSAmJiAhY2xhc3NfYXR0cmlidXRlLmlzX3RydWUpIHtcbiAgICAgICAgICAgIGlmIChjbGFzc19hdHRyaWJ1dGUuY2h1bmtzLmxlbmd0aCA9PT0gMSAmJiBjbGFzc19hdHRyaWJ1dGUuY2h1bmtzWzBdLnR5cGUgPT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgIGNsYXNzX2F0dHJpYnV0ZS5jaHVua3NbMF0uZGF0YSArPSBgICR7aWR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNsYXNzX2F0dHJpYnV0ZS5jaHVua3MucHVzaChuZXcgVGV4dCh0aGlzLmNvbXBvbmVudCwgdGhpcywgdGhpcy5zY29wZSwge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVGV4dCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGAgJHtpZH1gLFxuICAgICAgICAgICAgICAgICAgICBzeW50aGV0aWM6IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMucHVzaChuZXcgQXR0cmlidXRlKHRoaXMuY29tcG9uZW50LCB0aGlzLCB0aGlzLnNjb3BlLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0F0dHJpYnV0ZScsXG4gICAgICAgICAgICAgICAgbmFtZTogJ2NsYXNzJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogW3sgdHlwZTogJ1RleHQnLCBkYXRhOiBpZCwgc3ludGhldGljOiB0cnVlIH1dXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHNsb3RfdGVtcGxhdGVfbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlcy5maW5kKGF0dHJpYnV0ZSA9PiBhdHRyaWJ1dGUubmFtZSA9PT0gJ3Nsb3QnKS5nZXRfc3RhdGljX3ZhbHVlKCk7XG4gICAgfVxuICAgIG9wdGltaXNlKCkge1xuICAgICAgICBhdHRyaWJ1dGVzX3RvX2NvbXBhY3Rfd2hpdGVzcGFjZS5mb3JFYWNoKGF0dHJpYnV0ZV9uYW1lID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IHRoaXMuYXR0cmlidXRlcy5maW5kKGEgPT4gYS5uYW1lID09PSBhdHRyaWJ1dGVfbmFtZSk7XG4gICAgICAgICAgICBpZiAoYXR0cmlidXRlICYmICFhdHRyaWJ1dGUuaXNfdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5jaHVua3MuZm9yRWFjaCgoY2h1bmssIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaHVuay50eXBlID09PSAnVGV4dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gY2h1bmsuZGF0YS5yZXBsYWNlKC9bXFxzXFxuXFx0XSsvZywgJyAnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnRyaW1MZWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpbmRleCA9PT0gYXR0cmlidXRlLmNodW5rcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEudHJpbVJpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjaHVuay5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBzaG91bGRfaGF2ZV9hdHRyaWJ1dGUobm9kZSwgYXR0cmlidXRlcywgbmFtZSA9IG5vZGUubmFtZSkge1xuICAgIGNvbnN0IGFydGljbGUgPSAvXlthZWlvdV0vLnRlc3QoYXR0cmlidXRlc1swXSkgPyAnYW4nIDogJ2EnO1xuICAgIGNvbnN0IHNlcXVlbmNlID0gYXR0cmlidXRlcy5sZW5ndGggPiAxID9cbiAgICAgICAgYXR0cmlidXRlcy5zbGljZSgwLCAtMSkuam9pbignLCAnKSArIGAgb3IgJHthdHRyaWJ1dGVzW2F0dHJpYnV0ZXMubGVuZ3RoIC0gMV19YCA6XG4gICAgICAgIGF0dHJpYnV0ZXNbMF07XG4gICAgbm9kZS5jb21wb25lbnQud2Fybihub2RlLCBjb21waWxlcl93YXJuaW5ncy5hMTF5X21pc3NpbmdfYXR0cmlidXRlKG5hbWUsIGFydGljbGUsIHNlcXVlbmNlKSk7XG59XG5mdW5jdGlvbiB3aXRoaW5fY3VzdG9tX2VsZW1lbnQocGFyZW50KSB7XG4gICAgd2hpbGUgKHBhcmVudCkge1xuICAgICAgICBpZiAocGFyZW50LnR5cGUgPT09ICdJbmxpbmVDb21wb25lbnQnKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAocGFyZW50LnR5cGUgPT09ICdFbGVtZW50JyAmJiAvLS8udGVzdChwYXJlbnQubmFtZSkpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vZGFya3NreWFwcC9zdHJpbmctaGFzaC9ibG9iL21hc3Rlci9pbmRleC5qc1xuZnVuY3Rpb24gaGFzaChzdHIpIHtcbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvXFxyL2csICcnKTtcbiAgICBsZXQgaGFzaCA9IDUzODE7XG4gICAgbGV0IGkgPSBzdHIubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pXG4gICAgICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSBeIHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgIHJldHVybiAoaGFzaCA+Pj4gMCkudG9TdHJpbmcoMzYpO1xufVxuXG5jbGFzcyBIZWFkIGV4dGVuZHMgTm9kZSQxIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgaWYgKGluZm8uYXR0cmlidXRlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5lcnJvcihpbmZvLmF0dHJpYnV0ZXNbMF0sIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2F0dHJpYnV0ZV9oZWFkKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gbWFwX2NoaWxkcmVuKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mby5jaGlsZHJlbi5maWx0ZXIoY2hpbGQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIChjaGlsZC50eXBlICE9PSAnVGV4dCcgfHwgL1xcUy8udGVzdChjaGlsZC5kYXRhKSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGBzdmVsdGUtJHtoYXNoKHRoaXMuY29tcG9uZW50LnNvdXJjZS5zbGljZSh0aGlzLnN0YXJ0LCB0aGlzLmVuZCkpfWA7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNsYXNzIElmQmxvY2sgZXh0ZW5kcyBBYnN0cmFjdEJsb2NrIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgdGhpcy5leHByZXNzaW9uID0gbmV3IEV4cHJlc3Npb24oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgaW5mby5leHByZXNzaW9uKTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IG1hcF9jaGlsZHJlbihjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBpbmZvLmNoaWxkcmVuKTtcbiAgICAgICAgdGhpcy5lbHNlID0gaW5mby5lbHNlXG4gICAgICAgICAgICA/IG5ldyBFbHNlQmxvY2soY29tcG9uZW50LCB0aGlzLCBzY29wZSwgaW5mby5lbHNlKVxuICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICB0aGlzLndhcm5faWZfZW1wdHlfYmxvY2soKTtcbiAgICB9XG59XG5cbmNsYXNzIElubGluZUNvbXBvbmVudCBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMuYXR0cmlidXRlcyA9IFtdO1xuICAgICAgICB0aGlzLmJpbmRpbmdzID0gW107XG4gICAgICAgIHRoaXMuaGFuZGxlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5sZXRzID0gW107XG4gICAgICAgIHRoaXMuY3NzX2N1c3RvbV9wcm9wZXJ0aWVzID0gW107XG4gICAgICAgIGlmIChpbmZvLm5hbWUgIT09ICdzdmVsdGU6Y29tcG9uZW50JyAmJiBpbmZvLm5hbWUgIT09ICdzdmVsdGU6c2VsZicpIHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBpbmZvLm5hbWUuc3BsaXQoJy4nKVswXTsgLy8gYWNjb21tb2RhdGUgbmFtZXNwYWNlc1xuICAgICAgICAgICAgY29tcG9uZW50Lndhcm5faWZfdW5kZWZpbmVkKG5hbWUsIGluZm8sIHNjb3BlKTtcbiAgICAgICAgICAgIGNvbXBvbmVudC5hZGRfcmVmZXJlbmNlKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmFtZSA9IGluZm8ubmFtZTtcbiAgICAgICAgdGhpcy5leHByZXNzaW9uID0gdGhpcy5uYW1lID09PSAnc3ZlbHRlOmNvbXBvbmVudCdcbiAgICAgICAgICAgID8gbmV3IEV4cHJlc3Npb24oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgaW5mby5leHByZXNzaW9uKVxuICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICBpbmZvLmF0dHJpYnV0ZXMuZm9yRWFjaChub2RlID0+IHtcbiAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWZhbGx0aHJvdWdoICovXG4gICAgICAgICAgICBzd2l0Y2ggKG5vZGUudHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ0FjdGlvbic6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3Iobm9kZSwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfYWN0aW9uKTtcbiAgICAgICAgICAgICAgICBjYXNlICdBdHRyaWJ1dGUnOlxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5uYW1lLnN0YXJ0c1dpdGgoJy0tJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3NzX2N1c3RvbV9wcm9wZXJ0aWVzLnB1c2gobmV3IEF0dHJpYnV0ZShjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGZhbGx0aHJvdWdoXG4gICAgICAgICAgICAgICAgY2FzZSAnU3ByZWFkJzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLnB1c2gobmV3IEF0dHJpYnV0ZShjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0JpbmRpbmcnOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRpbmdzLnB1c2gobmV3IEJpbmRpbmcoY29tcG9uZW50LCB0aGlzLCBzY29wZSwgbm9kZSkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdDbGFzcyc6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3Iobm9kZSwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfY2xhc3MpO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0V2ZW50SGFuZGxlcic6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaChuZXcgRXZlbnRIYW5kbGVyKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIG5vZGUpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnTGV0JzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sZXRzLnB1c2gobmV3IExldChjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ1RyYW5zaXRpb24nOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKG5vZGUsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX3RyYW5zaXRpb24pO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTm90IGltcGxlbWVudGVkOiAke25vZGUudHlwZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tZmFsbHRocm91Z2ggKi9cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLmxldHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5zY29wZSA9IHNjb3BlLmNoaWxkKCk7XG4gICAgICAgICAgICB0aGlzLmxldHMuZm9yRWFjaChsID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBuZXcgU2V0KFtsLm5hbWUubmFtZV0pO1xuICAgICAgICAgICAgICAgIGwubmFtZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY29wZS5hZGQobmFtZSwgZGVwZW5kZW5jaWVzLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zY29wZSA9IHNjb3BlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaGFuZGxlcnMuZm9yRWFjaChoYW5kbGVyID0+IHtcbiAgICAgICAgICAgIGhhbmRsZXIubW9kaWZpZXJzLmZvckVhY2gobW9kaWZpZXIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChtb2RpZmllciAhPT0gJ29uY2UnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoaGFuZGxlciwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfZXZlbnRfbW9kaWZpZXJfY29tcG9uZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSBpbmZvLmNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IGluZm8uY2hpbGRyZW5baV07XG4gICAgICAgICAgICBpZiAoY2hpbGQudHlwZSA9PT0gJ1Nsb3RUZW1wbGF0ZScpIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkKTtcbiAgICAgICAgICAgICAgICBpbmZvLmNoaWxkcmVuLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKChjaGlsZC50eXBlID09PSAnRWxlbWVudCcgfHwgY2hpbGQudHlwZSA9PT0gJ0lubGluZUNvbXBvbmVudCcgfHwgY2hpbGQudHlwZSA9PT0gJ1Nsb3QnKSAmJiBjaGlsZC5hdHRyaWJ1dGVzLmZpbmQoYXR0cmlidXRlID0+IGF0dHJpYnV0ZS5uYW1lID09PSAnc2xvdCcpKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2xvdF90ZW1wbGF0ZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGNoaWxkLnN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICBlbmQ6IGNoaWxkLmVuZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1Nsb3RUZW1wbGF0ZScsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdzdmVsdGU6ZnJhZ21lbnQnLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtjaGlsZF1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIC8vIHRyYW5zZmVyIGF0dHJpYnV0ZXNcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gY2hpbGQuYXR0cmlidXRlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGUgPSBjaGlsZC5hdHRyaWJ1dGVzW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlLnR5cGUgPT09ICdMZXQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzbG90X3RlbXBsYXRlLmF0dHJpYnV0ZXMucHVzaChhdHRyaWJ1dGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuYXR0cmlidXRlcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYXR0cmlidXRlLnR5cGUgPT09ICdBdHRyaWJ1dGUnICYmIGF0dHJpYnV0ZS5uYW1lID09PSAnc2xvdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsb3RfdGVtcGxhdGUuYXR0cmlidXRlcy5wdXNoKGF0dHJpYnV0ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gdHJhbnNmZXIgY29uc3RcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gY2hpbGQuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRfY2hpbGQgPSBjaGlsZC5jaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkX2NoaWxkLnR5cGUgPT09ICdDb25zdFRhZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsb3RfdGVtcGxhdGUuY2hpbGRyZW4ucHVzaChjaGlsZF9jaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5jaGlsZHJlbi5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChzbG90X3RlbXBsYXRlKTtcbiAgICAgICAgICAgICAgICBpbmZvLmNoaWxkcmVuLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaW5mby5jaGlsZHJlbi5zb21lKG5vZGUgPT4gbm90X3doaXRlc3BhY2VfdGV4dChub2RlKSkpIHtcbiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goe1xuICAgICAgICAgICAgICAgIHN0YXJ0OiBpbmZvLnN0YXJ0LFxuICAgICAgICAgICAgICAgIGVuZDogaW5mby5lbmQsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1Nsb3RUZW1wbGF0ZScsXG4gICAgICAgICAgICAgICAgbmFtZTogJ3N2ZWx0ZTpmcmFnbWVudCcsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczogW10sXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IGluZm8uY2hpbGRyZW5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBtYXBfY2hpbGRyZW4oY29tcG9uZW50LCB0aGlzLCB0aGlzLnNjb3BlLCBjaGlsZHJlbik7XG4gICAgfVxuICAgIGdldCBzbG90X3RlbXBsYXRlX25hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXMuZmluZChhdHRyaWJ1dGUgPT4gYXR0cmlidXRlLm5hbWUgPT09ICdzbG90JykuZ2V0X3N0YXRpY192YWx1ZSgpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG5vdF93aGl0ZXNwYWNlX3RleHQobm9kZSkge1xuICAgIHJldHVybiAhKG5vZGUudHlwZSA9PT0gJ1RleHQnICYmIC9eXFxzKyQvLnRlc3Qobm9kZS5kYXRhKSk7XG59XG5cbmNsYXNzIEtleUJsb2NrIGV4dGVuZHMgQWJzdHJhY3RCbG9jayB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IG5ldyBFeHByZXNzaW9uKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIGluZm8uZXhwcmVzc2lvbik7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBtYXBfY2hpbGRyZW4oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgaW5mby5jaGlsZHJlbik7XG4gICAgICAgIHRoaXMud2Fybl9pZl9lbXB0eV9ibG9jaygpO1xuICAgIH1cbn1cblxuY2xhc3MgVGFnIGV4dGVuZHMgTm9kZSQxIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgdGhpcy5leHByZXNzaW9uID0gbmV3IEV4cHJlc3Npb24oY29tcG9uZW50LCB0aGlzLCBzY29wZSwgaW5mby5leHByZXNzaW9uKTtcbiAgICAgICAgdGhpcy5zaG91bGRfY2FjaGUgPSAoaW5mby5leHByZXNzaW9uLnR5cGUgIT09ICdJZGVudGlmaWVyJyB8fFxuICAgICAgICAgICAgKHRoaXMuZXhwcmVzc2lvbi5kZXBlbmRlbmNpZXMuc2l6ZSAmJiBzY29wZS5uYW1lcy5oYXMoaW5mby5leHByZXNzaW9uLm5hbWUpKSk7XG4gICAgfVxufVxuXG5jbGFzcyBNdXN0YWNoZVRhZyBleHRlbmRzIFRhZyB7XG59XG5cbmNsYXNzIE9wdGlvbnMgZXh0ZW5kcyBOb2RlJDEge1xufVxuXG5jbGFzcyBSYXdNdXN0YWNoZVRhZyBleHRlbmRzIFRhZyB7XG59XG5cbmNsYXNzIERlYnVnVGFnIGV4dGVuZHMgTm9kZSQxIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgdGhpcy5leHByZXNzaW9ucyA9IGluZm8uaWRlbnRpZmllcnMubWFwKChub2RlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEV4cHJlc3Npb24oY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBub2RlKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5jbGFzcyBTbG90IGV4dGVuZHMgRWxlbWVudCB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMudmFsdWVzID0gbmV3IE1hcCgpO1xuICAgICAgICBpbmZvLmF0dHJpYnV0ZXMuZm9yRWFjaChhdHRyID0+IHtcbiAgICAgICAgICAgIGlmIChhdHRyLnR5cGUgIT09ICdBdHRyaWJ1dGUnICYmIGF0dHIudHlwZSAhPT0gJ1NwcmVhZCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGF0dHIsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX3Nsb3RfZGlyZWN0aXZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhdHRyLm5hbWUgPT09ICduYW1lJykge1xuICAgICAgICAgICAgICAgIGlmIChhdHRyLnZhbHVlLmxlbmd0aCAhPT0gMSB8fCBhdHRyLnZhbHVlWzBdLnR5cGUgIT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGF0dHIsIGNvbXBpbGVyX2Vycm9ycy5keW5hbWljX3Nsb3RfbmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2xvdF9uYW1lID0gYXR0ci52YWx1ZVswXS5kYXRhO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNsb3RfbmFtZSA9PT0gJ2RlZmF1bHQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoYXR0ciwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfc2xvdF9uYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnZhbHVlcy5zZXQoYXR0ci5uYW1lLCBuZXcgQXR0cmlidXRlKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIGF0dHIpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghdGhpcy5zbG90X25hbWUpXG4gICAgICAgICAgICB0aGlzLnNsb3RfbmFtZSA9ICdkZWZhdWx0JztcbiAgICAgICAgaWYgKHRoaXMuc2xvdF9uYW1lID09PSAnZGVmYXVsdCcpIHtcbiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgdGhlIGRlZmF1bHQgc2xvdCwgYWRkIG91ciBkZXBlbmRlbmNpZXMgdG8gYW55XG4gICAgICAgICAgICAvLyBvdGhlciBzbG90cyAod2hpY2ggaW5oZXJpdCBvdXIgc2xvdCB2YWx1ZXMpIHRoYXQgd2VyZVxuICAgICAgICAgICAgLy8gcHJldmlvdXNseSBlbmNvdW50ZXJlZFxuICAgICAgICAgICAgY29tcG9uZW50LnNsb3RzLmZvckVhY2goKHNsb3QpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlcy5mb3JFYWNoKChhdHRyaWJ1dGUsIG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzbG90LnZhbHVlcy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsb3QudmFsdWVzLnNldChuYW1lLCBhdHRyaWJ1dGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb21wb25lbnQuc2xvdHMuaGFzKCdkZWZhdWx0JykpIHtcbiAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgZ28gdGhlIG90aGVyIHdheSDigJQgaW5oZXJpdCB2YWx1ZXMgZnJvbVxuICAgICAgICAgICAgLy8gYSBwcmV2aW91c2x5IGVuY291bnRlcmVkIGRlZmF1bHQgc2xvdFxuICAgICAgICAgICAgY29uc3QgZGVmYXVsdF9zbG90ID0gY29tcG9uZW50LnNsb3RzLmdldCgnZGVmYXVsdCcpO1xuICAgICAgICAgICAgZGVmYXVsdF9zbG90LnZhbHVlcy5mb3JFYWNoKChhdHRyaWJ1dGUsIG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudmFsdWVzLmhhcyhuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlcy5zZXQobmFtZSwgYXR0cmlidXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb21wb25lbnQuc2xvdHMuc2V0KHRoaXMuc2xvdF9uYW1lLCB0aGlzKTtcbiAgICB9XG59XG5cbmNsYXNzIFNsb3RUZW1wbGF0ZSBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMubGV0cyA9IFtdO1xuICAgICAgICB0aGlzLnNsb3RfdGVtcGxhdGVfbmFtZSA9ICdkZWZhdWx0JztcbiAgICAgICAgdGhpcy52YWxpZGF0ZV9zbG90X3RlbXBsYXRlX3BsYWNlbWVudCgpO1xuICAgICAgICBjb25zdCBoYXNfbGV0ID0gaW5mby5hdHRyaWJ1dGVzLnNvbWUoKG5vZGUpID0+IG5vZGUudHlwZSA9PT0gJ0xldCcpO1xuICAgICAgICBpZiAoaGFzX2xldCkge1xuICAgICAgICAgICAgc2NvcGUgPSBzY29wZS5jaGlsZCgpO1xuICAgICAgICB9XG4gICAgICAgIGluZm8uYXR0cmlidXRlcy5mb3JFYWNoKChub2RlKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKG5vZGUudHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ0xldCc6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbCA9IG5ldyBMZXQoY29tcG9uZW50LCB0aGlzLCBzY29wZSwgbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGV0cy5wdXNoKGwpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBuZXcgU2V0KFtsLm5hbWUubmFtZV0pO1xuICAgICAgICAgICAgICAgICAgICBsLm5hbWVzLmZvckVhY2goKG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmFkZChuYW1lLCBkZXBlbmRlbmNpZXMsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgJ0F0dHJpYnV0ZSc6IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubmFtZSA9PT0gJ3Nsb3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNsb3RfYXR0cmlidXRlID0gbmV3IEF0dHJpYnV0ZShjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zbG90X2F0dHJpYnV0ZS5pc19zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKG5vZGUsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX3Nsb3RfYXR0cmlidXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5zbG90X2F0dHJpYnV0ZS5nZXRfc3RhdGljX3ZhbHVlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKG5vZGUsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX3Nsb3RfYXR0cmlidXRlX3ZhbHVlX21pc3NpbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zbG90X3RlbXBsYXRlX25hbWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBhdHRyaWJ1dGUgJyR7bm9kZS5uYW1lfScgaW4gPHN2ZWx0ZTpmcmFnbWVudD5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBOb3QgaW1wbGVtZW50ZWQ6ICR7bm9kZS50eXBlfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zY29wZSA9IHNjb3BlO1xuICAgICAgICAoW3RoaXMuY29uc3RfdGFncywgdGhpcy5jaGlsZHJlbl0gPSBnZXRfY29uc3RfdGFncyhpbmZvLmNoaWxkcmVuLCBjb21wb25lbnQsIHRoaXMsIHRoaXMpKTtcbiAgICB9XG4gICAgdmFsaWRhdGVfc2xvdF90ZW1wbGF0ZV9wbGFjZW1lbnQoKSB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudC50eXBlICE9PSAnSW5saW5lQ29tcG9uZW50Jykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50LmVycm9yKHRoaXMsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX3Nsb3R0ZWRfY29udGVudF9mcmFnbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNsYXNzIFRpdGxlIGV4dGVuZHMgTm9kZSQxIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8pIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IG1hcF9jaGlsZHJlbihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGluZm8uY2hpbGRyZW4pO1xuICAgICAgICBpZiAoaW5mby5hdHRyaWJ1dGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5lcnJvcihpbmZvLmF0dHJpYnV0ZXNbMF0sIGNvbXBpbGVyX2Vycm9ycy5pbGxlZ2FsX2F0dHJpYnV0ZV90aXRsZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaW5mby5jaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IHtcbiAgICAgICAgICAgIGlmIChjaGlsZC50eXBlICE9PSAnVGV4dCcgJiYgY2hpbGQudHlwZSAhPT0gJ011c3RhY2hlVGFnJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoY2hpbGQsIGNvbXBpbGVyX2Vycm9ycy5pbGxlZ2FsX3N0cnVjdHVyZV90aXRsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNob3VsZF9jYWNoZSA9IGluZm8uY2hpbGRyZW4ubGVuZ3RoID09PSAxXG4gICAgICAgICAgICA/IChpbmZvLmNoaWxkcmVuWzBdLnR5cGUgIT09ICdJZGVudGlmaWVyJyB8fFxuICAgICAgICAgICAgICAgIHNjb3BlLm5hbWVzLmhhcyhpbmZvLmNoaWxkcmVuWzBdLm5hbWUpKVxuICAgICAgICAgICAgOiB0cnVlO1xuICAgIH1cbn1cblxuY29uc3QgdmFsaWRfYmluZGluZ3MgPSBbXG4gICAgJ2lubmVyV2lkdGgnLFxuICAgICdpbm5lckhlaWdodCcsXG4gICAgJ291dGVyV2lkdGgnLFxuICAgICdvdXRlckhlaWdodCcsXG4gICAgJ3Njcm9sbFgnLFxuICAgICdzY3JvbGxZJyxcbiAgICAnb25saW5lJ1xuXTtcbmNsYXNzIFdpbmRvdyBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMuaGFuZGxlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9IFtdO1xuICAgICAgICB0aGlzLmFjdGlvbnMgPSBbXTtcbiAgICAgICAgaW5mby5hdHRyaWJ1dGVzLmZvckVhY2gobm9kZSA9PiB7XG4gICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnRXZlbnRIYW5kbGVyJykge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaChuZXcgRXZlbnRIYW5kbGVyKGNvbXBvbmVudCwgdGhpcywgc2NvcGUsIG5vZGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gJ0JpbmRpbmcnKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuZXhwcmVzc2lvbi50eXBlICE9PSAnSWRlbnRpZmllcicpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBwYXJ0cyB9ID0gZmxhdHRlbl9yZWZlcmVuY2Uobm9kZS5leHByZXNzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBpcyB0aGlzIGNvbnN0cmFpbnQgbmVjZXNzYXJ5P1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKG5vZGUuZXhwcmVzc2lvbiwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfYmluZGluZ193aW5kb3cocGFydHMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF+dmFsaWRfYmluZGluZ3MuaW5kZXhPZihub2RlLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gKG5vZGUubmFtZSA9PT0gJ3dpZHRoJyA/ICdpbm5lcldpZHRoJyA6XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlLm5hbWUgPT09ICdoZWlnaHQnID8gJ2lubmVySGVpZ2h0JyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnV6enltYXRjaChub2RlLm5hbWUsIHZhbGlkX2JpbmRpbmdzKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihub2RlLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9iaW5kaW5nX29uKG5vZGUubmFtZSwgJzxzdmVsdGU6d2luZG93PicsIGAgKGRpZCB5b3UgbWVhbiAnJHttYXRjaH0nPylgKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKG5vZGUsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2JpbmRpbmdfb24obm9kZS5uYW1lLCAnPHN2ZWx0ZTp3aW5kb3c+JywgYCDigJQgdmFsaWQgYmluZGluZ3MgYXJlICR7bGlzdCh2YWxpZF9iaW5kaW5ncyl9YCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuYmluZGluZ3MucHVzaChuZXcgQmluZGluZyhjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdBY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zLnB1c2gobmV3IEFjdGlvbihjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBub2RlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0X2NvbnN0cnVjdG9yKHR5cGUpIHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAnQXdhaXRCbG9jayc6IHJldHVybiBBd2FpdEJsb2NrO1xuICAgICAgICBjYXNlICdCb2R5JzogcmV0dXJuIEJvZHk7XG4gICAgICAgIGNhc2UgJ0NvbW1lbnQnOiByZXR1cm4gQ29tbWVudCQxO1xuICAgICAgICBjYXNlICdDb25zdFRhZyc6IHJldHVybiBDb25zdFRhZztcbiAgICAgICAgY2FzZSAnRWFjaEJsb2NrJzogcmV0dXJuIEVhY2hCbG9jaztcbiAgICAgICAgY2FzZSAnRWxlbWVudCc6IHJldHVybiBFbGVtZW50O1xuICAgICAgICBjYXNlICdIZWFkJzogcmV0dXJuIEhlYWQ7XG4gICAgICAgIGNhc2UgJ0lmQmxvY2snOiByZXR1cm4gSWZCbG9jaztcbiAgICAgICAgY2FzZSAnSW5saW5lQ29tcG9uZW50JzogcmV0dXJuIElubGluZUNvbXBvbmVudDtcbiAgICAgICAgY2FzZSAnS2V5QmxvY2snOiByZXR1cm4gS2V5QmxvY2s7XG4gICAgICAgIGNhc2UgJ011c3RhY2hlVGFnJzogcmV0dXJuIE11c3RhY2hlVGFnO1xuICAgICAgICBjYXNlICdPcHRpb25zJzogcmV0dXJuIE9wdGlvbnM7XG4gICAgICAgIGNhc2UgJ1Jhd011c3RhY2hlVGFnJzogcmV0dXJuIFJhd011c3RhY2hlVGFnO1xuICAgICAgICBjYXNlICdEZWJ1Z1RhZyc6IHJldHVybiBEZWJ1Z1RhZztcbiAgICAgICAgY2FzZSAnU2xvdCc6IHJldHVybiBTbG90O1xuICAgICAgICBjYXNlICdTbG90VGVtcGxhdGUnOiByZXR1cm4gU2xvdFRlbXBsYXRlO1xuICAgICAgICBjYXNlICdUZXh0JzogcmV0dXJuIFRleHQ7XG4gICAgICAgIGNhc2UgJ1RpdGxlJzogcmV0dXJuIFRpdGxlO1xuICAgICAgICBjYXNlICdXaW5kb3cnOiByZXR1cm4gV2luZG93O1xuICAgICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoYE5vdCBpbXBsZW1lbnRlZDogJHt0eXBlfWApO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG1hcF9jaGlsZHJlbihjb21wb25lbnQsIHBhcmVudCwgc2NvcGUsIGNoaWxkcmVuKSB7XG4gICAgbGV0IGxhc3QgPSBudWxsO1xuICAgIGxldCBpZ25vcmVzID0gW107XG4gICAgcmV0dXJuIGNoaWxkcmVuLm1hcChjaGlsZCA9PiB7XG4gICAgICAgIGNvbnN0IGNvbnN0cnVjdG9yID0gZ2V0X2NvbnN0cnVjdG9yKGNoaWxkLnR5cGUpO1xuICAgICAgICBjb25zdCB1c2VfaWdub3JlcyA9IGNoaWxkLnR5cGUgIT09ICdUZXh0JyAmJiBjaGlsZC50eXBlICE9PSAnQ29tbWVudCcgJiYgaWdub3Jlcy5sZW5ndGg7XG4gICAgICAgIGlmICh1c2VfaWdub3JlcylcbiAgICAgICAgICAgIGNvbXBvbmVudC5wdXNoX2lnbm9yZXMoaWdub3Jlcyk7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBuZXcgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBjaGlsZCk7XG4gICAgICAgIGlmICh1c2VfaWdub3JlcylcbiAgICAgICAgICAgIGNvbXBvbmVudC5wb3BfaWdub3JlcygpLCBpZ25vcmVzID0gW107XG4gICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdDb21tZW50JyAmJiBub2RlLmlnbm9yZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZ25vcmVzLnB1c2goLi4ubm9kZS5pZ25vcmVzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGFzdClcbiAgICAgICAgICAgIGxhc3QubmV4dCA9IG5vZGU7XG4gICAgICAgIG5vZGUucHJldiA9IGxhc3Q7XG4gICAgICAgIGxhc3QgPSBub2RlO1xuICAgICAgICByZXR1cm4gbm9kZTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gY2hlY2tfZ3JhcGhfZm9yX2N5Y2xlcyhlZGdlcykge1xuICAgIGNvbnN0IGdyYXBoID0gZWRnZXMucmVkdWNlKChnLCBlZGdlKSA9PiB7XG4gICAgICAgIGNvbnN0IFt1LCB2XSA9IGVkZ2U7XG4gICAgICAgIGlmICghZy5oYXModSkpXG4gICAgICAgICAgICBnLnNldCh1LCBbXSk7XG4gICAgICAgIGlmICghZy5oYXModikpXG4gICAgICAgICAgICBnLnNldCh2LCBbXSk7XG4gICAgICAgIGcuZ2V0KHUpLnB1c2godik7XG4gICAgICAgIHJldHVybiBnO1xuICAgIH0sIG5ldyBNYXAoKSk7XG4gICAgY29uc3QgdmlzaXRlZCA9IG5ldyBTZXQoKTtcbiAgICBjb25zdCBvbl9zdGFjayA9IG5ldyBTZXQoKTtcbiAgICBjb25zdCBjeWNsZXMgPSBbXTtcbiAgICBmdW5jdGlvbiB2aXNpdCh2KSB7XG4gICAgICAgIHZpc2l0ZWQuYWRkKHYpO1xuICAgICAgICBvbl9zdGFjay5hZGQodik7XG4gICAgICAgIGdyYXBoLmdldCh2KS5mb3JFYWNoKHcgPT4ge1xuICAgICAgICAgICAgaWYgKCF2aXNpdGVkLmhhcyh3KSkge1xuICAgICAgICAgICAgICAgIHZpc2l0KHcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAob25fc3RhY2suaGFzKHcpKSB7XG4gICAgICAgICAgICAgICAgY3ljbGVzLnB1c2goWy4uLm9uX3N0YWNrLCB3XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBvbl9zdGFjay5kZWxldGUodik7XG4gICAgfVxuICAgIGdyYXBoLmZvckVhY2goKF8sIHYpID0+IHtcbiAgICAgICAgaWYgKCF2aXNpdGVkLmhhcyh2KSkge1xuICAgICAgICAgICAgdmlzaXQodik7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY3ljbGVzWzBdO1xufVxuXG5mdW5jdGlvbiBnZXRfY29uc3RfdGFncyhjaGlsZHJlbiwgY29tcG9uZW50LCBub2RlLCBwYXJlbnQpIHtcbiAgICBjb25zdCBjb25zdF90YWdzID0gW107XG4gICAgY29uc3Qgb3RoZXJzID0gW107XG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbikge1xuICAgICAgICBpZiAoY2hpbGQudHlwZSA9PT0gJ0NvbnN0VGFnJykge1xuICAgICAgICAgICAgY29uc3RfdGFncy5wdXNoKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG90aGVycy5wdXNoKGNoaWxkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBjb25zdHNfbm9kZXMgPSBjb25zdF90YWdzLm1hcCh0YWcgPT4gbmV3IENvbnN0VGFnKGNvbXBvbmVudCwgbm9kZSwgbm9kZS5zY29wZSwgdGFnKSk7XG4gICAgY29uc3Qgc29ydGVkX2NvbnN0c19ub2RlcyA9IHNvcnRfY29uc3RzX25vZGVzKGNvbnN0c19ub2RlcywgY29tcG9uZW50KTtcbiAgICBzb3J0ZWRfY29uc3RzX25vZGVzLmZvckVhY2gobm9kZSA9PiBub2RlLnBhcnNlX2V4cHJlc3Npb24oKSk7XG4gICAgY29uc3QgY2hpbGRyZW5fbm9kZXMgPSBtYXBfY2hpbGRyZW4oY29tcG9uZW50LCBwYXJlbnQsIG5vZGUuc2NvcGUsIG90aGVycyk7XG4gICAgcmV0dXJuIFtzb3J0ZWRfY29uc3RzX25vZGVzLCBjaGlsZHJlbl9ub2Rlc107XG59XG5mdW5jdGlvbiBzb3J0X2NvbnN0c19ub2Rlcyhjb25zdHNfbm9kZXMsIGNvbXBvbmVudCkge1xuICAgIGNvbnN0IHNvcnRlZF9jb25zdHNfbm9kZXMgPSBbXTtcbiAgICBjb25zdCB1bnNvcnRlZF9jb25zdHNfbm9kZXMgPSBjb25zdHNfbm9kZXMubWFwKG5vZGUgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYXNzaWduZWVzOiBub2RlLmFzc2lnbmVlcyxcbiAgICAgICAgICAgIGRlcGVuZGVuY2llczogbm9kZS5kZXBlbmRlbmNpZXMsXG4gICAgICAgICAgICBub2RlXG4gICAgICAgIH07XG4gICAgfSk7XG4gICAgY29uc3QgbG9va3VwID0gbmV3IE1hcCgpO1xuICAgIHVuc29ydGVkX2NvbnN0c19ub2Rlcy5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgICBub2RlLmFzc2lnbmVlcy5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgICAgaWYgKCFsb29rdXAuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgbG9va3VwLnNldChuYW1lLCBbXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb29rdXAuZ2V0KG5hbWUpLnB1c2gobm9kZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNvbnN0IGN5Y2xlID0gY2hlY2tfZ3JhcGhfZm9yX2N5Y2xlcyh1bnNvcnRlZF9jb25zdHNfbm9kZXMucmVkdWNlKChhY2MsIG5vZGUpID0+IHtcbiAgICAgICAgbm9kZS5hc3NpZ25lZXMuZm9yRWFjaCh2ID0+IHtcbiAgICAgICAgICAgIG5vZGUuZGVwZW5kZW5jaWVzLmZvckVhY2godyA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFub2RlLmFzc2lnbmVlcy5oYXModykpIHtcbiAgICAgICAgICAgICAgICAgICAgYWNjLnB1c2goW3YsIHddKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgW10pKTtcbiAgICBpZiAoY3ljbGUgJiYgY3ljbGUubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IG5vZGVMaXN0ID0gbG9va3VwLmdldChjeWNsZVswXSk7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBub2RlTGlzdFswXTtcbiAgICAgICAgY29tcG9uZW50LmVycm9yKG5vZGUubm9kZSwgY29tcGlsZXJfZXJyb3JzLmN5Y2xpY2FsX2NvbnN0X3RhZ3MoY3ljbGUpKTtcbiAgICB9XG4gICAgY29uc3QgYWRkX25vZGUgPSAobm9kZSkgPT4ge1xuICAgICAgICBpZiAoc29ydGVkX2NvbnN0c19ub2Rlcy5pbmNsdWRlcyhub2RlKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbm9kZS5kZXBlbmRlbmNpZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgIGlmIChub2RlLmFzc2lnbmVlcy5oYXMobmFtZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY29uc3QgZWFybGllcl9ub2RlcyA9IGxvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICBpZiAoZWFybGllcl9ub2Rlcykge1xuICAgICAgICAgICAgICAgIGVhcmxpZXJfbm9kZXMuZm9yRWFjaChhZGRfbm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBzb3J0ZWRfY29uc3RzX25vZGVzLnB1c2gobm9kZSk7XG4gICAgfTtcbiAgICB1bnNvcnRlZF9jb25zdHNfbm9kZXMuZm9yRWFjaChhZGRfbm9kZSk7XG4gICAgcmV0dXJuIHNvcnRlZF9jb25zdHNfbm9kZXMubWFwKG5vZGUgPT4gbm9kZS5ub2RlKTtcbn1cblxuY2xhc3MgVGhlbkJsb2NrIGV4dGVuZHMgQWJzdHJhY3RCbG9jayB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBwYXJlbnQsIHNjb3BlLCBpbmZvKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgcGFyZW50LCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMuc2NvcGUgPSBzY29wZS5jaGlsZCgpO1xuICAgICAgICBpZiAocGFyZW50LnRoZW5fbm9kZSkge1xuICAgICAgICAgICAgcGFyZW50LnRoZW5fY29udGV4dHMuZm9yRWFjaChjb250ZXh0ID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLmFkZChjb250ZXh0LmtleS5uYW1lLCBwYXJlbnQuZXhwcmVzc2lvbi5kZXBlbmRlbmNpZXMsIHRoaXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgKFt0aGlzLmNvbnN0X3RhZ3MsIHRoaXMuY2hpbGRyZW5dID0gZ2V0X2NvbnN0X3RhZ3MoaW5mby5jaGlsZHJlbiwgY29tcG9uZW50LCB0aGlzLCBwYXJlbnQpKTtcbiAgICAgICAgaWYgKCFpbmZvLnNraXApIHtcbiAgICAgICAgICAgIHRoaXMud2Fybl9pZl9lbXB0eV9ibG9jaygpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhZGRfY29uc3RfdGFncyhibG9jaywgY29uc3RfdGFncywgY3R4KSB7XG4gICAgY29uc3QgY29uc3RfdGFnc19wcm9wcyA9IFtdO1xuICAgIGNvbnN0X3RhZ3MuZm9yRWFjaCgoY29uc3RfdGFnLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBgI2NvbnN0YW50c18ke2l9YDtcbiAgICAgICAgY29uc3RfdGFnc19wcm9wcy5wdXNoKGIgYGNvbnN0ICR7bmFtZX0gPSAke2NvbnN0X3RhZy5leHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2ssIGN0eCl9YCk7XG4gICAgICAgIGNvbnN0X3RhZy5jb250ZXh0cy5mb3JFYWNoKGNvbnRleHQgPT4ge1xuICAgICAgICAgICAgY29uc3RfdGFnc19wcm9wcy5wdXNoKGIgYCR7Y3R4fVske2Jsb2NrLnJlbmRlcmVyLmNvbnRleHRfbG9va3VwLmdldChjb250ZXh0LmtleS5uYW1lKS5pbmRleH1dID0gJHtjb250ZXh0LmRlZmF1bHRfbW9kaWZpZXIoY29udGV4dC5tb2RpZmllcih7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZSB9KSwgbmFtZSA9PiBibG9jay5yZW5kZXJlci5jb250ZXh0X2xvb2t1cC5oYXMobmFtZSkgPyB4IGAke2N0eH1bJHtibG9jay5yZW5kZXJlci5jb250ZXh0X2xvb2t1cC5nZXQobmFtZSkuaW5kZXh9XWAgOiB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZSB9KX07YCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBjb25zdF90YWdzX3Byb3BzO1xufVxuZnVuY3Rpb24gYWRkX2NvbnN0X3RhZ3NfY29udGV4dChyZW5kZXJlciwgY29uc3RfdGFncykge1xuICAgIGNvbnN0X3RhZ3MuZm9yRWFjaChjb25zdF90YWcgPT4ge1xuICAgICAgICBjb25zdF90YWcuY29udGV4dHMuZm9yRWFjaChjb250ZXh0ID0+IHtcbiAgICAgICAgICAgIHJlbmRlcmVyLmFkZF90b19jb250ZXh0KGNvbnRleHQua2V5Lm5hbWUsIHRydWUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuY2xhc3MgQXdhaXRCbG9ja0JyYW5jaCBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHN0YXR1cywgcmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUsIHN0cmlwX3doaXRlc3BhY2UsIG5leHRfc2libGluZykge1xuICAgICAgICBzdXBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSk7XG4gICAgICAgIHRoaXMudmFyID0gbnVsbDtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgIHRoaXMuYmxvY2sgPSBibG9jay5jaGlsZCh7XG4gICAgICAgICAgICBjb21tZW50OiBjcmVhdGVfZGVidWdnaW5nX2NvbW1lbnQobm9kZSwgdGhpcy5yZW5kZXJlci5jb21wb25lbnQpLFxuICAgICAgICAgICAgbmFtZTogdGhpcy5yZW5kZXJlci5jb21wb25lbnQuZ2V0X3VuaXF1ZV9uYW1lKGBjcmVhdGVfJHtzdGF0dXN9X2Jsb2NrYCksXG4gICAgICAgICAgICB0eXBlOiBzdGF0dXNcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWRkX2NvbnRleHQocGFyZW50Lm5vZGVbc3RhdHVzICsgJ19ub2RlJ10sIHBhcmVudC5ub2RlW3N0YXR1cyArICdfY29udGV4dHMnXSk7XG4gICAgICAgIHRoaXMuZnJhZ21lbnQgPSBuZXcgRnJhZ21lbnRXcmFwcGVyKHJlbmRlcmVyLCB0aGlzLmJsb2NrLCB0aGlzLm5vZGUuY2hpbGRyZW4sIHBhcmVudCwgc3RyaXBfd2hpdGVzcGFjZSwgbmV4dF9zaWJsaW5nKTtcbiAgICAgICAgdGhpcy5pc19keW5hbWljID0gdGhpcy5ibG9jay5kZXBlbmRlbmNpZXMuc2l6ZSA+IDA7XG4gICAgfVxuICAgIGFkZF9jb250ZXh0KG5vZGUsIGNvbnRleHRzKSB7XG4gICAgICAgIGlmICghbm9kZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0lkZW50aWZpZXInKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gbm9kZS5uYW1lO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRfdG9fY29udGV4dCh0aGlzLnZhbHVlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRleHRzLmZvckVhY2goY29udGV4dCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRfdG9fY29udGV4dChjb250ZXh0LmtleS5uYW1lLCB0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuYmxvY2sucGFyZW50LmdldF91bmlxdWVfbmFtZSgndmFsdWUnKS5uYW1lO1xuICAgICAgICAgICAgdGhpcy52YWx1ZV9jb250ZXh0cyA9IGNvbnRleHRzO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRfdG9fY29udGV4dCh0aGlzLnZhbHVlLCB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuaXNfZGVzdHJ1Y3R1cmVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZhbHVlX2luZGV4ID0gdGhpcy5yZW5kZXJlci5jb250ZXh0X2xvb2t1cC5nZXQodGhpcy52YWx1ZSkuaW5kZXg7XG4gICAgICAgIGlmICh0aGlzLmhhc19jb25zdHModGhpcy5ub2RlKSkge1xuICAgICAgICAgICAgYWRkX2NvbnN0X3RhZ3NfY29udGV4dCh0aGlzLnJlbmRlcmVyLCB0aGlzLm5vZGUuY29uc3RfdGFncyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFzX2NvbnN0cyhub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlIGluc3RhbmNlb2YgVGhlbkJsb2NrIHx8IG5vZGUgaW5zdGFuY2VvZiBDYXRjaEJsb2NrO1xuICAgIH1cbiAgICByZW5kZXIoYmxvY2ssIHBhcmVudF9ub2RlLCBwYXJlbnRfbm9kZXMpIHtcbiAgICAgICAgdGhpcy5mcmFnbWVudC5yZW5kZXIoYmxvY2ssIHBhcmVudF9ub2RlLCBwYXJlbnRfbm9kZXMpO1xuICAgICAgICBpZiAodGhpcy5pc19kZXN0cnVjdHVyZWQgfHwgKHRoaXMuaGFzX2NvbnN0cyh0aGlzLm5vZGUpICYmIHRoaXMubm9kZS5jb25zdF90YWdzLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcl9nZXRfY29udGV4dCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcl9nZXRfY29udGV4dCgpIHtcbiAgICAgICAgY29uc3QgcHJvcHMgPSB0aGlzLmlzX2Rlc3RydWN0dXJlZCA/IHRoaXMudmFsdWVfY29udGV4dHMubWFwKHByb3AgPT4gYiBgI2N0eFske3RoaXMuYmxvY2sucmVuZGVyZXIuY29udGV4dF9sb29rdXAuZ2V0KHByb3Aua2V5Lm5hbWUpLmluZGV4fV0gPSAke3Byb3AuZGVmYXVsdF9tb2RpZmllcihwcm9wLm1vZGlmaWVyKHggYCNjdHhbJHt0aGlzLnZhbHVlX2luZGV4fV1gKSwgbmFtZSA9PiB0aGlzLnJlbmRlcmVyLnJlZmVyZW5jZShuYW1lKSl9O2ApIDogbnVsbDtcbiAgICAgICAgY29uc3QgY29uc3RfdGFnc19wcm9wcyA9IHRoaXMuaGFzX2NvbnN0cyh0aGlzLm5vZGUpID8gYWRkX2NvbnN0X3RhZ3ModGhpcy5ibG9jaywgdGhpcy5ub2RlLmNvbnN0X3RhZ3MsICcjY3R4JykgOiBudWxsO1xuICAgICAgICBjb25zdCBnZXRfY29udGV4dCA9IHRoaXMuYmxvY2sucmVuZGVyZXIuY29tcG9uZW50LmdldF91bmlxdWVfbmFtZShgZ2V0XyR7dGhpcy5zdGF0dXN9X2NvbnRleHRgKTtcbiAgICAgICAgdGhpcy5ibG9jay5yZW5kZXJlci5ibG9ja3MucHVzaChiIGBcblx0XHRcdGZ1bmN0aW9uICR7Z2V0X2NvbnRleHR9KCNjdHgpIHtcblx0XHRcdFx0JHtwcm9wc31cblx0XHRcdFx0JHtjb25zdF90YWdzX3Byb3BzfVxuXHRcdFx0fVxuXHRcdGApO1xuICAgICAgICB0aGlzLmJsb2NrLmNodW5rcy5kZWNsYXJhdGlvbnMucHVzaChiIGAke2dldF9jb250ZXh0fSgjY3R4KWApO1xuICAgICAgICBpZiAodGhpcy5ibG9jay5oYXNfdXBkYXRlX21ldGhvZCkge1xuICAgICAgICAgICAgdGhpcy5ibG9jay5jaHVua3MudXBkYXRlLnVuc2hpZnQoYiBgJHtnZXRfY29udGV4dH0oI2N0eClgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmNsYXNzIEF3YWl0QmxvY2tXcmFwcGVyIGV4dGVuZHMgV3JhcHBlciB7XG4gICAgY29uc3RydWN0b3IocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUsIHN0cmlwX3doaXRlc3BhY2UsIG5leHRfc2libGluZykge1xuICAgICAgICBzdXBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSk7XG4gICAgICAgIHRoaXMudmFyID0geyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6ICdhd2FpdF9ibG9jaycgfTtcbiAgICAgICAgdGhpcy5jYW5ub3RfdXNlX2lubmVyaHRtbCgpO1xuICAgICAgICB0aGlzLm5vdF9zdGF0aWNfY29udGVudCgpO1xuICAgICAgICBibG9jay5hZGRfZGVwZW5kZW5jaWVzKHRoaXMubm9kZS5leHByZXNzaW9uLmRlcGVuZGVuY2llcyk7XG4gICAgICAgIGxldCBpc19keW5hbWljID0gZmFsc2U7XG4gICAgICAgIGxldCBoYXNfaW50cm9zID0gZmFsc2U7XG4gICAgICAgIGxldCBoYXNfb3V0cm9zID0gZmFsc2U7XG4gICAgICAgIFsncGVuZGluZycsICd0aGVuJywgJ2NhdGNoJ10uZm9yRWFjaCgoc3RhdHVzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMubm9kZVtzdGF0dXNdO1xuICAgICAgICAgICAgY29uc3QgYnJhbmNoID0gbmV3IEF3YWl0QmxvY2tCcmFuY2goc3RhdHVzLCByZW5kZXJlciwgYmxvY2ssIHRoaXMsIGNoaWxkLCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpO1xuICAgICAgICAgICAgcmVuZGVyZXIuYmxvY2tzLnB1c2goYnJhbmNoLmJsb2NrKTtcbiAgICAgICAgICAgIGlmIChicmFuY2guaXNfZHluYW1pYykge1xuICAgICAgICAgICAgICAgIGlzX2R5bmFtaWMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gc2hvdWxkIGJsb2NrcyB1cGRhdGUgdGhlaXIgb3duIHBhcmVudHM/XG4gICAgICAgICAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyhicmFuY2guYmxvY2suZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChicmFuY2guYmxvY2suaGFzX2ludHJvcylcbiAgICAgICAgICAgICAgICBoYXNfaW50cm9zID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChicmFuY2guYmxvY2suaGFzX291dHJvcylcbiAgICAgICAgICAgICAgICBoYXNfb3V0cm9zID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXNbc3RhdHVzXSA9IGJyYW5jaDtcbiAgICAgICAgfSk7XG4gICAgICAgIFsncGVuZGluZycsICd0aGVuJywgJ2NhdGNoJ10uZm9yRWFjaChzdGF0dXMgPT4ge1xuICAgICAgICAgICAgdGhpc1tzdGF0dXNdLmJsb2NrLmhhc191cGRhdGVfbWV0aG9kID0gaXNfZHluYW1pYztcbiAgICAgICAgICAgIHRoaXNbc3RhdHVzXS5ibG9jay5oYXNfaW50cm9fbWV0aG9kID0gaGFzX2ludHJvcztcbiAgICAgICAgICAgIHRoaXNbc3RhdHVzXS5ibG9jay5oYXNfb3V0cm9fbWV0aG9kID0gaGFzX291dHJvcztcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChoYXNfb3V0cm9zKSB7XG4gICAgICAgICAgICBibG9jay5hZGRfb3V0cm8oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoYmxvY2ssIHBhcmVudF9ub2RlLCBwYXJlbnRfbm9kZXMpIHtcbiAgICAgICAgY29uc3QgYW5jaG9yID0gdGhpcy5nZXRfb3JfY3JlYXRlX2FuY2hvcihibG9jaywgcGFyZW50X25vZGUsIHBhcmVudF9ub2Rlcyk7XG4gICAgICAgIGNvbnN0IHVwZGF0ZV9tb3VudF9ub2RlID0gdGhpcy5nZXRfdXBkYXRlX21vdW50X25vZGUoYW5jaG9yKTtcbiAgICAgICAgY29uc3Qgc25pcHBldCA9IHRoaXMubm9kZS5leHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICBjb25zdCBpbmZvID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdpbmZvJyk7XG4gICAgICAgIGNvbnN0IHByb21pc2UgPSBibG9jay5nZXRfdW5pcXVlX25hbWUoJ3Byb21pc2UnKTtcbiAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKHByb21pc2UpO1xuICAgICAgICBibG9jay5tYWludGFpbl9jb250ZXh0ID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgaW5mb19wcm9wcyA9IHggYHtcblx0XHRcdGN0eDogI2N0eCxcblx0XHRcdGN1cnJlbnQ6IG51bGwsXG5cdFx0XHR0b2tlbjogbnVsbCxcblx0XHRcdGhhc0NhdGNoOiAke3RoaXMuY2F0Y2gubm9kZS5zdGFydCAhPT0gbnVsbCA/ICd0cnVlJyA6ICdmYWxzZSd9LFxuXHRcdFx0cGVuZGluZzogJHt0aGlzLnBlbmRpbmcuYmxvY2submFtZX0sXG5cdFx0XHR0aGVuOiAke3RoaXMudGhlbi5ibG9jay5uYW1lfSxcblx0XHRcdGNhdGNoOiAke3RoaXMuY2F0Y2guYmxvY2submFtZX0sXG5cdFx0XHR2YWx1ZTogJHt0aGlzLnRoZW4udmFsdWVfaW5kZXh9LFxuXHRcdFx0ZXJyb3I6ICR7dGhpcy5jYXRjaC52YWx1ZV9pbmRleH0sXG5cdFx0XHRibG9ja3M6ICR7dGhpcy5wZW5kaW5nLmJsb2NrLmhhc19vdXRyb19tZXRob2QgJiYgeCBgWywsLF1gfVxuXHRcdH1gO1xuICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0bGV0ICR7aW5mb30gPSAke2luZm9fcHJvcHN9O1xuXHRcdGApO1xuICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0QGhhbmRsZV9wcm9taXNlKCR7cHJvbWlzZX0gPSAke3NuaXBwZXR9LCAke2luZm99KTtcblx0XHRgKTtcbiAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYFxuXHRcdFx0JHtpbmZvfS5ibG9jay5jKCk7XG5cdFx0YCk7XG4gICAgICAgIGlmIChwYXJlbnRfbm9kZXMgJiYgdGhpcy5yZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUpIHtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5jbGFpbS5wdXNoKGIgYFxuXHRcdFx0XHQke2luZm99LmJsb2NrLmwoJHtwYXJlbnRfbm9kZXN9KTtcblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGluaXRpYWxfbW91bnRfbm9kZSA9IHBhcmVudF9ub2RlIHx8ICcjdGFyZ2V0JztcbiAgICAgICAgY29uc3QgYW5jaG9yX25vZGUgPSBwYXJlbnRfbm9kZSA/ICdudWxsJyA6ICcjYW5jaG9yJztcbiAgICAgICAgY29uc3QgaGFzX3RyYW5zaXRpb25zID0gdGhpcy5wZW5kaW5nLmJsb2NrLmhhc19pbnRyb19tZXRob2QgfHwgdGhpcy5wZW5kaW5nLmJsb2NrLmhhc19vdXRyb19tZXRob2Q7XG4gICAgICAgIGJsb2NrLmNodW5rcy5tb3VudC5wdXNoKGIgYFxuXHRcdFx0JHtpbmZvfS5ibG9jay5tKCR7aW5pdGlhbF9tb3VudF9ub2RlfSwgJHtpbmZvfS5hbmNob3IgPSAke2FuY2hvcl9ub2RlfSk7XG5cdFx0XHQke2luZm99Lm1vdW50ID0gKCkgPT4gJHt1cGRhdGVfbW91bnRfbm9kZX07XG5cdFx0XHQke2luZm99LmFuY2hvciA9ICR7YW5jaG9yfTtcblx0XHRgKTtcbiAgICAgICAgaWYgKGhhc190cmFuc2l0aW9ucykge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmludHJvLnB1c2goYiBgQHRyYW5zaXRpb25faW4oJHtpbmZvfS5ibG9jayk7YCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gdGhpcy5ub2RlLmV4cHJlc3Npb24uZHluYW1pY19kZXBlbmRlbmNpZXMoKTtcbiAgICAgICAgY29uc3QgdXBkYXRlX2F3YWl0X2Jsb2NrX2JyYW5jaCA9IGIgYEB1cGRhdGVfYXdhaXRfYmxvY2tfYnJhbmNoKCR7aW5mb30sICNjdHgsICNkaXJ0eSlgO1xuICAgICAgICBpZiAoZGVwZW5kZW5jaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IHggYFxuXHRcdFx0XHQke2Jsb2NrLnJlbmRlcmVyLmRpcnR5KGRlcGVuZGVuY2llcyl9ICYmXG5cdFx0XHRcdCR7cHJvbWlzZX0gIT09ICgke3Byb21pc2V9ID0gJHtzbmlwcGV0fSkgJiZcblx0XHRcdFx0QGhhbmRsZV9wcm9taXNlKCR7cHJvbWlzZX0sICR7aW5mb30pYDtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGAke2luZm99LmN0eCA9ICNjdHg7YCk7XG4gICAgICAgICAgICBpZiAodGhpcy5wZW5kaW5nLmJsb2NrLmhhc191cGRhdGVfbWV0aG9kKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICgke2NvbmRpdGlvbn0pIHtcblxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQke3VwZGF0ZV9hd2FpdF9ibG9ja19icmFuY2h9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0XHQke2NvbmRpdGlvbn1cblx0XHRcdFx0YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wZW5kaW5nLmJsb2NrLmhhc191cGRhdGVfbWV0aG9kKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRcdCR7dXBkYXRlX2F3YWl0X2Jsb2NrX2JyYW5jaH1cblx0XHRcdFx0YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucGVuZGluZy5ibG9jay5oYXNfb3V0cm9fbWV0aG9kKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3Mub3V0cm8ucHVzaChiIGBcblx0XHRcdFx0Zm9yIChsZXQgI2kgPSAwOyAjaSA8IDM7ICNpICs9IDEpIHtcblx0XHRcdFx0XHRjb25zdCBibG9jayA9ICR7aW5mb30uYmxvY2tzWyNpXTtcblx0XHRcdFx0XHRAdHJhbnNpdGlvbl9vdXQoYmxvY2spO1xuXHRcdFx0XHR9XG5cdFx0XHRgKTtcbiAgICAgICAgfVxuICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYFxuXHRcdFx0JHtpbmZvfS5ibG9jay5kKCR7cGFyZW50X25vZGUgPyBudWxsIDogJ2RldGFjaGluZyd9KTtcblx0XHRcdCR7aW5mb30udG9rZW4gPSBudWxsO1xuXHRcdFx0JHtpbmZvfSA9IG51bGw7XG5cdFx0YCk7XG4gICAgICAgIFt0aGlzLnBlbmRpbmcsIHRoaXMudGhlbiwgdGhpcy5jYXRjaF0uZm9yRWFjaChicmFuY2ggPT4ge1xuICAgICAgICAgICAgYnJhbmNoLnJlbmRlcihicmFuY2guYmxvY2ssIG51bGwsIHggYCNub2Rlc2ApO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmNvbnN0IFRSVUUgPSB4IGB0cnVlYDtcbmNvbnN0IEZBTFNFID0geCBgZmFsc2VgO1xuY2xhc3MgRXZlbnRIYW5kbGVyV3JhcHBlciB7XG4gICAgY29uc3RydWN0b3Iobm9kZSwgcGFyZW50KSB7XG4gICAgICAgIHRoaXMubm9kZSA9IG5vZGU7XG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgICAgICBpZiAoIW5vZGUuZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnQucmVuZGVyZXIuYWRkX3RvX2NvbnRleHQobm9kZS5oYW5kbGVyX25hbWUubmFtZSk7XG4gICAgICAgICAgICB0aGlzLnBhcmVudC5yZW5kZXJlci5jb21wb25lbnQucGFydGx5X2hvaXN0ZWQucHVzaChiIGBcblx0XHRcdFx0ZnVuY3Rpb24gJHtub2RlLmhhbmRsZXJfbmFtZS5uYW1lfShldmVudCkge1xuXHRcdFx0XHRcdEBidWJibGUuY2FsbCh0aGlzLCAkJHNlbGYsIGV2ZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0X3NuaXBwZXQoYmxvY2spIHtcbiAgICAgICAgY29uc3Qgc25pcHBldCA9IHRoaXMubm9kZS5leHByZXNzaW9uID8gdGhpcy5ub2RlLmV4cHJlc3Npb24ubWFuaXB1bGF0ZShibG9jaykgOiBibG9jay5yZW5kZXJlci5yZWZlcmVuY2UodGhpcy5ub2RlLmhhbmRsZXJfbmFtZSk7XG4gICAgICAgIGlmICh0aGlzLm5vZGUucmVhc3NpZ25lZCkge1xuICAgICAgICAgICAgYmxvY2subWFpbnRhaW5fY29udGV4dCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4geCBgZnVuY3Rpb24gKCkgeyBpZiAoQGlzX2Z1bmN0aW9uKCR7c25pcHBldH0pKSAke3NuaXBwZXR9LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzbmlwcGV0O1xuICAgIH1cbiAgICByZW5kZXIoYmxvY2ssIHRhcmdldCkge1xuICAgICAgICBsZXQgc25pcHBldCA9IHRoaXMuZ2V0X3NuaXBwZXQoYmxvY2spO1xuICAgICAgICBpZiAodGhpcy5ub2RlLm1vZGlmaWVycy5oYXMoJ3ByZXZlbnREZWZhdWx0JykpXG4gICAgICAgICAgICBzbmlwcGV0ID0geCBgQHByZXZlbnRfZGVmYXVsdCgke3NuaXBwZXR9KWA7XG4gICAgICAgIGlmICh0aGlzLm5vZGUubW9kaWZpZXJzLmhhcygnc3RvcFByb3BhZ2F0aW9uJykpXG4gICAgICAgICAgICBzbmlwcGV0ID0geCBgQHN0b3BfcHJvcGFnYXRpb24oJHtzbmlwcGV0fSlgO1xuICAgICAgICBpZiAodGhpcy5ub2RlLm1vZGlmaWVycy5oYXMoJ3NlbGYnKSlcbiAgICAgICAgICAgIHNuaXBwZXQgPSB4IGBAc2VsZigke3NuaXBwZXR9KWA7XG4gICAgICAgIGlmICh0aGlzLm5vZGUubW9kaWZpZXJzLmhhcygndHJ1c3RlZCcpKVxuICAgICAgICAgICAgc25pcHBldCA9IHggYEB0cnVzdGVkKCR7c25pcHBldH0pYDtcbiAgICAgICAgY29uc3QgYXJncyA9IFtdO1xuICAgICAgICBjb25zdCBvcHRzID0gWydub25wYXNzaXZlJywgJ3Bhc3NpdmUnLCAnb25jZScsICdjYXB0dXJlJ10uZmlsdGVyKG1vZCA9PiB0aGlzLm5vZGUubW9kaWZpZXJzLmhhcyhtb2QpKTtcbiAgICAgICAgaWYgKG9wdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAob3B0cy5sZW5ndGggPT09IDEgJiYgb3B0c1swXSA9PT0gJ2NhcHR1cmUnKSB7XG4gICAgICAgICAgICAgICAgYXJncy5wdXNoKFRSVUUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYXJncy5wdXNoKHggYHsgJHtvcHRzLm1hcChvcHQgPT4gb3B0ID09PSAnbm9ucGFzc2l2ZSdcbiAgICAgICAgICAgICAgICAgICAgPyBwIGBwYXNzaXZlOiBmYWxzZWBcbiAgICAgICAgICAgICAgICAgICAgOiBwIGAke29wdH06IHRydWVgKX0gfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGJsb2NrLnJlbmRlcmVyLm9wdGlvbnMuZGV2KSB7XG4gICAgICAgICAgICBhcmdzLnB1c2goRkFMU0UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChibG9jay5yZW5kZXJlci5vcHRpb25zLmRldikge1xuICAgICAgICAgICAgYXJncy5wdXNoKHRoaXMubm9kZS5tb2RpZmllcnMuaGFzKCdwcmV2ZW50RGVmYXVsdCcpID8gVFJVRSA6IEZBTFNFKTtcbiAgICAgICAgICAgIGFyZ3MucHVzaCh0aGlzLm5vZGUubW9kaWZpZXJzLmhhcygnc3RvcFByb3BhZ2F0aW9uJykgPyBUUlVFIDogRkFMU0UpO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmV2ZW50X2xpc3RlbmVycy5wdXNoKHggYEBsaXN0ZW4oJHt0YXJnZXR9LCBcIiR7dGhpcy5ub2RlLm5hbWV9XCIsICR7c25pcHBldH0sICR7YXJnc30pYCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhZGRfZXZlbnRfaGFuZGxlcnMoYmxvY2ssIHRhcmdldCwgaGFuZGxlcnMpIHtcbiAgICBoYW5kbGVycy5mb3JFYWNoKGhhbmRsZXIgPT4gYWRkX2V2ZW50X2hhbmRsZXIoYmxvY2ssIHRhcmdldCwgaGFuZGxlcikpO1xufVxuZnVuY3Rpb24gYWRkX2V2ZW50X2hhbmRsZXIoYmxvY2ssIHRhcmdldCwgaGFuZGxlcikge1xuICAgIGhhbmRsZXIucmVuZGVyKGJsb2NrLCB0YXJnZXQpO1xufVxuXG5mdW5jdGlvbiBhZGRfYWN0aW9ucyhibG9jaywgdGFyZ2V0LCBhY3Rpb25zKSB7XG4gICAgYWN0aW9ucy5mb3JFYWNoKGFjdGlvbiA9PiBhZGRfYWN0aW9uKGJsb2NrLCB0YXJnZXQsIGFjdGlvbikpO1xufVxuZnVuY3Rpb24gYWRkX2FjdGlvbihibG9jaywgdGFyZ2V0LCBhY3Rpb24pIHtcbiAgICBjb25zdCB7IGV4cHJlc3Npb24sIHRlbXBsYXRlX3Njb3BlIH0gPSBhY3Rpb247XG4gICAgbGV0IHNuaXBwZXQ7XG4gICAgbGV0IGRlcGVuZGVuY2llcztcbiAgICBpZiAoZXhwcmVzc2lvbikge1xuICAgICAgICBzbmlwcGV0ID0gZXhwcmVzc2lvbi5tYW5pcHVsYXRlKGJsb2NrKTtcbiAgICAgICAgZGVwZW5kZW5jaWVzID0gZXhwcmVzc2lvbi5keW5hbWljX2RlcGVuZGVuY2llcygpO1xuICAgIH1cbiAgICBjb25zdCBpZCA9IGJsb2NrLmdldF91bmlxdWVfbmFtZShgJHthY3Rpb24ubmFtZS5yZXBsYWNlKC9bXmEtekEtWjAtOV8kXS9nLCAnXycpfV9hY3Rpb25gKTtcbiAgICBibG9jay5hZGRfdmFyaWFibGUoaWQpO1xuICAgIGNvbnN0IFtvYmosIC4uLnByb3BlcnRpZXNdID0gYWN0aW9uLm5hbWUuc3BsaXQoJy4nKTtcbiAgICBjb25zdCBmbiA9IGlzX2NvbnRleHR1YWwoYWN0aW9uLmNvbXBvbmVudCwgdGVtcGxhdGVfc2NvcGUsIG9iailcbiAgICAgICAgPyBibG9jay5yZW5kZXJlci5yZWZlcmVuY2Uob2JqKVxuICAgICAgICA6IG9iajtcbiAgICBpZiAocHJvcGVydGllcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgbWVtYmVyX2V4cHJlc3Npb24gPSBwcm9wZXJ0aWVzLnJlZHVjZSgobGhzLCByaHMpID0+IHggYCR7bGhzfS4ke3Joc31gLCBmbik7XG4gICAgICAgIGJsb2NrLmV2ZW50X2xpc3RlbmVycy5wdXNoKHggYEBhY3Rpb25fZGVzdHJveWVyKCR7aWR9ID0gJHttZW1iZXJfZXhwcmVzc2lvbn0oJHt0YXJnZXR9LCAke3NuaXBwZXR9KSlgKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGJsb2NrLmV2ZW50X2xpc3RlbmVycy5wdXNoKHggYEBhY3Rpb25fZGVzdHJveWVyKCR7aWR9ID0gJHtmbn0uY2FsbChudWxsLCAke3RhcmdldH0sICR7c25pcHBldH0pKWApO1xuICAgIH1cbiAgICBpZiAoZGVwZW5kZW5jaWVzICYmIGRlcGVuZGVuY2llcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBjb25kaXRpb24gPSB4IGAke2lkfSAmJiBAaXNfZnVuY3Rpb24oJHtpZH0udXBkYXRlKWA7XG4gICAgICAgIGlmIChkZXBlbmRlbmNpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uZGl0aW9uID0geCBgJHtjb25kaXRpb259ICYmICR7YmxvY2sucmVuZGVyZXIuZGlydHkoZGVwZW5kZW5jaWVzKX1gO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBpZiAoJHtjb25kaXRpb259KSAke2lkfS51cGRhdGUuY2FsbChudWxsLCAke3NuaXBwZXR9KTtgKTtcbiAgICB9XG59XG5cbmNsYXNzIEJvZHlXcmFwcGVyIGV4dGVuZHMgV3JhcHBlciB7XG4gICAgY29uc3RydWN0b3IocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpIHtcbiAgICAgICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpO1xuICAgICAgICB0aGlzLmhhbmRsZXJzID0gdGhpcy5ub2RlLmhhbmRsZXJzLm1hcChoYW5kbGVyID0+IG5ldyBFdmVudEhhbmRsZXJXcmFwcGVyKGhhbmRsZXIsIHRoaXMpKTtcbiAgICB9XG4gICAgcmVuZGVyKGJsb2NrLCBfcGFyZW50X25vZGUsIF9wYXJlbnRfbm9kZXMpIHtcbiAgICAgICAgYWRkX2V2ZW50X2hhbmRsZXJzKGJsb2NrLCB4IGBAX2RvY3VtZW50LmJvZHlgLCB0aGlzLmhhbmRsZXJzKTtcbiAgICAgICAgYWRkX2FjdGlvbnMoYmxvY2ssIHggYEBfZG9jdW1lbnQuYm9keWAsIHRoaXMubm9kZS5hY3Rpb25zKTtcbiAgICB9XG59XG5cbmNsYXNzIERlYnVnVGFnV3JhcHBlciBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlLCBfc3RyaXBfd2hpdGVzcGFjZSwgX25leHRfc2libGluZykge1xuICAgICAgICBzdXBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSk7XG4gICAgfVxuICAgIHJlbmRlcihibG9jaywgX3BhcmVudF9ub2RlLCBfcGFyZW50X25vZGVzKSB7XG4gICAgICAgIGNvbnN0IHsgcmVuZGVyZXIgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgY29tcG9uZW50IH0gPSByZW5kZXJlcjtcbiAgICAgICAgaWYgKCFyZW5kZXJlci5vcHRpb25zLmRldilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgeyB2YXJfbG9va3VwIH0gPSBjb21wb25lbnQ7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gY29tcG9uZW50LmxvY2F0ZSh0aGlzLm5vZGUuc3RhcnQgKyAxKTtcbiAgICAgICAgY29uc3QgZW5kID0geyBsaW5lOiBzdGFydC5saW5lLCBjb2x1bW46IHN0YXJ0LmNvbHVtbiArIDYgfTtcbiAgICAgICAgY29uc3QgbG9jID0geyBzdGFydCwgZW5kIH07XG4gICAgICAgIGNvbnN0IGRlYnVnID0ge1xuICAgICAgICAgICAgdHlwZTogJ0RlYnVnZ2VyU3RhdGVtZW50JyxcbiAgICAgICAgICAgIGxvY1xuICAgICAgICB9O1xuICAgICAgICBpZiAodGhpcy5ub2RlLmV4cHJlc3Npb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgLy8gRGVidWcgYWxsXG4gICAgICAgICAgICBibG9jay5jaHVua3MuY3JlYXRlLnB1c2goZGVidWcpO1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGRlYnVnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGxvZyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICAgICAgbmFtZTogJ2xvZycsXG4gICAgICAgICAgICAgICAgbG9jXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgdGhpcy5ub2RlLmV4cHJlc3Npb25zLmZvckVhY2goZXhwcmVzc2lvbiA9PiB7XG4gICAgICAgICAgICAgICAgYWRkX3RvX3NldChkZXBlbmRlbmNpZXMsIGV4cHJlc3Npb24uZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgY29udGV4dHVhbF9pZGVudGlmaWVycyA9IHRoaXMubm9kZS5leHByZXNzaW9uc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFyaWFibGUgPSB2YXJfbG9va3VwLmdldChlLm5vZGUubmFtZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEodmFyaWFibGUgJiYgdmFyaWFibGUuaG9pc3RhYmxlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm1hcChlID0+IGUubm9kZS5uYW1lKTtcbiAgICAgICAgICAgIGNvbnN0IGxvZ2dlZF9pZGVudGlmaWVycyA9IHRoaXMubm9kZS5leHByZXNzaW9ucy5tYXAoZSA9PiBwIGAke2Uubm9kZS5uYW1lfWApO1xuICAgICAgICAgICAgY29uc3QgZGVidWdfc3RhdGVtZW50cyA9IGIgYFxuXHRcdFx0XHQke2NvbnRleHR1YWxfaWRlbnRpZmllcnMubWFwKG5hbWUgPT4gYiBgY29uc3QgJHtuYW1lfSA9ICR7cmVuZGVyZXIucmVmZXJlbmNlKG5hbWUpfTtgKX1cblx0XHRcdFx0QF9jb25zb2xlLiR7bG9nfSh7ICR7bG9nZ2VkX2lkZW50aWZpZXJzfSB9KTtcblx0XHRcdFx0ZGVidWdnZXI7YDtcbiAgICAgICAgICAgIGlmIChkZXBlbmRlbmNpZXMuc2l6ZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IHJlbmRlcmVyLmRpcnR5KEFycmF5LmZyb20oZGVwZW5kZW5jaWVzKSk7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICgke2NvbmRpdGlvbn0pIHtcblx0XHRcdFx0XHRcdCR7ZGVidWdfc3RhdGVtZW50c31cblx0XHRcdFx0XHR9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYHtcblx0XHRcdFx0JHtkZWJ1Z19zdGF0ZW1lbnRzfVxuXHRcdFx0fWApO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5jbGFzcyBFbHNlQmxvY2tXcmFwcGVyIGV4dGVuZHMgV3JhcHBlciB7XG4gICAgY29uc3RydWN0b3IocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUsIHN0cmlwX3doaXRlc3BhY2UsIG5leHRfc2libGluZykge1xuICAgICAgICBzdXBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSk7XG4gICAgICAgIHRoaXMudmFyID0gbnVsbDtcbiAgICAgICAgdGhpcy5ibG9jayA9IGJsb2NrLmNoaWxkKHtcbiAgICAgICAgICAgIGNvbW1lbnQ6IGNyZWF0ZV9kZWJ1Z2dpbmdfY29tbWVudChub2RlLCB0aGlzLnJlbmRlcmVyLmNvbXBvbmVudCksXG4gICAgICAgICAgICBuYW1lOiB0aGlzLnJlbmRlcmVyLmNvbXBvbmVudC5nZXRfdW5pcXVlX25hbWUoJ2NyZWF0ZV9lbHNlX2Jsb2NrJyksXG4gICAgICAgICAgICB0eXBlOiAnZWxzZSdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZnJhZ21lbnQgPSBuZXcgRnJhZ21lbnRXcmFwcGVyKHJlbmRlcmVyLCB0aGlzLmJsb2NrLCB0aGlzLm5vZGUuY2hpbGRyZW4sIHBhcmVudCwgc3RyaXBfd2hpdGVzcGFjZSwgbmV4dF9zaWJsaW5nKTtcbiAgICAgICAgdGhpcy5pc19keW5hbWljID0gdGhpcy5ibG9jay5kZXBlbmRlbmNpZXMuc2l6ZSA+IDA7XG4gICAgfVxufVxuY2xhc3MgRWFjaEJsb2NrV3JhcHBlciBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlLCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpIHtcbiAgICAgICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpO1xuICAgICAgICB0aGlzLnVwZGF0ZXMgPSBbXTtcbiAgICAgICAgdGhpcy52YXIgPSB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogJ2VhY2gnIH07XG4gICAgICAgIHRoaXMuY2Fubm90X3VzZV9pbm5lcmh0bWwoKTtcbiAgICAgICAgdGhpcy5ub3Rfc3RhdGljX2NvbnRlbnQoKTtcbiAgICAgICAgY29uc3QgeyBkZXBlbmRlbmNpZXMgfSA9IG5vZGUuZXhwcmVzc2lvbjtcbiAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyhkZXBlbmRlbmNpZXMpO1xuICAgICAgICB0aGlzLm5vZGUuY29udGV4dHMuZm9yRWFjaChjb250ZXh0ID0+IHtcbiAgICAgICAgICAgIHJlbmRlcmVyLmFkZF90b19jb250ZXh0KGNvbnRleHQua2V5Lm5hbWUsIHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgYWRkX2NvbnN0X3RhZ3NfY29udGV4dChyZW5kZXJlciwgdGhpcy5ub2RlLmNvbnN0X3RhZ3MpO1xuICAgICAgICB0aGlzLmJsb2NrID0gYmxvY2suY2hpbGQoe1xuICAgICAgICAgICAgY29tbWVudDogY3JlYXRlX2RlYnVnZ2luZ19jb21tZW50KHRoaXMubm9kZSwgdGhpcy5yZW5kZXJlci5jb21wb25lbnQpLFxuICAgICAgICAgICAgbmFtZTogcmVuZGVyZXIuY29tcG9uZW50LmdldF91bmlxdWVfbmFtZSgnY3JlYXRlX2VhY2hfYmxvY2snKSxcbiAgICAgICAgICAgIHR5cGU6ICdlYWNoJyxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgdG9kbzogcHJvYmFibHkgZXJyb3JcbiAgICAgICAgICAgIGtleTogbm9kZS5rZXksXG4gICAgICAgICAgICBiaW5kaW5nczogbmV3IE1hcChibG9jay5iaW5kaW5ncylcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFRPRE8gdGhpcyBzZWVtcyBtZXNzeVxuICAgICAgICB0aGlzLmJsb2NrLmhhc19hbmltYXRpb24gPSB0aGlzLm5vZGUuaGFzX2FuaW1hdGlvbjtcbiAgICAgICAgdGhpcy5pbmRleF9uYW1lID0gdGhpcy5ub2RlLmluZGV4XG4gICAgICAgICAgICA/IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiB0aGlzLm5vZGUuaW5kZXggfVxuICAgICAgICAgICAgOiByZW5kZXJlci5jb21wb25lbnQuZ2V0X3VuaXF1ZV9uYW1lKGAke3RoaXMubm9kZS5jb250ZXh0fV9pbmRleGApO1xuICAgICAgICBjb25zdCBmaXhlZF9sZW5ndGggPSBub2RlLmV4cHJlc3Npb24ubm9kZS50eXBlID09PSAnQXJyYXlFeHByZXNzaW9uJyAmJlxuICAgICAgICAgICAgbm9kZS5leHByZXNzaW9uLm5vZGUuZWxlbWVudHMuZXZlcnkoZWxlbWVudCA9PiBlbGVtZW50LnR5cGUgIT09ICdTcHJlYWRFbGVtZW50JylcbiAgICAgICAgICAgID8gbm9kZS5leHByZXNzaW9uLm5vZGUuZWxlbWVudHMubGVuZ3RoXG4gICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIC8vIGhhY2sgdGhlIHNvdXJjZW1hcCwgc28gdGhhdCBpZiBkYXRhIGlzIG1pc3NpbmcgdGhlIGJ1Z1xuICAgICAgICAvLyBpcyBlYXN5IHRvIGZpbmRcbiAgICAgICAgbGV0IGMgPSB0aGlzLm5vZGUuc3RhcnQgKyAyO1xuICAgICAgICB3aGlsZSAocmVuZGVyZXIuY29tcG9uZW50LnNvdXJjZVtjXSAhPT0gJ2UnKVxuICAgICAgICAgICAgYyArPSAxO1xuICAgICAgICBjb25zdCBzdGFydCA9IHJlbmRlcmVyLmNvbXBvbmVudC5sb2NhdGUoYyk7XG4gICAgICAgIGNvbnN0IGVuZCA9IHsgbGluZTogc3RhcnQubGluZSwgY29sdW1uOiBzdGFydC5jb2x1bW4gKyA0IH07XG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdJZGVudGlmaWVyJyxcbiAgICAgICAgICAgIG5hbWU6ICdsZW5ndGgnLFxuICAgICAgICAgICAgbG9jOiB7IHN0YXJ0LCBlbmQgfVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBlYWNoX2Jsb2NrX3ZhbHVlID0gcmVuZGVyZXIuY29tcG9uZW50LmdldF91bmlxdWVfbmFtZShgJHt0aGlzLnZhci5uYW1lfV92YWx1ZWApO1xuICAgICAgICBjb25zdCBpdGVyYXRpb25zID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke3RoaXMudmFyLm5hbWV9X2Jsb2Nrc2ApO1xuICAgICAgICByZW5kZXJlci5hZGRfdG9fY29udGV4dChlYWNoX2Jsb2NrX3ZhbHVlLm5hbWUsIHRydWUpO1xuICAgICAgICByZW5kZXJlci5hZGRfdG9fY29udGV4dCh0aGlzLmluZGV4X25hbWUubmFtZSwgdHJ1ZSk7XG4gICAgICAgIHRoaXMudmFycyA9IHtcbiAgICAgICAgICAgIGNyZWF0ZV9lYWNoX2Jsb2NrOiB0aGlzLmJsb2NrLm5hbWUsXG4gICAgICAgICAgICBlYWNoX2Jsb2NrX3ZhbHVlLFxuICAgICAgICAgICAgZ2V0X2VhY2hfY29udGV4dDogcmVuZGVyZXIuY29tcG9uZW50LmdldF91bmlxdWVfbmFtZShgZ2V0XyR7dGhpcy52YXIubmFtZX1fY29udGV4dGApLFxuICAgICAgICAgICAgaXRlcmF0aW9ucyxcbiAgICAgICAgICAgIC8vIG9wdGltaXNhdGlvbiBmb3IgYXJyYXkgbGl0ZXJhbFxuICAgICAgICAgICAgZml4ZWRfbGVuZ3RoLFxuICAgICAgICAgICAgZGF0YV9sZW5ndGg6IGZpeGVkX2xlbmd0aCA9PT0gbnVsbCA/IHggYCR7ZWFjaF9ibG9ja192YWx1ZX0uJHtsZW5ndGh9YCA6IGZpeGVkX2xlbmd0aCxcbiAgICAgICAgICAgIHZpZXdfbGVuZ3RoOiBmaXhlZF9sZW5ndGggPT09IG51bGwgPyB4IGAke2l0ZXJhdGlvbnN9Lmxlbmd0aGAgOiBmaXhlZF9sZW5ndGhcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgb2JqZWN0ID0gZ2V0X29iamVjdChub2RlLmV4cHJlc3Npb24ubm9kZSk7XG4gICAgICAgIGNvbnN0IHN0b3JlID0gb2JqZWN0LnR5cGUgPT09ICdJZGVudGlmaWVyJyAmJiBvYmplY3QubmFtZVswXSA9PT0gJyQnID8gb2JqZWN0Lm5hbWUuc2xpY2UoMSkgOiBudWxsO1xuICAgICAgICBub2RlLmNvbnRleHRzLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICAgICAgICB0aGlzLmJsb2NrLmJpbmRpbmdzLnNldChwcm9wLmtleS5uYW1lLCB7XG4gICAgICAgICAgICAgICAgb2JqZWN0OiB0aGlzLnZhcnMuZWFjaF9ibG9ja192YWx1ZSxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5pbmRleF9uYW1lLFxuICAgICAgICAgICAgICAgIG1vZGlmaWVyOiBwcm9wLm1vZGlmaWVyLFxuICAgICAgICAgICAgICAgIHNuaXBwZXQ6IHByb3AubW9kaWZpZXIoeCBgJHt0aGlzLnZhcnMuZWFjaF9ibG9ja192YWx1ZX1bJHt0aGlzLmluZGV4X25hbWV9XWApLFxuICAgICAgICAgICAgICAgIHN0b3JlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLm5vZGUuaW5kZXgpIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKHRoaXMubm9kZS5pbmRleCk7IC8vIHRoaXMgcHJldmVudHMgbmFtZSBjb2xsaXNpb25zICgjMTI1NClcbiAgICAgICAgfVxuICAgICAgICByZW5kZXJlci5ibG9ja3MucHVzaCh0aGlzLmJsb2NrKTtcbiAgICAgICAgdGhpcy5mcmFnbWVudCA9IG5ldyBGcmFnbWVudFdyYXBwZXIocmVuZGVyZXIsIHRoaXMuYmxvY2ssIG5vZGUuY2hpbGRyZW4sIHRoaXMsIHN0cmlwX3doaXRlc3BhY2UsIG5leHRfc2libGluZyk7XG4gICAgICAgIGlmICh0aGlzLm5vZGUuZWxzZSkge1xuICAgICAgICAgICAgdGhpcy5lbHNlID0gbmV3IEVsc2VCbG9ja1dyYXBwZXIocmVuZGVyZXIsIGJsb2NrLCB0aGlzLCB0aGlzLm5vZGUuZWxzZSwgc3RyaXBfd2hpdGVzcGFjZSwgbmV4dF9zaWJsaW5nKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmJsb2Nrcy5wdXNoKHRoaXMuZWxzZS5ibG9jayk7XG4gICAgICAgICAgICBpZiAodGhpcy5lbHNlLmlzX2R5bmFtaWMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2NrLmFkZF9kZXBlbmRlbmNpZXModGhpcy5lbHNlLmJsb2NrLmRlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyh0aGlzLmJsb2NrLmRlcGVuZGVuY2llcyk7XG4gICAgICAgIGlmICh0aGlzLmJsb2NrLmhhc19vdXRyb3MgfHwgKHRoaXMuZWxzZSAmJiB0aGlzLmVsc2UuYmxvY2suaGFzX291dHJvcykpIHtcbiAgICAgICAgICAgIGJsb2NrLmFkZF9vdXRybygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcihibG9jaywgcGFyZW50X25vZGUsIHBhcmVudF9ub2Rlcykge1xuICAgICAgICBpZiAodGhpcy5mcmFnbWVudC5ub2Rlcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHsgcmVuZGVyZXIgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgY29tcG9uZW50IH0gPSByZW5kZXJlcjtcbiAgICAgICAgY29uc3QgbmVlZHNfYW5jaG9yID0gdGhpcy5uZXh0XG4gICAgICAgICAgICA/ICF0aGlzLm5leHQuaXNfZG9tX25vZGUoKSA6XG4gICAgICAgICAgICAhcGFyZW50X25vZGUgfHwgIXRoaXMucGFyZW50LmlzX2RvbV9ub2RlKCk7XG4gICAgICAgIGNvbnN0IHNuaXBwZXQgPSB0aGlzLm5vZGUuZXhwcmVzc2lvbi5tYW5pcHVsYXRlKGJsb2NrKTtcbiAgICAgICAgYmxvY2suY2h1bmtzLmluaXQucHVzaChiIGBsZXQgJHt0aGlzLnZhcnMuZWFjaF9ibG9ja192YWx1ZX0gPSAke3NuaXBwZXR9O2ApO1xuICAgICAgICBpZiAodGhpcy5yZW5kZXJlci5vcHRpb25zLmRldikge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmluaXQucHVzaChiIGBAdmFsaWRhdGVfZWFjaF9hcmd1bWVudCgke3RoaXMudmFycy5lYWNoX2Jsb2NrX3ZhbHVlfSk7YCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW5pdGlhbF9hbmNob3Jfbm9kZSA9IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiBwYXJlbnRfbm9kZSA/ICdudWxsJyA6ICcjYW5jaG9yJyB9O1xuICAgICAgICBjb25zdCBpbml0aWFsX21vdW50X25vZGUgPSBwYXJlbnRfbm9kZSB8fCB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogJyN0YXJnZXQnIH07XG4gICAgICAgIGNvbnN0IHVwZGF0ZV9hbmNob3Jfbm9kZSA9IG5lZWRzX2FuY2hvclxuICAgICAgICAgICAgPyBibG9jay5nZXRfdW5pcXVlX25hbWUoYCR7dGhpcy52YXIubmFtZX1fYW5jaG9yYClcbiAgICAgICAgICAgIDogKHRoaXMubmV4dCAmJiB0aGlzLm5leHQudmFyKSB8fCB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogJ251bGwnIH07XG4gICAgICAgIGNvbnN0IHVwZGF0ZV9tb3VudF9ub2RlID0gdGhpcy5nZXRfdXBkYXRlX21vdW50X25vZGUodXBkYXRlX2FuY2hvcl9ub2RlKTtcbiAgICAgICAgY29uc3QgYXJncyA9IHtcbiAgICAgICAgICAgIGJsb2NrLFxuICAgICAgICAgICAgcGFyZW50X25vZGUsXG4gICAgICAgICAgICBwYXJlbnRfbm9kZXMsXG4gICAgICAgICAgICBzbmlwcGV0LFxuICAgICAgICAgICAgaW5pdGlhbF9hbmNob3Jfbm9kZSxcbiAgICAgICAgICAgIGluaXRpYWxfbW91bnRfbm9kZSxcbiAgICAgICAgICAgIHVwZGF0ZV9hbmNob3Jfbm9kZSxcbiAgICAgICAgICAgIHVwZGF0ZV9tb3VudF9ub2RlXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGFsbF9kZXBlbmRlbmNpZXMgPSBuZXcgU2V0KHRoaXMuYmxvY2suZGVwZW5kZW5jaWVzKTsgLy8gVE9ETyBzaG91bGQgYmUgZHluYW1pYyBkZXBzIG9ubHlcbiAgICAgICAgdGhpcy5ub2RlLmV4cHJlc3Npb24uZHluYW1pY19kZXBlbmRlbmNpZXMoKS5mb3JFYWNoKChkZXBlbmRlbmN5KSA9PiB7XG4gICAgICAgICAgICBhbGxfZGVwZW5kZW5jaWVzLmFkZChkZXBlbmRlbmN5KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLm5vZGUua2V5KSB7XG4gICAgICAgICAgICB0aGlzLm5vZGUua2V5LmR5bmFtaWNfZGVwZW5kZW5jaWVzKCkuZm9yRWFjaCgoZGVwZW5kZW5jeSkgPT4ge1xuICAgICAgICAgICAgICAgIGFsbF9kZXBlbmRlbmNpZXMuYWRkKGRlcGVuZGVuY3kpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBhbGxfZGVwZW5kZW5jaWVzO1xuICAgICAgICBpZiAodGhpcy5ub2RlLmtleSkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJfa2V5ZWQoYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcl91bmtleWVkKGFyZ3MpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmJsb2NrLmhhc19pbnRyb19tZXRob2QgfHwgdGhpcy5ibG9jay5oYXNfb3V0cm9fbWV0aG9kKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW50cm8ucHVzaChiIGBcblx0XHRcdFx0Zm9yIChsZXQgI2kgPSAwOyAjaSA8ICR7dGhpcy52YXJzLmRhdGFfbGVuZ3RofTsgI2kgKz0gMSkge1xuXHRcdFx0XHRcdEB0cmFuc2l0aW9uX2luKCR7dGhpcy52YXJzLml0ZXJhdGlvbnN9WyNpXSk7XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZWVkc19hbmNob3IpIHtcbiAgICAgICAgICAgIGJsb2NrLmFkZF9lbGVtZW50KHVwZGF0ZV9hbmNob3Jfbm9kZSwgeCBgQGVtcHR5KClgLCBwYXJlbnRfbm9kZXMgJiYgeCBgQGVtcHR5KClgLCBwYXJlbnRfbm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZWxzZSkge1xuICAgICAgICAgICAgY29uc3QgZWFjaF9ibG9ja19lbHNlID0gY29tcG9uZW50LmdldF91bmlxdWVfbmFtZShgJHt0aGlzLnZhci5uYW1lfV9lbHNlYCk7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYGxldCAke2VhY2hfYmxvY2tfZWxzZX0gPSBudWxsO2ApO1xuICAgICAgICAgICAgLy8gVE9ETyBuZWF0ZW4gdGhpcyB1cC4uLiB3aWxsIGVuZCB1cCB3aXRoIGFuIGVtcHR5IGxpbmUgaW4gdGhlIGJsb2NrXG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0XHRpZiAoISR7dGhpcy52YXJzLmRhdGFfbGVuZ3RofSkge1xuXHRcdFx0XHRcdCR7ZWFjaF9ibG9ja19lbHNlfSA9ICR7dGhpcy5lbHNlLmJsb2NrLm5hbWV9KCNjdHgpO1xuXHRcdFx0XHR9XG5cdFx0XHRgKTtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5jcmVhdGUucHVzaChiIGBcblx0XHRcdFx0aWYgKCR7ZWFjaF9ibG9ja19lbHNlfSkge1xuXHRcdFx0XHRcdCR7ZWFjaF9ibG9ja19lbHNlfS5jKCk7XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICAgICAgaWYgKHRoaXMucmVuZGVyZXIub3B0aW9ucy5oeWRyYXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNsYWltLnB1c2goYiBgXG5cdFx0XHRcdFx0aWYgKCR7ZWFjaF9ibG9ja19lbHNlfSkge1xuXHRcdFx0XHRcdFx0JHtlYWNoX2Jsb2NrX2Vsc2V9LmwoJHtwYXJlbnRfbm9kZXN9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2suY2h1bmtzLm1vdW50LnB1c2goYiBgXG5cdFx0XHRcdGlmICgke2VhY2hfYmxvY2tfZWxzZX0pIHtcblx0XHRcdFx0XHQke2VhY2hfYmxvY2tfZWxzZX0ubSgke2luaXRpYWxfbW91bnRfbm9kZX0sICR7aW5pdGlhbF9hbmNob3Jfbm9kZX0pO1xuXHRcdFx0XHR9XG5cdFx0XHRgKTtcbiAgICAgICAgICAgIGNvbnN0IGhhc190cmFuc2l0aW9ucyA9ICEhKHRoaXMuZWxzZS5ibG9jay5oYXNfaW50cm9fbWV0aG9kIHx8IHRoaXMuZWxzZS5ibG9jay5oYXNfb3V0cm9fbWV0aG9kKTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3Ryb3lfYmxvY2tfZWxzZSA9IHRoaXMuZWxzZS5ibG9jay5oYXNfb3V0cm9fbWV0aG9kXG4gICAgICAgICAgICAgICAgPyBiIGBcblx0XHRcdFx0XHRAZ3JvdXBfb3V0cm9zKCk7XG5cdFx0XHRcdFx0QHRyYW5zaXRpb25fb3V0KCR7ZWFjaF9ibG9ja19lbHNlfSwgMSwgMSwgKCkgPT4ge1xuXHRcdFx0XHRcdFx0JHtlYWNoX2Jsb2NrX2Vsc2V9ID0gbnVsbDtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRAY2hlY2tfb3V0cm9zKCk7YFxuICAgICAgICAgICAgICAgIDogYiBgXG5cdFx0XHRcdFx0JHtlYWNoX2Jsb2NrX2Vsc2V9LmQoMSk7XG5cdFx0XHRcdFx0JHtlYWNoX2Jsb2NrX2Vsc2V9ID0gbnVsbDtgO1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxzZS5ibG9jay5oYXNfdXBkYXRlX21ldGhvZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlcy5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICghJHt0aGlzLnZhcnMuZGF0YV9sZW5ndGh9ICYmICR7ZWFjaF9ibG9ja19lbHNlfSkge1xuXHRcdFx0XHRcdFx0JHtlYWNoX2Jsb2NrX2Vsc2V9LnAoI2N0eCwgI2RpcnR5KTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKCEke3RoaXMudmFycy5kYXRhX2xlbmd0aH0pIHtcblx0XHRcdFx0XHRcdCR7ZWFjaF9ibG9ja19lbHNlfSA9ICR7dGhpcy5lbHNlLmJsb2NrLm5hbWV9KCNjdHgpO1xuXHRcdFx0XHRcdFx0JHtlYWNoX2Jsb2NrX2Vsc2V9LmMoKTtcblx0XHRcdFx0XHRcdCR7aGFzX3RyYW5zaXRpb25zICYmIGIgYEB0cmFuc2l0aW9uX2luKCR7ZWFjaF9ibG9ja19lbHNlfSwgMSk7YH1cblx0XHRcdFx0XHRcdCR7ZWFjaF9ibG9ja19lbHNlfS5tKCR7dXBkYXRlX21vdW50X25vZGV9LCAke3VwZGF0ZV9hbmNob3Jfbm9kZX0pO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoJHtlYWNoX2Jsb2NrX2Vsc2V9KSB7XG5cdFx0XHRcdFx0XHQke2Rlc3Ryb3lfYmxvY2tfZWxzZX07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlcy5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICgke3RoaXMudmFycy5kYXRhX2xlbmd0aH0pIHtcblx0XHRcdFx0XHRcdGlmICgke2VhY2hfYmxvY2tfZWxzZX0pIHtcblx0XHRcdFx0XHRcdFx0JHtkZXN0cm95X2Jsb2NrX2Vsc2V9O1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoISR7ZWFjaF9ibG9ja19lbHNlfSkge1xuXHRcdFx0XHRcdFx0JHtlYWNoX2Jsb2NrX2Vsc2V9ID0gJHt0aGlzLmVsc2UuYmxvY2submFtZX0oI2N0eCk7XG5cdFx0XHRcdFx0XHQke2VhY2hfYmxvY2tfZWxzZX0uYygpO1xuXHRcdFx0XHRcdFx0JHtoYXNfdHJhbnNpdGlvbnMgJiYgYiBgQHRyYW5zaXRpb25faW4oJHtlYWNoX2Jsb2NrX2Vsc2V9LCAxKTtgfVxuXHRcdFx0XHRcdFx0JHtlYWNoX2Jsb2NrX2Vsc2V9Lm0oJHt1cGRhdGVfbW91bnRfbm9kZX0sICR7dXBkYXRlX2FuY2hvcl9ub2RlfSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5kZXN0cm95LnB1c2goYiBgXG5cdFx0XHRcdGlmICgke2VhY2hfYmxvY2tfZWxzZX0pICR7ZWFjaF9ibG9ja19lbHNlfS5kKCR7cGFyZW50X25vZGUgPyAnJyA6ICdkZXRhY2hpbmcnfSk7XG5cdFx0XHRgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy51cGRhdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRpZiAoJHtibG9jay5yZW5kZXJlci5kaXJ0eShBcnJheS5mcm9tKGFsbF9kZXBlbmRlbmNpZXMpKX0pIHtcblx0XHRcdFx0XHQke3RoaXMudXBkYXRlc31cblx0XHRcdFx0fVxuXHRcdFx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mcmFnbWVudC5yZW5kZXIodGhpcy5ibG9jaywgbnVsbCwgeCBgI25vZGVzYCk7XG4gICAgICAgIGlmICh0aGlzLmVsc2UpIHtcbiAgICAgICAgICAgIHRoaXMuZWxzZS5mcmFnbWVudC5yZW5kZXIodGhpcy5lbHNlLmJsb2NrLCBudWxsLCB4IGAjbm9kZXNgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvbnRleHRfcHJvcHMgPSB0aGlzLm5vZGUuY29udGV4dHMubWFwKHByb3AgPT4gYiBgY2hpbGRfY3R4WyR7cmVuZGVyZXIuY29udGV4dF9sb29rdXAuZ2V0KHByb3Aua2V5Lm5hbWUpLmluZGV4fV0gPSAke3Byb3AuZGVmYXVsdF9tb2RpZmllcihwcm9wLm1vZGlmaWVyKHggYGxpc3RbaV1gKSwgbmFtZSA9PiByZW5kZXJlci5jb250ZXh0X2xvb2t1cC5oYXMobmFtZSkgPyB4IGBjaGlsZF9jdHhbJHtyZW5kZXJlci5jb250ZXh0X2xvb2t1cC5nZXQobmFtZSkuaW5kZXh9XWAgOiB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZSB9KX07YCk7XG4gICAgICAgIGlmICh0aGlzLm5vZGUuaGFzX2JpbmRpbmcpXG4gICAgICAgICAgICB0aGlzLmNvbnRleHRfcHJvcHMucHVzaChiIGBjaGlsZF9jdHhbJHtyZW5kZXJlci5jb250ZXh0X2xvb2t1cC5nZXQodGhpcy52YXJzLmVhY2hfYmxvY2tfdmFsdWUubmFtZSkuaW5kZXh9XSA9IGxpc3Q7YCk7XG4gICAgICAgIGlmICh0aGlzLm5vZGUuaGFzX2JpbmRpbmcgfHwgdGhpcy5ub2RlLmhhc19pbmRleF9iaW5kaW5nIHx8IHRoaXMubm9kZS5pbmRleClcbiAgICAgICAgICAgIHRoaXMuY29udGV4dF9wcm9wcy5wdXNoKGIgYGNoaWxkX2N0eFske3JlbmRlcmVyLmNvbnRleHRfbG9va3VwLmdldCh0aGlzLmluZGV4X25hbWUubmFtZSkuaW5kZXh9XSA9IGk7YCk7XG4gICAgICAgIC8vIFRPRE8gd2hpY2ggaXMgYmV0dGVyIOKAlCBPYmplY3QuY3JlYXRlKGFycmF5KSBvciBhcnJheS5zbGljZSgpP1xuICAgICAgICByZW5kZXJlci5ibG9ja3MucHVzaChiIGBcblx0XHRcdGZ1bmN0aW9uICR7dGhpcy52YXJzLmdldF9lYWNoX2NvbnRleHR9KCNjdHgsIGxpc3QsIGkpIHtcblx0XHRcdFx0Y29uc3QgY2hpbGRfY3R4ID0gI2N0eC5zbGljZSgpO1xuXHRcdFx0XHQke3RoaXMuY29udGV4dF9wcm9wc31cblx0XHRcdFx0JHthZGRfY29uc3RfdGFncyh0aGlzLmJsb2NrLCB0aGlzLm5vZGUuY29uc3RfdGFncywgJ2NoaWxkX2N0eCcpfVxuXHRcdFx0XHRyZXR1cm4gY2hpbGRfY3R4O1xuXHRcdFx0fVxuXHRcdGApO1xuICAgIH1cbiAgICByZW5kZXJfa2V5ZWQoeyBibG9jaywgcGFyZW50X25vZGUsIHBhcmVudF9ub2Rlcywgc25pcHBldCwgaW5pdGlhbF9hbmNob3Jfbm9kZSwgaW5pdGlhbF9tb3VudF9ub2RlLCB1cGRhdGVfYW5jaG9yX25vZGUsIHVwZGF0ZV9tb3VudF9ub2RlIH0pIHtcbiAgICAgICAgY29uc3QgeyBjcmVhdGVfZWFjaF9ibG9jaywgaXRlcmF0aW9ucywgZGF0YV9sZW5ndGgsIHZpZXdfbGVuZ3RoIH0gPSB0aGlzLnZhcnM7XG4gICAgICAgIGNvbnN0IGdldF9rZXkgPSBibG9jay5nZXRfdW5pcXVlX25hbWUoJ2dldF9rZXknKTtcbiAgICAgICAgY29uc3QgbG9va3VwID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke3RoaXMudmFyLm5hbWV9X2xvb2t1cGApO1xuICAgICAgICBibG9jay5hZGRfdmFyaWFibGUoaXRlcmF0aW9ucywgeCBgW11gKTtcbiAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKGxvb2t1cCwgeCBgbmV3IEBfTWFwKClgKTtcbiAgICAgICAgaWYgKHRoaXMuZnJhZ21lbnQubm9kZXNbMF0uaXNfZG9tX25vZGUoKSkge1xuICAgICAgICAgICAgdGhpcy5ibG9jay5maXJzdCA9IHRoaXMuZnJhZ21lbnQubm9kZXNbMF0udmFyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ibG9jay5maXJzdCA9IHRoaXMuYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdmaXJzdCcpO1xuICAgICAgICAgICAgdGhpcy5ibG9jay5hZGRfZWxlbWVudCh0aGlzLmJsb2NrLmZpcnN0LCB4IGBAZW1wdHkoKWAsIHBhcmVudF9ub2RlcyAmJiB4IGBAZW1wdHkoKWAsIG51bGwpO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRjb25zdCAke2dldF9rZXl9ID0gI2N0eCA9PiAke3RoaXMubm9kZS5rZXkubWFuaXB1bGF0ZShibG9jayl9O1xuXG5cdFx0XHQke3RoaXMucmVuZGVyZXIub3B0aW9ucy5kZXYgJiYgYiBgQHZhbGlkYXRlX2VhY2hfa2V5cygjY3R4LCAke3RoaXMudmFycy5lYWNoX2Jsb2NrX3ZhbHVlfSwgJHt0aGlzLnZhcnMuZ2V0X2VhY2hfY29udGV4dH0sICR7Z2V0X2tleX0pO2B9XG5cdFx0XHRmb3IgKGxldCAjaSA9IDA7ICNpIDwgJHtkYXRhX2xlbmd0aH07ICNpICs9IDEpIHtcblx0XHRcdFx0bGV0IGNoaWxkX2N0eCA9ICR7dGhpcy52YXJzLmdldF9lYWNoX2NvbnRleHR9KCNjdHgsICR7dGhpcy52YXJzLmVhY2hfYmxvY2tfdmFsdWV9LCAjaSk7XG5cdFx0XHRcdGxldCBrZXkgPSAke2dldF9rZXl9KGNoaWxkX2N0eCk7XG5cdFx0XHRcdCR7bG9va3VwfS5zZXQoa2V5LCAke2l0ZXJhdGlvbnN9WyNpXSA9ICR7Y3JlYXRlX2VhY2hfYmxvY2t9KGtleSwgY2hpbGRfY3R4KSk7XG5cdFx0XHR9XG5cdFx0YCk7XG4gICAgICAgIGJsb2NrLmNodW5rcy5jcmVhdGUucHVzaChiIGBcblx0XHRcdGZvciAobGV0ICNpID0gMDsgI2kgPCAke3ZpZXdfbGVuZ3RofTsgI2kgKz0gMSkge1xuXHRcdFx0XHQke2l0ZXJhdGlvbnN9WyNpXS5jKCk7XG5cdFx0XHR9XG5cdFx0YCk7XG4gICAgICAgIGlmIChwYXJlbnRfbm9kZXMgJiYgdGhpcy5yZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUpIHtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5jbGFpbS5wdXNoKGIgYFxuXHRcdFx0XHRmb3IgKGxldCAjaSA9IDA7ICNpIDwgJHt2aWV3X2xlbmd0aH07ICNpICs9IDEpIHtcblx0XHRcdFx0XHQke2l0ZXJhdGlvbnN9WyNpXS5sKCR7cGFyZW50X25vZGVzfSk7XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmNodW5rcy5tb3VudC5wdXNoKGIgYFxuXHRcdFx0Zm9yIChsZXQgI2kgPSAwOyAjaSA8ICR7dmlld19sZW5ndGh9OyAjaSArPSAxKSB7XG5cdFx0XHRcdCR7aXRlcmF0aW9uc31bI2ldLm0oJHtpbml0aWFsX21vdW50X25vZGV9LCAke2luaXRpYWxfYW5jaG9yX25vZGV9KTtcblx0XHRcdH1cblx0XHRgKTtcbiAgICAgICAgY29uc3QgZHluYW1pYyA9IHRoaXMuYmxvY2suaGFzX3VwZGF0ZV9tZXRob2Q7XG4gICAgICAgIGNvbnN0IGRlc3Ryb3kgPSB0aGlzLm5vZGUuaGFzX2FuaW1hdGlvblxuICAgICAgICAgICAgPyAodGhpcy5ibG9jay5oYXNfb3V0cm9zXG4gICAgICAgICAgICAgICAgPyAnQGZpeF9hbmRfb3V0cm9fYW5kX2Rlc3Ryb3lfYmxvY2snXG4gICAgICAgICAgICAgICAgOiAnQGZpeF9hbmRfZGVzdHJveV9ibG9jaycpXG4gICAgICAgICAgICA6IHRoaXMuYmxvY2suaGFzX291dHJvc1xuICAgICAgICAgICAgICAgID8gJ0BvdXRyb19hbmRfZGVzdHJveV9ibG9jaydcbiAgICAgICAgICAgICAgICA6ICdAZGVzdHJveV9ibG9jayc7XG4gICAgICAgIGlmICh0aGlzLmRlcGVuZGVuY2llcy5zaXplKSB7XG4gICAgICAgICAgICB0aGlzLmJsb2NrLm1haW50YWluX2NvbnRleHQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVzLnB1c2goYiBgXG5cdFx0XHRcdCR7dGhpcy52YXJzLmVhY2hfYmxvY2tfdmFsdWV9ID0gJHtzbmlwcGV0fTtcblx0XHRcdFx0JHt0aGlzLnJlbmRlcmVyLm9wdGlvbnMuZGV2ICYmIGIgYEB2YWxpZGF0ZV9lYWNoX2FyZ3VtZW50KCR7dGhpcy52YXJzLmVhY2hfYmxvY2tfdmFsdWV9KTtgfVxuXG5cdFx0XHRcdCR7dGhpcy5ibG9jay5oYXNfb3V0cm9zICYmIGIgYEBncm91cF9vdXRyb3MoKTtgfVxuXHRcdFx0XHQke3RoaXMubm9kZS5oYXNfYW5pbWF0aW9uICYmIGIgYGZvciAobGV0ICNpID0gMDsgI2kgPCAke3ZpZXdfbGVuZ3RofTsgI2kgKz0gMSkgJHtpdGVyYXRpb25zfVsjaV0ucigpO2B9XG5cdFx0XHRcdCR7dGhpcy5yZW5kZXJlci5vcHRpb25zLmRldiAmJiBiIGBAdmFsaWRhdGVfZWFjaF9rZXlzKCNjdHgsICR7dGhpcy52YXJzLmVhY2hfYmxvY2tfdmFsdWV9LCAke3RoaXMudmFycy5nZXRfZWFjaF9jb250ZXh0fSwgJHtnZXRfa2V5fSk7YH1cblx0XHRcdFx0JHtpdGVyYXRpb25zfSA9IEB1cGRhdGVfa2V5ZWRfZWFjaCgke2l0ZXJhdGlvbnN9LCAjZGlydHksICR7Z2V0X2tleX0sICR7ZHluYW1pYyA/IDEgOiAwfSwgI2N0eCwgJHt0aGlzLnZhcnMuZWFjaF9ibG9ja192YWx1ZX0sICR7bG9va3VwfSwgJHt1cGRhdGVfbW91bnRfbm9kZX0sICR7ZGVzdHJveX0sICR7Y3JlYXRlX2VhY2hfYmxvY2t9LCAke3VwZGF0ZV9hbmNob3Jfbm9kZX0sICR7dGhpcy52YXJzLmdldF9lYWNoX2NvbnRleHR9KTtcblx0XHRcdFx0JHt0aGlzLm5vZGUuaGFzX2FuaW1hdGlvbiAmJiBiIGBmb3IgKGxldCAjaSA9IDA7ICNpIDwgJHt2aWV3X2xlbmd0aH07ICNpICs9IDEpICR7aXRlcmF0aW9uc31bI2ldLmEoKTtgfVxuXHRcdFx0XHQke3RoaXMuYmxvY2suaGFzX291dHJvcyAmJiBiIGBAY2hlY2tfb3V0cm9zKCk7YH1cblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmJsb2NrLmhhc19vdXRyb3MpIHtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5vdXRyby5wdXNoKGIgYFxuXHRcdFx0XHRmb3IgKGxldCAjaSA9IDA7ICNpIDwgJHt2aWV3X2xlbmd0aH07ICNpICs9IDEpIHtcblx0XHRcdFx0XHRAdHJhbnNpdGlvbl9vdXQoJHtpdGVyYXRpb25zfVsjaV0pO1xuXHRcdFx0XHR9XG5cdFx0XHRgKTtcbiAgICAgICAgfVxuICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYFxuXHRcdFx0Zm9yIChsZXQgI2kgPSAwOyAjaSA8ICR7dmlld19sZW5ndGh9OyAjaSArPSAxKSB7XG5cdFx0XHRcdCR7aXRlcmF0aW9uc31bI2ldLmQoJHtwYXJlbnRfbm9kZSA/IG51bGwgOiAnZGV0YWNoaW5nJ30pO1xuXHRcdFx0fVxuXHRcdGApO1xuICAgIH1cbiAgICByZW5kZXJfdW5rZXllZCh7IGJsb2NrLCBwYXJlbnRfbm9kZXMsIHNuaXBwZXQsIGluaXRpYWxfYW5jaG9yX25vZGUsIGluaXRpYWxfbW91bnRfbm9kZSwgdXBkYXRlX2FuY2hvcl9ub2RlLCB1cGRhdGVfbW91bnRfbm9kZSB9KSB7XG4gICAgICAgIGNvbnN0IHsgY3JlYXRlX2VhY2hfYmxvY2ssIGl0ZXJhdGlvbnMsIGZpeGVkX2xlbmd0aCwgZGF0YV9sZW5ndGgsIHZpZXdfbGVuZ3RoIH0gPSB0aGlzLnZhcnM7XG4gICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRsZXQgJHtpdGVyYXRpb25zfSA9IFtdO1xuXG5cdFx0XHRmb3IgKGxldCAjaSA9IDA7ICNpIDwgJHtkYXRhX2xlbmd0aH07ICNpICs9IDEpIHtcblx0XHRcdFx0JHtpdGVyYXRpb25zfVsjaV0gPSAke2NyZWF0ZV9lYWNoX2Jsb2NrfSgke3RoaXMudmFycy5nZXRfZWFjaF9jb250ZXh0fSgjY3R4LCAke3RoaXMudmFycy5lYWNoX2Jsb2NrX3ZhbHVlfSwgI2kpKTtcblx0XHRcdH1cblx0XHRgKTtcbiAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYFxuXHRcdFx0Zm9yIChsZXQgI2kgPSAwOyAjaSA8ICR7dmlld19sZW5ndGh9OyAjaSArPSAxKSB7XG5cdFx0XHRcdCR7aXRlcmF0aW9uc31bI2ldLmMoKTtcblx0XHRcdH1cblx0XHRgKTtcbiAgICAgICAgaWYgKHBhcmVudF9ub2RlcyAmJiB0aGlzLnJlbmRlcmVyLm9wdGlvbnMuaHlkcmF0YWJsZSkge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNsYWltLnB1c2goYiBgXG5cdFx0XHRcdGZvciAobGV0ICNpID0gMDsgI2kgPCAke3ZpZXdfbGVuZ3RofTsgI2kgKz0gMSkge1xuXHRcdFx0XHRcdCR7aXRlcmF0aW9uc31bI2ldLmwoJHtwYXJlbnRfbm9kZXN9KTtcblx0XHRcdFx0fVxuXHRcdFx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgYmxvY2suY2h1bmtzLm1vdW50LnB1c2goYiBgXG5cdFx0XHRmb3IgKGxldCAjaSA9IDA7ICNpIDwgJHt2aWV3X2xlbmd0aH07ICNpICs9IDEpIHtcblx0XHRcdFx0JHtpdGVyYXRpb25zfVsjaV0ubSgke2luaXRpYWxfbW91bnRfbm9kZX0sICR7aW5pdGlhbF9hbmNob3Jfbm9kZX0pO1xuXHRcdFx0fVxuXHRcdGApO1xuICAgICAgICBpZiAodGhpcy5kZXBlbmRlbmNpZXMuc2l6ZSkge1xuICAgICAgICAgICAgY29uc3QgaGFzX3RyYW5zaXRpb25zID0gISEodGhpcy5ibG9jay5oYXNfaW50cm9fbWV0aG9kIHx8IHRoaXMuYmxvY2suaGFzX291dHJvX21ldGhvZCk7XG4gICAgICAgICAgICBjb25zdCBmb3JfbG9vcF9ib2R5ID0gdGhpcy5ibG9jay5oYXNfdXBkYXRlX21ldGhvZFxuICAgICAgICAgICAgICAgID8gYiBgXG5cdFx0XHRcdFx0aWYgKCR7aXRlcmF0aW9uc31bI2ldKSB7XG5cdFx0XHRcdFx0XHQke2l0ZXJhdGlvbnN9WyNpXS5wKGNoaWxkX2N0eCwgI2RpcnR5KTtcblx0XHRcdFx0XHRcdCR7aGFzX3RyYW5zaXRpb25zICYmIGIgYEB0cmFuc2l0aW9uX2luKCR7dGhpcy52YXJzLml0ZXJhdGlvbnN9WyNpXSwgMSk7YH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0JHtpdGVyYXRpb25zfVsjaV0gPSAke2NyZWF0ZV9lYWNoX2Jsb2NrfShjaGlsZF9jdHgpO1xuXHRcdFx0XHRcdFx0JHtpdGVyYXRpb25zfVsjaV0uYygpO1xuXHRcdFx0XHRcdFx0JHtoYXNfdHJhbnNpdGlvbnMgJiYgYiBgQHRyYW5zaXRpb25faW4oJHt0aGlzLnZhcnMuaXRlcmF0aW9uc31bI2ldLCAxKTtgfVxuXHRcdFx0XHRcdFx0JHtpdGVyYXRpb25zfVsjaV0ubSgke3VwZGF0ZV9tb3VudF9ub2RlfSwgJHt1cGRhdGVfYW5jaG9yX25vZGV9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdGBcbiAgICAgICAgICAgICAgICA6IGhhc190cmFuc2l0aW9uc1xuICAgICAgICAgICAgICAgICAgICA/IGIgYFxuXHRcdFx0XHRcdFx0aWYgKCR7aXRlcmF0aW9uc31bI2ldKSB7XG5cdFx0XHRcdFx0XHRcdEB0cmFuc2l0aW9uX2luKCR7dGhpcy52YXJzLml0ZXJhdGlvbnN9WyNpXSwgMSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQke2l0ZXJhdGlvbnN9WyNpXSA9ICR7Y3JlYXRlX2VhY2hfYmxvY2t9KGNoaWxkX2N0eCk7XG5cdFx0XHRcdFx0XHRcdCR7aXRlcmF0aW9uc31bI2ldLmMoKTtcblx0XHRcdFx0XHRcdFx0QHRyYW5zaXRpb25faW4oJHt0aGlzLnZhcnMuaXRlcmF0aW9uc31bI2ldLCAxKTtcblx0XHRcdFx0XHRcdFx0JHtpdGVyYXRpb25zfVsjaV0ubSgke3VwZGF0ZV9tb3VudF9ub2RlfSwgJHt1cGRhdGVfYW5jaG9yX25vZGV9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRgXG4gICAgICAgICAgICAgICAgICAgIDogYiBgXG5cdFx0XHRcdFx0XHRpZiAoISR7aXRlcmF0aW9uc31bI2ldKSB7XG5cdFx0XHRcdFx0XHRcdCR7aXRlcmF0aW9uc31bI2ldID0gJHtjcmVhdGVfZWFjaF9ibG9ja30oY2hpbGRfY3R4KTtcblx0XHRcdFx0XHRcdFx0JHtpdGVyYXRpb25zfVsjaV0uYygpO1xuXHRcdFx0XHRcdFx0XHQke2l0ZXJhdGlvbnN9WyNpXS5tKCR7dXBkYXRlX21vdW50X25vZGV9LCAke3VwZGF0ZV9hbmNob3Jfbm9kZX0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGA7XG4gICAgICAgICAgICBjb25zdCBzdGFydCA9IHRoaXMuYmxvY2suaGFzX3VwZGF0ZV9tZXRob2QgPyAwIDogJyNvbGRfbGVuZ3RoJztcbiAgICAgICAgICAgIGxldCByZW1vdmVfb2xkX2Jsb2NrcztcbiAgICAgICAgICAgIGlmICh0aGlzLmJsb2NrLmhhc19vdXRyb3MpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvdXQgPSBibG9jay5nZXRfdW5pcXVlX25hbWUoJ291dCcpO1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRcdFx0Y29uc3QgJHtvdXR9ID0gaSA9PiBAdHJhbnNpdGlvbl9vdXQoJHtpdGVyYXRpb25zfVtpXSwgMSwgMSwgKCkgPT4ge1xuXHRcdFx0XHRcdFx0JHtpdGVyYXRpb25zfVtpXSA9IG51bGw7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIHJlbW92ZV9vbGRfYmxvY2tzID0gYiBgXG5cdFx0XHRcdFx0QGdyb3VwX291dHJvcygpO1xuXHRcdFx0XHRcdGZvciAoI2kgPSAke2RhdGFfbGVuZ3RofTsgI2kgPCAke3ZpZXdfbGVuZ3RofTsgI2kgKz0gMSkge1xuXHRcdFx0XHRcdFx0JHtvdXR9KCNpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0QGNoZWNrX291dHJvcygpO1xuXHRcdFx0XHRgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlX29sZF9ibG9ja3MgPSBiIGBcblx0XHRcdFx0XHRmb3IgKCR7dGhpcy5ibG9jay5oYXNfdXBkYXRlX21ldGhvZCA/IG51bGwgOiB4IGAjaSA9ICR7ZGF0YV9sZW5ndGh9YH07ICNpIDwgJHt0aGlzLmJsb2NrLmhhc191cGRhdGVfbWV0aG9kID8gdmlld19sZW5ndGggOiAnI29sZF9sZW5ndGgnfTsgI2kgKz0gMSkge1xuXHRcdFx0XHRcdFx0JHtpdGVyYXRpb25zfVsjaV0uZCgxKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0JHshZml4ZWRfbGVuZ3RoICYmIGIgYCR7dmlld19sZW5ndGh9ID0gJHtkYXRhX2xlbmd0aH07YH1cblx0XHRcdFx0YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFdlIGRlY2xhcmUgYGlgIGFzIGJsb2NrIHNjb3BlZCBoZXJlLCBhcyB0aGUgYHJlbW92ZV9vbGRfYmxvY2tzYCBjb2RlXG4gICAgICAgICAgICAvLyBtYXkgcmVseSBvbiBjb250aW51aW5nIHdoZXJlIHRoaXMgaXRlcmF0aW9uIHN0b3BwZWQuXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBiIGBcblx0XHRcdFx0JHshdGhpcy5ibG9jay5oYXNfdXBkYXRlX21ldGhvZCAmJiBiIGBjb25zdCAjb2xkX2xlbmd0aCA9ICR7dGhpcy52YXJzLmVhY2hfYmxvY2tfdmFsdWV9Lmxlbmd0aDtgfVxuXHRcdFx0XHQke3RoaXMudmFycy5lYWNoX2Jsb2NrX3ZhbHVlfSA9ICR7c25pcHBldH07XG5cdFx0XHRcdCR7dGhpcy5yZW5kZXJlci5vcHRpb25zLmRldiAmJiBiIGBAdmFsaWRhdGVfZWFjaF9hcmd1bWVudCgke3RoaXMudmFycy5lYWNoX2Jsb2NrX3ZhbHVlfSk7YH1cblxuXHRcdFx0XHRsZXQgI2k7XG5cdFx0XHRcdGZvciAoI2kgPSAke3N0YXJ0fTsgI2kgPCAke2RhdGFfbGVuZ3RofTsgI2kgKz0gMSkge1xuXHRcdFx0XHRcdGNvbnN0IGNoaWxkX2N0eCA9ICR7dGhpcy52YXJzLmdldF9lYWNoX2NvbnRleHR9KCNjdHgsICR7dGhpcy52YXJzLmVhY2hfYmxvY2tfdmFsdWV9LCAjaSk7XG5cblx0XHRcdFx0XHQke2Zvcl9sb29wX2JvZHl9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQke3JlbW92ZV9vbGRfYmxvY2tzfVxuXHRcdFx0YDtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlcy5wdXNoKHVwZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYmxvY2suaGFzX291dHJvcykge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLm91dHJvLnB1c2goYiBgXG5cdFx0XHRcdCR7aXRlcmF0aW9uc30gPSAke2l0ZXJhdGlvbnN9LmZpbHRlcihAX0Jvb2xlYW4pO1xuXHRcdFx0XHRmb3IgKGxldCAjaSA9IDA7ICNpIDwgJHt2aWV3X2xlbmd0aH07ICNpICs9IDEpIHtcblx0XHRcdFx0XHRAdHJhbnNpdGlvbl9vdXQoJHtpdGVyYXRpb25zfVsjaV0pO1xuXHRcdFx0XHR9XG5cdFx0XHRgKTtcbiAgICAgICAgfVxuICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYEBkZXN0cm95X2VhY2goJHtpdGVyYXRpb25zfSwgZGV0YWNoaW5nKTtgKTtcbiAgICB9XG59XG5cbmNsYXNzIFRleHRXcmFwcGVyIGV4dGVuZHMgV3JhcHBlciB7XG4gICAgY29uc3RydWN0b3IocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUsIGRhdGEpIHtcbiAgICAgICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpO1xuICAgICAgICB0aGlzLnNraXAgPSB0aGlzLm5vZGUuc2hvdWxkX3NraXAoKTtcbiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICAgICAgdGhpcy52YXIgPSAodGhpcy5za2lwID8gbnVsbCA6IHggYHRgKTtcbiAgICB9XG4gICAgdXNlX3NwYWNlKCkge1xuICAgICAgICBpZiAodGhpcy5yZW5kZXJlci5jb21wb25lbnQuY29tcG9uZW50X29wdGlvbnMucHJlc2VydmVXaGl0ZXNwYWNlKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoL1tcXFNcXHUwMEEwXS8udGVzdCh0aGlzLmRhdGEpKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBsZXQgbm9kZSA9IHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50Lm5vZGU7XG4gICAgICAgIHdoaWxlIChub2RlKSB7XG4gICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnRWxlbWVudCcgJiYgbm9kZS5uYW1lID09PSAncHJlJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmVuZGVyKGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKSB7XG4gICAgICAgIGlmICh0aGlzLnNraXApXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHVzZV9zcGFjZSA9IHRoaXMudXNlX3NwYWNlKCk7XG4gICAgICAgIGNvbnN0IHN0cmluZ19saXRlcmFsID0ge1xuICAgICAgICAgICAgdHlwZTogJ0xpdGVyYWwnLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuZGF0YSxcbiAgICAgICAgICAgIGxvYzoge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnJlbmRlcmVyLmxvY2F0ZSh0aGlzLm5vZGUuc3RhcnQpLFxuICAgICAgICAgICAgICAgIGVuZDogdGhpcy5yZW5kZXJlci5sb2NhdGUodGhpcy5ub2RlLmVuZClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgYmxvY2suYWRkX2VsZW1lbnQodGhpcy52YXIsIHVzZV9zcGFjZSA/IHggYEBzcGFjZSgpYCA6IHggYEB0ZXh0KCR7c3RyaW5nX2xpdGVyYWx9KWAsIHBhcmVudF9ub2RlcyAmJiAodXNlX3NwYWNlID8geCBgQGNsYWltX3NwYWNlKCR7cGFyZW50X25vZGVzfSlgIDogeCBgQGNsYWltX3RleHQoJHtwYXJlbnRfbm9kZXN9LCAke3N0cmluZ19saXRlcmFsfSlgKSwgcGFyZW50X25vZGUpO1xuICAgIH1cbn1cblxuY29uc3Qgc3ZnX2F0dHJpYnV0ZXMgPSAnYWNjZW50LWhlaWdodCBhY2N1bXVsYXRlIGFkZGl0aXZlIGFsaWdubWVudC1iYXNlbGluZSBhbGxvd1Jlb3JkZXIgYWxwaGFiZXRpYyBhbXBsaXR1ZGUgYXJhYmljLWZvcm0gYXNjZW50IGF0dHJpYnV0ZU5hbWUgYXR0cmlidXRlVHlwZSBhdXRvUmV2ZXJzZSBhemltdXRoIGJhc2VGcmVxdWVuY3kgYmFzZWxpbmUtc2hpZnQgYmFzZVByb2ZpbGUgYmJveCBiZWdpbiBiaWFzIGJ5IGNhbGNNb2RlIGNhcC1oZWlnaHQgY2xhc3MgY2xpcCBjbGlwUGF0aFVuaXRzIGNsaXAtcGF0aCBjbGlwLXJ1bGUgY29sb3IgY29sb3ItaW50ZXJwb2xhdGlvbiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMgY29sb3ItcHJvZmlsZSBjb2xvci1yZW5kZXJpbmcgY29udGVudFNjcmlwdFR5cGUgY29udGVudFN0eWxlVHlwZSBjdXJzb3IgY3ggY3kgZCBkZWNlbGVyYXRlIGRlc2NlbnQgZGlmZnVzZUNvbnN0YW50IGRpcmVjdGlvbiBkaXNwbGF5IGRpdmlzb3IgZG9taW5hbnQtYmFzZWxpbmUgZHVyIGR4IGR5IGVkZ2VNb2RlIGVsZXZhdGlvbiBlbmFibGUtYmFja2dyb3VuZCBlbmQgZXhwb25lbnQgZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCBmaWxsIGZpbGwtb3BhY2l0eSBmaWxsLXJ1bGUgZmlsdGVyIGZpbHRlclJlcyBmaWx0ZXJVbml0cyBmbG9vZC1jb2xvciBmbG9vZC1vcGFjaXR5IGZvbnQtZmFtaWx5IGZvbnQtc2l6ZSBmb250LXNpemUtYWRqdXN0IGZvbnQtc3RyZXRjaCBmb250LXN0eWxlIGZvbnQtdmFyaWFudCBmb250LXdlaWdodCBmb3JtYXQgZnJvbSBmciBmeCBmeSBnMSBnMiBnbHlwaC1uYW1lIGdseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwgZ2x5cGgtb3JpZW50YXRpb24tdmVydGljYWwgZ2x5cGhSZWYgZ3JhZGllbnRUcmFuc2Zvcm0gZ3JhZGllbnRVbml0cyBoYW5naW5nIGhlaWdodCBocmVmIGhvcml6LWFkdi14IGhvcml6LW9yaWdpbi14IGlkIGlkZW9ncmFwaGljIGltYWdlLXJlbmRlcmluZyBpbiBpbjIgaW50ZXJjZXB0IGsgazEgazIgazMgazQga2VybmVsTWF0cml4IGtlcm5lbFVuaXRMZW5ndGgga2VybmluZyBrZXlQb2ludHMga2V5U3BsaW5lcyBrZXlUaW1lcyBsYW5nIGxlbmd0aEFkanVzdCBsZXR0ZXItc3BhY2luZyBsaWdodGluZy1jb2xvciBsaW1pdGluZ0NvbmVBbmdsZSBsb2NhbCBtYXJrZXItZW5kIG1hcmtlci1taWQgbWFya2VyLXN0YXJ0IG1hcmtlckhlaWdodCBtYXJrZXJVbml0cyBtYXJrZXJXaWR0aCBtYXNrIG1hc2tDb250ZW50VW5pdHMgbWFza1VuaXRzIG1hdGhlbWF0aWNhbCBtYXggbWVkaWEgbWV0aG9kIG1pbiBtb2RlIG5hbWUgbnVtT2N0YXZlcyBvZmZzZXQgb25hYm9ydCBvbmFjdGl2YXRlIG9uYmVnaW4gb25jbGljayBvbmVuZCBvbmVycm9yIG9uZm9jdXNpbiBvbmZvY3Vzb3V0IG9ubG9hZCBvbm1vdXNlZG93biBvbm1vdXNlbW92ZSBvbm1vdXNlb3V0IG9ubW91c2VvdmVyIG9ubW91c2V1cCBvbnJlcGVhdCBvbnJlc2l6ZSBvbnNjcm9sbCBvbnVubG9hZCBvcGFjaXR5IG9wZXJhdG9yIG9yZGVyIG9yaWVudCBvcmllbnRhdGlvbiBvcmlnaW4gb3ZlcmZsb3cgb3ZlcmxpbmUtcG9zaXRpb24gb3ZlcmxpbmUtdGhpY2tuZXNzIHBhbm9zZS0xIHBhaW50LW9yZGVyIHBhdGhMZW5ndGggcGF0dGVybkNvbnRlbnRVbml0cyBwYXR0ZXJuVHJhbnNmb3JtIHBhdHRlcm5Vbml0cyBwb2ludGVyLWV2ZW50cyBwb2ludHMgcG9pbnRzQXRYIHBvaW50c0F0WSBwb2ludHNBdFogcHJlc2VydmVBbHBoYSBwcmVzZXJ2ZUFzcGVjdFJhdGlvIHByaW1pdGl2ZVVuaXRzIHIgcmFkaXVzIHJlZlggcmVmWSByZW5kZXJpbmctaW50ZW50IHJlcGVhdENvdW50IHJlcGVhdER1ciByZXF1aXJlZEV4dGVuc2lvbnMgcmVxdWlyZWRGZWF0dXJlcyByZXN0YXJ0IHJlc3VsdCByb3RhdGUgcnggcnkgc2NhbGUgc2VlZCBzaGFwZS1yZW5kZXJpbmcgc2xvcGUgc3BhY2luZyBzcGVjdWxhckNvbnN0YW50IHNwZWN1bGFyRXhwb25lbnQgc3BlZWQgc3ByZWFkTWV0aG9kIHN0YXJ0T2Zmc2V0IHN0ZERldmlhdGlvbiBzdGVtaCBzdGVtdiBzdGl0Y2hUaWxlcyBzdG9wLWNvbG9yIHN0b3Atb3BhY2l0eSBzdHJpa2V0aHJvdWdoLXBvc2l0aW9uIHN0cmlrZXRocm91Z2gtdGhpY2tuZXNzIHN0cmluZyBzdHJva2Ugc3Ryb2tlLWRhc2hhcnJheSBzdHJva2UtZGFzaG9mZnNldCBzdHJva2UtbGluZWNhcCBzdHJva2UtbGluZWpvaW4gc3Ryb2tlLW1pdGVybGltaXQgc3Ryb2tlLW9wYWNpdHkgc3Ryb2tlLXdpZHRoIHN0eWxlIHN1cmZhY2VTY2FsZSBzeXN0ZW1MYW5ndWFnZSB0YWJpbmRleCB0YWJsZVZhbHVlcyB0YXJnZXQgdGFyZ2V0WCB0YXJnZXRZIHRleHQtYW5jaG9yIHRleHQtZGVjb3JhdGlvbiB0ZXh0LXJlbmRlcmluZyB0ZXh0TGVuZ3RoIHRvIHRyYW5zZm9ybSB0eXBlIHUxIHUyIHVuZGVybGluZS1wb3NpdGlvbiB1bmRlcmxpbmUtdGhpY2tuZXNzIHVuaWNvZGUgdW5pY29kZS1iaWRpIHVuaWNvZGUtcmFuZ2UgdW5pdHMtcGVyLWVtIHYtYWxwaGFiZXRpYyB2LWhhbmdpbmcgdi1pZGVvZ3JhcGhpYyB2LW1hdGhlbWF0aWNhbCB2YWx1ZXMgdmVyc2lvbiB2ZXJ0LWFkdi15IHZlcnQtb3JpZ2luLXggdmVydC1vcmlnaW4teSB2aWV3Qm94IHZpZXdUYXJnZXQgdmlzaWJpbGl0eSB3aWR0aCB3aWR0aHMgd29yZC1zcGFjaW5nIHdyaXRpbmctbW9kZSB4IHgtaGVpZ2h0IHgxIHgyIHhDaGFubmVsU2VsZWN0b3IgeGxpbms6YWN0dWF0ZSB4bGluazphcmNyb2xlIHhsaW5rOmhyZWYgeGxpbms6cm9sZSB4bGluazpzaG93IHhsaW5rOnRpdGxlIHhsaW5rOnR5cGUgeG1sOmJhc2UgeG1sOmxhbmcgeG1sOnNwYWNlIHkgeTEgeTIgeUNoYW5uZWxTZWxlY3RvciB6IHpvb21BbmRQYW4nLnNwbGl0KCcgJyk7XG5jb25zdCBzdmdfYXR0cmlidXRlX2xvb2t1cCA9IG5ldyBNYXAoKTtcbnN2Z19hdHRyaWJ1dGVzLmZvckVhY2gobmFtZSA9PiB7XG4gICAgc3ZnX2F0dHJpYnV0ZV9sb29rdXAuc2V0KG5hbWUudG9Mb3dlckNhc2UoKSwgbmFtZSk7XG59KTtcbmZ1bmN0aW9uIGZpeF9hdHRyaWJ1dGVfY2FzaW5nKG5hbWUpIHtcbiAgICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiBzdmdfYXR0cmlidXRlX2xvb2t1cC5nZXQobmFtZSkgfHwgbmFtZTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlX3NlbGVjdF92YWx1ZV9iaW5kaW5nKGF0dHIsIGRlcGVuZGVuY2llcykge1xuICAgIGNvbnN0IHsgcGFyZW50IH0gPSBhdHRyO1xuICAgIGlmIChwYXJlbnQubm9kZS5uYW1lID09PSAnc2VsZWN0Jykge1xuICAgICAgICBwYXJlbnQuc2VsZWN0X2JpbmRpbmdfZGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzO1xuICAgICAgICBkZXBlbmRlbmNpZXMuZm9yRWFjaCgocHJvcCkgPT4ge1xuICAgICAgICAgICAgcGFyZW50LnJlbmRlcmVyLmNvbXBvbmVudC5pbmRpcmVjdF9kZXBlbmRlbmNpZXMuc2V0KHByb3AsIG5ldyBTZXQoKSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuY29uc3Qgbm9uX3RleHRsaWtlX2lucHV0X3R5cGVzID0gbmV3IFNldChbXG4gICAgJ2J1dHRvbicsXG4gICAgJ2NoZWNrYm94JyxcbiAgICAnY29sb3InLFxuICAgICdkYXRlJyxcbiAgICAnZGF0ZXRpbWUtbG9jYWwnLFxuICAgICdmaWxlJyxcbiAgICAnaGlkZGVuJyxcbiAgICAnaW1hZ2UnLFxuICAgICdyYWRpbycsXG4gICAgJ3JhbmdlJyxcbiAgICAncmVzZXQnLFxuICAgICdzdWJtaXQnXG5dKTtcbmNsYXNzIEJhc2VBdHRyaWJ1dGVXcmFwcGVyIHtcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIGJsb2NrLCBub2RlKSB7XG4gICAgICAgIHRoaXMubm9kZSA9IG5vZGU7XG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgICAgICBpZiAobm9kZS5kZXBlbmRlbmNpZXMuc2l6ZSA+IDApIHtcbiAgICAgICAgICAgIHBhcmVudC5jYW5ub3RfdXNlX2lubmVyaHRtbCgpO1xuICAgICAgICAgICAgcGFyZW50Lm5vdF9zdGF0aWNfY29udGVudCgpO1xuICAgICAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyhub2RlLmRlcGVuZGVuY2llcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyKF9ibG9jaykgeyB9XG59XG5jbGFzcyBBdHRyaWJ1dGVXcmFwcGVyIGV4dGVuZHMgQmFzZUF0dHJpYnV0ZVdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHBhcmVudCwgYmxvY2ssIG5vZGUpIHtcbiAgICAgICAgc3VwZXIocGFyZW50LCBibG9jaywgbm9kZSk7XG4gICAgICAgIGlmIChub2RlLmRlcGVuZGVuY2llcy5zaXplID4gMCkge1xuICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlIOKAlCA8b3B0aW9uIHZhbHVlPXtmb299PiDigJQgc2VlIGJlbG93XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnQubm9kZS5uYW1lID09PSAnb3B0aW9uJyAmJiBub2RlLm5hbWUgPT09ICd2YWx1ZScpIHtcbiAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ID0gdGhpcy5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHNlbGVjdCAmJiAoc2VsZWN0Lm5vZGUudHlwZSAhPT0gJ0VsZW1lbnQnIHx8IHNlbGVjdC5ub2RlLm5hbWUgIT09ICdzZWxlY3QnKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlIHRvZG86IGRvdWJsZWNoZWNrIHRoaXMsIGJ1dCBsb29rcyB0byBiZSBjb3JyZWN0XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdCA9IHNlbGVjdC5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3QgJiYgc2VsZWN0LnNlbGVjdF9iaW5kaW5nX2RlcGVuZGVuY2llcykge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Quc2VsZWN0X2JpbmRpbmdfZGVwZW5kZW5jaWVzLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGUuZGVwZW5kZW5jaWVzLmZvckVhY2goKGRlcGVuZGVuY3kpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudC5yZW5kZXJlci5jb21wb25lbnQuaW5kaXJlY3RfZGVwZW5kZW5jaWVzLmdldChwcm9wKS5hZGQoZGVwZW5kZW5jeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5vZGUubmFtZSA9PT0gJ3ZhbHVlJykge1xuICAgICAgICAgICAgICAgIGhhbmRsZV9zZWxlY3RfdmFsdWVfYmluZGluZyh0aGlzLCBub2RlLmRlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucGFyZW50Lm5vZGUubmFtZXNwYWNlID09IG5hbWVzcGFjZXMuZm9yZWlnbikge1xuICAgICAgICAgICAgLy8gbGVhdmUgYXR0cmlidXRlIGNhc2UgYWxvbmUgZm9yIGVsZW1lbnRzIGluIHRoZSBcImZvcmVpZ25cIiBuYW1lc3BhY2VcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IHRoaXMubm9kZS5uYW1lO1xuICAgICAgICAgICAgdGhpcy5tZXRhZGF0YSA9IHRoaXMuZ2V0X21ldGFkYXRhKCk7XG4gICAgICAgICAgICB0aGlzLmlzX2luZGlyZWN0bHlfYm91bmRfdmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHlfbmFtZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmlzX3NlbGVjdF92YWx1ZV9hdHRyaWJ1dGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNfaW5wdXRfdmFsdWUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IGZpeF9hdHRyaWJ1dGVfY2FzaW5nKHRoaXMubm9kZS5uYW1lKTtcbiAgICAgICAgICAgIHRoaXMubWV0YWRhdGEgPSB0aGlzLmdldF9tZXRhZGF0YSgpO1xuICAgICAgICAgICAgdGhpcy5pc19pbmRpcmVjdGx5X2JvdW5kX3ZhbHVlID0gaXNfaW5kaXJlY3RseV9ib3VuZF92YWx1ZSh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHlfbmFtZSA9IHRoaXMuaXNfaW5kaXJlY3RseV9ib3VuZF92YWx1ZVxuICAgICAgICAgICAgICAgID8gJ19fdmFsdWUnXG4gICAgICAgICAgICAgICAgOiB0aGlzLm1ldGFkYXRhICYmIHRoaXMubWV0YWRhdGEucHJvcGVydHlfbmFtZTtcbiAgICAgICAgICAgIHRoaXMuaXNfc2VsZWN0X3ZhbHVlX2F0dHJpYnV0ZSA9IHRoaXMubmFtZSA9PT0gJ3ZhbHVlJyAmJiB0aGlzLnBhcmVudC5ub2RlLm5hbWUgPT09ICdzZWxlY3QnO1xuICAgICAgICAgICAgdGhpcy5pc19pbnB1dF92YWx1ZSA9IHRoaXMubmFtZSA9PT0gJ3ZhbHVlJyAmJiB0aGlzLnBhcmVudC5ub2RlLm5hbWUgPT09ICdpbnB1dCc7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETyByZXRpcmUgdGhpcyBleGNlcHRpb24gaW4gZmF2b3VyIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9zdmVsdGVqcy9zdmVsdGUvaXNzdWVzLzM3NTBcbiAgICAgICAgdGhpcy5pc19zcmMgPSB0aGlzLm5hbWUgPT09ICdzcmMnICYmICghdGhpcy5wYXJlbnQubm9kZS5uYW1lc3BhY2UgfHwgdGhpcy5wYXJlbnQubm9kZS5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZXMuaHRtbCk7XG4gICAgICAgIHRoaXMuc2hvdWxkX2NhY2hlID0gc2hvdWxkX2NhY2hlKHRoaXMpO1xuICAgIH1cbiAgICByZW5kZXIoYmxvY2spIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMucGFyZW50O1xuICAgICAgICBjb25zdCB7IG5hbWUsIHByb3BlcnR5X25hbWUsIHNob3VsZF9jYWNoZSwgaXNfaW5kaXJlY3RseV9ib3VuZF92YWx1ZSB9ID0gdGhpcztcbiAgICAgICAgLy8geGxpbmsgaXMgYSBzcGVjaWFsIGNhc2UuLi4gd2UgY291bGQgbWF5YmUgZXh0ZW5kIHRoaXMgdG8gZ2VuZXJpY1xuICAgICAgICAvLyBuYW1lc3BhY2VkIGF0dHJpYnV0ZXMgYnV0IEknbSBub3Qgc3VyZSB0aGF0J3MgYXBwbGljYWJsZSBpblxuICAgICAgICAvLyBIVE1MNT9cbiAgICAgICAgY29uc3QgbWV0aG9kID0gLy0vLnRlc3QoZWxlbWVudC5ub2RlLm5hbWUpXG4gICAgICAgICAgICA/ICdAc2V0X2N1c3RvbV9lbGVtZW50X2RhdGEnXG4gICAgICAgICAgICA6IG5hbWUuc2xpY2UoMCwgNikgPT09ICd4bGluazonXG4gICAgICAgICAgICAgICAgPyAnQHhsaW5rX2F0dHInXG4gICAgICAgICAgICAgICAgOiAnQGF0dHInO1xuICAgICAgICBjb25zdCBpc19sZWdhY3lfaW5wdXRfdHlwZSA9IGVsZW1lbnQucmVuZGVyZXIuY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5sZWdhY3kgJiYgbmFtZSA9PT0gJ3R5cGUnICYmIHRoaXMucGFyZW50Lm5vZGUubmFtZSA9PT0gJ2lucHV0JztcbiAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gdGhpcy5nZXRfZGVwZW5kZW5jaWVzKCk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRfdmFsdWUoYmxvY2spO1xuICAgICAgICBsZXQgdXBkYXRlcjtcbiAgICAgICAgY29uc3QgaW5pdCA9IHRoaXMuZ2V0X2luaXQoYmxvY2ssIHZhbHVlKTtcbiAgICAgICAgaWYgKGlzX2xlZ2FjeV9pbnB1dF90eXBlKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaHlkcmF0ZS5wdXNoKGIgYEBzZXRfaW5wdXRfdHlwZSgke2VsZW1lbnQudmFyfSwgJHtpbml0fSk7YCk7XG4gICAgICAgICAgICB1cGRhdGVyID0gYiBgQHNldF9pbnB1dF90eXBlKCR7ZWxlbWVudC52YXJ9LCAke3Nob3VsZF9jYWNoZSA/IHRoaXMubGFzdCA6IHZhbHVlfSk7YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmlzX3NlbGVjdF92YWx1ZV9hdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIC8vIGFubm95aW5nIHNwZWNpYWwgY2FzZVxuICAgICAgICAgICAgY29uc3QgaXNfbXVsdGlwbGVfc2VsZWN0ID0gZWxlbWVudC5ub2RlLmdldF9zdGF0aWNfYXR0cmlidXRlX3ZhbHVlKCdtdWx0aXBsZScpO1xuICAgICAgICAgICAgaWYgKGlzX211bHRpcGxlX3NlbGVjdCkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZXIgPSBiIGBAc2VsZWN0X29wdGlvbnMoJHtlbGVtZW50LnZhcn0sICR7dmFsdWV9KTtgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlciA9IGIgYEBzZWxlY3Rfb3B0aW9uKCR7ZWxlbWVudC52YXJ9LCAke3ZhbHVlfSk7YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5tb3VudC5wdXNoKGIgYFxuXHRcdFx0XHQke3VwZGF0ZXJ9XG5cdFx0XHRgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmlzX3NyYykge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmh5ZHJhdGUucHVzaChiIGBpZiAoIUBzcmNfdXJsX2VxdWFsKCR7ZWxlbWVudC52YXJ9LnNyYywgJHtpbml0fSkpICR7bWV0aG9kfSgke2VsZW1lbnQudmFyfSwgXCIke25hbWV9XCIsICR7dGhpcy5sYXN0fSk7YCk7XG4gICAgICAgICAgICB1cGRhdGVyID0gYiBgJHttZXRob2R9KCR7ZWxlbWVudC52YXJ9LCBcIiR7bmFtZX1cIiwgJHtzaG91bGRfY2FjaGUgPyB0aGlzLmxhc3QgOiB2YWx1ZX0pO2A7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocHJvcGVydHlfbmFtZSkge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmh5ZHJhdGUucHVzaChiIGAke2VsZW1lbnQudmFyfS4ke3Byb3BlcnR5X25hbWV9ID0gJHtpbml0fTtgKTtcbiAgICAgICAgICAgIHVwZGF0ZXIgPSBibG9jay5yZW5kZXJlci5vcHRpb25zLmRldlxuICAgICAgICAgICAgICAgID8gYiBgQHByb3BfZGV2KCR7ZWxlbWVudC52YXJ9LCBcIiR7cHJvcGVydHlfbmFtZX1cIiwgJHtzaG91bGRfY2FjaGUgPyB0aGlzLmxhc3QgOiB2YWx1ZX0pO2BcbiAgICAgICAgICAgICAgICA6IGIgYCR7ZWxlbWVudC52YXJ9LiR7cHJvcGVydHlfbmFtZX0gPSAke3Nob3VsZF9jYWNoZSA/IHRoaXMubGFzdCA6IHZhbHVlfTtgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmh5ZHJhdGUucHVzaChiIGAke21ldGhvZH0oJHtlbGVtZW50LnZhcn0sIFwiJHtuYW1lfVwiLCAke2luaXR9KTtgKTtcbiAgICAgICAgICAgIHVwZGF0ZXIgPSBiIGAke21ldGhvZH0oJHtlbGVtZW50LnZhcn0sIFwiJHtuYW1lfVwiLCAke3Nob3VsZF9jYWNoZSA/IHRoaXMubGFzdCA6IHZhbHVlfSk7YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNfaW5kaXJlY3RseV9ib3VuZF92YWx1ZSkge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlX3ZhbHVlID0gYiBgJHtlbGVtZW50LnZhcn0udmFsdWUgPSAke2VsZW1lbnQudmFyfS5fX3ZhbHVlO2A7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaHlkcmF0ZS5wdXNoKHVwZGF0ZV92YWx1ZSk7XG4gICAgICAgICAgICB1cGRhdGVyID0gYiBgXG5cdFx0XHRcdCR7dXBkYXRlcn1cblx0XHRcdFx0JHt1cGRhdGVfdmFsdWV9O1xuXHRcdFx0YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVwZW5kZW5jaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IHRoaXMuZ2V0X2RvbV91cGRhdGVfY29uZGl0aW9ucyhibG9jaywgYmxvY2sucmVuZGVyZXIuZGlydHkoZGVwZW5kZW5jaWVzKSk7XG4gICAgICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHRcdGlmICgke2NvbmRpdGlvbn0pIHtcblx0XHRcdFx0XHQke3VwZGF0ZXJ9XG5cdFx0XHRcdH1gKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBzcGVjaWFsIGNhc2Ug4oCTIGF1dG9mb2N1cy4gaGFzIHRvIGJlIGhhbmRsZWQgaW4gYSBiaXQgb2YgYSB3ZWlyZCB3YXlcbiAgICAgICAgaWYgKG5hbWUgPT09ICdhdXRvZm9jdXMnKSB7XG4gICAgICAgICAgICBibG9jay5hdXRvZm9jdXMgPSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudF92YXI6IGVsZW1lbnQudmFyLFxuICAgICAgICAgICAgICAgIGNvbmRpdGlvbl9leHByZXNzaW9uOiB0aGlzLm5vZGUuaXNfdHJ1ZSA/IHVuZGVmaW5lZCA6IHZhbHVlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldF9pbml0KGJsb2NrLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLmxhc3QgPSB0aGlzLnNob3VsZF9jYWNoZSAmJiBibG9jay5nZXRfdW5pcXVlX25hbWUoYCR7dGhpcy5wYXJlbnQudmFyLm5hbWV9XyR7dGhpcy5uYW1lLnJlcGxhY2UoL1teYS16QS1aXyRdL2csICdfJyl9X3ZhbHVlYCk7XG4gICAgICAgIGlmICh0aGlzLnNob3VsZF9jYWNoZSlcbiAgICAgICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZSh0aGlzLmxhc3QpO1xuICAgICAgICByZXR1cm4gdGhpcy5zaG91bGRfY2FjaGUgPyB4IGAke3RoaXMubGFzdH0gPSAke3ZhbHVlfWAgOiB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0X2RvbV91cGRhdGVfY29uZGl0aW9ucyhibG9jaywgZGVwZW5kZW5jeV9jb25kaXRpb24pIHtcbiAgICAgICAgY29uc3QgeyBwcm9wZXJ0eV9uYW1lLCBzaG91bGRfY2FjaGUsIGxhc3QgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLnBhcmVudDtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldF92YWx1ZShibG9jayk7XG4gICAgICAgIGxldCBjb25kaXRpb24gPSBkZXBlbmRlbmN5X2NvbmRpdGlvbjtcbiAgICAgICAgaWYgKHNob3VsZF9jYWNoZSkge1xuICAgICAgICAgICAgY29uZGl0aW9uID0gdGhpcy5pc19zcmNcbiAgICAgICAgICAgICAgICA/IHggYCR7Y29uZGl0aW9ufSAmJiAoIUBzcmNfdXJsX2VxdWFsKCR7ZWxlbWVudC52YXJ9LnNyYywgKCR7bGFzdH0gPSAke3ZhbHVlfSkpKWBcbiAgICAgICAgICAgICAgICA6IHggYCR7Y29uZGl0aW9ufSAmJiAoJHtsYXN0fSAhPT0gKCR7bGFzdH0gPSAke3ZhbHVlfSkpYDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc19pbnB1dF92YWx1ZSkge1xuICAgICAgICAgICAgY29uc3QgdHlwZSA9IGVsZW1lbnQubm9kZS5nZXRfc3RhdGljX2F0dHJpYnV0ZV92YWx1ZSgndHlwZScpO1xuICAgICAgICAgICAgaWYgKHR5cGUgIT09IHRydWUgJiYgIW5vbl90ZXh0bGlrZV9pbnB1dF90eXBlcy5oYXModHlwZSkpIHtcbiAgICAgICAgICAgICAgICBjb25kaXRpb24gPSB4IGAke2NvbmRpdGlvbn0gJiYgJHtlbGVtZW50LnZhcn0uJHtwcm9wZXJ0eV9uYW1lfSAhPT0gJHtzaG91bGRfY2FjaGUgPyBsYXN0IDogdmFsdWV9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoYmxvY2suaGFzX291dHJvcykge1xuICAgICAgICAgICAgY29uZGl0aW9uID0geCBgISNjdXJyZW50IHx8ICR7Y29uZGl0aW9ufWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbmRpdGlvbjtcbiAgICB9XG4gICAgZ2V0X2RlcGVuZGVuY2llcygpIHtcbiAgICAgICAgY29uc3Qgbm9kZV9kZXBlbmRlbmNpZXMgPSB0aGlzLm5vZGUuZ2V0X2RlcGVuZGVuY2llcygpO1xuICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBuZXcgU2V0KG5vZGVfZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgbm9kZV9kZXBlbmRlbmNpZXMuZm9yRWFjaCgocHJvcCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5kaXJlY3RfZGVwZW5kZW5jaWVzID0gdGhpcy5wYXJlbnQucmVuZGVyZXIuY29tcG9uZW50LmluZGlyZWN0X2RlcGVuZGVuY2llcy5nZXQocHJvcCk7XG4gICAgICAgICAgICBpZiAoaW5kaXJlY3RfZGVwZW5kZW5jaWVzKSB7XG4gICAgICAgICAgICAgICAgaW5kaXJlY3RfZGVwZW5kZW5jaWVzLmZvckVhY2goaW5kaXJlY3RfZGVwZW5kZW5jeSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llcy5hZGQoaW5kaXJlY3RfZGVwZW5kZW5jeSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShkZXBlbmRlbmNpZXMpO1xuICAgIH1cbiAgICBnZXRfbWV0YWRhdGEoKSB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudC5ub2RlLm5hbWVzcGFjZSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IGF0dHJpYnV0ZV9sb29rdXBbdGhpcy5uYW1lXTtcbiAgICAgICAgaWYgKG1ldGFkYXRhICYmIG1ldGFkYXRhLmFwcGxpZXNfdG8gJiYgIW1ldGFkYXRhLmFwcGxpZXNfdG8uaW5jbHVkZXModGhpcy5wYXJlbnQubm9kZS5uYW1lKSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gbWV0YWRhdGE7XG4gICAgfVxuICAgIGdldF92YWx1ZShibG9jaykge1xuICAgICAgICBpZiAodGhpcy5ub2RlLmlzX3RydWUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1ldGFkYXRhICYmIGJvb2xlYW5fYXR0cmlidXRlLmhhcyh0aGlzLm1ldGFkYXRhLnByb3BlcnR5X25hbWUudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geCBgdHJ1ZWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geCBgXCJcImA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubm9kZS5jaHVua3MubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuIHggYFwiXCJgO1xuICAgICAgICAvLyBUT0RPIHNvbWUgb2YgdGhpcyBjb2RlIGlzIHJlcGVhdGVkIGluIFRhZy50cyDigJQgd291bGQgYmUgZ29vZCB0b1xuICAgICAgICAvLyBEUlkgaXQgb3V0IGlmIHRoYXQncyBwb3NzaWJsZSB3aXRob3V0IGludHJvZHVjaW5nIGNyYXp5IGluZGlyZWN0aW9uXG4gICAgICAgIGlmICh0aGlzLm5vZGUuY2h1bmtzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5jaHVua3NbMF0udHlwZSA9PT0gJ1RleHQnXG4gICAgICAgICAgICAgICAgPyBzdHJpbmdfbGl0ZXJhbCh0aGlzLm5vZGUuY2h1bmtzWzBdLmRhdGEpXG4gICAgICAgICAgICAgICAgOiB0aGlzLm5vZGUuY2h1bmtzWzBdLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICB9XG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMubm9kZS5uYW1lID09PSAnY2xhc3MnXG4gICAgICAgICAgICA/IHRoaXMuZ2V0X2NsYXNzX25hbWVfdGV4dChibG9jaylcbiAgICAgICAgICAgIDogdGhpcy5yZW5kZXJfY2h1bmtzKGJsb2NrKS5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30gKyAke3Joc31gKTtcbiAgICAgICAgLy8gJ3tmb299IHtiYXJ9JyDigJQgdHJlYXQgYXMgc3RyaW5nIGNvbmNhdGVuYXRpb25cbiAgICAgICAgaWYgKHRoaXMubm9kZS5jaHVua3NbMF0udHlwZSAhPT0gJ1RleHQnKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHggYFwiXCIgKyAke3ZhbHVlfWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBnZXRfY2xhc3NfbmFtZV90ZXh0KGJsb2NrKSB7XG4gICAgICAgIGNvbnN0IHNjb3BlZF9jc3MgPSB0aGlzLm5vZGUuY2h1bmtzLnNvbWUoKGNodW5rKSA9PiBjaHVuay5zeW50aGV0aWMpO1xuICAgICAgICBjb25zdCByZW5kZXJlZCA9IHRoaXMucmVuZGVyX2NodW5rcyhibG9jayk7XG4gICAgICAgIGlmIChzY29wZWRfY3NzICYmIHJlbmRlcmVkLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgLy8gd2UgaGF2ZSBhIHNpdHVhdGlvbiBsaWtlIGNsYXNzPXtwb3NzaWJseVVuZGVmaW5lZH1cbiAgICAgICAgICAgIHJlbmRlcmVkWzBdID0geCBgQG51bGxfdG9fZW1wdHkoJHtyZW5kZXJlZFswXX0pYDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVuZGVyZWQucmVkdWNlKChsaHMsIHJocykgPT4geCBgJHtsaHN9ICsgJHtyaHN9YCk7XG4gICAgfVxuICAgIHJlbmRlcl9jaHVua3MoYmxvY2spIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5jaHVua3MubWFwKChjaHVuaykgPT4ge1xuICAgICAgICAgICAgaWYgKGNodW5rLnR5cGUgPT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmdfbGl0ZXJhbChjaHVuay5kYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjaHVuay5tYW5pcHVsYXRlKGJsb2NrKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0cmluZ2lmeSgpIHtcbiAgICAgICAgaWYgKHRoaXMubm9kZS5pc190cnVlKVxuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMubm9kZS5jaHVua3M7XG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm4gJz1cIlwiJztcbiAgICAgICAgcmV0dXJuIGA9XCIke3ZhbHVlLm1hcChjaHVuayA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2h1bmsudHlwZSA9PT0gJ1RleHQnXG4gICAgICAgICAgICAgICAgPyBjaHVuay5kYXRhLnJlcGxhY2UoL1wiL2csICdcXFxcXCInKVxuICAgICAgICAgICAgICAgIDogYFxcJHske2NodW5rLm1hbmlwdWxhdGUoKX19YDtcbiAgICAgICAgfSkuam9pbignJyl9XCJgO1xuICAgIH1cbn1cbi8vIHNvdXJjZTogaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvaW5kaWNlcy5odG1sXG5jb25zdCBhdHRyaWJ1dGVfbG9va3VwID0ge1xuICAgIGFsbG93ZnVsbHNjcmVlbjogeyBwcm9wZXJ0eV9uYW1lOiAnYWxsb3dGdWxsc2NyZWVuJywgYXBwbGllc190bzogWydpZnJhbWUnXSB9LFxuICAgIGFsbG93cGF5bWVudHJlcXVlc3Q6IHsgcHJvcGVydHlfbmFtZTogJ2FsbG93UGF5bWVudFJlcXVlc3QnLCBhcHBsaWVzX3RvOiBbJ2lmcmFtZSddIH0sXG4gICAgYXN5bmM6IHsgYXBwbGllc190bzogWydzY3JpcHQnXSB9LFxuICAgIGF1dG9mb2N1czogeyBhcHBsaWVzX3RvOiBbJ2J1dHRvbicsICdpbnB1dCcsICdrZXlnZW4nLCAnc2VsZWN0JywgJ3RleHRhcmVhJ10gfSxcbiAgICBhdXRvcGxheTogeyBhcHBsaWVzX3RvOiBbJ2F1ZGlvJywgJ3ZpZGVvJ10gfSxcbiAgICBjaGVja2VkOiB7IGFwcGxpZXNfdG86IFsnaW5wdXQnXSB9LFxuICAgIGNvbnRyb2xzOiB7IGFwcGxpZXNfdG86IFsnYXVkaW8nLCAndmlkZW8nXSB9LFxuICAgIGRlZmF1bHQ6IHsgYXBwbGllc190bzogWyd0cmFjayddIH0sXG4gICAgZGVmZXI6IHsgYXBwbGllc190bzogWydzY3JpcHQnXSB9LFxuICAgIGRpc2FibGVkOiB7XG4gICAgICAgIGFwcGxpZXNfdG86IFtcbiAgICAgICAgICAgICdidXR0b24nLFxuICAgICAgICAgICAgJ2ZpZWxkc2V0JyxcbiAgICAgICAgICAgICdpbnB1dCcsXG4gICAgICAgICAgICAna2V5Z2VuJyxcbiAgICAgICAgICAgICdvcHRncm91cCcsXG4gICAgICAgICAgICAnb3B0aW9uJyxcbiAgICAgICAgICAgICdzZWxlY3QnLFxuICAgICAgICAgICAgJ3RleHRhcmVhJ1xuICAgICAgICBdXG4gICAgfSxcbiAgICBmb3Jtbm92YWxpZGF0ZTogeyBwcm9wZXJ0eV9uYW1lOiAnZm9ybU5vVmFsaWRhdGUnLCBhcHBsaWVzX3RvOiBbJ2J1dHRvbicsICdpbnB1dCddIH0sXG4gICAgaGlkZGVuOiB7fSxcbiAgICBpbmRldGVybWluYXRlOiB7IGFwcGxpZXNfdG86IFsnaW5wdXQnXSB9LFxuICAgIGlzbWFwOiB7IHByb3BlcnR5X25hbWU6ICdpc01hcCcsIGFwcGxpZXNfdG86IFsnaW1nJ10gfSxcbiAgICBsb29wOiB7IGFwcGxpZXNfdG86IFsnYXVkaW8nLCAnYmdzb3VuZCcsICd2aWRlbyddIH0sXG4gICAgbXVsdGlwbGU6IHsgYXBwbGllc190bzogWydpbnB1dCcsICdzZWxlY3QnXSB9LFxuICAgIG11dGVkOiB7IGFwcGxpZXNfdG86IFsnYXVkaW8nLCAndmlkZW8nXSB9LFxuICAgIG5vbW9kdWxlOiB7IHByb3BlcnR5X25hbWU6ICdub01vZHVsZScsIGFwcGxpZXNfdG86IFsnc2NyaXB0J10gfSxcbiAgICBub3ZhbGlkYXRlOiB7IHByb3BlcnR5X25hbWU6ICdub1ZhbGlkYXRlJywgYXBwbGllc190bzogWydmb3JtJ10gfSxcbiAgICBvcGVuOiB7IGFwcGxpZXNfdG86IFsnZGV0YWlscycsICdkaWFsb2cnXSB9LFxuICAgIHBsYXlzaW5saW5lOiB7IHByb3BlcnR5X25hbWU6ICdwbGF5c0lubGluZScsIGFwcGxpZXNfdG86IFsndmlkZW8nXSB9LFxuICAgIHJlYWRvbmx5OiB7IHByb3BlcnR5X25hbWU6ICdyZWFkT25seScsIGFwcGxpZXNfdG86IFsnaW5wdXQnLCAndGV4dGFyZWEnXSB9LFxuICAgIHJlcXVpcmVkOiB7IGFwcGxpZXNfdG86IFsnaW5wdXQnLCAnc2VsZWN0JywgJ3RleHRhcmVhJ10gfSxcbiAgICByZXZlcnNlZDogeyBhcHBsaWVzX3RvOiBbJ29sJ10gfSxcbiAgICBzZWxlY3RlZDogeyBhcHBsaWVzX3RvOiBbJ29wdGlvbiddIH0sXG4gICAgdmFsdWU6IHtcbiAgICAgICAgYXBwbGllc190bzogW1xuICAgICAgICAgICAgJ2J1dHRvbicsXG4gICAgICAgICAgICAnb3B0aW9uJyxcbiAgICAgICAgICAgICdpbnB1dCcsXG4gICAgICAgICAgICAnbGknLFxuICAgICAgICAgICAgJ21ldGVyJyxcbiAgICAgICAgICAgICdwcm9ncmVzcycsXG4gICAgICAgICAgICAncGFyYW0nLFxuICAgICAgICAgICAgJ3NlbGVjdCcsXG4gICAgICAgICAgICAndGV4dGFyZWEnXG4gICAgICAgIF1cbiAgICB9XG59O1xuT2JqZWN0LmtleXMoYXR0cmlidXRlX2xvb2t1cCkuZm9yRWFjaChuYW1lID0+IHtcbiAgICBjb25zdCBtZXRhZGF0YSA9IGF0dHJpYnV0ZV9sb29rdXBbbmFtZV07XG4gICAgaWYgKCFtZXRhZGF0YS5wcm9wZXJ0eV9uYW1lKVxuICAgICAgICBtZXRhZGF0YS5wcm9wZXJ0eV9uYW1lID0gbmFtZTtcbn0pO1xuLy8gc291cmNlOiBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9pbmRpY2VzLmh0bWxcbmNvbnN0IGJvb2xlYW5fYXR0cmlidXRlID0gbmV3IFNldChbXG4gICAgJ2FsbG93ZnVsbHNjcmVlbicsXG4gICAgJ2FsbG93cGF5bWVudHJlcXVlc3QnLFxuICAgICdhc3luYycsXG4gICAgJ2F1dG9mb2N1cycsXG4gICAgJ2F1dG9wbGF5JyxcbiAgICAnY2hlY2tlZCcsXG4gICAgJ2NvbnRyb2xzJyxcbiAgICAnZGVmYXVsdCcsXG4gICAgJ2RlZmVyJyxcbiAgICAnZGlzYWJsZWQnLFxuICAgICdmb3Jtbm92YWxpZGF0ZScsXG4gICAgJ2hpZGRlbicsXG4gICAgJ2lzbWFwJyxcbiAgICAnaXRlbXNjb3BlJyxcbiAgICAnbG9vcCcsXG4gICAgJ211bHRpcGxlJyxcbiAgICAnbXV0ZWQnLFxuICAgICdub21vZHVsZScsXG4gICAgJ25vdmFsaWRhdGUnLFxuICAgICdvcGVuJyxcbiAgICAncGxheXNpbmxpbmUnLFxuICAgICdyZWFkb25seScsXG4gICAgJ3JlcXVpcmVkJyxcbiAgICAncmV2ZXJzZWQnLFxuICAgICdzZWxlY3RlZCdcbl0pO1xuZnVuY3Rpb24gc2hvdWxkX2NhY2hlKGF0dHJpYnV0ZSkge1xuICAgIHJldHVybiBhdHRyaWJ1dGUuaXNfc3JjIHx8IGF0dHJpYnV0ZS5ub2RlLnNob3VsZF9jYWNoZSgpO1xufVxuZnVuY3Rpb24gaXNfaW5kaXJlY3RseV9ib3VuZF92YWx1ZShhdHRyaWJ1dGUpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gYXR0cmlidXRlLnBhcmVudDtcbiAgICByZXR1cm4gYXR0cmlidXRlLm5hbWUgPT09ICd2YWx1ZScgJiZcbiAgICAgICAgKGVsZW1lbnQubm9kZS5uYW1lID09PSAnb3B0aW9uJyB8fCAvLyBUT0RPIGNoZWNrIGl0J3MgYWN0dWFsbHkgYm91bmRcbiAgICAgICAgICAgIChlbGVtZW50Lm5vZGUubmFtZSA9PT0gJ2lucHV0JyAmJlxuICAgICAgICAgICAgICAgIGVsZW1lbnQubm9kZS5iaW5kaW5ncy5zb21lKChiaW5kaW5nKSA9PiAvY2hlY2tlZHxncm91cC8udGVzdChiaW5kaW5nLm5hbWUpKSkpO1xufVxuXG5jbGFzcyBTdHlsZUF0dHJpYnV0ZVdyYXBwZXIgZXh0ZW5kcyBBdHRyaWJ1dGVXcmFwcGVyIHtcbiAgICByZW5kZXIoYmxvY2spIHtcbiAgICAgICAgY29uc3Qgc3R5bGVfcHJvcHMgPSBvcHRpbWl6ZV9zdHlsZSh0aGlzLm5vZGUuY2h1bmtzKTtcbiAgICAgICAgaWYgKCFzdHlsZV9wcm9wcylcbiAgICAgICAgICAgIHJldHVybiBzdXBlci5yZW5kZXIoYmxvY2spO1xuICAgICAgICBzdHlsZV9wcm9wcy5mb3JFYWNoKChwcm9wKSA9PiB7XG4gICAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgICBpZiAoaXNfZHluYW1pYyQxKHByb3AudmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvcF9kZXBlbmRlbmNpZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBwcm9wLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoY2h1bmsgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2h1bmsudHlwZSA9PT0gJ1RleHQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nX2xpdGVyYWwoY2h1bmsuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRfdG9fc2V0KHByb3BfZGVwZW5kZW5jaWVzLCBjaHVuay5keW5hbWljX2RlcGVuZGVuY2llcygpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjaHVuay5tYW5pcHVsYXRlKGJsb2NrKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30gKyAke3Joc31gKTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIGlzIHRoaXMgbmVjZXNzYXJ5PyBzdHlsZS5zZXRQcm9wZXJ0eSBhbHdheXMgdHJlYXRzIHZhbHVlIGFzIHN0cmluZywgbm8/XG4gICAgICAgICAgICAgICAgLy8gaWYgKHByb3AudmFsdWUubGVuZ3RoID09PSAxIHx8IHByb3AudmFsdWVbMF0udHlwZSAhPT0gJ1RleHQnKSB7XG4gICAgICAgICAgICAgICAgLy8gXHR2YWx1ZSA9IHhgXCJcIiArICR7dmFsdWV9YDtcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgaWYgKHByb3BfZGVwZW5kZW5jaWVzLnNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbmRpdGlvbiA9IGJsb2NrLnJlbmRlcmVyLmRpcnR5KEFycmF5LmZyb20ocHJvcF9kZXBlbmRlbmNpZXMpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrLmhhc19vdXRyb3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbiA9IHggYCEjY3VycmVudCB8fCAke2NvbmRpdGlvbn1gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGIgYFxuXHRcdFx0XHRcdFx0aWYgKCR7Y29uZGl0aW9ufSkge1xuXHRcdFx0XHRcdFx0XHRAc2V0X3N0eWxlKCR7dGhpcy5wYXJlbnQudmFyfSwgXCIke3Byb3Aua2V5fVwiLCAke3ZhbHVlfSwgJHtwcm9wLmltcG9ydGFudCA/IDEgOiBudWxsfSk7XG5cdFx0XHRcdFx0XHR9YDtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKHVwZGF0ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBzdHJpbmdfbGl0ZXJhbChwcm9wLnZhbHVlWzBdLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmh5ZHJhdGUucHVzaChiIGBAc2V0X3N0eWxlKCR7dGhpcy5wYXJlbnQudmFyfSwgXCIke3Byb3Aua2V5fVwiLCAke3ZhbHVlfSwgJHtwcm9wLmltcG9ydGFudCA/IDEgOiBudWxsfSk7YCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG9wdGltaXplX3N0eWxlKHZhbHVlKSB7XG4gICAgY29uc3QgcHJvcHMgPSBbXTtcbiAgICBsZXQgY2h1bmtzID0gdmFsdWUuc2xpY2UoKTtcbiAgICB3aGlsZSAoY2h1bmtzLmxlbmd0aCkge1xuICAgICAgICBjb25zdCBjaHVuayA9IGNodW5rc1swXTtcbiAgICAgICAgaWYgKGNodW5rLnR5cGUgIT09ICdUZXh0JylcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCBrZXlfbWF0Y2ggPSAvXlxccyooW1xcdy1dKyk6XFxzKi8uZXhlYyhjaHVuay5kYXRhKTtcbiAgICAgICAgaWYgKCFrZXlfbWF0Y2gpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgY29uc3Qga2V5ID0ga2V5X21hdGNoWzFdO1xuICAgICAgICBjb25zdCBvZmZzZXQgPSBrZXlfbWF0Y2guaW5kZXggKyBrZXlfbWF0Y2hbMF0ubGVuZ3RoO1xuICAgICAgICBjb25zdCByZW1haW5pbmdfZGF0YSA9IGNodW5rLmRhdGEuc2xpY2Uob2Zmc2V0KTtcbiAgICAgICAgaWYgKHJlbWFpbmluZ19kYXRhKSB7XG4gICAgICAgICAgICBjaHVua3NbMF0gPSB7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IGNodW5rLnN0YXJ0ICsgb2Zmc2V0LFxuICAgICAgICAgICAgICAgIGVuZDogY2h1bmsuZW5kLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdUZXh0JyxcbiAgICAgICAgICAgICAgICBkYXRhOiByZW1haW5pbmdfZGF0YVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNodW5rcy5zaGlmdCgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGdldF9zdHlsZV92YWx1ZShjaHVua3MpO1xuICAgICAgICBwcm9wcy5wdXNoKHsga2V5LCB2YWx1ZTogcmVzdWx0LnZhbHVlLCBpbXBvcnRhbnQ6IHJlc3VsdC5pbXBvcnRhbnQgfSk7XG4gICAgICAgIGNodW5rcyA9IHJlc3VsdC5jaHVua3M7XG4gICAgfVxuICAgIHJldHVybiBwcm9wcztcbn1cbmZ1bmN0aW9uIGdldF9zdHlsZV92YWx1ZShjaHVua3MpIHtcbiAgICBjb25zdCB2YWx1ZSA9IFtdO1xuICAgIGxldCBpbl91cmwgPSBmYWxzZTtcbiAgICBsZXQgcXVvdGVfbWFyayA9IG51bGw7XG4gICAgbGV0IGVzY2FwZWQgPSBmYWxzZTtcbiAgICBsZXQgY2xvc2VkID0gZmFsc2U7XG4gICAgd2hpbGUgKGNodW5rcy5sZW5ndGggJiYgIWNsb3NlZCkge1xuICAgICAgICBjb25zdCBjaHVuayA9IGNodW5rcy5zaGlmdCgpO1xuICAgICAgICBpZiAoY2h1bmsudHlwZSA9PT0gJ1RleHQnKSB7XG4gICAgICAgICAgICBsZXQgYyA9IDA7XG4gICAgICAgICAgICB3aGlsZSAoYyA8IGNodW5rLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hhciA9IGNodW5rLmRhdGFbY107XG4gICAgICAgICAgICAgICAgaWYgKGVzY2FwZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXNjYXBlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjaGFyID09PSAnXFxcXCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZXNjYXBlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNoYXIgPT09IHF1b3RlX21hcmspIHtcbiAgICAgICAgICAgICAgICAgICAgcXVvdGVfbWFyayA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNoYXIgPT09ICdcIicgfHwgY2hhciA9PT0gXCInXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcXVvdGVfbWFyayA9IGNoYXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNoYXIgPT09ICcpJyAmJiBpbl91cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5fdXJsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNoYXIgPT09ICd1JyAmJiBjaHVuay5kYXRhLnNsaWNlKGMsIGMgKyA0KSA9PT0gJ3VybCgnKSB7XG4gICAgICAgICAgICAgICAgICAgIGluX3VybCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNoYXIgPT09ICc7JyAmJiAhaW5fdXJsICYmICFxdW90ZV9tYXJrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsb3NlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjICs9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYyA+IDApIHtcbiAgICAgICAgICAgICAgICB2YWx1ZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1RleHQnLFxuICAgICAgICAgICAgICAgICAgICBzdGFydDogY2h1bmsuc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgIGVuZDogY2h1bmsuc3RhcnQgKyBjLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBjaHVuay5kYXRhLnNsaWNlKDAsIGMpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aGlsZSAoL1s7XFxzXS8udGVzdChjaHVuay5kYXRhW2NdKSlcbiAgICAgICAgICAgICAgICBjICs9IDE7XG4gICAgICAgICAgICBjb25zdCByZW1haW5pbmdfZGF0YSA9IGNodW5rLmRhdGEuc2xpY2UoYyk7XG4gICAgICAgICAgICBpZiAocmVtYWluaW5nX2RhdGEpIHtcbiAgICAgICAgICAgICAgICBjaHVua3MudW5zaGlmdCh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBjaHVuay5zdGFydCArIGMsXG4gICAgICAgICAgICAgICAgICAgIGVuZDogY2h1bmsuZW5kLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVGV4dCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlbWFpbmluZ19kYXRhXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YWx1ZS5wdXNoKGNodW5rKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBsZXQgaW1wb3J0YW50ID0gZmFsc2U7XG4gICAgY29uc3QgbGFzdF9jaHVuayA9IHZhbHVlW3ZhbHVlLmxlbmd0aCAtIDFdO1xuICAgIGlmIChsYXN0X2NodW5rICYmIGxhc3RfY2h1bmsudHlwZSA9PT0gJ1RleHQnICYmIC9cXHMqIWltcG9ydGFudFxccyokLy50ZXN0KGxhc3RfY2h1bmsuZGF0YSkpIHtcbiAgICAgICAgaW1wb3J0YW50ID0gdHJ1ZTtcbiAgICAgICAgbGFzdF9jaHVuay5kYXRhID0gbGFzdF9jaHVuay5kYXRhLnJlcGxhY2UoL1xccyohaW1wb3J0YW50XFxzKiQvLCAnJyk7XG4gICAgICAgIGlmICghbGFzdF9jaHVuay5kYXRhKVxuICAgICAgICAgICAgdmFsdWUucG9wKCk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGNodW5rcyxcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIGltcG9ydGFudFxuICAgIH07XG59XG5mdW5jdGlvbiBpc19keW5hbWljJDEodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUubGVuZ3RoID4gMSB8fCB2YWx1ZVswXS50eXBlICE9PSAnVGV4dCc7XG59XG5cbmNsYXNzIFNwcmVhZEF0dHJpYnV0ZVdyYXBwZXIgZXh0ZW5kcyBCYXNlQXR0cmlidXRlV3JhcHBlciB7XG59XG5cbmZ1bmN0aW9uIG1hcmtfZWFjaF9ibG9ja19iaW5kaW5ncyhwYXJlbnQsIGJpbmRpbmcpIHtcbiAgICAvLyB3ZSBuZWVkIHRvIGVuc3VyZSB0aGF0IHRoZSBlYWNoIGJsb2NrIGNyZWF0ZXMgYSBjb250ZXh0IGluY2x1ZGluZ1xuICAgIC8vIHRoZSBsaXN0IGFuZCB0aGUgaW5kZXgsIGlmIHRoZXkncmUgbm90IG90aGVyd2lzZSByZWZlcmVuY2VkXG4gICAgYmluZGluZy5leHByZXNzaW9uLnJlZmVyZW5jZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgY29uc3QgZWFjaF9ibG9jayA9IHBhcmVudC5ub2RlLnNjb3BlLmdldF9vd25lcihuYW1lKTtcbiAgICAgICAgaWYgKGVhY2hfYmxvY2spIHtcbiAgICAgICAgICAgIGVhY2hfYmxvY2suaGFzX2JpbmRpbmcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKGJpbmRpbmcubmFtZSA9PT0gJ2dyb3VwJykge1xuICAgICAgICBjb25zdCBhZGRfaW5kZXhfYmluZGluZyA9IChuYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlYWNoX2Jsb2NrID0gcGFyZW50Lm5vZGUuc2NvcGUuZ2V0X293bmVyKG5hbWUpO1xuICAgICAgICAgICAgaWYgKGVhY2hfYmxvY2sudHlwZSA9PT0gJ0VhY2hCbG9jaycpIHtcbiAgICAgICAgICAgICAgICBlYWNoX2Jsb2NrLmhhc19pbmRleF9iaW5kaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGRlcCBvZiBlYWNoX2Jsb2NrLmV4cHJlc3Npb24uY29udGV4dHVhbF9kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkX2luZGV4X2JpbmRpbmcoZGVwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIGZvciBgPGlucHV0IGJpbmQ6Z3JvdXA9e30gPmAsIHdlIG1ha2Ugc3VyZSB0aGF0IGFsbCB0aGUgZWFjaCBibG9ja3MgY3JlYXRlcyBjb250ZXh0IHdpdGggYGluZGV4YFxuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgYmluZGluZy5leHByZXNzaW9uLmNvbnRleHR1YWxfZGVwZW5kZW5jaWVzKSB7XG4gICAgICAgICAgICBhZGRfaW5kZXhfYmluZGluZyhuYW1lKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgQmluZGluZ1dyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKGJsb2NrLCBub2RlLCBwYXJlbnQpIHtcbiAgICAgICAgdGhpcy5ub2RlID0gbm9kZTtcbiAgICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICAgIGNvbnN0IHsgZGVwZW5kZW5jaWVzIH0gPSB0aGlzLm5vZGUuZXhwcmVzc2lvbjtcbiAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyhkZXBlbmRlbmNpZXMpO1xuICAgICAgICAvLyBUT0RPIGRvZXMgdGhpcyBhbHNvIGFwcGx5IHRvIGUuZy4gYDxpbnB1dCB0eXBlPSdjaGVja2JveCcgYmluZDpncm91cD0nZm9vJz5gP1xuICAgICAgICBoYW5kbGVfc2VsZWN0X3ZhbHVlX2JpbmRpbmcodGhpcywgZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgaWYgKG5vZGUuaXNfY29udGV4dHVhbCkge1xuICAgICAgICAgICAgbWFya19lYWNoX2Jsb2NrX2JpbmRpbmdzKHRoaXMucGFyZW50LCB0aGlzLm5vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub2JqZWN0ID0gZ2V0X29iamVjdCh0aGlzLm5vZGUuZXhwcmVzc2lvbi5ub2RlKS5uYW1lO1xuICAgICAgICAvLyB2aWV3IHRvIG1vZGVsXG4gICAgICAgIHRoaXMuaGFuZGxlciA9IGdldF9ldmVudF9oYW5kbGVyKHRoaXMsIHBhcmVudC5yZW5kZXJlciwgYmxvY2ssIHRoaXMub2JqZWN0LCB0aGlzLm5vZGUucmF3X2V4cHJlc3Npb24pO1xuICAgICAgICB0aGlzLnNuaXBwZXQgPSB0aGlzLm5vZGUuZXhwcmVzc2lvbi5tYW5pcHVsYXRlKGJsb2NrKTtcbiAgICAgICAgdGhpcy5pc19yZWFkb25seSA9IHRoaXMubm9kZS5pc19yZWFkb25seTtcbiAgICAgICAgdGhpcy5uZWVkc19sb2NrID0gdGhpcy5ub2RlLm5hbWUgPT09ICdjdXJyZW50VGltZSc7IC8vIFRPRE8gb3RoZXJzP1xuICAgIH1cbiAgICBnZXRfZGVwZW5kZW5jaWVzKCkge1xuICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBuZXcgU2V0KHRoaXMubm9kZS5leHByZXNzaW9uLmRlcGVuZGVuY2llcyk7XG4gICAgICAgIHRoaXMubm9kZS5leHByZXNzaW9uLmRlcGVuZGVuY2llcy5mb3JFYWNoKChwcm9wKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmRpcmVjdF9kZXBlbmRlbmNpZXMgPSB0aGlzLnBhcmVudC5yZW5kZXJlci5jb21wb25lbnQuaW5kaXJlY3RfZGVwZW5kZW5jaWVzLmdldChwcm9wKTtcbiAgICAgICAgICAgIGlmIChpbmRpcmVjdF9kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICBpbmRpcmVjdF9kZXBlbmRlbmNpZXMuZm9yRWFjaChpbmRpcmVjdF9kZXBlbmRlbmN5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmFkZChpbmRpcmVjdF9kZXBlbmRlbmN5KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZXBlbmRlbmNpZXM7XG4gICAgfVxuICAgIGdldF91cGRhdGVfZGVwZW5kZW5jaWVzKCkge1xuICAgICAgICBjb25zdCBvYmplY3QgPSB0aGlzLm9iamVjdDtcbiAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgICAgICBpZiAodGhpcy5ub2RlLmV4cHJlc3Npb24udGVtcGxhdGVfc2NvcGUubmFtZXMuaGFzKG9iamVjdCkpIHtcbiAgICAgICAgICAgIHRoaXMubm9kZS5leHByZXNzaW9uLnRlbXBsYXRlX3Njb3BlLmRlcGVuZGVuY2llc19mb3JfbmFtZVxuICAgICAgICAgICAgICAgIC5nZXQob2JqZWN0KVxuICAgICAgICAgICAgICAgIC5mb3JFYWNoKChuYW1lKSA9PiBkZXBlbmRlbmNpZXMuYWRkKG5hbWUpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRlcGVuZGVuY2llcy5hZGQob2JqZWN0KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgU2V0KGRlcGVuZGVuY2llcyk7XG4gICAgICAgIGRlcGVuZGVuY2llcy5mb3JFYWNoKChkZXBlbmRlbmN5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmRpcmVjdF9kZXBlbmRlbmNpZXMgPSB0aGlzLnBhcmVudC5yZW5kZXJlci5jb21wb25lbnQuaW5kaXJlY3RfZGVwZW5kZW5jaWVzLmdldChkZXBlbmRlbmN5KTtcbiAgICAgICAgICAgIGlmIChpbmRpcmVjdF9kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICBpbmRpcmVjdF9kZXBlbmRlbmNpZXMuZm9yRWFjaChpbmRpcmVjdF9kZXBlbmRlbmN5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmFkZChpbmRpcmVjdF9kZXBlbmRlbmN5KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGlzX3JlYWRvbmx5X21lZGlhX2F0dHJpYnV0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5pc19yZWFkb25seV9tZWRpYV9hdHRyaWJ1dGUoKTtcbiAgICB9XG4gICAgcmVuZGVyKGJsb2NrLCBsb2NrKSB7XG4gICAgICAgIGlmICh0aGlzLmlzX3JlYWRvbmx5KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCB7IHBhcmVudCB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgdXBkYXRlX2NvbmRpdGlvbnMgPSB0aGlzLm5lZWRzX2xvY2sgPyBbeCBgISR7bG9ja31gXSA6IFtdO1xuICAgICAgICBjb25zdCBtb3VudF9jb25kaXRpb25zID0gW107XG4gICAgICAgIGNvbnN0IGRlcGVuZGVuY3lfYXJyYXkgPSBBcnJheS5mcm9tKHRoaXMuZ2V0X2RlcGVuZGVuY2llcygpKTtcbiAgICAgICAgaWYgKGRlcGVuZGVuY3lfYXJyYXkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdXBkYXRlX2NvbmRpdGlvbnMucHVzaChibG9jay5yZW5kZXJlci5kaXJ0eShkZXBlbmRlbmN5X2FycmF5KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcmVudC5ub2RlLm5hbWUgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBwYXJlbnQubm9kZS5nZXRfc3RhdGljX2F0dHJpYnV0ZV92YWx1ZSgndHlwZScpO1xuICAgICAgICAgICAgaWYgKHR5cGUgPT09IG51bGwgfHxcbiAgICAgICAgICAgICAgICB0eXBlID09PSAnJyB8fFxuICAgICAgICAgICAgICAgIHR5cGUgPT09ICd0ZXh0JyB8fFxuICAgICAgICAgICAgICAgIHR5cGUgPT09ICdlbWFpbCcgfHxcbiAgICAgICAgICAgICAgICB0eXBlID09PSAncGFzc3dvcmQnKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlX2NvbmRpdGlvbnMucHVzaCh4IGAke3BhcmVudC52YXJ9LiR7dGhpcy5ub2RlLm5hbWV9ICE9PSAke3RoaXMuc25pcHBldH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlX2NvbmRpdGlvbnMucHVzaCh4IGBAdG9fbnVtYmVyKCR7cGFyZW50LnZhcn0uJHt0aGlzLm5vZGUubmFtZX0pICE9PSAke3RoaXMuc25pcHBldH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBtb2RlbCB0byB2aWV3XG4gICAgICAgIGxldCB1cGRhdGVfZG9tID0gZ2V0X2RvbV91cGRhdGVyKHBhcmVudCwgdGhpcyk7XG4gICAgICAgIGxldCBtb3VudF9kb20gPSB1cGRhdGVfZG9tO1xuICAgICAgICAvLyBzcGVjaWFsIGNhc2VzXG4gICAgICAgIHN3aXRjaCAodGhpcy5ub2RlLm5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2dyb3VwJzpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgYmluZGluZ19ncm91cCwgaXNfY29udGV4dCwgY29udGV4dHMsIGluZGV4LCBrZXlwYXRoIH0gPSBnZXRfYmluZGluZ19ncm91cChwYXJlbnQucmVuZGVyZXIsIHRoaXMubm9kZSwgYmxvY2spO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5yZW5kZXJlci5hZGRfdG9fY29udGV4dCgnJCRiaW5kaW5nX2dyb3VwcycpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNfY29udGV4dCAmJiAhYmxvY2suYmluZGluZ19ncm91cF9pbml0aWFsaXNlZC5oYXMoa2V5cGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZXh0cy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGJpbmRpbmdfZ3JvdXAgPSB4IGAke2Jsb2NrLnJlbmRlcmVyLnJlZmVyZW5jZSgnJCRiaW5kaW5nX2dyb3VwcycpfVske2luZGV4fV1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBjb250ZXh0cy5zbGljZSgwLCAtMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZGluZ19ncm91cCA9IHggYCR7YmluZGluZ19ncm91cH1bJHtibG9jay5yZW5kZXJlci5yZWZlcmVuY2UobmFtZSl9XWA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgJHtiaW5kaW5nX2dyb3VwfSA9ICR7YmluZGluZ19ncm91cH0gfHwgW107YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmluaXQucHVzaChiIGAke2JpbmRpbmdfZ3JvdXAodHJ1ZSl9ID0gW107YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5iaW5kaW5nX2dyb3VwX2luaXRpYWxpc2VkLmFkZChrZXlwYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuaHlkcmF0ZS5wdXNoKGIgYCR7YmluZGluZ19ncm91cCh0cnVlKX0ucHVzaCgke3BhcmVudC52YXJ9KTtgKTtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmRlc3Ryb3kucHVzaChiIGAke2JpbmRpbmdfZ3JvdXAodHJ1ZSl9LnNwbGljZSgke2JpbmRpbmdfZ3JvdXAodHJ1ZSl9LmluZGV4T2YoJHtwYXJlbnQudmFyfSksIDEpO2ApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICd0ZXh0Q29udGVudCc6XG4gICAgICAgICAgICAgICAgdXBkYXRlX2NvbmRpdGlvbnMucHVzaCh4IGAke3RoaXMuc25pcHBldH0gIT09ICR7cGFyZW50LnZhcn0udGV4dENvbnRlbnRgKTtcbiAgICAgICAgICAgICAgICBtb3VudF9jb25kaXRpb25zLnB1c2goeCBgJHt0aGlzLnNuaXBwZXR9ICE9PSB2b2lkIDBgKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2lubmVySFRNTCc6XG4gICAgICAgICAgICAgICAgdXBkYXRlX2NvbmRpdGlvbnMucHVzaCh4IGAke3RoaXMuc25pcHBldH0gIT09ICR7cGFyZW50LnZhcn0uaW5uZXJIVE1MYCk7XG4gICAgICAgICAgICAgICAgbW91bnRfY29uZGl0aW9ucy5wdXNoKHggYCR7dGhpcy5zbmlwcGV0fSAhPT0gdm9pZCAwYCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjdXJyZW50VGltZSc6XG4gICAgICAgICAgICAgICAgdXBkYXRlX2NvbmRpdGlvbnMucHVzaCh4IGAhQF9pc05hTigke3RoaXMuc25pcHBldH0pYCk7XG4gICAgICAgICAgICAgICAgbW91bnRfZG9tID0gbnVsbDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3BsYXliYWNrUmF0ZSc6XG4gICAgICAgICAgICBjYXNlICd2b2x1bWUnOlxuICAgICAgICAgICAgICAgIHVwZGF0ZV9jb25kaXRpb25zLnB1c2goeCBgIUBfaXNOYU4oJHt0aGlzLnNuaXBwZXR9KWApO1xuICAgICAgICAgICAgICAgIG1vdW50X2NvbmRpdGlvbnMucHVzaCh4IGAhQF9pc05hTigke3RoaXMuc25pcHBldH0pYCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdwYXVzZWQnOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBuZWNlc3NhcnkgdG8gcHJldmVudCBhdWRpbyByZXN0YXJ0aW5nIGJ5IGl0c2VsZlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0ID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke3BhcmVudC52YXIubmFtZX1faXNfcGF1c2VkYCk7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZShsYXN0LCB4IGB0cnVlYCk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9jb25kaXRpb25zLnB1c2goeCBgJHtsYXN0fSAhPT0gKCR7bGFzdH0gPSAke3RoaXMuc25pcHBldH0pYCk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kb20gPSBiIGAke3BhcmVudC52YXJ9WyR7bGFzdH0gPyBcInBhdXNlXCIgOiBcInBsYXlcIl0oKTtgO1xuICAgICAgICAgICAgICAgICAgICBtb3VudF9kb20gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICd2YWx1ZSc6XG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudC5ub2RlLmdldF9zdGF0aWNfYXR0cmlidXRlX3ZhbHVlKCd0eXBlJykgPT09ICdmaWxlJykge1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZG9tID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgbW91bnRfZG9tID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVwZGF0ZV9kb20pIHtcbiAgICAgICAgICAgIGlmICh1cGRhdGVfY29uZGl0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uID0gdXBkYXRlX2NvbmRpdGlvbnMucmVkdWNlKChsaHMsIHJocykgPT4geCBgJHtsaHN9ICYmICR7cmhzfWApO1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0XHRpZiAoJHtjb25kaXRpb259KSB7XG5cdFx0XHRcdFx0XHQke3VwZGF0ZV9kb219XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaCh1cGRhdGVfZG9tKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobW91bnRfZG9tKSB7XG4gICAgICAgICAgICBpZiAobW91bnRfY29uZGl0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uID0gbW91bnRfY29uZGl0aW9ucy5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30gJiYgJHtyaHN9YCk7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLm1vdW50LnB1c2goYiBgXG5cdFx0XHRcdFx0aWYgKCR7Y29uZGl0aW9ufSkge1xuXHRcdFx0XHRcdFx0JHttb3VudF9kb219XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5tb3VudC5wdXNoKG1vdW50X2RvbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBnZXRfZG9tX3VwZGF0ZXIoZWxlbWVudCwgYmluZGluZykge1xuICAgIGNvbnN0IHsgbm9kZSB9ID0gZWxlbWVudDtcbiAgICBpZiAoYmluZGluZy5pc19yZWFkb25seV9tZWRpYV9hdHRyaWJ1dGUoKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKGJpbmRpbmcubm9kZS5uYW1lID09PSAndGhpcycpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmIChub2RlLm5hbWUgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgIHJldHVybiBub2RlLmdldF9zdGF0aWNfYXR0cmlidXRlX3ZhbHVlKCdtdWx0aXBsZScpID09PSB0cnVlID9cbiAgICAgICAgICAgIGIgYEBzZWxlY3Rfb3B0aW9ucygke2VsZW1lbnQudmFyfSwgJHtiaW5kaW5nLnNuaXBwZXR9KWAgOlxuICAgICAgICAgICAgYiBgQHNlbGVjdF9vcHRpb24oJHtlbGVtZW50LnZhcn0sICR7YmluZGluZy5zbmlwcGV0fSlgO1xuICAgIH1cbiAgICBpZiAoYmluZGluZy5ub2RlLm5hbWUgPT09ICdncm91cCcpIHtcbiAgICAgICAgY29uc3QgdHlwZSA9IG5vZGUuZ2V0X3N0YXRpY19hdHRyaWJ1dGVfdmFsdWUoJ3R5cGUnKTtcbiAgICAgICAgY29uc3QgY29uZGl0aW9uID0gdHlwZSA9PT0gJ2NoZWNrYm94J1xuICAgICAgICAgICAgPyB4IGB+JHtiaW5kaW5nLnNuaXBwZXR9LmluZGV4T2YoJHtlbGVtZW50LnZhcn0uX192YWx1ZSlgXG4gICAgICAgICAgICA6IHggYCR7ZWxlbWVudC52YXJ9Ll9fdmFsdWUgPT09ICR7YmluZGluZy5zbmlwcGV0fWA7XG4gICAgICAgIHJldHVybiBiIGAke2VsZW1lbnQudmFyfS5jaGVja2VkID0gJHtjb25kaXRpb259O2A7XG4gICAgfVxuICAgIGlmIChiaW5kaW5nLm5vZGUubmFtZSA9PT0gJ3ZhbHVlJykge1xuICAgICAgICByZXR1cm4gYiBgQHNldF9pbnB1dF92YWx1ZSgke2VsZW1lbnQudmFyfSwgJHtiaW5kaW5nLnNuaXBwZXR9KTtgO1xuICAgIH1cbiAgICByZXR1cm4gYiBgJHtlbGVtZW50LnZhcn0uJHtiaW5kaW5nLm5vZGUubmFtZX0gPSAke2JpbmRpbmcuc25pcHBldH07YDtcbn1cbmZ1bmN0aW9uIGdldF9iaW5kaW5nX2dyb3VwKHJlbmRlcmVyLCB2YWx1ZSwgYmxvY2spIHtcbiAgICBjb25zdCB7IHBhcnRzIH0gPSBmbGF0dGVuX3JlZmVyZW5jZSh2YWx1ZS5yYXdfZXhwcmVzc2lvbik7XG4gICAgbGV0IGtleXBhdGggPSBwYXJ0cy5qb2luKCcuJyk7XG4gICAgY29uc3QgY29udGV4dHMgPSBbXTtcbiAgICBjb25zdCBjb250ZXh0dWFsX2RlcGVuZGVuY2llcyA9IG5ldyBTZXQoKTtcbiAgICBjb25zdCB7IHRlbXBsYXRlX3Njb3BlIH0gPSB2YWx1ZS5leHByZXNzaW9uO1xuICAgIGNvbnN0IGFkZF9jb250ZXh0dWFsX2RlcGVuZGVuY3kgPSAoZGVwKSA9PiB7XG4gICAgICAgIGNvbnRleHR1YWxfZGVwZW5kZW5jaWVzLmFkZChkZXApO1xuICAgICAgICBjb25zdCBvd25lciA9IHRlbXBsYXRlX3Njb3BlLmdldF9vd25lcihkZXApO1xuICAgICAgICBpZiAob3duZXIudHlwZSA9PT0gJ0VhY2hCbG9jaycpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZGVwIG9mIG93bmVyLmV4cHJlc3Npb24uY29udGV4dHVhbF9kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICBhZGRfY29udGV4dHVhbF9kZXBlbmRlbmN5KGRlcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGZvciAoY29uc3QgZGVwIG9mIHZhbHVlLmV4cHJlc3Npb24uY29udGV4dHVhbF9kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgYWRkX2NvbnRleHR1YWxfZGVwZW5kZW5jeShkZXApO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGRlcCBvZiBjb250ZXh0dWFsX2RlcGVuZGVuY2llcykge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gYmxvY2suYmluZGluZ3MuZ2V0KGRlcCk7XG4gICAgICAgIGxldCBrZXk7XG4gICAgICAgIGxldCBuYW1lO1xuICAgICAgICBpZiAoY29udGV4dCkge1xuICAgICAgICAgICAga2V5ID0gY29udGV4dC5vYmplY3QubmFtZTtcbiAgICAgICAgICAgIG5hbWUgPSBjb250ZXh0LnByb3BlcnR5Lm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBrZXkgPSBkZXA7XG4gICAgICAgICAgICBuYW1lID0gZGVwO1xuICAgICAgICB9XG4gICAgICAgIGtleXBhdGggPSBgJHtrZXl9QCR7a2V5cGF0aH1gO1xuICAgICAgICBjb250ZXh0cy5wdXNoKG5hbWUpO1xuICAgIH1cbiAgICBpZiAoIXJlbmRlcmVyLmJpbmRpbmdfZ3JvdXBzLmhhcyhrZXlwYXRoKSkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHJlbmRlcmVyLmJpbmRpbmdfZ3JvdXBzLnNpemU7XG4gICAgICAgIGNvbnRleHRzLmZvckVhY2goY29udGV4dCA9PiB7XG4gICAgICAgICAgICByZW5kZXJlci5hZGRfdG9fY29udGV4dChjb250ZXh0LCB0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlbmRlcmVyLmJpbmRpbmdfZ3JvdXBzLnNldChrZXlwYXRoLCB7XG4gICAgICAgICAgICBiaW5kaW5nX2dyb3VwOiAodG9fcmVmZXJlbmNlID0gZmFsc2UpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgYmluZGluZ19ncm91cCA9ICckJGJpbmRpbmdfZ3JvdXBzJztcbiAgICAgICAgICAgICAgICBsZXQgX3NlY29uZGFyeV9pbmRleGVzID0gY29udGV4dHM7XG4gICAgICAgICAgICAgICAgaWYgKHRvX3JlZmVyZW5jZSkge1xuICAgICAgICAgICAgICAgICAgICBiaW5kaW5nX2dyb3VwID0gYmxvY2sucmVuZGVyZXIucmVmZXJlbmNlKGJpbmRpbmdfZ3JvdXApO1xuICAgICAgICAgICAgICAgICAgICBfc2Vjb25kYXJ5X2luZGV4ZXMgPSBfc2Vjb25kYXJ5X2luZGV4ZXMubWFwKG5hbWUgPT4gYmxvY2sucmVuZGVyZXIucmVmZXJlbmNlKG5hbWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKF9zZWNvbmRhcnlfaW5kZXhlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBvYmogPSB4IGAke2JpbmRpbmdfZ3JvdXB9WyR7aW5kZXh9XWA7XG4gICAgICAgICAgICAgICAgICAgIF9zZWNvbmRhcnlfaW5kZXhlcy5mb3JFYWNoKHNlY29uZGFyeV9pbmRleCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmogPSB4IGAke29ian1bJHtzZWNvbmRhcnlfaW5kZXh9XWA7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHggYCR7YmluZGluZ19ncm91cH1bJHtpbmRleH1dYDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNfY29udGV4dDogY29udGV4dHMubGVuZ3RoID4gMCxcbiAgICAgICAgICAgIGNvbnRleHRzLFxuICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICBrZXlwYXRoXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVuZGVyZXIuYmluZGluZ19ncm91cHMuZ2V0KGtleXBhdGgpO1xufVxuZnVuY3Rpb24gZ2V0X2V2ZW50X2hhbmRsZXIoYmluZGluZywgcmVuZGVyZXIsIGJsb2NrLCBuYW1lLCBsaHMpIHtcbiAgICBjb25zdCBjb250ZXh0dWFsX2RlcGVuZGVuY2llcyA9IG5ldyBTZXQoYmluZGluZy5ub2RlLmV4cHJlc3Npb24uY29udGV4dHVhbF9kZXBlbmRlbmNpZXMpO1xuICAgIGNvbnN0IGNvbnRleHQgPSBibG9jay5iaW5kaW5ncy5nZXQobmFtZSk7XG4gICAgbGV0IHNldF9zdG9yZTtcbiAgICBpZiAoY29udGV4dCkge1xuICAgICAgICBjb25zdCB7IG9iamVjdCwgcHJvcGVydHksIHN0b3JlLCBzbmlwcGV0IH0gPSBjb250ZXh0O1xuICAgICAgICBsaHMgPSByZXBsYWNlX29iamVjdChsaHMsIHNuaXBwZXQpO1xuICAgICAgICBjb250ZXh0dWFsX2RlcGVuZGVuY2llcy5hZGQob2JqZWN0Lm5hbWUpO1xuICAgICAgICBjb250ZXh0dWFsX2RlcGVuZGVuY2llcy5hZGQocHJvcGVydHkubmFtZSk7XG4gICAgICAgIGNvbnRleHR1YWxfZGVwZW5kZW5jaWVzLmRlbGV0ZShuYW1lKTtcbiAgICAgICAgaWYgKHN0b3JlKSB7XG4gICAgICAgICAgICBzZXRfc3RvcmUgPSBiIGAke3N0b3JlfS5zZXQoJHtgJCR7c3RvcmV9YH0pO2A7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IG9iamVjdCA9IGdldF9vYmplY3QobGhzKTtcbiAgICAgICAgaWYgKG9iamVjdC5uYW1lWzBdID09PSAnJCcpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gb2JqZWN0Lm5hbWUuc2xpY2UoMSk7XG4gICAgICAgICAgICBzZXRfc3RvcmUgPSBiIGAke3N0b3JlfS5zZXQoJHtvYmplY3QubmFtZX0pO2A7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSBnZXRfdmFsdWVfZnJvbV9kb20ocmVuZGVyZXIsIGJpbmRpbmcucGFyZW50LCBiaW5kaW5nLCBibG9jaywgY29udGV4dHVhbF9kZXBlbmRlbmNpZXMpO1xuICAgIGNvbnN0IG11dGF0aW9uID0gYiBgXG5cdFx0JHtsaHN9ID0gJHt2YWx1ZX07XG5cdFx0JHtzZXRfc3RvcmV9XG5cdGA7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdXNlc19jb250ZXh0OiBiaW5kaW5nLm5vZGUuaXNfY29udGV4dHVhbCB8fCBiaW5kaW5nLm5vZGUuZXhwcmVzc2lvbi51c2VzX2NvbnRleHQsXG4gICAgICAgIG11dGF0aW9uLFxuICAgICAgICBjb250ZXh0dWFsX2RlcGVuZGVuY2llcyxcbiAgICAgICAgbGhzXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldF92YWx1ZV9mcm9tX2RvbShyZW5kZXJlciwgZWxlbWVudCwgYmluZGluZywgYmxvY2ssIGNvbnRleHR1YWxfZGVwZW5kZW5jaWVzKSB7XG4gICAgY29uc3QgeyBub2RlIH0gPSBlbGVtZW50O1xuICAgIGNvbnN0IHsgbmFtZSB9ID0gYmluZGluZy5ub2RlO1xuICAgIGlmIChuYW1lID09PSAndGhpcycpIHtcbiAgICAgICAgcmV0dXJuIHggYCQkdmFsdWVgO1xuICAgIH1cbiAgICAvLyA8c2VsZWN0IGJpbmQ6dmFsdWU9J3NlbGVjdGVkPlxuICAgIGlmIChub2RlLm5hbWUgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgIHJldHVybiBub2RlLmdldF9zdGF0aWNfYXR0cmlidXRlX3ZhbHVlKCdtdWx0aXBsZScpID09PSB0cnVlID9cbiAgICAgICAgICAgIHggYEBzZWxlY3RfbXVsdGlwbGVfdmFsdWUodGhpcylgIDpcbiAgICAgICAgICAgIHggYEBzZWxlY3RfdmFsdWUodGhpcylgO1xuICAgIH1cbiAgICBjb25zdCB0eXBlID0gbm9kZS5nZXRfc3RhdGljX2F0dHJpYnV0ZV92YWx1ZSgndHlwZScpO1xuICAgIC8vIDxpbnB1dCB0eXBlPSdjaGVja2JveCcgYmluZDpncm91cD0nZm9vJz5cbiAgICBpZiAobmFtZSA9PT0gJ2dyb3VwJykge1xuICAgICAgICBpZiAodHlwZSA9PT0gJ2NoZWNrYm94Jykge1xuICAgICAgICAgICAgY29uc3QgeyBiaW5kaW5nX2dyb3VwLCBjb250ZXh0cyB9ID0gZ2V0X2JpbmRpbmdfZ3JvdXAocmVuZGVyZXIsIGJpbmRpbmcubm9kZSwgYmxvY2spO1xuICAgICAgICAgICAgYWRkX3RvX3NldChjb250ZXh0dWFsX2RlcGVuZGVuY2llcywgY29udGV4dHMpO1xuICAgICAgICAgICAgcmV0dXJuIHggYEBnZXRfYmluZGluZ19ncm91cF92YWx1ZSgke2JpbmRpbmdfZ3JvdXAoKX0sIHRoaXMuX192YWx1ZSwgdGhpcy5jaGVja2VkKWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHggYHRoaXMuX192YWx1ZWA7XG4gICAgfVxuICAgIC8vIDxpbnB1dCB0eXBlPSdyYW5nZXxudW1iZXInIGJpbmQ6dmFsdWU+XG4gICAgaWYgKHR5cGUgPT09ICdyYW5nZScgfHwgdHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcmV0dXJuIHggYEB0b19udW1iZXIodGhpcy4ke25hbWV9KWA7XG4gICAgfVxuICAgIGlmICgobmFtZSA9PT0gJ2J1ZmZlcmVkJyB8fCBuYW1lID09PSAnc2Vla2FibGUnIHx8IG5hbWUgPT09ICdwbGF5ZWQnKSkge1xuICAgICAgICByZXR1cm4geCBgQHRpbWVfcmFuZ2VzX3RvX2FycmF5KHRoaXMuJHtuYW1lfSlgO1xuICAgIH1cbiAgICAvLyBldmVyeXRoaW5nIGVsc2VcbiAgICByZXR1cm4geCBgdGhpcy4ke25hbWV9YDtcbn1cblxuZnVuY3Rpb24gY29tcGFyZV9ub2RlKGEsIGIpIHtcbiAgICBpZiAoYSA9PT0gYilcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgaWYgKCFhIHx8ICFiKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGEudHlwZSAhPT0gYi50eXBlKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgc3dpdGNoIChhLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnSWRlbnRpZmllcic6XG4gICAgICAgICAgICByZXR1cm4gYS5uYW1lID09PSBiLm5hbWU7XG4gICAgICAgIGNhc2UgJ01lbWJlckV4cHJlc3Npb24nOlxuICAgICAgICAgICAgcmV0dXJuIChjb21wYXJlX25vZGUoYS5vYmplY3QsIGIub2JqZWN0KSAmJlxuICAgICAgICAgICAgICAgIGNvbXBhcmVfbm9kZShhLnByb3BlcnR5LCBiLnByb3BlcnR5KSAmJlxuICAgICAgICAgICAgICAgIGEuY29tcHV0ZWQgPT09IGIuY29tcHV0ZWQpO1xuICAgICAgICBjYXNlICdMaXRlcmFsJzpcbiAgICAgICAgICAgIHJldHVybiBhLnZhbHVlID09PSBiLnZhbHVlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gYmluZF90aGlzKGNvbXBvbmVudCwgYmxvY2ssIGJpbmRpbmcsIHZhcmlhYmxlKSB7XG4gICAgY29uc3QgZm4gPSBjb21wb25lbnQuZ2V0X3VuaXF1ZV9uYW1lKGAke3ZhcmlhYmxlLm5hbWV9X2JpbmRpbmdgKTtcbiAgICBibG9jay5yZW5kZXJlci5hZGRfdG9fY29udGV4dChmbi5uYW1lKTtcbiAgICBjb25zdCBjYWxsZWUgPSBibG9jay5yZW5kZXJlci5yZWZlcmVuY2UoZm4ubmFtZSk7XG4gICAgY29uc3QgeyBjb250ZXh0dWFsX2RlcGVuZGVuY2llcywgbXV0YXRpb24gfSA9IGJpbmRpbmcuaGFuZGxlcjtcbiAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBiaW5kaW5nLmdldF91cGRhdGVfZGVwZW5kZW5jaWVzKCk7XG4gICAgY29uc3QgYm9keSA9IGIgYFxuXHRcdCR7bXV0YXRpb259XG5cdFx0JHtBcnJheS5mcm9tKGRlcGVuZGVuY2llcylcbiAgICAgICAgLmZpbHRlcihkZXAgPT4gZGVwWzBdICE9PSAnJCcpXG4gICAgICAgIC5maWx0ZXIoZGVwID0+ICFjb250ZXh0dWFsX2RlcGVuZGVuY2llcy5oYXMoZGVwKSlcbiAgICAgICAgLm1hcChkZXAgPT4gYiBgJHtibG9jay5yZW5kZXJlci5pbnZhbGlkYXRlKGRlcCl9O2ApfVxuXHRgO1xuICAgIGlmIChjb250ZXh0dWFsX2RlcGVuZGVuY2llcy5zaXplKSB7XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IEFycmF5LmZyb20oY29udGV4dHVhbF9kZXBlbmRlbmNpZXMpLm1hcChuYW1lID0+ICh7XG4gICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICBuYW1lXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29tcG9uZW50LnBhcnRseV9ob2lzdGVkLnB1c2goYiBgXG5cdFx0XHRmdW5jdGlvbiAke2ZufSgkJHZhbHVlLCAke3BhcmFtc30pIHtcblx0XHRcdFx0QGJpbmRpbmdfY2FsbGJhY2tzWyQkdmFsdWUgPyAndW5zaGlmdCcgOiAncHVzaCddKCgpID0+IHtcblx0XHRcdFx0XHQke2JvZHl9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdGApO1xuICAgICAgICBjb25zdCBhbGlhc19tYXAgPSBuZXcgTWFwKCk7XG4gICAgICAgIGNvbnN0IGFyZ3MgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaWQgb2YgcGFyYW1zKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGJsb2NrLnJlbmRlcmVyLnJlZmVyZW5jZShpZC5uYW1lKTtcbiAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKGJsb2NrLnZhcmlhYmxlcy5oYXMoaWQubmFtZSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgYWxpYXMgPSBpZC5uYW1lO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBibG9jay52YXJpYWJsZXMuaGFzKGFsaWFzKSAmJiAhY29tcGFyZV9ub2RlKGJsb2NrLnZhcmlhYmxlcy5nZXQoYWxpYXMpLmluaXQsIHZhbHVlKTsgYWxpYXMgPSBgJHtpZC5uYW1lfV8ke2krK31gKVxuICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgYWxpYXNfbWFwLnNldChhbGlhcywgaWQubmFtZSk7XG4gICAgICAgICAgICAgICAgaWQgPSB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogYWxpYXMgfTtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IGJsb2NrLnZhcmlhYmxlcy5oYXMoYWxpYXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXJncy5wdXNoKGlkKTtcbiAgICAgICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgICAgICBibG9jay5hZGRfdmFyaWFibGUoaWQsIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhc3NpZ24gPSBibG9jay5nZXRfdW5pcXVlX25hbWUoYGFzc2lnbl8ke3ZhcmlhYmxlLm5hbWV9YCk7XG4gICAgICAgIGNvbnN0IHVuYXNzaWduID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGB1bmFzc2lnbl8ke3ZhcmlhYmxlLm5hbWV9YCk7XG4gICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRjb25zdCAke2Fzc2lnbn0gPSAoKSA9PiAke2NhbGxlZX0oJHt2YXJpYWJsZX0sICR7YXJnc30pO1xuXHRcdFx0Y29uc3QgJHt1bmFzc2lnbn0gPSAoKSA9PiAke2NhbGxlZX0obnVsbCwgJHthcmdzfSk7XG5cdFx0YCk7XG4gICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IEFycmF5LmZyb20oYXJncylcbiAgICAgICAgICAgIC5tYXAobmFtZSA9PiB4IGAke25hbWV9ICE9PSAke2Jsb2NrLnJlbmRlcmVyLnJlZmVyZW5jZShhbGlhc19tYXAuZ2V0KG5hbWUubmFtZSkgfHwgbmFtZS5uYW1lKX1gKVxuICAgICAgICAgICAgLnJlZHVjZSgobGhzLCByaHMpID0+IHggYCR7bGhzfSB8fCAke3Joc31gKTtcbiAgICAgICAgLy8gd2UgcHVzaCB1bmFzc2lnbiBhbmQgdW5zaGlmdCBhc3NpZ24gc28gdGhhdCByZWZlcmVuY2VzIGFyZVxuICAgICAgICAvLyBudWxsZWQgb3V0IGJlZm9yZSB0aGV5J3JlIGNyZWF0ZWQsIHRvIGF2b2lkIGdsaXRjaGVzXG4gICAgICAgIC8vIHdpdGggc2hpZnRpbmcgaW5kaWNlc1xuICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHRpZiAoJHtjb25kaXRpb259KSB7XG5cdFx0XHRcdCR7dW5hc3NpZ259KCk7XG5cdFx0XHRcdCR7YXJncy5tYXAoYSA9PiBiIGAke2F9ID0gJHtibG9jay5yZW5kZXJlci5yZWZlcmVuY2UoYWxpYXNfbWFwLmdldChhLm5hbWUpIHx8IGEubmFtZSl9YCl9O1xuXHRcdFx0XHQke2Fzc2lnbn0oKTtcblx0XHRcdH1gKTtcbiAgICAgICAgYmxvY2suY2h1bmtzLmRlc3Ryb3kucHVzaChiIGAke3VuYXNzaWdufSgpO2ApO1xuICAgICAgICByZXR1cm4gYiBgJHthc3NpZ259KCk7YDtcbiAgICB9XG4gICAgY29tcG9uZW50LnBhcnRseV9ob2lzdGVkLnB1c2goYiBgXG5cdFx0ZnVuY3Rpb24gJHtmbn0oJCR2YWx1ZSkge1xuXHRcdFx0QGJpbmRpbmdfY2FsbGJhY2tzWyQkdmFsdWUgPyAndW5zaGlmdCcgOiAncHVzaCddKCgpID0+IHtcblx0XHRcdFx0JHtib2R5fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHRgKTtcbiAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYCR7Y2FsbGVlfShudWxsKTtgKTtcbiAgICByZXR1cm4gYiBgJHtjYWxsZWV9KCR7dmFyaWFibGV9KTtgO1xufVxuXG5jbGFzcyBUYWckMSBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlKSB7XG4gICAgICAgIHN1cGVyKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlKTtcbiAgICAgICAgdGhpcy5jYW5ub3RfdXNlX2lubmVyaHRtbCgpO1xuICAgICAgICBpZiAoIXRoaXMuaXNfZGVwZW5kZW5jaWVzX3N0YXRpYygpKSB7XG4gICAgICAgICAgICB0aGlzLm5vdF9zdGF0aWNfY29udGVudCgpO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmFkZF9kZXBlbmRlbmNpZXMobm9kZS5leHByZXNzaW9uLmRlcGVuZGVuY2llcyk7XG4gICAgfVxuICAgIGlzX2RlcGVuZGVuY2llc19zdGF0aWMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5vZGUuZXhwcmVzc2lvbi5jb250ZXh0dWFsX2RlcGVuZGVuY2llcy5zaXplID09PSAwICYmIHRoaXMubm9kZS5leHByZXNzaW9uLmR5bmFtaWNfZGVwZW5kZW5jaWVzKCkubGVuZ3RoID09PSAwO1xuICAgIH1cbiAgICByZW5hbWVfdGhpc19tZXRob2QoYmxvY2ssIHVwZGF0ZSkge1xuICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSB0aGlzLm5vZGUuZXhwcmVzc2lvbi5keW5hbWljX2RlcGVuZGVuY2llcygpO1xuICAgICAgICBsZXQgc25pcHBldCA9IHRoaXMubm9kZS5leHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMubm9kZS5zaG91bGRfY2FjaGUgJiYgYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke3RoaXMudmFyLm5hbWV9X3ZhbHVlYCk7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLm5vZGUuc2hvdWxkX2NhY2hlID8gdmFsdWUgOiBzbmlwcGV0O1xuICAgICAgICBzbmlwcGV0ID0geCBgJHtzbmlwcGV0fSArIFwiXCJgO1xuICAgICAgICBpZiAodGhpcy5ub2RlLnNob3VsZF9jYWNoZSlcbiAgICAgICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZSh2YWx1ZSwgc25pcHBldCk7IC8vIFRPRE8gbWF5IG5lZWQgdG8gY29lcmNlIHNuaXBwZXQgdG8gc3RyaW5nXG4gICAgICAgIGlmIChkZXBlbmRlbmNpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbGV0IGNvbmRpdGlvbiA9IGJsb2NrLnJlbmRlcmVyLmRpcnR5KGRlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICBpZiAoYmxvY2suaGFzX291dHJvcykge1xuICAgICAgICAgICAgICAgIGNvbmRpdGlvbiA9IHggYCEjY3VycmVudCB8fCAke2NvbmRpdGlvbn1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdXBkYXRlX2NhY2hlZF92YWx1ZSA9IHggYCR7dmFsdWV9ICE9PSAoJHt2YWx1ZX0gPSAke3NuaXBwZXR9KWA7XG4gICAgICAgICAgICBpZiAodGhpcy5ub2RlLnNob3VsZF9jYWNoZSkge1xuICAgICAgICAgICAgICAgIGNvbmRpdGlvbiA9IHggYCR7Y29uZGl0aW9ufSAmJiAke3VwZGF0ZV9jYWNoZWRfdmFsdWV9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBpZiAoJHtjb25kaXRpb259KSAke3VwZGF0ZShjb250ZW50KX1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBpbml0OiBjb250ZW50IH07XG4gICAgfVxufVxuXG5jbGFzcyBNdXN0YWNoZVRhZ1dyYXBwZXIgZXh0ZW5kcyBUYWckMSB7XG4gICAgY29uc3RydWN0b3IocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpIHtcbiAgICAgICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpO1xuICAgICAgICB0aGlzLnZhciA9IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiAndCcgfTtcbiAgICB9XG4gICAgcmVuZGVyKGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKSB7XG4gICAgICAgIGNvbnN0IHsgaW5pdCB9ID0gdGhpcy5yZW5hbWVfdGhpc19tZXRob2QoYmxvY2ssIHZhbHVlID0+IHggYEBzZXRfZGF0YSgke3RoaXMudmFyfSwgJHt2YWx1ZX0pYCk7XG4gICAgICAgIGJsb2NrLmFkZF9lbGVtZW50KHRoaXMudmFyLCB4IGBAdGV4dCgke2luaXR9KWAsIHBhcmVudF9ub2RlcyAmJiB4IGBAY2xhaW1fdGV4dCgke3BhcmVudF9ub2Rlc30sICR7aW5pdH0pYCwgcGFyZW50X25vZGUpO1xuICAgIH1cbn1cblxuY2xhc3MgUmF3TXVzdGFjaGVUYWdXcmFwcGVyIGV4dGVuZHMgVGFnJDEge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlKSB7XG4gICAgICAgIHN1cGVyKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlKTtcbiAgICAgICAgdGhpcy52YXIgPSB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogJ3JhdycgfTtcbiAgICAgICAgdGhpcy5jYW5ub3RfdXNlX2lubmVyaHRtbCgpO1xuICAgICAgICB0aGlzLm5vdF9zdGF0aWNfY29udGVudCgpO1xuICAgIH1cbiAgICByZW5kZXIoYmxvY2ssIHBhcmVudF9ub2RlLCBfcGFyZW50X25vZGVzKSB7XG4gICAgICAgIGNvbnN0IGluX2hlYWQgPSBpc19oZWFkKHBhcmVudF9ub2RlKTtcbiAgICAgICAgY29uc3QgY2FuX3VzZV9pbm5lcmh0bWwgPSAhaW5faGVhZCAmJiBwYXJlbnRfbm9kZSAmJiAhdGhpcy5wcmV2ICYmICF0aGlzLm5leHQ7XG4gICAgICAgIGlmIChjYW5fdXNlX2lubmVyaHRtbCkge1xuICAgICAgICAgICAgY29uc3QgaW5zZXJ0ID0gY29udGVudCA9PiBiIGAke3BhcmVudF9ub2RlfS5pbm5lckhUTUwgPSAke2NvbnRlbnR9O2BbMF07XG4gICAgICAgICAgICBjb25zdCB7IGluaXQgfSA9IHRoaXMucmVuYW1lX3RoaXNfbWV0aG9kKGJsb2NrLCBjb250ZW50ID0+IGluc2VydChjb250ZW50KSk7XG4gICAgICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChpbnNlcnQoaW5pdCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbmVlZHNfYW5jaG9yID0gaW5faGVhZCB8fCAodGhpcy5uZXh0ID8gIXRoaXMubmV4dC5pc19kb21fbm9kZSgpIDogKCF0aGlzLnBhcmVudCB8fCAhdGhpcy5wYXJlbnQuaXNfZG9tX25vZGUoKSkpO1xuICAgICAgICAgICAgY29uc3QgaHRtbF90YWcgPSBibG9jay5nZXRfdW5pcXVlX25hbWUoJ2h0bWxfdGFnJyk7XG4gICAgICAgICAgICBjb25zdCBodG1sX2FuY2hvciA9IG5lZWRzX2FuY2hvciAmJiBibG9jay5nZXRfdW5pcXVlX25hbWUoJ2h0bWxfYW5jaG9yJyk7XG4gICAgICAgICAgICBibG9jay5hZGRfdmFyaWFibGUoaHRtbF90YWcpO1xuICAgICAgICAgICAgY29uc3QgeyBpbml0IH0gPSB0aGlzLnJlbmFtZV90aGlzX21ldGhvZChibG9jaywgY29udGVudCA9PiB4IGAke2h0bWxfdGFnfS5wKCR7Y29udGVudH0pYCk7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVfYW5jaG9yID0gbmVlZHNfYW5jaG9yID8gaHRtbF9hbmNob3IgOiB0aGlzLm5leHQgPyB0aGlzLm5leHQudmFyIDogJ251bGwnO1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYCR7aHRtbF90YWd9ID0gbmV3IEBIdG1sVGFnKCk7YCk7XG4gICAgICAgICAgICBpZiAodGhpcy5yZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUpIHtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuY2xhaW0ucHVzaChiIGAke2h0bWxfdGFnfSA9IEBjbGFpbV9odG1sX3RhZygke19wYXJlbnRfbm9kZXN9KTtgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5oeWRyYXRlLnB1c2goYiBgJHtodG1sX3RhZ30uYSA9ICR7dXBkYXRlX2FuY2hvcn07YCk7XG4gICAgICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChiIGAke2h0bWxfdGFnfS5tKCR7aW5pdH0sICR7cGFyZW50X25vZGUgfHwgJyN0YXJnZXQnfSwgJHtwYXJlbnRfbm9kZSA/IG51bGwgOiAnI2FuY2hvcid9KTtgKTtcbiAgICAgICAgICAgIGlmIChuZWVkc19hbmNob3IpIHtcbiAgICAgICAgICAgICAgICBibG9jay5hZGRfZWxlbWVudChodG1sX2FuY2hvciwgeCBgQGVtcHR5KClgLCB4IGBAZW1wdHkoKWAsIHBhcmVudF9ub2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcGFyZW50X25vZGUgfHwgaW5faGVhZCkge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5kZXN0cm95LnB1c2goYiBgaWYgKGRldGFjaGluZykgJHtodG1sX3RhZ30uZCgpO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5jb25zdCBldmVudHMgPSBbXG4gICAge1xuICAgICAgICBldmVudF9uYW1lczogWydpbnB1dCddLFxuICAgICAgICBmaWx0ZXI6IChub2RlLCBfbmFtZSkgPT4gbm9kZS5uYW1lID09PSAndGV4dGFyZWEnIHx8XG4gICAgICAgICAgICBub2RlLm5hbWUgPT09ICdpbnB1dCcgJiYgIS9yYWRpb3xjaGVja2JveHxyYW5nZXxmaWxlLy50ZXN0KG5vZGUuZ2V0X3N0YXRpY19hdHRyaWJ1dGVfdmFsdWUoJ3R5cGUnKSlcbiAgICB9LFxuICAgIHtcbiAgICAgICAgZXZlbnRfbmFtZXM6IFsnaW5wdXQnXSxcbiAgICAgICAgZmlsdGVyOiAobm9kZSwgbmFtZSkgPT4gKG5hbWUgPT09ICd0ZXh0Q29udGVudCcgfHwgbmFtZSA9PT0gJ2lubmVySFRNTCcpICYmXG4gICAgICAgICAgICBub2RlLmF0dHJpYnV0ZXMuc29tZShhdHRyaWJ1dGUgPT4gYXR0cmlidXRlLm5hbWUgPT09ICdjb250ZW50ZWRpdGFibGUnKVxuICAgIH0sXG4gICAge1xuICAgICAgICBldmVudF9uYW1lczogWydjaGFuZ2UnXSxcbiAgICAgICAgZmlsdGVyOiAobm9kZSwgX25hbWUpID0+IG5vZGUubmFtZSA9PT0gJ3NlbGVjdCcgfHxcbiAgICAgICAgICAgIG5vZGUubmFtZSA9PT0gJ2lucHV0JyAmJiAvcmFkaW98Y2hlY2tib3h8ZmlsZS8udGVzdChub2RlLmdldF9zdGF0aWNfYXR0cmlidXRlX3ZhbHVlKCd0eXBlJykpXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGV2ZW50X25hbWVzOiBbJ2NoYW5nZScsICdpbnB1dCddLFxuICAgICAgICBmaWx0ZXI6IChub2RlLCBfbmFtZSkgPT4gbm9kZS5uYW1lID09PSAnaW5wdXQnICYmIG5vZGUuZ2V0X3N0YXRpY19hdHRyaWJ1dGVfdmFsdWUoJ3R5cGUnKSA9PT0gJ3JhbmdlJ1xuICAgIH0sXG4gICAge1xuICAgICAgICBldmVudF9uYW1lczogWydlbGVtZW50cmVzaXplJ10sXG4gICAgICAgIGZpbHRlcjogKF9ub2RlLCBuYW1lKSA9PiBkaW1lbnNpb25zLnRlc3QobmFtZSlcbiAgICB9LFxuICAgIC8vIG1lZGlhIGV2ZW50c1xuICAgIHtcbiAgICAgICAgZXZlbnRfbmFtZXM6IFsndGltZXVwZGF0ZSddLFxuICAgICAgICBmaWx0ZXI6IChub2RlLCBuYW1lKSA9PiBub2RlLmlzX21lZGlhX25vZGUoKSAmJlxuICAgICAgICAgICAgKG5hbWUgPT09ICdjdXJyZW50VGltZScgfHwgbmFtZSA9PT0gJ3BsYXllZCcgfHwgbmFtZSA9PT0gJ2VuZGVkJylcbiAgICB9LFxuICAgIHtcbiAgICAgICAgZXZlbnRfbmFtZXM6IFsnZHVyYXRpb25jaGFuZ2UnXSxcbiAgICAgICAgZmlsdGVyOiAobm9kZSwgbmFtZSkgPT4gbm9kZS5pc19tZWRpYV9ub2RlKCkgJiZcbiAgICAgICAgICAgIG5hbWUgPT09ICdkdXJhdGlvbidcbiAgICB9LFxuICAgIHtcbiAgICAgICAgZXZlbnRfbmFtZXM6IFsncGxheScsICdwYXVzZSddLFxuICAgICAgICBmaWx0ZXI6IChub2RlLCBuYW1lKSA9PiBub2RlLmlzX21lZGlhX25vZGUoKSAmJlxuICAgICAgICAgICAgbmFtZSA9PT0gJ3BhdXNlZCdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgZXZlbnRfbmFtZXM6IFsncHJvZ3Jlc3MnXSxcbiAgICAgICAgZmlsdGVyOiAobm9kZSwgbmFtZSkgPT4gbm9kZS5pc19tZWRpYV9ub2RlKCkgJiZcbiAgICAgICAgICAgIG5hbWUgPT09ICdidWZmZXJlZCdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgZXZlbnRfbmFtZXM6IFsnbG9hZGVkbWV0YWRhdGEnXSxcbiAgICAgICAgZmlsdGVyOiAobm9kZSwgbmFtZSkgPT4gbm9kZS5pc19tZWRpYV9ub2RlKCkgJiZcbiAgICAgICAgICAgIChuYW1lID09PSAnYnVmZmVyZWQnIHx8IG5hbWUgPT09ICdzZWVrYWJsZScpXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGV2ZW50X25hbWVzOiBbJ3ZvbHVtZWNoYW5nZSddLFxuICAgICAgICBmaWx0ZXI6IChub2RlLCBuYW1lKSA9PiBub2RlLmlzX21lZGlhX25vZGUoKSAmJlxuICAgICAgICAgICAgKG5hbWUgPT09ICd2b2x1bWUnIHx8IG5hbWUgPT09ICdtdXRlZCcpXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGV2ZW50X25hbWVzOiBbJ3JhdGVjaGFuZ2UnXSxcbiAgICAgICAgZmlsdGVyOiAobm9kZSwgbmFtZSkgPT4gbm9kZS5pc19tZWRpYV9ub2RlKCkgJiZcbiAgICAgICAgICAgIG5hbWUgPT09ICdwbGF5YmFja1JhdGUnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGV2ZW50X25hbWVzOiBbJ3NlZWtpbmcnLCAnc2Vla2VkJ10sXG4gICAgICAgIGZpbHRlcjogKG5vZGUsIG5hbWUpID0+IG5vZGUuaXNfbWVkaWFfbm9kZSgpICYmXG4gICAgICAgICAgICAobmFtZSA9PT0gJ3NlZWtpbmcnKVxuICAgIH0sXG4gICAge1xuICAgICAgICBldmVudF9uYW1lczogWydlbmRlZCddLFxuICAgICAgICBmaWx0ZXI6IChub2RlLCBuYW1lKSA9PiBub2RlLmlzX21lZGlhX25vZGUoKSAmJlxuICAgICAgICAgICAgbmFtZSA9PT0gJ2VuZGVkJ1xuICAgIH0sXG4gICAge1xuICAgICAgICBldmVudF9uYW1lczogWydyZXNpemUnXSxcbiAgICAgICAgZmlsdGVyOiAobm9kZSwgbmFtZSkgPT4gbm9kZS5pc19tZWRpYV9ub2RlKCkgJiZcbiAgICAgICAgICAgIChuYW1lID09PSAndmlkZW9IZWlnaHQnIHx8IG5hbWUgPT09ICd2aWRlb1dpZHRoJylcbiAgICB9LFxuICAgIC8vIGRldGFpbHMgZXZlbnRcbiAgICB7XG4gICAgICAgIGV2ZW50X25hbWVzOiBbJ3RvZ2dsZSddLFxuICAgICAgICBmaWx0ZXI6IChub2RlLCBfbmFtZSkgPT4gbm9kZS5uYW1lID09PSAnZGV0YWlscydcbiAgICB9XG5dO1xuY2xhc3MgRWxlbWVudFdyYXBwZXIgZXh0ZW5kcyBXcmFwcGVyIHtcbiAgICBjb25zdHJ1Y3RvcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSwgc3RyaXBfd2hpdGVzcGFjZSwgbmV4dF9zaWJsaW5nKSB7XG4gICAgICAgIHN1cGVyKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlKTtcbiAgICAgICAgdGhpcy52YXIgPSB7XG4gICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICBuYW1lOiBub2RlLm5hbWUucmVwbGFjZSgvW15hLXpBLVowLTlfJF0vZywgJ18nKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnZvaWQgPSBpc192b2lkKG5vZGUubmFtZSk7XG4gICAgICAgIHRoaXMuY2xhc3NfZGVwZW5kZW5jaWVzID0gW107XG4gICAgICAgIGlmICh0aGlzLm5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLm5vZGUubGV0cy5mb3JFYWNoKGwgPT4ge1xuICAgICAgICAgICAgICAgIGV4dHJhY3RfbmFtZXMobC52YWx1ZSB8fCBsLm5hbWUpLmZvckVhY2gobmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLmFkZF90b19jb250ZXh0KG5hbWUsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gdGhpcy5ub2RlLmF0dHJpYnV0ZXMubWFwKGF0dHJpYnV0ZSA9PiB7XG4gICAgICAgICAgICBpZiAoYXR0cmlidXRlLm5hbWUgPT09ICdzdHlsZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0eWxlQXR0cmlidXRlV3JhcHBlcih0aGlzLCBibG9jaywgYXR0cmlidXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUudHlwZSA9PT0gJ1NwcmVhZCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNwcmVhZEF0dHJpYnV0ZVdyYXBwZXIodGhpcywgYmxvY2ssIGF0dHJpYnV0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEF0dHJpYnV0ZVdyYXBwZXIodGhpcywgYmxvY2ssIGF0dHJpYnV0ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBvcmRpbmFyaWx5LCB0aGVyZSdsbCBvbmx5IGJlIG9uZS4uLiBidXQgd2UgbmVlZCB0byBoYW5kbGVcbiAgICAgICAgLy8gdGhlIHJhcmUgY2FzZSB3aGVyZSBhbiBlbGVtZW50IGNhbiBoYXZlIG11bHRpcGxlIGJpbmRpbmdzLFxuICAgICAgICAvLyBlLmcuIDxhdWRpbyBiaW5kOnBhdXNlZCBiaW5kOmN1cnJlbnRUaW1lPlxuICAgICAgICB0aGlzLmJpbmRpbmdzID0gdGhpcy5ub2RlLmJpbmRpbmdzLm1hcChiaW5kaW5nID0+IG5ldyBCaW5kaW5nV3JhcHBlcihibG9jaywgYmluZGluZywgdGhpcykpO1xuICAgICAgICB0aGlzLmV2ZW50X2hhbmRsZXJzID0gdGhpcy5ub2RlLmhhbmRsZXJzLm1hcChldmVudF9oYW5kbGVyID0+IG5ldyBFdmVudEhhbmRsZXJXcmFwcGVyKGV2ZW50X2hhbmRsZXIsIHRoaXMpKTtcbiAgICAgICAgaWYgKG5vZGUuaW50cm8gfHwgbm9kZS5vdXRybykge1xuICAgICAgICAgICAgaWYgKG5vZGUuaW50cm8pXG4gICAgICAgICAgICAgICAgYmxvY2suYWRkX2ludHJvKG5vZGUuaW50cm8uaXNfbG9jYWwpO1xuICAgICAgICAgICAgaWYgKG5vZGUub3V0cm8pXG4gICAgICAgICAgICAgICAgYmxvY2suYWRkX291dHJvKG5vZGUub3V0cm8uaXNfbG9jYWwpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLmFuaW1hdGlvbikge1xuICAgICAgICAgICAgYmxvY2suYWRkX2FuaW1hdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGFkZCBkaXJlY3RpdmUgYW5kIGhhbmRsZXIgZGVwZW5kZW5jaWVzXG4gICAgICAgIFtub2RlLmFuaW1hdGlvbiwgbm9kZS5vdXRybywgLi4ubm9kZS5hY3Rpb25zLCAuLi5ub2RlLmNsYXNzZXMsIC4uLm5vZGUuc3R5bGVzXS5mb3JFYWNoKGRpcmVjdGl2ZSA9PiB7XG4gICAgICAgICAgICBpZiAoZGlyZWN0aXZlICYmIGRpcmVjdGl2ZS5leHByZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyhkaXJlY3RpdmUuZXhwcmVzc2lvbi5kZXBlbmRlbmNpZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgbm9kZS5oYW5kbGVycy5mb3JFYWNoKGhhbmRsZXIgPT4ge1xuICAgICAgICAgICAgaWYgKGhhbmRsZXIuZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgICAgIGJsb2NrLmFkZF9kZXBlbmRlbmNpZXMoaGFuZGxlci5leHByZXNzaW9uLmRlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHtcbiAgICAgICAgICAgIGlmIChub2RlLmFjdGlvbnMubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgICAgIG5vZGUuYW5pbWF0aW9uIHx8XG4gICAgICAgICAgICAgICAgbm9kZS5iaW5kaW5ncy5sZW5ndGggPiAwIHx8XG4gICAgICAgICAgICAgICAgbm9kZS5jbGFzc2VzLmxlbmd0aCA+IDAgfHxcbiAgICAgICAgICAgICAgICBub2RlLmludHJvIHx8IG5vZGUub3V0cm8gfHxcbiAgICAgICAgICAgICAgICBub2RlLmhhbmRsZXJzLmxlbmd0aCA+IDAgfHxcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUubmFtZSA9PT0gJ29wdGlvbicgfHxcbiAgICAgICAgICAgICAgICByZW5kZXJlci5vcHRpb25zLmRldikge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50LmNhbm5vdF91c2VfaW5uZXJodG1sKCk7IC8vIG5lZWQgdG8gdXNlIGFkZF9sb2NhdGlvblxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Lm5vdF9zdGF0aWNfY29udGVudCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZnJhZ21lbnQgPSBuZXcgRnJhZ21lbnRXcmFwcGVyKHJlbmRlcmVyLCBibG9jaywgbm9kZS5jaGlsZHJlbiwgdGhpcywgc3RyaXBfd2hpdGVzcGFjZSwgbmV4dF9zaWJsaW5nKTtcbiAgICB9XG4gICAgcmVuZGVyKGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKSB7XG4gICAgICAgIGNvbnN0IHsgcmVuZGVyZXIgfSA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLm5vZGUubmFtZSA9PT0gJ25vc2NyaXB0JylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMudmFyO1xuICAgICAgICBjb25zdCBub2RlcyA9IHBhcmVudF9ub2RlcyAmJiBibG9jay5nZXRfdW5pcXVlX25hbWUoYCR7dGhpcy52YXIubmFtZX1fbm9kZXNgKTsgLy8gaWYgd2UncmUgaW4gdW5jbGFpbWFibGUgdGVycml0b3J5LCBpLmUuIDxoZWFkPiwgcGFyZW50X25vZGVzIGlzIG51bGxcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSB4IGBAY2hpbGRyZW4oJHt0aGlzLm5vZGUubmFtZSA9PT0gJ3RlbXBsYXRlJyA/IHggYCR7bm9kZX0uY29udGVudGAgOiBub2RlfSlgO1xuICAgICAgICBibG9jay5hZGRfdmFyaWFibGUobm9kZSk7XG4gICAgICAgIGNvbnN0IHJlbmRlcl9zdGF0ZW1lbnQgPSB0aGlzLmdldF9yZW5kZXJfc3RhdGVtZW50KGJsb2NrKTtcbiAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYCR7bm9kZX0gPSAke3JlbmRlcl9zdGF0ZW1lbnR9O2ApO1xuICAgICAgICBpZiAocmVuZGVyZXIub3B0aW9ucy5oeWRyYXRhYmxlKSB7XG4gICAgICAgICAgICBpZiAocGFyZW50X25vZGVzKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNsYWltLnB1c2goYiBgXG5cdFx0XHRcdFx0JHtub2RlfSA9ICR7dGhpcy5nZXRfY2xhaW1fc3RhdGVtZW50KHBhcmVudF9ub2Rlcyl9O1xuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudm9pZCAmJiB0aGlzLm5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuY2xhaW0ucHVzaChiIGBcblx0XHRcdFx0XHRcdHZhciAke25vZGVzfSA9ICR7Y2hpbGRyZW59O1xuXHRcdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5jbGFpbS5wdXNoKGIgYCR7bm9kZX0gPSAke3JlbmRlcl9zdGF0ZW1lbnR9O2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJlbnRfbm9kZSkge1xuICAgICAgICAgICAgY29uc3QgYXBwZW5kID0gYiBgQGFwcGVuZCgke3BhcmVudF9ub2RlfSwgJHtub2RlfSk7YDtcbiAgICAgICAgICAgIGFwcGVuZFswXS5leHByZXNzaW9uLmNhbGxlZS5sb2MgPSB7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IHRoaXMucmVuZGVyZXIubG9jYXRlKHRoaXMubm9kZS5zdGFydCksXG4gICAgICAgICAgICAgICAgZW5kOiB0aGlzLnJlbmRlcmVyLmxvY2F0ZSh0aGlzLm5vZGUuZW5kKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5tb3VudC5wdXNoKGFwcGVuZCk7XG4gICAgICAgICAgICBpZiAoaXNfaGVhZChwYXJlbnRfbm9kZSkpIHtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYEBkZXRhY2goJHtub2RlfSk7YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpbnNlcnQgPSBiIGBAaW5zZXJ0KCN0YXJnZXQsICR7bm9kZX0sICNhbmNob3IpO2A7XG4gICAgICAgICAgICBpbnNlcnRbMF0uZXhwcmVzc2lvbi5jYWxsZWUubG9jID0ge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnJlbmRlcmVyLmxvY2F0ZSh0aGlzLm5vZGUuc3RhcnQpLFxuICAgICAgICAgICAgICAgIGVuZDogdGhpcy5yZW5kZXJlci5sb2NhdGUodGhpcy5ub2RlLmVuZClcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChpbnNlcnQpO1xuICAgICAgICAgICAgLy8gVE9ETyB3ZSBldmVudHVhbGx5IG5lZWQgdG8gY29uc2lkZXIgd2hhdCBoYXBwZW5zIHRvIGVsZW1lbnRzXG4gICAgICAgICAgICAvLyB0aGF0IGJlbG9uZyB0byB0aGUgc2FtZSBvdXRncm91cCBhcyBhbiBvdXRyb2luZyBlbGVtZW50Li4uXG4gICAgICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYGlmIChkZXRhY2hpbmcpIEBkZXRhY2goJHtub2RlfSk7YCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaW5zZXJ0IHN0YXRpYyBjaGlsZHJlbiB3aXRoIHRleHRDb250ZW50IG9yIGlubmVySFRNTFxuICAgICAgICBjb25zdCBjYW5fdXNlX3RleHRjb250ZW50ID0gdGhpcy5jYW5fdXNlX3RleHRjb250ZW50KCk7XG4gICAgICAgIGlmICghdGhpcy5ub2RlLm5hbWVzcGFjZSAmJiAodGhpcy5jYW5fdXNlX2lubmVyaHRtbCB8fCBjYW5fdXNlX3RleHRjb250ZW50KSAmJiB0aGlzLmZyYWdtZW50Lm5vZGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmZyYWdtZW50Lm5vZGVzLmxlbmd0aCA9PT0gMSAmJiB0aGlzLmZyYWdtZW50Lm5vZGVzWzBdLm5vZGUudHlwZSA9PT0gJ1RleHQnKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYCR7bm9kZX0udGV4dENvbnRlbnQgPSAke3N0cmluZ19saXRlcmFsKHRoaXMuZnJhZ21lbnQubm9kZXNbMF0uZGF0YSl9O2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB7XG4gICAgICAgICAgICAgICAgICAgIHF1YXNpOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVGVtcGxhdGVFbGVtZW50JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB7IHJhdzogJycgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25zdCBsaXRlcmFsID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVGVtcGxhdGVMaXRlcmFsJyxcbiAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnM6IFtdLFxuICAgICAgICAgICAgICAgICAgICBxdWFzaXM6IFtdXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYW5fdXNlX3Jhd190ZXh0ID0gIXRoaXMuY2FuX3VzZV9pbm5lcmh0bWwgJiYgY2FuX3VzZV90ZXh0Y29udGVudDtcbiAgICAgICAgICAgICAgICB0b19odG1sKHRoaXMuZnJhZ21lbnQubm9kZXMsIGJsb2NrLCBsaXRlcmFsLCBzdGF0ZSwgY2FuX3VzZV9yYXdfdGV4dCk7XG4gICAgICAgICAgICAgICAgbGl0ZXJhbC5xdWFzaXMucHVzaChzdGF0ZS5xdWFzaSk7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYCR7bm9kZX0uJHt0aGlzLmNhbl91c2VfaW5uZXJodG1sID8gJ2lubmVySFRNTCcgOiAndGV4dENvbnRlbnQnfSA9ICR7bGl0ZXJhbH07YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZyYWdtZW50Lm5vZGVzLmZvckVhY2goKGNoaWxkKSA9PiB7XG4gICAgICAgICAgICAgICAgY2hpbGQucmVuZGVyKGJsb2NrLCB0aGlzLm5vZGUubmFtZSA9PT0gJ3RlbXBsYXRlJyA/IHggYCR7bm9kZX0uY29udGVudGAgOiBub2RlLCBub2Rlcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBldmVudF9oYW5kbGVyX29yX2JpbmRpbmdfdXNlc19jb250ZXh0ID0gKHRoaXMuYmluZGluZ3Muc29tZShiaW5kaW5nID0+IGJpbmRpbmcuaGFuZGxlci51c2VzX2NvbnRleHQpIHx8XG4gICAgICAgICAgICB0aGlzLm5vZGUuaGFuZGxlcnMuc29tZShoYW5kbGVyID0+IGhhbmRsZXIudXNlc19jb250ZXh0KSB8fFxuICAgICAgICAgICAgdGhpcy5ub2RlLmFjdGlvbnMuc29tZShhY3Rpb24gPT4gYWN0aW9uLnVzZXNfY29udGV4dCkpO1xuICAgICAgICBpZiAoZXZlbnRfaGFuZGxlcl9vcl9iaW5kaW5nX3VzZXNfY29udGV4dCkge1xuICAgICAgICAgICAgYmxvY2subWFpbnRhaW5fY29udGV4dCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hZGRfYXR0cmlidXRlcyhibG9jayk7XG4gICAgICAgIHRoaXMuYWRkX2RpcmVjdGl2ZXNfaW5fb3JkZXIoYmxvY2spO1xuICAgICAgICB0aGlzLmFkZF90cmFuc2l0aW9ucyhibG9jayk7XG4gICAgICAgIHRoaXMuYWRkX2FuaW1hdGlvbihibG9jayk7XG4gICAgICAgIHRoaXMuYWRkX2NsYXNzZXMoYmxvY2spO1xuICAgICAgICB0aGlzLmFkZF9zdHlsZXMoYmxvY2spO1xuICAgICAgICB0aGlzLmFkZF9tYW51YWxfc3R5bGVfc2NvcGluZyhibG9jayk7XG4gICAgICAgIGlmIChub2RlcyAmJiB0aGlzLnJlbmRlcmVyLm9wdGlvbnMuaHlkcmF0YWJsZSAmJiAhdGhpcy52b2lkKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuY2xhaW0ucHVzaChiIGAke3RoaXMubm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwID8gbm9kZXMgOiBjaGlsZHJlbn0uZm9yRWFjaChAZGV0YWNoKTtgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVuZGVyZXIub3B0aW9ucy5kZXYpIHtcbiAgICAgICAgICAgIGNvbnN0IGxvYyA9IHJlbmRlcmVyLmxvY2F0ZSh0aGlzLm5vZGUuc3RhcnQpO1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmh5ZHJhdGUucHVzaChiIGBAYWRkX2xvY2F0aW9uKCR7dGhpcy52YXJ9LCAke3JlbmRlcmVyLmZpbGVfdmFyfSwgJHtsb2MubGluZSAtIDF9LCAke2xvYy5jb2x1bW59LCAke3RoaXMubm9kZS5zdGFydH0pO2ApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhbl91c2VfdGV4dGNvbnRlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzX3N0YXRpY19jb250ZW50ICYmIHRoaXMuZnJhZ21lbnQubm9kZXMuZXZlcnkobm9kZSA9PiBub2RlLm5vZGUudHlwZSA9PT0gJ1RleHQnIHx8IG5vZGUubm9kZS50eXBlID09PSAnTXVzdGFjaGVUYWcnKTtcbiAgICB9XG4gICAgZ2V0X3JlbmRlcl9zdGF0ZW1lbnQoYmxvY2spIHtcbiAgICAgICAgY29uc3QgeyBuYW1lLCBuYW1lc3BhY2UgfSA9IHRoaXMubm9kZTtcbiAgICAgICAgaWYgKG5hbWVzcGFjZSA9PT0gbmFtZXNwYWNlcy5zdmcpIHtcbiAgICAgICAgICAgIHJldHVybiB4IGBAc3ZnX2VsZW1lbnQoXCIke25hbWV9XCIpYDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmFtZXNwYWNlKSB7XG4gICAgICAgICAgICByZXR1cm4geCBgQF9kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCIke25hbWVzcGFjZX1cIiwgXCIke25hbWV9XCIpYDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpcyA9IHRoaXMuYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5ub2RlLm5hbWUgPT09ICdpcycpO1xuICAgICAgICBpZiAoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiB4IGBAZWxlbWVudF9pcyhcIiR7bmFtZX1cIiwgJHtpcy5yZW5kZXJfY2h1bmtzKGJsb2NrKS5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30gKyAke3Joc31gKX0pYDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geCBgQGVsZW1lbnQoXCIke25hbWV9XCIpYDtcbiAgICB9XG4gICAgZ2V0X2NsYWltX3N0YXRlbWVudChub2Rlcykge1xuICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzXG4gICAgICAgICAgICAuZmlsdGVyKChhdHRyKSA9PiAhKGF0dHIgaW5zdGFuY2VvZiBTcHJlYWRBdHRyaWJ1dGVXcmFwcGVyKSAmJiAhYXR0ci5wcm9wZXJ0eV9uYW1lKVxuICAgICAgICAgICAgLm1hcCgoYXR0cikgPT4gcCBgJHthdHRyLm5hbWV9OiB0cnVlYCk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSB0aGlzLm5vZGUubmFtZXNwYWNlXG4gICAgICAgICAgICA/IHRoaXMubm9kZS5uYW1lXG4gICAgICAgICAgICA6IHRoaXMubm9kZS5uYW1lLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIGlmICh0aGlzLm5vZGUubmFtZXNwYWNlID09PSBuYW1lc3BhY2VzLnN2Zykge1xuICAgICAgICAgICAgcmV0dXJuIHggYEBjbGFpbV9zdmdfZWxlbWVudCgke25vZGVzfSwgXCIke25hbWV9XCIsIHsgJHthdHRyaWJ1dGVzfSB9KWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4geCBgQGNsYWltX2VsZW1lbnQoJHtub2Rlc30sIFwiJHtuYW1lfVwiLCB7ICR7YXR0cmlidXRlc30gfSlgO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFkZF9kaXJlY3RpdmVzX2luX29yZGVyKGJsb2NrKSB7XG4gICAgICAgIGNvbnN0IGJpbmRpbmdfZ3JvdXBzID0gZXZlbnRzXG4gICAgICAgICAgICAubWFwKGV2ZW50ID0+ICh7XG4gICAgICAgICAgICBldmVudHM6IGV2ZW50LmV2ZW50X25hbWVzLFxuICAgICAgICAgICAgYmluZGluZ3M6IHRoaXMuYmluZGluZ3NcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGJpbmRpbmcgPT4gYmluZGluZy5ub2RlLm5hbWUgIT09ICd0aGlzJylcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGJpbmRpbmcgPT4gZXZlbnQuZmlsdGVyKHRoaXMubm9kZSwgYmluZGluZy5ub2RlLm5hbWUpKVxuICAgICAgICB9KSlcbiAgICAgICAgICAgIC5maWx0ZXIoZ3JvdXAgPT4gZ3JvdXAuYmluZGluZ3MubGVuZ3RoKTtcbiAgICAgICAgY29uc3QgdGhpc19iaW5kaW5nID0gdGhpcy5iaW5kaW5ncy5maW5kKGIgPT4gYi5ub2RlLm5hbWUgPT09ICd0aGlzJyk7XG4gICAgICAgIGZ1bmN0aW9uIGdldE9yZGVyKGl0ZW0pIHtcbiAgICAgICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgRXZlbnRIYW5kbGVyV3JhcHBlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLm5vZGUuc3RhcnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpdGVtIGluc3RhbmNlb2YgQmluZGluZ1dyYXBwZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5ub2RlLnN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXRlbSBpbnN0YW5jZW9mIEFjdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uYmluZGluZ3NbMF0ubm9kZS5zdGFydDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBbXG4gICAgICAgICAgICAuLi5iaW5kaW5nX2dyb3VwcyxcbiAgICAgICAgICAgIC4uLnRoaXMuZXZlbnRfaGFuZGxlcnMsXG4gICAgICAgICAgICB0aGlzX2JpbmRpbmcsXG4gICAgICAgICAgICAuLi50aGlzLm5vZGUuYWN0aW9uc1xuICAgICAgICBdXG4gICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gZ2V0T3JkZXIoYSkgLSBnZXRPcmRlcihiKSlcbiAgICAgICAgICAgIC5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBFdmVudEhhbmRsZXJXcmFwcGVyKSB7XG4gICAgICAgICAgICAgICAgYWRkX2V2ZW50X2hhbmRsZXIoYmxvY2ssIHRoaXMudmFyLCBpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0gaW5zdGFuY2VvZiBCaW5kaW5nV3JhcHBlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkX3RoaXNfYmluZGluZyhibG9jaywgaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpdGVtIGluc3RhbmNlb2YgQWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgYWRkX2FjdGlvbihibG9jaywgdGhpcy52YXIsIGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRfYmluZGluZ3MoYmxvY2ssIGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWRkX2JpbmRpbmdzKGJsb2NrLCBiaW5kaW5nX2dyb3VwKSB7XG4gICAgICAgIGNvbnN0IHsgcmVuZGVyZXIgfSA9IHRoaXM7XG4gICAgICAgIGlmIChiaW5kaW5nX2dyb3VwLmJpbmRpbmdzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgcmVuZGVyZXIuY29tcG9uZW50Lmhhc19yZWFjdGl2ZV9hc3NpZ25tZW50cyA9IHRydWU7XG4gICAgICAgIGNvbnN0IGxvY2sgPSBiaW5kaW5nX2dyb3VwLmJpbmRpbmdzLnNvbWUoYmluZGluZyA9PiBiaW5kaW5nLm5lZWRzX2xvY2spID9cbiAgICAgICAgICAgIGJsb2NrLmdldF91bmlxdWVfbmFtZShgJHt0aGlzLnZhci5uYW1lfV91cGRhdGluZ2ApIDpcbiAgICAgICAgICAgIG51bGw7XG4gICAgICAgIGlmIChsb2NrKVxuICAgICAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKGxvY2ssIHggYGZhbHNlYCk7XG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSByZW5kZXJlci5jb21wb25lbnQuZ2V0X3VuaXF1ZV9uYW1lKGAke3RoaXMudmFyLm5hbWV9XyR7YmluZGluZ19ncm91cC5ldmVudHMuam9pbignXycpfV9oYW5kbGVyYCk7XG4gICAgICAgIHJlbmRlcmVyLmFkZF90b19jb250ZXh0KGhhbmRsZXIubmFtZSk7XG4gICAgICAgIC8vIFRPRE8gZmlndXJlIG91dCBob3cgdG8gaGFuZGxlIGxvY2tzXG4gICAgICAgIGNvbnN0IG5lZWRzX2xvY2sgPSBiaW5kaW5nX2dyb3VwLmJpbmRpbmdzLnNvbWUoYmluZGluZyA9PiBiaW5kaW5nLm5lZWRzX2xvY2spO1xuICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIGNvbnN0IGNvbnRleHR1YWxfZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgICAgICBiaW5kaW5nX2dyb3VwLmJpbmRpbmdzLmZvckVhY2goYmluZGluZyA9PiB7XG4gICAgICAgICAgICAvLyBUT0RPIHRoaXMgaXMgYSBtZXNzXG4gICAgICAgICAgICBhZGRfdG9fc2V0KGRlcGVuZGVuY2llcywgYmluZGluZy5nZXRfdXBkYXRlX2RlcGVuZGVuY2llcygpKTtcbiAgICAgICAgICAgIGFkZF90b19zZXQoY29udGV4dHVhbF9kZXBlbmRlbmNpZXMsIGJpbmRpbmcuaGFuZGxlci5jb250ZXh0dWFsX2RlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICBiaW5kaW5nLnJlbmRlcihibG9jaywgbG9jayk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBtZWRpYSBiaW5kaW5ncyDigJQgYXdrd2FyZCBzcGVjaWFsIGNhc2UuIFRoZSBuYXRpdmUgdGltZXVwZGF0ZSBldmVudHNcbiAgICAgICAgLy8gZmlyZSB0b28gaW5mcmVxdWVudGx5LCBzbyB3ZSBuZWVkIHRvIHRha2UgbWF0dGVycyBpbnRvIG91clxuICAgICAgICAvLyBvd24gaGFuZHNcbiAgICAgICAgbGV0IGFuaW1hdGlvbl9mcmFtZTtcbiAgICAgICAgaWYgKGJpbmRpbmdfZ3JvdXAuZXZlbnRzWzBdID09PSAndGltZXVwZGF0ZScpIHtcbiAgICAgICAgICAgIGFuaW1hdGlvbl9mcmFtZSA9IGJsb2NrLmdldF91bmlxdWVfbmFtZShgJHt0aGlzLnZhci5uYW1lfV9hbmltYXRpb25mcmFtZWApO1xuICAgICAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKGFuaW1hdGlvbl9mcmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGFzX2xvY2FsX2Z1bmN0aW9uID0gY29udGV4dHVhbF9kZXBlbmRlbmNpZXMuc2l6ZSA+IDAgfHwgbmVlZHNfbG9jayB8fCBhbmltYXRpb25fZnJhbWU7XG4gICAgICAgIGxldCBjYWxsZWUgPSByZW5kZXJlci5yZWZlcmVuY2UoaGFuZGxlcik7XG4gICAgICAgIC8vIFRPRE8gZHJ5IHRoaXMgb3V0IOKAlCBzaW1pbGFyIGNvZGUgZm9yIGV2ZW50IGhhbmRsZXJzIGFuZCBjb21wb25lbnQgYmluZGluZ3NcbiAgICAgICAgaWYgKGhhc19sb2NhbF9mdW5jdGlvbikge1xuICAgICAgICAgICAgY29uc3QgYXJncyA9IEFycmF5LmZyb20oY29udGV4dHVhbF9kZXBlbmRlbmNpZXMpLm1hcChuYW1lID0+IHJlbmRlcmVyLnJlZmVyZW5jZShuYW1lKSk7XG4gICAgICAgICAgICAvLyBuZWVkIHRvIGNyZWF0ZSBhIGJsb2NrLWxvY2FsIGZ1bmN0aW9uIHRoYXQgY2FsbHMgYW4gaW5zdGFuY2UtbGV2ZWwgZnVuY3Rpb25cbiAgICAgICAgICAgIGlmIChhbmltYXRpb25fZnJhbWUpIHtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0XHRcdGZ1bmN0aW9uICR7aGFuZGxlcn0oKSB7XG5cdFx0XHRcdFx0XHRAX2NhbmNlbEFuaW1hdGlvbkZyYW1lKCR7YW5pbWF0aW9uX2ZyYW1lfSk7XG5cdFx0XHRcdFx0XHRpZiAoISR7dGhpcy52YXJ9LnBhdXNlZCkge1xuXHRcdFx0XHRcdFx0XHQke2FuaW1hdGlvbl9mcmFtZX0gPSBAcmFmKCR7aGFuZGxlcn0pO1xuXHRcdFx0XHRcdFx0XHQke25lZWRzX2xvY2sgJiYgYiBgJHtsb2NrfSA9IHRydWU7YH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdCR7Y2FsbGVlfS5jYWxsKCR7dGhpcy52YXJ9LCAke2FyZ3N9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmluaXQucHVzaChiIGBcblx0XHRcdFx0XHRmdW5jdGlvbiAke2hhbmRsZXJ9KCkge1xuXHRcdFx0XHRcdFx0JHtuZWVkc19sb2NrICYmIGIgYCR7bG9ja30gPSB0cnVlO2B9XG5cdFx0XHRcdFx0XHQke2NhbGxlZX0uY2FsbCgke3RoaXMudmFyfSwgJHthcmdzfSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxlZSA9IGhhbmRsZXI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyYW1zID0gQXJyYXkuZnJvbShjb250ZXh0dWFsX2RlcGVuZGVuY2llcykubWFwKG5hbWUgPT4gKHtcbiAgICAgICAgICAgIHR5cGU6ICdJZGVudGlmaWVyJyxcbiAgICAgICAgICAgIG5hbWVcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmNvbXBvbmVudC5wYXJ0bHlfaG9pc3RlZC5wdXNoKGIgYFxuXHRcdFx0ZnVuY3Rpb24gJHtoYW5kbGVyfSgke3BhcmFtc30pIHtcblx0XHRcdFx0JHtiaW5kaW5nX2dyb3VwLmJpbmRpbmdzLm1hcChiID0+IGIuaGFuZGxlci5tdXRhdGlvbil9XG5cdFx0XHRcdCR7QXJyYXkuZnJvbShkZXBlbmRlbmNpZXMpXG4gICAgICAgICAgICAuZmlsdGVyKGRlcCA9PiBkZXBbMF0gIT09ICckJylcbiAgICAgICAgICAgIC5maWx0ZXIoZGVwID0+ICFjb250ZXh0dWFsX2RlcGVuZGVuY2llcy5oYXMoZGVwKSlcbiAgICAgICAgICAgIC5tYXAoZGVwID0+IGIgYCR7dGhpcy5yZW5kZXJlci5pbnZhbGlkYXRlKGRlcCl9O2ApfVxuXHRcdFx0fVxuXHRcdGApO1xuICAgICAgICBiaW5kaW5nX2dyb3VwLmV2ZW50cy5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdlbGVtZW50cmVzaXplJykge1xuICAgICAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZVxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc2l6ZV9saXN0ZW5lciA9IGJsb2NrLmdldF91bmlxdWVfbmFtZShgJHt0aGlzLnZhci5uYW1lfV9yZXNpemVfbGlzdGVuZXJgKTtcbiAgICAgICAgICAgICAgICBibG9jay5hZGRfdmFyaWFibGUocmVzaXplX2xpc3RlbmVyKTtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChiIGAke3Jlc2l6ZV9saXN0ZW5lcn0gPSBAYWRkX3Jlc2l6ZV9saXN0ZW5lcigke3RoaXMudmFyfSwgJHtjYWxsZWV9LmJpbmQoJHt0aGlzLnZhcn0pKTtgKTtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYCR7cmVzaXplX2xpc3RlbmVyfSgpO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYmxvY2suZXZlbnRfbGlzdGVuZXJzLnB1c2goeCBgQGxpc3Rlbigke3RoaXMudmFyfSwgXCIke25hbWV9XCIsICR7Y2FsbGVlfSlgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHNvbWVfaW5pdGlhbF9zdGF0ZV9pc191bmRlZmluZWQgPSBiaW5kaW5nX2dyb3VwLmJpbmRpbmdzXG4gICAgICAgICAgICAubWFwKGJpbmRpbmcgPT4geCBgJHtiaW5kaW5nLnNuaXBwZXR9ID09PSB2b2lkIDBgKVxuICAgICAgICAgICAgLnJlZHVjZSgobGhzLCByaHMpID0+IHggYCR7bGhzfSB8fCAke3Joc31gKTtcbiAgICAgICAgY29uc3Qgc2hvdWxkX2luaXRpYWxpc2UgPSAodGhpcy5ub2RlLm5hbWUgPT09ICdzZWxlY3QnIHx8XG4gICAgICAgICAgICBiaW5kaW5nX2dyb3VwLmJpbmRpbmdzLmZpbmQoYmluZGluZyA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChiaW5kaW5nLm5vZGUubmFtZSA9PT0gJ2luZGV0ZXJtaW5hdGUnIHx8XG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmcubm9kZS5uYW1lID09PSAndGV4dENvbnRlbnQnIHx8XG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmcubm9kZS5uYW1lID09PSAnaW5uZXJIVE1MJyB8fFxuICAgICAgICAgICAgICAgICAgICBiaW5kaW5nLmlzX3JlYWRvbmx5X21lZGlhX2F0dHJpYnV0ZSgpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgaWYgKHNob3VsZF9pbml0aWFsaXNlKSB7XG4gICAgICAgICAgICBjb25zdCBjYWxsYmFjayA9IGhhc19sb2NhbF9mdW5jdGlvbiA/IGhhbmRsZXIgOiB4IGAoKSA9PiAke2NhbGxlZX0uY2FsbCgke3RoaXMudmFyfSlgO1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmh5ZHJhdGUucHVzaChiIGBpZiAoJHtzb21lX2luaXRpYWxfc3RhdGVfaXNfdW5kZWZpbmVkfSkgQGFkZF9yZW5kZXJfY2FsbGJhY2soJHtjYWxsYmFja30pO2ApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChiaW5kaW5nX2dyb3VwLmV2ZW50c1swXSA9PT0gJ2VsZW1lbnRyZXNpemUnKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaHlkcmF0ZS5wdXNoKGIgYEBhZGRfcmVuZGVyX2NhbGxiYWNrKCgpID0+ICR7Y2FsbGVlfS5jYWxsKCR7dGhpcy52YXJ9KSk7YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxvY2spIHtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGAke2xvY2t9ID0gZmFsc2U7YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWRkX3RoaXNfYmluZGluZyhibG9jaywgdGhpc19iaW5kaW5nKSB7XG4gICAgICAgIGNvbnN0IHsgcmVuZGVyZXIgfSA9IHRoaXM7XG4gICAgICAgIHJlbmRlcmVyLmNvbXBvbmVudC5oYXNfcmVhY3RpdmVfYXNzaWdubWVudHMgPSB0cnVlO1xuICAgICAgICBjb25zdCBiaW5kaW5nX2NhbGxiYWNrID0gYmluZF90aGlzKHJlbmRlcmVyLmNvbXBvbmVudCwgYmxvY2ssIHRoaXNfYmluZGluZywgdGhpcy52YXIpO1xuICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChiaW5kaW5nX2NhbGxiYWNrKTtcbiAgICB9XG4gICAgYWRkX2F0dHJpYnV0ZXMoYmxvY2spIHtcbiAgICAgICAgLy8gR2V0IGFsbCB0aGUgY2xhc3MgZGVwZW5kZW5jaWVzIGZpcnN0XG4gICAgICAgIHRoaXMuYXR0cmlidXRlcy5mb3JFYWNoKChhdHRyaWJ1dGUpID0+IHtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUubm9kZS5uYW1lID09PSAnY2xhc3MnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gYXR0cmlidXRlLm5vZGUuZ2V0X2RlcGVuZGVuY2llcygpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NfZGVwZW5kZW5jaWVzLnB1c2goLi4uZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLm5vZGUuYXR0cmlidXRlcy5zb21lKGF0dHIgPT4gYXR0ci5pc19zcHJlYWQpKSB7XG4gICAgICAgICAgICB0aGlzLmFkZF9zcHJlYWRfYXR0cmlidXRlcyhibG9jayk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLmZvckVhY2goKGF0dHJpYnV0ZSkgPT4ge1xuICAgICAgICAgICAgYXR0cmlidXRlLnJlbmRlcihibG9jayk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhZGRfc3ByZWFkX2F0dHJpYnV0ZXMoYmxvY2spIHtcbiAgICAgICAgY29uc3QgbGV2ZWxzID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke3RoaXMudmFyLm5hbWV9X2xldmVsc2ApO1xuICAgICAgICBjb25zdCBkYXRhID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke3RoaXMudmFyLm5hbWV9X2RhdGFgKTtcbiAgICAgICAgY29uc3QgaW5pdGlhbF9wcm9wcyA9IFtdO1xuICAgICAgICBjb25zdCB1cGRhdGVzID0gW107XG4gICAgICAgIHRoaXMuYXR0cmlidXRlc1xuICAgICAgICAgICAgLmZvckVhY2goYXR0ciA9PiB7XG4gICAgICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBhdHRyLm5vZGUuZ2V0X2RlcGVuZGVuY2llcygpO1xuICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uID0gZGVwZW5kZW5jaWVzLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICA/IGJsb2NrLnJlbmRlcmVyLmRpcnR5KGRlcGVuZGVuY2llcylcbiAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgICAgICBpZiAoYXR0ciBpbnN0YW5jZW9mIFNwcmVhZEF0dHJpYnV0ZVdyYXBwZXIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzbmlwcGV0ID0gYXR0ci5ub2RlLmV4cHJlc3Npb24ubWFuaXB1bGF0ZShibG9jayk7XG4gICAgICAgICAgICAgICAgaW5pdGlhbF9wcm9wcy5wdXNoKHNuaXBwZXQpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZXMucHVzaChjb25kaXRpb24gPyB4IGAke2NvbmRpdGlvbn0gJiYgJHtzbmlwcGV0fWAgOiBzbmlwcGV0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBhdHRyLnByb3BlcnR5X25hbWUgfHwgYXR0ci5uYW1lO1xuICAgICAgICAgICAgICAgIGluaXRpYWxfcHJvcHMucHVzaCh4IGB7ICR7bmFtZX06ICR7YXR0ci5nZXRfaW5pdChibG9jaywgYXR0ci5nZXRfdmFsdWUoYmxvY2spKX0gfWApO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNuaXBwZXQgPSB4IGB7ICR7bmFtZX06ICR7YXR0ci5zaG91bGRfY2FjaGUgPyBhdHRyLmxhc3QgOiBhdHRyLmdldF92YWx1ZShibG9jayl9IH1gO1xuICAgICAgICAgICAgICAgIHVwZGF0ZXMucHVzaChjb25kaXRpb24gPyB4IGAke2F0dHIuZ2V0X2RvbV91cGRhdGVfY29uZGl0aW9ucyhibG9jaywgY29uZGl0aW9uKX0gJiYgJHtzbmlwcGV0fWAgOiBzbmlwcGV0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRsZXQgJHtsZXZlbHN9ID0gWyR7aW5pdGlhbF9wcm9wc31dO1xuXG5cdFx0XHRsZXQgJHtkYXRhfSA9IHt9O1xuXHRcdFx0Zm9yIChsZXQgI2kgPSAwOyAjaSA8ICR7bGV2ZWxzfS5sZW5ndGg7ICNpICs9IDEpIHtcblx0XHRcdFx0JHtkYXRhfSA9IEBhc3NpZ24oJHtkYXRhfSwgJHtsZXZlbHN9WyNpXSk7XG5cdFx0XHR9XG5cdFx0YCk7XG4gICAgICAgIGNvbnN0IGZuID0gdGhpcy5ub2RlLm5hbWVzcGFjZSA9PT0gbmFtZXNwYWNlcy5zdmcgPyB4IGBAc2V0X3N2Z19hdHRyaWJ1dGVzYCA6IHggYEBzZXRfYXR0cmlidXRlc2A7XG4gICAgICAgIGJsb2NrLmNodW5rcy5oeWRyYXRlLnB1c2goYiBgJHtmbn0oJHt0aGlzLnZhcn0sICR7ZGF0YX0pO2ApO1xuICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHQke2ZufSgke3RoaXMudmFyfSwgJHtkYXRhfSA9IEBnZXRfc3ByZWFkX3VwZGF0ZSgke2xldmVsc30sIFtcblx0XHRcdFx0JHt1cGRhdGVzfVxuXHRcdFx0XSkpO1xuXHRcdGApO1xuICAgICAgICAvLyBoYW5kbGUgZWRnZSBjYXNlcyBmb3IgZWxlbWVudHNcbiAgICAgICAgaWYgKHRoaXMubm9kZS5uYW1lID09PSAnc2VsZWN0Jykge1xuICAgICAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBhdHRyIG9mIHRoaXMuYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZGVwIG9mIGF0dHIubm9kZS5kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmFkZChkZXApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5tb3VudC5wdXNoKGIgYFxuXHRcdFx0XHQoJHtkYXRhfS5tdWx0aXBsZSA/IEBzZWxlY3Rfb3B0aW9ucyA6IEBzZWxlY3Rfb3B0aW9uKSgke3RoaXMudmFyfSwgJHtkYXRhfS52YWx1ZSk7XG5cdFx0XHRgKTtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0aWYgKCR7YmxvY2sucmVuZGVyZXIuZGlydHkoQXJyYXkuZnJvbShkZXBlbmRlbmNpZXMpKX0gJiYgJ3ZhbHVlJyBpbiAke2RhdGF9KSAoJHtkYXRhfS5tdWx0aXBsZSA/IEBzZWxlY3Rfb3B0aW9ucyA6IEBzZWxlY3Rfb3B0aW9uKSgke3RoaXMudmFyfSwgJHtkYXRhfS52YWx1ZSk7O1xuXHRcdFx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5ub2RlLm5hbWUgPT09ICdpbnB1dCcgJiYgdGhpcy5hdHRyaWJ1dGVzLmZpbmQoYXR0ciA9PiBhdHRyLm5vZGUubmFtZSA9PT0gJ3ZhbHVlJykpIHtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLm5vZGUuZ2V0X3N0YXRpY19hdHRyaWJ1dGVfdmFsdWUoJ3R5cGUnKTtcbiAgICAgICAgICAgIGlmICh0eXBlID09PSBudWxsIHx8IHR5cGUgPT09ICcnIHx8IHR5cGUgPT09ICd0ZXh0JyB8fCB0eXBlID09PSAnZW1haWwnIHx8IHR5cGUgPT09ICdwYXNzd29yZCcpIHtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChiIGBcblx0XHRcdFx0XHQke3RoaXMudmFyfS52YWx1ZSA9ICR7ZGF0YX0udmFsdWU7XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0XHRpZiAoJ3ZhbHVlJyBpbiAke2RhdGF9KSB7XG5cdFx0XHRcdFx0XHQke3RoaXMudmFyfS52YWx1ZSA9ICR7ZGF0YX0udmFsdWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoWydidXR0b24nLCAnaW5wdXQnLCAna2V5Z2VuJywgJ3NlbGVjdCcsICd0ZXh0YXJlYSddLmluY2x1ZGVzKHRoaXMubm9kZS5uYW1lKSkge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLm1vdW50LnB1c2goYiBgXG5cdFx0XHRcdGlmICgke3RoaXMudmFyfS5hdXRvZm9jdXMpICR7dGhpcy52YXJ9LmZvY3VzKCk7XG5cdFx0XHRgKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhZGRfdHJhbnNpdGlvbnMoYmxvY2spIHtcbiAgICAgICAgY29uc3QgeyBpbnRybywgb3V0cm8gfSA9IHRoaXMubm9kZTtcbiAgICAgICAgaWYgKCFpbnRybyAmJiAhb3V0cm8pXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChpbnRybyA9PT0gb3V0cm8pIHtcbiAgICAgICAgICAgIC8vIGJpZGlyZWN0aW9uYWwgdHJhbnNpdGlvblxuICAgICAgICAgICAgY29uc3QgbmFtZSA9IGJsb2NrLmdldF91bmlxdWVfbmFtZShgJHt0aGlzLnZhci5uYW1lfV90cmFuc2l0aW9uYCk7XG4gICAgICAgICAgICBjb25zdCBzbmlwcGV0ID0gaW50cm8uZXhwcmVzc2lvblxuICAgICAgICAgICAgICAgID8gaW50cm8uZXhwcmVzc2lvbi5tYW5pcHVsYXRlKGJsb2NrKVxuICAgICAgICAgICAgICAgIDogeCBge31gO1xuICAgICAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKG5hbWUpO1xuICAgICAgICAgICAgY29uc3QgZm4gPSB0aGlzLnJlbmRlcmVyLnJlZmVyZW5jZShpbnRyby5uYW1lKTtcbiAgICAgICAgICAgIGNvbnN0IGludHJvX2Jsb2NrID0gYiBgXG5cdFx0XHRcdEBhZGRfcmVuZGVyX2NhbGxiYWNrKCgpID0+IHtcblx0XHRcdFx0XHRpZiAoISR7bmFtZX0pICR7bmFtZX0gPSBAY3JlYXRlX2JpZGlyZWN0aW9uYWxfdHJhbnNpdGlvbigke3RoaXMudmFyfSwgJHtmbn0sICR7c25pcHBldH0sIHRydWUpO1xuXHRcdFx0XHRcdCR7bmFtZX0ucnVuKDEpO1xuXHRcdFx0XHR9KTtcblx0XHRcdGA7XG4gICAgICAgICAgICBjb25zdCBvdXRyb19ibG9jayA9IGIgYFxuXHRcdFx0XHRpZiAoISR7bmFtZX0pICR7bmFtZX0gPSBAY3JlYXRlX2JpZGlyZWN0aW9uYWxfdHJhbnNpdGlvbigke3RoaXMudmFyfSwgJHtmbn0sICR7c25pcHBldH0sIGZhbHNlKTtcblx0XHRcdFx0JHtuYW1lfS5ydW4oMCk7XG5cdFx0XHRgO1xuICAgICAgICAgICAgaWYgKGludHJvLmlzX2xvY2FsKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmludHJvLnB1c2goYiBgXG5cdFx0XHRcdFx0aWYgKCNsb2NhbCkge1xuXHRcdFx0XHRcdFx0JHtpbnRyb19ibG9ja31cblx0XHRcdFx0XHR9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5vdXRyby5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICgjbG9jYWwpIHtcblx0XHRcdFx0XHRcdCR7b3V0cm9fYmxvY2t9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5pbnRyby5wdXNoKGludHJvX2Jsb2NrKTtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3Mub3V0cm8ucHVzaChvdXRyb19ibG9jayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYGlmIChkZXRhY2hpbmcgJiYgJHtuYW1lfSkgJHtuYW1lfS5lbmQoKTtgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGludHJvX25hbWUgPSBpbnRybyAmJiBibG9jay5nZXRfdW5pcXVlX25hbWUoYCR7dGhpcy52YXIubmFtZX1faW50cm9gKTtcbiAgICAgICAgICAgIGNvbnN0IG91dHJvX25hbWUgPSBvdXRybyAmJiBibG9jay5nZXRfdW5pcXVlX25hbWUoYCR7dGhpcy52YXIubmFtZX1fb3V0cm9gKTtcbiAgICAgICAgICAgIGlmIChpbnRybykge1xuICAgICAgICAgICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZShpbnRyb19uYW1lKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzbmlwcGV0ID0gaW50cm8uZXhwcmVzc2lvblxuICAgICAgICAgICAgICAgICAgICA/IGludHJvLmV4cHJlc3Npb24ubWFuaXB1bGF0ZShibG9jaylcbiAgICAgICAgICAgICAgICAgICAgOiB4IGB7fWA7XG4gICAgICAgICAgICAgICAgY29uc3QgZm4gPSB0aGlzLnJlbmRlcmVyLnJlZmVyZW5jZShpbnRyby5uYW1lKTtcbiAgICAgICAgICAgICAgICBsZXQgaW50cm9fYmxvY2s7XG4gICAgICAgICAgICAgICAgaWYgKG91dHJvKSB7XG4gICAgICAgICAgICAgICAgICAgIGludHJvX2Jsb2NrID0gYiBgXG5cdFx0XHRcdFx0XHRAYWRkX3JlbmRlcl9jYWxsYmFjaygoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdGlmICgke291dHJvX25hbWV9KSAke291dHJvX25hbWV9LmVuZCgxKTtcblx0XHRcdFx0XHRcdFx0JHtpbnRyb19uYW1lfSA9IEBjcmVhdGVfaW5fdHJhbnNpdGlvbigke3RoaXMudmFyfSwgJHtmbn0sICR7c25pcHBldH0pO1xuXHRcdFx0XHRcdFx0XHQke2ludHJvX25hbWV9LnN0YXJ0KCk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRgO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3Mub3V0cm8ucHVzaChiIGBpZiAoJHtpbnRyb19uYW1lfSkgJHtpbnRyb19uYW1lfS5pbnZhbGlkYXRlKCk7YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpbnRyb19ibG9jayA9IGIgYFxuXHRcdFx0XHRcdFx0aWYgKCEke2ludHJvX25hbWV9KSB7XG5cdFx0XHRcdFx0XHRcdEBhZGRfcmVuZGVyX2NhbGxiYWNrKCgpID0+IHtcblx0XHRcdFx0XHRcdFx0XHQke2ludHJvX25hbWV9ID0gQGNyZWF0ZV9pbl90cmFuc2l0aW9uKCR7dGhpcy52YXJ9LCAke2ZufSwgJHtzbmlwcGV0fSk7XG5cdFx0XHRcdFx0XHRcdFx0JHtpbnRyb19uYW1lfS5zdGFydCgpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaW50cm8uaXNfbG9jYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaW50cm9fYmxvY2sgPSBiIGBcblx0XHRcdFx0XHRcdGlmICgjbG9jYWwpIHtcblx0XHRcdFx0XHRcdFx0JHtpbnRyb19ibG9ja31cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuaW50cm8ucHVzaChpbnRyb19ibG9jayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3V0cm8pIHtcbiAgICAgICAgICAgICAgICBibG9jay5hZGRfdmFyaWFibGUob3V0cm9fbmFtZSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc25pcHBldCA9IG91dHJvLmV4cHJlc3Npb25cbiAgICAgICAgICAgICAgICAgICAgPyBvdXRyby5leHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2spXG4gICAgICAgICAgICAgICAgICAgIDogeCBge31gO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZuID0gdGhpcy5yZW5kZXJlci5yZWZlcmVuY2Uob3V0cm8ubmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnRybykge1xuICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuaW50cm8ucHVzaChiIGBcblx0XHRcdFx0XHRcdGlmICgke291dHJvX25hbWV9KSAke291dHJvX25hbWV9LmVuZCgxKTtcblx0XHRcdFx0XHRgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gVE9ETyBoaWRlIGVsZW1lbnRzIHRoYXQgaGF2ZSBvdXRybydkICh1bmxlc3MgdGhleSBiZWxvbmcgdG8gYSBzdGlsbC1vdXRyb2luZ1xuICAgICAgICAgICAgICAgIC8vIGdyb3VwKSBwcmlvciB0byB0aGVpciByZW1vdmFsIGZyb20gdGhlIERPTVxuICAgICAgICAgICAgICAgIGxldCBvdXRyb19ibG9jayA9IGIgYFxuXHRcdFx0XHRcdCR7b3V0cm9fbmFtZX0gPSBAY3JlYXRlX291dF90cmFuc2l0aW9uKCR7dGhpcy52YXJ9LCAke2ZufSwgJHtzbmlwcGV0fSk7XG5cdFx0XHRcdGA7XG4gICAgICAgICAgICAgICAgaWYgKG91dHJvLmlzX2xvY2FsKSB7XG4gICAgICAgICAgICAgICAgICAgIG91dHJvX2Jsb2NrID0gYiBgXG5cdFx0XHRcdFx0XHRpZiAoI2xvY2FsKSB7XG5cdFx0XHRcdFx0XHRcdCR7b3V0cm9fYmxvY2t9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLm91dHJvLnB1c2gob3V0cm9fYmxvY2spO1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5kZXN0cm95LnB1c2goYiBgaWYgKGRldGFjaGluZyAmJiAke291dHJvX25hbWV9KSAke291dHJvX25hbWV9LmVuZCgpO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICgoaW50cm8gJiYgaW50cm8uZXhwcmVzc2lvbiAmJiBpbnRyby5leHByZXNzaW9uLmRlcGVuZGVuY2llcy5zaXplKSB8fCAob3V0cm8gJiYgb3V0cm8uZXhwcmVzc2lvbiAmJiBvdXRyby5leHByZXNzaW9uLmRlcGVuZGVuY2llcy5zaXplKSkge1xuICAgICAgICAgICAgYmxvY2subWFpbnRhaW5fY29udGV4dCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWRkX2FuaW1hdGlvbihibG9jaykge1xuICAgICAgICBpZiAoIXRoaXMubm9kZS5hbmltYXRpb24pXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHsgb3V0cm8gfSA9IHRoaXMubm9kZTtcbiAgICAgICAgY29uc3QgcmVjdCA9IGJsb2NrLmdldF91bmlxdWVfbmFtZSgncmVjdCcpO1xuICAgICAgICBjb25zdCBzdG9wX2FuaW1hdGlvbiA9IGJsb2NrLmdldF91bmlxdWVfbmFtZSgnc3RvcF9hbmltYXRpb24nKTtcbiAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKHJlY3QpO1xuICAgICAgICBibG9jay5hZGRfdmFyaWFibGUoc3RvcF9hbmltYXRpb24sIHggYEBub29wYCk7XG4gICAgICAgIGJsb2NrLmNodW5rcy5tZWFzdXJlLnB1c2goYiBgXG5cdFx0XHQke3JlY3R9ID0gJHt0aGlzLnZhcn0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cdFx0YCk7XG4gICAgICAgIGJsb2NrLmNodW5rcy5maXgucHVzaChiIGBcblx0XHRcdEBmaXhfcG9zaXRpb24oJHt0aGlzLnZhcn0pO1xuXHRcdFx0JHtzdG9wX2FuaW1hdGlvbn0oKTtcblx0XHRcdCR7b3V0cm8gJiYgYiBgQGFkZF90cmFuc2Zvcm0oJHt0aGlzLnZhcn0sICR7cmVjdH0pO2B9XG5cdFx0YCk7XG4gICAgICAgIGxldCBwYXJhbXM7XG4gICAgICAgIGlmICh0aGlzLm5vZGUuYW5pbWF0aW9uLmV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgIHBhcmFtcyA9IHRoaXMubm9kZS5hbmltYXRpb24uZXhwcmVzc2lvbi5tYW5pcHVsYXRlKGJsb2NrKTtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vZGUuYW5pbWF0aW9uLmV4cHJlc3Npb24uZHluYW1pY19kZXBlbmRlbmNpZXMoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiBgcGFyYW1zYCBpcyBkeW5hbWljLCBjYWxjdWxhdGUgcGFyYW1zIGFoZWFkIG9mIHRpbWUgaW4gdGhlIGAucigpYCBtZXRob2RcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbXNfdmFyID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdwYXJhbXMnKTtcbiAgICAgICAgICAgICAgICBibG9jay5hZGRfdmFyaWFibGUocGFyYW1zX3Zhcik7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLm1lYXN1cmUucHVzaChiIGAke3BhcmFtc192YXJ9ID0gJHtwYXJhbXN9O2ApO1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtc192YXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwYXJhbXMgPSB4IGB7fWA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmFtZSA9IHRoaXMucmVuZGVyZXIucmVmZXJlbmNlKHRoaXMubm9kZS5hbmltYXRpb24ubmFtZSk7XG4gICAgICAgIGJsb2NrLmNodW5rcy5hbmltYXRlLnB1c2goYiBgXG5cdFx0XHQke3N0b3BfYW5pbWF0aW9ufSgpO1xuXHRcdFx0JHtzdG9wX2FuaW1hdGlvbn0gPSBAY3JlYXRlX2FuaW1hdGlvbigke3RoaXMudmFyfSwgJHtyZWN0fSwgJHtuYW1lfSwgJHtwYXJhbXN9KTtcblx0XHRgKTtcbiAgICB9XG4gICAgYWRkX2NsYXNzZXMoYmxvY2spIHtcbiAgICAgICAgY29uc3QgaGFzX3NwcmVhZCA9IHRoaXMubm9kZS5hdHRyaWJ1dGVzLnNvbWUoYXR0ciA9PiBhdHRyLmlzX3NwcmVhZCk7XG4gICAgICAgIHRoaXMubm9kZS5jbGFzc2VzLmZvckVhY2goY2xhc3NfZGlyZWN0aXZlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgZXhwcmVzc2lvbiwgbmFtZSB9ID0gY2xhc3NfZGlyZWN0aXZlO1xuICAgICAgICAgICAgbGV0IHNuaXBwZXQ7XG4gICAgICAgICAgICBsZXQgZGVwZW5kZW5jaWVzO1xuICAgICAgICAgICAgaWYgKGV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgICAgICBzbmlwcGV0ID0gZXhwcmVzc2lvbi5tYW5pcHVsYXRlKGJsb2NrKTtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMgPSBleHByZXNzaW9uLmRlcGVuZGVuY2llcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNuaXBwZXQgPSBuYW1lO1xuICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llcyA9IG5ldyBTZXQoW25hbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZXIgPSBiIGBAdG9nZ2xlX2NsYXNzKCR7dGhpcy52YXJ9LCBcIiR7bmFtZX1cIiwgJHtzbmlwcGV0fSk7YDtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5oeWRyYXRlLnB1c2godXBkYXRlcik7XG4gICAgICAgICAgICBpZiAoaGFzX3NwcmVhZCkge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaCh1cGRhdGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKChkZXBlbmRlbmNpZXMgJiYgZGVwZW5kZW5jaWVzLnNpemUgPiAwKSB8fCB0aGlzLmNsYXNzX2RlcGVuZGVuY2llcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxfZGVwZW5kZW5jaWVzID0gdGhpcy5jbGFzc19kZXBlbmRlbmNpZXMuY29uY2F0KC4uLmRlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uID0gYmxvY2sucmVuZGVyZXIuZGlydHkoYWxsX2RlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICAgICAgLy8gSWYgYWxsIG9mIHRoZSBkZXBlbmRlbmNpZXMgYXJlIG5vbi1keW5hbWljIChkb24ndCBnZXQgdXBkYXRlZCkgdGhlbiB0aGVyZSBpcyBubyByZWFzb25cbiAgICAgICAgICAgICAgICAvLyB0byBhZGQgYW4gdXBkYXRlciBmb3IgdGhpcy5cbiAgICAgICAgICAgICAgICBjb25zdCBhbnlfZHluYW1pY19kZXBlbmRlbmNpZXMgPSBhbGxfZGVwZW5kZW5jaWVzLnNvbWUoKGRlcCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IHRoaXMucmVuZGVyZXIuY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KGRlcCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhdmFyaWFibGUgfHwgaXNfZHluYW1pYyh2YXJpYWJsZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKGFueV9keW5hbWljX2RlcGVuZGVuY2llcykge1xuICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHRcdFx0XHRpZiAoJHtjb25kaXRpb259KSB7XG5cdFx0XHRcdFx0XHRcdCR7dXBkYXRlcn1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhZGRfc3R5bGVzKGJsb2NrKSB7XG4gICAgICAgIGNvbnN0IGhhc19zcHJlYWQgPSB0aGlzLm5vZGUuYXR0cmlidXRlcy5zb21lKGF0dHIgPT4gYXR0ci5pc19zcHJlYWQpO1xuICAgICAgICB0aGlzLm5vZGUuc3R5bGVzLmZvckVhY2goKHN0eWxlX2RpcmVjdGl2ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBuYW1lLCBleHByZXNzaW9uLCBzaG91bGRfY2FjaGUgfSA9IHN0eWxlX2RpcmVjdGl2ZTtcbiAgICAgICAgICAgIGNvbnN0IHNuaXBwZXQgPSBleHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICAgICAgbGV0IGNhY2hlZF9zbmlwcGV0O1xuICAgICAgICAgICAgaWYgKHNob3VsZF9jYWNoZSkge1xuICAgICAgICAgICAgICAgIGNhY2hlZF9zbmlwcGV0ID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGBzdHlsZV8ke25hbWUucmVwbGFjZSgvLS9nLCAnXycpfWApO1xuICAgICAgICAgICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZShjYWNoZWRfc25pcHBldCwgc25pcHBldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVyID0gYiBgQHNldF9zdHlsZSgke3RoaXMudmFyfSwgXCIke25hbWV9XCIsICR7c2hvdWxkX2NhY2hlID8gY2FjaGVkX3NuaXBwZXQgOiBzbmlwcGV0fSwgZmFsc2UpYDtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5oeWRyYXRlLnB1c2godXBkYXRlcik7XG4gICAgICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBleHByZXNzaW9uLmR5bmFtaWNfZGVwZW5kZW5jaWVzKCk7XG4gICAgICAgICAgICBpZiAoaGFzX3NwcmVhZCkge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaCh1cGRhdGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGRlcGVuZGVuY2llcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNob3VsZF9jYWNoZSkge1xuICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHRcdFx0XHRcdGlmICgke2Jsb2NrLnJlbmRlcmVyLmRpcnR5KGRlcGVuZGVuY2llcyl9ICYmICgke2NhY2hlZF9zbmlwcGV0fSAhPT0gKCR7Y2FjaGVkX3NuaXBwZXR9ID0gJHtzbmlwcGV0fSkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0JHt1cGRhdGVyfVx0XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0XHRcdGlmICgke2Jsb2NrLnJlbmRlcmVyLmRpcnR5KGRlcGVuZGVuY2llcyl9KSB7XG5cdFx0XHRcdFx0XHRcdCR7dXBkYXRlcn1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhZGRfbWFudWFsX3N0eWxlX3Njb3BpbmcoYmxvY2spIHtcbiAgICAgICAgaWYgKHRoaXMubm9kZS5uZWVkc19tYW51YWxfc3R5bGVfc2NvcGluZykge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlciA9IGIgYEB0b2dnbGVfY2xhc3MoJHt0aGlzLnZhcn0sIFwiJHt0aGlzLm5vZGUuY29tcG9uZW50LnN0eWxlc2hlZXQuaWR9XCIsIHRydWUpO2A7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaHlkcmF0ZS5wdXNoKHVwZGF0ZXIpO1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKHVwZGF0ZXIpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gdG9faHRtbCh3cmFwcGVycywgYmxvY2ssIGxpdGVyYWwsIHN0YXRlLCBjYW5fdXNlX3Jhd190ZXh0KSB7XG4gICAgd3JhcHBlcnMuZm9yRWFjaCh3cmFwcGVyID0+IHtcbiAgICAgICAgaWYgKHdyYXBwZXIgaW5zdGFuY2VvZiBUZXh0V3JhcHBlcikge1xuICAgICAgICAgICAgaWYgKHdyYXBwZXIudXNlX3NwYWNlKCkpXG4gICAgICAgICAgICAgICAgc3RhdGUucXVhc2kudmFsdWUucmF3ICs9ICcgJztcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IHdyYXBwZXIubm9kZS5wYXJlbnQ7XG4gICAgICAgICAgICBjb25zdCByYXcgPSBwYXJlbnQgJiYgKHBhcmVudC5uYW1lID09PSAnc2NyaXB0JyB8fFxuICAgICAgICAgICAgICAgIHBhcmVudC5uYW1lID09PSAnc3R5bGUnIHx8XG4gICAgICAgICAgICAgICAgY2FuX3VzZV9yYXdfdGV4dCk7XG4gICAgICAgICAgICBzdGF0ZS5xdWFzaS52YWx1ZS5yYXcgKz0gKHJhdyA/IHdyYXBwZXIuZGF0YSA6IGVzY2FwZV9odG1sKHdyYXBwZXIuZGF0YSkpXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcXFwvZywgJ1xcXFxcXFxcJylcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvYC9nLCAnXFxcXGAnKVxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXCQvZywgJ1xcXFwkJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod3JhcHBlciBpbnN0YW5jZW9mIE11c3RhY2hlVGFnV3JhcHBlciB8fCB3cmFwcGVyIGluc3RhbmNlb2YgUmF3TXVzdGFjaGVUYWdXcmFwcGVyKSB7XG4gICAgICAgICAgICBsaXRlcmFsLnF1YXNpcy5wdXNoKHN0YXRlLnF1YXNpKTtcbiAgICAgICAgICAgIGxpdGVyYWwuZXhwcmVzc2lvbnMucHVzaCh3cmFwcGVyLm5vZGUuZXhwcmVzc2lvbi5tYW5pcHVsYXRlKGJsb2NrKSk7XG4gICAgICAgICAgICBzdGF0ZS5xdWFzaSA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnVGVtcGxhdGVFbGVtZW50JyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogeyByYXc6ICcnIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod3JhcHBlci5ub2RlLm5hbWUgPT09ICdub3NjcmlwdCcpIDtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBlbGVtZW50XG4gICAgICAgICAgICBzdGF0ZS5xdWFzaS52YWx1ZS5yYXcgKz0gYDwke3dyYXBwZXIubm9kZS5uYW1lfWA7XG4gICAgICAgICAgICB3cmFwcGVyLmF0dHJpYnV0ZXMuZm9yRWFjaCgoYXR0cikgPT4ge1xuICAgICAgICAgICAgICAgIHN0YXRlLnF1YXNpLnZhbHVlLnJhdyArPSBgICR7Zml4X2F0dHJpYnV0ZV9jYXNpbmcoYXR0ci5ub2RlLm5hbWUpfT1cImA7XG4gICAgICAgICAgICAgICAgYXR0ci5ub2RlLmNodW5rcy5mb3JFYWNoKGNodW5rID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNodW5rLnR5cGUgPT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUucXVhc2kudmFsdWUucmF3ICs9IGVzY2FwZV9odG1sKGNodW5rLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGl0ZXJhbC5xdWFzaXMucHVzaChzdGF0ZS5xdWFzaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXRlcmFsLmV4cHJlc3Npb25zLnB1c2goY2h1bmsubWFuaXB1bGF0ZShibG9jaykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUucXVhc2kgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1RlbXBsYXRlRWxlbWVudCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHsgcmF3OiAnJyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGUucXVhc2kudmFsdWUucmF3ICs9ICdcIic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICghd3JhcHBlci52b2lkKSB7XG4gICAgICAgICAgICAgICAgc3RhdGUucXVhc2kudmFsdWUucmF3ICs9ICc+JztcbiAgICAgICAgICAgICAgICB0b19odG1sKHdyYXBwZXIuZnJhZ21lbnQubm9kZXMsIGJsb2NrLCBsaXRlcmFsLCBzdGF0ZSk7XG4gICAgICAgICAgICAgICAgc3RhdGUucXVhc2kudmFsdWUucmF3ICs9IGA8LyR7d3JhcHBlci5ub2RlLm5hbWV9PmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdGF0ZS5xdWFzaS52YWx1ZS5yYXcgKz0gJy8+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5jbGFzcyBIZWFkV3JhcHBlciBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlLCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpIHtcbiAgICAgICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpO1xuICAgICAgICB0aGlzLmNhbl91c2VfaW5uZXJodG1sID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhZ21lbnQgPSBuZXcgRnJhZ21lbnRXcmFwcGVyKHJlbmRlcmVyLCBibG9jaywgbm9kZS5jaGlsZHJlbiwgdGhpcywgc3RyaXBfd2hpdGVzcGFjZSwgbmV4dF9zaWJsaW5nKTtcbiAgICB9XG4gICAgcmVuZGVyKGJsb2NrLCBfcGFyZW50X25vZGUsIF9wYXJlbnRfbm9kZXMpIHtcbiAgICAgICAgbGV0IG5vZGVzO1xuICAgICAgICBpZiAodGhpcy5yZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUgJiYgdGhpcy5mcmFnbWVudC5ub2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIG5vZGVzID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdoZWFkX25vZGVzJyk7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuY2xhaW0ucHVzaChiIGBjb25zdCAke25vZGVzfSA9IEBxdWVyeV9zZWxlY3Rvcl9hbGwoJ1tkYXRhLXN2ZWx0ZT1cIiR7dGhpcy5ub2RlLmlkfVwiXScsIEBfZG9jdW1lbnQuaGVhZCk7YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mcmFnbWVudC5yZW5kZXIoYmxvY2ssIHggYEBfZG9jdW1lbnQuaGVhZGAsIG5vZGVzKTtcbiAgICAgICAgaWYgKG5vZGVzICYmIHRoaXMucmVuZGVyZXIub3B0aW9ucy5oeWRyYXRhYmxlKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuY2xhaW0ucHVzaChiIGAke25vZGVzfS5mb3JFYWNoKEBkZXRhY2gpO2ApO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpc19lbHNlX2lmKG5vZGUpIHtcbiAgICByZXR1cm4gKG5vZGUgJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgbm9kZS5jaGlsZHJlblswXS50eXBlID09PSAnSWZCbG9jaycpO1xufVxuY2xhc3MgSWZCbG9ja0JyYW5jaCBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlLCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpIHtcbiAgICAgICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpO1xuICAgICAgICB0aGlzLnZhciA9IG51bGw7XG4gICAgICAgIGNvbnN0IHsgZXhwcmVzc2lvbiB9ID0gbm9kZTtcbiAgICAgICAgY29uc3QgaXNfZWxzZSA9ICFleHByZXNzaW9uO1xuICAgICAgICBpZiAoZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBleHByZXNzaW9uLmR5bmFtaWNfZGVwZW5kZW5jaWVzKCk7XG4gICAgICAgICAgICAvLyBUT0RPIGlzIHRoaXMgdGhlIHJpZ2h0IHJ1bGU/IG9yIHNob3VsZCBhbnkgbm9uLXJlZmVyZW5jZSBjb3VudD9cbiAgICAgICAgICAgIC8vIGNvbnN0IHNob3VsZF9jYWNoZSA9ICFpc19yZWZlcmVuY2UoZXhwcmVzc2lvbi5ub2RlLCBudWxsKSAmJiBkZXBlbmRlbmNpZXMubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIGxldCBzaG91bGRfY2FjaGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHdhbGsoZXhwcmVzc2lvbi5ub2RlLCB7XG4gICAgICAgICAgICAgICAgZW50ZXIobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnQ2FsbEV4cHJlc3Npb24nIHx8IG5vZGUudHlwZSA9PT0gJ05ld0V4cHJlc3Npb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG91bGRfY2FjaGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoc2hvdWxkX2NhY2hlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb24gPSBibG9jay5nZXRfdW5pcXVlX25hbWUoJ3Nob3dfaWYnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNuaXBwZXQgPSBleHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb24gPSBleHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuYmxvY2sgPSBibG9jay5jaGlsZCh7XG4gICAgICAgICAgICBjb21tZW50OiBjcmVhdGVfZGVidWdnaW5nX2NvbW1lbnQobm9kZSwgcGFyZW50LnJlbmRlcmVyLmNvbXBvbmVudCksXG4gICAgICAgICAgICBuYW1lOiBwYXJlbnQucmVuZGVyZXIuY29tcG9uZW50LmdldF91bmlxdWVfbmFtZShpc19lbHNlID8gJ2NyZWF0ZV9lbHNlX2Jsb2NrJyA6ICdjcmVhdGVfaWZfYmxvY2snKSxcbiAgICAgICAgICAgIHR5cGU6IG5vZGUuZXhwcmVzc2lvbiA/ICdpZicgOiAnZWxzZSdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZnJhZ21lbnQgPSBuZXcgRnJhZ21lbnRXcmFwcGVyKHJlbmRlcmVyLCB0aGlzLmJsb2NrLCBub2RlLmNoaWxkcmVuLCBwYXJlbnQsIHN0cmlwX3doaXRlc3BhY2UsIG5leHRfc2libGluZyk7XG4gICAgICAgIHRoaXMuaXNfZHluYW1pYyA9IHRoaXMuYmxvY2suZGVwZW5kZW5jaWVzLnNpemUgPiAwO1xuICAgIH1cbn1cbmNsYXNzIElmQmxvY2tXcmFwcGVyIGV4dGVuZHMgV3JhcHBlciB7XG4gICAgY29uc3RydWN0b3IocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUsIHN0cmlwX3doaXRlc3BhY2UsIG5leHRfc2libGluZykge1xuICAgICAgICBzdXBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSk7XG4gICAgICAgIHRoaXMubmVlZHNfdXBkYXRlID0gZmFsc2U7XG4gICAgICAgIHRoaXMudmFyID0geyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6ICdpZl9ibG9jaycgfTtcbiAgICAgICAgdGhpcy5jYW5ub3RfdXNlX2lubmVyaHRtbCgpO1xuICAgICAgICB0aGlzLm5vdF9zdGF0aWNfY29udGVudCgpO1xuICAgICAgICB0aGlzLmJyYW5jaGVzID0gW107XG4gICAgICAgIGNvbnN0IGJsb2NrcyA9IFtdO1xuICAgICAgICBsZXQgaXNfZHluYW1pYyA9IGZhbHNlO1xuICAgICAgICBsZXQgaGFzX2ludHJvcyA9IGZhbHNlO1xuICAgICAgICBsZXQgaGFzX291dHJvcyA9IGZhbHNlO1xuICAgICAgICBjb25zdCBjcmVhdGVfYnJhbmNoZXMgPSAobm9kZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYnJhbmNoID0gbmV3IElmQmxvY2tCcmFuY2gocmVuZGVyZXIsIGJsb2NrLCB0aGlzLCBub2RlLCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpO1xuICAgICAgICAgICAgdGhpcy5icmFuY2hlcy5wdXNoKGJyYW5jaCk7XG4gICAgICAgICAgICBibG9ja3MucHVzaChicmFuY2guYmxvY2spO1xuICAgICAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyhub2RlLmV4cHJlc3Npb24uZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgIGlmIChicmFuY2guYmxvY2suZGVwZW5kZW5jaWVzLnNpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgLy8gdGhlIGNvbmRpdGlvbiwgb3IgaXRzIGNvbnRlbnRzLCBpcyBkeW5hbWljXG4gICAgICAgICAgICAgICAgaXNfZHluYW1pYyA9IHRydWU7XG4gICAgICAgICAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyhicmFuY2guYmxvY2suZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChicmFuY2guZGVwZW5kZW5jaWVzICYmIGJyYW5jaC5kZXBlbmRlbmNpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIC8vIHRoZSBjb25kaXRpb24gaXRzZWxmIGlzIGR5bmFtaWNcbiAgICAgICAgICAgICAgICB0aGlzLm5lZWRzX3VwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYnJhbmNoLmJsb2NrLmhhc19pbnRyb3MpXG4gICAgICAgICAgICAgICAgaGFzX2ludHJvcyA9IHRydWU7XG4gICAgICAgICAgICBpZiAoYnJhbmNoLmJsb2NrLmhhc19vdXRyb3MpXG4gICAgICAgICAgICAgICAgaGFzX291dHJvcyA9IHRydWU7XG4gICAgICAgICAgICBpZiAoaXNfZWxzZV9pZihub2RlLmVsc2UpKSB7XG4gICAgICAgICAgICAgICAgY3JlYXRlX2JyYW5jaGVzKG5vZGUuZWxzZS5jaGlsZHJlblswXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChub2RlLmVsc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBicmFuY2ggPSBuZXcgSWZCbG9ja0JyYW5jaChyZW5kZXJlciwgYmxvY2ssIHRoaXMsIG5vZGUuZWxzZSwgc3RyaXBfd2hpdGVzcGFjZSwgbmV4dF9zaWJsaW5nKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJyYW5jaGVzLnB1c2goYnJhbmNoKTtcbiAgICAgICAgICAgICAgICBibG9ja3MucHVzaChicmFuY2guYmxvY2spO1xuICAgICAgICAgICAgICAgIGlmIChicmFuY2guYmxvY2suZGVwZW5kZW5jaWVzLnNpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzX2R5bmFtaWMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5hZGRfZGVwZW5kZW5jaWVzKGJyYW5jaC5ibG9jay5kZXBlbmRlbmNpZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYnJhbmNoLmJsb2NrLmhhc19pbnRyb3MpXG4gICAgICAgICAgICAgICAgICAgIGhhc19pbnRyb3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmIChicmFuY2guYmxvY2suaGFzX291dHJvcylcbiAgICAgICAgICAgICAgICAgICAgaGFzX291dHJvcyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNyZWF0ZV9icmFuY2hlcyh0aGlzLm5vZGUpO1xuICAgICAgICBibG9ja3MuZm9yRWFjaChibG9jayA9PiB7XG4gICAgICAgICAgICBibG9jay5oYXNfdXBkYXRlX21ldGhvZCA9IGlzX2R5bmFtaWM7XG4gICAgICAgICAgICBibG9jay5oYXNfaW50cm9fbWV0aG9kID0gaGFzX2ludHJvcztcbiAgICAgICAgICAgIGJsb2NrLmhhc19vdXRyb19tZXRob2QgPSBoYXNfb3V0cm9zO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVuZGVyZXIuYmxvY2tzLnB1c2goLi4uYmxvY2tzKTtcbiAgICB9XG4gICAgcmVuZGVyKGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKSB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSB0aGlzLnZhcjtcbiAgICAgICAgY29uc3QgbmVlZHNfYW5jaG9yID0gdGhpcy5uZXh0ID8gIXRoaXMubmV4dC5pc19kb21fbm9kZSgpIDogIXBhcmVudF9ub2RlIHx8ICF0aGlzLnBhcmVudC5pc19kb21fbm9kZSgpO1xuICAgICAgICBjb25zdCBhbmNob3IgPSBuZWVkc19hbmNob3JcbiAgICAgICAgICAgID8gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke3RoaXMudmFyLm5hbWV9X2FuY2hvcmApXG4gICAgICAgICAgICA6ICh0aGlzLm5leHQgJiYgdGhpcy5uZXh0LnZhcikgfHwgJ251bGwnO1xuICAgICAgICBjb25zdCBoYXNfZWxzZSA9ICEodGhpcy5icmFuY2hlc1t0aGlzLmJyYW5jaGVzLmxlbmd0aCAtIDFdLmNvbmRpdGlvbik7XG4gICAgICAgIGNvbnN0IGlmX2V4aXN0c19jb25kaXRpb24gPSBoYXNfZWxzZSA/IG51bGwgOiBuYW1lO1xuICAgICAgICBjb25zdCBkeW5hbWljID0gdGhpcy5icmFuY2hlc1swXS5ibG9jay5oYXNfdXBkYXRlX21ldGhvZDsgLy8gY2FuIHVzZSBbMF0gYXMgcHJveHkgZm9yIGFsbCwgc2luY2UgdGhleSBuZWNlc3NhcmlseSBoYXZlIHRoZSBzYW1lIHZhbHVlXG4gICAgICAgIGNvbnN0IGhhc19pbnRyb3MgPSB0aGlzLmJyYW5jaGVzWzBdLmJsb2NrLmhhc19pbnRyb19tZXRob2Q7XG4gICAgICAgIGNvbnN0IGhhc19vdXRyb3MgPSB0aGlzLmJyYW5jaGVzWzBdLmJsb2NrLmhhc19vdXRyb19tZXRob2Q7XG4gICAgICAgIGNvbnN0IGhhc190cmFuc2l0aW9ucyA9IGhhc19pbnRyb3MgfHwgaGFzX291dHJvcztcbiAgICAgICAgY29uc3QgdmFycyA9IHsgbmFtZSwgYW5jaG9yLCBpZl9leGlzdHNfY29uZGl0aW9uLCBoYXNfZWxzZSwgaGFzX3RyYW5zaXRpb25zIH07XG4gICAgICAgIGNvbnN0IGRldGFjaGluZyA9IHBhcmVudF9ub2RlICYmICFpc19oZWFkKHBhcmVudF9ub2RlKSA/IG51bGwgOiAnZGV0YWNoaW5nJztcbiAgICAgICAgaWYgKHRoaXMubm9kZS5lbHNlKSB7XG4gICAgICAgICAgICB0aGlzLmJyYW5jaGVzLmZvckVhY2goYnJhbmNoID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYnJhbmNoLnNuaXBwZXQpXG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZShicmFuY2guY29uZGl0aW9uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGhhc19vdXRyb3MpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcl9jb21wb3VuZF93aXRoX291dHJvcyhibG9jaywgcGFyZW50X25vZGUsIHBhcmVudF9ub2RlcywgZHluYW1pYywgdmFycywgZGV0YWNoaW5nKTtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3Mub3V0cm8ucHVzaChiIGBAdHJhbnNpdGlvbl9vdXQoJHtuYW1lfSk7YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcl9jb21wb3VuZChibG9jaywgcGFyZW50X25vZGUsIHBhcmVudF9ub2RlcywgZHluYW1pYywgdmFycywgZGV0YWNoaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyX3NpbXBsZShibG9jaywgcGFyZW50X25vZGUsIHBhcmVudF9ub2RlcywgZHluYW1pYywgdmFycywgZGV0YWNoaW5nKTtcbiAgICAgICAgICAgIGlmIChoYXNfb3V0cm9zKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLm91dHJvLnB1c2goYiBgQHRyYW5zaXRpb25fb3V0KCR7bmFtZX0pO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpZl9leGlzdHNfY29uZGl0aW9uKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuY3JlYXRlLnB1c2goYiBgaWYgKCR7aWZfZXhpc3RzX2NvbmRpdGlvbn0pICR7bmFtZX0uYygpO2ApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYCR7bmFtZX0uYygpO2ApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJlbnRfbm9kZXMgJiYgdGhpcy5yZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUpIHtcbiAgICAgICAgICAgIGlmIChpZl9leGlzdHNfY29uZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNsYWltLnB1c2goYiBgaWYgKCR7aWZfZXhpc3RzX2NvbmRpdGlvbn0pICR7bmFtZX0ubCgke3BhcmVudF9ub2Rlc30pO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNsYWltLnB1c2goYiBgJHtuYW1lfS5sKCR7cGFyZW50X25vZGVzfSk7YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc19pbnRyb3MgfHwgaGFzX291dHJvcykge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmludHJvLnB1c2goYiBgQHRyYW5zaXRpb25faW4oJHtuYW1lfSk7YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5lZWRzX2FuY2hvcikge1xuICAgICAgICAgICAgYmxvY2suYWRkX2VsZW1lbnQoYW5jaG9yLCB4IGBAZW1wdHkoKWAsIHBhcmVudF9ub2RlcyAmJiB4IGBAZW1wdHkoKWAsIHBhcmVudF9ub2RlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJyYW5jaGVzLmZvckVhY2goYnJhbmNoID0+IHtcbiAgICAgICAgICAgIGJyYW5jaC5mcmFnbWVudC5yZW5kZXIoYnJhbmNoLmJsb2NrLCBudWxsLCB4IGAjbm9kZXNgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlcl9jb21wb3VuZChibG9jaywgcGFyZW50X25vZGUsIF9wYXJlbnRfbm9kZXMsIGR5bmFtaWMsIHsgbmFtZSwgYW5jaG9yLCBoYXNfZWxzZSwgaWZfZXhpc3RzX2NvbmRpdGlvbiwgaGFzX3RyYW5zaXRpb25zIH0sIGRldGFjaGluZykge1xuICAgICAgICBjb25zdCBzZWxlY3RfYmxvY2tfdHlwZSA9IHRoaXMucmVuZGVyZXIuY29tcG9uZW50LmdldF91bmlxdWVfbmFtZSgnc2VsZWN0X2Jsb2NrX3R5cGUnKTtcbiAgICAgICAgY29uc3QgY3VycmVudF9ibG9ja190eXBlID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdjdXJyZW50X2Jsb2NrX3R5cGUnKTtcbiAgICAgICAgY29uc3QgZ2V0X2Jsb2NrID0gaGFzX2Vsc2VcbiAgICAgICAgICAgID8geCBgJHtjdXJyZW50X2Jsb2NrX3R5cGV9KCNjdHgpYFxuICAgICAgICAgICAgOiB4IGAke2N1cnJlbnRfYmxvY2tfdHlwZX0gJiYgJHtjdXJyZW50X2Jsb2NrX3R5cGV9KCNjdHgpYDtcbiAgICAgICAgaWYgKHRoaXMubmVlZHNfdXBkYXRlKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0XHRmdW5jdGlvbiAke3NlbGVjdF9ibG9ja190eXBlfSgjY3R4LCAjZGlydHkpIHtcblx0XHRcdFx0XHQke3RoaXMuYnJhbmNoZXMubWFwKCh7IGRlcGVuZGVuY2llcywgY29uZGl0aW9uLCBzbmlwcGV0IH0pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYiBgJHtzbmlwcGV0ICYmIGRlcGVuZGVuY2llcy5sZW5ndGggPiAwID8gYiBgaWYgKCR7YmxvY2sucmVuZGVyZXIuZGlydHkoZGVwZW5kZW5jaWVzKX0pICR7Y29uZGl0aW9ufSA9IG51bGw7YCA6IG51bGx9YDtcbiAgICAgICAgICAgIH0pfVxuXHRcdFx0XHRcdCR7dGhpcy5icmFuY2hlcy5tYXAoKHsgY29uZGl0aW9uLCBzbmlwcGV0LCBibG9jayB9KSA9PiBjb25kaXRpb25cbiAgICAgICAgICAgICAgICA/IGIgYFxuXHRcdFx0XHRcdFx0JHtzbmlwcGV0ICYmIGIgYGlmICgke2NvbmRpdGlvbn0gPT0gbnVsbCkgJHtjb25kaXRpb259ID0gISEke3NuaXBwZXR9YH1cblx0XHRcdFx0XHRcdGlmICgke2NvbmRpdGlvbn0pIHJldHVybiAke2Jsb2NrLm5hbWV9O2BcbiAgICAgICAgICAgICAgICA6IGIgYHJldHVybiAke2Jsb2NrLm5hbWV9O2ApfVxuXHRcdFx0XHR9XG5cdFx0XHRgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRcdGZ1bmN0aW9uICR7c2VsZWN0X2Jsb2NrX3R5cGV9KCNjdHgsICNkaXJ0eSkge1xuXHRcdFx0XHRcdCR7dGhpcy5icmFuY2hlcy5tYXAoKHsgY29uZGl0aW9uLCBzbmlwcGV0LCBibG9jayB9KSA9PiBjb25kaXRpb25cbiAgICAgICAgICAgICAgICA/IGIgYGlmICgke3NuaXBwZXQgfHwgY29uZGl0aW9ufSkgcmV0dXJuICR7YmxvY2submFtZX07YFxuICAgICAgICAgICAgICAgIDogYiBgcmV0dXJuICR7YmxvY2submFtZX07YCl9XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRsZXQgJHtjdXJyZW50X2Jsb2NrX3R5cGV9ID0gJHtzZWxlY3RfYmxvY2tfdHlwZX0oI2N0eCwgJHt0aGlzLnJlbmRlcmVyLmdldF9pbml0aWFsX2RpcnR5KCl9KTtcblx0XHRcdGxldCAke25hbWV9ID0gJHtnZXRfYmxvY2t9O1xuXHRcdGApO1xuICAgICAgICBjb25zdCBpbml0aWFsX21vdW50X25vZGUgPSBwYXJlbnRfbm9kZSB8fCAnI3RhcmdldCc7XG4gICAgICAgIGNvbnN0IGFuY2hvcl9ub2RlID0gcGFyZW50X25vZGUgPyAnbnVsbCcgOiAnI2FuY2hvcic7XG4gICAgICAgIGlmIChpZl9leGlzdHNfY29uZGl0aW9uKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChiIGBpZiAoJHtpZl9leGlzdHNfY29uZGl0aW9ufSkgJHtuYW1lfS5tKCR7aW5pdGlhbF9tb3VudF9ub2RlfSwgJHthbmNob3Jfbm9kZX0pO2ApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLm1vdW50LnB1c2goYiBgJHtuYW1lfS5tKCR7aW5pdGlhbF9tb3VudF9ub2RlfSwgJHthbmNob3Jfbm9kZX0pO2ApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5lZWRzX3VwZGF0ZSkge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlX21vdW50X25vZGUgPSB0aGlzLmdldF91cGRhdGVfbW91bnRfbm9kZShhbmNob3IpO1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlX2Jsb2NrID0gYiBgXG5cdFx0XHRcdCR7aWZfZXhpc3RzX2NvbmRpdGlvbiA/IGIgYGlmICgke2lmX2V4aXN0c19jb25kaXRpb259KSAke25hbWV9LmQoMSlgIDogYiBgJHtuYW1lfS5kKDEpYH07XG5cdFx0XHRcdCR7bmFtZX0gPSAke2dldF9ibG9ja307XG5cdFx0XHRcdGlmICgke25hbWV9KSB7XG5cdFx0XHRcdFx0JHtuYW1lfS5jKCk7XG5cdFx0XHRcdFx0JHtoYXNfdHJhbnNpdGlvbnMgJiYgYiBgQHRyYW5zaXRpb25faW4oJHtuYW1lfSwgMSk7YH1cblx0XHRcdFx0XHQke25hbWV9Lm0oJHt1cGRhdGVfbW91bnRfbm9kZX0sICR7YW5jaG9yfSk7XG5cdFx0XHRcdH1cblx0XHRcdGA7XG4gICAgICAgICAgICBpZiAoZHluYW1pYykge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0XHRpZiAoJHtjdXJyZW50X2Jsb2NrX3R5cGV9ID09PSAoJHtjdXJyZW50X2Jsb2NrX3R5cGV9ID0gJHtzZWxlY3RfYmxvY2tfdHlwZX0oI2N0eCwgI2RpcnR5KSkgJiYgJHtuYW1lfSkge1xuXHRcdFx0XHRcdFx0JHtuYW1lfS5wKCNjdHgsICNkaXJ0eSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdCR7Y2hhbmdlX2Jsb2NrfVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHRcdFx0aWYgKCR7Y3VycmVudF9ibG9ja190eXBlfSAhPT0gKCR7Y3VycmVudF9ibG9ja190eXBlfSA9ICR7c2VsZWN0X2Jsb2NrX3R5cGV9KCNjdHgsICNkaXJ0eSkpKSB7XG5cdFx0XHRcdFx0XHQke2NoYW5nZV9ibG9ja31cblx0XHRcdFx0XHR9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGR5bmFtaWMpIHtcbiAgICAgICAgICAgIGlmIChpZl9leGlzdHNfY29uZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYGlmICgke2lmX2V4aXN0c19jb25kaXRpb259KSAke25hbWV9LnAoI2N0eCwgI2RpcnR5KTtgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGAke25hbWV9LnAoI2N0eCwgI2RpcnR5KTtgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaWZfZXhpc3RzX2NvbmRpdGlvbikge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmRlc3Ryb3kucHVzaChiIGBcblx0XHRcdFx0aWYgKCR7aWZfZXhpc3RzX2NvbmRpdGlvbn0pIHtcblx0XHRcdFx0XHQke25hbWV9LmQoJHtkZXRhY2hpbmd9KTtcblx0XHRcdFx0fVxuXHRcdFx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYFxuXHRcdFx0XHQke25hbWV9LmQoJHtkZXRhY2hpbmd9KTtcblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGlmIGFueSBvZiB0aGUgc2libGluZ3MgaGF2ZSBvdXRyb3MsIHdlIG5lZWQgdG8ga2VlcCByZWZlcmVuY2VzIHRvIHRoZSBibG9ja3NcbiAgICAvLyAoVE9ETyBkb2VzIHRoaXMgb25seSBhcHBseSB0byBiaWRpIHRyYW5zaXRpb25zPylcbiAgICByZW5kZXJfY29tcG91bmRfd2l0aF9vdXRyb3MoYmxvY2ssIHBhcmVudF9ub2RlLCBfcGFyZW50X25vZGVzLCBkeW5hbWljLCB7IG5hbWUsIGFuY2hvciwgaGFzX2Vsc2UsIGhhc190cmFuc2l0aW9ucywgaWZfZXhpc3RzX2NvbmRpdGlvbiB9LCBkZXRhY2hpbmcpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0X2Jsb2NrX3R5cGUgPSB0aGlzLnJlbmRlcmVyLmNvbXBvbmVudC5nZXRfdW5pcXVlX25hbWUoJ3NlbGVjdF9ibG9ja190eXBlJyk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRfYmxvY2tfdHlwZV9pbmRleCA9IGJsb2NrLmdldF91bmlxdWVfbmFtZSgnY3VycmVudF9ibG9ja190eXBlX2luZGV4Jyk7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzX2Jsb2NrX2luZGV4ID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdwcmV2aW91c19ibG9ja19pbmRleCcpO1xuICAgICAgICBjb25zdCBpZl9ibG9ja19jcmVhdG9ycyA9IGJsb2NrLmdldF91bmlxdWVfbmFtZSgnaWZfYmxvY2tfY3JlYXRvcnMnKTtcbiAgICAgICAgY29uc3QgaWZfYmxvY2tzID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdpZl9ibG9ja3MnKTtcbiAgICAgICAgY29uc3QgaWZfY3VycmVudF9ibG9ja190eXBlX2luZGV4ID0gaGFzX2Vsc2VcbiAgICAgICAgICAgID8gbm9kZXMgPT4gbm9kZXNcbiAgICAgICAgICAgIDogbm9kZXMgPT4gYiBgaWYgKH4ke2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleH0pIHsgJHtub2Rlc30gfWA7XG4gICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZShjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXgpO1xuICAgICAgICBibG9jay5hZGRfdmFyaWFibGUobmFtZSk7XG4gICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRjb25zdCAke2lmX2Jsb2NrX2NyZWF0b3JzfSA9IFtcblx0XHRcdFx0JHt0aGlzLmJyYW5jaGVzLm1hcChicmFuY2ggPT4gYnJhbmNoLmJsb2NrLm5hbWUpfVxuXHRcdFx0XTtcblxuXHRcdFx0Y29uc3QgJHtpZl9ibG9ja3N9ID0gW107XG5cblx0XHRcdCR7dGhpcy5uZWVkc191cGRhdGVcbiAgICAgICAgICAgID8gYiBgXG5cdFx0XHRcdFx0ZnVuY3Rpb24gJHtzZWxlY3RfYmxvY2tfdHlwZX0oI2N0eCwgI2RpcnR5KSB7XG5cdFx0XHRcdFx0XHQke3RoaXMuYnJhbmNoZXMubWFwKCh7IGRlcGVuZGVuY2llcywgY29uZGl0aW9uLCBzbmlwcGV0IH0pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYiBgJHtzbmlwcGV0ICYmIGRlcGVuZGVuY2llcy5sZW5ndGggPiAwID8gYiBgaWYgKCR7YmxvY2sucmVuZGVyZXIuZGlydHkoZGVwZW5kZW5jaWVzKX0pICR7Y29uZGl0aW9ufSA9IG51bGw7YCA6IG51bGx9YDtcbiAgICAgICAgICAgIH0pfVxuXHRcdFx0XHRcdFx0JHt0aGlzLmJyYW5jaGVzLm1hcCgoeyBjb25kaXRpb24sIHNuaXBwZXQgfSwgaSkgPT4gY29uZGl0aW9uXG4gICAgICAgICAgICAgICAgPyBiIGBcblx0XHRcdFx0XHRcdCR7c25pcHBldCAmJiBiIGBpZiAoJHtjb25kaXRpb259ID09IG51bGwpICR7Y29uZGl0aW9ufSA9ICEhJHtzbmlwcGV0fWB9XG5cdFx0XHRcdFx0XHRpZiAoJHtjb25kaXRpb259KSByZXR1cm4gJHtpfTtgXG4gICAgICAgICAgICAgICAgOiBiIGByZXR1cm4gJHtpfTtgKX1cblx0XHRcdFx0XHRcdCR7IWhhc19lbHNlICYmIGIgYHJldHVybiAtMTtgfVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0YFxuICAgICAgICAgICAgOiBiIGBcblx0XHRcdFx0XHRmdW5jdGlvbiAke3NlbGVjdF9ibG9ja190eXBlfSgjY3R4LCAjZGlydHkpIHtcblx0XHRcdFx0XHRcdCR7dGhpcy5icmFuY2hlcy5tYXAoKHsgY29uZGl0aW9uLCBzbmlwcGV0IH0sIGkpID0+IGNvbmRpdGlvblxuICAgICAgICAgICAgICAgID8gYiBgaWYgKCR7c25pcHBldCB8fCBjb25kaXRpb259KSByZXR1cm4gJHtpfTtgXG4gICAgICAgICAgICAgICAgOiBiIGByZXR1cm4gJHtpfTtgKX1cblx0XHRcdFx0XHRcdCR7IWhhc19lbHNlICYmIGIgYHJldHVybiAtMTtgfVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0YH1cblx0XHRgKTtcbiAgICAgICAgaWYgKGhhc19lbHNlKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0XHQke2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleH0gPSAke3NlbGVjdF9ibG9ja190eXBlfSgjY3R4LCAke3RoaXMucmVuZGVyZXIuZ2V0X2luaXRpYWxfZGlydHkoKX0pO1xuXHRcdFx0XHQke25hbWV9ID0gJHtpZl9ibG9ja3N9WyR7Y3VycmVudF9ibG9ja190eXBlX2luZGV4fV0gPSAke2lmX2Jsb2NrX2NyZWF0b3JzfVske2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleH1dKCNjdHgpO1xuXHRcdFx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0XHRpZiAofigke2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleH0gPSAke3NlbGVjdF9ibG9ja190eXBlfSgjY3R4LCAke3RoaXMucmVuZGVyZXIuZ2V0X2luaXRpYWxfZGlydHkoKX0pKSkge1xuXHRcdFx0XHRcdCR7bmFtZX0gPSAke2lmX2Jsb2Nrc31bJHtjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXh9XSA9ICR7aWZfYmxvY2tfY3JlYXRvcnN9WyR7Y3VycmVudF9ibG9ja190eXBlX2luZGV4fV0oI2N0eCk7XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGluaXRpYWxfbW91bnRfbm9kZSA9IHBhcmVudF9ub2RlIHx8ICcjdGFyZ2V0JztcbiAgICAgICAgY29uc3QgYW5jaG9yX25vZGUgPSBwYXJlbnRfbm9kZSA/ICdudWxsJyA6ICcjYW5jaG9yJztcbiAgICAgICAgYmxvY2suY2h1bmtzLm1vdW50LnB1c2goaWZfY3VycmVudF9ibG9ja190eXBlX2luZGV4KGIgYCR7aWZfYmxvY2tzfVske2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleH1dLm0oJHtpbml0aWFsX21vdW50X25vZGV9LCAke2FuY2hvcl9ub2RlfSk7YCkpO1xuICAgICAgICBpZiAodGhpcy5uZWVkc191cGRhdGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZV9tb3VudF9ub2RlID0gdGhpcy5nZXRfdXBkYXRlX21vdW50X25vZGUoYW5jaG9yKTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3Ryb3lfb2xkX2Jsb2NrID0gYiBgXG5cdFx0XHRcdEBncm91cF9vdXRyb3MoKTtcblx0XHRcdFx0QHRyYW5zaXRpb25fb3V0KCR7aWZfYmxvY2tzfVske3ByZXZpb3VzX2Jsb2NrX2luZGV4fV0sIDEsIDEsICgpID0+IHtcblx0XHRcdFx0XHQke2lmX2Jsb2Nrc31bJHtwcmV2aW91c19ibG9ja19pbmRleH1dID0gbnVsbDtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdEBjaGVja19vdXRyb3MoKTtcblx0XHRcdGA7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVfbmV3X2Jsb2NrID0gYiBgXG5cdFx0XHRcdCR7bmFtZX0gPSAke2lmX2Jsb2Nrc31bJHtjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXh9XTtcblx0XHRcdFx0aWYgKCEke25hbWV9KSB7XG5cdFx0XHRcdFx0JHtuYW1lfSA9ICR7aWZfYmxvY2tzfVske2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleH1dID0gJHtpZl9ibG9ja19jcmVhdG9yc31bJHtjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXh9XSgjY3R4KTtcblx0XHRcdFx0XHQke25hbWV9LmMoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQke2R5bmFtaWMgJiYgYiBgJHtuYW1lfS5wKCNjdHgsICNkaXJ0eSk7YH1cblx0XHRcdFx0fVxuXHRcdFx0XHQke2hhc190cmFuc2l0aW9ucyAmJiBiIGBAdHJhbnNpdGlvbl9pbigke25hbWV9LCAxKTtgfVxuXHRcdFx0XHQke25hbWV9Lm0oJHt1cGRhdGVfbW91bnRfbm9kZX0sICR7YW5jaG9yfSk7XG5cdFx0XHRgO1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlX2Jsb2NrID0gaGFzX2Vsc2VcbiAgICAgICAgICAgICAgICA/IGIgYFxuXHRcdFx0XHRcdCR7ZGVzdHJveV9vbGRfYmxvY2t9XG5cblx0XHRcdFx0XHQke2NyZWF0ZV9uZXdfYmxvY2t9XG5cdFx0XHRcdGBcbiAgICAgICAgICAgICAgICA6IGIgYFxuXHRcdFx0XHRcdGlmICgke25hbWV9KSB7XG5cdFx0XHRcdFx0XHQke2Rlc3Ryb3lfb2xkX2Jsb2NrfVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh+JHtjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXh9KSB7XG5cdFx0XHRcdFx0XHQke2NyZWF0ZV9uZXdfYmxvY2t9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdCR7bmFtZX0gPSBudWxsO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0YDtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0bGV0ICR7cHJldmlvdXNfYmxvY2tfaW5kZXh9ID0gJHtjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXh9O1xuXHRcdFx0XHQke2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleH0gPSAke3NlbGVjdF9ibG9ja190eXBlfSgjY3R4LCAjZGlydHkpO1xuXHRcdFx0YCk7XG4gICAgICAgICAgICBpZiAoZHluYW1pYykge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0XHRpZiAoJHtjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXh9ID09PSAke3ByZXZpb3VzX2Jsb2NrX2luZGV4fSkge1xuXHRcdFx0XHRcdFx0JHtpZl9jdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXgoYiBgJHtpZl9ibG9ja3N9WyR7Y3VycmVudF9ibG9ja190eXBlX2luZGV4fV0ucCgjY3R4LCAjZGlydHkpO2ApfVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQke2NoYW5nZV9ibG9ja31cblx0XHRcdFx0XHR9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICgke2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleH0gIT09ICR7cHJldmlvdXNfYmxvY2tfaW5kZXh9KSB7XG5cdFx0XHRcdFx0XHQke2NoYW5nZV9ibG9ja31cblx0XHRcdFx0XHR9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGR5bmFtaWMpIHtcbiAgICAgICAgICAgIGlmIChpZl9leGlzdHNfY29uZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYGlmICgke2lmX2V4aXN0c19jb25kaXRpb259KSAke25hbWV9LnAoI2N0eCwgI2RpcnR5KTtgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGAke25hbWV9LnAoI2N0eCwgI2RpcnR5KTtgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGlmX2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleChiIGAke2lmX2Jsb2Nrc31bJHtjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXh9XS5kKCR7ZGV0YWNoaW5nfSk7YCkpO1xuICAgIH1cbiAgICByZW5kZXJfc2ltcGxlKGJsb2NrLCBwYXJlbnRfbm9kZSwgX3BhcmVudF9ub2RlcywgZHluYW1pYywgeyBuYW1lLCBhbmNob3IsIGlmX2V4aXN0c19jb25kaXRpb24sIGhhc190cmFuc2l0aW9ucyB9LCBkZXRhY2hpbmcpIHtcbiAgICAgICAgY29uc3QgYnJhbmNoID0gdGhpcy5icmFuY2hlc1swXTtcbiAgICAgICAgaWYgKGJyYW5jaC5zbmlwcGV0KVxuICAgICAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKGJyYW5jaC5jb25kaXRpb24sIGJyYW5jaC5zbmlwcGV0KTtcbiAgICAgICAgYmxvY2suY2h1bmtzLmluaXQucHVzaChiIGBcblx0XHRcdGxldCAke25hbWV9ID0gJHticmFuY2guY29uZGl0aW9ufSAmJiAke2JyYW5jaC5ibG9jay5uYW1lfSgjY3R4KTtcblx0XHRgKTtcbiAgICAgICAgY29uc3QgaW5pdGlhbF9tb3VudF9ub2RlID0gcGFyZW50X25vZGUgfHwgJyN0YXJnZXQnO1xuICAgICAgICBjb25zdCBhbmNob3Jfbm9kZSA9IHBhcmVudF9ub2RlID8gJ251bGwnIDogJyNhbmNob3InO1xuICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChiIGBpZiAoJHtuYW1lfSkgJHtuYW1lfS5tKCR7aW5pdGlhbF9tb3VudF9ub2RlfSwgJHthbmNob3Jfbm9kZX0pO2ApO1xuICAgICAgICBpZiAoYnJhbmNoLmRlcGVuZGVuY2llcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVfbW91bnRfbm9kZSA9IHRoaXMuZ2V0X3VwZGF0ZV9tb3VudF9ub2RlKGFuY2hvcik7XG4gICAgICAgICAgICBjb25zdCBlbnRlciA9IGIgYFxuXHRcdFx0XHRpZiAoJHtuYW1lfSkge1xuXHRcdFx0XHRcdCR7ZHluYW1pYyAmJiBiIGAke25hbWV9LnAoI2N0eCwgI2RpcnR5KTtgfVxuXHRcdFx0XHRcdCR7aGFzX3RyYW5zaXRpb25zICYmXG4gICAgICAgICAgICAgICAgYiBgaWYgKCR7YmxvY2sucmVuZGVyZXIuZGlydHkoYnJhbmNoLmRlcGVuZGVuY2llcyl9KSB7XG5cdFx0XHRcdFx0XHRcdEB0cmFuc2l0aW9uX2luKCR7bmFtZX0sIDEpO1xuXHRcdFx0XHRcdFx0fWB9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JHtuYW1lfSA9ICR7YnJhbmNoLmJsb2NrLm5hbWV9KCNjdHgpO1xuXHRcdFx0XHRcdCR7bmFtZX0uYygpO1xuXHRcdFx0XHRcdCR7aGFzX3RyYW5zaXRpb25zICYmIGIgYEB0cmFuc2l0aW9uX2luKCR7bmFtZX0sIDEpO2B9XG5cdFx0XHRcdFx0JHtuYW1lfS5tKCR7dXBkYXRlX21vdW50X25vZGV9LCAke2FuY2hvcn0pO1xuXHRcdFx0XHR9XG5cdFx0XHRgO1xuICAgICAgICAgICAgaWYgKGJyYW5jaC5zbmlwcGV0KSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYGlmICgke2Jsb2NrLnJlbmRlcmVyLmRpcnR5KGJyYW5jaC5kZXBlbmRlbmNpZXMpfSkgJHticmFuY2guY29uZGl0aW9ufSA9ICR7YnJhbmNoLnNuaXBwZXR9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBubyBgcCgpYCBoZXJlIOKAlCB3ZSBkb24ndCB3YW50IHRvIHVwZGF0ZSBvdXRyb2luZyBub2RlcyxcbiAgICAgICAgICAgIC8vIGFzIHRoYXQgd2lsbCB0eXBpY2FsbHkgcmVzdWx0IGluIGdsaXRjaGluZ1xuICAgICAgICAgICAgaWYgKGJyYW5jaC5ibG9jay5oYXNfb3V0cm9fbWV0aG9kKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICgke2JyYW5jaC5jb25kaXRpb259KSB7XG5cdFx0XHRcdFx0XHQke2VudGVyfVxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoJHtuYW1lfSkge1xuXHRcdFx0XHRcdFx0QGdyb3VwX291dHJvcygpO1xuXHRcdFx0XHRcdFx0QHRyYW5zaXRpb25fb3V0KCR7bmFtZX0sIDEsIDEsICgpID0+IHtcblx0XHRcdFx0XHRcdFx0JHtuYW1lfSA9IG51bGw7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdEBjaGVja19vdXRyb3MoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICgke2JyYW5jaC5jb25kaXRpb259KSB7XG5cdFx0XHRcdFx0XHQke2VudGVyfVxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoJHtuYW1lfSkge1xuXHRcdFx0XHRcdFx0JHtuYW1lfS5kKDEpO1xuXHRcdFx0XHRcdFx0JHtuYW1lfSA9IG51bGw7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkeW5hbWljKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHRcdGlmICgke2JyYW5jaC5jb25kaXRpb259KSAke25hbWV9LnAoI2N0eCwgI2RpcnR5KTtcblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpZl9leGlzdHNfY29uZGl0aW9uKSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYFxuXHRcdFx0XHRpZiAoJHtpZl9leGlzdHNfY29uZGl0aW9ufSkgJHtuYW1lfS5kKCR7ZGV0YWNoaW5nfSk7XG5cdFx0XHRgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5kZXN0cm95LnB1c2goYiBgXG5cdFx0XHRcdCR7bmFtZX0uZCgke2RldGFjaGluZ30pO1xuXHRcdFx0YCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNsYXNzIEtleUJsb2NrV3JhcHBlciBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlLCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpIHtcbiAgICAgICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpO1xuICAgICAgICB0aGlzLnZhciA9IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiAna2V5X2Jsb2NrJyB9O1xuICAgICAgICB0aGlzLmNhbm5vdF91c2VfaW5uZXJodG1sKCk7XG4gICAgICAgIHRoaXMubm90X3N0YXRpY19jb250ZW50KCk7XG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gbm9kZS5leHByZXNzaW9uLmR5bmFtaWNfZGVwZW5kZW5jaWVzKCk7XG4gICAgICAgIGlmICh0aGlzLmRlcGVuZGVuY2llcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGJsb2NrID0gYmxvY2suY2hpbGQoe1xuICAgICAgICAgICAgICAgIGNvbW1lbnQ6IGNyZWF0ZV9kZWJ1Z2dpbmdfY29tbWVudChub2RlLCByZW5kZXJlci5jb21wb25lbnQpLFxuICAgICAgICAgICAgICAgIG5hbWU6IHJlbmRlcmVyLmNvbXBvbmVudC5nZXRfdW5pcXVlX25hbWUoJ2NyZWF0ZV9rZXlfYmxvY2snKSxcbiAgICAgICAgICAgICAgICB0eXBlOiAna2V5J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZW5kZXJlci5ibG9ja3MucHVzaChibG9jayk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ibG9jayA9IGJsb2NrO1xuICAgICAgICB0aGlzLmZyYWdtZW50ID0gbmV3IEZyYWdtZW50V3JhcHBlcihyZW5kZXJlciwgdGhpcy5ibG9jaywgbm9kZS5jaGlsZHJlbiwgdGhpcywgc3RyaXBfd2hpdGVzcGFjZSwgbmV4dF9zaWJsaW5nKTtcbiAgICB9XG4gICAgcmVuZGVyKGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKSB7XG4gICAgICAgIGlmICh0aGlzLmRlcGVuZGVuY2llcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyX3N0YXRpY19rZXkoYmxvY2ssIHBhcmVudF9ub2RlLCBwYXJlbnRfbm9kZXMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJfZHluYW1pY19rZXkoYmxvY2ssIHBhcmVudF9ub2RlLCBwYXJlbnRfbm9kZXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcl9zdGF0aWNfa2V5KF9ibG9jaywgcGFyZW50X25vZGUsIHBhcmVudF9ub2Rlcykge1xuICAgICAgICB0aGlzLmZyYWdtZW50LnJlbmRlcih0aGlzLmJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKTtcbiAgICB9XG4gICAgcmVuZGVyX2R5bmFtaWNfa2V5KGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKSB7XG4gICAgICAgIHRoaXMuZnJhZ21lbnQucmVuZGVyKHRoaXMuYmxvY2ssIG51bGwsIHggYCNub2Rlc2ApO1xuICAgICAgICBjb25zdCBoYXNfdHJhbnNpdGlvbnMgPSAhISh0aGlzLmJsb2NrLmhhc19pbnRyb19tZXRob2QgfHwgdGhpcy5ibG9jay5oYXNfb3V0cm9fbWV0aG9kKTtcbiAgICAgICAgY29uc3QgZHluYW1pYyA9IHRoaXMuYmxvY2suaGFzX3VwZGF0ZV9tZXRob2Q7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzX2tleSA9IGJsb2NrLmdldF91bmlxdWVfbmFtZSgncHJldmlvdXNfa2V5Jyk7XG4gICAgICAgIGNvbnN0IHNuaXBwZXQgPSB0aGlzLm5vZGUuZXhwcmVzc2lvbi5tYW5pcHVsYXRlKGJsb2NrKTtcbiAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKHByZXZpb3VzX2tleSwgc25pcHBldCk7XG4gICAgICAgIGNvbnN0IG5vdF9lcXVhbCA9IHRoaXMucmVuZGVyZXIuY29tcG9uZW50LmNvbXBvbmVudF9vcHRpb25zLmltbXV0YWJsZSA/IHggYEBub3RfZXF1YWxgIDogeCBgQHNhZmVfbm90X2VxdWFsYDtcbiAgICAgICAgY29uc3QgY29uZGl0aW9uID0geCBgJHt0aGlzLnJlbmRlcmVyLmRpcnR5KHRoaXMuZGVwZW5kZW5jaWVzKX0gJiYgJHtub3RfZXF1YWx9KCR7cHJldmlvdXNfa2V5fSwgJHtwcmV2aW91c19rZXl9ID0gJHtzbmlwcGV0fSlgO1xuICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0bGV0ICR7dGhpcy52YXJ9ID0gJHt0aGlzLmJsb2NrLm5hbWV9KCNjdHgpO1xuXHRcdGApO1xuICAgICAgICBibG9jay5jaHVua3MuY3JlYXRlLnB1c2goYiBgJHt0aGlzLnZhcn0uYygpO2ApO1xuICAgICAgICBpZiAodGhpcy5yZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUpIHtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5jbGFpbS5wdXNoKGIgYCR7dGhpcy52YXJ9LmwoJHtwYXJlbnRfbm9kZXN9KTtgKTtcbiAgICAgICAgfVxuICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChiIGAke3RoaXMudmFyfS5tKCR7cGFyZW50X25vZGUgfHwgJyN0YXJnZXQnfSwgJHtwYXJlbnRfbm9kZSA/ICdudWxsJyA6ICcjYW5jaG9yJ30pO2ApO1xuICAgICAgICBjb25zdCBhbmNob3IgPSB0aGlzLmdldF9vcl9jcmVhdGVfYW5jaG9yKGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKTtcbiAgICAgICAgY29uc3QgYm9keSA9IGIgYFxuXHRcdFx0JHtoYXNfdHJhbnNpdGlvbnNcbiAgICAgICAgICAgID8gYiBgXG5cdFx0XHRcdFx0XHRAZ3JvdXBfb3V0cm9zKCk7XG5cdFx0XHRcdFx0XHRAdHJhbnNpdGlvbl9vdXQoJHt0aGlzLnZhcn0sIDEsIDEsIEBub29wKTtcblx0XHRcdFx0XHRcdEBjaGVja19vdXRyb3MoKTtcblx0XHRcdFx0XHRgXG4gICAgICAgICAgICA6IGIgYCR7dGhpcy52YXJ9LmQoMSk7YH1cblx0XHRcdCR7dGhpcy52YXJ9ID0gJHt0aGlzLmJsb2NrLm5hbWV9KCNjdHgpO1xuXHRcdFx0JHt0aGlzLnZhcn0uYygpO1xuXHRcdFx0JHtoYXNfdHJhbnNpdGlvbnMgJiYgYiBgQHRyYW5zaXRpb25faW4oJHt0aGlzLnZhcn0pYH1cblx0XHRcdCR7dGhpcy52YXJ9Lm0oJHt0aGlzLmdldF91cGRhdGVfbW91bnRfbm9kZShhbmNob3IpfSwgJHthbmNob3J9KTtcblx0XHRgO1xuICAgICAgICBpZiAoZHluYW1pYykge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRpZiAoJHtjb25kaXRpb259KSB7XG5cdFx0XHRcdFx0JHtib2R5fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdCR7dGhpcy52YXJ9LnAoI2N0eCwgI2RpcnR5KTtcblx0XHRcdFx0fVxuXHRcdFx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHRcdGlmICgke2NvbmRpdGlvbn0pIHtcblx0XHRcdFx0XHQke2JvZHl9XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNfdHJhbnNpdGlvbnMpIHtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5pbnRyby5wdXNoKGIgYEB0cmFuc2l0aW9uX2luKCR7dGhpcy52YXJ9KWApO1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLm91dHJvLnB1c2goYiBgQHRyYW5zaXRpb25fb3V0KCR7dGhpcy52YXJ9KWApO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmNodW5rcy5kZXN0cm95LnB1c2goYiBgJHt0aGlzLnZhcn0uZChkZXRhY2hpbmcpYCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBnZXRfc2xvdF9kZWZpbml0aW9uKGJsb2NrLCBzY29wZSwgbGV0cykge1xuICAgIGlmIChsZXRzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuIHsgYmxvY2ssIHNjb3BlIH07XG4gICAgY29uc3QgY29udGV4dF9pbnB1dCA9IHtcbiAgICAgICAgdHlwZTogJ09iamVjdFBhdHRlcm4nLFxuICAgICAgICBwcm9wZXJ0aWVzOiBsZXRzLm1hcChsID0+ICh7XG4gICAgICAgICAgICB0eXBlOiAnUHJvcGVydHknLFxuICAgICAgICAgICAga2luZDogJ2luaXQnLFxuICAgICAgICAgICAga2V5OiBsLm5hbWUsXG4gICAgICAgICAgICB2YWx1ZTogbC52YWx1ZSB8fCBsLm5hbWVcbiAgICAgICAgfSkpXG4gICAgfTtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gW107XG4gICAgY29uc3QgdmFsdWVfbWFwID0gbmV3IE1hcCgpO1xuICAgIGxldHMuZm9yRWFjaChsID0+IHtcbiAgICAgICAgbGV0IHZhbHVlO1xuICAgICAgICBpZiAobC5uYW1lcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAvLyBtb3JlIHRoYW4gb25lLCBwcm9iYWJseSBkZXN0cnVjdHVyaW5nXG4gICAgICAgICAgICBjb25zdCB1bmlxdWVfbmFtZSA9IGJsb2NrLmdldF91bmlxdWVfbmFtZShsLm5hbWVzLmpvaW4oJ18nKSkubmFtZTtcbiAgICAgICAgICAgIHZhbHVlX21hcC5zZXQobC52YWx1ZSwgdW5pcXVlX25hbWUpO1xuICAgICAgICAgICAgdmFsdWUgPSB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogdW5pcXVlX25hbWUgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlID0gbC52YWx1ZSB8fCBsLm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgcHJvcGVydGllcy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6ICdQcm9wZXJ0eScsXG4gICAgICAgICAgICBraW5kOiAnaW5pdCcsXG4gICAgICAgICAgICBrZXk6IGwubmFtZSxcbiAgICAgICAgICAgIHZhbHVlXG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNvbnN0IGNoYW5nZXNfaW5wdXQgPSB7XG4gICAgICAgIHR5cGU6ICdPYmplY3RQYXR0ZXJuJyxcbiAgICAgICAgcHJvcGVydGllc1xuICAgIH07XG4gICAgY29uc3QgbmFtZXMgPSBuZXcgU2V0KCk7XG4gICAgY29uc3QgbmFtZXNfbG9va3VwID0gbmV3IE1hcCgpO1xuICAgIGxldHMuZm9yRWFjaChsID0+IHtcbiAgICAgICAgbC5uYW1lcy5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgICAgbmFtZXMuYWRkKG5hbWUpO1xuICAgICAgICAgICAgaWYgKHZhbHVlX21hcC5oYXMobC52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICBuYW1lc19sb29rdXAuc2V0KG5hbWUsIHZhbHVlX21hcC5nZXQobC52YWx1ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBjb25zdCBjb250ZXh0ID0ge1xuICAgICAgICB0eXBlOiAnT2JqZWN0RXhwcmVzc2lvbicsXG4gICAgICAgIHByb3BlcnRpZXM6IEFycmF5LmZyb20obmFtZXMpLm1hcChuYW1lID0+IHAgYCR7YmxvY2sucmVuZGVyZXIuY29udGV4dF9sb29rdXAuZ2V0KG5hbWUpLmluZGV4fTogJHtuYW1lfWApXG4gICAgfTtcbiAgICBjb25zdCB7IGNvbnRleHRfbG9va3VwIH0gPSBibG9jay5yZW5kZXJlcjtcbiAgICAvLyBpIGFtIHdlbGwgYXdhcmUgdGhhdCB0aGlzIGNvZGUgaXMgZ3Jvc3NcbiAgICAvLyBUT0RPOiBjb250ZXh0LW92ZXJmbG93IG1ha2UgaXQgbGVzcyBncm9zc1xuICAgIGNvbnN0IGNoYW5nZXMgPSB7XG4gICAgICAgIHR5cGU6ICdQYXJlbnRoZXNpemVkRXhwcmVzc2lvbicsXG4gICAgICAgIGdldCBleHByZXNzaW9uKCkge1xuICAgICAgICAgICAgaWYgKGJsb2NrLnJlbmRlcmVyLmNvbnRleHRfb3ZlcmZsb3cpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cGVkID0gW107XG4gICAgICAgICAgICAgICAgQXJyYXkuZnJvbShuYW1lcykuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IGNvbnRleHRfbG9va3VwLmdldChuYW1lKS5pbmRleC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZyA9IE1hdGguZmxvb3IoaSAvIDMxKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9va3VwX25hbWUgPSBuYW1lc19sb29rdXAuaGFzKG5hbWUpID8gbmFtZXNfbG9va3VwLmdldChuYW1lKSA6IG5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZ3JvdXBlZFtnXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwZWRbZ10gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBlZFtnXS5wdXNoKHsgbmFtZTogbG9va3VwX25hbWUsIG46IGkgJSAzMSB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGcgPSAwOyBnIDwgZ3JvdXBlZC5sZW5ndGg7IGcgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50c1tnXSA9IGdyb3VwZWRbZ11cbiAgICAgICAgICAgICAgICAgICAgICAgID8gZ3JvdXBlZFtnXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKHsgbmFtZSwgbiB9KSA9PiB4IGAke25hbWV9ID8gJHsxIDw8IG59IDogMGApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlZHVjZSgobGhzLCByaHMpID0+IHggYCR7bGhzfSB8ICR7cmhzfWApXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHggYDBgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQXJyYXlFeHByZXNzaW9uJyxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHNcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20obmFtZXMpXG4gICAgICAgICAgICAgICAgLm1hcChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBsb29rdXBfbmFtZSA9IG5hbWVzX2xvb2t1cC5oYXMobmFtZSkgPyBuYW1lc19sb29rdXAuZ2V0KG5hbWUpIDogbmFtZTtcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gY29udGV4dF9sb29rdXAuZ2V0KG5hbWUpLmluZGV4LnZhbHVlO1xuICAgICAgICAgICAgICAgIHJldHVybiB4IGAke2xvb2t1cF9uYW1lfSA/ICR7MSA8PCBpfSA6IDBgO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAucmVkdWNlKChsaHMsIHJocykgPT4geCBgJHtsaHN9IHwgJHtyaHN9YCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIGJsb2NrLFxuICAgICAgICBzY29wZSxcbiAgICAgICAgZ2V0X2NvbnRleHQ6IHggYCR7Y29udGV4dF9pbnB1dH0gPT4gJHtjb250ZXh0fWAsXG4gICAgICAgIGdldF9jaGFuZ2VzOiB4IGAke2NoYW5nZXNfaW5wdXR9ID0+ICR7Y2hhbmdlc31gXG4gICAgfTtcbn1cblxuY2xhc3MgU2xvdFRlbXBsYXRlV3JhcHBlciBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlLCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpIHtcbiAgICAgICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpO1xuICAgICAgICBjb25zdCB7IHNjb3BlLCBsZXRzLCBjb25zdF90YWdzLCBzbG90X3RlbXBsYXRlX25hbWUgfSA9IHRoaXMubm9kZTtcbiAgICAgICAgbGV0cy5mb3JFYWNoKGwgPT4ge1xuICAgICAgICAgICAgZXh0cmFjdF9uYW1lcyhsLnZhbHVlIHx8IGwubmFtZSkuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5hZGRfdG9fY29udGV4dChuYW1lLCB0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYWRkX2NvbnN0X3RhZ3NfY29udGV4dChyZW5kZXJlciwgY29uc3RfdGFncyk7XG4gICAgICAgIHRoaXMuYmxvY2sgPSBibG9jay5jaGlsZCh7XG4gICAgICAgICAgICBjb21tZW50OiBjcmVhdGVfZGVidWdnaW5nX2NvbW1lbnQodGhpcy5ub2RlLCB0aGlzLnJlbmRlcmVyLmNvbXBvbmVudCksXG4gICAgICAgICAgICBuYW1lOiB0aGlzLnJlbmRlcmVyLmNvbXBvbmVudC5nZXRfdW5pcXVlX25hbWUoYGNyZWF0ZV8ke3Nhbml0aXplKHNsb3RfdGVtcGxhdGVfbmFtZSl9X3Nsb3RgKSxcbiAgICAgICAgICAgIHR5cGU6ICdzbG90J1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5ibG9ja3MucHVzaCh0aGlzLmJsb2NrKTtcbiAgICAgICAgY29uc3Qgc2VlbiA9IG5ldyBTZXQobGV0cy5tYXAobCA9PiBsLm5hbWUubmFtZSkpO1xuICAgICAgICB0aGlzLnBhcmVudC5ub2RlLmxldHMuZm9yRWFjaChsID0+IHtcbiAgICAgICAgICAgIGlmICghc2Vlbi5oYXMobC5uYW1lLm5hbWUpKVxuICAgICAgICAgICAgICAgIGxldHMucHVzaChsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucGFyZW50LnNldF9zbG90KHNsb3RfdGVtcGxhdGVfbmFtZSwgZ2V0X3Nsb3RfZGVmaW5pdGlvbih0aGlzLmJsb2NrLCBzY29wZSwgbGV0cykpO1xuICAgICAgICB0aGlzLmZyYWdtZW50ID0gbmV3IEZyYWdtZW50V3JhcHBlcihyZW5kZXJlciwgdGhpcy5ibG9jaywgbm9kZS50eXBlID09PSAnU2xvdFRlbXBsYXRlJyA/IG5vZGUuY2hpbGRyZW4gOiBbbm9kZV0sIHRoaXMsIHN0cmlwX3doaXRlc3BhY2UsIG5leHRfc2libGluZyk7XG4gICAgICAgIHRoaXMuYmxvY2sucGFyZW50LmFkZF9kZXBlbmRlbmNpZXModGhpcy5ibG9jay5kZXBlbmRlbmNpZXMpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuZnJhZ21lbnQucmVuZGVyKHRoaXMuYmxvY2ssIG51bGwsIHggYCNub2Rlc2ApO1xuICAgICAgICBpZiAodGhpcy5ub2RlLmNvbnN0X3RhZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJfZ2V0X2NvbnRleHQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXJfZ2V0X2NvbnRleHQoKSB7XG4gICAgICAgIGNvbnN0IGdldF9jb250ZXh0ID0gdGhpcy5ibG9jay5yZW5kZXJlci5jb21wb25lbnQuZ2V0X3VuaXF1ZV9uYW1lKCdnZXRfY29udGV4dCcpO1xuICAgICAgICB0aGlzLmJsb2NrLnJlbmRlcmVyLmJsb2Nrcy5wdXNoKGIgYFxuXHRcdFx0ZnVuY3Rpb24gJHtnZXRfY29udGV4dH0oI2N0eCkge1xuXHRcdFx0XHQke2FkZF9jb25zdF90YWdzKHRoaXMuYmxvY2ssIHRoaXMubm9kZS5jb25zdF90YWdzLCAnI2N0eCcpfVxuXHRcdFx0fVxuXHRcdGApO1xuICAgICAgICB0aGlzLmJsb2NrLmNodW5rcy5kZWNsYXJhdGlvbnMucHVzaChiIGAke2dldF9jb250ZXh0fSgjY3R4KWApO1xuICAgICAgICBpZiAodGhpcy5ibG9jay5oYXNfdXBkYXRlX21ldGhvZCkge1xuICAgICAgICAgICAgdGhpcy5ibG9jay5jaHVua3MudXBkYXRlLnVuc2hpZnQoYiBgJHtnZXRfY29udGV4dH0oI2N0eClgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gc3RyaW5nX3RvX21lbWJlcl9leHByZXNzaW9uKG5hbWUpIHtcbiAgICBjb25zdCBwYXJ0cyA9IG5hbWUuc3BsaXQoJy4nKTtcbiAgICBsZXQgbm9kZSA9IHtcbiAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLFxuICAgICAgICBuYW1lOiBwYXJ0c1swXVxuICAgIH07XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBub2RlID0ge1xuICAgICAgICAgICAgdHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgICAgICAgICAgb2JqZWN0OiBub2RlLFxuICAgICAgICAgICAgcHJvcGVydHk6IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiBwYXJ0c1tpXSB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBub2RlO1xufVxuXG5jbGFzcyBJbmxpbmVDb21wb25lbnRXcmFwcGVyIGV4dGVuZHMgV3JhcHBlciB7XG4gICAgY29uc3RydWN0b3IocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUsIHN0cmlwX3doaXRlc3BhY2UsIG5leHRfc2libGluZykge1xuICAgICAgICBzdXBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSk7XG4gICAgICAgIHRoaXMuc2xvdHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgdGhpcy5jYW5ub3RfdXNlX2lubmVyaHRtbCgpO1xuICAgICAgICB0aGlzLm5vdF9zdGF0aWNfY29udGVudCgpO1xuICAgICAgICBpZiAodGhpcy5ub2RlLmV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgIGJsb2NrLmFkZF9kZXBlbmRlbmNpZXModGhpcy5ub2RlLmV4cHJlc3Npb24uZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5vZGUuYXR0cmlidXRlcy5mb3JFYWNoKGF0dHIgPT4ge1xuICAgICAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyhhdHRyLmRlcGVuZGVuY2llcyk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm5vZGUuYmluZGluZ3MuZm9yRWFjaChiaW5kaW5nID0+IHtcbiAgICAgICAgICAgIGlmIChiaW5kaW5nLmlzX2NvbnRleHR1YWwpIHtcbiAgICAgICAgICAgICAgICBtYXJrX2VhY2hfYmxvY2tfYmluZGluZ3ModGhpcywgYmluZGluZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBibG9jay5hZGRfZGVwZW5kZW5jaWVzKGJpbmRpbmcuZXhwcmVzc2lvbi5kZXBlbmRlbmNpZXMpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5ub2RlLmhhbmRsZXJzLmZvckVhY2goaGFuZGxlciA9PiB7XG4gICAgICAgICAgICBpZiAoaGFuZGxlci5leHByZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyhoYW5kbGVyLmV4cHJlc3Npb24uZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubm9kZS5jc3NfY3VzdG9tX3Byb3BlcnRpZXMuZm9yRWFjaChhdHRyID0+IHtcbiAgICAgICAgICAgIGJsb2NrLmFkZF9kZXBlbmRlbmNpZXMoYXR0ci5kZXBlbmRlbmNpZXMpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy52YXIgPSB7XG4gICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICBuYW1lOiAodGhpcy5ub2RlLm5hbWUgPT09ICdzdmVsdGU6c2VsZicgPyByZW5kZXJlci5jb21wb25lbnQubmFtZS5uYW1lIDpcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUubmFtZSA9PT0gJ3N2ZWx0ZTpjb21wb25lbnQnID8gJ3N3aXRjaF9pbnN0YW5jZScgOlxuICAgICAgICAgICAgICAgICAgICBzYW5pdGl6ZSh0aGlzLm5vZGUubmFtZSkpLnRvTG93ZXJDYXNlKClcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMubm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMubm9kZS5sZXRzLmZvckVhY2gobCA9PiB7XG4gICAgICAgICAgICAgICAgZXh0cmFjdF9uYW1lcyhsLnZhbHVlIHx8IGwubmFtZSkuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuYWRkX3RvX2NvbnRleHQobmFtZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4gPSB0aGlzLm5vZGUuY2hpbGRyZW4ubWFwKGNoaWxkID0+IG5ldyBTbG90VGVtcGxhdGVXcmFwcGVyKHJlbmRlcmVyLCBibG9jaywgdGhpcywgY2hpbGQsIHN0cmlwX3doaXRlc3BhY2UsIG5leHRfc2libGluZykpO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmFkZF9vdXRybygpO1xuICAgIH1cbiAgICBzZXRfc2xvdChuYW1lLCBzbG90X2RlZmluaXRpb24pIHtcbiAgICAgICAgaWYgKHRoaXMuc2xvdHMuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gJ2RlZmF1bHQnKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3VuZCBlbGVtZW50cyB3aXRob3V0IHNsb3QgYXR0cmlidXRlIHdoZW4gdXNpbmcgc2xvdD1cImRlZmF1bHRcIicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBEdXBsaWNhdGUgc2xvdCBuYW1lIFwiJHtuYW1lfVwiIGluIDwke3RoaXMubm9kZS5uYW1lfT5gKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNsb3RzLnNldChuYW1lLCBzbG90X2RlZmluaXRpb24pO1xuICAgIH1cbiAgICB3YXJuX2lmX3JlYWN0aXZlKCkge1xuICAgICAgICBjb25zdCB7IG5hbWUgfSA9IHRoaXMubm9kZTtcbiAgICAgICAgY29uc3QgdmFyaWFibGUgPSB0aGlzLnJlbmRlcmVyLmNvbXBvbmVudC52YXJfbG9va3VwLmdldChuYW1lKTtcbiAgICAgICAgaWYgKCF2YXJpYWJsZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YXJpYWJsZS5yZWFzc2lnbmVkIHx8IHZhcmlhYmxlLmV4cG9ydF9uYW1lIHx8IHZhcmlhYmxlLmlzX3JlYWN0aXZlX2RlcGVuZGVuY3kpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuY29tcG9uZW50Lndhcm4odGhpcy5ub2RlLCBjb21waWxlcl93YXJuaW5ncy5yZWFjdGl2ZV9jb21wb25lbnQobmFtZSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcihibG9jaywgcGFyZW50X25vZGUsIHBhcmVudF9ub2Rlcykge1xuICAgICAgICB0aGlzLndhcm5faWZfcmVhY3RpdmUoKTtcbiAgICAgICAgY29uc3QgeyByZW5kZXJlciB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBjb21wb25lbnQgfSA9IHJlbmRlcmVyO1xuICAgICAgICBjb25zdCBuYW1lID0gdGhpcy52YXI7XG4gICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZShuYW1lKTtcbiAgICAgICAgY29uc3QgY29tcG9uZW50X29wdHMgPSB4IGB7fWA7XG4gICAgICAgIGNvbnN0IHN0YXRlbWVudHMgPSBbXTtcbiAgICAgICAgY29uc3QgdXBkYXRlcyA9IFtdO1xuICAgICAgICB0aGlzLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZF90b19jb250ZXh0KCckJHNjb3BlJywgdHJ1ZSk7XG4gICAgICAgICAgICBjaGlsZC5yZW5kZXIoYmxvY2ssIG51bGwsIHggYCNub2Rlc2ApO1xuICAgICAgICB9KTtcbiAgICAgICAgbGV0IHByb3BzO1xuICAgICAgICBjb25zdCBuYW1lX2NoYW5nZXMgPSBibG9jay5nZXRfdW5pcXVlX25hbWUoYCR7bmFtZS5uYW1lfV9jaGFuZ2VzYCk7XG4gICAgICAgIGNvbnN0IHVzZXNfc3ByZWFkID0gISF0aGlzLm5vZGUuYXR0cmlidXRlcy5maW5kKGEgPT4gYS5pc19zcHJlYWQpO1xuICAgICAgICAvLyByZW1vdmluZyBlbXB0eSBzbG90XG4gICAgICAgIGZvciAoY29uc3Qgc2xvdCBvZiB0aGlzLnNsb3RzLmtleXMoKSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnNsb3RzLmdldChzbG90KS5ibG9jay5oYXNfY29udGVudCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVfYmxvY2sodGhpcy5zbG90cy5nZXQoc2xvdCkuYmxvY2spO1xuICAgICAgICAgICAgICAgIHRoaXMuc2xvdHMuZGVsZXRlKHNsb3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGhhc19jc3NfY3VzdG9tX3Byb3BlcnRpZXMgPSB0aGlzLm5vZGUuY3NzX2N1c3RvbV9wcm9wZXJ0aWVzLmxlbmd0aCA+IDA7XG4gICAgICAgIGNvbnN0IGNzc19jdXN0b21fcHJvcGVydGllc193cmFwcGVyID0gaGFzX2Nzc19jdXN0b21fcHJvcGVydGllcyA/IGJsb2NrLmdldF91bmlxdWVfbmFtZSgnZGl2JykgOiBudWxsO1xuICAgICAgICBpZiAoaGFzX2Nzc19jdXN0b21fcHJvcGVydGllcykge1xuICAgICAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKGNzc19jdXN0b21fcHJvcGVydGllc193cmFwcGVyKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbml0aWFsX3Byb3BzID0gdGhpcy5zbG90cy5zaXplID4gMFxuICAgICAgICAgICAgPyBbXG4gICAgICAgICAgICAgICAgcCBgJCRzbG90czoge1xuXHRcdFx0XHRcdCR7QXJyYXkuZnJvbSh0aGlzLnNsb3RzKS5tYXAoKFtuYW1lLCBzbG90XSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCBgJHtuYW1lfTogWyR7c2xvdC5ibG9jay5uYW1lfSwgJHtzbG90LmdldF9jb250ZXh0IHx8IG51bGx9LCAke3Nsb3QuZ2V0X2NoYW5nZXMgfHwgbnVsbH1dYDtcbiAgICAgICAgICAgICAgICB9KX1cblx0XHRcdFx0fWAsXG4gICAgICAgICAgICAgICAgcCBgJCRzY29wZToge1xuXHRcdFx0XHRcdGN0eDogI2N0eFxuXHRcdFx0XHR9YFxuICAgICAgICAgICAgXVxuICAgICAgICAgICAgOiBbXTtcbiAgICAgICAgY29uc3QgYXR0cmlidXRlX29iamVjdCA9IHVzZXNfc3ByZWFkXG4gICAgICAgICAgICA/IHggYHsgJHtpbml0aWFsX3Byb3BzfSB9YFxuICAgICAgICAgICAgOiB4IGB7XG5cdFx0XHRcdCR7dGhpcy5ub2RlLmF0dHJpYnV0ZXMubWFwKGF0dHIgPT4gcCBgJHthdHRyLm5hbWV9OiAke2F0dHIuZ2V0X3ZhbHVlKGJsb2NrKX1gKX0sXG5cdFx0XHRcdCR7aW5pdGlhbF9wcm9wc31cblx0XHRcdH1gO1xuICAgICAgICBpZiAodGhpcy5ub2RlLmF0dHJpYnV0ZXMubGVuZ3RoIHx8IHRoaXMubm9kZS5iaW5kaW5ncy5sZW5ndGggfHwgaW5pdGlhbF9wcm9wcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmICghdXNlc19zcHJlYWQgJiYgdGhpcy5ub2RlLmJpbmRpbmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudF9vcHRzLnByb3BlcnRpZXMucHVzaChwIGBwcm9wczogJHthdHRyaWJ1dGVfb2JqZWN0fWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcHJvcHMgPSBibG9jay5nZXRfdW5pcXVlX25hbWUoYCR7bmFtZS5uYW1lfV9wcm9wc2ApO1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudF9vcHRzLnByb3BlcnRpZXMucHVzaChwIGBwcm9wczogJHtwcm9wc31gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5kZXYpIHtcbiAgICAgICAgICAgIC8vIFRPRE8gdGhpcyBpcyBhIHRlcnJpYmxlIGhhY2ssIGJ1dCB3aXRob3V0IGl0IHRoZSBjb21wb25lbnRcbiAgICAgICAgICAgIC8vIHdpbGwgY29tcGxhaW4gdGhhdCBvcHRpb25zLnRhcmdldCBpcyBtaXNzaW5nLiBUaGlzIHdvdWxkXG4gICAgICAgICAgICAvLyB3b3JrIGJldHRlciBpZiBjb21wb25lbnRzIGhhZCBzZXBhcmF0ZSBwdWJsaWMgYW5kIHByaXZhdGVcbiAgICAgICAgICAgIC8vIEFQSXNcbiAgICAgICAgICAgIGNvbXBvbmVudF9vcHRzLnByb3BlcnRpZXMucHVzaChwIGAkJGlubGluZTogdHJ1ZWApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZyYWdtZW50X2RlcGVuZGVuY2llcyA9IG5ldyBTZXQodGhpcy5zbG90cy5zaXplID8gWyckJHNjb3BlJ10gOiBbXSk7XG4gICAgICAgIHRoaXMuc2xvdHMuZm9yRWFjaChzbG90ID0+IHtcbiAgICAgICAgICAgIHNsb3QuYmxvY2suZGVwZW5kZW5jaWVzLmZvckVhY2gobmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNfbGV0ID0gc2xvdC5zY29wZS5pc19sZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFyaWFibGUgPSByZW5kZXJlci5jb21wb25lbnQudmFyX2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKGlzX2xldCB8fCBpc19keW5hbWljKHZhcmlhYmxlKSlcbiAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnRfZGVwZW5kZW5jaWVzLmFkZChuYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZHluYW1pY19hdHRyaWJ1dGVzID0gdGhpcy5ub2RlLmF0dHJpYnV0ZXMuZmlsdGVyKGEgPT4gYS5nZXRfZGVwZW5kZW5jaWVzKCkubGVuZ3RoID4gMCk7XG4gICAgICAgIGlmICghdXNlc19zcHJlYWQgJiYgKGR5bmFtaWNfYXR0cmlidXRlcy5sZW5ndGggPiAwIHx8IHRoaXMubm9kZS5iaW5kaW5ncy5sZW5ndGggPiAwIHx8IGZyYWdtZW50X2RlcGVuZGVuY2llcy5zaXplID4gMCkpIHtcbiAgICAgICAgICAgIHVwZGF0ZXMucHVzaChiIGBjb25zdCAke25hbWVfY2hhbmdlc30gPSB7fTtgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ub2RlLmF0dHJpYnV0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAodXNlc19zcHJlYWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsZXZlbHMgPSBibG9jay5nZXRfdW5pcXVlX25hbWUoYCR7dGhpcy52YXIubmFtZX1fc3ByZWFkX2xldmVsc2ApO1xuICAgICAgICAgICAgICAgIGNvbnN0IGluaXRpYWxfcHJvcHMgPSBbXTtcbiAgICAgICAgICAgICAgICBjb25zdCBjaGFuZ2VzID0gW107XG4gICAgICAgICAgICAgICAgY29uc3QgYWxsX2RlcGVuZGVuY2llcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUuYXR0cmlidXRlcy5mb3JFYWNoKGF0dHIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhZGRfdG9fc2V0KGFsbF9kZXBlbmRlbmNpZXMsIGF0dHIuZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUuYXR0cmlidXRlcy5mb3JFYWNoKChhdHRyLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgbmFtZSwgZGVwZW5kZW5jaWVzIH0gPSBhdHRyO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25kaXRpb24gPSBkZXBlbmRlbmNpZXMuc2l6ZSA+IDAgJiYgKGRlcGVuZGVuY2llcy5zaXplICE9PSBhbGxfZGVwZW5kZW5jaWVzLnNpemUpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHJlbmRlcmVyLmRpcnR5KEFycmF5LmZyb20oZGVwZW5kZW5jaWVzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdW5jaGFuZ2VkID0gZGVwZW5kZW5jaWVzLnNpemUgPT09IDA7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjaGFuZ2Vfb2JqZWN0O1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ci5pc19zcHJlYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gYXR0ci5leHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbF9wcm9wcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZV9vYmplY3QgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRyLmV4cHJlc3Npb24ubm9kZS50eXBlICE9PSAnT2JqZWN0RXhwcmVzc2lvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZV9vYmplY3QgPSB4IGBAZ2V0X3NwcmVhZF9vYmplY3QoJHt2YWx1ZX0pYDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZV9vYmplY3QgPSB2YWx1ZV9vYmplY3Q7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB4IGB7ICR7bmFtZX06ICR7YXR0ci5nZXRfdmFsdWUoYmxvY2spfSB9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxfcHJvcHMucHVzaChvYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlX29iamVjdCA9IG9iajtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VzLnB1c2godW5jaGFuZ2VkXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHggYCR7bGV2ZWxzfVske2l9XWBcbiAgICAgICAgICAgICAgICAgICAgICAgIDogY29uZGl0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB4IGAke2NvbmRpdGlvbn0gJiYgJHtjaGFuZ2Vfb2JqZWN0fWBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGNoYW5nZV9vYmplY3QpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRcdFx0Y29uc3QgJHtsZXZlbHN9ID0gW1xuXHRcdFx0XHRcdFx0JHtpbml0aWFsX3Byb3BzfVxuXHRcdFx0XHRcdF07XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIHN0YXRlbWVudHMucHVzaChiIGBcblx0XHRcdFx0XHRmb3IgKGxldCAjaSA9IDA7ICNpIDwgJHtsZXZlbHN9Lmxlbmd0aDsgI2kgKz0gMSkge1xuXHRcdFx0XHRcdFx0JHtwcm9wc30gPSBAYXNzaWduKCR7cHJvcHN9LCAke2xldmVsc31bI2ldKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIGlmIChhbGxfZGVwZW5kZW5jaWVzLnNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uID0gcmVuZGVyZXIuZGlydHkoQXJyYXkuZnJvbShhbGxfZGVwZW5kZW5jaWVzKSk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZXMucHVzaChiIGBcblx0XHRcdFx0XHRcdGNvbnN0ICR7bmFtZV9jaGFuZ2VzfSA9ICR7Y29uZGl0aW9ufSA/IEBnZXRfc3ByZWFkX3VwZGF0ZSgke2xldmVsc30sIFtcblx0XHRcdFx0XHRcdFx0JHtjaGFuZ2VzfVxuXHRcdFx0XHRcdFx0XSkgOiB7fVxuXHRcdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlcy5wdXNoKGIgYFxuXHRcdFx0XHRcdFx0Y29uc3QgJHtuYW1lX2NoYW5nZXN9ID0ge307XG5cdFx0XHRcdFx0YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZHluYW1pY19hdHRyaWJ1dGVzLmZvckVhY2goKGF0dHJpYnV0ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBhdHRyaWJ1dGUuZ2V0X2RlcGVuZGVuY2llcygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGVwZW5kZW5jaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IHJlbmRlcmVyLmRpcnR5KGRlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVzLnB1c2goYiBgXG5cdFx0XHRcdFx0XHRcdGlmICgke2NvbmRpdGlvbn0pICR7bmFtZV9jaGFuZ2VzfS4ke2F0dHJpYnV0ZS5uYW1lfSA9ICR7YXR0cmlidXRlLmdldF92YWx1ZShibG9jayl9O1xuXHRcdFx0XHRcdFx0YCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZnJhZ21lbnRfZGVwZW5kZW5jaWVzLnNpemUgPiAwKSB7XG4gICAgICAgICAgICB1cGRhdGVzLnB1c2goYiBgXG5cdFx0XHRcdGlmICgke3JlbmRlcmVyLmRpcnR5KEFycmF5LmZyb20oZnJhZ21lbnRfZGVwZW5kZW5jaWVzKSl9KSB7XG5cdFx0XHRcdFx0JHtuYW1lX2NoYW5nZXN9LiQkc2NvcGUgPSB7IGRpcnR5OiAjZGlydHksIGN0eDogI2N0eCB9O1xuXHRcdFx0XHR9YCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbXVuZ2VkX2JpbmRpbmdzID0gdGhpcy5ub2RlLmJpbmRpbmdzLm1hcChiaW5kaW5nID0+IHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5oYXNfcmVhY3RpdmVfYXNzaWdubWVudHMgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGJpbmRpbmcubmFtZSA9PT0gJ3RoaXMnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJpbmRfdGhpcyhjb21wb25lbnQsIGJsb2NrLCBuZXcgQmluZGluZ1dyYXBwZXIoYmxvY2ssIGJpbmRpbmcsIHRoaXMpLCB0aGlzLnZhcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBpZCA9IGNvbXBvbmVudC5nZXRfdW5pcXVlX25hbWUoYCR7dGhpcy52YXIubmFtZX1fJHtiaW5kaW5nLm5hbWV9X2JpbmRpbmdgKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmFkZF90b19jb250ZXh0KGlkLm5hbWUpO1xuICAgICAgICAgICAgY29uc3QgY2FsbGVlID0gcmVuZGVyZXIucmVmZXJlbmNlKGlkKTtcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0aW5nID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGB1cGRhdGluZ18ke2JpbmRpbmcubmFtZX1gKTtcbiAgICAgICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZSh1cGRhdGluZyk7XG4gICAgICAgICAgICBjb25zdCBzbmlwcGV0ID0gYmluZGluZy5leHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICAgICAgc3RhdGVtZW50cy5wdXNoKGIgYFxuXHRcdFx0XHRpZiAoJHtzbmlwcGV0fSAhPT0gdm9pZCAwKSB7XG5cdFx0XHRcdFx0JHtwcm9wc30uJHtiaW5kaW5nLm5hbWV9ID0gJHtzbmlwcGV0fTtcblx0XHRcdFx0fWApO1xuICAgICAgICAgICAgdXBkYXRlcy5wdXNoKGIgYFxuXHRcdFx0XHRpZiAoISR7dXBkYXRpbmd9ICYmICR7cmVuZGVyZXIuZGlydHkoQXJyYXkuZnJvbShiaW5kaW5nLmV4cHJlc3Npb24uZGVwZW5kZW5jaWVzKSl9KSB7XG5cdFx0XHRcdFx0JHt1cGRhdGluZ30gPSB0cnVlO1xuXHRcdFx0XHRcdCR7bmFtZV9jaGFuZ2VzfS4ke2JpbmRpbmcubmFtZX0gPSAke3NuaXBwZXR9O1xuXHRcdFx0XHRcdEBhZGRfZmx1c2hfY2FsbGJhY2soKCkgPT4gJHt1cGRhdGluZ30gPSBmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICAgICAgY29uc3QgY29udGV4dHVhbF9kZXBlbmRlbmNpZXMgPSBBcnJheS5mcm9tKGJpbmRpbmcuZXhwcmVzc2lvbi5jb250ZXh0dWFsX2RlcGVuZGVuY2llcyk7XG4gICAgICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBBcnJheS5mcm9tKGJpbmRpbmcuZXhwcmVzc2lvbi5kZXBlbmRlbmNpZXMpO1xuICAgICAgICAgICAgbGV0IGxocyA9IGJpbmRpbmcucmF3X2V4cHJlc3Npb247XG4gICAgICAgICAgICBpZiAoYmluZGluZy5pc19jb250ZXh0dWFsICYmIGJpbmRpbmcuZXhwcmVzc2lvbi5ub2RlLnR5cGUgPT09ICdJZGVudGlmaWVyJykge1xuICAgICAgICAgICAgICAgIC8vIGJpbmQ6eD17eX0g4oCUIHdlIGNhbid0IGp1c3QgZG8gYHkgPSB4YCwgd2UgbmVlZCB0b1xuICAgICAgICAgICAgICAgIC8vIHRvIGBhcnJheVtpbmRleF0gPSB4O1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gYmluZGluZy5leHByZXNzaW9uLm5vZGU7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBvYmplY3QsIHByb3BlcnR5LCBzbmlwcGV0IH0gPSBibG9jay5iaW5kaW5ncy5nZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgbGhzID0gc25pcHBldDtcbiAgICAgICAgICAgICAgICBjb250ZXh0dWFsX2RlcGVuZGVuY2llcy5wdXNoKG9iamVjdC5uYW1lLCBwcm9wZXJ0eS5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IFt4IGAjdmFsdWVgXTtcbiAgICAgICAgICAgIGNvbnN0IGFyZ3MgPSBbeCBgI3ZhbHVlYF07XG4gICAgICAgICAgICBpZiAoY29udGV4dHVhbF9kZXBlbmRlbmNpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnRleHR1YWxfZGVwZW5kZW5jaWVzLmZvckVhY2gobmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdJZGVudGlmaWVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLmFkZF90b19jb250ZXh0KG5hbWUsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2gocmVuZGVyZXIucmVmZXJlbmNlKG5hbWUpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBibG9jay5tYWludGFpbl9jb250ZXh0ID0gdHJ1ZTsgLy8gVE9ETyBwdXQgdGhpcyBzb21ld2hlcmUgbW9yZSBsb2dpY2FsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0XHRmdW5jdGlvbiAke2lkfSgjdmFsdWUpIHtcblx0XHRcdFx0XHQke2NhbGxlZX0oJHthcmdzfSk7XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICAgICAgbGV0IGludmFsaWRhdGVfYmluZGluZyA9IGIgYFxuXHRcdFx0XHQke2xoc30gPSAjdmFsdWU7XG5cdFx0XHRcdCR7cmVuZGVyZXIuaW52YWxpZGF0ZShkZXBlbmRlbmNpZXNbMF0pfTtcblx0XHRcdGA7XG4gICAgICAgICAgICBpZiAoYmluZGluZy5leHByZXNzaW9uLm5vZGUudHlwZSA9PT0gJ01lbWJlckV4cHJlc3Npb24nKSB7XG4gICAgICAgICAgICAgICAgaW52YWxpZGF0ZV9iaW5kaW5nID0gYiBgXG5cdFx0XHRcdFx0aWYgKCQkc2VsZi4kJC5ub3RfZXF1YWwoJHtsaHN9LCAjdmFsdWUpKSB7XG5cdFx0XHRcdFx0XHQke2ludmFsaWRhdGVfYmluZGluZ31cblx0XHRcdFx0XHR9XG5cdFx0XHRcdGA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBib2R5ID0gYiBgXG5cdFx0XHRcdGZ1bmN0aW9uICR7aWR9KCR7cGFyYW1zfSkge1xuXHRcdFx0XHRcdCR7aW52YWxpZGF0ZV9iaW5kaW5nfVxuXHRcdFx0XHR9XG5cdFx0XHRgO1xuICAgICAgICAgICAgY29tcG9uZW50LnBhcnRseV9ob2lzdGVkLnB1c2goYm9keSk7XG4gICAgICAgICAgICByZXR1cm4gYiBgQGJpbmRpbmdfY2FsbGJhY2tzLnB1c2goKCkgPT4gQGJpbmQoJHt0aGlzLnZhcn0sICcke2JpbmRpbmcubmFtZX0nLCAke2lkfSkpO2A7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBtdW5nZWRfaGFuZGxlcnMgPSB0aGlzLm5vZGUuaGFuZGxlcnMubWFwKGhhbmRsZXIgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXZlbnRfaGFuZGxlciA9IG5ldyBFdmVudEhhbmRsZXJXcmFwcGVyKGhhbmRsZXIsIHRoaXMpO1xuICAgICAgICAgICAgbGV0IHNuaXBwZXQgPSBldmVudF9oYW5kbGVyLmdldF9zbmlwcGV0KGJsb2NrKTtcbiAgICAgICAgICAgIGlmIChoYW5kbGVyLm1vZGlmaWVycy5oYXMoJ29uY2UnKSlcbiAgICAgICAgICAgICAgICBzbmlwcGV0ID0geCBgQG9uY2UoJHtzbmlwcGV0fSlgO1xuICAgICAgICAgICAgcmV0dXJuIGIgYCR7bmFtZX0uJG9uKFwiJHtoYW5kbGVyLm5hbWV9XCIsICR7c25pcHBldH0pO2A7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5ub2RlLm5hbWUgPT09ICdzdmVsdGU6Y29tcG9uZW50Jykge1xuICAgICAgICAgICAgY29uc3Qgc3dpdGNoX3ZhbHVlID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdzd2l0Y2hfdmFsdWUnKTtcbiAgICAgICAgICAgIGNvbnN0IHN3aXRjaF9wcm9wcyA9IGJsb2NrLmdldF91bmlxdWVfbmFtZSgnc3dpdGNoX3Byb3BzJyk7XG4gICAgICAgICAgICBjb25zdCBzbmlwcGV0ID0gdGhpcy5ub2RlLmV4cHJlc3Npb24ubWFuaXB1bGF0ZShibG9jayk7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0XHR2YXIgJHtzd2l0Y2hfdmFsdWV9ID0gJHtzbmlwcGV0fTtcblxuXHRcdFx0XHRmdW5jdGlvbiAke3N3aXRjaF9wcm9wc30oI2N0eCkge1xuXHRcdFx0XHRcdCR7KHRoaXMubm9kZS5hdHRyaWJ1dGVzLmxlbmd0aCA+IDAgfHwgdGhpcy5ub2RlLmJpbmRpbmdzLmxlbmd0aCA+IDApICYmIGIgYFxuXHRcdFx0XHRcdCR7cHJvcHMgJiYgYiBgbGV0ICR7cHJvcHN9ID0gJHthdHRyaWJ1dGVfb2JqZWN0fTtgfWB9XG5cdFx0XHRcdFx0JHtzdGF0ZW1lbnRzfVxuXHRcdFx0XHRcdHJldHVybiAke2NvbXBvbmVudF9vcHRzfTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICgke3N3aXRjaF92YWx1ZX0pIHtcblx0XHRcdFx0XHQke25hbWV9ID0gbmV3ICR7c3dpdGNoX3ZhbHVlfSgke3N3aXRjaF9wcm9wc30oI2N0eCkpO1xuXG5cdFx0XHRcdFx0JHttdW5nZWRfYmluZGluZ3N9XG5cdFx0XHRcdFx0JHttdW5nZWRfaGFuZGxlcnN9XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYGlmICgke25hbWV9KSBAY3JlYXRlX2NvbXBvbmVudCgke25hbWV9LiQkLmZyYWdtZW50KTtgKTtcbiAgICAgICAgICAgIGlmIChwYXJlbnRfbm9kZXMgJiYgdGhpcy5yZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUpIHtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuY2xhaW0ucHVzaChiIGBpZiAoJHtuYW1lfSkgQGNsYWltX2NvbXBvbmVudCgke25hbWV9LiQkLmZyYWdtZW50LCAke3BhcmVudF9ub2Rlc30pO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2suY2h1bmtzLm1vdW50LnB1c2goYiBgXG5cdFx0XHRcdGlmICgke25hbWV9KSB7XG5cdFx0XHRcdFx0QG1vdW50X2NvbXBvbmVudCgke25hbWV9LCAke3BhcmVudF9ub2RlIHx8ICcjdGFyZ2V0J30sICR7cGFyZW50X25vZGUgPyAnbnVsbCcgOiAnI2FuY2hvcid9KTtcblx0XHRcdFx0fVxuXHRcdFx0YCk7XG4gICAgICAgICAgICBjb25zdCBhbmNob3IgPSB0aGlzLmdldF9vcl9jcmVhdGVfYW5jaG9yKGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKTtcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZV9tb3VudF9ub2RlID0gdGhpcy5nZXRfdXBkYXRlX21vdW50X25vZGUoYW5jaG9yKTtcbiAgICAgICAgICAgIGlmICh1cGRhdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0XHQke3VwZGF0ZXN9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRpZiAoJHtzd2l0Y2hfdmFsdWV9ICE9PSAoJHtzd2l0Y2hfdmFsdWV9ID0gJHtzbmlwcGV0fSkpIHtcblx0XHRcdFx0XHRpZiAoJHtuYW1lfSkge1xuXHRcdFx0XHRcdFx0QGdyb3VwX291dHJvcygpO1xuXHRcdFx0XHRcdFx0Y29uc3Qgb2xkX2NvbXBvbmVudCA9ICR7bmFtZX07XG5cdFx0XHRcdFx0XHRAdHJhbnNpdGlvbl9vdXQob2xkX2NvbXBvbmVudC4kJC5mcmFnbWVudCwgMSwgMCwgKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRAZGVzdHJveV9jb21wb25lbnQob2xkX2NvbXBvbmVudCwgMSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdEBjaGVja19vdXRyb3MoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoJHtzd2l0Y2hfdmFsdWV9KSB7XG5cdFx0XHRcdFx0XHQke25hbWV9ID0gbmV3ICR7c3dpdGNoX3ZhbHVlfSgke3N3aXRjaF9wcm9wc30oI2N0eCkpO1xuXG5cdFx0XHRcdFx0XHQke211bmdlZF9iaW5kaW5nc31cblx0XHRcdFx0XHRcdCR7bXVuZ2VkX2hhbmRsZXJzfVxuXG5cdFx0XHRcdFx0XHRAY3JlYXRlX2NvbXBvbmVudCgke25hbWV9LiQkLmZyYWdtZW50KTtcblx0XHRcdFx0XHRcdEB0cmFuc2l0aW9uX2luKCR7bmFtZX0uJCQuZnJhZ21lbnQsIDEpO1xuXHRcdFx0XHRcdFx0QG1vdW50X2NvbXBvbmVudCgke25hbWV9LCAke3VwZGF0ZV9tb3VudF9ub2RlfSwgJHthbmNob3J9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0JHtuYW1lfSA9IG51bGw7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYgKCR7c3dpdGNoX3ZhbHVlfSkge1xuXHRcdFx0XHRcdCR7dXBkYXRlcy5sZW5ndGggPiAwICYmIGIgYCR7bmFtZX0uJHNldCgke25hbWVfY2hhbmdlc30pO2B9XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmludHJvLnB1c2goYiBgXG5cdFx0XHRcdGlmICgke25hbWV9KSBAdHJhbnNpdGlvbl9pbigke25hbWV9LiQkLmZyYWdtZW50LCAjbG9jYWwpO1xuXHRcdFx0YCk7XG4gICAgICAgICAgICBibG9jay5jaHVua3Mub3V0cm8ucHVzaChiIGBpZiAoJHtuYW1lfSkgQHRyYW5zaXRpb25fb3V0KCR7bmFtZX0uJCQuZnJhZ21lbnQsICNsb2NhbCk7YCk7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYGlmICgke25hbWV9KSBAZGVzdHJveV9jb21wb25lbnQoJHtuYW1lfSwgJHtwYXJlbnRfbm9kZSA/IG51bGwgOiAnZGV0YWNoaW5nJ30pO2ApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IHRoaXMubm9kZS5uYW1lID09PSAnc3ZlbHRlOnNlbGYnXG4gICAgICAgICAgICAgICAgPyBjb21wb25lbnQubmFtZVxuICAgICAgICAgICAgICAgIDogdGhpcy5yZW5kZXJlci5yZWZlcmVuY2Uoc3RyaW5nX3RvX21lbWJlcl9leHByZXNzaW9uKHRoaXMubm9kZS5uYW1lKSk7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0XHQkeyh0aGlzLm5vZGUuYXR0cmlidXRlcy5sZW5ndGggPiAwIHx8IHRoaXMubm9kZS5iaW5kaW5ncy5sZW5ndGggPiAwKSAmJiBiIGBcblx0XHRcdFx0JHtwcm9wcyAmJiBiIGBsZXQgJHtwcm9wc30gPSAke2F0dHJpYnV0ZV9vYmplY3R9O2B9YH1cblx0XHRcdFx0JHtzdGF0ZW1lbnRzfVxuXHRcdFx0XHQke25hbWV9ID0gbmV3ICR7ZXhwcmVzc2lvbn0oJHtjb21wb25lbnRfb3B0c30pO1xuXG5cdFx0XHRcdCR7bXVuZ2VkX2JpbmRpbmdzfVxuXHRcdFx0XHQke211bmdlZF9oYW5kbGVyc31cblx0XHRcdGApO1xuICAgICAgICAgICAgaWYgKGhhc19jc3NfY3VzdG9tX3Byb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuY3JlYXRlLnB1c2goYiBgJHtjc3NfY3VzdG9tX3Byb3BlcnRpZXNfd3JhcHBlcn0gPSBAZWxlbWVudChcImRpdlwiKTtgKTtcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuaHlkcmF0ZS5wdXNoKGIgYEBzZXRfc3R5bGUoJHtjc3NfY3VzdG9tX3Byb3BlcnRpZXNfd3JhcHBlcn0sIFwiZGlzcGxheVwiLCBcImNvbnRlbnRzXCIpO2ApO1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5jc3NfY3VzdG9tX3Byb3BlcnRpZXMuZm9yRWFjaChhdHRyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gYXR0ci5nZXRfZGVwZW5kZW5jaWVzKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNob3VsZF9jYWNoZSA9IGF0dHIuc2hvdWxkX2NhY2hlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3QgPSBzaG91bGRfY2FjaGUgJiYgYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke2F0dHIubmFtZS5yZXBsYWNlKC9bXmEtekEtWl8kXS9nLCAnXycpfV9sYXN0YCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRfY2FjaGUpXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5hZGRfdmFyaWFibGUobGFzdCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gYXR0ci5nZXRfdmFsdWUoYmxvY2spO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbml0ID0gc2hvdWxkX2NhY2hlID8geCBgJHtsYXN0fSA9ICR7dmFsdWV9YCA6IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuaHlkcmF0ZS5wdXNoKGIgYEBzZXRfc3R5bGUoJHtjc3NfY3VzdG9tX3Byb3BlcnRpZXNfd3JhcHBlcn0sIFwiJHthdHRyLm5hbWV9XCIsICR7aW5pdH0pO2ApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGVwZW5kZW5jaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb25kaXRpb24gPSBibG9jay5yZW5kZXJlci5kaXJ0eShkZXBlbmRlbmNpZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3VsZF9jYWNoZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb24gPSB4IGAke2NvbmRpdGlvbn0gJiYgKCR7bGFzdH0gIT09ICgke2xhc3R9ID0gJHt2YWx1ZX0pKWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHRcdFx0XHRcdGlmICgke2NvbmRpdGlvbn0pIHtcblx0XHRcdFx0XHRcdFx0XHRAc2V0X3N0eWxlKCR7Y3NzX2N1c3RvbV9wcm9wZXJ0aWVzX3dyYXBwZXJ9LCBcIiR7YXR0ci5uYW1lfVwiLCAke3Nob3VsZF9jYWNoZSA/IGxhc3QgOiB2YWx1ZX0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2suY2h1bmtzLmNyZWF0ZS5wdXNoKGIgYEBjcmVhdGVfY29tcG9uZW50KCR7bmFtZX0uJCQuZnJhZ21lbnQpO2ApO1xuICAgICAgICAgICAgaWYgKHBhcmVudF9ub2RlcyAmJiB0aGlzLnJlbmRlcmVyLm9wdGlvbnMuaHlkcmF0YWJsZSkge1xuICAgICAgICAgICAgICAgIGxldCBub2RlcyA9IHBhcmVudF9ub2RlcztcbiAgICAgICAgICAgICAgICBpZiAoaGFzX2Nzc19jdXN0b21fcHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgICAgICBub2RlcyA9IGJsb2NrLmdldF91bmlxdWVfbmFtZShgJHtjc3NfY3VzdG9tX3Byb3BlcnRpZXNfd3JhcHBlci5uYW1lfV9ub2Rlc2ApO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuY2xhaW0ucHVzaChiIGBcblx0XHRcdFx0XHRcdCR7Y3NzX2N1c3RvbV9wcm9wZXJ0aWVzX3dyYXBwZXJ9ID0gQGNsYWltX2VsZW1lbnQoJHtwYXJlbnRfbm9kZXN9LCBcIkRJVlwiLCB7IHN0eWxlOiB0cnVlIH0pXG5cdFx0XHRcdFx0XHR2YXIgJHtub2Rlc30gPSBAY2hpbGRyZW4oJHtjc3NfY3VzdG9tX3Byb3BlcnRpZXNfd3JhcHBlcn0pO1xuXHRcdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuY2xhaW0ucHVzaChiIGBAY2xhaW1fY29tcG9uZW50KCR7bmFtZX0uJCQuZnJhZ21lbnQsICR7bm9kZXN9KTtgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoYXNfY3NzX2N1c3RvbV9wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudF9ub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5tb3VudC5wdXNoKGIgYEBhcHBlbmQoJHtwYXJlbnRfbm9kZX0sICR7Y3NzX2N1c3RvbV9wcm9wZXJ0aWVzX3dyYXBwZXJ9KWApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNfaGVhZChwYXJlbnRfbm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5kZXN0cm95LnB1c2goYiBgQGRldGFjaCgke2Nzc19jdXN0b21fcHJvcGVydGllc193cmFwcGVyfSk7YCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5tb3VudC5wdXNoKGIgYEBpbnNlcnQoI3RhcmdldCwgJHtjc3NfY3VzdG9tX3Byb3BlcnRpZXNfd3JhcHBlcn0sICNhbmNob3IpO2ApO1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIHdlIGV2ZW50dWFsbHkgbmVlZCB0byBjb25zaWRlciB3aGF0IGhhcHBlbnMgdG8gZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhhdCBiZWxvbmcgdG8gdGhlIHNhbWUgb3V0Z3JvdXAgYXMgYW4gb3V0cm9pbmcgZWxlbWVudC4uLlxuICAgICAgICAgICAgICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYGlmIChkZXRhY2hpbmcpIEBkZXRhY2goJHtjc3NfY3VzdG9tX3Byb3BlcnRpZXNfd3JhcHBlcn0pO2ApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChiIGBAbW91bnRfY29tcG9uZW50KCR7bmFtZX0sICR7Y3NzX2N1c3RvbV9wcm9wZXJ0aWVzX3dyYXBwZXJ9LCBudWxsKTtgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJsb2NrLmNodW5rcy5tb3VudC5wdXNoKGIgYEBtb3VudF9jb21wb25lbnQoJHtuYW1lfSwgJHtwYXJlbnRfbm9kZSB8fCAnI3RhcmdldCd9LCAke3BhcmVudF9ub2RlID8gJ251bGwnIDogJyNhbmNob3InfSk7YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW50cm8ucHVzaChiIGBcblx0XHRcdFx0QHRyYW5zaXRpb25faW4oJHtuYW1lfS4kJC5mcmFnbWVudCwgI2xvY2FsKTtcblx0XHRcdGApO1xuICAgICAgICAgICAgaWYgKHVwZGF0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRcdCR7dXBkYXRlc31cblx0XHRcdFx0XHQke25hbWV9LiRzZXQoJHtuYW1lX2NoYW5nZXN9KTtcblx0XHRcdFx0YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBibG9jay5jaHVua3MuZGVzdHJveS5wdXNoKGIgYFxuXHRcdFx0XHRAZGVzdHJveV9jb21wb25lbnQoJHtuYW1lfSwgJHtwYXJlbnRfbm9kZSA/IG51bGwgOiAnZGV0YWNoaW5nJ30pO1xuXHRcdFx0YCk7XG4gICAgICAgICAgICBibG9jay5jaHVua3Mub3V0cm8ucHVzaChiIGBAdHJhbnNpdGlvbl9vdXQoJHtuYW1lfS4kJC5mcmFnbWVudCwgI2xvY2FsKTtgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0X3Nsb3RfZGF0YSh2YWx1ZXMsIGJsb2NrID0gbnVsbCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdPYmplY3RFeHByZXNzaW9uJyxcbiAgICAgICAgcHJvcGVydGllczogQXJyYXkuZnJvbSh2YWx1ZXMudmFsdWVzKCkpXG4gICAgICAgICAgICAuZmlsdGVyKGF0dHJpYnV0ZSA9PiBhdHRyaWJ1dGUubmFtZSAhPT0gJ25hbWUnKVxuICAgICAgICAgICAgLm1hcChhdHRyaWJ1dGUgPT4ge1xuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZS5pc19zcHJlYWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhcmd1bWVudCA9IGdldF9zcHJlYWRfdmFsdWUoYmxvY2ssIGF0dHJpYnV0ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1NwcmVhZEVsZW1lbnQnLFxuICAgICAgICAgICAgICAgICAgICBhcmd1bWVudFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGdldF92YWx1ZShibG9jaywgYXR0cmlidXRlKTtcbiAgICAgICAgICAgIHJldHVybiBwIGAke2F0dHJpYnV0ZS5uYW1lfTogJHt2YWx1ZX1gO1xuICAgICAgICB9KVxuICAgIH07XG59XG5mdW5jdGlvbiBnZXRfdmFsdWUoYmxvY2ssIGF0dHJpYnV0ZSkge1xuICAgIGlmIChhdHRyaWJ1dGUuaXNfdHJ1ZSlcbiAgICAgICAgcmV0dXJuIHggYHRydWVgO1xuICAgIGlmIChhdHRyaWJ1dGUuY2h1bmtzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuIHggYFwiXCJgO1xuICAgIGxldCB2YWx1ZSA9IGF0dHJpYnV0ZS5jaHVua3NcbiAgICAgICAgLm1hcChjaHVuayA9PiBjaHVuay50eXBlID09PSAnVGV4dCcgPyBzdHJpbmdfbGl0ZXJhbChjaHVuay5kYXRhKSA6IChibG9jayA/IGNodW5rLm1hbmlwdWxhdGUoYmxvY2spIDogY2h1bmsubm9kZSkpXG4gICAgICAgIC5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30gKyAke3Joc31gKTtcbiAgICBpZiAoYXR0cmlidXRlLmNodW5rcy5sZW5ndGggPiAxICYmIGF0dHJpYnV0ZS5jaHVua3NbMF0udHlwZSAhPT0gJ1RleHQnKSB7XG4gICAgICAgIHZhbHVlID0geCBgXCJcIiArICR7dmFsdWV9YDtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZ2V0X3NwcmVhZF92YWx1ZShibG9jaywgYXR0cmlidXRlKSB7XG4gICAgcmV0dXJuIGJsb2NrID8gYXR0cmlidXRlLmV4cHJlc3Npb24ubWFuaXB1bGF0ZShibG9jaykgOiBhdHRyaWJ1dGUuZXhwcmVzc2lvbi5ub2RlO1xufVxuXG5jbGFzcyBTbG90V3JhcHBlciBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlLCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpIHtcbiAgICAgICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrLCBwYXJlbnQsIG5vZGUpO1xuICAgICAgICB0aGlzLmZhbGxiYWNrID0gbnVsbDtcbiAgICAgICAgdGhpcy52YXIgPSB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogJ3Nsb3QnIH07XG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gbmV3IFNldChbJyQkc2NvcGUnXSk7XG4gICAgICAgIHRoaXMuY2Fubm90X3VzZV9pbm5lcmh0bWwoKTtcbiAgICAgICAgdGhpcy5ub3Rfc3RhdGljX2NvbnRlbnQoKTtcbiAgICAgICAgaWYgKHRoaXMubm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZmFsbGJhY2sgPSBibG9jay5jaGlsZCh7XG4gICAgICAgICAgICAgICAgY29tbWVudDogY3JlYXRlX2RlYnVnZ2luZ19jb21tZW50KHRoaXMubm9kZS5jaGlsZHJlblswXSwgdGhpcy5yZW5kZXJlci5jb21wb25lbnQpLFxuICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMucmVuZGVyZXIuY29tcG9uZW50LmdldF91bmlxdWVfbmFtZSgnZmFsbGJhY2tfYmxvY2snKSxcbiAgICAgICAgICAgICAgICB0eXBlOiAnZmFsbGJhY2snXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmJsb2Nrcy5wdXNoKHRoaXMuZmFsbGJhY2spO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZnJhZ21lbnQgPSBuZXcgRnJhZ21lbnRXcmFwcGVyKHJlbmRlcmVyLCB0aGlzLmZhbGxiYWNrLCBub2RlLmNoaWxkcmVuLCB0aGlzLCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpO1xuICAgICAgICB0aGlzLm5vZGUudmFsdWVzLmZvckVhY2goYXR0cmlidXRlID0+IHtcbiAgICAgICAgICAgIGFkZF90b19zZXQodGhpcy5kZXBlbmRlbmNpZXMsIGF0dHJpYnV0ZS5kZXBlbmRlbmNpZXMpO1xuICAgICAgICB9KTtcbiAgICAgICAgYmxvY2suYWRkX2RlcGVuZGVuY2llcyh0aGlzLmRlcGVuZGVuY2llcyk7XG4gICAgICAgIC8vIHdlIGhhdmUgdG8gZG8gdGhpcywganVzdCBpbiBjYXNlXG4gICAgICAgIGJsb2NrLmFkZF9pbnRybygpO1xuICAgICAgICBibG9jay5hZGRfb3V0cm8oKTtcbiAgICB9XG4gICAgcmVuZGVyKGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKSB7XG4gICAgICAgIGNvbnN0IHsgcmVuZGVyZXIgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgc2xvdF9uYW1lIH0gPSB0aGlzLm5vZGU7XG4gICAgICAgIGlmICh0aGlzLnNsb3RfYmxvY2spIHtcbiAgICAgICAgICAgIGJsb2NrID0gdGhpcy5zbG90X2Jsb2NrO1xuICAgICAgICB9XG4gICAgICAgIGxldCBnZXRfc2xvdF9jaGFuZ2VzX2ZuO1xuICAgICAgICBsZXQgZ2V0X3Nsb3Rfc3ByZWFkX2NoYW5nZXNfZm47XG4gICAgICAgIGxldCBnZXRfc2xvdF9jb250ZXh0X2ZuO1xuICAgICAgICBpZiAodGhpcy5ub2RlLnZhbHVlcy5zaXplID4gMCkge1xuICAgICAgICAgICAgZ2V0X3Nsb3RfY2hhbmdlc19mbiA9IHJlbmRlcmVyLmNvbXBvbmVudC5nZXRfdW5pcXVlX25hbWUoYGdldF8ke3Nhbml0aXplKHNsb3RfbmFtZSl9X3Nsb3RfY2hhbmdlc2ApO1xuICAgICAgICAgICAgZ2V0X3Nsb3RfY29udGV4dF9mbiA9IHJlbmRlcmVyLmNvbXBvbmVudC5nZXRfdW5pcXVlX25hbWUoYGdldF8ke3Nhbml0aXplKHNsb3RfbmFtZSl9X3Nsb3RfY29udGV4dGApO1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlcyA9IHggYHt9YDtcbiAgICAgICAgICAgIGNvbnN0IHNwcmVhZF9keW5hbWljX2RlcGVuZGVuY2llcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgIHRoaXMubm9kZS52YWx1ZXMuZm9yRWFjaChhdHRyaWJ1dGUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUudHlwZSA9PT0gJ1NwcmVhZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkX3RvX3NldChzcHJlYWRfZHluYW1pY19kZXBlbmRlbmNpZXMsIEFycmF5LmZyb20oYXR0cmlidXRlLmRlcGVuZGVuY2llcykuZmlsdGVyKChuYW1lKSA9PiB0aGlzLmlzX2RlcGVuZGVuY3lfZHluYW1pYyhuYW1lKSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHluYW1pY19kZXBlbmRlbmNpZXMgPSBBcnJheS5mcm9tKGF0dHJpYnV0ZS5kZXBlbmRlbmNpZXMpLmZpbHRlcigobmFtZSkgPT4gdGhpcy5pc19kZXBlbmRlbmN5X2R5bmFtaWMobmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZHluYW1pY19kZXBlbmRlbmNpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlcy5wcm9wZXJ0aWVzLnB1c2gocCBgJHthdHRyaWJ1dGUubmFtZX06ICR7cmVuZGVyZXIuZGlydHkoZHluYW1pY19kZXBlbmRlbmNpZXMpfWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZW5kZXJlci5ibG9ja3MucHVzaChiIGBcblx0XHRcdFx0Y29uc3QgJHtnZXRfc2xvdF9jaGFuZ2VzX2ZufSA9ICNkaXJ0eSA9PiAke2NoYW5nZXN9O1xuXHRcdFx0XHRjb25zdCAke2dldF9zbG90X2NvbnRleHRfZm59ID0gI2N0eCA9PiAke2dldF9zbG90X2RhdGEodGhpcy5ub2RlLnZhbHVlcywgYmxvY2spfTtcblx0XHRcdGApO1xuICAgICAgICAgICAgaWYgKHNwcmVhZF9keW5hbWljX2RlcGVuZGVuY2llcy5zaXplKSB7XG4gICAgICAgICAgICAgICAgZ2V0X3Nsb3Rfc3ByZWFkX2NoYW5nZXNfZm4gPSByZW5kZXJlci5jb21wb25lbnQuZ2V0X3VuaXF1ZV9uYW1lKGBnZXRfJHtzYW5pdGl6ZShzbG90X25hbWUpfV9zbG90X3NwcmVhZF9jaGFuZ2VzYCk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuYmxvY2tzLnB1c2goYiBgXG5cdFx0XHRcdFx0Y29uc3QgJHtnZXRfc2xvdF9zcHJlYWRfY2hhbmdlc19mbn0gPSAjZGlydHkgPT4gJHtyZW5kZXJlci5kaXJ0eShBcnJheS5mcm9tKHNwcmVhZF9keW5hbWljX2RlcGVuZGVuY2llcykpfTtcblx0XHRcdFx0YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBnZXRfc2xvdF9jaGFuZ2VzX2ZuID0gJ251bGwnO1xuICAgICAgICAgICAgZ2V0X3Nsb3RfY29udGV4dF9mbiA9ICdudWxsJztcbiAgICAgICAgfVxuICAgICAgICBsZXQgaGFzX2ZhbGxiYWNrID0gISF0aGlzLmZhbGxiYWNrO1xuICAgICAgICBpZiAodGhpcy5mYWxsYmFjaykge1xuICAgICAgICAgICAgdGhpcy5mcmFnbWVudC5yZW5kZXIodGhpcy5mYWxsYmFjaywgbnVsbCwgeCBgI25vZGVzYCk7XG4gICAgICAgICAgICBoYXNfZmFsbGJhY2sgPSB0aGlzLmZhbGxiYWNrLmhhc19jb250ZW50KCk7XG4gICAgICAgICAgICBpZiAoIWhhc19mYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnJlbW92ZV9ibG9jayh0aGlzLmZhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzbG90ID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke3Nhbml0aXplKHNsb3RfbmFtZSl9X3Nsb3RgKTtcbiAgICAgICAgY29uc3Qgc2xvdF9kZWZpbml0aW9uID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKGAke3Nhbml0aXplKHNsb3RfbmFtZSl9X3Nsb3RfdGVtcGxhdGVgKTtcbiAgICAgICAgY29uc3Qgc2xvdF9vcl9mYWxsYmFjayA9IGhhc19mYWxsYmFjayA/IGJsb2NrLmdldF91bmlxdWVfbmFtZShgJHtzYW5pdGl6ZShzbG90X25hbWUpfV9zbG90X29yX2ZhbGxiYWNrYCkgOiBzbG90O1xuICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0Y29uc3QgJHtzbG90X2RlZmluaXRpb259ID0gJHtyZW5kZXJlci5yZWZlcmVuY2UoJyNzbG90cycpfS4ke3Nsb3RfbmFtZX07XG5cdFx0XHRjb25zdCAke3Nsb3R9ID0gQGNyZWF0ZV9zbG90KCR7c2xvdF9kZWZpbml0aW9ufSwgI2N0eCwgJHtyZW5kZXJlci5yZWZlcmVuY2UoJyQkc2NvcGUnKX0sICR7Z2V0X3Nsb3RfY29udGV4dF9mbn0pO1xuXHRcdFx0JHtoYXNfZmFsbGJhY2sgPyBiIGBjb25zdCAke3Nsb3Rfb3JfZmFsbGJhY2t9ID0gJHtzbG90fSB8fCAke3RoaXMuZmFsbGJhY2submFtZX0oI2N0eCk7YCA6IG51bGx9XG5cdFx0YCk7XG4gICAgICAgIGJsb2NrLmNodW5rcy5jcmVhdGUucHVzaChiIGBpZiAoJHtzbG90X29yX2ZhbGxiYWNrfSkgJHtzbG90X29yX2ZhbGxiYWNrfS5jKCk7YCk7XG4gICAgICAgIGlmIChyZW5kZXJlci5vcHRpb25zLmh5ZHJhdGFibGUpIHtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5jbGFpbS5wdXNoKGIgYGlmICgke3Nsb3Rfb3JfZmFsbGJhY2t9KSAke3Nsb3Rfb3JfZmFsbGJhY2t9LmwoJHtwYXJlbnRfbm9kZXN9KTtgKTtcbiAgICAgICAgfVxuICAgICAgICBibG9jay5jaHVua3MubW91bnQucHVzaChiIGBcblx0XHRcdGlmICgke3Nsb3Rfb3JfZmFsbGJhY2t9KSB7XG5cdFx0XHRcdCR7c2xvdF9vcl9mYWxsYmFja30ubSgke3BhcmVudF9ub2RlIHx8ICcjdGFyZ2V0J30sICR7cGFyZW50X25vZGUgPyAnbnVsbCcgOiAnI2FuY2hvcid9KTtcblx0XHRcdH1cblx0XHRgKTtcbiAgICAgICAgYmxvY2suY2h1bmtzLmludHJvLnB1c2goYiBgQHRyYW5zaXRpb25faW4oJHtzbG90X29yX2ZhbGxiYWNrfSwgI2xvY2FsKTtgKTtcbiAgICAgICAgYmxvY2suY2h1bmtzLm91dHJvLnB1c2goYiBgQHRyYW5zaXRpb25fb3V0KCR7c2xvdF9vcl9mYWxsYmFja30sICNsb2NhbCk7YCk7XG4gICAgICAgIGNvbnN0IGR5bmFtaWNfZGVwZW5kZW5jaWVzID0gQXJyYXkuZnJvbSh0aGlzLmRlcGVuZGVuY2llcykuZmlsdGVyKChuYW1lKSA9PiB0aGlzLmlzX2RlcGVuZGVuY3lfZHluYW1pYyhuYW1lKSk7XG4gICAgICAgIGNvbnN0IGZhbGxiYWNrX2R5bmFtaWNfZGVwZW5kZW5jaWVzID0gaGFzX2ZhbGxiYWNrXG4gICAgICAgICAgICA/IEFycmF5LmZyb20odGhpcy5mYWxsYmFjay5kZXBlbmRlbmNpZXMpLmZpbHRlcigobmFtZSkgPT4gdGhpcy5pc19kZXBlbmRlbmN5X2R5bmFtaWMobmFtZSkpXG4gICAgICAgICAgICA6IFtdO1xuICAgICAgICBsZXQgY29uZGl0aW9uID0gcmVuZGVyZXIuZGlydHkoZHluYW1pY19kZXBlbmRlbmNpZXMpO1xuICAgICAgICBpZiAoYmxvY2suaGFzX291dHJvcykge1xuICAgICAgICAgICAgY29uZGl0aW9uID0geCBgISNjdXJyZW50IHx8ICR7Y29uZGl0aW9ufWA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY29uZGl0aW9ucyB0byB0cmVhdCBldmVyeXRoaW5nIGFzIGRpcnR5XG4gICAgICAgIGNvbnN0IGFsbF9kaXJ0eV9jb25kaXRpb25zID0gW1xuICAgICAgICAgICAgZ2V0X3Nsb3Rfc3ByZWFkX2NoYW5nZXNfZm4gPyB4IGAke2dldF9zbG90X3NwcmVhZF9jaGFuZ2VzX2ZufSgjZGlydHkpYCA6IG51bGwsXG4gICAgICAgICAgICBibG9jay5oYXNfb3V0cm9zID8geCBgISNjdXJyZW50YCA6IG51bGxcbiAgICAgICAgXS5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgIGNvbnN0IGFsbF9kaXJ0eV9jb25kaXRpb24gPSBhbGxfZGlydHlfY29uZGl0aW9ucy5sZW5ndGggPyBhbGxfZGlydHlfY29uZGl0aW9ucy5yZWR1Y2UoKGNvbmRpdGlvbjEsIGNvbmRpdGlvbjIpID0+IHggYCR7Y29uZGl0aW9uMX0gfHwgJHtjb25kaXRpb24yfWApIDogbnVsbDtcbiAgICAgICAgbGV0IHNsb3RfdXBkYXRlO1xuICAgICAgICBpZiAoYWxsX2RpcnR5X2NvbmRpdGlvbikge1xuICAgICAgICAgICAgY29uc3QgZGlydHkgPSB4IGAke2FsbF9kaXJ0eV9jb25kaXRpb259ID8gQGdldF9hbGxfZGlydHlfZnJvbV9zY29wZSgke3JlbmRlcmVyLnJlZmVyZW5jZSgnJCRzY29wZScpfSkgOiBAZ2V0X3Nsb3RfY2hhbmdlcygke3Nsb3RfZGVmaW5pdGlvbn0sICR7cmVuZGVyZXIucmVmZXJlbmNlKCckJHNjb3BlJyl9LCAjZGlydHksICR7Z2V0X3Nsb3RfY2hhbmdlc19mbn0pYDtcbiAgICAgICAgICAgIHNsb3RfdXBkYXRlID0gYiBgXG5cdFx0XHRcdGlmICgke3Nsb3R9LnAgJiYgJHtjb25kaXRpb259KSB7XG5cdFx0XHRcdFx0QHVwZGF0ZV9zbG90X2Jhc2UoJHtzbG90fSwgJHtzbG90X2RlZmluaXRpb259LCAjY3R4LCAke3JlbmRlcmVyLnJlZmVyZW5jZSgnJCRzY29wZScpfSwgJHtkaXJ0eX0sICR7Z2V0X3Nsb3RfY29udGV4dF9mbn0pO1xuXHRcdFx0XHR9XG5cdFx0XHRgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc2xvdF91cGRhdGUgPSBiIGBcblx0XHRcdFx0aWYgKCR7c2xvdH0ucCAmJiAke2NvbmRpdGlvbn0pIHtcblx0XHRcdFx0XHRAdXBkYXRlX3Nsb3QoJHtzbG90fSwgJHtzbG90X2RlZmluaXRpb259LCAjY3R4LCAke3JlbmRlcmVyLnJlZmVyZW5jZSgnJCRzY29wZScpfSwgI2RpcnR5LCAke2dldF9zbG90X2NoYW5nZXNfZm59LCAke2dldF9zbG90X2NvbnRleHRfZm59KTtcblx0XHRcdFx0fVxuXHRcdFx0YDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZmFsbGJhY2tfY29uZGl0aW9uID0gcmVuZGVyZXIuZGlydHkoZmFsbGJhY2tfZHluYW1pY19kZXBlbmRlbmNpZXMpO1xuICAgICAgICBsZXQgZmFsbGJhY2tfZGlydHkgPSB4IGAjZGlydHlgO1xuICAgICAgICBpZiAoYmxvY2suaGFzX291dHJvcykge1xuICAgICAgICAgICAgZmFsbGJhY2tfY29uZGl0aW9uID0geCBgISNjdXJyZW50IHx8ICR7ZmFsbGJhY2tfY29uZGl0aW9ufWA7XG4gICAgICAgICAgICBmYWxsYmFja19kaXJ0eSA9IHggYCEjY3VycmVudCA/ICR7cmVuZGVyZXIuZ2V0X2luaXRpYWxfZGlydHkoKX0gOiAke2ZhbGxiYWNrX2RpcnR5fWA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmFsbGJhY2tfdXBkYXRlID0gaGFzX2ZhbGxiYWNrICYmIGZhbGxiYWNrX2R5bmFtaWNfZGVwZW5kZW5jaWVzLmxlbmd0aCA+IDAgJiYgYiBgXG5cdFx0XHRpZiAoJHtzbG90X29yX2ZhbGxiYWNrfSAmJiAke3Nsb3Rfb3JfZmFsbGJhY2t9LnAgJiYgJHtmYWxsYmFja19jb25kaXRpb259KSB7XG5cdFx0XHRcdCR7c2xvdF9vcl9mYWxsYmFja30ucCgjY3R4LCAke2ZhbGxiYWNrX2RpcnR5fSk7XG5cdFx0XHR9XG5cdFx0YDtcbiAgICAgICAgaWYgKGZhbGxiYWNrX3VwZGF0ZSkge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRpZiAoJHtzbG90fSkge1xuXHRcdFx0XHRcdCR7c2xvdF91cGRhdGV9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JHtmYWxsYmFja191cGRhdGV9XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYmxvY2suY2h1bmtzLnVwZGF0ZS5wdXNoKGIgYFxuXHRcdFx0XHRpZiAoJHtzbG90fSkge1xuXHRcdFx0XHRcdCR7c2xvdF91cGRhdGV9XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmNodW5rcy5kZXN0cm95LnB1c2goYiBgaWYgKCR7c2xvdF9vcl9mYWxsYmFja30pICR7c2xvdF9vcl9mYWxsYmFja30uZChkZXRhY2hpbmcpO2ApO1xuICAgIH1cbiAgICBpc19kZXBlbmRlbmN5X2R5bmFtaWMobmFtZSkge1xuICAgICAgICBpZiAobmFtZSA9PT0gJyQkc2NvcGUnKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmICh0aGlzLm5vZGUuc2NvcGUuaXNfbGV0KG5hbWUpKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmIChpc19yZXNlcnZlZF9rZXl3b3JkKG5hbWUpKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGNvbnN0IHZhcmlhYmxlID0gdGhpcy5yZW5kZXJlci5jb21wb25lbnQudmFyX2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgIHJldHVybiBpc19keW5hbWljKHZhcmlhYmxlKTtcbiAgICB9XG59XG5cbmNsYXNzIFRpdGxlV3JhcHBlciBleHRlbmRzIFdyYXBwZXIge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBub2RlLCBfc3RyaXBfd2hpdGVzcGFjZSwgX25leHRfc2libGluZykge1xuICAgICAgICBzdXBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSk7XG4gICAgfVxuICAgIHJlbmRlcihibG9jaywgX3BhcmVudF9ub2RlLCBfcGFyZW50X25vZGVzKSB7XG4gICAgICAgIGNvbnN0IGlzX2R5bmFtaWMgPSAhIXRoaXMubm9kZS5jaGlsZHJlbi5maW5kKG5vZGUgPT4gbm9kZS50eXBlICE9PSAnVGV4dCcpO1xuICAgICAgICBpZiAoaXNfZHluYW1pYykge1xuICAgICAgICAgICAgbGV0IHZhbHVlO1xuICAgICAgICAgICAgY29uc3QgYWxsX2RlcGVuZGVuY2llcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgIC8vIFRPRE8gc29tZSBvZiB0aGlzIGNvZGUgaXMgcmVwZWF0ZWQgaW4gVGFnLnRzIOKAlCB3b3VsZCBiZSBnb29kIHRvXG4gICAgICAgICAgICAvLyBEUlkgaXQgb3V0IGlmIHRoYXQncyBwb3NzaWJsZSB3aXRob3V0IGludHJvZHVjaW5nIGNyYXp5IGluZGlyZWN0aW9uXG4gICAgICAgICAgICBpZiAodGhpcy5ub2RlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIC8vIHNpbmdsZSB7dGFnfSDigJQgbWF5IGJlIGEgbm9uLXN0cmluZ1xuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgdG9kbzogY2hlY2sgdGhpc1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgZXhwcmVzc2lvbiB9ID0gdGhpcy5ub2RlLmNoaWxkcmVuWzBdO1xuICAgICAgICAgICAgICAgIHZhbHVlID0gZXhwcmVzc2lvbi5tYW5pcHVsYXRlKGJsb2NrKTtcbiAgICAgICAgICAgICAgICBhZGRfdG9fc2V0KGFsbF9kZXBlbmRlbmNpZXMsIGV4cHJlc3Npb24uZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vICd7Zm9vfSB7YmFyfScg4oCUIHRyZWF0IGFzIHN0cmluZyBjb25jYXRlbmF0aW9uXG4gICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLm5vZGUuY2hpbGRyZW5cbiAgICAgICAgICAgICAgICAgICAgLm1hcChjaHVuayA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaHVuay50eXBlID09PSAnVGV4dCcpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nX2xpdGVyYWwoY2h1bmsuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIGNodW5rLmV4cHJlc3Npb24uZGVwZW5kZW5jaWVzLmZvckVhY2goZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxfZGVwZW5kZW5jaWVzLmFkZChkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjaHVuay5leHByZXNzaW9uLm1hbmlwdWxhdGUoYmxvY2spO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30gKyAke3Joc31gKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlLmNoaWxkcmVuWzBdLnR5cGUgIT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHggYFwiXCIgKyAke3ZhbHVlfWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbGFzdCA9IHRoaXMubm9kZS5zaG91bGRfY2FjaGUgJiYgYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCd0aXRsZV92YWx1ZScpO1xuICAgICAgICAgICAgaWYgKHRoaXMubm9kZS5zaG91bGRfY2FjaGUpXG4gICAgICAgICAgICAgICAgYmxvY2suYWRkX3ZhcmlhYmxlKGxhc3QpO1xuICAgICAgICAgICAgY29uc3QgaW5pdCA9IHRoaXMubm9kZS5zaG91bGRfY2FjaGUgPyB4IGAke2xhc3R9ID0gJHt2YWx1ZX1gIDogdmFsdWU7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYEBfZG9jdW1lbnQudGl0bGUgPSAke2luaXR9O2ApO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlciA9IGIgYEBfZG9jdW1lbnQudGl0bGUgPSAke3RoaXMubm9kZS5zaG91bGRfY2FjaGUgPyBsYXN0IDogdmFsdWV9O2A7XG4gICAgICAgICAgICBpZiAoYWxsX2RlcGVuZGVuY2llcy5zaXplKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gQXJyYXkuZnJvbShhbGxfZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgICAgICBsZXQgY29uZGl0aW9uID0gYmxvY2sucmVuZGVyZXIuZGlydHkoZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgICAgICAgICBpZiAoYmxvY2suaGFzX291dHJvcykge1xuICAgICAgICAgICAgICAgICAgICBjb25kaXRpb24gPSB4IGAhI2N1cnJlbnQgfHwgJHtjb25kaXRpb259YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubm9kZS5zaG91bGRfY2FjaGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uID0geCBgJHtjb25kaXRpb259ICYmICgke2xhc3R9ICE9PSAoJHtsYXN0fSA9ICR7dmFsdWV9KSlgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MudXBkYXRlLnB1c2goYiBgXG5cdFx0XHRcdFx0aWYgKCR7Y29uZGl0aW9ufSkge1xuXHRcdFx0XHRcdFx0JHt1cGRhdGVyfVxuXHRcdFx0XHRcdH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5ub2RlLmNoaWxkcmVuLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICA/IHN0cmluZ19saXRlcmFsKHRoaXMubm9kZS5jaGlsZHJlblswXS5kYXRhKVxuICAgICAgICAgICAgICAgIDogeCBgXCJcImA7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaHlkcmF0ZS5wdXNoKGIgYEBfZG9jdW1lbnQudGl0bGUgPSAke3ZhbHVlfTtgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY29uc3QgYXNzb2NpYXRlZF9ldmVudHMgPSB7XG4gICAgaW5uZXJXaWR0aDogJ3Jlc2l6ZScsXG4gICAgaW5uZXJIZWlnaHQ6ICdyZXNpemUnLFxuICAgIG91dGVyV2lkdGg6ICdyZXNpemUnLFxuICAgIG91dGVySGVpZ2h0OiAncmVzaXplJyxcbiAgICBzY3JvbGxYOiAnc2Nyb2xsJyxcbiAgICBzY3JvbGxZOiAnc2Nyb2xsJ1xufTtcbmNvbnN0IHByb3BlcnRpZXMkMSA9IHtcbiAgICBzY3JvbGxYOiAncGFnZVhPZmZzZXQnLFxuICAgIHNjcm9sbFk6ICdwYWdlWU9mZnNldCdcbn07XG5jb25zdCByZWFkb25seSA9IG5ldyBTZXQoW1xuICAgICdpbm5lcldpZHRoJyxcbiAgICAnaW5uZXJIZWlnaHQnLFxuICAgICdvdXRlcldpZHRoJyxcbiAgICAnb3V0ZXJIZWlnaHQnLFxuICAgICdvbmxpbmUnXG5dKTtcbmNsYXNzIFdpbmRvd1dyYXBwZXIgZXh0ZW5kcyBXcmFwcGVyIHtcbiAgICBjb25zdHJ1Y3RvcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSkge1xuICAgICAgICBzdXBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgbm9kZSk7XG4gICAgICAgIHRoaXMuaGFuZGxlcnMgPSB0aGlzLm5vZGUuaGFuZGxlcnMubWFwKGhhbmRsZXIgPT4gbmV3IEV2ZW50SGFuZGxlcldyYXBwZXIoaGFuZGxlciwgdGhpcykpO1xuICAgIH1cbiAgICByZW5kZXIoYmxvY2ssIF9wYXJlbnRfbm9kZSwgX3BhcmVudF9ub2Rlcykge1xuICAgICAgICBjb25zdCB7IHJlbmRlcmVyIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGNvbXBvbmVudCB9ID0gcmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IGV2ZW50cyA9IHt9O1xuICAgICAgICBjb25zdCBiaW5kaW5ncyA9IHt9O1xuICAgICAgICBhZGRfYWN0aW9ucyhibG9jaywgJ0Bfd2luZG93JywgdGhpcy5ub2RlLmFjdGlvbnMpO1xuICAgICAgICBhZGRfZXZlbnRfaGFuZGxlcnMoYmxvY2ssICdAX3dpbmRvdycsIHRoaXMuaGFuZGxlcnMpO1xuICAgICAgICB0aGlzLm5vZGUuYmluZGluZ3MuZm9yRWFjaChiaW5kaW5nID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE86IHdoYXQgaWYgaXQncyBhIE1lbWJlckV4cHJlc3Npb24/XG4gICAgICAgICAgICBjb25zdCBiaW5kaW5nX25hbWUgPSBiaW5kaW5nLmV4cHJlc3Npb24ubm9kZS5uYW1lO1xuICAgICAgICAgICAgLy8gaW4gZGV2IG1vZGUsIHRocm93IGlmIHJlYWQtb25seSB2YWx1ZXMgYXJlIHdyaXR0ZW4gdG9cbiAgICAgICAgICAgIGlmIChyZWFkb25seS5oYXMoYmluZGluZy5uYW1lKSkge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnJlYWRvbmx5LmFkZChiaW5kaW5nX25hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmluZGluZ3NbYmluZGluZy5uYW1lXSA9IGJpbmRpbmdfbmFtZTtcbiAgICAgICAgICAgIC8vIGJpbmQ6b25saW5lIGlzIGEgc3BlY2lhbCBjYXNlLCB3ZSBuZWVkIHRvIGxpc3RlbiBmb3IgdHdvIHNlcGFyYXRlIGV2ZW50c1xuICAgICAgICAgICAgaWYgKGJpbmRpbmcubmFtZSA9PT0gJ29ubGluZScpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY29uc3QgYXNzb2NpYXRlZF9ldmVudCA9IGFzc29jaWF0ZWRfZXZlbnRzW2JpbmRpbmcubmFtZV07XG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHByb3BlcnRpZXMkMVtiaW5kaW5nLm5hbWVdIHx8IGJpbmRpbmcubmFtZTtcbiAgICAgICAgICAgIGlmICghZXZlbnRzW2Fzc29jaWF0ZWRfZXZlbnRdKVxuICAgICAgICAgICAgICAgIGV2ZW50c1thc3NvY2lhdGVkX2V2ZW50XSA9IFtdO1xuICAgICAgICAgICAgZXZlbnRzW2Fzc29jaWF0ZWRfZXZlbnRdLnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6IGJpbmRpbmdfbmFtZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogcHJvcGVydHlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgc2Nyb2xsaW5nID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdzY3JvbGxpbmcnKTtcbiAgICAgICAgY29uc3QgY2xlYXJfc2Nyb2xsaW5nID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdjbGVhcl9zY3JvbGxpbmcnKTtcbiAgICAgICAgY29uc3Qgc2Nyb2xsaW5nX3RpbWVvdXQgPSBibG9jay5nZXRfdW5pcXVlX25hbWUoJ3Njcm9sbGluZ190aW1lb3V0Jyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGV2ZW50cykuZm9yRWFjaChldmVudCA9PiB7XG4gICAgICAgICAgICBjb25zdCBpZCA9IGJsb2NrLmdldF91bmlxdWVfbmFtZShgb253aW5kb3cke2V2ZW50fWApO1xuICAgICAgICAgICAgY29uc3QgcHJvcHMgPSBldmVudHNbZXZlbnRdO1xuICAgICAgICAgICAgcmVuZGVyZXIuYWRkX3RvX2NvbnRleHQoaWQubmFtZSk7XG4gICAgICAgICAgICBjb25zdCBmbiA9IHJlbmRlcmVyLnJlZmVyZW5jZShpZC5uYW1lKTtcbiAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ3Njcm9sbCcpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIG90aGVyIGJpZGlyZWN0aW9uYWwgYmluZGluZ3MuLi5cbiAgICAgICAgICAgICAgICBibG9jay5hZGRfdmFyaWFibGUoc2Nyb2xsaW5nLCB4IGBmYWxzZWApO1xuICAgICAgICAgICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZShjbGVhcl9zY3JvbGxpbmcsIHggYCgpID0+IHsgJHtzY3JvbGxpbmd9ID0gZmFsc2UgfWApO1xuICAgICAgICAgICAgICAgIGJsb2NrLmFkZF92YXJpYWJsZShzY3JvbGxpbmdfdGltZW91dCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uID0gYmluZGluZ3Muc2Nyb2xsWCAmJiBiaW5kaW5ncy5zY3JvbGxZXG4gICAgICAgICAgICAgICAgICAgID8geCBgXCIke2JpbmRpbmdzLnNjcm9sbFh9XCIgaW4gdGhpcy5fc3RhdGUgfHwgXCIke2JpbmRpbmdzLnNjcm9sbFl9XCIgaW4gdGhpcy5fc3RhdGVgXG4gICAgICAgICAgICAgICAgICAgIDogeCBgXCIke2JpbmRpbmdzLnNjcm9sbFggfHwgYmluZGluZ3Muc2Nyb2xsWX1cIiBpbiB0aGlzLl9zdGF0ZWA7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2Nyb2xsWCA9IGJpbmRpbmdzLnNjcm9sbFggJiYgeCBgdGhpcy5fc3RhdGUuJHtiaW5kaW5ncy5zY3JvbGxYfWA7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2Nyb2xsWSA9IGJpbmRpbmdzLnNjcm9sbFkgJiYgeCBgdGhpcy5fc3RhdGUuJHtiaW5kaW5ncy5zY3JvbGxZfWA7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIubWV0YV9iaW5kaW5ncy5wdXNoKGIgYFxuXHRcdFx0XHRcdGlmICgke2NvbmRpdGlvbn0pIHtcblx0XHRcdFx0XHRcdEBfc2Nyb2xsVG8oJHtzY3JvbGxYIHx8ICdAX3dpbmRvdy5wYWdlWE9mZnNldCd9LCAke3Njcm9sbFkgfHwgJ0Bfd2luZG93LnBhZ2VZT2Zmc2V0J30pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQke3Njcm9sbFggJiYgYCR7c2Nyb2xsWH0gPSBAX3dpbmRvdy5wYWdlWE9mZnNldDtgfVxuXHRcdFx0XHRcdCR7c2Nyb2xsWSAmJiBgJHtzY3JvbGxZfSA9IEBfd2luZG93LnBhZ2VZT2Zmc2V0O2B9XG5cdFx0XHRcdGApO1xuICAgICAgICAgICAgICAgIGJsb2NrLmV2ZW50X2xpc3RlbmVycy5wdXNoKHggYFxuXHRcdFx0XHRcdEBsaXN0ZW4oQF93aW5kb3csIFwiJHtldmVudH1cIiwgKCkgPT4ge1xuXHRcdFx0XHRcdFx0JHtzY3JvbGxpbmd9ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdEBfY2xlYXJUaW1lb3V0KCR7c2Nyb2xsaW5nX3RpbWVvdXR9KTtcblx0XHRcdFx0XHRcdCR7c2Nyb2xsaW5nX3RpbWVvdXR9ID0gQF9zZXRUaW1lb3V0KCR7Y2xlYXJfc2Nyb2xsaW5nfSwgMTAwKTtcblx0XHRcdFx0XHRcdCR7Zm59KCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBwcm9wcy5mb3JFYWNoKHByb3AgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5tZXRhX2JpbmRpbmdzLnB1c2goYiBgdGhpcy5fc3RhdGUuJHtwcm9wLm5hbWV9ID0gQF93aW5kb3cuJHtwcm9wLnZhbHVlfTtgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBibG9jay5ldmVudF9saXN0ZW5lcnMucHVzaCh4IGBcblx0XHRcdFx0XHRAbGlzdGVuKEBfd2luZG93LCBcIiR7ZXZlbnR9XCIsICR7Zm59KVxuXHRcdFx0XHRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbXBvbmVudC5wYXJ0bHlfaG9pc3RlZC5wdXNoKGIgYFxuXHRcdFx0XHRmdW5jdGlvbiAke2lkfSgpIHtcblx0XHRcdFx0XHQke3Byb3BzLm1hcChwcm9wID0+IHJlbmRlcmVyLmludmFsaWRhdGUocHJvcC5uYW1lLCB4IGAke3Byb3AubmFtZX0gPSBAX3dpbmRvdy4ke3Byb3AudmFsdWV9YCkpfVxuXHRcdFx0XHR9XG5cdFx0XHRgKTtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy5pbml0LnB1c2goYiBgXG5cdFx0XHRcdEBhZGRfcmVuZGVyX2NhbGxiYWNrKCR7Zm59KTtcblx0XHRcdGApO1xuICAgICAgICAgICAgY29tcG9uZW50Lmhhc19yZWFjdGl2ZV9hc3NpZ25tZW50cyA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBzcGVjaWFsIGNhc2UuLi4gbWlnaHQgbmVlZCB0byBhYnN0cmFjdCB0aGlzIG91dCBpZiB3ZSBhZGQgbW9yZSBzcGVjaWFsIGNhc2VzXG4gICAgICAgIGlmIChiaW5kaW5ncy5zY3JvbGxYIHx8IGJpbmRpbmdzLnNjcm9sbFkpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IHJlbmRlcmVyLmRpcnR5KFtiaW5kaW5ncy5zY3JvbGxYLCBiaW5kaW5ncy5zY3JvbGxZXS5maWx0ZXIoQm9vbGVhbikpO1xuICAgICAgICAgICAgY29uc3Qgc2Nyb2xsWCA9IGJpbmRpbmdzLnNjcm9sbFggPyByZW5kZXJlci5yZWZlcmVuY2UoYmluZGluZ3Muc2Nyb2xsWCkgOiB4IGBAX3dpbmRvdy5wYWdlWE9mZnNldGA7XG4gICAgICAgICAgICBjb25zdCBzY3JvbGxZID0gYmluZGluZ3Muc2Nyb2xsWSA/IHJlbmRlcmVyLnJlZmVyZW5jZShiaW5kaW5ncy5zY3JvbGxZKSA6IHggYEBfd2luZG93LnBhZ2VZT2Zmc2V0YDtcbiAgICAgICAgICAgIGJsb2NrLmNodW5rcy51cGRhdGUucHVzaChiIGBcblx0XHRcdFx0aWYgKCR7Y29uZGl0aW9ufSAmJiAhJHtzY3JvbGxpbmd9KSB7XG5cdFx0XHRcdFx0JHtzY3JvbGxpbmd9ID0gdHJ1ZTtcblx0XHRcdFx0XHRAX2NsZWFyVGltZW91dCgke3Njcm9sbGluZ190aW1lb3V0fSk7XG5cdFx0XHRcdFx0QF9zY3JvbGxUbygke3Njcm9sbFh9LCAke3Njcm9sbFl9KTtcblx0XHRcdFx0XHQke3Njcm9sbGluZ190aW1lb3V0fSA9IEBfc2V0VGltZW91dCgke2NsZWFyX3Njcm9sbGluZ30sIDEwMCk7XG5cdFx0XHRcdH1cblx0XHRcdGApO1xuICAgICAgICB9XG4gICAgICAgIC8vIGFub3RoZXIgc3BlY2lhbCBjYXNlLiAoSSdtIHN0YXJ0aW5nIHRvIHRoaW5rIHRoZXNlIGFyZSBhbGwgc3BlY2lhbCBjYXNlcy4pXG4gICAgICAgIGlmIChiaW5kaW5ncy5vbmxpbmUpIHtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gYmxvY2suZ2V0X3VuaXF1ZV9uYW1lKCdvbmxpbmVzdGF0dXNjaGFuZ2VkJyk7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gYmluZGluZ3Mub25saW5lO1xuICAgICAgICAgICAgcmVuZGVyZXIuYWRkX3RvX2NvbnRleHQoaWQubmFtZSk7XG4gICAgICAgICAgICBjb25zdCByZWZlcmVuY2UgPSByZW5kZXJlci5yZWZlcmVuY2UoaWQubmFtZSk7XG4gICAgICAgICAgICBjb21wb25lbnQucGFydGx5X2hvaXN0ZWQucHVzaChiIGBcblx0XHRcdFx0ZnVuY3Rpb24gJHtpZH0oKSB7XG5cdFx0XHRcdFx0JHtyZW5kZXJlci5pbnZhbGlkYXRlKG5hbWUsIHggYCR7bmFtZX0gPSBAX25hdmlnYXRvci5vbkxpbmVgKX1cblx0XHRcdFx0fVxuXHRcdFx0YCk7XG4gICAgICAgICAgICBibG9jay5jaHVua3MuaW5pdC5wdXNoKGIgYFxuXHRcdFx0XHRAYWRkX3JlbmRlcl9jYWxsYmFjaygke3JlZmVyZW5jZX0pO1xuXHRcdFx0YCk7XG4gICAgICAgICAgICBibG9jay5ldmVudF9saXN0ZW5lcnMucHVzaCh4IGBAbGlzdGVuKEBfd2luZG93LCBcIm9ubGluZVwiLCAke3JlZmVyZW5jZX0pYCwgeCBgQGxpc3RlbihAX3dpbmRvdywgXCJvZmZsaW5lXCIsICR7cmVmZXJlbmNlfSlgKTtcbiAgICAgICAgICAgIGNvbXBvbmVudC5oYXNfcmVhY3RpdmVfYXNzaWdubWVudHMgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBsaW5rKG5leHQsIHByZXYpIHtcbiAgICBwcmV2Lm5leHQgPSBuZXh0O1xuICAgIGlmIChuZXh0KVxuICAgICAgICBuZXh0LnByZXYgPSBwcmV2O1xufVxuXG5jb25zdCB3cmFwcGVycyA9IHtcbiAgICBBd2FpdEJsb2NrOiBBd2FpdEJsb2NrV3JhcHBlcixcbiAgICBCb2R5OiBCb2R5V3JhcHBlcixcbiAgICBDb21tZW50OiBudWxsLFxuICAgIERlYnVnVGFnOiBEZWJ1Z1RhZ1dyYXBwZXIsXG4gICAgRWFjaEJsb2NrOiBFYWNoQmxvY2tXcmFwcGVyLFxuICAgIEVsZW1lbnQ6IEVsZW1lbnRXcmFwcGVyLFxuICAgIEhlYWQ6IEhlYWRXcmFwcGVyLFxuICAgIElmQmxvY2s6IElmQmxvY2tXcmFwcGVyLFxuICAgIElubGluZUNvbXBvbmVudDogSW5saW5lQ29tcG9uZW50V3JhcHBlcixcbiAgICBLZXlCbG9jazogS2V5QmxvY2tXcmFwcGVyLFxuICAgIE11c3RhY2hlVGFnOiBNdXN0YWNoZVRhZ1dyYXBwZXIsXG4gICAgT3B0aW9uczogbnVsbCxcbiAgICBSYXdNdXN0YWNoZVRhZzogUmF3TXVzdGFjaGVUYWdXcmFwcGVyLFxuICAgIFNsb3Q6IFNsb3RXcmFwcGVyLFxuICAgIFNsb3RUZW1wbGF0ZTogU2xvdFRlbXBsYXRlV3JhcHBlcixcbiAgICBUZXh0OiBUZXh0V3JhcHBlcixcbiAgICBUaXRsZTogVGl0bGVXcmFwcGVyLFxuICAgIFdpbmRvdzogV2luZG93V3JhcHBlclxufTtcbmZ1bmN0aW9uIHRyaW1tYWJsZV9hdChjaGlsZCwgbmV4dF9zaWJsaW5nKSB7XG4gICAgLy8gV2hpdGVzcGFjZSBpcyB0cmltbWFibGUgaWYgb25lIG9mIHRoZSBmb2xsb3dpbmcgaXMgdHJ1ZTpcbiAgICAvLyBUaGUgY2hpbGQgYW5kIGl0cyBzaWJsaW5nIHNoYXJlIGEgY29tbW9uIG5lYXJlc3QgZWFjaCBibG9jayAobm90IGF0IGFuIGVhY2ggYmxvY2sgYm91bmRhcnkpXG4gICAgLy8gVGhlIG5leHQgc2libGluZydzIHByZXZpb3VzIG5vZGUgaXMgYW4gZWFjaCBibG9ja1xuICAgIHJldHVybiAobmV4dF9zaWJsaW5nLm5vZGUuZmluZF9uZWFyZXN0KC9FYWNoQmxvY2svKSA9PT0gY2hpbGQuZmluZF9uZWFyZXN0KC9FYWNoQmxvY2svKSkgfHwgbmV4dF9zaWJsaW5nLm5vZGUucHJldi50eXBlID09PSAnRWFjaEJsb2NrJztcbn1cbmNsYXNzIEZyYWdtZW50V3JhcHBlciB7XG4gICAgY29uc3RydWN0b3IocmVuZGVyZXIsIGJsb2NrLCBub2RlcywgcGFyZW50LCBzdHJpcF93aGl0ZXNwYWNlLCBuZXh0X3NpYmxpbmcpIHtcbiAgICAgICAgdGhpcy5ub2RlcyA9IFtdO1xuICAgICAgICBsZXQgbGFzdF9jaGlsZDtcbiAgICAgICAgbGV0IHdpbmRvd193cmFwcGVyO1xuICAgICAgICBsZXQgaSA9IG5vZGVzLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBub2Rlc1tpXTtcbiAgICAgICAgICAgIGlmICghY2hpbGQudHlwZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbWlzc2luZyB0eXBlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIShjaGlsZC50eXBlIGluIHdyYXBwZXJzKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVE9ETyBpbXBsZW1lbnQgJHtjaGlsZC50eXBlfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlIOKAlCB0aGlzIGlzIGFuIGVhc3kgd2F5IHRvIHJlbW92ZSB3aGl0ZXNwYWNlIHN1cnJvdW5kaW5nXG4gICAgICAgICAgICAvLyA8c3ZlbHRlOndpbmRvdy8+LiBsaWwgaGFja3kgYnV0IGl0IHdvcmtzXG4gICAgICAgICAgICBpZiAoY2hpbGQudHlwZSA9PT0gJ1dpbmRvdycpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3dfd3JhcHBlciA9IG5ldyBXaW5kb3dXcmFwcGVyKHJlbmRlcmVyLCBibG9jaywgcGFyZW50LCBjaGlsZCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2hpbGQudHlwZSA9PT0gJ1RleHQnKSB7XG4gICAgICAgICAgICAgICAgbGV0IHsgZGF0YSB9ID0gY2hpbGQ7XG4gICAgICAgICAgICAgICAgLy8gV2Ugd2FudCB0byByZW1vdmUgdHJhaWxpbmcgd2hpdGVzcGFjZSBpbnNpZGUgYW4gZWxlbWVudC9jb21wb25lbnQvYmxvY2ssXG4gICAgICAgICAgICAgICAgLy8gKnVubGVzcyogdGhlcmUgaXMgbm8gd2hpdGVzcGFjZSBiZXR3ZWVuIHRoaXMgbm9kZSBhbmQgaXRzIG5leHQgc2libGluZ1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vZGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzaG91bGRfdHJpbSA9IChuZXh0X3NpYmxpbmcgPyAobmV4dF9zaWJsaW5nLm5vZGUudHlwZSA9PT0gJ1RleHQnICYmIC9eXFxzLy50ZXN0KG5leHRfc2libGluZy5ub2RlLmRhdGEpICYmIHRyaW1tYWJsZV9hdChjaGlsZCwgbmV4dF9zaWJsaW5nKSkgOiAhY2hpbGQuaGFzX2FuY2VzdG9yKCdFYWNoQmxvY2snKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRfdHJpbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHRyaW1fZW5kKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGdsdWUgdGV4dCBub2RlcyAod2hpY2ggY291bGQgZS5nLiBiZSBzZXBhcmF0ZWQgYnkgY29tbWVudHMpIHRvZ2V0aGVyXG4gICAgICAgICAgICAgICAgaWYgKGxhc3RfY2hpbGQgJiYgbGFzdF9jaGlsZC5ub2RlLnR5cGUgPT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgICAgICBsYXN0X2NoaWxkLmRhdGEgPSBkYXRhICsgbGFzdF9jaGlsZC5kYXRhO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgd3JhcHBlciA9IG5ldyBUZXh0V3JhcHBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgY2hpbGQsIGRhdGEpO1xuICAgICAgICAgICAgICAgIGlmICh3cmFwcGVyLnNraXApXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZXMudW5zaGlmdCh3cmFwcGVyKTtcbiAgICAgICAgICAgICAgICBsaW5rKGxhc3RfY2hpbGQsIGxhc3RfY2hpbGQgPSB3cmFwcGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IFdyYXBwZXIgPSB3cmFwcGVyc1tjaGlsZC50eXBlXTtcbiAgICAgICAgICAgICAgICBpZiAoIVdyYXBwZXIpXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHdyYXBwZXIgPSBuZXcgV3JhcHBlcihyZW5kZXJlciwgYmxvY2ssIHBhcmVudCwgY2hpbGQsIHN0cmlwX3doaXRlc3BhY2UsIGxhc3RfY2hpbGQgfHwgbmV4dF9zaWJsaW5nKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGVzLnVuc2hpZnQod3JhcHBlcik7XG4gICAgICAgICAgICAgICAgbGluayhsYXN0X2NoaWxkLCBsYXN0X2NoaWxkID0gd3JhcHBlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0cmlwX3doaXRlc3BhY2UpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0ID0gdGhpcy5ub2Rlc1swXTtcbiAgICAgICAgICAgIGlmIChmaXJzdCAmJiBmaXJzdC5ub2RlLnR5cGUgPT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgIGZpcnN0LmRhdGEgPSB0cmltX3N0YXJ0KGZpcnN0LmRhdGEpO1xuICAgICAgICAgICAgICAgIGlmICghZmlyc3QuZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBmaXJzdC52YXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGVzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vZGVzWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGVzWzBdLnByZXYgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh3aW5kb3dfd3JhcHBlcikge1xuICAgICAgICAgICAgdGhpcy5ub2Rlcy51bnNoaWZ0KHdpbmRvd193cmFwcGVyKTtcbiAgICAgICAgICAgIGxpbmsobGFzdF9jaGlsZCwgd2luZG93X3dyYXBwZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcihibG9jaywgcGFyZW50X25vZGUsIHBhcmVudF9ub2Rlcykge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubm9kZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIHRoaXMubm9kZXNbaV0ucmVuZGVyKGJsb2NrLCBwYXJlbnRfbm9kZSwgcGFyZW50X25vZGVzKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgUmVuZGVyZXIge1xuICAgIGNvbnN0cnVjdG9yKGNvbXBvbmVudCwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLmNvbnRleHQgPSBbXTtcbiAgICAgICAgdGhpcy5pbml0aWFsX2NvbnRleHQgPSBbXTtcbiAgICAgICAgdGhpcy5jb250ZXh0X2xvb2t1cCA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5ibG9ja3MgPSBbXTtcbiAgICAgICAgdGhpcy5yZWFkb25seSA9IG5ldyBTZXQoKTtcbiAgICAgICAgdGhpcy5tZXRhX2JpbmRpbmdzID0gW107IC8vIGluaXRpYWwgdmFsdWVzIGZvciBlLmcuIHdpbmRvdy5pbm5lcldpZHRoLCBpZiB0aGVyZSdzIGEgPHN2ZWx0ZTp3aW5kb3c+IG1ldGEgdGFnXG4gICAgICAgIHRoaXMuYmluZGluZ19ncm91cHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuY29tcG9uZW50ID0gY29tcG9uZW50O1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmxvY2F0ZSA9IGNvbXBvbmVudC5sb2NhdGU7IC8vIFRPRE8gbWVzc3lcbiAgICAgICAgdGhpcy5maWxlX3ZhciA9IG9wdGlvbnMuZGV2ICYmIHRoaXMuY29tcG9uZW50LmdldF91bmlxdWVfbmFtZSgnZmlsZScpO1xuICAgICAgICBjb21wb25lbnQudmFycy5maWx0ZXIodiA9PiAhdi5ob2lzdGFibGUgfHwgKHYuZXhwb3J0X25hbWUgJiYgIXYubW9kdWxlKSkuZm9yRWFjaCh2ID0+IHRoaXMuYWRkX3RvX2NvbnRleHQodi5uYW1lKSk7XG4gICAgICAgIC8vIGVuc3VyZSBzdG9yZSB2YWx1ZXMgYXJlIGluY2x1ZGVkIGluIGNvbnRleHRcbiAgICAgICAgY29tcG9uZW50LnZhcnMuZmlsdGVyKHYgPT4gdi5zdWJzY3JpYmFibGUpLmZvckVhY2godiA9PiB0aGlzLmFkZF90b19jb250ZXh0KGAkJHt2Lm5hbWV9YCkpO1xuICAgICAgICByZXNlcnZlZF9rZXl3b3Jkcy5mb3JFYWNoKGtleXdvcmQgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbXBvbmVudC52YXJfbG9va3VwLmhhcyhrZXl3b3JkKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkX3RvX2NvbnRleHQoa2V5d29yZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoY29tcG9uZW50LnNsb3RzLnNpemUgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmFkZF90b19jb250ZXh0KCckJHNjb3BlJyk7XG4gICAgICAgICAgICB0aGlzLmFkZF90b19jb250ZXh0KCcjc2xvdHMnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5iaW5kaW5nX2dyb3Vwcy5zaXplID4gMCkge1xuICAgICAgICAgICAgdGhpcy5hZGRfdG9fY29udGV4dCgnJCRiaW5kaW5nX2dyb3VwcycpO1xuICAgICAgICB9XG4gICAgICAgIC8vIG1haW4gYmxvY2tcbiAgICAgICAgdGhpcy5ibG9jayA9IG5ldyBCbG9jayQxKHtcbiAgICAgICAgICAgIHJlbmRlcmVyOiB0aGlzLFxuICAgICAgICAgICAgbmFtZTogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6ICdjb21wb25lbnQnLFxuICAgICAgICAgICAga2V5OiBudWxsLFxuICAgICAgICAgICAgYmluZGluZ3M6IG5ldyBNYXAoKSxcbiAgICAgICAgICAgIGRlcGVuZGVuY2llczogbmV3IFNldCgpXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmJsb2NrLmhhc191cGRhdGVfbWV0aG9kID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5mcmFnbWVudCA9IG5ldyBGcmFnbWVudFdyYXBwZXIodGhpcywgdGhpcy5ibG9jaywgY29tcG9uZW50LmZyYWdtZW50LmNoaWxkcmVuLCBudWxsLCB0cnVlLCBudWxsKTtcbiAgICAgICAgLy8gVE9ETyBtZXNzeVxuICAgICAgICB0aGlzLmJsb2Nrcy5mb3JFYWNoKGJsb2NrID0+IHtcbiAgICAgICAgICAgIGlmIChibG9jayBpbnN0YW5jZW9mIEJsb2NrJDEpIHtcbiAgICAgICAgICAgICAgICBibG9jay5hc3NpZ25fdmFyaWFibGVfbmFtZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYmxvY2suYXNzaWduX3ZhcmlhYmxlX25hbWVzKCk7XG4gICAgICAgIHRoaXMuZnJhZ21lbnQucmVuZGVyKHRoaXMuYmxvY2ssIG51bGwsIHggYCNub2Rlc2ApO1xuICAgICAgICB0aGlzLmNvbnRleHRfb3ZlcmZsb3cgPSB0aGlzLmNvbnRleHQubGVuZ3RoID4gMzE7XG4gICAgICAgIHRoaXMuY29udGV4dC5mb3JFYWNoKG1lbWJlciA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHZhcmlhYmxlIH0gPSBtZW1iZXI7XG4gICAgICAgICAgICBpZiAodmFyaWFibGUpIHtcbiAgICAgICAgICAgICAgICBtZW1iZXIucHJpb3JpdHkgKz0gMjtcbiAgICAgICAgICAgICAgICBpZiAodmFyaWFibGUubXV0YXRlZCB8fCB2YXJpYWJsZS5yZWFzc2lnbmVkKVxuICAgICAgICAgICAgICAgICAgICBtZW1iZXIucHJpb3JpdHkgKz0gNDtcbiAgICAgICAgICAgICAgICAvLyB0aGVzZSBkZXRlcm1pbmUgd2hldGhlciB2YXJpYWJsZSBpcyBpbmNsdWRlZCBpbiBpbml0aWFsIGNvbnRleHRcbiAgICAgICAgICAgICAgICAvLyBhcnJheSwgc28gbXVzdCBoYXZlIHRoZSBoaWdoZXN0IHByaW9yaXR5XG4gICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlLmlzX3JlYWN0aXZlX2RlcGVuZGVuY3kgJiYgKHZhcmlhYmxlLm11dGF0ZWQgfHwgdmFyaWFibGUucmVhc3NpZ25lZCkpXG4gICAgICAgICAgICAgICAgICAgIG1lbWJlci5wcmlvcml0eSArPSAxNjtcbiAgICAgICAgICAgICAgICBpZiAodmFyaWFibGUuZXhwb3J0X25hbWUpXG4gICAgICAgICAgICAgICAgICAgIG1lbWJlci5wcmlvcml0eSArPSAzMjtcbiAgICAgICAgICAgICAgICBpZiAodmFyaWFibGUucmVmZXJlbmNlZClcbiAgICAgICAgICAgICAgICAgICAgbWVtYmVyLnByaW9yaXR5ICs9IDY0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAobWVtYmVyLmlzX25vbl9jb250ZXh0dWFsKSB7XG4gICAgICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgdmFyaWFibGUgaXMgaW5jbHVkZWQgaW4gaW5pdGlhbCBjb250ZXh0XG4gICAgICAgICAgICAgICAgLy8gYXJyYXksIHNvIG11c3QgaGF2ZSB0aGUgaGlnaGVzdCBwcmlvcml0eVxuICAgICAgICAgICAgICAgIG1lbWJlci5wcmlvcml0eSArPSA4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFtZW1iZXIuaXNfY29udGV4dHVhbCkge1xuICAgICAgICAgICAgICAgIG1lbWJlci5wcmlvcml0eSArPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jb250ZXh0LnNvcnQoKGEsIGIpID0+IChiLnByaW9yaXR5IC0gYS5wcmlvcml0eSkgfHwgKGEuaW5kZXgudmFsdWUgLSBiLmluZGV4LnZhbHVlKSk7XG4gICAgICAgIHRoaXMuY29udGV4dC5mb3JFYWNoKChtZW1iZXIsIGkpID0+IG1lbWJlci5pbmRleC52YWx1ZSA9IGkpO1xuICAgICAgICBsZXQgaSA9IHRoaXMuY29udGV4dC5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IG1lbWJlciA9IHRoaXMuY29udGV4dFtpXTtcbiAgICAgICAgICAgIGlmIChtZW1iZXIudmFyaWFibGUpIHtcbiAgICAgICAgICAgICAgICBpZiAobWVtYmVyLnZhcmlhYmxlLnJlZmVyZW5jZWQgfHwgbWVtYmVyLnZhcmlhYmxlLmV4cG9ydF9uYW1lIHx8IChtZW1iZXIudmFyaWFibGUuaXNfcmVhY3RpdmVfZGVwZW5kZW5jeSAmJiAobWVtYmVyLnZhcmlhYmxlLm11dGF0ZWQgfHwgbWVtYmVyLnZhcmlhYmxlLnJlYXNzaWduZWQpKSlcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtZW1iZXIuaXNfbm9uX2NvbnRleHR1YWwpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluaXRpYWxfY29udGV4dCA9IHRoaXMuY29udGV4dC5zbGljZSgwLCBpICsgMSk7XG4gICAgfVxuICAgIGFkZF90b19jb250ZXh0KG5hbWUsIGNvbnRleHR1YWwgPSBmYWxzZSkge1xuICAgICAgICBpZiAoIXRoaXMuY29udGV4dF9sb29rdXAuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICBjb25zdCBtZW1iZXIgPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBpbmRleDogeyB0eXBlOiAnTGl0ZXJhbCcsIHZhbHVlOiB0aGlzLmNvbnRleHQubGVuZ3RoIH0sXG4gICAgICAgICAgICAgICAgaXNfY29udGV4dHVhbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgaXNfbm9uX2NvbnRleHR1YWw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHZhcmlhYmxlOiBudWxsLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0X2xvb2t1cC5zZXQobmFtZSwgbWVtYmVyKTtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5wdXNoKG1lbWJlcik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWVtYmVyID0gdGhpcy5jb250ZXh0X2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgIGlmIChjb250ZXh0dWFsKSB7XG4gICAgICAgICAgICBtZW1iZXIuaXNfY29udGV4dHVhbCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtZW1iZXIuaXNfbm9uX2NvbnRleHR1YWwgPSB0cnVlO1xuICAgICAgICAgICAgbWVtYmVyLnZhcmlhYmxlID0gdGhpcy5jb21wb25lbnQudmFyX2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1lbWJlcjtcbiAgICB9XG4gICAgaW52YWxpZGF0ZShuYW1lLCB2YWx1ZSwgbWFpbl9leGVjdXRpb25fY29udGV4dCA9IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJlcl9pbnZhbGlkYXRlKHRoaXMsIG5hbWUsIHZhbHVlLCBtYWluX2V4ZWN1dGlvbl9jb250ZXh0KTtcbiAgICB9XG4gICAgZGlydHkobmFtZXMsIGlzX3JlYWN0aXZlX2RlY2xhcmF0aW9uID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzO1xuICAgICAgICBjb25zdCBkaXJ0eSA9IChpc19yZWFjdGl2ZV9kZWNsYXJhdGlvblxuICAgICAgICAgICAgPyB4IGAkJHNlbGYuJCQuZGlydHlgXG4gICAgICAgICAgICA6IHggYCNkaXJ0eWApO1xuICAgICAgICBjb25zdCBnZXRfYml0bWFzayA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGJpdG1hc2sgPSBbXTtcbiAgICAgICAgICAgIG5hbWVzLmZvckVhY2goKG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtZW1iZXIgPSByZW5kZXJlci5jb250ZXh0X2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFtZW1iZXIpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAobWVtYmVyLmluZGV4LnZhbHVlID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Vuc2V0IGluZGV4Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbWVtYmVyLmluZGV4LnZhbHVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAodmFsdWUgLyAzMSkgfCAwO1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSAxIDw8ICh2YWx1ZSAlIDMxKTtcbiAgICAgICAgICAgICAgICBpZiAoIWJpdG1hc2tbaV0pXG4gICAgICAgICAgICAgICAgICAgIGJpdG1hc2tbaV0gPSB7IG46IDAsIG5hbWVzOiBbXSB9O1xuICAgICAgICAgICAgICAgIGJpdG1hc2tbaV0ubiB8PSBuO1xuICAgICAgICAgICAgICAgIGJpdG1hc2tbaV0ubmFtZXMucHVzaChuYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGJpdG1hc2s7XG4gICAgICAgIH07XG4gICAgICAgIC8vIFRPRE86IGNvbnRleHQtb3ZlcmZsb3cgbWFrZSBpdCBsZXNzIGdyb3NzXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAvLyBVc2luZyBhIFBhcmVudGhlc2l6ZWRFeHByZXNzaW9uIGFsbG93cyB1cyB0byBjcmVhdGVcbiAgICAgICAgICAgIC8vIHRoZSBleHByZXNzaW9uIGxhemlseS4gVE9ETyB3b3VsZCBiZSBiZXR0ZXIgaWZcbiAgICAgICAgICAgIC8vIGNvbnRleHQgd2FzIGRldGVybWluZWQgYmVmb3JlIHJlbmRlcmluZywgc28gdGhhdFxuICAgICAgICAgICAgLy8gdGhpcyBpbmRpcmVjdGlvbiB3YXMgdW5uZWNlc3NhcnlcbiAgICAgICAgICAgIHR5cGU6ICdQYXJlbnRoZXNpemVkRXhwcmVzc2lvbicsXG4gICAgICAgICAgICBnZXQgZXhwcmVzc2lvbigpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBiaXRtYXNrID0gZ2V0X2JpdG1hc2soKTtcbiAgICAgICAgICAgICAgICBpZiAoIWJpdG1hc2subGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB4IGAke2RpcnR5fSAmIC8qJHtuYW1lcy5qb2luKCcsICcpfSovIDBgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIuY29udGV4dF9vdmVyZmxvdykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYml0bWFza1xuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoYiwgaSkgPT4gKHsgYiwgaSB9KSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKHsgYiB9KSA9PiBiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoeyBiLCBpIH0pID0+IHggYCR7ZGlydHl9WyR7aX1dICYgLyoke2IubmFtZXMuam9pbignLCAnKX0qLyAke2Iubn1gKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlZHVjZSgobGhzLCByaHMpID0+IHggYCR7bGhzfSB8ICR7cmhzfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4geCBgJHtkaXJ0eX0gJiAvKiR7bmFtZXMuam9pbignLCAnKX0qLyAke2JpdG1hc2tbMF0ubn1gO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBOT1RFOiB0aGlzIG1ldGhvZCBtYXkgYmUgY2FsbGVkIGJlZm9yZSB0aGlzLmNvbnRleHRfb3ZlcmZsb3cgLyB0aGlzLmNvbnRleHQgaXMgZnVsbHkgZGVmaW5lZFxuICAgIC8vIHRoZXJlZm9yZSwgdGhleSBjYW4gb25seSBiZSBldmFsdWF0ZWQgbGF0ZXIgaW4gYSBnZXR0ZXIgZnVuY3Rpb25cbiAgICBnZXRfaW5pdGlhbF9kaXJ0eSgpIHtcbiAgICAgICAgY29uc3QgX3RoaXMgPSB0aGlzO1xuICAgICAgICAvLyBUT0RPOiBjb250ZXh0LW92ZXJmbG93IG1ha2UgaXQgbGVzcyBncm9zc1xuICAgICAgICBjb25zdCB2YWwgPSB4IGAtMWA7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXQgdHlwZSgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuY29udGV4dF9vdmVyZmxvdyA/ICdBcnJheUV4cHJlc3Npb24nIDogJ1VuYXJ5RXhwcmVzc2lvbic7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gYXMgWy0xXVxuICAgICAgICAgICAgZ2V0IGVsZW1lbnRzKCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gW107XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBfdGhpcy5jb250ZXh0Lmxlbmd0aDsgaSArPSAzMSkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKHZhbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50cztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBhcyAtMVxuICAgICAgICAgICAgb3BlcmF0b3I6IHZhbC5vcGVyYXRvcixcbiAgICAgICAgICAgIHByZWZpeDogdmFsLnByZWZpeCxcbiAgICAgICAgICAgIGFyZ3VtZW50OiB2YWwuYXJndW1lbnRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmVmZXJlbmNlKG5vZGUsIGN0eCA9ICcjY3R4Jykge1xuICAgICAgICBpZiAodHlwZW9mIG5vZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBub2RlID0geyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6IG5vZGUgfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IG5hbWUsIG5vZGVzIH0gPSBmbGF0dGVuX3JlZmVyZW5jZShub2RlKTtcbiAgICAgICAgY29uc3QgbWVtYmVyID0gdGhpcy5jb250ZXh0X2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgIC8vIFRPRE8gaXMgdGhpcyBjb3JyZWN0P1xuICAgICAgICBpZiAodGhpcy5jb21wb25lbnQudmFyX2xvb2t1cC5nZXQobmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LmFkZF9yZWZlcmVuY2UobmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1lbWJlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCByZXBsYWNlbWVudCA9IHggYC8qJHttZW1iZXIubmFtZX0qLyAke2N0eH1bJHttZW1iZXIuaW5kZXh9XWA7XG4gICAgICAgICAgICBpZiAobm9kZXNbMF0ubG9jKVxuICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Lm9iamVjdC5sb2MgPSBub2Rlc1swXS5sb2M7XG4gICAgICAgICAgICBub2Rlc1swXSA9IHJlcGxhY2VtZW50O1xuICAgICAgICAgICAgcmV0dXJuIG5vZGVzLnJlZHVjZSgobGhzLCByaHMpID0+IHggYCR7bGhzfS4ke3Joc31gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm9kZTtcbiAgICB9XG4gICAgcmVtb3ZlX2Jsb2NrKGJsb2NrKSB7XG4gICAgICAgIHRoaXMuYmxvY2tzLnNwbGljZSh0aGlzLmJsb2Nrcy5pbmRleE9mKGJsb2NrKSwgMSk7XG4gICAgfVxufVxuXG52YXIgY2hhclRvSW50ZWdlciQxID0ge307XG52YXIgY2hhcnMkMSA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSc7XG5mb3IgKHZhciBpJDIgPSAwOyBpJDIgPCBjaGFycyQxLmxlbmd0aDsgaSQyKyspIHtcbiAgICBjaGFyVG9JbnRlZ2VyJDFbY2hhcnMkMS5jaGFyQ29kZUF0KGkkMildID0gaSQyO1xufVxuZnVuY3Rpb24gZGVjb2RlJDEobWFwcGluZ3MpIHtcbiAgICB2YXIgZGVjb2RlZCA9IFtdO1xuICAgIHZhciBsaW5lID0gW107XG4gICAgdmFyIHNlZ21lbnQgPSBbXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgXTtcbiAgICB2YXIgaiA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDAsIHNoaWZ0ID0gMCwgdmFsdWUgPSAwOyBpIDwgbWFwcGluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGMgPSBtYXBwaW5ncy5jaGFyQ29kZUF0KGkpO1xuICAgICAgICBpZiAoYyA9PT0gNDQpIHsgLy8gXCIsXCJcbiAgICAgICAgICAgIHNlZ21lbnRpZnkkMShsaW5lLCBzZWdtZW50LCBqKTtcbiAgICAgICAgICAgIGogPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGMgPT09IDU5KSB7IC8vIFwiO1wiXG4gICAgICAgICAgICBzZWdtZW50aWZ5JDEobGluZSwgc2VnbWVudCwgaik7XG4gICAgICAgICAgICBqID0gMDtcbiAgICAgICAgICAgIGRlY29kZWQucHVzaChsaW5lKTtcbiAgICAgICAgICAgIGxpbmUgPSBbXTtcbiAgICAgICAgICAgIHNlZ21lbnRbMF0gPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIGludGVnZXIgPSBjaGFyVG9JbnRlZ2VyJDFbY107XG4gICAgICAgICAgICBpZiAoaW50ZWdlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGNoYXJhY3RlciAoJyArIFN0cmluZy5mcm9tQ2hhckNvZGUoYykgKyAnKScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGhhc0NvbnRpbnVhdGlvbkJpdCA9IGludGVnZXIgJiAzMjtcbiAgICAgICAgICAgIGludGVnZXIgJj0gMzE7XG4gICAgICAgICAgICB2YWx1ZSArPSBpbnRlZ2VyIDw8IHNoaWZ0O1xuICAgICAgICAgICAgaWYgKGhhc0NvbnRpbnVhdGlvbkJpdCkge1xuICAgICAgICAgICAgICAgIHNoaWZ0ICs9IDU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgc2hvdWxkTmVnYXRlID0gdmFsdWUgJiAxO1xuICAgICAgICAgICAgICAgIHZhbHVlID4+Pj0gMTtcbiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkTmVnYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgPT09IDAgPyAtMHg4MDAwMDAwMCA6IC12YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VnbWVudFtqXSArPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBzaGlmdCA9IDA7IC8vIHJlc2V0XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2VnbWVudGlmeSQxKGxpbmUsIHNlZ21lbnQsIGopO1xuICAgIGRlY29kZWQucHVzaChsaW5lKTtcbiAgICByZXR1cm4gZGVjb2RlZDtcbn1cbmZ1bmN0aW9uIHNlZ21lbnRpZnkkMShsaW5lLCBzZWdtZW50LCBqKSB7XG4gICAgLy8gVGhpcyBsb29rcyB1Z2x5LCBidXQgd2UncmUgY3JlYXRpbmcgc3BlY2lhbGl6ZWQgYXJyYXlzIHdpdGggYSBzcGVjaWZpY1xuICAgIC8vIGxlbmd0aC4gVGhpcyBpcyBtdWNoIGZhc3RlciB0aGFuIGNyZWF0aW5nIGEgbmV3IGFycmF5ICh3aGljaCB2OCBleHBhbmRzIHRvXG4gICAgLy8gYSBjYXBhY2l0eSBvZiAxNyBhZnRlciBwdXNoaW5nIHRoZSBmaXJzdCBpdGVtKSwgb3Igc2xpY2luZyBvdXQgYSBzdWJhcnJheVxuICAgIC8vICh3aGljaCBpcyBzbG93KS4gTGVuZ3RoIDQgaXMgYXNzdW1lZCB0byBiZSB0aGUgbW9zdCBmcmVxdWVudCwgZm9sbG93ZWQgYnlcbiAgICAvLyBsZW5ndGggNSAoc2luY2Ugbm90IGV2ZXJ5dGhpbmcgd2lsbCBoYXZlIGFuIGFzc29jaWF0ZWQgbmFtZSksIGZvbGxvd2VkIGJ5XG4gICAgLy8gbGVuZ3RoIDEgKGl0J3MgcHJvYmFibHkgcmFyZSBmb3IgYSBzb3VyY2Ugc3Vic3RyaW5nIHRvIG5vdCBoYXZlIGFuXG4gICAgLy8gYXNzb2NpYXRlZCBzZWdtZW50IGRhdGEpLlxuICAgIGlmIChqID09PSA0KVxuICAgICAgICBsaW5lLnB1c2goW3NlZ21lbnRbMF0sIHNlZ21lbnRbMV0sIHNlZ21lbnRbMl0sIHNlZ21lbnRbM11dKTtcbiAgICBlbHNlIGlmIChqID09PSA1KVxuICAgICAgICBsaW5lLnB1c2goW3NlZ21lbnRbMF0sIHNlZ21lbnRbMV0sIHNlZ21lbnRbMl0sIHNlZ21lbnRbM10sIHNlZ21lbnRbNF1dKTtcbiAgICBlbHNlIGlmIChqID09PSAxKVxuICAgICAgICBsaW5lLnB1c2goW3NlZ21lbnRbMF1dKTtcbn1cbmZ1bmN0aW9uIGVuY29kZSQxKGRlY29kZWQpIHtcbiAgICB2YXIgc291cmNlRmlsZUluZGV4ID0gMDsgLy8gc2Vjb25kIGZpZWxkXG4gICAgdmFyIHNvdXJjZUNvZGVMaW5lID0gMDsgLy8gdGhpcmQgZmllbGRcbiAgICB2YXIgc291cmNlQ29kZUNvbHVtbiA9IDA7IC8vIGZvdXJ0aCBmaWVsZFxuICAgIHZhciBuYW1lSW5kZXggPSAwOyAvLyBmaWZ0aCBmaWVsZFxuICAgIHZhciBtYXBwaW5ncyA9ICcnO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGVjb2RlZC5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgbGluZSA9IGRlY29kZWRbaV07XG4gICAgICAgIGlmIChpID4gMClcbiAgICAgICAgICAgIG1hcHBpbmdzICs9ICc7JztcbiAgICAgICAgaWYgKGxpbmUubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIHZhciBnZW5lcmF0ZWRDb2RlQ29sdW1uID0gMDsgLy8gZmlyc3QgZmllbGRcbiAgICAgICAgdmFyIGxpbmVNYXBwaW5ncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIGxpbmVfMSA9IGxpbmU7IF9pIDwgbGluZV8xLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgdmFyIHNlZ21lbnQgPSBsaW5lXzFbX2ldO1xuICAgICAgICAgICAgdmFyIHNlZ21lbnRNYXBwaW5ncyA9IGVuY29kZUludGVnZXIkMShzZWdtZW50WzBdIC0gZ2VuZXJhdGVkQ29kZUNvbHVtbik7XG4gICAgICAgICAgICBnZW5lcmF0ZWRDb2RlQ29sdW1uID0gc2VnbWVudFswXTtcbiAgICAgICAgICAgIGlmIChzZWdtZW50Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBzZWdtZW50TWFwcGluZ3MgKz1cbiAgICAgICAgICAgICAgICAgICAgZW5jb2RlSW50ZWdlciQxKHNlZ21lbnRbMV0gLSBzb3VyY2VGaWxlSW5kZXgpICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZUludGVnZXIkMShzZWdtZW50WzJdIC0gc291cmNlQ29kZUxpbmUpICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZUludGVnZXIkMShzZWdtZW50WzNdIC0gc291cmNlQ29kZUNvbHVtbik7XG4gICAgICAgICAgICAgICAgc291cmNlRmlsZUluZGV4ID0gc2VnbWVudFsxXTtcbiAgICAgICAgICAgICAgICBzb3VyY2VDb2RlTGluZSA9IHNlZ21lbnRbMl07XG4gICAgICAgICAgICAgICAgc291cmNlQ29kZUNvbHVtbiA9IHNlZ21lbnRbM107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VnbWVudC5sZW5ndGggPT09IDUpIHtcbiAgICAgICAgICAgICAgICBzZWdtZW50TWFwcGluZ3MgKz0gZW5jb2RlSW50ZWdlciQxKHNlZ21lbnRbNF0gLSBuYW1lSW5kZXgpO1xuICAgICAgICAgICAgICAgIG5hbWVJbmRleCA9IHNlZ21lbnRbNF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaW5lTWFwcGluZ3MucHVzaChzZWdtZW50TWFwcGluZ3MpO1xuICAgICAgICB9XG4gICAgICAgIG1hcHBpbmdzICs9IGxpbmVNYXBwaW5ncy5qb2luKCcsJyk7XG4gICAgfVxuICAgIHJldHVybiBtYXBwaW5ncztcbn1cbmZ1bmN0aW9uIGVuY29kZUludGVnZXIkMShudW0pIHtcbiAgICB2YXIgcmVzdWx0ID0gJyc7XG4gICAgbnVtID0gbnVtIDwgMCA/ICgtbnVtIDw8IDEpIHwgMSA6IG51bSA8PCAxO1xuICAgIGRvIHtcbiAgICAgICAgdmFyIGNsYW1wZWQgPSBudW0gJiAzMTtcbiAgICAgICAgbnVtID4+Pj0gNTtcbiAgICAgICAgaWYgKG51bSA+IDApIHtcbiAgICAgICAgICAgIGNsYW1wZWQgfD0gMzI7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0ICs9IGNoYXJzJDFbY2xhbXBlZF07XG4gICAgfSB3aGlsZSAobnVtID4gMCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAxOSBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENyZWF0ZXMgYSBicmFuZCBuZXcgKHByb3RvdHlwZS1sZXNzKSBvYmplY3Qgd2l0aCB0aGUgZW51bWVyYWJsZS1vd25cbiAqIHByb3BlcnRpZXMgb2YgYHRhcmdldGAuIEFueSBlbnVtZXJhYmxlLW93biBwcm9wZXJ0aWVzIGZyb20gYHNvdXJjZWAgd2hpY2hcbiAqIGFyZSBub3QgcHJlc2VudCBvbiBgdGFyZ2V0YCB3aWxsIGJlIGNvcGllZCBhcyB3ZWxsLlxuICovXG5mdW5jdGlvbiBkZWZhdWx0cyh0YXJnZXQsIHNvdXJjZSkge1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUobnVsbCksIHNvdXJjZSwgdGFyZ2V0KTtcbn1cblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAxOSBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERlY29kZXMgYW4gaW5wdXQgc291cmNlbWFwIGludG8gYSBgRGVjb2RlZFNvdXJjZU1hcGAgc291cmNlbWFwIG9iamVjdC5cbiAqXG4gKiBWYWxpZCBpbnB1dCBtYXBzIGluY2x1ZGUgYSBgRGVjb2RlZFNvdXJjZU1hcGAsIGEgYFJhd1NvdXJjZU1hcGAsIG9yIEpTT05cbiAqIHJlcHJlc2VudGF0aW9ucyBvZiBlaXRoZXIgdHlwZS5cbiAqL1xuZnVuY3Rpb24gZGVjb2RlU291cmNlTWFwKG1hcCkge1xuICAgIGlmICh0eXBlb2YgbWFwID09PSAnc3RyaW5nJykge1xuICAgICAgICBtYXAgPSBKU09OLnBhcnNlKG1hcCk7XG4gICAgfVxuICAgIGxldCB7IG1hcHBpbmdzIH0gPSBtYXA7XG4gICAgaWYgKHR5cGVvZiBtYXBwaW5ncyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgbWFwcGluZ3MgPSBkZWNvZGUkMShtYXBwaW5ncyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBDbG9uZSB0aGUgTGluZSBzbyB0aGF0IHdlIGNhbiBzb3J0IGl0LiBXZSBkb24ndCB3YW50IHRvIG11dGF0ZSBhbiBhcnJheVxuICAgICAgICAvLyB0aGF0IHdlIGRvbid0IG93biBkaXJlY3RseS5cbiAgICAgICAgbWFwcGluZ3MgPSBtYXBwaW5ncy5tYXAoY2xvbmVTZWdtZW50TGluZSk7XG4gICAgfVxuICAgIC8vIFNvcnQgZWFjaCBMaW5lJ3Mgc2VnbWVudHMuIFRoZXJlJ3Mgbm8gZ3VhcmFudGVlIHRoYXQgc2VnbWVudHMgYXJlIHNvcnRlZCBmb3IgdXMsXG4gICAgLy8gYW5kIGV2ZW4gQ2hyb21lJ3MgaW1wbGVtZW50YXRpb24gc29ydHM6XG4gICAgLy8gaHR0cHM6Ly9jcy5jaHJvbWl1bS5vcmcvY2hyb21pdW0vc3JjL3RoaXJkX3BhcnR5L2RldnRvb2xzLWZyb250ZW5kL3NyYy9mcm9udF9lbmQvc2RrL1NvdXJjZU1hcC5qcz9sPTUwNy01MDgmcmNsPTEwOTIzMmJjZjQ3OWM4ZjRlZjhlYWQzY2Y1NmM0OWViMjVmOGMyZjBcbiAgICBtYXBwaW5ncy5mb3JFYWNoKHNvcnRTZWdtZW50cyk7XG4gICAgcmV0dXJuIGRlZmF1bHRzKHsgbWFwcGluZ3MgfSwgbWFwKTtcbn1cbmZ1bmN0aW9uIGNsb25lU2VnbWVudExpbmUoc2VnbWVudHMpIHtcbiAgICByZXR1cm4gc2VnbWVudHMuc2xpY2UoKTtcbn1cbmZ1bmN0aW9uIHNvcnRTZWdtZW50cyhzZWdtZW50cykge1xuICAgIHNlZ21lbnRzLnNvcnQoc2VnbWVudENvbXBhcmF0b3IpO1xufVxuZnVuY3Rpb24gc2VnbWVudENvbXBhcmF0b3IoYSwgYikge1xuICAgIHJldHVybiBhWzBdIC0gYlswXTtcbn1cblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAxOSBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgXCJsZWFmXCIgbm9kZSBpbiB0aGUgc291cmNlbWFwIHRyZWUsIHJlcHJlc2VudGluZyBhbiBvcmlnaW5hbCwgdW5tb2RpZmllZFxuICogc291cmNlIGZpbGUuIFJlY3Vyc2l2ZSBzZWdtZW50IHRyYWNpbmcgZW5kcyBhdCB0aGUgYE9yaWdpbmFsU291cmNlYC5cbiAqL1xuY2xhc3MgT3JpZ2luYWxTb3VyY2Uge1xuICAgIGNvbnN0cnVjdG9yKGZpbGVuYW1lLCBjb250ZW50KSB7XG4gICAgICAgIHRoaXMuZmlsZW5hbWUgPSBmaWxlbmFtZTtcbiAgICAgICAgdGhpcy5jb250ZW50ID0gY29udGVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhY2luZyBhIGBTb3VyY2VNYXBTZWdtZW50YCBlbmRzIHdoZW4gd2UgZ2V0IHRvIGFuIGBPcmlnaW5hbFNvdXJjZWAsXG4gICAgICogbWVhbmluZyB0aGlzIGxpbmUvY29sdW1uIGxvY2F0aW9uIG9yaWdpbmF0ZWQgZnJvbSB0aGlzIHNvdXJjZSBmaWxlLlxuICAgICAqL1xuICAgIHRyYWNlU2VnbWVudChsaW5lLCBjb2x1bW4sIG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHsgY29sdW1uLCBsaW5lLCBuYW1lLCBzb3VyY2U6IHRoaXMgfTtcbiAgICB9XG59XG5cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG5jb25zdCBVcmwkMSA9ICh0eXBlb2YgVVJMICE9PSAndW5kZWZpbmVkJyA/IFVSTCA6IHJlcXVpcmUoJ3VybCcpLlVSTCk7XG4vLyBNYXRjaGVzIFwiLi5cIiwgd2hpY2ggbXVzdCBiZSBwcmVjZWVkZWQgYnkgXCIvXCIgb3IgdGhlIHN0YXJ0IG9mIHRoZSBzdHJpbmcsIGFuZFxuLy8gbXVzdCBiZSBmb2xsb3dlZCBieSBhIFwiL1wiLiBXZSBkbyBub3QgZWF0IHRoZSBmb2xsb3dpbmcgXCIvXCIsIHNvIHRoYXQgdGhlIG5leHRcbi8vIGl0ZXJhdGlvbiBjYW4gbWF0Y2ggb24gaXQuXG5jb25zdCBwYXJlbnRSZWdleCA9IC8oXnxcXC8pXFwuXFwuKD89XFwvfCQpL2c7XG5mdW5jdGlvbiBpc0Fic29sdXRlVXJsKHVybCkge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiAhIW5ldyBVcmwkMSh1cmwpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuLyoqXG4gKiBDcmVhdGVzIGEgZGlyZWN0b3J5IG5hbWUgdGhhdCBpcyBndWFyYW50ZWVkIHRvIG5vdCBiZSBpbiBgc3RyYC5cbiAqL1xuZnVuY3Rpb24gdW5pcUluU3RyKHN0cikge1xuICAgIGxldCB1bmlxID0gU3RyaW5nKE1hdGgucmFuZG9tKCkpLnNsaWNlKDIpO1xuICAgIHdoaWxlIChzdHIuaW5kZXhPZih1bmlxKSA+IC0xKSB7XG4gICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICAgIHVuaXEgKz0gdW5pcTtcbiAgICB9XG4gICAgcmV0dXJuIHVuaXE7XG59XG4vKipcbiAqIFJlbW92ZXMgdGhlIGZpbGVuYW1lIGZyb20gdGhlIHBhdGggKGV2ZXJ5dGhpbmcgdHJhaWxpbmcgdGhlIGxhc3QgXCIvXCIpLiBUaGlzXG4gKiBpcyBvbmx5IHNhZmUgdG8gY2FsbCBvbiBhIHBhdGgsIG5ldmVyIGNhbGwgd2l0aCBhbiBhYnNvbHV0ZSBvciBwcm90b2NvbFxuICogcmVsYXRpdmUgVVJMLlxuICovXG5mdW5jdGlvbiBzdHJpcFBhdGhGaWxlbmFtZShwYXRoKSB7XG4gICAgcGF0aCA9IG5vcm1hbGl6ZVBhdGgocGF0aCk7XG4gICAgY29uc3QgaW5kZXggPSBwYXRoLmxhc3RJbmRleE9mKCcvJyk7XG4gICAgcmV0dXJuIHBhdGguc2xpY2UoMCwgaW5kZXggKyAxKTtcbn1cbi8qKlxuICogTm9ybWFsaXplcyBhIHByb3RvY29sLXJlbGF0aXZlIFVSTCwgYnV0IGtlZXBzIGl0IHByb3RvY29sIHJlbGF0aXZlIGJ5XG4gKiBzdHJpcHBpbmcgb3V0IHRoZSBwcm90b2NsIGJlZm9yZSByZXR1cm5pbmcgaXQuXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZVByb3RvY29sUmVsYXRpdmUoaW5wdXQsIGFic29sdXRlQmFzZSkge1xuICAgIGNvbnN0IHsgaHJlZiwgcHJvdG9jb2wgfSA9IG5ldyBVcmwkMShpbnB1dCwgYWJzb2x1dGVCYXNlKTtcbiAgICByZXR1cm4gaHJlZi5zbGljZShwcm90b2NvbC5sZW5ndGgpO1xufVxuLyoqXG4gKiBOb3JtYWxpemVzIGEgc2ltcGxlIHBhdGggKG9uZSB0aGF0IGhhcyBubyBcIi4uXCJzLCBvciBpcyBhYnNvbHV0ZSBzbyBcIi4uXCJzIGNhblxuICogYmUgbm9ybWFsaXplZCBhYnNvbHV0ZWx5KS5cbiAqL1xuZnVuY3Rpb24gbm9ybWFsaXplU2ltcGxlUGF0aChpbnB1dCkge1xuICAgIGNvbnN0IHsgaHJlZiB9ID0gbmV3IFVybCQxKGlucHV0LCAnaHR0cHM6Ly9mb28uY29tLycpO1xuICAgIHJldHVybiBocmVmLnNsaWNlKCdodHRwczovL2Zvby5jb20vJy5sZW5ndGgpO1xufVxuLyoqXG4gKiBOb3JtYWxpemVzIGEgcGF0aCwgZW5zdXJpbmcgdGhhdCBleGNlc3MgXCIuLlwicyBhcmUgcHJlc2VydmVkIGZvciByZWxhdGl2ZVxuICogcGF0aHMgaW4gdGhlIG91dHB1dC5cbiAqXG4gKiBJZiB0aGUgaW5wdXQgaXMgYWJzb2x1dGUsIHRoaXMgd2lsbCByZXR1cm4gYW4gYWJzb2x1dGV5IG5vcm1hbGl6ZWQgcGF0aCwgYnV0XG4gKiBpdCB3aWxsIG5vdCBoYXZlIGEgbGVhZGluZyBcIi9cIi5cbiAqXG4gKiBJZiB0aGUgaW5wdXQgaGFzIGEgbGVhZGluZyBcIi4uXCIsIHRoZSBvdXRwdXQgd2lsbCBoYXZlIGEgbGVhZGluZyBcIi4uXCIuXG4gKlxuICogSWYgdGhlIGlucHV0IGhhcyBhIGxlYWRpbmcgXCIuXCIsIHRoZSBvdXRwdXQgd2lsbCBub3QgaGF2ZSBhIGxlYWRpbmcgXCIuXCJcbiAqIHVubGVzcyB0aGVyZSBhcmUgdG9vIG1hbnkgXCIuLlwicywgaW4gd2hpY2ggY2FzZSB0aGVyZSB3aWxsIGJlIGEgbGVhZGluZyBcIi4uXCIuXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZVBhdGgoaW5wdXQpIHtcbiAgICAvLyBJZiB0aGVyZSBhcmUgbm8gXCIuLlwicywgd2UgY2FuIHRyZWF0IHRoaXMgYXMgaWYgaXQgd2VyZSBhbiBhYnNvbHV0ZSBwYXRoLlxuICAgIC8vIFRoZSByZXR1cm4gd29uJ3QgYmUgYW4gYWJzb2x1dGUgcGF0aCwgc28gaXQncyBlYXN5LlxuICAgIGlmICghcGFyZW50UmVnZXgudGVzdChpbnB1dCkpXG4gICAgICAgIHJldHVybiBub3JtYWxpemVTaW1wbGVQYXRoKGlucHV0KTtcbiAgICAvLyBXZSBhbHJlYWR5IGZvdW5kIG9uZSBcIi4uXCIuIExldCdzIHNlZSBob3cgbWFueSB0aGVyZSBhcmUuXG4gICAgbGV0IHRvdGFsID0gMTtcbiAgICB3aGlsZSAocGFyZW50UmVnZXgudGVzdChpbnB1dCkpXG4gICAgICAgIHRvdGFsKys7XG4gICAgLy8gSWYgdGhlcmUgYXJlIFwiLi5cInMsIHdlIG5lZWQgdG8gcHJlZml4IHRoZSB0aGUgcGF0aCB3aXRoIHRoZSBzYW1lIG51bWJlciBvZlxuICAgIC8vIHVuaXF1ZSBkaXJlY3Rvcmllcy4gVGhpcyBpcyB0byBlbnN1cmUgdGhhdCB3ZSBcInJlbWVtYmVyXCIgaG93IG1hbnkgcGFyZW50XG4gICAgLy8gZGlyZWN0b3JpZXMgd2UgYXJlIGFjY2Vzc2luZy4gRWcsIFwiLi4vLi4vLi5cIiBtdXN0IGtlZXAgMywgYW5kIFwiZm9vLy4uLy4uXCJcbiAgICAvLyBtdXN0IGtlZXAgMS5cbiAgICBjb25zdCB1bmlxRGlyZWN0b3J5ID0gYHoke3VuaXFJblN0cihpbnB1dCl9L2A7XG4gICAgLy8gdW5pcURpcmVjdG9yeSBpcyBqdXN0IGEgXCJ6XCIsIGZvbGxvd2VkIGJ5IG51bWJlcnMsIGZvbGxvd2VkIGJ5IGEgXCIvXCIuIFNvXG4gICAgLy8gZ2VuZXJhdGluZyBhIHJ1bnRpbWUgcmVnZXggZnJvbSBpdCBpcyBzYWZlLiBXZSdsbCB1c2UgdGhpcyBzZWFyY2ggcmVnZXggdG9cbiAgICAvLyBzdHJpcCBvdXQgb3VyIHVuaXEgZGlyZWN0b3J5IG5hbWVzIGFuZCBpbnNlcnQgYW55IG5lZWRlZCBcIi4uXCJzLlxuICAgIGNvbnN0IHNlYXJjaCA9IG5ldyBSZWdFeHAoYF4oPzoke3VuaXFEaXJlY3Rvcnl9KSpgKTtcbiAgICAvLyBOb3cgd2UgY2FuIHJlc29sdmUgdGhlIHRvdGFsIHBhdGguIElmIHRoZXJlIGFyZSBleGNlc3MgXCIuLlwicywgdGhleSB3aWxsXG4gICAgLy8gZWxpbWluYXRlIG9uZSBvciBtb3JlIG9mIHRoZSB1bmlxdWUgZGlyZWN0b3JpZXMgd2UgcHJlZml4IHdpdGguXG4gICAgY29uc3QgcmVsYXRpdmUgPSBub3JtYWxpemVTaW1wbGVQYXRoKHVuaXFEaXJlY3RvcnkucmVwZWF0KHRvdGFsKSArIGlucHV0KTtcbiAgICAvLyBXZSBjYW4gbm93IGNvdW50IHRoZSBudW1iZXIgb2YgdW5pcXVlIGRpcmVjdG9yaWVzIHRoYXQgd2VyZSBlbGltaW5hdGVkLiBJZlxuICAgIC8vIHRoZXJlIHdlcmUgMywgYW5kIDEgd2FzIGVsaW1pbmF0ZWQsIHdlIGtub3cgd2Ugb25seSBuZWVkIHRvIGFkZCAxIFwiLi5cIi4gSWZcbiAgICAvLyAyIHdlcmUgZWxpbWluYXRlZCwgd2UgbmVlZCB0byBpbnNlcnQgMiBcIi4uXCJzLiBJZiBhbGwgMyB3ZXJlIGVsaW1pbmF0ZWQsXG4gICAgLy8gdGhlbiB3ZSBuZWVkIDMsIGV0Yy4gVGhpcyByZXBsYWNlIGlzIGd1cmFudGVlZCB0byBtYXRjaCAoaXQgbWF5IG1hdGNoIDAgb3JcbiAgICAvLyBtb3JlIHRpbWVzKSwgYW5kIHdlIGNhbiBjb3VudCB0aGUgdG90YWwgbWF0Y2ggdG8gc2VlIGhvdyBtYW55IHdlcmUgZWxpbWluYXRlZC5cbiAgICByZXR1cm4gcmVsYXRpdmUucmVwbGFjZShzZWFyY2gsIChhbGwpID0+IHtcbiAgICAgICAgY29uc3QgbGVmdG92ZXIgPSBhbGwubGVuZ3RoIC8gdW5pcURpcmVjdG9yeS5sZW5ndGg7XG4gICAgICAgIHJldHVybiAnLi4vJy5yZXBlYXQodG90YWwgLSBsZWZ0b3Zlcik7XG4gICAgfSk7XG59XG4vKipcbiAqIEF0dGVtcHRzIHRvIHJlc29sdmUgYGlucHV0YCBVUkwgcmVsYXRpdmUgdG8gYGJhc2VgLlxuICovXG5mdW5jdGlvbiByZXNvbHZlKGlucHV0LCBiYXNlKSB7XG4gICAgaWYgKCFiYXNlKVxuICAgICAgICBiYXNlID0gJyc7XG4gICAgLy8gQWJzb2x1dGUgVVJMcyBhcmUgdmVyeSBlYXN5IHRvIHJlc29sdmUgcmlnaHQuXG4gICAgaWYgKGlzQWJzb2x1dGVVcmwoaW5wdXQpKVxuICAgICAgICByZXR1cm4gbmV3IFVybCQxKGlucHV0KS5ocmVmO1xuICAgIGlmIChiYXNlKSB7XG4gICAgICAgIC8vIEFic29sdXRlIFVSTHMgYXJlIGVhc3kuLi5cbiAgICAgICAgaWYgKGlzQWJzb2x1dGVVcmwoYmFzZSkpXG4gICAgICAgICAgICByZXR1cm4gbmV3IFVybCQxKGlucHV0LCBiYXNlKS5ocmVmO1xuICAgICAgICAvLyBJZiBiYXNlIGlzIHByb3RvY29sIHJlbGF0aXZlLCB3ZSdsbCByZXNvbHZlIHdpdGggaXQgYnV0IGtlZXAgdGhlIHJlc3VsdFxuICAgICAgICAvLyBwcm90b2NvbCByZWxhdGl2ZS5cbiAgICAgICAgaWYgKGJhc2Uuc3RhcnRzV2l0aCgnLy8nKSlcbiAgICAgICAgICAgIHJldHVybiBub3JtYWxpemVQcm90b2NvbFJlbGF0aXZlKGlucHV0LCBgaHR0cHM6JHtiYXNlfWApO1xuICAgIH1cbiAgICAvLyBOb3JtYWxpemUgaW5wdXQsIGJ1dCBrZWVwIGl0IHByb3RvY29sIHJlbGF0aXZlLiBXZSBrbm93IGJhc2UgZG9lc24ndCBzdXBwbHlcbiAgICAvLyBhIHByb3RvY29sLCBiZWNhdXNlIHRoYXQgd291bGQgaGF2ZSBiZWVuIGhhbmRsZWQgYWJvdmUuXG4gICAgaWYgKGlucHV0LnN0YXJ0c1dpdGgoJy8vJykpXG4gICAgICAgIHJldHVybiBub3JtYWxpemVQcm90b2NvbFJlbGF0aXZlKGlucHV0LCAnaHR0cHM6Ly9mb28uY29tLycpO1xuICAgIC8vIFdlIG5vdyBrbm93IHRoYXQgYmFzZSAoaWYgdGhlcmUgaXMgb25lKSBhbmQgaW5wdXQgYXJlIHBhdGhzLiBXZSd2ZSBoYW5kbGVkXG4gICAgLy8gYm90aCBhYnNvbHV0ZSBhbmQgcHJvdG9jb2wtcmVsYXRpdmUgdmFyaWF0aW9ucyBhYm92ZS5cbiAgICAvLyBBYnNvbHV0ZSBwYXRocyBkb24ndCBuZWVkIGFueSBzcGVjaWFsIGhhbmRsaW5nLCBiZWNhdXNlIHRoZXkgY2Fubm90IGhhdmVcbiAgICAvLyBleHRyYSBcIi5cIiBvciBcIi4uXCJzLiBUaGF0J2xsIGFsbCBiZSBzdHJpcHBlZCBhd2F5LiBJbnB1dCB0YWtlcyBwcmlvcml0eSBoZXJlLFxuICAgIC8vIGJlY2F1c2UgaWYgaW5wdXQgaXMgYW4gYWJzb2x1dGUgcGF0aCwgYmFzZSBwYXRoIHdvbid0IGFmZmVjdCBpdCBpbiBhbnkgd2F5LlxuICAgIGlmIChpbnB1dC5zdGFydHNXaXRoKCcvJykpXG4gICAgICAgIHJldHVybiAnLycgKyBub3JtYWxpemVTaW1wbGVQYXRoKGlucHV0KTtcbiAgICAvLyBTaW5jZSBpbnB1dCBhbmQgYmFzZSBhcmUgcGF0aHMsIHdlIG5lZWQgdG8gam9pbiB0aGVtIHRvIGRvIGFueSBmdXJ0aGVyXG4gICAgLy8gcHJvY2Vzc2luZy4gUGF0aHMgYXJlIGpvaW5lZCBhdCB0aGUgZGlyZWN0b3J5IGxldmVsLCBzbyB3ZSBuZWVkIHRvIHJlbW92ZVxuICAgIC8vIHRoZSBiYXNlJ3MgZmlsZW5hbWUgYmVmb3JlIGpvaW5pbmcuIFdlIGFsc28ga25vdyB0aGF0IGlucHV0IGRvZXMgbm90IGhhdmUgYVxuICAgIC8vIGxlYWRpbmcgc2xhc2gsIGFuZCB0aGF0IHRoZSBzdHJpcHBlZCBiYXNlIHdpbGwgaGF2ZSBhIHRyYWlsaW5nIHNsYXNoIGlmXG4gICAgLy8gdGhlcmUgYXJlIGFueSBkaXJlY3RvcmllcyAob3IgaXQnbGwgYmUgZW1wdHkpLlxuICAgIGNvbnN0IGpvaW5lZCA9IHN0cmlwUGF0aEZpbGVuYW1lKGJhc2UpICsgaW5wdXQ7XG4gICAgLy8gSWYgYmFzZSBpcyBhbiBhYnNvbHV0ZSBwYXRoLCB0aGVuIGlucHV0IHdpbGwgYmUgcmVsYXRpdmUgdG8gaXQuXG4gICAgaWYgKGJhc2Uuc3RhcnRzV2l0aCgnLycpKVxuICAgICAgICByZXR1cm4gJy8nICsgbm9ybWFsaXplU2ltcGxlUGF0aChqb2luZWQpO1xuICAgIC8vIFdlIG5vdyBrbm93IGJvdGggYmFzZSAoaWYgdGhlcmUgaXMgb25lKSBhbmQgaW5wdXQgYXJlIHJlbGF0aXZlIHBhdGhzLlxuICAgIGNvbnN0IHJlbGF0aXZlID0gbm9ybWFsaXplUGF0aChqb2luZWQpO1xuICAgIC8vIElmIGJhc2Ugc3RhcnRlZCB3aXRoIGEgbGVhZGluZyBcIi5cIiwgb3IgdGhlcmUgaXMgbm8gYmFzZSBhbmQgaW5wdXQgc3RhcnRlZFxuICAgIC8vIHdpdGggYSBcIi5cIiwgdGhlbiB3ZSBuZWVkIHRvIGVuc3VyZSB0aGF0IHRoZSByZWxhdGl2ZSBwYXRoIHN0YXJ0cyB3aXRoIGFcbiAgICAvLyBcIi5cIi4gV2UgZG9uJ3Qga25vdyBpZiByZWxhdGl2ZSBzdGFydHMgd2l0aCBhIFwiLi5cIiwgdGhvdWdoLCBzbyBjaGVjayBiZWZvcmVcbiAgICAvLyBwcmVwZW5kaW5nLlxuICAgIGlmICgoYmFzZSB8fCBpbnB1dCkuc3RhcnRzV2l0aCgnLicpICYmICFyZWxhdGl2ZS5zdGFydHNXaXRoKCcuJykpIHtcbiAgICAgICAgcmV0dXJuICcuLycgKyByZWxhdGl2ZTtcbiAgICB9XG4gICAgcmV0dXJuIHJlbGF0aXZlO1xufVxuXG4vKipcbiAqIENvcHlyaWdodCAyMDE5IFRoZSBBTVAgSFRNTCBBdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIHJlc29sdmUkMShpbnB1dCwgYmFzZSkge1xuICAgIC8vIFRoZSBiYXNlIGlzIGFsd2F5cyB0cmVhdGVkIGFzIGEgZGlyZWN0b3J5LCBpZiBpdCdzIG5vdCBlbXB0eS5cbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbW96aWxsYS9zb3VyY2UtbWFwL2Jsb2IvOGNiM2VlNTcvbGliL3V0aWwuanMjTDMyN1xuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9jaHJvbWl1bS9jaHJvbWl1bS9ibG9iL2RhNGFkYmIzL3RoaXJkX3BhcnR5L2JsaW5rL3JlbmRlcmVyL2RldnRvb2xzL2Zyb250X2VuZC9zZGsvU291cmNlTWFwLmpzI0w0MDAtTDQwMVxuICAgIGlmIChiYXNlICYmICFiYXNlLmVuZHNXaXRoKCcvJykpXG4gICAgICAgIGJhc2UgKz0gJy8nO1xuICAgIHJldHVybiByZXNvbHZlKGlucHV0LCBiYXNlKTtcbn1cblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAxOSBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgYmluYXJ5IHNlYXJjaCBpbXBsZW1lbnRhdGlvbiB0aGF0IHJldHVybnMgdGhlIGluZGV4IGlmIGEgbWF0Y2ggaXMgZm91bmQsXG4gKiBvciB0aGUgbmVnYXRlZCBpbmRleCBvZiB3aGVyZSB0aGUgYG5lZWRsZWAgc2hvdWxkIGJlIGluc2VydGVkLlxuICpcbiAqIFRoZSBgY29tcGFyYXRvcmAgY2FsbGJhY2sgcmVjZWl2ZXMgYm90aCB0aGUgYGl0ZW1gIHVuZGVyIGNvbXBhcmlzb24gYW5kIHRoZVxuICogbmVlZGxlIHdlIGFyZSBzZWFyY2hpbmcgZm9yLiBJdCBtdXN0IHJldHVybiBgMGAgaWYgdGhlIGBpdGVtYCBpcyBhIG1hdGNoLFxuICogYW55IG5lZ2F0aXZlIG51bWJlciBpZiBgaXRlbWAgaXMgdG9vIHNtYWxsIChhbmQgd2UgbXVzdCBzZWFyY2ggYWZ0ZXIgaXQpLCBvclxuICogYW55IHBvc2l0aXZlIG51bWJlciBpZiB0aGUgYGl0ZW1gIGlzIHRvbyBsYXJnZSAoYW5kIHdlIG11c3Qgc2VhcmNoIGJlZm9yZVxuICogaXQpLlxuICpcbiAqIElmIG5vIG1hdGNoIGlzIGZvdW5kLCBhIG5lZ2F0ZWQgaW5kZXggb2Ygd2hlcmUgdG8gaW5zZXJ0IHRoZSBgbmVlZGxlYCBpc1xuICogcmV0dXJuZWQuIFRoaXMgbmVnYXRlZCBpbmRleCBpcyBndWFyYW50ZWVkIHRvIGJlIGxlc3MgdGhhbiAwLiBUbyBpbnNlcnQgYW5cbiAqIGl0ZW0sIG5lZ2F0ZSBpdCAoYWdhaW4pIGFuZCBzcGxpY2U6XG4gKlxuICogYGBganNcbiAqIGNvbnN0IGFycmF5ID0gWzEsIDNdO1xuICogY29uc3QgbmVlZGxlID0gMjtcbiAqIGNvbnN0IGluZGV4ID0gYmluYXJ5U2VhcmNoKGFycmF5LCBuZWVkbGUsIChpdGVtLCBuZWVkbGUpID0+IGl0ZW0gLSBuZWVkbGUpO1xuICpcbiAqIGFzc2VydC5lcXVhbChpbmRleCwgLTIpO1xuICogYXNzZXJ0LmVxdWFsKH5pbmRleCwgMSk7XG4gKiBhcnJheS5zcGxpY2UofmluZGV4LCAwLCBuZWVkbGUpO1xuICogYXNzZXJ0LmRlZXBFcXVhbChhcnJheSwgWzEsIDIsIDNdKTtcbiAqIGBgYFxuICovXG5mdW5jdGlvbiBiaW5hcnlTZWFyY2goaGF5c3RhY2ssIG5lZWRsZSwgY29tcGFyYXRvcikge1xuICAgIGxldCBsb3cgPSAwO1xuICAgIGxldCBoaWdoID0gaGF5c3RhY2subGVuZ3RoIC0gMTtcbiAgICB3aGlsZSAobG93IDw9IGhpZ2gpIHtcbiAgICAgICAgY29uc3QgbWlkID0gbG93ICsgKChoaWdoIC0gbG93KSA+PiAxKTtcbiAgICAgICAgY29uc3QgY21wID0gY29tcGFyYXRvcihoYXlzdGFja1ttaWRdLCBuZWVkbGUpO1xuICAgICAgICBpZiAoY21wID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbWlkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbXAgPCAwKSB7XG4gICAgICAgICAgICBsb3cgPSBtaWQgKyAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGlnaCA9IG1pZCAtIDE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIH5sb3c7XG59XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTkgVGhlIEFNUCBIVE1MIEF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBGYXN0U3RyaW5nQXJyYXkgYWN0cyBsaWtlIGEgYFNldGAgKGFsbG93aW5nIG9ubHkgb25lIG9jY3VycmVuY2Ugb2YgYSBzdHJpbmdcbiAqIGBrZXlgKSwgYnV0IHByb3ZpZGVzIHRoZSBpbmRleCBvZiB0aGUgYGtleWAgaW4gdGhlIGJhY2tpbmcgYXJyYXkuXG4gKlxuICogVGhpcyBpcyBkZXNpZ25lZCB0byBhbGxvdyBzeW5jaHJvbml6aW5nIGEgc2Vjb25kIGFycmF5IHdpdGggdGhlIGNvbnRlbnRzIG9mXG4gKiB0aGUgYmFja2luZyBhcnJheSwgbGlrZSBob3cgYHNvdXJjZXNDb250ZW50W2ldYCBpcyB0aGUgc291cmNlIGNvbnRlbnRcbiAqIGFzc29jaWF0ZWQgd2l0aCBgc291cmNlW2ldYCwgYW5kIHRoZXJlIGFyZSBuZXZlciBkdXBsaWNhdGVzLlxuICovXG5jbGFzcyBGYXN0U3RyaW5nQXJyYXkge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmluZGV4ZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgICB0aGlzLmFycmF5ID0gW107XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFB1dHMgYGtleWAgaW50byB0aGUgYmFja2luZyBhcnJheSwgaWYgaXQgaXMgbm90IGFscmVhZHkgcHJlc2VudC4gUmV0dXJuc1xuICAgICAqIHRoZSBpbmRleCBvZiB0aGUgYGtleWAgaW4gdGhlIGJhY2tpbmcgYXJyYXkuXG4gICAgICovXG4gICAgcHV0KGtleSkge1xuICAgICAgICBjb25zdCB7IGFycmF5LCBpbmRleGVzIH0gPSB0aGlzO1xuICAgICAgICAvLyBUaGUga2V5IG1heSBvciBtYXkgbm90IGJlIHByZXNlbnQuIElmIGl0IGlzIHByZXNlbnQsIGl0J3MgYSBudW1iZXIuXG4gICAgICAgIGxldCBpbmRleCA9IGluZGV4ZXNba2V5XTtcbiAgICAgICAgLy8gSWYgaXQncyBub3QgeWV0IHByZXNlbnQsIHdlIG5lZWQgdG8gaW5zZXJ0IGl0IGFuZCB0cmFjayB0aGUgaW5kZXggaW4gdGhlXG4gICAgICAgIC8vIGluZGV4ZXMuXG4gICAgICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpbmRleCA9IGluZGV4ZXNba2V5XSA9IGFycmF5Lmxlbmd0aDtcbiAgICAgICAgICAgIGFycmF5LnB1c2goa2V5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgfVxufVxuXG4vKipcbiAqIENvcHlyaWdodCAyMDE5IFRoZSBBTVAgSFRNTCBBdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogU291cmNlTWFwVHJlZSByZXByZXNlbnRzIGEgc2luZ2xlIHNvdXJjZW1hcCwgd2l0aCB0aGUgYWJpbGl0eSB0byB0cmFjZVxuICogbWFwcGluZ3MgaW50byBpdHMgY2hpbGQgbm9kZXMgKHdoaWNoIG1heSB0aGVtc2VsdmVzIGJlIFNvdXJjZU1hcFRyZWVzKS5cbiAqL1xuY2xhc3MgU291cmNlTWFwVHJlZSB7XG4gICAgY29uc3RydWN0b3IobWFwLCBzb3VyY2VzKSB7XG4gICAgICAgIHRoaXMubWFwID0gbWFwO1xuICAgICAgICB0aGlzLnNvdXJjZXMgPSBzb3VyY2VzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB0cmFjZU1hcHBpbmdzIGlzIG9ubHkgY2FsbGVkIG9uIHRoZSByb290IGxldmVsIFNvdXJjZU1hcFRyZWUsIGFuZCBiZWdpbnNcbiAgICAgKiB0aGUgcHJvY2VzcyBvZiByZXNvbHZpbmcgZWFjaCBtYXBwaW5nIGluIHRlcm1zIG9mIHRoZSBvcmlnaW5hbCBzb3VyY2VcbiAgICAgKiBmaWxlcy5cbiAgICAgKi9cbiAgICB0cmFjZU1hcHBpbmdzKCkge1xuICAgICAgICBjb25zdCBtYXBwaW5ncyA9IFtdO1xuICAgICAgICBjb25zdCBuYW1lcyA9IG5ldyBGYXN0U3RyaW5nQXJyYXkoKTtcbiAgICAgICAgY29uc3Qgc291cmNlcyA9IG5ldyBGYXN0U3RyaW5nQXJyYXkoKTtcbiAgICAgICAgY29uc3Qgc291cmNlc0NvbnRlbnQgPSBbXTtcbiAgICAgICAgY29uc3QgeyBtYXBwaW5nczogcm9vdE1hcHBpbmdzLCBuYW1lczogcm9vdE5hbWVzIH0gPSB0aGlzLm1hcDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb290TWFwcGluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHNlZ21lbnRzID0gcm9vdE1hcHBpbmdzW2ldO1xuICAgICAgICAgICAgY29uc3QgdHJhY2VkU2VnbWVudHMgPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2VnbWVudHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWdtZW50ID0gc2VnbWVudHNbal07XG4gICAgICAgICAgICAgICAgLy8gMS1sZW5ndGggc2VnbWVudHMgb25seSBtb3ZlIHRoZSBjdXJyZW50IGdlbmVyYXRlZCBjb2x1bW4sIHRoZXJlJ3Mgbm9cbiAgICAgICAgICAgICAgICAvLyBzb3VyY2UgaW5mb3JtYXRpb24gdG8gZ2F0aGVyIGZyb20gaXQuXG4gICAgICAgICAgICAgICAgaWYgKHNlZ21lbnQubGVuZ3RoID09PSAxKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2UgPSB0aGlzLnNvdXJjZXNbc2VnbWVudFsxXV07XG4gICAgICAgICAgICAgICAgY29uc3QgdHJhY2VkID0gc291cmNlLnRyYWNlU2VnbWVudChzZWdtZW50WzJdLCBzZWdtZW50WzNdLCBzZWdtZW50Lmxlbmd0aCA9PT0gNSA/IHJvb3ROYW1lc1tzZWdtZW50WzRdXSA6ICcnKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRyYWNlZClcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgLy8gU28gd2UgdHJhY2VkIGEgc2VnbWVudCBkb3duIGludG8gaXRzIG9yaWdpbmFsIHNvdXJjZSBmaWxlLiBOb3cgcHVzaCBhXG4gICAgICAgICAgICAgICAgLy8gbmV3IHNlZ21lbnQgcG9pbnRpbmcgdG8gdGhpcyBsb2NhdGlvbi5cbiAgICAgICAgICAgICAgICBjb25zdCB7IGNvbHVtbiwgbGluZSwgbmFtZSB9ID0gdHJhY2VkO1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgY29udGVudCwgZmlsZW5hbWUgfSA9IHRyYWNlZC5zb3VyY2U7XG4gICAgICAgICAgICAgICAgLy8gU3RvcmUgdGhlIHNvdXJjZSBsb2NhdGlvbiwgYW5kIGVuc3VyZSB3ZSBrZWVwIHNvdXJjZXNDb250ZW50IHVwIHRvXG4gICAgICAgICAgICAgICAgLy8gZGF0ZSB3aXRoIHRoZSBzb3VyY2VzIGFycmF5LlxuICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUluZGV4ID0gc291cmNlcy5wdXQoZmlsZW5hbWUpO1xuICAgICAgICAgICAgICAgIHNvdXJjZXNDb250ZW50W3NvdXJjZUluZGV4XSA9IGNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBsb29rcyBsaWtlIHVubmVjZXNzYXJ5IGR1cGxpY2F0aW9uLCBidXQgaXQgbm90aWNlYWJseSBpbmNyZWFzZXNcbiAgICAgICAgICAgICAgICAvLyBwZXJmb3JtYW5jZS4gSWYgd2Ugd2VyZSB0byBwdXNoIHRoZSBuYW1lSW5kZXggb250byBsZW5ndGgtNCBhcnJheSwgdjhcbiAgICAgICAgICAgICAgICAvLyB3b3VsZCBpbnRlcm5hbGx5IGFsbG9jYXRlIDIyIHNsb3RzISBUaGF0J3MgNjggd2FzdGVkIGJ5dGVzISBBcnJheVxuICAgICAgICAgICAgICAgIC8vIGxpdGVyYWxzIGhhdmUgdGhlIHNhbWUgY2FwYWNpdHkgYXMgdGhlaXIgbGVuZ3RoLCBzYXZpbmcgbWVtb3J5LlxuICAgICAgICAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyYWNlZFNlZ21lbnRzLnB1c2goW3NlZ21lbnRbMF0sIHNvdXJjZUluZGV4LCBsaW5lLCBjb2x1bW4sIG5hbWVzLnB1dChuYW1lKV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdHJhY2VkU2VnbWVudHMucHVzaChbc2VnbWVudFswXSwgc291cmNlSW5kZXgsIGxpbmUsIGNvbHVtbl0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1hcHBpbmdzLnB1c2godHJhY2VkU2VnbWVudHMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRPRE86IE1ha2UgYWxsIHNvdXJjZXMgcmVsYXRpdmUgdG8gdGhlIHNvdXJjZVJvb3QuXG4gICAgICAgIHJldHVybiBkZWZhdWx0cyh7XG4gICAgICAgICAgICBtYXBwaW5ncyxcbiAgICAgICAgICAgIG5hbWVzOiBuYW1lcy5hcnJheSxcbiAgICAgICAgICAgIHNvdXJjZXM6IHNvdXJjZXMuYXJyYXksXG4gICAgICAgICAgICBzb3VyY2VzQ29udGVudCxcbiAgICAgICAgfSwgdGhpcy5tYXApO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB0cmFjZVNlZ21lbnQgaXMgb25seSBjYWxsZWQgb24gY2hpbGRyZW4gU291cmNlTWFwVHJlZXMuIEl0IHJlY3Vyc2VzIGRvd25cbiAgICAgKiBpbnRvIGl0cyBvd24gY2hpbGQgU291cmNlTWFwVHJlZXMsIHVudGlsIHdlIGZpbmQgdGhlIG9yaWdpbmFsIHNvdXJjZSBtYXAuXG4gICAgICovXG4gICAgdHJhY2VTZWdtZW50KGxpbmUsIGNvbHVtbiwgbmFtZSkge1xuICAgICAgICBjb25zdCB7IG1hcHBpbmdzLCBuYW1lcyB9ID0gdGhpcy5tYXA7XG4gICAgICAgIC8vIEl0J3MgY29tbW9uIGZvciBwYXJlbnQgc291cmNlbWFwcyB0byBoYXZlIHBvaW50ZXJzIHRvIGxpbmVzIHRoYXQgaGF2ZSBub1xuICAgICAgICAvLyBtYXBwaW5nIChsaWtlIGEgXCIvLyMgc291cmNlTWFwcGluZ1VSTD1cIikgYXQgdGhlIGVuZCBvZiB0aGUgY2hpbGQgZmlsZS5cbiAgICAgICAgaWYgKGxpbmUgPj0gbWFwcGluZ3MubGVuZ3RoKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGNvbnN0IHNlZ21lbnRzID0gbWFwcGluZ3NbbGluZV07XG4gICAgICAgIGlmIChzZWdtZW50cy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgbGV0IGluZGV4ID0gYmluYXJ5U2VhcmNoKHNlZ21lbnRzLCBjb2x1bW4sIHNlZ21lbnRDb21wYXJhdG9yJDEpO1xuICAgICAgICBpZiAoaW5kZXggPT09IC0xKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7IC8vIHdlIGNvbWUgYmVmb3JlIGFueSBtYXBwZWQgc2VnbWVudFxuICAgICAgICAvLyBJZiB3ZSBjYW4ndCBmaW5kIGEgc2VnbWVudCB0aGF0IGxpbmVzIHVwIHRvIHRoaXMgY29sdW1uLCB3ZSB1c2UgdGhlXG4gICAgICAgIC8vIHNlZ21lbnQgYmVmb3JlLlxuICAgICAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICAgICAgICBpbmRleCA9IH5pbmRleCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VnbWVudCA9IHNlZ21lbnRzW2luZGV4XTtcbiAgICAgICAgLy8gMS1sZW5ndGggc2VnbWVudHMgb25seSBtb3ZlIHRoZSBjdXJyZW50IGdlbmVyYXRlZCBjb2x1bW4sIHRoZXJlJ3Mgbm9cbiAgICAgICAgLy8gc291cmNlIGluZm9ybWF0aW9uIHRvIGdhdGhlciBmcm9tIGl0LlxuICAgICAgICBpZiAoc2VnbWVudC5sZW5ndGggPT09IDEpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgY29uc3Qgc291cmNlID0gdGhpcy5zb3VyY2VzW3NlZ21lbnRbMV1dO1xuICAgICAgICAvLyBTbyBub3cgd2UgY2FuIHJlY3Vyc2UgZG93biwgdW50aWwgd2UgaGl0IHRoZSBvcmlnaW5hbCBzb3VyY2UgZmlsZS5cbiAgICAgICAgcmV0dXJuIHNvdXJjZS50cmFjZVNlZ21lbnQoc2VnbWVudFsyXSwgc2VnbWVudFszXSwgXG4gICAgICAgIC8vIEEgY2hpbGQgbWFwJ3MgcmVjb3JkZWQgbmFtZSBmb3IgdGhpcyBzZWdtZW50IHRha2VzIHByZWNlZGVuY2Ugb3ZlciB0aGVcbiAgICAgICAgLy8gcGFyZW50J3MgbWFwcGVkIG5hbWUuIEltYWdpbmUgYSBtYW5nbGVyIGNoYW5naW5nIHRoZSBuYW1lIG92ZXIsIGV0Yy5cbiAgICAgICAgc2VnbWVudC5sZW5ndGggPT09IDUgPyBuYW1lc1tzZWdtZW50WzRdXSA6IG5hbWUpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNlZ21lbnRDb21wYXJhdG9yJDEoc2VnbWVudCwgY29sdW1uKSB7XG4gICAgcmV0dXJuIHNlZ21lbnRbMF0gLSBjb2x1bW47XG59XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTkgVGhlIEFNUCBIVE1MIEF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZW1vdmVzIHRoZSBmaWxlbmFtZSBmcm9tIGEgcGF0aC5cbiAqL1xuZnVuY3Rpb24gc3RyaXBGaWxlbmFtZShwYXRoKSB7XG4gICAgaWYgKCFwYXRoKVxuICAgICAgICByZXR1cm4gJyc7XG4gICAgY29uc3QgaW5kZXggPSBwYXRoLmxhc3RJbmRleE9mKCcvJyk7XG4gICAgcmV0dXJuIHBhdGguc2xpY2UoMCwgaW5kZXggKyAxKTtcbn1cblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAxOSBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgcmV0dXJuIFt2YWx1ZV07XG59XG4vKipcbiAqIFJlY3Vyc2l2ZWx5IGJ1aWxkcyBhIHRyZWUgc3RydWN0dXJlIG91dCBvZiBzb3VyY2VtYXAgZmlsZXMsIHdpdGggZWFjaCBub2RlXG4gKiBiZWluZyBlaXRoZXIgYW4gYE9yaWdpbmFsU291cmNlYCBcImxlYWZcIiBvciBhIGBTb3VyY2VNYXBUcmVlYCBjb21wb3NlZCBvZlxuICogYE9yaWdpbmFsU291cmNlYHMgYW5kIGBTb3VyY2VNYXBUcmVlYHMuXG4gKlxuICogRXZlcnkgc291cmNlbWFwIGlzIGNvbXBvc2VkIG9mIGEgY29sbGVjdGlvbiBvZiBzb3VyY2UgZmlsZXMgYW5kIG1hcHBpbmdzXG4gKiBpbnRvIGxvY2F0aW9ucyBvZiB0aG9zZSBzb3VyY2UgZmlsZXMuIFdoZW4gd2UgZ2VuZXJhdGUgYSBgU291cmNlTWFwVHJlZWAgZm9yXG4gKiB0aGUgc291cmNlbWFwLCB3ZSBhdHRlbXB0IHRvIGxvYWQgZWFjaCBzb3VyY2UgZmlsZSdzIG93biBzb3VyY2VtYXAuIElmIGl0XG4gKiBkb2VzIG5vdCBoYXZlIGFuIGFzc29jaWF0ZWQgc291cmNlbWFwLCBpdCBpcyBjb25zaWRlcmVkIGFuIG9yaWdpbmFsLFxuICogdW5tb2RpZmllZCBzb3VyY2UgZmlsZS5cbiAqL1xuZnVuY3Rpb24gYnVpbGRTb3VyY2VNYXBUcmVlKGlucHV0LCBsb2FkZXIsIHJlbGF0aXZlUm9vdCkge1xuICAgIGNvbnN0IG1hcHMgPSBhc0FycmF5KGlucHV0KS5tYXAoZGVjb2RlU291cmNlTWFwKTtcbiAgICBjb25zdCBtYXAgPSBtYXBzLnBvcCgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWFwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAobWFwc1tpXS5zb3VyY2VzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUcmFuc2Zvcm1hdGlvbiBtYXAgJHtpfSBtdXN0IGhhdmUgZXhhY3RseSBvbmUgc291cmNlIGZpbGUuXFxuYCArXG4gICAgICAgICAgICAgICAgJ0RpZCB5b3Ugc3BlY2lmeSB0aGVzZSB3aXRoIHRoZSBtb3N0IHJlY2VudCB0cmFuc2Zvcm1hdGlvbiBtYXBzIGZpcnN0PycpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHsgc291cmNlUm9vdCwgc291cmNlcywgc291cmNlc0NvbnRlbnQgfSA9IG1hcDtcbiAgICBjb25zdCBjaGlsZHJlbiA9IHNvdXJjZXMubWFwKChzb3VyY2VGaWxlLCBpKSA9PiB7XG4gICAgICAgIC8vIEVhY2ggc291cmNlIGZpbGUgaXMgbG9hZGVkIHJlbGF0aXZlIHRvIHRoZSBzb3VyY2VtYXAncyBvd24gc291cmNlUm9vdCxcbiAgICAgICAgLy8gd2hpY2ggaXMgaXRzZWxmIHJlbGF0aXZlIHRvIHRoZSBzb3VyY2VtYXAncyBwYXJlbnQuXG4gICAgICAgIGNvbnN0IHVyaSA9IHJlc29sdmUkMShzb3VyY2VGaWxlIHx8ICcnLCByZXNvbHZlJDEoc291cmNlUm9vdCB8fCAnJywgc3RyaXBGaWxlbmFtZShyZWxhdGl2ZVJvb3QpKSk7XG4gICAgICAgIC8vIFVzZSB0aGUgcHJvdmlkZWQgbG9hZGVyIGNhbGxiYWNrIHRvIHJldHJpZXZlIHRoZSBmaWxlJ3Mgc291cmNlbWFwLlxuICAgICAgICAvLyBUT0RPOiBXZSBzaG91bGQgZXZlbnR1YWxseSBzdXBwb3J0IGFzeW5jIGxvYWRpbmcgb2Ygc291cmNlbWFwIGZpbGVzLlxuICAgICAgICBjb25zdCBzb3VyY2VNYXAgPSBsb2FkZXIodXJpKTtcbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gc291cmNlbWFwLCB0aGVuIGl0IGlzIGFuIHVubW9kaWZpZWQgc291cmNlIGZpbGUuXG4gICAgICAgIGlmICghc291cmNlTWFwKSB7XG4gICAgICAgICAgICAvLyBUaGUgc291cmNlIGZpbGUncyBhY3R1YWwgY29udGVudHMgbXVzdCBiZSBpbmNsdWRlZCBpbiB0aGUgc291cmNlbWFwXG4gICAgICAgICAgICAvLyAoZG9uZSB3aGVuIGdlbmVyYXRpbmcgdGhlIHNvdXJjZW1hcCkgZm9yIGl0IHRvIGJlIGluY2x1ZGVkIGFzIGFcbiAgICAgICAgICAgIC8vIHNvdXJjZUNvbnRlbnQgaW4gdGhlIG91dHB1dCBzb3VyY2VtYXAuXG4gICAgICAgICAgICBjb25zdCBzb3VyY2VDb250ZW50ID0gc291cmNlc0NvbnRlbnQgPyBzb3VyY2VzQ29udGVudFtpXSA6IG51bGw7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE9yaWdpbmFsU291cmNlKHVyaSwgc291cmNlQ29udGVudCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRWxzZSwgaXQncyBhIHJlYWwgc291cmNlbWFwLCBhbmQgd2UgbmVlZCB0byByZWN1cnNlIGludG8gaXQgdG8gbG9hZCBpdHNcbiAgICAgICAgLy8gc291cmNlIGZpbGVzLlxuICAgICAgICByZXR1cm4gYnVpbGRTb3VyY2VNYXBUcmVlKGRlY29kZVNvdXJjZU1hcChzb3VyY2VNYXApLCBsb2FkZXIsIHVyaSk7XG4gICAgfSk7XG4gICAgbGV0IHRyZWUgPSBuZXcgU291cmNlTWFwVHJlZShtYXAsIGNoaWxkcmVuKTtcbiAgICBmb3IgKGxldCBpID0gbWFwcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICB0cmVlID0gbmV3IFNvdXJjZU1hcFRyZWUobWFwc1tpXSwgW3RyZWVdKTtcbiAgICB9XG4gICAgcmV0dXJuIHRyZWU7XG59XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTkgVGhlIEFNUCBIVE1MIEF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIFNvdXJjZU1hcCB2MyBjb21wYXRpYmxlIHNvdXJjZW1hcCwgd2hpY2ggb25seSBpbmNsdWRlcyBmaWVsZHMgdGhhdCB3ZXJlXG4gKiBwcm92aWRlZCB0byBpdC5cbiAqL1xuY2xhc3MgU291cmNlTWFwIHtcbiAgICBjb25zdHJ1Y3RvcihtYXAsIGV4Y2x1ZGVDb250ZW50KSB7XG4gICAgICAgIHRoaXMudmVyc2lvbiA9IDM7IC8vIFNvdXJjZU1hcCBzcGVjIHNheXMgdGhpcyBzaG91bGQgYmUgZmlyc3QuXG4gICAgICAgIGlmICgnZmlsZScgaW4gbWFwKVxuICAgICAgICAgICAgdGhpcy5maWxlID0gbWFwLmZpbGU7XG4gICAgICAgIHRoaXMubWFwcGluZ3MgPSBlbmNvZGUkMShtYXAubWFwcGluZ3MpO1xuICAgICAgICB0aGlzLm5hbWVzID0gbWFwLm5hbWVzO1xuICAgICAgICAvLyBUT0RPOiBXZSBmaXJzdCBuZWVkIHRvIG1ha2UgYWxsIHNvdXJjZSBVUklzIHJlbGF0aXZlIHRvIHRoZSBzb3VyY2VSb290XG4gICAgICAgIC8vIGJlZm9yZSB3ZSBjYW4gc3VwcG9ydCBhIHNvdXJjZVJvb3QuXG4gICAgICAgIC8vIGlmICgnc291cmNlUm9vdCcgaW4gbWFwKSB0aGlzLnNvdXJjZVJvb3QgPSBtYXAuc291cmNlUm9vdDtcbiAgICAgICAgdGhpcy5zb3VyY2VzID0gbWFwLnNvdXJjZXM7XG4gICAgICAgIGlmICghZXhjbHVkZUNvbnRlbnQgJiYgJ3NvdXJjZXNDb250ZW50JyBpbiBtYXApXG4gICAgICAgICAgICB0aGlzLnNvdXJjZXNDb250ZW50ID0gbWFwLnNvdXJjZXNDb250ZW50O1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAxOSBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRyYWNlcyB0aHJvdWdoIGFsbCB0aGUgbWFwcGluZ3MgaW4gdGhlIHJvb3Qgc291cmNlbWFwLCB0aHJvdWdoIHRoZSBzb3VyY2VzXG4gKiAoYW5kIHRoZWlyIHNvdXJjZW1hcHMpLCBhbGwgdGhlIHdheSBiYWNrIHRvIHRoZSBvcmlnaW5hbCBzb3VyY2UgbG9jYXRpb24uXG4gKlxuICogYGxvYWRlcmAgd2lsbCBiZSBjYWxsZWQgZXZlcnkgdGltZSB3ZSBlbmNvdW50ZXIgYSBzb3VyY2UgZmlsZS4gSWYgaXQgcmV0dXJuc1xuICogYSBzb3VyY2VtYXAsIHdlIHdpbGwgcmVjdXJzZSBpbnRvIHRoYXQgc291cmNlbWFwIHRvIGNvbnRpbnVlIHRoZSB0cmFjZS4gSWZcbiAqIGl0IHJldHVybnMgYSBmYWxzZXkgdmFsdWUsIHRoYXQgc291cmNlIGZpbGUgaXMgdHJlYXRlZCBhcyBhbiBvcmlnaW5hbCxcbiAqIHVubW9kaWZpZWQgc291cmNlIGZpbGUuXG4gKlxuICogUGFzcyBgZXhjbHVkZUNvbnRlbnRgIGNvbnRlbnQgdG8gZXhjbHVkZSBhbnkgc2VsZi1jb250YWluaW5nIHNvdXJjZSBmaWxlXG4gKiBjb250ZW50IGZyb20gdGhlIG91dHB1dCBzb3VyY2VtYXAuXG4gKi9cbmZ1bmN0aW9uIHJlbWFwcGluZyhpbnB1dCwgbG9hZGVyLCBleGNsdWRlQ29udGVudCkge1xuICAgIGNvbnN0IGdyYXBoID0gYnVpbGRTb3VyY2VNYXBUcmVlKGlucHV0LCBsb2FkZXIpO1xuICAgIHJldHVybiBuZXcgU291cmNlTWFwKGdyYXBoLnRyYWNlTWFwcGluZ3MoKSwgISFleGNsdWRlQ29udGVudCk7XG59XG5cbmZ1bmN0aW9uIGxhc3RfbGluZV9sZW5ndGgocykge1xuICAgIHJldHVybiBzLmxlbmd0aCAtIHMubGFzdEluZGV4T2YoJ1xcbicpIC0gMTtcbn1cbi8vIG11dGF0ZSBtYXAgaW4tcGxhY2VcbmZ1bmN0aW9uIHNvdXJjZW1hcF9hZGRfb2Zmc2V0KG1hcCwgb2Zmc2V0LCBzb3VyY2VfaW5kZXgpIHtcbiAgICBpZiAobWFwLm1hcHBpbmdzLmxlbmd0aCA9PSAwKVxuICAgICAgICByZXR1cm47XG4gICAgZm9yIChsZXQgbGluZSA9IDA7IGxpbmUgPCBtYXAubWFwcGluZ3MubGVuZ3RoOyBsaW5lKyspIHtcbiAgICAgICAgY29uc3Qgc2VnbWVudF9saXN0ID0gbWFwLm1hcHBpbmdzW2xpbmVdO1xuICAgICAgICBmb3IgKGxldCBzZWdtZW50ID0gMDsgc2VnbWVudCA8IHNlZ21lbnRfbGlzdC5sZW5ndGg7IHNlZ21lbnQrKykge1xuICAgICAgICAgICAgY29uc3Qgc2VnID0gc2VnbWVudF9saXN0W3NlZ21lbnRdO1xuICAgICAgICAgICAgLy8gc2hpZnQgb25seSBzZWdtZW50cyB0aGF0IGJlbG9uZyB0byBjb21wb25lbnQgc291cmNlIGZpbGVcbiAgICAgICAgICAgIGlmIChzZWdbMV0gPT09IHNvdXJjZV9pbmRleCkgeyAvLyBhbHNvIGVuc3VyZXMgdGhhdCBzZWcubGVuZ3RoID49IDRcbiAgICAgICAgICAgICAgICAvLyBzaGlmdCBjb2x1bW4gaWYgaXQgcG9pbnRzIGF0IHRoZSBmaXJzdCBsaW5lXG4gICAgICAgICAgICAgICAgaWYgKHNlZ1syXSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzZWdbM10gKz0gb2Zmc2V0LmNvbHVtbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gc2hpZnQgbGluZVxuICAgICAgICAgICAgICAgIHNlZ1syXSArPSBvZmZzZXQubGluZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIG1lcmdlX3RhYmxlcyh0aGlzX3RhYmxlLCBvdGhlcl90YWJsZSkge1xuICAgIGNvbnN0IG5ld190YWJsZSA9IHRoaXNfdGFibGUuc2xpY2UoKTtcbiAgICBjb25zdCBpZHhfbWFwID0gW107XG4gICAgb3RoZXJfdGFibGUgPSBvdGhlcl90YWJsZSB8fCBbXTtcbiAgICBsZXQgdmFsX2NoYW5nZWQgPSBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IFtvdGhlcl9pZHgsIG90aGVyX3ZhbF0gb2Ygb3RoZXJfdGFibGUuZW50cmllcygpKSB7XG4gICAgICAgIGNvbnN0IHRoaXNfaWR4ID0gdGhpc190YWJsZS5pbmRleE9mKG90aGVyX3ZhbCk7XG4gICAgICAgIGlmICh0aGlzX2lkeCA+PSAwKSB7XG4gICAgICAgICAgICBpZHhfbWFwW290aGVyX2lkeF0gPSB0aGlzX2lkeDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld19pZHggPSBuZXdfdGFibGUubGVuZ3RoO1xuICAgICAgICAgICAgbmV3X3RhYmxlW25ld19pZHhdID0gb3RoZXJfdmFsO1xuICAgICAgICAgICAgaWR4X21hcFtvdGhlcl9pZHhdID0gbmV3X2lkeDtcbiAgICAgICAgICAgIHZhbF9jaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBsZXQgaWR4X2NoYW5nZWQgPSB2YWxfY2hhbmdlZDtcbiAgICBpZiAodmFsX2NoYW5nZWQpIHtcbiAgICAgICAgaWYgKGlkeF9tYXAuZmluZCgodmFsLCBpZHgpID0+IHZhbCAhPSBpZHgpID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vIGlkeF9tYXAgaXMgaWRlbnRpdHkgbWFwIFswLCAxLCAyLCAzLCA0LCAuLi4uXVxuICAgICAgICAgICAgaWR4X2NoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gW25ld190YWJsZSwgaWR4X21hcCwgdmFsX2NoYW5nZWQsIGlkeF9jaGFuZ2VkXTtcbn1cbmZ1bmN0aW9uIHB1c2hBcnJheShfdGhpcywgb3RoZXIpIHtcbiAgICAvLyBXZSB1c2UgcHVzaCB0byBtdXRhdGUgaW4gcGxhY2UgZm9yIG1lbW9yeSBhbmQgcGVyZiByZWFzb25zXG4gICAgLy8gV2UgdXNlIHRoZSBmb3IgbG9vcCBpbnN0ZWFkIG9mIF90aGlzLnB1c2goLi4ub3RoZXIpIHRvIGF2b2lkIHRoZSBKUyBlbmdpbmUncyBmdW5jdGlvbiBhcmd1bWVudCBsaW1pdCAoNjUsNTM1IGluIEphdmFzY3JpcHRDb3JlKVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3RoZXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgX3RoaXMucHVzaChvdGhlcltpXSk7XG4gICAgfVxufVxuY2xhc3MgTWFwcGVkQ29kZSB7XG4gICAgY29uc3RydWN0b3Ioc3RyaW5nID0gJycsIG1hcCA9IG51bGwpIHtcbiAgICAgICAgdGhpcy5zdHJpbmcgPSBzdHJpbmc7XG4gICAgICAgIGlmIChtYXApIHtcbiAgICAgICAgICAgIHRoaXMubWFwID0gbWFwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tYXAgPSB7XG4gICAgICAgICAgICAgICAgdmVyc2lvbjogMyxcbiAgICAgICAgICAgICAgICBtYXBwaW5nczogW10sXG4gICAgICAgICAgICAgICAgc291cmNlczogW10sXG4gICAgICAgICAgICAgICAgbmFtZXM6IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGNvbmNhdCBpbi1wbGFjZSAobXV0YWJsZSksIHJldHVybiB0aGlzIChjaGFpbmFibGUpXG4gICAgICogd2lsbCBhbHNvIG11dGF0ZSB0aGUgYG90aGVyYCBvYmplY3RcbiAgICAgKi9cbiAgICBjb25jYXQob3RoZXIpIHtcbiAgICAgICAgLy8gbm9vcDogaWYgb25lIGlzIGVtcHR5LCByZXR1cm4gdGhlIG90aGVyXG4gICAgICAgIGlmIChvdGhlci5zdHJpbmcgPT0gJycpXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgaWYgKHRoaXMuc3RyaW5nID09ICcnKSB7XG4gICAgICAgICAgICB0aGlzLnN0cmluZyA9IG90aGVyLnN0cmluZztcbiAgICAgICAgICAgIHRoaXMubWFwID0gb3RoZXIubWFwO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY29tcHV0ZSBsYXN0IGxpbmUgbGVuZ3RoIGJlZm9yZSBtdXRhdGluZ1xuICAgICAgICBjb25zdCBjb2x1bW5fb2Zmc2V0ID0gbGFzdF9saW5lX2xlbmd0aCh0aGlzLnN0cmluZyk7XG4gICAgICAgIHRoaXMuc3RyaW5nICs9IG90aGVyLnN0cmluZztcbiAgICAgICAgY29uc3QgbTEgPSB0aGlzLm1hcDtcbiAgICAgICAgY29uc3QgbTIgPSBvdGhlci5tYXA7XG4gICAgICAgIGlmIChtMi5tYXBwaW5ncy5sZW5ndGggPT0gMClcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAvLyBjb21iaW5lIHNvdXJjZXMgYW5kIG5hbWVzXG4gICAgICAgIGNvbnN0IFtzb3VyY2VzLCBuZXdfc291cmNlX2lkeCwgc291cmNlc19jaGFuZ2VkLCBzb3VyY2VzX2lkeF9jaGFuZ2VkXSA9IG1lcmdlX3RhYmxlcyhtMS5zb3VyY2VzLCBtMi5zb3VyY2VzKTtcbiAgICAgICAgY29uc3QgW25hbWVzLCBuZXdfbmFtZV9pZHgsIG5hbWVzX2NoYW5nZWQsIG5hbWVzX2lkeF9jaGFuZ2VkXSA9IG1lcmdlX3RhYmxlcyhtMS5uYW1lcywgbTIubmFtZXMpO1xuICAgICAgICBpZiAoc291cmNlc19jaGFuZ2VkKVxuICAgICAgICAgICAgbTEuc291cmNlcyA9IHNvdXJjZXM7XG4gICAgICAgIGlmIChuYW1lc19jaGFuZ2VkKVxuICAgICAgICAgICAgbTEubmFtZXMgPSBuYW1lcztcbiAgICAgICAgLy8gdW5zd2l0Y2hlZCBsb29wcyBhcmUgZmFzdGVyXG4gICAgICAgIGlmIChzb3VyY2VzX2lkeF9jaGFuZ2VkICYmIG5hbWVzX2lkeF9jaGFuZ2VkKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBsaW5lID0gMDsgbGluZSA8IG0yLm1hcHBpbmdzLmxlbmd0aDsgbGluZSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VnbWVudF9saXN0ID0gbTIubWFwcGluZ3NbbGluZV07XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgc2VnbWVudCA9IDA7IHNlZ21lbnQgPCBzZWdtZW50X2xpc3QubGVuZ3RoOyBzZWdtZW50KyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VnID0gc2VnbWVudF9saXN0W3NlZ21lbnRdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VnWzFdID49IDApXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWdbMV0gPSBuZXdfc291cmNlX2lkeFtzZWdbMV1dO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VnWzRdID49IDApXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWdbNF0gPSBuZXdfbmFtZV9pZHhbc2VnWzRdXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc291cmNlc19pZHhfY2hhbmdlZCkge1xuICAgICAgICAgICAgZm9yIChsZXQgbGluZSA9IDA7IGxpbmUgPCBtMi5tYXBwaW5ncy5sZW5ndGg7IGxpbmUrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlZ21lbnRfbGlzdCA9IG0yLm1hcHBpbmdzW2xpbmVdO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IHNlZ21lbnQgPSAwOyBzZWdtZW50IDwgc2VnbWVudF9saXN0Lmxlbmd0aDsgc2VnbWVudCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlZyA9IHNlZ21lbnRfbGlzdFtzZWdtZW50XTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlZ1sxXSA+PSAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VnWzFdID0gbmV3X3NvdXJjZV9pZHhbc2VnWzFdXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobmFtZXNfaWR4X2NoYW5nZWQpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGxpbmUgPSAwOyBsaW5lIDwgbTIubWFwcGluZ3MubGVuZ3RoOyBsaW5lKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWdtZW50X2xpc3QgPSBtMi5tYXBwaW5nc1tsaW5lXTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBzZWdtZW50ID0gMDsgc2VnbWVudCA8IHNlZ21lbnRfbGlzdC5sZW5ndGg7IHNlZ21lbnQrKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWcgPSBzZWdtZW50X2xpc3Rbc2VnbWVudF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWdbNF0gPj0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ1s0XSA9IG5ld19uYW1lX2lkeFtzZWdbNF1dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBjb21iaW5lIHRoZSBtYXBwaW5nc1xuICAgICAgICAvLyBjb21iaW5lXG4gICAgICAgIC8vIDEuIGxhc3QgbGluZSBvZiBmaXJzdCBtYXBcbiAgICAgICAgLy8gMi4gZmlyc3QgbGluZSBvZiBzZWNvbmQgbWFwXG4gICAgICAgIC8vIGNvbHVtbnMgb2YgMiBtdXN0IGJlIHNoaWZ0ZWRcbiAgICAgICAgaWYgKG0yLm1hcHBpbmdzLmxlbmd0aCA+IDAgJiYgY29sdW1uX29mZnNldCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0X2xpbmUgPSBtMi5tYXBwaW5nc1swXTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlyc3RfbGluZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGZpcnN0X2xpbmVbaV1bMF0gKz0gY29sdW1uX29mZnNldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBjb21iaW5lIGxhc3QgbGluZSArIGZpcnN0IGxpbmVcbiAgICAgICAgcHVzaEFycmF5KG0xLm1hcHBpbmdzW20xLm1hcHBpbmdzLmxlbmd0aCAtIDFdLCBtMi5tYXBwaW5ncy5zaGlmdCgpKTtcbiAgICAgICAgLy8gYXBwZW5kIG90aGVyIGxpbmVzXG4gICAgICAgIHB1c2hBcnJheShtMS5tYXBwaW5ncywgbTIubWFwcGluZ3MpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgc3RhdGljIGZyb21fcHJvY2Vzc2VkKHN0cmluZywgbWFwKSB7XG4gICAgICAgIGNvbnN0IGxpbmVfY291bnQgPSBzdHJpbmcuc3BsaXQoJ1xcbicpLmxlbmd0aDtcbiAgICAgICAgaWYgKG1hcCkge1xuICAgICAgICAgICAgLy8gZW5zdXJlIHRoYXQgY291bnQgb2Ygc291cmNlIG1hcCBtYXBwaW5ncyBsaW5lc1xuICAgICAgICAgICAgLy8gaXMgZXF1YWwgdG8gY291bnQgb2YgZ2VuZXJhdGVkIGNvZGUgbGluZXNcbiAgICAgICAgICAgIC8vIChzb21lIHRvb2xzIG1heSBwcm9kdWNlIGxlc3MpXG4gICAgICAgICAgICBjb25zdCBtaXNzaW5nX2xpbmVzID0gbGluZV9jb3VudCAtIG1hcC5tYXBwaW5ncy5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1pc3NpbmdfbGluZXM7IGkrKykge1xuICAgICAgICAgICAgICAgIG1hcC5tYXBwaW5ncy5wdXNoKFtdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgTWFwcGVkQ29kZShzdHJpbmcsIG1hcCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0cmluZyA9PSAnJylcbiAgICAgICAgICAgIHJldHVybiBuZXcgTWFwcGVkQ29kZSgpO1xuICAgICAgICBtYXAgPSB7IHZlcnNpb246IDMsIG5hbWVzOiBbXSwgc291cmNlczogW10sIG1hcHBpbmdzOiBbXSB9O1xuICAgICAgICAvLyBhZGQgZW1wdHkgU291cmNlTWFwU2VnbWVudFtdIGZvciBldmVyeSBsaW5lXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZV9jb3VudDsgaSsrKVxuICAgICAgICAgICAgbWFwLm1hcHBpbmdzLnB1c2goW10pO1xuICAgICAgICByZXR1cm4gbmV3IE1hcHBlZENvZGUoc3RyaW5nLCBtYXApO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbV9zb3VyY2UoeyBzb3VyY2UsIGZpbGVfYmFzZW5hbWUsIGdldF9sb2NhdGlvbiB9KSB7XG4gICAgICAgIGxldCBvZmZzZXQgPSBnZXRfbG9jYXRpb24oMCk7XG4gICAgICAgIGlmICghb2Zmc2V0KVxuICAgICAgICAgICAgb2Zmc2V0ID0geyBsaW5lOiAwLCBjb2x1bW46IDAgfTtcbiAgICAgICAgY29uc3QgbWFwID0geyB2ZXJzaW9uOiAzLCBuYW1lczogW10sIHNvdXJjZXM6IFtmaWxlX2Jhc2VuYW1lXSwgbWFwcGluZ3M6IFtdIH07XG4gICAgICAgIGlmIChzb3VyY2UgPT0gJycpXG4gICAgICAgICAgICByZXR1cm4gbmV3IE1hcHBlZENvZGUoc291cmNlLCBtYXApO1xuICAgICAgICAvLyB3ZSBjcmVhdGUgYSBoaWdoIHJlc29sdXRpb24gaWRlbnRpdHkgbWFwIGhlcmUsXG4gICAgICAgIC8vIHdlIGtub3cgdGhhdCBpdCB3aWxsIGV2ZW50dWFsbHkgYmUgbWVyZ2VkIHdpdGggc3ZlbHRlJ3MgbWFwLFxuICAgICAgICAvLyBhdCB3aGljaCBzdGFnZSB0aGUgcmVzb2x1dGlvbiB3aWxsIGRlY3JlYXNlLlxuICAgICAgICBjb25zdCBsaW5lX2xpc3QgPSBzb3VyY2Uuc3BsaXQoJ1xcbicpO1xuICAgICAgICBmb3IgKGxldCBsaW5lID0gMDsgbGluZSA8IGxpbmVfbGlzdC5sZW5ndGg7IGxpbmUrKykge1xuICAgICAgICAgICAgbWFwLm1hcHBpbmdzLnB1c2goW10pO1xuICAgICAgICAgICAgY29uc3QgdG9rZW5fbGlzdCA9IGxpbmVfbGlzdFtsaW5lXS5zcGxpdCgvKFteXFxkXFx3XFxzXXxcXHMrKS9nKTtcbiAgICAgICAgICAgIGZvciAobGV0IHRva2VuID0gMCwgY29sdW1uID0gMDsgdG9rZW4gPCB0b2tlbl9saXN0Lmxlbmd0aDsgdG9rZW4rKykge1xuICAgICAgICAgICAgICAgIGlmICh0b2tlbl9saXN0W3Rva2VuXSA9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgbWFwLm1hcHBpbmdzW2xpbmVdLnB1c2goW2NvbHVtbiwgMCwgb2Zmc2V0LmxpbmUgKyBsaW5lLCBjb2x1bW5dKTtcbiAgICAgICAgICAgICAgICBjb2x1bW4gKz0gdG9rZW5fbGlzdFt0b2tlbl0ubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHNoaWZ0IGNvbHVtbnMgaW4gZmlyc3QgbGluZVxuICAgICAgICBjb25zdCBzZWdtZW50X2xpc3QgPSBtYXAubWFwcGluZ3NbMF07XG4gICAgICAgIGZvciAobGV0IHNlZ21lbnQgPSAwOyBzZWdtZW50IDwgc2VnbWVudF9saXN0Lmxlbmd0aDsgc2VnbWVudCsrKSB7XG4gICAgICAgICAgICBzZWdtZW50X2xpc3Rbc2VnbWVudF1bM10gKz0gb2Zmc2V0LmNvbHVtbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IE1hcHBlZENvZGUoc291cmNlLCBtYXApO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGNvbWJpbmVfc291cmNlbWFwcyhmaWxlbmFtZSwgc291cmNlbWFwX2xpc3QpIHtcbiAgICBpZiAoc291cmNlbWFwX2xpc3QubGVuZ3RoID09IDApXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIGxldCBtYXBfaWR4ID0gMTtcbiAgICBjb25zdCBtYXAgPSBzb3VyY2VtYXBfbGlzdC5zbGljZSgwLCAtMSlcbiAgICAgICAgLmZpbmQobSA9PiBtLnNvdXJjZXMubGVuZ3RoICE9PSAxKSA9PT0gdW5kZWZpbmVkXG4gICAgICAgID8gcmVtYXBwaW5nKC8vIHVzZSBhcnJheSBpbnRlcmZhY2VcbiAgICAgICAgLy8gb25seSB0aGUgb2xkZXN0IHNvdXJjZW1hcCBjYW4gaGF2ZSBtdWx0aXBsZSBzb3VyY2VzXG4gICAgICAgIHNvdXJjZW1hcF9saXN0LCAoKSA9PiBudWxsLCB0cnVlIC8vIHNraXAgb3B0aW9uYWwgZmllbGQgYHNvdXJjZXNDb250ZW50YFxuICAgICAgICApXG4gICAgICAgIDogcmVtYXBwaW5nKC8vIHVzZSBsb2FkZXIgaW50ZXJmYWNlXG4gICAgICAgIHNvdXJjZW1hcF9saXN0WzBdLCAvLyBsYXN0IG1hcFxuICAgICAgICBmdW5jdGlvbiBsb2FkZXIoc291cmNlZmlsZSkge1xuICAgICAgICAgICAgaWYgKHNvdXJjZWZpbGUgPT09IGZpbGVuYW1lICYmIHNvdXJjZW1hcF9saXN0W21hcF9pZHhdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZW1hcF9saXN0W21hcF9pZHgrK107IC8vIGlkeCAxLCAyLCAuLi5cbiAgICAgICAgICAgICAgICAvLyBidW5kbGUgZmlsZSA9IGJyYW5jaCBub2RlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsgLy8gc291cmNlIGZpbGUgPSBsZWFmIG5vZGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdHJ1ZSk7XG4gICAgaWYgKCFtYXAuZmlsZSlcbiAgICAgICAgZGVsZXRlIG1hcC5maWxlOyAvLyBza2lwIG9wdGlvbmFsIGZpZWxkIGBmaWxlYFxuICAgIC8vIFdoZW4gc291cmNlIG1hcHMgYXJlIGNvbWJpbmVkIGFuZCB0aGUgbGVhZGluZyBtYXAgaXMgZW1wdHksIHNvdXJjZXMgaXMgbm90IHNldC5cbiAgICAvLyBBZGQgdGhlIGZpbGVuYW1lIHRvIHRoZSBlbXB0eSBhcnJheSBpbiB0aGlzIGNhc2UuIFxuICAgIC8vIEZ1cnRoZXIgaW1wcm92ZW1lbnRzIHRvIHJlbWFwcGluZyBtYXkgaGVscCBhZGRyZXNzIHRoaXMgYXMgd2VsbCBodHRwczovL2dpdGh1Yi5jb20vYW1wcHJvamVjdC9yZW1hcHBpbmcvaXNzdWVzLzExNlxuICAgIGlmICghbWFwLnNvdXJjZXMubGVuZ3RoKVxuICAgICAgICBtYXAuc291cmNlcyA9IFtmaWxlbmFtZV07XG4gICAgcmV0dXJuIG1hcDtcbn1cbi8vIGJyb3dzZXIgdnMgbm9kZS5qc1xuY29uc3QgYjY0ZW5jID0gdHlwZW9mIGJ0b2EgPT0gJ2Z1bmN0aW9uJyA/IGJ0b2EgOiBiID0+IEJ1ZmZlci5mcm9tKGIpLnRvU3RyaW5nKCdiYXNlNjQnKTtcbmNvbnN0IGI2NGRlYyA9IHR5cGVvZiBhdG9iID09ICdmdW5jdGlvbicgPyBhdG9iIDogYSA9PiBCdWZmZXIuZnJvbShhLCAnYmFzZTY0JykudG9TdHJpbmcoKTtcbmZ1bmN0aW9uIGFwcGx5X3ByZXByb2Nlc3Nvcl9zb3VyY2VtYXAoZmlsZW5hbWUsIHN2ZWx0ZV9tYXAsIHByZXByb2Nlc3Nvcl9tYXBfaW5wdXQpIHtcbiAgICBpZiAoIXN2ZWx0ZV9tYXAgfHwgIXByZXByb2Nlc3Nvcl9tYXBfaW5wdXQpXG4gICAgICAgIHJldHVybiBzdmVsdGVfbWFwO1xuICAgIGNvbnN0IHByZXByb2Nlc3Nvcl9tYXAgPSB0eXBlb2YgcHJlcHJvY2Vzc29yX21hcF9pbnB1dCA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKHByZXByb2Nlc3Nvcl9tYXBfaW5wdXQpIDogcHJlcHJvY2Vzc29yX21hcF9pbnB1dDtcbiAgICBjb25zdCByZXN1bHRfbWFwID0gY29tYmluZV9zb3VyY2VtYXBzKGZpbGVuYW1lLCBbXG4gICAgICAgIHN2ZWx0ZV9tYXAsXG4gICAgICAgIHByZXByb2Nlc3Nvcl9tYXBcbiAgICBdKTtcbiAgICAvLyBTdmVsdGUgZXhwZWN0cyBhIFNvdXJjZU1hcCB3aGljaCBpbmNsdWRlcyB0b1VybCBhbmQgdG9TdHJpbmcuIEluc3RlYWQgb2Ygd3JhcHBpbmcgb3VyIG91dHB1dCBpbiBhIGNsYXNzLFxuICAgIC8vIHdlIGp1c3QgdGFjayBvbiB0aGUgZXh0cmEgcHJvcGVydGllcy5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhyZXN1bHRfbWFwLCB7XG4gICAgICAgIHRvU3RyaW5nOiB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHRvVXJsOiB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b1VybCgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2RhdGE6YXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04O2Jhc2U2NCwnICsgYjY0ZW5jKHRoaXMudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0X21hcDtcbn1cbi8vIHBhcnNlIGF0dGFjaGVkIHNvdXJjZW1hcCBpbiBwcm9jZXNzZWQuY29kZVxuZnVuY3Rpb24gcGFyc2VfYXR0YWNoZWRfc291cmNlbWFwKHByb2Nlc3NlZCwgdGFnX25hbWUpIHtcbiAgICBjb25zdCByX2luID0gJ1sjQF1cXFxccypzb3VyY2VNYXBwaW5nVVJMXFxcXHMqPVxcXFxzKihcXFxcUyopJztcbiAgICBjb25zdCByZWdleCA9ICh0YWdfbmFtZSA9PSAnc2NyaXB0JylcbiAgICAgICAgPyBuZXcgUmVnRXhwKCcoPzovLycgKyByX2luICsgJyl8KD86L1xcXFwqJyArIHJfaW4gKyAnXFxcXHMqXFxcXCovKSQnKVxuICAgICAgICA6IG5ldyBSZWdFeHAoJy9cXFxcKicgKyByX2luICsgJ1xcXFxzKlxcXFwqLyQnKTtcbiAgICBmdW5jdGlvbiBsb2dfd2FybmluZyhtZXNzYWdlKSB7XG4gICAgICAgIC8vIGNvZGVfc3RhcnQ6IGhlbHAgdG8gZmluZCBwcmVwcm9jZXNzb3JcbiAgICAgICAgY29uc3QgY29kZV9zdGFydCA9IHByb2Nlc3NlZC5jb2RlLmxlbmd0aCA8IDEwMCA/IHByb2Nlc3NlZC5jb2RlIDogKHByb2Nlc3NlZC5jb2RlLnNsaWNlKDAsIDEwMCkgKyAnIFsuLi5dJyk7XG4gICAgICAgIGNvbnNvbGUud2Fybihgd2FybmluZzogJHttZXNzYWdlfS4gcHJvY2Vzc2VkLmNvZGUgPSAke0pTT04uc3RyaW5naWZ5KGNvZGVfc3RhcnQpfWApO1xuICAgIH1cbiAgICBwcm9jZXNzZWQuY29kZSA9IHByb2Nlc3NlZC5jb2RlLnJlcGxhY2UocmVnZXgsIChfLCBtYXRjaDEsIG1hdGNoMikgPT4ge1xuICAgICAgICBjb25zdCBtYXBfdXJsID0gKHRhZ19uYW1lID09ICdzY3JpcHQnKSA/IChtYXRjaDEgfHwgbWF0Y2gyKSA6IG1hdGNoMTtcbiAgICAgICAgY29uc3QgbWFwX2RhdGEgPSAobWFwX3VybC5tYXRjaCgvZGF0YTooPzphcHBsaWNhdGlvbnx0ZXh0KVxcL2pzb247KD86Y2hhcnNldFs6PV1cXFMrPzspP2Jhc2U2NCwoXFxTKikvKSB8fCBbXSlbMV07XG4gICAgICAgIGlmIChtYXBfZGF0YSkge1xuICAgICAgICAgICAgLy8gc291cmNlTWFwcGluZ1VSTCBpcyBkYXRhIFVSTFxuICAgICAgICAgICAgaWYgKHByb2Nlc3NlZC5tYXApIHtcbiAgICAgICAgICAgICAgICBsb2dfd2FybmluZygnTm90IGltcGxlbWVudGVkLiAnICtcbiAgICAgICAgICAgICAgICAgICAgJ0ZvdW5kIHNvdXJjZW1hcCBpbiBib3RoIHByb2Nlc3NlZC5jb2RlIGFuZCBwcm9jZXNzZWQubWFwLiAnICtcbiAgICAgICAgICAgICAgICAgICAgJ1BsZWFzZSB1cGRhdGUgeW91ciBwcmVwcm9jZXNzb3IgdG8gcmV0dXJuIG9ubHkgb25lIHNvdXJjZW1hcC4nKTtcbiAgICAgICAgICAgICAgICAvLyBpZ25vcmUgYXR0YWNoZWQgc291cmNlbWFwXG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcHJvY2Vzc2VkLm1hcCA9IGI2NGRlYyhtYXBfZGF0YSk7IC8vIHVzZSBhdHRhY2hlZCBzb3VyY2VtYXBcbiAgICAgICAgICAgIHJldHVybiAnJzsgLy8gcmVtb3ZlIGZyb20gcHJvY2Vzc2VkLmNvZGVcbiAgICAgICAgfVxuICAgICAgICAvLyBzb3VyY2VNYXBwaW5nVVJMIGlzIHBhdGggb3IgVVJMXG4gICAgICAgIGlmICghcHJvY2Vzc2VkLm1hcCkge1xuICAgICAgICAgICAgbG9nX3dhcm5pbmcoYEZvdW5kIHNvdXJjZW1hcCBwYXRoICR7SlNPTi5zdHJpbmdpZnkobWFwX3VybCl9IGluIHByb2Nlc3NlZC5jb2RlLCBidXQgbm8gc291cmNlbWFwIGRhdGEuIGAgK1xuICAgICAgICAgICAgICAgICdQbGVhc2UgdXBkYXRlIHlvdXIgcHJlcHJvY2Vzc29yIHRvIHJldHVybiBzb3VyY2VtYXAgZGF0YSBkaXJlY3RseS4nKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZ25vcmUgc291cmNlbWFwIHBhdGhcbiAgICAgICAgcmV0dXJuICcnOyAvLyByZW1vdmUgZnJvbSBwcm9jZXNzZWQuY29kZVxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBjaGVja19lbmFibGVfc291cmNlbWFwKGVuYWJsZV9zb3VyY2VtYXAsIG5hbWVzcGFjZSkge1xuICAgIHJldHVybiB0eXBlb2YgZW5hYmxlX3NvdXJjZW1hcCA9PT0gJ2Jvb2xlYW4nXG4gICAgICAgID8gZW5hYmxlX3NvdXJjZW1hcFxuICAgICAgICA6IGVuYWJsZV9zb3VyY2VtYXBbbmFtZXNwYWNlXTtcbn1cblxuZnVuY3Rpb24gZG9tKGNvbXBvbmVudCwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgbmFtZSB9ID0gY29tcG9uZW50O1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbmV3IFJlbmRlcmVyKGNvbXBvbmVudCwgb3B0aW9ucyk7XG4gICAgY29uc3QgeyBibG9jayB9ID0gcmVuZGVyZXI7XG4gICAgYmxvY2suaGFzX291dHJvX21ldGhvZCA9IHRydWU7XG4gICAgLy8gcHJldmVudCBmcmFnbWVudCBiZWluZyBjcmVhdGVkIHR3aWNlICgjMTA2MylcbiAgICBpZiAob3B0aW9ucy5jdXN0b21FbGVtZW50KVxuICAgICAgICBibG9jay5jaHVua3MuY3JlYXRlLnB1c2goYiBgdGhpcy5jID0gQG5vb3A7YCk7XG4gICAgY29uc3QgYm9keSA9IFtdO1xuICAgIGlmIChyZW5kZXJlci5maWxlX3Zhcikge1xuICAgICAgICBjb25zdCBmaWxlID0gY29tcG9uZW50LmZpbGUgPyB4IGBcIiR7Y29tcG9uZW50LmZpbGV9XCJgIDogeCBgdW5kZWZpbmVkYDtcbiAgICAgICAgYm9keS5wdXNoKGIgYGNvbnN0ICR7cmVuZGVyZXIuZmlsZV92YXJ9ID0gJHtmaWxlfTtgKTtcbiAgICB9XG4gICAgY29uc3QgY3NzID0gY29tcG9uZW50LnN0eWxlc2hlZXQucmVuZGVyKG9wdGlvbnMuZmlsZW5hbWUsICFvcHRpb25zLmN1c3RvbUVsZW1lbnQpO1xuICAgIGNvbnN0IGNzc19zb3VyY2VtYXBfZW5hYmxlZCA9IGNoZWNrX2VuYWJsZV9zb3VyY2VtYXAob3B0aW9ucy5lbmFibGVTb3VyY2VtYXAsICdjc3MnKTtcbiAgICBpZiAoY3NzX3NvdXJjZW1hcF9lbmFibGVkKSB7XG4gICAgICAgIGNzcy5tYXAgPSBhcHBseV9wcmVwcm9jZXNzb3Jfc291cmNlbWFwKG9wdGlvbnMuZmlsZW5hbWUsIGNzcy5tYXAsIG9wdGlvbnMuc291cmNlbWFwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNzcy5tYXAgPSBudWxsO1xuICAgIH1cbiAgICBjb25zdCBzdHlsZXMgPSBjc3Nfc291cmNlbWFwX2VuYWJsZWQgJiYgY29tcG9uZW50LnN0eWxlc2hlZXQuaGFzX3N0eWxlcyAmJiBvcHRpb25zLmRldlxuICAgICAgICA/IGAke2Nzcy5jb2RlfVxcbi8qIyBzb3VyY2VNYXBwaW5nVVJMPSR7Y3NzLm1hcC50b1VybCgpfSAqL2BcbiAgICAgICAgOiBjc3MuY29kZTtcbiAgICBjb25zdCBhZGRfY3NzID0gY29tcG9uZW50LmdldF91bmlxdWVfbmFtZSgnYWRkX2NzcycpO1xuICAgIGNvbnN0IHNob3VsZF9hZGRfY3NzID0gKCFvcHRpb25zLmN1c3RvbUVsZW1lbnQgJiZcbiAgICAgICAgISFzdHlsZXMgJiZcbiAgICAgICAgb3B0aW9ucy5jc3MgIT09IGZhbHNlKTtcbiAgICBpZiAoc2hvdWxkX2FkZF9jc3MpIHtcbiAgICAgICAgYm9keS5wdXNoKGIgYFxuXHRcdFx0ZnVuY3Rpb24gJHthZGRfY3NzfSh0YXJnZXQpIHtcblx0XHRcdFx0QGFwcGVuZF9zdHlsZXModGFyZ2V0LCBcIiR7Y29tcG9uZW50LnN0eWxlc2hlZXQuaWR9XCIsIFwiJHtzdHlsZXN9XCIpO1xuXHRcdFx0fVxuXHRcdGApO1xuICAgIH1cbiAgICAvLyBmaXggb3JkZXJcbiAgICAvLyBUT0RPIHRoZSBkZWNvbmZsaWN0ZWQgbmFtZXMgb2YgYmxvY2tzIGFyZSByZXZlcnNlZC4uLiBzaG91bGQgc2V0IHRoZW0gaGVyZVxuICAgIGNvbnN0IGJsb2NrcyA9IHJlbmRlcmVyLmJsb2Nrcy5zbGljZSgpLnJldmVyc2UoKTtcbiAgICBib2R5LnB1c2goLi4uYmxvY2tzLm1hcChibG9jayA9PiB7XG4gICAgICAgIC8vIFRPRE8gdGhpcyBpcyBhIGhvcnJpYmxlIG1lc3Mg4oCUIHJlbmRlcmVyLmJsb2Nrc1xuICAgICAgICAvLyBjb250YWlucyBhIG1peHR1cmUgb2YgQmxvY2tzIGFuZCBOb2Rlc1xuICAgICAgICBpZiAoYmxvY2sucmVuZGVyKVxuICAgICAgICAgICAgcmV0dXJuIGJsb2NrLnJlbmRlcigpO1xuICAgICAgICByZXR1cm4gYmxvY2s7XG4gICAgfSkpO1xuICAgIGlmIChvcHRpb25zLmRldiAmJiAhb3B0aW9ucy5oeWRyYXRhYmxlKSB7XG4gICAgICAgIGJsb2NrLmNodW5rcy5jbGFpbS5wdXNoKGIgYHRocm93IG5ldyBAX0Vycm9yKFwib3B0aW9ucy5oeWRyYXRlIG9ubHkgd29ya3MgaWYgdGhlIGNvbXBvbmVudCB3YXMgY29tcGlsZWQgd2l0aCB0aGUgXFxgaHlkcmF0YWJsZTogdHJ1ZVxcYCBvcHRpb25cIik7YCk7XG4gICAgfVxuICAgIGNvbnN0IHVzZXNfc2xvdHMgPSBjb21wb25lbnQudmFyX2xvb2t1cC5oYXMoJyQkc2xvdHMnKTtcbiAgICBsZXQgY29tcHV0ZV9zbG90cztcbiAgICBpZiAodXNlc19zbG90cykge1xuICAgICAgICBjb21wdXRlX3Nsb3RzID0gYiBgXG5cdFx0XHRjb25zdCAkJHNsb3RzID0gQGNvbXB1dGVfc2xvdHMoI3Nsb3RzKTtcblx0XHRgO1xuICAgIH1cbiAgICBjb25zdCB1c2VzX3Byb3BzID0gY29tcG9uZW50LnZhcl9sb29rdXAuaGFzKCckJHByb3BzJyk7XG4gICAgY29uc3QgdXNlc19yZXN0ID0gY29tcG9uZW50LnZhcl9sb29rdXAuaGFzKCckJHJlc3RQcm9wcycpO1xuICAgIGNvbnN0ICQkcHJvcHMgPSB1c2VzX3Byb3BzIHx8IHVzZXNfcmVzdCA/ICckJG5ld19wcm9wcycgOiAnJCRwcm9wcyc7XG4gICAgY29uc3QgcHJvcHMgPSBjb21wb25lbnQudmFycy5maWx0ZXIodmFyaWFibGUgPT4gIXZhcmlhYmxlLm1vZHVsZSAmJiB2YXJpYWJsZS5leHBvcnRfbmFtZSk7XG4gICAgY29uc3Qgd3JpdGFibGVfcHJvcHMgPSBwcm9wcy5maWx0ZXIodmFyaWFibGUgPT4gdmFyaWFibGUud3JpdGFibGUpO1xuICAgIGNvbnN0IG9taXRfcHJvcHNfbmFtZXMgPSBjb21wb25lbnQuZ2V0X3VuaXF1ZV9uYW1lKCdvbWl0X3Byb3BzX25hbWVzJyk7XG4gICAgY29uc3QgY29tcHV0ZV9yZXN0ID0geCBgQGNvbXB1dGVfcmVzdF9wcm9wcygkJHByb3BzLCAke29taXRfcHJvcHNfbmFtZXMubmFtZX0pYDtcbiAgICBjb25zdCByZXN0ID0gdXNlc19yZXN0ID8gYiBgXG5cdFx0Y29uc3QgJHtvbWl0X3Byb3BzX25hbWVzLm5hbWV9ID0gWyR7cHJvcHMubWFwKHByb3AgPT4gYFwiJHtwcm9wLmV4cG9ydF9uYW1lfVwiYCkuam9pbignLCcpfV07XG5cdFx0bGV0ICQkcmVzdFByb3BzID0gJHtjb21wdXRlX3Jlc3R9O1xuXHRgIDogbnVsbDtcbiAgICBjb25zdCBzZXQgPSAodXNlc19wcm9wcyB8fCB1c2VzX3Jlc3QgfHwgd3JpdGFibGVfcHJvcHMubGVuZ3RoID4gMCB8fCBjb21wb25lbnQuc2xvdHMuc2l6ZSA+IDApXG4gICAgICAgID8geCBgXG5cdFx0XHQkeyQkcHJvcHN9ID0+IHtcblx0XHRcdFx0JHt1c2VzX3Byb3BzICYmIHJlbmRlcmVyLmludmFsaWRhdGUoJyQkcHJvcHMnLCB4IGAkJHByb3BzID0gQGFzc2lnbihAYXNzaWduKHt9LCAkJHByb3BzKSwgQGV4Y2x1ZGVfaW50ZXJuYWxfcHJvcHMoJCRuZXdfcHJvcHMpKWApfVxuXHRcdFx0XHQke3VzZXNfcmVzdCAmJiAhdXNlc19wcm9wcyAmJiB4IGAkJHByb3BzID0gQGFzc2lnbihAYXNzaWduKHt9LCAkJHByb3BzKSwgQGV4Y2x1ZGVfaW50ZXJuYWxfcHJvcHMoJCRuZXdfcHJvcHMpKWB9XG5cdFx0XHRcdCR7dXNlc19yZXN0ICYmIHJlbmRlcmVyLmludmFsaWRhdGUoJyQkcmVzdFByb3BzJywgeCBgJCRyZXN0UHJvcHMgPSAke2NvbXB1dGVfcmVzdH1gKX1cblx0XHRcdFx0JHt3cml0YWJsZV9wcm9wcy5tYXAocHJvcCA9PiBiIGBpZiAoJyR7cHJvcC5leHBvcnRfbmFtZX0nIGluICR7JCRwcm9wc30pICR7cmVuZGVyZXIuaW52YWxpZGF0ZShwcm9wLm5hbWUsIHggYCR7cHJvcC5uYW1lfSA9ICR7JCRwcm9wc30uJHtwcm9wLmV4cG9ydF9uYW1lfWApfTtgKX1cblx0XHRcdFx0JHtjb21wb25lbnQuc2xvdHMuc2l6ZSA+IDAgJiZcbiAgICAgICAgICAgIGIgYGlmICgnJCRzY29wZScgaW4gJHskJHByb3BzfSkgJHtyZW5kZXJlci5pbnZhbGlkYXRlKCckJHNjb3BlJywgeCBgJCRzY29wZSA9ICR7JCRwcm9wc30uJCRzY29wZWApfTtgfVxuXHRcdFx0fVxuXHRcdGBcbiAgICAgICAgOiBudWxsO1xuICAgIGNvbnN0IGFjY2Vzc29ycyA9IFtdO1xuICAgIGNvbnN0IG5vdF9lcXVhbCA9IGNvbXBvbmVudC5jb21wb25lbnRfb3B0aW9ucy5pbW11dGFibGUgPyB4IGBAbm90X2VxdWFsYCA6IHggYEBzYWZlX25vdF9lcXVhbGA7XG4gICAgbGV0IGRldl9wcm9wc19jaGVjaztcbiAgICBsZXQgaW5qZWN0X3N0YXRlO1xuICAgIGxldCBjYXB0dXJlX3N0YXRlO1xuICAgIGxldCBwcm9wc19pbmplY3Q7XG4gICAgcHJvcHMuZm9yRWFjaChwcm9wID0+IHtcbiAgICAgICAgY29uc3QgdmFyaWFibGUgPSBjb21wb25lbnQudmFyX2xvb2t1cC5nZXQocHJvcC5uYW1lKTtcbiAgICAgICAgaWYgKCF2YXJpYWJsZS53cml0YWJsZSB8fCBjb21wb25lbnQuY29tcG9uZW50X29wdGlvbnMuYWNjZXNzb3JzKSB7XG4gICAgICAgICAgICBhY2Nlc3NvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ01ldGhvZERlZmluaXRpb24nLFxuICAgICAgICAgICAgICAgIGtpbmQ6ICdnZXQnLFxuICAgICAgICAgICAgICAgIGtleTogeyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6IHByb3AuZXhwb3J0X25hbWUgfSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogeCBgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0cmV0dXJuICR7cHJvcC5ob2lzdGFibGUgPyBwcm9wLm5hbWUgOiB4IGB0aGlzLiQkLmN0eFske3JlbmRlcmVyLmNvbnRleHRfbG9va3VwLmdldChwcm9wLm5hbWUpLmluZGV4fV1gfVxuXHRcdFx0XHR9YFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5kZXYpIHtcbiAgICAgICAgICAgIGFjY2Vzc29ycy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnTWV0aG9kRGVmaW5pdGlvbicsXG4gICAgICAgICAgICAgICAga2luZDogJ2dldCcsXG4gICAgICAgICAgICAgICAga2V5OiB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogcHJvcC5leHBvcnRfbmFtZSB9LFxuICAgICAgICAgICAgICAgIHZhbHVlOiB4IGBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR0aHJvdyBuZXcgQF9FcnJvcihcIjwke2NvbXBvbmVudC50YWd9PjogUHJvcHMgY2Fubm90IGJlIHJlYWQgZGlyZWN0bHkgZnJvbSB0aGUgY29tcG9uZW50IGluc3RhbmNlIHVubGVzcyBjb21waWxpbmcgd2l0aCAnYWNjZXNzb3JzOiB0cnVlJyBvciAnPHN2ZWx0ZTpvcHRpb25zIGFjY2Vzc29ycy8+J1wiKTtcblx0XHRcdFx0fWBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb21wb25lbnQuY29tcG9uZW50X29wdGlvbnMuYWNjZXNzb3JzKSB7XG4gICAgICAgICAgICBpZiAodmFyaWFibGUud3JpdGFibGUgJiYgIXJlbmRlcmVyLnJlYWRvbmx5Lmhhcyhwcm9wLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgYWNjZXNzb3JzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTWV0aG9kRGVmaW5pdGlvbicsXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ6ICdzZXQnLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiBwcm9wLmV4cG9ydF9uYW1lIH0sXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB4IGBmdW5jdGlvbigke3Byb3AubmFtZX0pIHtcblx0XHRcdFx0XHRcdHRoaXMuJCRzZXQoeyAke3Byb3AuZXhwb3J0X25hbWV9OiAke3Byb3AubmFtZX0gfSk7XG5cdFx0XHRcdFx0XHRAZmx1c2goKTtcblx0XHRcdFx0XHR9YFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5kZXYpIHtcbiAgICAgICAgICAgICAgICBhY2Nlc3NvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdNZXRob2REZWZpbml0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAga2luZDogJ3NldCcsXG4gICAgICAgICAgICAgICAgICAgIGtleTogeyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6IHByb3AuZXhwb3J0X25hbWUgfSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHggYGZ1bmN0aW9uKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgQF9FcnJvcihcIjwke2NvbXBvbmVudC50YWd9PjogQ2Fubm90IHNldCByZWFkLW9ubHkgcHJvcGVydHkgJyR7cHJvcC5leHBvcnRfbmFtZX0nXCIpO1xuXHRcdFx0XHRcdH1gXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5kZXYpIHtcbiAgICAgICAgICAgIGFjY2Vzc29ycy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnTWV0aG9kRGVmaW5pdGlvbicsXG4gICAgICAgICAgICAgICAga2luZDogJ3NldCcsXG4gICAgICAgICAgICAgICAga2V5OiB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogcHJvcC5leHBvcnRfbmFtZSB9LFxuICAgICAgICAgICAgICAgIHZhbHVlOiB4IGBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0XHRcdHRocm93IG5ldyBAX0Vycm9yKFwiPCR7Y29tcG9uZW50LnRhZ30+OiBQcm9wcyBjYW5ub3QgYmUgc2V0IGRpcmVjdGx5IG9uIHRoZSBjb21wb25lbnQgaW5zdGFuY2UgdW5sZXNzIGNvbXBpbGluZyB3aXRoICdhY2Nlc3NvcnM6IHRydWUnIG9yICc8c3ZlbHRlOm9wdGlvbnMgYWNjZXNzb3JzLz4nXCIpO1xuXHRcdFx0XHR9YFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBjb21wb25lbnQuaW5zdGFuY2VfZXhwb3J0c19mcm9tLmZvckVhY2goZXhwb3J0c19mcm9tID0+IHtcbiAgICAgICAgY29uc3QgaW1wb3J0X2RlY2xhcmF0aW9uID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBleHBvcnRzX2Zyb20pLCB7IHR5cGU6ICdJbXBvcnREZWNsYXJhdGlvbicsIHNwZWNpZmllcnM6IFtdLCBzb3VyY2U6IGV4cG9ydHNfZnJvbS5zb3VyY2UgfSk7XG4gICAgICAgIGNvbXBvbmVudC5pbXBvcnRzLnB1c2goaW1wb3J0X2RlY2xhcmF0aW9uKTtcbiAgICAgICAgZXhwb3J0c19mcm9tLnNwZWNpZmllcnMuZm9yRWFjaChzcGVjaWZpZXIgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5jb21wb25lbnRfb3B0aW9ucy5hY2Nlc3NvcnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gY29tcG9uZW50LmdldF91bmlxdWVfbmFtZShzcGVjaWZpZXIuZXhwb3J0ZWQubmFtZSk7XG4gICAgICAgICAgICAgICAgaW1wb3J0X2RlY2xhcmF0aW9uLnNwZWNpZmllcnMucHVzaChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHNwZWNpZmllciksIHsgdHlwZTogJ0ltcG9ydFNwZWNpZmllcicsIGltcG9ydGVkOiBzcGVjaWZpZXIubG9jYWwsIGxvY2FsOiBuYW1lIH0pKTtcbiAgICAgICAgICAgICAgICBhY2Nlc3NvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdNZXRob2REZWZpbml0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAga2luZDogJ2dldCcsXG4gICAgICAgICAgICAgICAgICAgIGtleTogeyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6IHNwZWNpZmllci5leHBvcnRlZC5uYW1lIH0sXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB4IGBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHJldHVybiAke25hbWV9XG5cdFx0XHRcdFx0fWBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbXBvbmVudC5jb21waWxlX29wdGlvbnMuZGV2KSB7XG4gICAgICAgICAgICAgICAgYWNjZXNzb3JzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTWV0aG9kRGVmaW5pdGlvbicsXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ6ICdnZXQnLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiBzcGVjaWZpZXIuZXhwb3J0ZWQubmFtZSB9LFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogeCBgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgQF9FcnJvcihcIjwke2NvbXBvbmVudC50YWd9PjogUHJvcHMgY2Fubm90IGJlIHJlYWQgZGlyZWN0bHkgZnJvbSB0aGUgY29tcG9uZW50IGluc3RhbmNlIHVubGVzcyBjb21waWxpbmcgd2l0aCAnYWNjZXNzb3JzOiB0cnVlJyBvciAnPHN2ZWx0ZTpvcHRpb25zIGFjY2Vzc29ycy8+J1wiKTtcblx0XHRcdFx0XHR9YFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBpZiAoY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5kZXYpIHtcbiAgICAgICAgLy8gY2hlY2tpbmcgdGhhdCBleHBlY3RlZCBvbmVzIHdlcmUgcGFzc2VkXG4gICAgICAgIGNvbnN0IGV4cGVjdGVkID0gcHJvcHMuZmlsdGVyKHByb3AgPT4gcHJvcC53cml0YWJsZSAmJiAhcHJvcC5pbml0aWFsaXNlZCk7XG4gICAgICAgIGlmIChleHBlY3RlZC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRldl9wcm9wc19jaGVjayA9IGIgYFxuXHRcdFx0XHRjb25zdCB7IGN0eDogI2N0eCB9ID0gdGhpcy4kJDtcblx0XHRcdFx0Y29uc3QgcHJvcHMgPSAke29wdGlvbnMuY3VzdG9tRWxlbWVudCA/IHggYHRoaXMuYXR0cmlidXRlc2AgOiB4IGBvcHRpb25zLnByb3BzIHx8IHt9YH07XG5cdFx0XHRcdCR7ZXhwZWN0ZWQubWFwKHByb3AgPT4gYiBgXG5cdFx0XHRcdGlmICgke3JlbmRlcmVyLnJlZmVyZW5jZShwcm9wLm5hbWUpfSA9PT0gdW5kZWZpbmVkICYmICEoJyR7cHJvcC5leHBvcnRfbmFtZX0nIGluIHByb3BzKSkge1xuXHRcdFx0XHRcdEBfY29uc29sZS53YXJuKFwiPCR7Y29tcG9uZW50LnRhZ30+IHdhcyBjcmVhdGVkIHdpdGhvdXQgZXhwZWN0ZWQgcHJvcCAnJHtwcm9wLmV4cG9ydF9uYW1lfSdcIik7XG5cdFx0XHRcdH1gKX1cblx0XHRcdGA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2FwdHVyYWJsZV92YXJzID0gY29tcG9uZW50LnZhcnMuZmlsdGVyKHYgPT4gIXYuaW50ZXJuYWwgJiYgIXYuZ2xvYmFsICYmICF2Lm5hbWUuc3RhcnRzV2l0aCgnJCQnKSk7XG4gICAgICAgIGlmIChjYXB0dXJhYmxlX3ZhcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY2FwdHVyZV9zdGF0ZSA9IHggYCgpID0+ICh7ICR7Y2FwdHVyYWJsZV92YXJzLm1hcChwcm9wID0+IHAgYCR7cHJvcC5uYW1lfWApfSB9KWA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW5qZWN0YWJsZV92YXJzID0gY2FwdHVyYWJsZV92YXJzLmZpbHRlcih2ID0+ICF2Lm1vZHVsZSAmJiB2LndyaXRhYmxlICYmIHYubmFtZVswXSAhPT0gJyQnKTtcbiAgICAgICAgaWYgKHVzZXNfcHJvcHMgfHwgaW5qZWN0YWJsZV92YXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGluamVjdF9zdGF0ZSA9IHggYFxuXHRcdFx0XHQkeyQkcHJvcHN9ID0+IHtcblx0XHRcdFx0XHQke3VzZXNfcHJvcHMgJiYgcmVuZGVyZXIuaW52YWxpZGF0ZSgnJCRwcm9wcycsIHggYCQkcHJvcHMgPSBAYXNzaWduKEBhc3NpZ24oe30sICQkcHJvcHMpLCAkJG5ld19wcm9wcylgKX1cblx0XHRcdFx0XHQke2luamVjdGFibGVfdmFycy5tYXAodiA9PiBiIGBpZiAoJyR7di5uYW1lfScgaW4gJCRwcm9wcykgJHtyZW5kZXJlci5pbnZhbGlkYXRlKHYubmFtZSwgeCBgJHt2Lm5hbWV9ID0gJHskJHByb3BzfS4ke3YubmFtZX1gKX07YCl9XG5cdFx0XHRcdH1cblx0XHRcdGA7XG4gICAgICAgICAgICBwcm9wc19pbmplY3QgPSBiIGBcblx0XHRcdFx0aWYgKCQkcHJvcHMgJiYgXCIkJGluamVjdFwiIGluICQkcHJvcHMpIHtcblx0XHRcdFx0XHQkJHNlbGYuJGluamVjdF9zdGF0ZSgkJHByb3BzLiQkaW5qZWN0KTtcblx0XHRcdFx0fVxuXHRcdFx0YDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBpbnN0cnVtZW50IGFzc2lnbm1lbnRzXG4gICAgaWYgKGNvbXBvbmVudC5hc3QuaW5zdGFuY2UpIHtcbiAgICAgICAgbGV0IHNjb3BlID0gY29tcG9uZW50Lmluc3RhbmNlX3Njb3BlO1xuICAgICAgICBjb25zdCBtYXAgPSBjb21wb25lbnQuaW5zdGFuY2Vfc2NvcGVfbWFwO1xuICAgICAgICBsZXQgZXhlY3V0aW9uX2NvbnRleHQgPSBudWxsO1xuICAgICAgICB3YWxrKGNvbXBvbmVudC5hc3QuaW5zdGFuY2UuY29udGVudCwge1xuICAgICAgICAgICAgZW50ZXIobm9kZSkge1xuICAgICAgICAgICAgICAgIGlmIChtYXAuaGFzKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlID0gbWFwLmdldChub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFleGVjdXRpb25fY29udGV4dCAmJiAhc2NvcGUuYmxvY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWN1dGlvbl9jb250ZXh0ID0gbm9kZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICghZXhlY3V0aW9uX2NvbnRleHQgJiYgbm9kZS50eXBlID09PSAnTGFiZWxlZFN0YXRlbWVudCcgJiYgbm9kZS5sYWJlbC5uYW1lID09PSAnJCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhlY3V0aW9uX2NvbnRleHQgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZWF2ZShub2RlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1hcC5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChleGVjdXRpb25fY29udGV4dCA9PT0gbm9kZSkge1xuICAgICAgICAgICAgICAgICAgICBleGVjdXRpb25fY29udGV4dCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdBc3NpZ25tZW50RXhwcmVzc2lvbicgfHwgbm9kZS50eXBlID09PSAnVXBkYXRlRXhwcmVzc2lvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWduZWUgPSBub2RlLnR5cGUgPT09ICdBc3NpZ25tZW50RXhwcmVzc2lvbicgPyBub2RlLmxlZnQgOiBub2RlLmFyZ3VtZW50O1xuICAgICAgICAgICAgICAgICAgICAvLyBub3JtYWxseSAoYGEgPSAxYCwgYGIuYyA9IDJgKSwgdGhlcmUnbGwgYmUgYSBzaW5nbGUgbmFtZVxuICAgICAgICAgICAgICAgICAgICAvLyAoYSBvciBiKS4gSW4gZGVzdHJ1Y3R1cmluZyBjYXNlcyAoYFtkLCBlXSA9IFtlLCBkXWApIHRoZXJlXG4gICAgICAgICAgICAgICAgICAgIC8vIG1heSBiZSBtb3JlLCBpbiB3aGljaCBjYXNlIHdlIG5lZWQgdG8gdGFjayB0aGUgZXh0cmEgb25lc1xuICAgICAgICAgICAgICAgICAgICAvLyBvbnRvIHRoZSBpbml0aWFsIGZ1bmN0aW9uIGNhbGxcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZXMgPSBuZXcgU2V0KGV4dHJhY3RfbmFtZXMoYXNzaWduZWUpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBsYWNlKGludmFsaWRhdGUocmVuZGVyZXIsIHNjb3BlLCBub2RlLCBuYW1lcywgZXhlY3V0aW9uX2NvbnRleHQgPT09IG51bGwpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb21wb25lbnQucmV3cml0ZV9wcm9wcygoeyBuYW1lLCByZWFzc2lnbmVkLCBleHBvcnRfbmFtZSB9KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGAkJHtuYW1lfWA7XG4gICAgICAgICAgICBjb25zdCBpID0gcmVuZGVyZXIuY29udGV4dF9sb29rdXAuZ2V0KGAkJHtuYW1lfWApLmluZGV4O1xuICAgICAgICAgICAgY29uc3QgaW5zZXJ0ID0gKHJlYXNzaWduZWQgfHwgZXhwb3J0X25hbWUpXG4gICAgICAgICAgICAgICAgPyBiIGAke2AkJHN1YnNjcmliZV8ke25hbWV9YH0oKWBcbiAgICAgICAgICAgICAgICA6IGIgYEBjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgJHtuYW1lfSwgI3ZhbHVlID0+ICQkaW52YWxpZGF0ZSgke2l9LCAke3ZhbHVlfSA9ICN2YWx1ZSkpYDtcbiAgICAgICAgICAgIGlmIChjb21wb25lbnQuY29tcGlsZV9vcHRpb25zLmRldikge1xuICAgICAgICAgICAgICAgIHJldHVybiBiIGBAdmFsaWRhdGVfc3RvcmUoJHtuYW1lfSwgJyR7bmFtZX0nKTsgJHtpbnNlcnR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpbnNlcnQ7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBhcmdzID0gW3ggYCQkc2VsZmBdO1xuICAgIGNvbnN0IGhhc19pbnZhbGlkYXRlID0gcHJvcHMubGVuZ3RoID4gMCB8fFxuICAgICAgICBjb21wb25lbnQuaGFzX3JlYWN0aXZlX2Fzc2lnbm1lbnRzIHx8XG4gICAgICAgIGNvbXBvbmVudC5zbG90cy5zaXplID4gMCB8fFxuICAgICAgICBjYXB0dXJlX3N0YXRlIHx8XG4gICAgICAgIGluamVjdF9zdGF0ZTtcbiAgICBpZiAoaGFzX2ludmFsaWRhdGUpIHtcbiAgICAgICAgYXJncy5wdXNoKHggYCQkcHJvcHNgLCB4IGAkJGludmFsaWRhdGVgKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5kZXYpIHtcbiAgICAgICAgLy8gJCRwcm9wcyBhcmcgaXMgc3RpbGwgbmVlZGVkIGZvciB1bmtub3duIHByb3AgY2hlY2tcbiAgICAgICAgYXJncy5wdXNoKHggYCQkcHJvcHNgKTtcbiAgICB9XG4gICAgY29uc3QgaGFzX2NyZWF0ZV9mcmFnbWVudCA9IGNvbXBvbmVudC5jb21waWxlX29wdGlvbnMuZGV2IHx8IGJsb2NrLmhhc19jb250ZW50KCk7XG4gICAgaWYgKGhhc19jcmVhdGVfZnJhZ21lbnQpIHtcbiAgICAgICAgYm9keS5wdXNoKGIgYFxuXHRcdFx0ZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50KCNjdHgpIHtcblx0XHRcdFx0JHtibG9jay5nZXRfY29udGVudHMoKX1cblx0XHRcdH1cblx0XHRgKTtcbiAgICB9XG4gICAgYm9keS5wdXNoKGIgYFxuXHRcdCR7Y29tcG9uZW50LmV4dHJhY3RfamF2YXNjcmlwdChjb21wb25lbnQuYXN0Lm1vZHVsZSl9XG5cblx0XHQke2NvbXBvbmVudC5mdWxseV9ob2lzdGVkfVxuXHRgKTtcbiAgICBjb25zdCBmaWx0ZXJlZF9wcm9wcyA9IHByb3BzLmZpbHRlcihwcm9wID0+IHtcbiAgICAgICAgY29uc3QgdmFyaWFibGUgPSBjb21wb25lbnQudmFyX2xvb2t1cC5nZXQocHJvcC5uYW1lKTtcbiAgICAgICAgaWYgKHZhcmlhYmxlLmhvaXN0YWJsZSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHByb3AubmFtZVswXSAhPT0gJyQnO1xuICAgIH0pO1xuICAgIGNvbnN0IHJlYWN0aXZlX3N0b3JlcyA9IGNvbXBvbmVudC52YXJzLmZpbHRlcih2YXJpYWJsZSA9PiB2YXJpYWJsZS5uYW1lWzBdID09PSAnJCcgJiYgdmFyaWFibGUubmFtZVsxXSAhPT0gJyQnKTtcbiAgICBjb25zdCBpbnN0YW5jZV9qYXZhc2NyaXB0ID0gY29tcG9uZW50LmV4dHJhY3RfamF2YXNjcmlwdChjb21wb25lbnQuYXN0Lmluc3RhbmNlKTtcbiAgICBjb25zdCBoYXNfZGVmaW5pdGlvbiA9IChjb21wb25lbnQuY29tcGlsZV9vcHRpb25zLmRldiB8fFxuICAgICAgICAoaW5zdGFuY2VfamF2YXNjcmlwdCAmJiBpbnN0YW5jZV9qYXZhc2NyaXB0Lmxlbmd0aCA+IDApIHx8XG4gICAgICAgIGZpbHRlcmVkX3Byb3BzLmxlbmd0aCA+IDAgfHxcbiAgICAgICAgdXNlc19wcm9wcyB8fFxuICAgICAgICBjb21wb25lbnQucGFydGx5X2hvaXN0ZWQubGVuZ3RoID4gMCB8fFxuICAgICAgICByZW5kZXJlci5pbml0aWFsX2NvbnRleHQubGVuZ3RoID4gMCB8fFxuICAgICAgICBjb21wb25lbnQucmVhY3RpdmVfZGVjbGFyYXRpb25zLmxlbmd0aCA+IDAgfHxcbiAgICAgICAgY2FwdHVyZV9zdGF0ZSB8fFxuICAgICAgICBpbmplY3Rfc3RhdGUpO1xuICAgIGNvbnN0IGRlZmluaXRpb24gPSBoYXNfZGVmaW5pdGlvblxuICAgICAgICA/IGNvbXBvbmVudC5hbGlhcygnaW5zdGFuY2UnKVxuICAgICAgICA6IHsgdHlwZTogJ0xpdGVyYWwnLCB2YWx1ZTogbnVsbCB9O1xuICAgIGNvbnN0IHJlYWN0aXZlX3N0b3JlX3N1YnNjcmlwdGlvbnMgPSByZWFjdGl2ZV9zdG9yZXNcbiAgICAgICAgLmZpbHRlcihzdG9yZSA9PiB7XG4gICAgICAgIGNvbnN0IHZhcmlhYmxlID0gY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KHN0b3JlLm5hbWUuc2xpY2UoMSkpO1xuICAgICAgICByZXR1cm4gIXZhcmlhYmxlIHx8IHZhcmlhYmxlLmhvaXN0YWJsZTtcbiAgICB9KVxuICAgICAgICAubWFwKCh7IG5hbWUgfSkgPT4gYiBgXG5cdFx0XHQke2NvbXBvbmVudC5jb21waWxlX29wdGlvbnMuZGV2ICYmIGIgYEB2YWxpZGF0ZV9zdG9yZSgke25hbWUuc2xpY2UoMSl9LCAnJHtuYW1lLnNsaWNlKDEpfScpO2B9XG5cdFx0XHRAY29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsICR7bmFtZS5zbGljZSgxKX0sICQkdmFsdWUgPT4gJCRpbnZhbGlkYXRlKCR7cmVuZGVyZXIuY29udGV4dF9sb29rdXAuZ2V0KG5hbWUpLmluZGV4fSwgJHtuYW1lfSA9ICQkdmFsdWUpKTtcblx0XHRgKTtcbiAgICBjb25zdCByZXN1YnNjcmliYWJsZV9yZWFjdGl2ZV9zdG9yZV91bnN1YnNjcmliZXJzID0gcmVhY3RpdmVfc3RvcmVzXG4gICAgICAgIC5maWx0ZXIoc3RvcmUgPT4ge1xuICAgICAgICBjb25zdCB2YXJpYWJsZSA9IGNvbXBvbmVudC52YXJfbG9va3VwLmdldChzdG9yZS5uYW1lLnNsaWNlKDEpKTtcbiAgICAgICAgcmV0dXJuIHZhcmlhYmxlICYmICh2YXJpYWJsZS5yZWFzc2lnbmVkIHx8IHZhcmlhYmxlLmV4cG9ydF9uYW1lKTtcbiAgICB9KVxuICAgICAgICAubWFwKCh7IG5hbWUgfSkgPT4gYiBgJCRzZWxmLiQkLm9uX2Rlc3Ryb3kucHVzaCgoKSA9PiAke2AkJHVuc3Vic2NyaWJlXyR7bmFtZS5zbGljZSgxKX1gfSgpKTtgKTtcbiAgICBpZiAoaGFzX2RlZmluaXRpb24pIHtcbiAgICAgICAgY29uc3QgcmVhY3RpdmVfZGVjbGFyYXRpb25zID0gW107XG4gICAgICAgIGNvbnN0IGZpeGVkX3JlYWN0aXZlX2RlY2xhcmF0aW9ucyA9IFtdOyAvLyBub3QgcmVhbGx5ICdyZWFjdGl2ZScgYnV0IHdoYXRldmVyXG4gICAgICAgIGNvbXBvbmVudC5yZWFjdGl2ZV9kZWNsYXJhdGlvbnMuZm9yRWFjaChkID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IEFycmF5LmZyb20oZC5kZXBlbmRlbmNpZXMpO1xuICAgICAgICAgICAgY29uc3QgdXNlc19yZXN0X29yX3Byb3BzID0gISFkZXBlbmRlbmNpZXMuZmluZChuID0+IG4gPT09ICckJHByb3BzJyB8fCBuID09PSAnJCRyZXN0UHJvcHMnKTtcbiAgICAgICAgICAgIGNvbnN0IHdyaXRhYmxlID0gZGVwZW5kZW5jaWVzLmZpbHRlcihuID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IGNvbXBvbmVudC52YXJfbG9va3VwLmdldChuKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFyaWFibGUgJiYgKHZhcmlhYmxlLmV4cG9ydF9uYW1lIHx8IHZhcmlhYmxlLm11dGF0ZWQgfHwgdmFyaWFibGUucmVhc3NpZ25lZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9ICF1c2VzX3Jlc3Rfb3JfcHJvcHMgJiYgd3JpdGFibGUubGVuZ3RoID4gMCAmJiByZW5kZXJlci5kaXJ0eSh3cml0YWJsZSwgdHJ1ZSk7XG4gICAgICAgICAgICBsZXQgc3RhdGVtZW50ID0gZC5ub2RlOyAvLyBUT0RPIHJlbW92ZSBsYWJlbCAodXNlIGQubm9kZS5ib2R5KSBpZiBpdCdzIG5vdCByZWZlcmVuY2VkXG4gICAgICAgICAgICBpZiAoY29uZGl0aW9uKVxuICAgICAgICAgICAgICAgIHN0YXRlbWVudCA9IGIgYGlmICgke2NvbmRpdGlvbn0pIHsgJHtzdGF0ZW1lbnR9IH1gWzBdO1xuICAgICAgICAgICAgaWYgKGNvbmRpdGlvbiB8fCB1c2VzX3Jlc3Rfb3JfcHJvcHMpIHtcbiAgICAgICAgICAgICAgICByZWFjdGl2ZV9kZWNsYXJhdGlvbnMucHVzaChzdGF0ZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZml4ZWRfcmVhY3RpdmVfZGVjbGFyYXRpb25zLnB1c2goc3RhdGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGluamVjdGVkID0gQXJyYXkuZnJvbShjb21wb25lbnQuaW5qZWN0ZWRfcmVhY3RpdmVfZGVjbGFyYXRpb25fdmFycykuZmlsdGVyKG5hbWUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdmFyaWFibGUgPSBjb21wb25lbnQudmFyX2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gdmFyaWFibGUuaW5qZWN0ZWQgJiYgdmFyaWFibGUubmFtZVswXSAhPT0gJyQnO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcmVhY3RpdmVfc3RvcmVfZGVjbGFyYXRpb25zID0gcmVhY3RpdmVfc3RvcmVzLm1hcCh2YXJpYWJsZSA9PiB7XG4gICAgICAgICAgICBjb25zdCAkbmFtZSA9IHZhcmlhYmxlLm5hbWU7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gJG5hbWUuc2xpY2UoMSk7XG4gICAgICAgICAgICBjb25zdCBzdG9yZSA9IGNvbXBvbmVudC52YXJfbG9va3VwLmdldChuYW1lKTtcbiAgICAgICAgICAgIGlmIChzdG9yZSAmJiAoc3RvcmUucmVhc3NpZ25lZCB8fCBzdG9yZS5leHBvcnRfbmFtZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB1bnN1YnNjcmliZSA9IGAkJHVuc3Vic2NyaWJlXyR7bmFtZX1gO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1YnNjcmliZSA9IGAkJHN1YnNjcmliZV8ke25hbWV9YDtcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gcmVuZGVyZXIuY29udGV4dF9sb29rdXAuZ2V0KCRuYW1lKS5pbmRleDtcbiAgICAgICAgICAgICAgICByZXR1cm4gYiBgbGV0ICR7JG5hbWV9LCAke3Vuc3Vic2NyaWJlfSA9IEBub29wLCAke3N1YnNjcmliZX0gPSAoKSA9PiAoJHt1bnN1YnNjcmliZX0oKSwgJHt1bnN1YnNjcmliZX0gPSBAc3Vic2NyaWJlKCR7bmFtZX0sICQkdmFsdWUgPT4gJCRpbnZhbGlkYXRlKCR7aX0sICR7JG5hbWV9ID0gJCR2YWx1ZSkpLCAke25hbWV9KWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYiBgbGV0ICR7JG5hbWV9O2A7XG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgdW5rbm93bl9wcm9wc19jaGVjaztcbiAgICAgICAgaWYgKGNvbXBvbmVudC5jb21waWxlX29wdGlvbnMuZGV2ICYmICEodXNlc19wcm9wcyB8fCB1c2VzX3Jlc3QpKSB7XG4gICAgICAgICAgICB1bmtub3duX3Byb3BzX2NoZWNrID0gYiBgXG5cdFx0XHRcdGNvbnN0IHdyaXRhYmxlX3Byb3BzID0gWyR7d3JpdGFibGVfcHJvcHMubWFwKHByb3AgPT4geCBgJyR7cHJvcC5leHBvcnRfbmFtZX0nYCl9XTtcblx0XHRcdFx0QF9PYmplY3Qua2V5cygkJHByb3BzKS5mb3JFYWNoKGtleSA9PiB7XG5cdFx0XHRcdFx0aWYgKCF+d3JpdGFibGVfcHJvcHMuaW5kZXhPZihrZXkpICYmIGtleS5zbGljZSgwLCAyKSAhPT0gJyQkJyAmJiBrZXkgIT09ICdzbG90JykgQF9jb25zb2xlLndhcm4oXFxgPCR7Y29tcG9uZW50LnRhZ30+IHdhcyBjcmVhdGVkIHdpdGggdW5rbm93biBwcm9wICdcXCR7a2V5fSdcXGApO1xuXHRcdFx0XHR9KTtcblx0XHRcdGA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmV0dXJuX3ZhbHVlID0ge1xuICAgICAgICAgICAgdHlwZTogJ0FycmF5RXhwcmVzc2lvbicsXG4gICAgICAgICAgICBlbGVtZW50czogcmVuZGVyZXIuaW5pdGlhbF9jb250ZXh0Lm1hcChtZW1iZXIgPT4gKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICAgICAgbmFtZTogbWVtYmVyLm5hbWVcbiAgICAgICAgICAgIH0pKVxuICAgICAgICB9O1xuICAgICAgICBib2R5LnB1c2goYiBgXG5cdFx0XHRmdW5jdGlvbiAke2RlZmluaXRpb259KCR7YXJnc30pIHtcblx0XHRcdFx0JHtpbmplY3RlZC5tYXAobmFtZSA9PiBiIGBsZXQgJHtuYW1lfTtgKX1cblxuXHRcdFx0XHQke3Jlc3R9XG5cblx0XHRcdFx0JHtyZWFjdGl2ZV9zdG9yZV9kZWNsYXJhdGlvbnN9XG5cblx0XHRcdFx0JHtyZWFjdGl2ZV9zdG9yZV9zdWJzY3JpcHRpb25zfVxuXG5cdFx0XHRcdCR7cmVzdWJzY3JpYmFibGVfcmVhY3RpdmVfc3RvcmVfdW5zdWJzY3JpYmVyc31cblxuXHRcdFx0XHQke2NvbXBvbmVudC5zbG90cy5zaXplIHx8IGNvbXBvbmVudC5jb21waWxlX29wdGlvbnMuZGV2IHx8IHVzZXNfc2xvdHMgPyBiIGBsZXQgeyAkJHNsb3RzOiAjc2xvdHMgPSB7fSwgJCRzY29wZSB9ID0gJCRwcm9wcztgIDogbnVsbH1cblx0XHRcdFx0JHtjb21wb25lbnQuY29tcGlsZV9vcHRpb25zLmRldiAmJiBiIGBAdmFsaWRhdGVfc2xvdHMoJyR7Y29tcG9uZW50LnRhZ30nLCAjc2xvdHMsIFske1suLi5jb21wb25lbnQuc2xvdHMua2V5cygpXS5tYXAoa2V5ID0+IGAnJHtrZXl9J2ApLmpvaW4oJywnKX1dKTtgfVxuXHRcdFx0XHQke2NvbXB1dGVfc2xvdHN9XG5cblx0XHRcdFx0JHtpbnN0YW5jZV9qYXZhc2NyaXB0fVxuXG5cdFx0XHRcdCR7dW5rbm93bl9wcm9wc19jaGVja31cblxuXHRcdFx0XHQke3JlbmRlcmVyLmJpbmRpbmdfZ3JvdXBzLnNpemUgPiAwICYmIGIgYGNvbnN0ICQkYmluZGluZ19ncm91cHMgPSBbJHtbLi4ucmVuZGVyZXIuYmluZGluZ19ncm91cHMua2V5cygpXS5tYXAoXyA9PiB4IGBbXWApfV07YH1cblxuXHRcdFx0XHQke2NvbXBvbmVudC5wYXJ0bHlfaG9pc3RlZH1cblxuXHRcdFx0XHQke3NldCAmJiBiIGAkJHNlbGYuJCRzZXQgPSAke3NldH07YH1cblxuXHRcdFx0XHQke2NhcHR1cmVfc3RhdGUgJiYgYiBgJCRzZWxmLiRjYXB0dXJlX3N0YXRlID0gJHtjYXB0dXJlX3N0YXRlfTtgfVxuXG5cdFx0XHRcdCR7aW5qZWN0X3N0YXRlICYmIGIgYCQkc2VsZi4kaW5qZWN0X3N0YXRlID0gJHtpbmplY3Rfc3RhdGV9O2B9XG5cblx0XHRcdFx0JHsgLyogYmVmb3JlIHJlYWN0aXZlIGRlY2xhcmF0aW9ucyAqL3Byb3BzX2luamVjdH1cblxuXHRcdFx0XHQke3JlYWN0aXZlX2RlY2xhcmF0aW9ucy5sZW5ndGggPiAwICYmIGIgYFxuXHRcdFx0XHQkJHNlbGYuJCQudXBkYXRlID0gKCkgPT4ge1xuXHRcdFx0XHRcdCR7cmVhY3RpdmVfZGVjbGFyYXRpb25zfVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRgfVxuXG5cdFx0XHRcdCR7Zml4ZWRfcmVhY3RpdmVfZGVjbGFyYXRpb25zfVxuXG5cdFx0XHRcdCR7dXNlc19wcm9wcyAmJiBiIGAkJHByb3BzID0gQGV4Y2x1ZGVfaW50ZXJuYWxfcHJvcHMoJCRwcm9wcyk7YH1cblxuXHRcdFx0XHRyZXR1cm4gJHtyZXR1cm5fdmFsdWV9O1xuXHRcdFx0fVxuXHRcdGApO1xuICAgIH1cbiAgICBjb25zdCBwcm9wX2luZGV4ZXMgPSB4IGB7XG5cdFx0JHtwcm9wcy5maWx0ZXIodiA9PiB2LmV4cG9ydF9uYW1lICYmICF2Lm1vZHVsZSkubWFwKHYgPT4gcCBgJHt2LmV4cG9ydF9uYW1lfTogJHtyZW5kZXJlci5jb250ZXh0X2xvb2t1cC5nZXQodi5uYW1lKS5pbmRleH1gKX1cblx0fWA7XG4gICAgbGV0IGRpcnR5O1xuICAgIGlmIChyZW5kZXJlci5jb250ZXh0X292ZXJmbG93KSB7XG4gICAgICAgIGRpcnR5ID0geCBgW11gO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlbmRlcmVyLmNvbnRleHQubGVuZ3RoOyBpICs9IDMxKSB7XG4gICAgICAgICAgICBkaXJ0eS5lbGVtZW50cy5wdXNoKHggYC0xYCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuY3VzdG9tRWxlbWVudCkge1xuICAgICAgICBsZXQgaW5pdF9wcm9wcyA9IHggYEBhdHRyaWJ1dGVfdG9fb2JqZWN0KHRoaXMuYXR0cmlidXRlcylgO1xuICAgICAgICBpZiAodXNlc19zbG90cykge1xuICAgICAgICAgICAgaW5pdF9wcm9wcyA9IHggYHsgLi4uJHtpbml0X3Byb3BzfSwgJCRzbG90czogQGdldF9jdXN0b21fZWxlbWVudHNfc2xvdHModGhpcykgfWA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGVjbGFyYXRpb24gPSBiIGBcblx0XHRcdGNsYXNzICR7bmFtZX0gZXh0ZW5kcyBAU3ZlbHRlRWxlbWVudCB7XG5cdFx0XHRcdGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcblx0XHRcdFx0XHRzdXBlcigpO1xuXG5cdFx0XHRcdFx0JHtjc3MuY29kZSAmJiBiIGB0aGlzLnNoYWRvd1Jvb3QuaW5uZXJIVE1MID0gXFxgPHN0eWxlPiR7Y3NzLmNvZGUucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKX0ke2Nzc19zb3VyY2VtYXBfZW5hYmxlZCAmJiBvcHRpb25zLmRldiA/IGBcXG4vKiMgc291cmNlTWFwcGluZ1VSTD0ke2Nzcy5tYXAudG9VcmwoKX0gKi9gIDogJyd9PC9zdHlsZT5cXGA7YH1cblxuXHRcdFx0XHRcdEBpbml0KHRoaXMsIHsgdGFyZ2V0OiB0aGlzLnNoYWRvd1Jvb3QsIHByb3BzOiAke2luaXRfcHJvcHN9LCBjdXN0b21FbGVtZW50OiB0cnVlIH0sICR7ZGVmaW5pdGlvbn0sICR7aGFzX2NyZWF0ZV9mcmFnbWVudCA/ICdjcmVhdGVfZnJhZ21lbnQnIDogJ251bGwnfSwgJHtub3RfZXF1YWx9LCAke3Byb3BfaW5kZXhlc30sIG51bGwsICR7ZGlydHl9KTtcblxuXHRcdFx0XHRcdCR7ZGV2X3Byb3BzX2NoZWNrfVxuXG5cdFx0XHRcdFx0aWYgKG9wdGlvbnMpIHtcblx0XHRcdFx0XHRcdGlmIChvcHRpb25zLnRhcmdldCkge1xuXHRcdFx0XHRcdFx0XHRAaW5zZXJ0KG9wdGlvbnMudGFyZ2V0LCB0aGlzLCBvcHRpb25zLmFuY2hvcik7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdCR7KHByb3BzLmxlbmd0aCA+IDAgfHwgdXNlc19wcm9wcyB8fCB1c2VzX3Jlc3QpICYmIGIgYFxuXHRcdFx0XHRcdFx0aWYgKG9wdGlvbnMucHJvcHMpIHtcblx0XHRcdFx0XHRcdFx0dGhpcy4kc2V0KG9wdGlvbnMucHJvcHMpO1xuXHRcdFx0XHRcdFx0XHRAZmx1c2goKTtcblx0XHRcdFx0XHRcdH1gfVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdGBbMF07XG4gICAgICAgIGlmIChwcm9wcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBkZWNsYXJhdGlvbi5ib2R5LmJvZHkucHVzaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ01ldGhvZERlZmluaXRpb24nLFxuICAgICAgICAgICAgICAgIGtpbmQ6ICdnZXQnLFxuICAgICAgICAgICAgICAgIHN0YXRpYzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAga2V5OiB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogJ29ic2VydmVkQXR0cmlidXRlcycgfSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogeCBgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFske3Byb3BzLm1hcChwcm9wID0+IHggYFwiJHtwcm9wLmV4cG9ydF9uYW1lfVwiYCl9XTtcblx0XHRcdFx0fWBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGRlY2xhcmF0aW9uLmJvZHkuYm9keS5wdXNoKC4uLmFjY2Vzc29ycyk7XG4gICAgICAgIGJvZHkucHVzaChkZWNsYXJhdGlvbik7XG4gICAgICAgIGlmIChjb21wb25lbnQudGFnICE9IG51bGwpIHtcbiAgICAgICAgICAgIGJvZHkucHVzaChiIGBcblx0XHRcdFx0QF9jdXN0b21FbGVtZW50cy5kZWZpbmUoXCIke2NvbXBvbmVudC50YWd9XCIsICR7bmFtZX0pO1xuXHRcdFx0YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHN1cGVyY2xhc3MgPSB7XG4gICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICBuYW1lOiBvcHRpb25zLmRldiA/ICdAU3ZlbHRlQ29tcG9uZW50RGV2JyA6ICdAU3ZlbHRlQ29tcG9uZW50J1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBvcHRpb25hbF9wYXJhbWV0ZXJzID0gW107XG4gICAgICAgIGlmIChzaG91bGRfYWRkX2Nzcykge1xuICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1ldGVycy5wdXNoKGFkZF9jc3MpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRpcnR5KSB7XG4gICAgICAgICAgICBvcHRpb25hbF9wYXJhbWV0ZXJzLnB1c2goeCBgbnVsbGApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkaXJ0eSkge1xuICAgICAgICAgICAgb3B0aW9uYWxfcGFyYW1ldGVycy5wdXNoKGRpcnR5KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZWNsYXJhdGlvbiA9IGIgYFxuXHRcdFx0Y2xhc3MgJHtuYW1lfSBleHRlbmRzICR7c3VwZXJjbGFzc30ge1xuXHRcdFx0XHRjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG5cdFx0XHRcdFx0c3VwZXIoJHtvcHRpb25zLmRldiAmJiAnb3B0aW9ucyd9KTtcblx0XHRcdFx0XHRAaW5pdCh0aGlzLCBvcHRpb25zLCAke2RlZmluaXRpb259LCAke2hhc19jcmVhdGVfZnJhZ21lbnQgPyAnY3JlYXRlX2ZyYWdtZW50JyA6ICdudWxsJ30sICR7bm90X2VxdWFsfSwgJHtwcm9wX2luZGV4ZXN9LCAke29wdGlvbmFsX3BhcmFtZXRlcnN9KTtcblx0XHRcdFx0XHQke29wdGlvbnMuZGV2ICYmIGIgYEBkaXNwYXRjaF9kZXYoXCJTdmVsdGVSZWdpc3RlckNvbXBvbmVudFwiLCB7IGNvbXBvbmVudDogdGhpcywgdGFnTmFtZTogXCIke25hbWUubmFtZX1cIiwgb3B0aW9ucywgaWQ6IGNyZWF0ZV9mcmFnbWVudC5uYW1lIH0pO2B9XG5cblx0XHRcdFx0XHQke2Rldl9wcm9wc19jaGVja31cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdGBbMF07XG4gICAgICAgIGRlY2xhcmF0aW9uLmJvZHkuYm9keS5wdXNoKC4uLmFjY2Vzc29ycyk7XG4gICAgICAgIGJvZHkucHVzaChkZWNsYXJhdGlvbik7XG4gICAgfVxuICAgIHJldHVybiB7IGpzOiBmbGF0dGVuKGJvZHkpLCBjc3MgfTtcbn1cblxuZnVuY3Rpb24gZ2V0X2NvbnN0X3RhZ3MkMShjb25zdF90YWdzKSB7XG4gICAgaWYgKGNvbnN0X3RhZ3MubGVuZ3RoID09PSAwKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiAnVmFyaWFibGVEZWNsYXJhdGlvbicsXG4gICAgICAgIGtpbmQ6ICdsZXQnLFxuICAgICAgICBkZWNsYXJhdGlvbnM6IGNvbnN0X3RhZ3MubWFwKGNvbnN0X3RhZyA9PiB7XG4gICAgICAgICAgICBjb25zdCBhc3NpZ25tZW50ID0gY29uc3RfdGFnLm5vZGUuZXhwcmVzc2lvbjtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRvcicsXG4gICAgICAgICAgICAgICAgaWQ6IGFzc2lnbm1lbnQubGVmdCxcbiAgICAgICAgICAgICAgICBpbml0OiBhc3NpZ25tZW50LnJpZ2h0XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIEF3YWl0QmxvY2skMSAobm9kZSwgcmVuZGVyZXIsIG9wdGlvbnMpIHtcbiAgICByZW5kZXJlci5wdXNoKCk7XG4gICAgcmVuZGVyZXIucmVuZGVyKG5vZGUucGVuZGluZy5jaGlsZHJlbiwgb3B0aW9ucyk7XG4gICAgY29uc3QgcGVuZGluZyA9IHJlbmRlcmVyLnBvcCgpO1xuICAgIHJlbmRlcmVyLnB1c2goKTtcbiAgICByZW5kZXJlci5yZW5kZXIobm9kZS50aGVuLmNoaWxkcmVuLCBvcHRpb25zKTtcbiAgICBjb25zdCB0aGVuID0gcmVuZGVyZXIucG9wKCk7XG4gICAgcmVuZGVyZXIuYWRkX2V4cHJlc3Npb24oeCBgXG5cdFx0ZnVuY3Rpb24oX192YWx1ZSkge1xuXHRcdFx0aWYgKEBpc19wcm9taXNlKF9fdmFsdWUpKSB7XG5cdFx0XHRcdF9fdmFsdWUudGhlbihudWxsLCBAbm9vcCk7XG5cdFx0XHRcdHJldHVybiAke3BlbmRpbmd9O1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIChmdW5jdGlvbigke25vZGUudGhlbl9ub2RlID8gbm9kZS50aGVuX25vZGUgOiAnJ30pIHsgJHtnZXRfY29uc3RfdGFncyQxKG5vZGUudGhlbi5jb25zdF90YWdzKX07IHJldHVybiAke3RoZW59OyB9KF9fdmFsdWUpKTtcblx0XHR9KCR7bm9kZS5leHByZXNzaW9uLm5vZGV9KVxuXHRgKTtcbn1cblxuZnVuY3Rpb24gQ29tbWVudCQyIChub2RlLCByZW5kZXJlciwgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zLnByZXNlcnZlQ29tbWVudHMpIHtcbiAgICAgICAgcmVuZGVyZXIuYWRkX3N0cmluZyhgPCEtLSR7bm9kZS5kYXRhfS0tPmApO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gRGVidWdUYWckMSAobm9kZSwgcmVuZGVyZXIsIG9wdGlvbnMpIHtcbiAgICBpZiAoIW9wdGlvbnMuZGV2KVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgZmlsZW5hbWUgPSBvcHRpb25zLmZpbGVuYW1lIHx8IG51bGw7XG4gICAgY29uc3QgeyBsaW5lLCBjb2x1bW4gfSA9IG9wdGlvbnMubG9jYXRlKG5vZGUuc3RhcnQgKyAxKTtcbiAgICBjb25zdCBvYmogPSB4IGB7XG5cdFx0JHtub2RlLmV4cHJlc3Npb25zLm1hcChlID0+IHAgYCR7ZS5ub2RlLm5hbWV9YCl9XG5cdH1gO1xuICAgIHJlbmRlcmVyLmFkZF9leHByZXNzaW9uKHggYEBkZWJ1Zygke2ZpbGVuYW1lID8geCBgXCIke2ZpbGVuYW1lfVwiYCA6IHggYG51bGxgfSwgJHtsaW5lIC0gMX0sICR7Y29sdW1ufSwgJHtvYmp9KWApO1xufVxuXG5mdW5jdGlvbiBFYWNoQmxvY2skMSAobm9kZSwgcmVuZGVyZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBhcmdzID0gW25vZGUuY29udGV4dF9ub2RlXTtcbiAgICBpZiAobm9kZS5pbmRleClcbiAgICAgICAgYXJncy5wdXNoKHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiBub2RlLmluZGV4IH0pO1xuICAgIHJlbmRlcmVyLnB1c2goKTtcbiAgICByZW5kZXJlci5yZW5kZXIobm9kZS5jaGlsZHJlbiwgb3B0aW9ucyk7XG4gICAgY29uc3QgcmVzdWx0ID0gcmVuZGVyZXIucG9wKCk7XG4gICAgY29uc3QgY29uc2VxdWVudCA9IHggYEBlYWNoKCR7bm9kZS5leHByZXNzaW9uLm5vZGV9LCAoJHthcmdzfSkgPT4geyAke2dldF9jb25zdF90YWdzJDEobm9kZS5jb25zdF90YWdzKX07IHJldHVybiAke3Jlc3VsdH0gfSlgO1xuICAgIGlmIChub2RlLmVsc2UpIHtcbiAgICAgICAgcmVuZGVyZXIucHVzaCgpO1xuICAgICAgICByZW5kZXJlci5yZW5kZXIobm9kZS5lbHNlLmNoaWxkcmVuLCBvcHRpb25zKTtcbiAgICAgICAgY29uc3QgYWx0ZXJuYXRlID0gcmVuZGVyZXIucG9wKCk7XG4gICAgICAgIHJlbmRlcmVyLmFkZF9leHByZXNzaW9uKHggYCR7bm9kZS5leHByZXNzaW9uLm5vZGV9Lmxlbmd0aCA/ICR7Y29uc2VxdWVudH0gOiAke2FsdGVybmF0ZX1gKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlbmRlcmVyLmFkZF9leHByZXNzaW9uKGNvbnNlcXVlbnQpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0X2NsYXNzX2F0dHJpYnV0ZV92YWx1ZShhdHRyaWJ1dGUpIHtcbiAgICAvLyBoYW5kbGUgc3BlY2lhbCBjYXNlIOKAlCBgY2xhc3M9e3Bvc3NpYmx5VW5kZWZpbmVkfWAgd2l0aCBzY29wZWQgQ1NTXG4gICAgaWYgKGF0dHJpYnV0ZS5jaHVua3MubGVuZ3RoID09PSAyICYmIGF0dHJpYnV0ZS5jaHVua3NbMV0uc3ludGhldGljKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gYXR0cmlidXRlLmNodW5rc1swXS5ub2RlO1xuICAgICAgICByZXR1cm4geCBgQGVzY2FwZShAbnVsbF90b19lbXB0eSgke3ZhbHVlfSkpICsgXCIke2F0dHJpYnV0ZS5jaHVua3NbMV0uZGF0YX1cImA7XG4gICAgfVxuICAgIHJldHVybiBnZXRfYXR0cmlidXRlX3ZhbHVlKGF0dHJpYnV0ZSk7XG59XG5mdW5jdGlvbiBnZXRfYXR0cmlidXRlX3ZhbHVlKGF0dHJpYnV0ZSkge1xuICAgIGlmIChhdHRyaWJ1dGUuY2h1bmtzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuIHggYFwiXCJgO1xuICAgIHJldHVybiBhdHRyaWJ1dGUuY2h1bmtzXG4gICAgICAgIC5tYXAoKGNodW5rKSA9PiB7XG4gICAgICAgIHJldHVybiBjaHVuay50eXBlID09PSAnVGV4dCdcbiAgICAgICAgICAgID8gc3RyaW5nX2xpdGVyYWwoY2h1bmsuZGF0YS5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7JykpXG4gICAgICAgICAgICA6IHggYEBlc2NhcGUoJHtjaHVuay5ub2RlfSlgO1xuICAgIH0pXG4gICAgICAgIC5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30gKyAke3Joc31gKTtcbn1cbmZ1bmN0aW9uIGdldF9hdHRyaWJ1dGVfZXhwcmVzc2lvbihhdHRyaWJ1dGUpIHtcbiAgICBpZiAoYXR0cmlidXRlLmNodW5rcy5sZW5ndGggPT09IDEgJiYgYXR0cmlidXRlLmNodW5rc1swXS50eXBlID09PSAnRXhwcmVzc2lvbicpIHtcbiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5jaHVua3NbMF0ubm9kZTtcbiAgICB9XG4gICAgcmV0dXJuIGdldF9hdHRyaWJ1dGVfdmFsdWUoYXR0cmlidXRlKTtcbn1cblxuLy8gc291cmNlOiBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9pbmRpY2VzLmh0bWxcbmNvbnN0IGJvb2xlYW5fYXR0cmlidXRlcyA9IG5ldyBTZXQoW1xuICAgICdhbGxvd2Z1bGxzY3JlZW4nLFxuICAgICdhbGxvd3BheW1lbnRyZXF1ZXN0JyxcbiAgICAnYXN5bmMnLFxuICAgICdhdXRvZm9jdXMnLFxuICAgICdhdXRvcGxheScsXG4gICAgJ2NoZWNrZWQnLFxuICAgICdjb250cm9scycsXG4gICAgJ2RlZmF1bHQnLFxuICAgICdkZWZlcicsXG4gICAgJ2Rpc2FibGVkJyxcbiAgICAnZm9ybW5vdmFsaWRhdGUnLFxuICAgICdoaWRkZW4nLFxuICAgICdpc21hcCcsXG4gICAgJ2xvb3AnLFxuICAgICdtdWx0aXBsZScsXG4gICAgJ211dGVkJyxcbiAgICAnbm9tb2R1bGUnLFxuICAgICdub3ZhbGlkYXRlJyxcbiAgICAnb3BlbicsXG4gICAgJ3BsYXlzaW5saW5lJyxcbiAgICAncmVhZG9ubHknLFxuICAgICdyZXF1aXJlZCcsXG4gICAgJ3JldmVyc2VkJyxcbiAgICAnc2VsZWN0ZWQnXG5dKTtcblxuLy8gc2ltaWxhciBsb2dpYyBmcm9tIGBjb21waWxlL3JlbmRlcl9kb20vd3JhcHBlcnMvRnJhZ21lbnRgXG4vLyBXZSB3YW50IHRvIHJlbW92ZSB0cmFpbGluZyB3aGl0ZXNwYWNlIGluc2lkZSBhbiBlbGVtZW50L2NvbXBvbmVudC9ibG9jayxcbi8vICp1bmxlc3MqIHRoZXJlIGlzIG5vIHdoaXRlc3BhY2UgYmV0d2VlbiB0aGlzIG5vZGUgYW5kIGl0cyBuZXh0IHNpYmxpbmdcbmZ1bmN0aW9uIHJlbW92ZV93aGl0ZXNwYWNlX2NoaWxkcmVuKGNoaWxkcmVuLCBuZXh0KSB7XG4gICAgY29uc3Qgbm9kZXMgPSBbXTtcbiAgICBsZXQgbGFzdF9jaGlsZDtcbiAgICBsZXQgaSA9IGNoaWxkcmVuLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07XG4gICAgICAgIGlmIChjaGlsZC50eXBlID09PSAnVGV4dCcpIHtcbiAgICAgICAgICAgIGlmIChjaGlsZC5zaG91bGRfc2tpcCgpKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgeyBkYXRhIH0gPSBjaGlsZDtcbiAgICAgICAgICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzaG91bGRfdHJpbSA9IG5leHRcbiAgICAgICAgICAgICAgICAgICAgPyBuZXh0LnR5cGUgPT09ICdUZXh0JyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgL15cXHMvLnRlc3QobmV4dC5kYXRhKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1hYmxlX2F0JDEoY2hpbGQsIG5leHQpXG4gICAgICAgICAgICAgICAgICAgIDogIWNoaWxkLmhhc19hbmNlc3RvcignRWFjaEJsb2NrJyk7XG4gICAgICAgICAgICAgICAgaWYgKHNob3VsZF90cmltKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSB0cmltX2VuZChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhKVxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZ2x1ZSB0ZXh0IG5vZGVzICh3aGljaCBjb3VsZCBlLmcuIGJlIHNlcGFyYXRlZCBieSBjb21tZW50cykgdG9nZXRoZXJcbiAgICAgICAgICAgIGlmIChsYXN0X2NoaWxkICYmIGxhc3RfY2hpbGQudHlwZSA9PT0gJ1RleHQnKSB7XG4gICAgICAgICAgICAgICAgbGFzdF9jaGlsZC5kYXRhID0gZGF0YSArIGxhc3RfY2hpbGQuZGF0YTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5vZGVzLnVuc2hpZnQoY2hpbGQpO1xuICAgICAgICAgICAgbGluayhsYXN0X2NoaWxkLCBsYXN0X2NoaWxkID0gY2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbm9kZXMudW5zaGlmdChjaGlsZCk7XG4gICAgICAgICAgICBsaW5rKGxhc3RfY2hpbGQsIGxhc3RfY2hpbGQgPSBjaGlsZCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgZmlyc3QgPSBub2Rlc1swXTtcbiAgICBpZiAoZmlyc3QgJiYgZmlyc3QudHlwZSA9PT0gJ1RleHQnKSB7XG4gICAgICAgIGZpcnN0LmRhdGEgPSB0cmltX3N0YXJ0KGZpcnN0LmRhdGEpO1xuICAgICAgICBpZiAoIWZpcnN0LmRhdGEpIHtcbiAgICAgICAgICAgIGZpcnN0LnZhciA9IG51bGw7XG4gICAgICAgICAgICBub2Rlcy5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKG5vZGVzWzBdKSB7XG4gICAgICAgICAgICAgICAgbm9kZXNbMF0ucHJldiA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5vZGVzO1xufVxuZnVuY3Rpb24gdHJpbW1hYmxlX2F0JDEoY2hpbGQsIG5leHRfc2libGluZykge1xuICAgIC8vIFdoaXRlc3BhY2UgaXMgdHJpbW1hYmxlIGlmIG9uZSBvZiB0aGUgZm9sbG93aW5nIGlzIHRydWU6XG4gICAgLy8gVGhlIGNoaWxkIGFuZCBpdHMgc2libGluZyBzaGFyZSBhIGNvbW1vbiBuZWFyZXN0IGVhY2ggYmxvY2sgKG5vdCBhdCBhbiBlYWNoIGJsb2NrIGJvdW5kYXJ5KVxuICAgIC8vIFRoZSBuZXh0IHNpYmxpbmcncyBwcmV2aW91cyBub2RlIGlzIGFuIGVhY2ggYmxvY2tcbiAgICByZXR1cm4gKG5leHRfc2libGluZy5maW5kX25lYXJlc3QoL0VhY2hCbG9jay8pID09PVxuICAgICAgICBjaGlsZC5maW5kX25lYXJlc3QoL0VhY2hCbG9jay8pIHx8IG5leHRfc2libGluZy5wcmV2LnR5cGUgPT09ICdFYWNoQmxvY2snKTtcbn1cblxuZnVuY3Rpb24gRWxlbWVudCQxIChub2RlLCByZW5kZXJlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IGNoaWxkcmVuID0gcmVtb3ZlX3doaXRlc3BhY2VfY2hpbGRyZW4obm9kZS5jaGlsZHJlbiwgbm9kZS5uZXh0KTtcbiAgICAvLyBhd2t3YXJkIHNwZWNpYWwgY2FzZVxuICAgIGxldCBub2RlX2NvbnRlbnRzO1xuICAgIGNvbnN0IGNvbnRlbnRlZGl0YWJsZSA9IChub2RlLm5hbWUgIT09ICd0ZXh0YXJlYScgJiZcbiAgICAgICAgbm9kZS5uYW1lICE9PSAnaW5wdXQnICYmXG4gICAgICAgIG5vZGUuYXR0cmlidXRlcy5zb21lKChhdHRyaWJ1dGUpID0+IGF0dHJpYnV0ZS5uYW1lID09PSAnY29udGVudGVkaXRhYmxlJykpO1xuICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcoYDwke25vZGUubmFtZX1gKTtcbiAgICBjb25zdCBjbGFzc19leHByZXNzaW9uX2xpc3QgPSBub2RlLmNsYXNzZXMubWFwKGNsYXNzX2RpcmVjdGl2ZSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZXhwcmVzc2lvbiwgbmFtZSB9ID0gY2xhc3NfZGlyZWN0aXZlO1xuICAgICAgICBjb25zdCBzbmlwcGV0ID0gZXhwcmVzc2lvbiA/IGV4cHJlc3Npb24ubm9kZSA6IHggYCNjdHguJHtuYW1lfWA7IC8vIFRPRE8gaXMgdGhpcyByaWdodD9cbiAgICAgICAgcmV0dXJuIHggYCR7c25pcHBldH0gPyBcIiR7bmFtZX1cIiA6IFwiXCJgO1xuICAgIH0pO1xuICAgIGlmIChub2RlLm5lZWRzX21hbnVhbF9zdHlsZV9zY29waW5nKSB7XG4gICAgICAgIGNsYXNzX2V4cHJlc3Npb25fbGlzdC5wdXNoKHggYFwiJHtub2RlLmNvbXBvbmVudC5zdHlsZXNoZWV0LmlkfVwiYCk7XG4gICAgfVxuICAgIGNvbnN0IGNsYXNzX2V4cHJlc3Npb24gPSBjbGFzc19leHByZXNzaW9uX2xpc3QubGVuZ3RoID4gMCAmJlxuICAgICAgICBjbGFzc19leHByZXNzaW9uX2xpc3QucmVkdWNlKChsaHMsIHJocykgPT4geCBgJHtsaHN9ICsgJyAnICsgJHtyaHN9YCk7XG4gICAgY29uc3Qgc3R5bGVfZXhwcmVzc2lvbl9saXN0ID0gbm9kZS5zdHlsZXMubWFwKHN0eWxlX2RpcmVjdGl2ZSA9PiB7XG4gICAgICAgIGNvbnN0IHsgbmFtZSwgZXhwcmVzc2lvbjogeyBub2RlOiBleHByZXNzaW9uIH0gfSA9IHN0eWxlX2RpcmVjdGl2ZTtcbiAgICAgICAgcmV0dXJuIHAgYFwiJHtuYW1lfVwiOiAke2V4cHJlc3Npb259YDtcbiAgICB9KTtcbiAgICBjb25zdCBzdHlsZV9leHByZXNzaW9uID0gc3R5bGVfZXhwcmVzc2lvbl9saXN0Lmxlbmd0aCA+IDAgJiZcbiAgICAgICAgeCBgeyAke3N0eWxlX2V4cHJlc3Npb25fbGlzdH0gfWA7XG4gICAgaWYgKG5vZGUuYXR0cmlidXRlcy5zb21lKGF0dHIgPT4gYXR0ci5pc19zcHJlYWQpKSB7XG4gICAgICAgIC8vIFRPRE8gZHJ5IHRoaXMgb3V0XG4gICAgICAgIGNvbnN0IGFyZ3MgPSBbXTtcbiAgICAgICAgbm9kZS5hdHRyaWJ1dGVzLmZvckVhY2goYXR0cmlidXRlID0+IHtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUuaXNfc3ByZWFkKSB7XG4gICAgICAgICAgICAgICAgYXJncy5wdXNoKHggYEBlc2NhcGVfb2JqZWN0KCR7YXR0cmlidXRlLmV4cHJlc3Npb24ubm9kZX0pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhdHRyX25hbWUgPSBub2RlLm5hbWVzcGFjZSA9PT0gbmFtZXNwYWNlcy5mb3JlaWduID8gYXR0cmlidXRlLm5hbWUgOiBmaXhfYXR0cmlidXRlX2Nhc2luZyhhdHRyaWJ1dGUubmFtZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGF0dHJpYnV0ZS5uYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09ICd2YWx1ZScgJiYgbm9kZS5uYW1lLnRvTG93ZXJDYXNlKCkgPT09ICd0ZXh0YXJlYScpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZV9jb250ZW50cyA9IGdldF9hdHRyaWJ1dGVfdmFsdWUoYXR0cmlidXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYXR0cmlidXRlLmlzX3RydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHggYHsgJHthdHRyX25hbWV9OiB0cnVlIH1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYm9vbGVhbl9hdHRyaWJ1dGVzLmhhcyhuYW1lKSAmJlxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUuY2h1bmtzLmxlbmd0aCA9PT0gMSAmJlxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUuY2h1bmtzWzBdLnR5cGUgIT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgICAgICAvLyBhIGJvb2xlYW4gYXR0cmlidXRlIHdpdGggb25lIG5vbi1UZXh0IGNodW5rXG4gICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh4IGB7ICR7YXR0cl9uYW1lfTogJHthdHRyaWJ1dGUuY2h1bmtzWzBdLm5vZGV9IHx8IG51bGwgfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChhdHRyaWJ1dGUuY2h1bmtzLmxlbmd0aCA9PT0gMSAmJiBhdHRyaWJ1dGUuY2h1bmtzWzBdLnR5cGUgIT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzbmlwcGV0ID0gYXR0cmlidXRlLmNodW5rc1swXS5ub2RlO1xuICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goeCBgeyAke2F0dHJfbmFtZX06IEBlc2NhcGVfYXR0cmlidXRlX3ZhbHVlKCR7c25pcHBldH0pIH1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh4IGB7ICR7YXR0cl9uYW1lfTogJHtnZXRfYXR0cmlidXRlX3ZhbHVlKGF0dHJpYnV0ZSl9IH1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZW5kZXJlci5hZGRfZXhwcmVzc2lvbih4IGBAc3ByZWFkKFske2FyZ3N9XSwgeyBjbGFzc2VzOiAke2NsYXNzX2V4cHJlc3Npb259LCBzdHlsZXM6ICR7c3R5bGVfZXhwcmVzc2lvbn0gfSlgKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBhZGRfY2xhc3NfYXR0cmlidXRlID0gISFjbGFzc19leHByZXNzaW9uO1xuICAgICAgICBsZXQgYWRkX3N0eWxlX2F0dHJpYnV0ZSA9ICEhc3R5bGVfZXhwcmVzc2lvbjtcbiAgICAgICAgbm9kZS5hdHRyaWJ1dGVzLmZvckVhY2goYXR0cmlidXRlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBhdHRyaWJ1dGUubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgY29uc3QgYXR0cl9uYW1lID0gbm9kZS5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZXMuZm9yZWlnbiA/IGF0dHJpYnV0ZS5uYW1lIDogZml4X2F0dHJpYnV0ZV9jYXNpbmcoYXR0cmlidXRlLm5hbWUpO1xuICAgICAgICAgICAgaWYgKG5hbWUgPT09ICd2YWx1ZScgJiYgbm9kZS5uYW1lLnRvTG93ZXJDYXNlKCkgPT09ICd0ZXh0YXJlYScpIHtcbiAgICAgICAgICAgICAgICBub2RlX2NvbnRlbnRzID0gZ2V0X2F0dHJpYnV0ZV92YWx1ZShhdHRyaWJ1dGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYXR0cmlidXRlLmlzX3RydWUpIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5hZGRfc3RyaW5nKGAgJHthdHRyX25hbWV9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChib29sZWFuX2F0dHJpYnV0ZXMuaGFzKG5hbWUpICYmXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlLmNodW5rcy5sZW5ndGggPT09IDEgJiZcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGUuY2h1bmtzWzBdLnR5cGUgIT09ICdUZXh0Jykge1xuICAgICAgICAgICAgICAgIC8vIGEgYm9vbGVhbiBhdHRyaWJ1dGUgd2l0aCBvbmUgbm9uLVRleHQgY2h1bmtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5hZGRfc3RyaW5nKCcgJyk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuYWRkX2V4cHJlc3Npb24oeCBgJHthdHRyaWJ1dGUuY2h1bmtzWzBdLm5vZGV9ID8gXCIke2F0dHJfbmFtZX1cIiA6IFwiXCJgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5hbWUgPT09ICdjbGFzcycgJiYgY2xhc3NfZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgICAgIGFkZF9jbGFzc19hdHRyaWJ1dGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5hZGRfc3RyaW5nKGAgJHthdHRyX25hbWV9PVwiYCk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuYWRkX2V4cHJlc3Npb24oeCBgWyR7Z2V0X2NsYXNzX2F0dHJpYnV0ZV92YWx1ZShhdHRyaWJ1dGUpfSwgJHtjbGFzc19leHByZXNzaW9ufV0uam9pbignICcpLnRyaW0oKWApO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcoJ1wiJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChuYW1lID09PSAnc3R5bGUnICYmIHN0eWxlX2V4cHJlc3Npb24pIHtcbiAgICAgICAgICAgICAgICBhZGRfc3R5bGVfYXR0cmlidXRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuYWRkX2V4cHJlc3Npb24oeCBgQGFkZF9zdHlsZXMoQG1lcmdlX3Nzcl9zdHlsZXMoJHtnZXRfYXR0cmlidXRlX3ZhbHVlKGF0dHJpYnV0ZSl9LCAke3N0eWxlX2V4cHJlc3Npb259KSlgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGF0dHJpYnV0ZS5jaHVua3MubGVuZ3RoID09PSAxICYmIGF0dHJpYnV0ZS5jaHVua3NbMF0udHlwZSAhPT0gJ1RleHQnKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc25pcHBldCA9IGF0dHJpYnV0ZS5jaHVua3NbMF0ubm9kZTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5hZGRfZXhwcmVzc2lvbih4IGBAYWRkX2F0dHJpYnV0ZShcIiR7YXR0cl9uYW1lfVwiLCAke3NuaXBwZXR9LCAke2Jvb2xlYW5fYXR0cmlidXRlcy5oYXMobmFtZSkgPyAxIDogMH0pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5hZGRfc3RyaW5nKGAgJHthdHRyX25hbWV9PVwiYCk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuYWRkX2V4cHJlc3Npb24oKG5hbWUgPT09ICdjbGFzcycgPyBnZXRfY2xhc3NfYXR0cmlidXRlX3ZhbHVlIDogZ2V0X2F0dHJpYnV0ZV92YWx1ZSkoYXR0cmlidXRlKSk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuYWRkX3N0cmluZygnXCInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChhZGRfY2xhc3NfYXR0cmlidXRlKSB7XG4gICAgICAgICAgICByZW5kZXJlci5hZGRfZXhwcmVzc2lvbih4IGBAYWRkX2NsYXNzZXMoKCR7Y2xhc3NfZXhwcmVzc2lvbn0pLnRyaW0oKSlgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWRkX3N0eWxlX2F0dHJpYnV0ZSkge1xuICAgICAgICAgICAgcmVuZGVyZXIuYWRkX2V4cHJlc3Npb24oeCBgQGFkZF9zdHlsZXMoJHtzdHlsZV9leHByZXNzaW9ufSlgKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBub2RlLmJpbmRpbmdzLmZvckVhY2goYmluZGluZyA9PiB7XG4gICAgICAgIGNvbnN0IHsgbmFtZSwgZXhwcmVzc2lvbiB9ID0gYmluZGluZztcbiAgICAgICAgaWYgKGJpbmRpbmcuaXNfcmVhZG9ubHkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmFtZSA9PT0gJ2dyb3VwJykge1xuICAgICAgICAgICAgY29uc3QgdmFsdWVfYXR0cmlidXRlID0gbm9kZS5hdHRyaWJ1dGVzLmZpbmQoKHsgbmFtZSB9KSA9PiBuYW1lID09PSAndmFsdWUnKTtcbiAgICAgICAgICAgIGlmICh2YWx1ZV9hdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGdldF9hdHRyaWJ1dGVfZXhwcmVzc2lvbih2YWx1ZV9hdHRyaWJ1dGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBub2RlLmdldF9zdGF0aWNfYXR0cmlidXRlX3ZhbHVlKCd0eXBlJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgYm91bmQgPSBleHByZXNzaW9uLm5vZGU7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uID0gdHlwZSA9PT0gJ2NoZWNrYm94JyA/IHggYH4ke2JvdW5kfS5pbmRleE9mKCR7dmFsdWV9KWAgOiB4IGAke3ZhbHVlfSA9PT0gJHtib3VuZH1gO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmFkZF9leHByZXNzaW9uKHggYCR7Y29uZGl0aW9ufSA/IEBhZGRfYXR0cmlidXRlKFwiY2hlY2tlZFwiLCB0cnVlLCAxKSA6IFwiXCJgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb250ZW50ZWRpdGFibGUgJiYgKG5hbWUgPT09ICd0ZXh0Q29udGVudCcgfHwgbmFtZSA9PT0gJ2lubmVySFRNTCcpKSB7XG4gICAgICAgICAgICBub2RlX2NvbnRlbnRzID0gZXhwcmVzc2lvbi5ub2RlO1xuICAgICAgICAgICAgLy8gVE9ETyB3aGVyZSB3YXMgdGhpcyB1c2VkP1xuICAgICAgICAgICAgLy8gdmFsdWUgPSBuYW1lID09PSAndGV4dENvbnRlbnQnID8geGBAZXNjYXBlKCQkdmFsdWUpYCA6IHhgJCR2YWx1ZWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYmluZGluZy5uYW1lID09PSAndmFsdWUnICYmIG5vZGUubmFtZSA9PT0gJ3RleHRhcmVhJykge1xuICAgICAgICAgICAgY29uc3Qgc25pcHBldCA9IGV4cHJlc3Npb24ubm9kZTtcbiAgICAgICAgICAgIG5vZGVfY29udGVudHMgPSB4IGAke3NuaXBwZXR9IHx8IFwiXCJgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGJpbmRpbmcubmFtZSA9PT0gJ3ZhbHVlJyAmJiBub2RlLm5hbWUgPT09ICdzZWxlY3QnKSA7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgc25pcHBldCA9IGV4cHJlc3Npb24ubm9kZTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmFkZF9leHByZXNzaW9uKHggYEBhZGRfYXR0cmlidXRlKFwiJHtuYW1lfVwiLCAke3NuaXBwZXR9LCAke2Jvb2xlYW5fYXR0cmlidXRlcy5oYXMobmFtZSkgPyAxIDogMH0pYCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAob3B0aW9ucy5oeWRyYXRhYmxlICYmIG9wdGlvbnMuaGVhZF9pZCkge1xuICAgICAgICByZW5kZXJlci5hZGRfc3RyaW5nKGAgZGF0YS1zdmVsdGU9XCIke29wdGlvbnMuaGVhZF9pZH1cImApO1xuICAgIH1cbiAgICByZW5kZXJlci5hZGRfc3RyaW5nKCc+Jyk7XG4gICAgaWYgKG5vZGVfY29udGVudHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY29udGVudGVkaXRhYmxlKSB7XG4gICAgICAgICAgICByZW5kZXJlci5wdXNoKCk7XG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIoY2hpbGRyZW4sIG9wdGlvbnMpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVuZGVyZXIucG9wKCk7XG4gICAgICAgICAgICByZW5kZXJlci5hZGRfZXhwcmVzc2lvbih4IGAoJCR2YWx1ZSA9PiAkJHZhbHVlID09PSB2b2lkIDAgPyAke3Jlc3VsdH0gOiAkJHZhbHVlKSgke25vZGVfY29udGVudHN9KWApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVuZGVyZXIuYWRkX2V4cHJlc3Npb24obm9kZV9jb250ZW50cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc192b2lkKG5vZGUubmFtZSkpIHtcbiAgICAgICAgICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcoYDwvJHtub2RlLm5hbWV9PmApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZW5kZXJlci5yZW5kZXIoY2hpbGRyZW4sIG9wdGlvbnMpO1xuICAgICAgICBpZiAoIWlzX3ZvaWQobm9kZS5uYW1lKSkge1xuICAgICAgICAgICAgcmVuZGVyZXIuYWRkX3N0cmluZyhgPC8ke25vZGUubmFtZX0+YCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIEhlYWQkMSAobm9kZSwgcmVuZGVyZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBoZWFkX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpLCB7IGhlYWRfaWQ6IG5vZGUuaWQgfSk7XG4gICAgcmVuZGVyZXIucHVzaCgpO1xuICAgIHJlbmRlcmVyLnJlbmRlcihub2RlLmNoaWxkcmVuLCBoZWFkX29wdGlvbnMpO1xuICAgIGNvbnN0IHJlc3VsdCA9IHJlbmRlcmVyLnBvcCgpO1xuICAgIHJlbmRlcmVyLmFkZF9leHByZXNzaW9uKHggYCQkcmVzdWx0LmhlYWQgKz0gJHtyZXN1bHR9LCBcIlwiYCk7XG59XG5cbmZ1bmN0aW9uIEh0bWxUYWcgKG5vZGUsIHJlbmRlcmVyLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMuaHlkcmF0YWJsZSlcbiAgICAgICAgcmVuZGVyZXIuYWRkX3N0cmluZygnPCEtLSBIVE1MX1RBR19TVEFSVCAtLT4nKTtcbiAgICByZW5kZXJlci5hZGRfZXhwcmVzc2lvbihub2RlLmV4cHJlc3Npb24ubm9kZSk7XG4gICAgaWYgKG9wdGlvbnMuaHlkcmF0YWJsZSlcbiAgICAgICAgcmVuZGVyZXIuYWRkX3N0cmluZygnPCEtLSBIVE1MX1RBR19FTkQgLS0+Jyk7XG59XG5cbmZ1bmN0aW9uIElmQmxvY2skMSAobm9kZSwgcmVuZGVyZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBjb25kaXRpb24gPSBub2RlLmV4cHJlc3Npb24ubm9kZTtcbiAgICByZW5kZXJlci5wdXNoKCk7XG4gICAgcmVuZGVyZXIucmVuZGVyKG5vZGUuY2hpbGRyZW4sIG9wdGlvbnMpO1xuICAgIGNvbnN0IGNvbnNlcXVlbnQgPSByZW5kZXJlci5wb3AoKTtcbiAgICByZW5kZXJlci5wdXNoKCk7XG4gICAgaWYgKG5vZGUuZWxzZSlcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyKG5vZGUuZWxzZS5jaGlsZHJlbiwgb3B0aW9ucyk7XG4gICAgY29uc3QgYWx0ZXJuYXRlID0gcmVuZGVyZXIucG9wKCk7XG4gICAgcmVuZGVyZXIuYWRkX2V4cHJlc3Npb24oeCBgJHtjb25kaXRpb259ID8gJHtjb25zZXF1ZW50fSA6ICR7YWx0ZXJuYXRlfWApO1xufVxuXG5mdW5jdGlvbiBnZXRfcHJvcF92YWx1ZShhdHRyaWJ1dGUpIHtcbiAgICBpZiAoYXR0cmlidXRlLmlzX3RydWUpXG4gICAgICAgIHJldHVybiB4IGB0cnVlYDtcbiAgICBpZiAoYXR0cmlidXRlLmNodW5rcy5sZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybiB4IGAnJ2A7XG4gICAgcmV0dXJuIGF0dHJpYnV0ZS5jaHVua3NcbiAgICAgICAgLm1hcChjaHVuayA9PiB7XG4gICAgICAgIGlmIChjaHVuay50eXBlID09PSAnVGV4dCcpXG4gICAgICAgICAgICByZXR1cm4gc3RyaW5nX2xpdGVyYWwoY2h1bmsuZGF0YSk7XG4gICAgICAgIHJldHVybiBjaHVuay5ub2RlO1xuICAgIH0pXG4gICAgICAgIC5yZWR1Y2UoKGxocywgcmhzKSA9PiB4IGAke2xoc30gKyAke3Joc31gKTtcbn1cbmZ1bmN0aW9uIElubGluZUNvbXBvbmVudCQxIChub2RlLCByZW5kZXJlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IGJpbmRpbmdfcHJvcHMgPSBbXTtcbiAgICBjb25zdCBiaW5kaW5nX2ZucyA9IFtdO1xuICAgIG5vZGUuYmluZGluZ3MuZm9yRWFjaChiaW5kaW5nID0+IHtcbiAgICAgICAgcmVuZGVyZXIuaGFzX2JpbmRpbmdzID0gdHJ1ZTtcbiAgICAgICAgLy8gVE9ETyB0aGlzIHByb2JhYmx5IHdvbid0IHdvcmsgZm9yIGNvbnRleHR1YWwgYmluZGluZ3NcbiAgICAgICAgY29uc3Qgc25pcHBldCA9IGJpbmRpbmcuZXhwcmVzc2lvbi5ub2RlO1xuICAgICAgICBiaW5kaW5nX3Byb3BzLnB1c2gocCBgJHtiaW5kaW5nLm5hbWV9OiAke3NuaXBwZXR9YCk7XG4gICAgICAgIGJpbmRpbmdfZm5zLnB1c2gocCBgJHtiaW5kaW5nLm5hbWV9OiAkJHZhbHVlID0+IHsgJHtzbmlwcGV0fSA9ICQkdmFsdWU7ICQkc2V0dGxlZCA9IGZhbHNlIH1gKTtcbiAgICB9KTtcbiAgICBjb25zdCB1c2VzX3NwcmVhZCA9IG5vZGUuYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5pc19zcHJlYWQpO1xuICAgIGxldCBwcm9wcztcbiAgICBpZiAodXNlc19zcHJlYWQpIHtcbiAgICAgICAgcHJvcHMgPSB4IGBAX09iamVjdC5hc3NpZ24oJHtub2RlLmF0dHJpYnV0ZXNcbiAgICAgICAgICAgIC5tYXAoYXR0cmlidXRlID0+IHtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUuaXNfc3ByZWFkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5leHByZXNzaW9uLm5vZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geCBgeyAke2F0dHJpYnV0ZS5uYW1lfTogJHtnZXRfcHJvcF92YWx1ZShhdHRyaWJ1dGUpfSB9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jb25jYXQoYmluZGluZ19wcm9wcy5tYXAocCA9PiB4IGB7ICR7cH0gfWApKX0pYDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHByb3BzID0geCBge1xuXHRcdFx0JHtub2RlLmF0dHJpYnV0ZXMubWFwKGF0dHJpYnV0ZSA9PiBwIGAke2F0dHJpYnV0ZS5uYW1lfTogJHtnZXRfcHJvcF92YWx1ZShhdHRyaWJ1dGUpfWApfSxcblx0XHRcdCR7YmluZGluZ19wcm9wc31cblx0XHR9YDtcbiAgICB9XG4gICAgY29uc3QgYmluZGluZ3MgPSB4IGB7XG5cdFx0JHtiaW5kaW5nX2Zuc31cblx0fWA7XG4gICAgY29uc3QgZXhwcmVzc2lvbiA9IChub2RlLm5hbWUgPT09ICdzdmVsdGU6c2VsZidcbiAgICAgICAgPyByZW5kZXJlci5uYW1lXG4gICAgICAgIDogbm9kZS5uYW1lID09PSAnc3ZlbHRlOmNvbXBvbmVudCdcbiAgICAgICAgICAgID8geCBgKCR7bm9kZS5leHByZXNzaW9uLm5vZGV9KSB8fCBAbWlzc2luZ19jb21wb25lbnRgXG4gICAgICAgICAgICA6IG5vZGUubmFtZS5zcGxpdCgnLicpLnJlZHVjZSgoKGxocywgcmhzKSA9PiB4IGAke2xoc30uJHtyaHN9YCkpKTtcbiAgICBjb25zdCBzbG90X2ZucyA9IFtdO1xuICAgIGNvbnN0IGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjtcbiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IHNsb3Rfc2NvcGVzID0gbmV3IE1hcCgpO1xuICAgICAgICByZW5kZXJlci5yZW5kZXIoY2hpbGRyZW4sIE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMsIHtcbiAgICAgICAgICAgIHNsb3Rfc2NvcGVzXG4gICAgICAgIH0pKTtcbiAgICAgICAgc2xvdF9zY29wZXMuZm9yRWFjaCgoeyBpbnB1dCwgb3V0cHV0LCBzdGF0ZW1lbnRzIH0sIG5hbWUpID0+IHtcbiAgICAgICAgICAgIHNsb3RfZm5zLnB1c2gocCBgJHtuYW1lfTogKCR7aW5wdXR9KSA9PiB7ICR7c3RhdGVtZW50c307IHJldHVybiAke291dHB1dH07IH1gKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHNsb3RzID0geCBge1xuXHRcdCR7c2xvdF9mbnN9XG5cdH1gO1xuICAgIGlmIChub2RlLmNzc19jdXN0b21fcHJvcGVydGllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcoJzxkaXYgc3R5bGU9XCJkaXNwbGF5OiBjb250ZW50czsnKTtcbiAgICAgICAgbm9kZS5jc3NfY3VzdG9tX3Byb3BlcnRpZXMuZm9yRWFjaChhdHRyID0+IHtcbiAgICAgICAgICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcoYCAke2F0dHIubmFtZX06YCk7XG4gICAgICAgICAgICByZW5kZXJlci5hZGRfZXhwcmVzc2lvbihnZXRfYXR0cmlidXRlX3ZhbHVlKGF0dHIpKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcoJzsnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcoJ1wiPicpO1xuICAgIH1cbiAgICByZW5kZXJlci5hZGRfZXhwcmVzc2lvbih4IGBAdmFsaWRhdGVfY29tcG9uZW50KCR7ZXhwcmVzc2lvbn0sIFwiJHtub2RlLm5hbWV9XCIpLiQkcmVuZGVyKCQkcmVzdWx0LCAke3Byb3BzfSwgJHtiaW5kaW5nc30sICR7c2xvdHN9KWApO1xuICAgIGlmIChub2RlLmNzc19jdXN0b21fcHJvcGVydGllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcoJzwvZGl2PicpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gS2V5QmxvY2skMSAobm9kZSwgcmVuZGVyZXIsIG9wdGlvbnMpIHtcbiAgICByZW5kZXJlci5yZW5kZXIobm9kZS5jaGlsZHJlbiwgb3B0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIGdldF9zbG90X3Njb3BlKGxldHMpIHtcbiAgICBpZiAobGV0cy5sZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdPYmplY3RQYXR0ZXJuJyxcbiAgICAgICAgcHJvcGVydGllczogbGV0cy5tYXAobCA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAga2luZDogJ2luaXQnLFxuICAgICAgICAgICAgICAgIG1ldGhvZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2hvcnRoYW5kOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAga2V5OiBsLm5hbWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IGwudmFsdWUgfHwgbC5uYW1lXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIFNsb3QkMSAobm9kZSwgcmVuZGVyZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBzbG90X2RhdGEgPSBnZXRfc2xvdF9kYXRhKG5vZGUudmFsdWVzKTtcbiAgICBjb25zdCBzbG90ID0gbm9kZS5nZXRfc3RhdGljX2F0dHJpYnV0ZV92YWx1ZSgnc2xvdCcpO1xuICAgIGNvbnN0IG5lYXJlc3RfaW5saW5lX2NvbXBvbmVudCA9IG5vZGUuZmluZF9uZWFyZXN0KC9JbmxpbmVDb21wb25lbnQvKTtcbiAgICBpZiAoc2xvdCAmJiBuZWFyZXN0X2lubGluZV9jb21wb25lbnQpIHtcbiAgICAgICAgcmVuZGVyZXIucHVzaCgpO1xuICAgIH1cbiAgICByZW5kZXJlci5wdXNoKCk7XG4gICAgcmVuZGVyZXIucmVuZGVyKG5vZGUuY2hpbGRyZW4sIG9wdGlvbnMpO1xuICAgIGNvbnN0IHJlc3VsdCA9IHJlbmRlcmVyLnBvcCgpO1xuICAgIHJlbmRlcmVyLmFkZF9leHByZXNzaW9uKHggYFxuXHRcdCNzbG90cy4ke25vZGUuc2xvdF9uYW1lfVxuXHRcdFx0PyAjc2xvdHMuJHtub2RlLnNsb3RfbmFtZX0oJHtzbG90X2RhdGF9KVxuXHRcdFx0OiAke3Jlc3VsdH1cblx0YCk7XG4gICAgaWYgKHNsb3QgJiYgbmVhcmVzdF9pbmxpbmVfY29tcG9uZW50KSB7XG4gICAgICAgIGNvbnN0IGxldHMgPSBub2RlLmxldHM7XG4gICAgICAgIGNvbnN0IHNlZW4gPSBuZXcgU2V0KGxldHMubWFwKGwgPT4gbC5uYW1lLm5hbWUpKTtcbiAgICAgICAgbmVhcmVzdF9pbmxpbmVfY29tcG9uZW50LmxldHMuZm9yRWFjaChsID0+IHtcbiAgICAgICAgICAgIGlmICghc2Vlbi5oYXMobC5uYW1lLm5hbWUpKVxuICAgICAgICAgICAgICAgIGxldHMucHVzaChsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIG9wdGlvbnMuc2xvdF9zY29wZXMuc2V0KHNsb3QsIHtcbiAgICAgICAgICAgIGlucHV0OiBnZXRfc2xvdF9zY29wZShub2RlLmxldHMpLFxuICAgICAgICAgICAgb3V0cHV0OiByZW5kZXJlci5wb3AoKVxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIFNsb3RUZW1wbGF0ZSQxIChub2RlLCByZW5kZXJlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IHBhcmVudF9pbmxpbmVfY29tcG9uZW50ID0gbm9kZS5wYXJlbnQ7XG4gICAgY29uc3QgY2hpbGRyZW4gPSByZW1vdmVfd2hpdGVzcGFjZV9jaGlsZHJlbihub2RlIGluc3RhbmNlb2YgU2xvdFRlbXBsYXRlID8gbm9kZS5jaGlsZHJlbiA6IFtub2RlXSwgbm9kZS5uZXh0KTtcbiAgICByZW5kZXJlci5wdXNoKCk7XG4gICAgcmVuZGVyZXIucmVuZGVyKGNoaWxkcmVuLCBvcHRpb25zKTtcbiAgICBjb25zdCBsZXRzID0gbm9kZS5sZXRzO1xuICAgIGNvbnN0IHNlZW4gPSBuZXcgU2V0KGxldHMubWFwKGwgPT4gbC5uYW1lLm5hbWUpKTtcbiAgICBwYXJlbnRfaW5saW5lX2NvbXBvbmVudC5sZXRzLmZvckVhY2gobCA9PiB7XG4gICAgICAgIGlmICghc2Vlbi5oYXMobC5uYW1lLm5hbWUpKVxuICAgICAgICAgICAgbGV0cy5wdXNoKGwpO1xuICAgIH0pO1xuICAgIGNvbnN0IHNsb3RfZnJhZ21lbnRfY29udGVudCA9IHJlbmRlcmVyLnBvcCgpO1xuICAgIGlmICghaXNfZW1wdHlfdGVtcGxhdGVfbGl0ZXJhbChzbG90X2ZyYWdtZW50X2NvbnRlbnQpKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnNsb3Rfc2NvcGVzLmhhcyhub2RlLnNsb3RfdGVtcGxhdGVfbmFtZSkpIHtcbiAgICAgICAgICAgIGlmIChub2RlLnNsb3RfdGVtcGxhdGVfbmFtZSA9PT0gJ2RlZmF1bHQnKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3VuZCBlbGVtZW50cyB3aXRob3V0IHNsb3QgYXR0cmlidXRlIHdoZW4gdXNpbmcgc2xvdD1cImRlZmF1bHRcIicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBEdXBsaWNhdGUgc2xvdCBuYW1lIFwiJHtub2RlLnNsb3RfdGVtcGxhdGVfbmFtZX1cIiBpbiA8JHtwYXJlbnRfaW5saW5lX2NvbXBvbmVudC5uYW1lfT5gKTtcbiAgICAgICAgfVxuICAgICAgICBvcHRpb25zLnNsb3Rfc2NvcGVzLnNldChub2RlLnNsb3RfdGVtcGxhdGVfbmFtZSwge1xuICAgICAgICAgICAgaW5wdXQ6IGdldF9zbG90X3Njb3BlKG5vZGUubGV0cyksXG4gICAgICAgICAgICBvdXRwdXQ6IHNsb3RfZnJhZ21lbnRfY29udGVudCxcbiAgICAgICAgICAgIHN0YXRlbWVudHM6IGdldF9jb25zdF90YWdzJDEobm9kZS5jb25zdF90YWdzKVxuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBpc19lbXB0eV90ZW1wbGF0ZV9saXRlcmFsKHRlbXBsYXRlX2xpdGVyYWwpIHtcbiAgICByZXR1cm4gKHRlbXBsYXRlX2xpdGVyYWwuZXhwcmVzc2lvbnMubGVuZ3RoID09PSAwICYmXG4gICAgICAgIHRlbXBsYXRlX2xpdGVyYWwucXVhc2lzLmxlbmd0aCA9PT0gMSAmJlxuICAgICAgICB0ZW1wbGF0ZV9saXRlcmFsLnF1YXNpc1swXS52YWx1ZS5yYXcgPT09ICcnKTtcbn1cblxuZnVuY3Rpb24gVGFnJDIgKG5vZGUsIHJlbmRlcmVyLCBfb3B0aW9ucykge1xuICAgIGNvbnN0IHNuaXBwZXQgPSBub2RlLmV4cHJlc3Npb24ubm9kZTtcbiAgICByZW5kZXJlci5hZGRfZXhwcmVzc2lvbihub2RlLnBhcmVudCAmJlxuICAgICAgICBub2RlLnBhcmVudC50eXBlID09PSAnRWxlbWVudCcgJiZcbiAgICAgICAgbm9kZS5wYXJlbnQubmFtZSA9PT0gJ3N0eWxlJ1xuICAgICAgICA/IHNuaXBwZXRcbiAgICAgICAgOiB4IGBAZXNjYXBlKCR7c25pcHBldH0pYCk7XG59XG5cbmZ1bmN0aW9uIFRleHQkMSAobm9kZSwgcmVuZGVyZXIsIF9vcHRpb25zKSB7XG4gICAgbGV0IHRleHQgPSBub2RlLmRhdGE7XG4gICAgaWYgKCFub2RlLnBhcmVudCB8fFxuICAgICAgICBub2RlLnBhcmVudC50eXBlICE9PSAnRWxlbWVudCcgfHxcbiAgICAgICAgKG5vZGUucGFyZW50Lm5hbWUgIT09ICdzY3JpcHQnICYmIG5vZGUucGFyZW50Lm5hbWUgIT09ICdzdHlsZScpKSB7XG4gICAgICAgIC8vIHVubGVzcyB0aGlzIFRleHQgbm9kZSBpcyBpbnNpZGUgYSA8c2NyaXB0PiBvciA8c3R5bGU+IGVsZW1lbnQsIGVzY2FwZSAmLDwsPlxuICAgICAgICB0ZXh0ID0gZXNjYXBlX2h0bWwodGV4dCk7XG4gICAgfVxuICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcodGV4dCk7XG59XG5cbmZ1bmN0aW9uIFRpdGxlJDEgKG5vZGUsIHJlbmRlcmVyLCBvcHRpb25zKSB7XG4gICAgcmVuZGVyZXIucHVzaCgpO1xuICAgIHJlbmRlcmVyLmFkZF9zdHJpbmcoJzx0aXRsZT4nKTtcbiAgICByZW5kZXJlci5yZW5kZXIobm9kZS5jaGlsZHJlbiwgb3B0aW9ucyk7XG4gICAgcmVuZGVyZXIuYWRkX3N0cmluZygnPC90aXRsZT4nKTtcbiAgICBjb25zdCByZXN1bHQgPSByZW5kZXJlci5wb3AoKTtcbiAgICByZW5kZXJlci5hZGRfZXhwcmVzc2lvbih4IGAkJHJlc3VsdC50aXRsZSA9ICR7cmVzdWx0fSwgXCJcImApO1xufVxuXG5mdW5jdGlvbiBub29wJDEoKSB7IH1cbmNvbnN0IGhhbmRsZXJzJDEgPSB7XG4gICAgQXdhaXRCbG9jazogQXdhaXRCbG9jayQxLFxuICAgIEJvZHk6IG5vb3AkMSxcbiAgICBDb21tZW50OiBDb21tZW50JDIsXG4gICAgRGVidWdUYWc6IERlYnVnVGFnJDEsXG4gICAgRWFjaEJsb2NrOiBFYWNoQmxvY2skMSxcbiAgICBFbGVtZW50OiBFbGVtZW50JDEsXG4gICAgSGVhZDogSGVhZCQxLFxuICAgIElmQmxvY2s6IElmQmxvY2skMSxcbiAgICBJbmxpbmVDb21wb25lbnQ6IElubGluZUNvbXBvbmVudCQxLFxuICAgIEtleUJsb2NrOiBLZXlCbG9jayQxLFxuICAgIE11c3RhY2hlVGFnOiBUYWckMixcbiAgICBPcHRpb25zOiBub29wJDEsXG4gICAgUmF3TXVzdGFjaGVUYWc6IEh0bWxUYWcsXG4gICAgU2xvdDogU2xvdCQxLFxuICAgIFNsb3RUZW1wbGF0ZTogU2xvdFRlbXBsYXRlJDEsXG4gICAgVGV4dDogVGV4dCQxLFxuICAgIFRpdGxlOiBUaXRsZSQxLFxuICAgIFdpbmRvdzogbm9vcCQxXG59O1xuY2xhc3MgUmVuZGVyZXIkMSB7XG4gICAgY29uc3RydWN0b3IoeyBuYW1lIH0pIHtcbiAgICAgICAgdGhpcy5oYXNfYmluZGluZ3MgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGFjayA9IFtdO1xuICAgICAgICB0aGlzLnRhcmdldHMgPSBbXTtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5wdXNoKCk7XG4gICAgfVxuICAgIGFkZF9zdHJpbmcoc3RyKSB7XG4gICAgICAgIHRoaXMuY3VycmVudC52YWx1ZSArPSBlc2NhcGVfdGVtcGxhdGUoc3RyKTtcbiAgICB9XG4gICAgYWRkX2V4cHJlc3Npb24obm9kZSkge1xuICAgICAgICB0aGlzLmxpdGVyYWwucXVhc2lzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogJ1RlbXBsYXRlRWxlbWVudCcsXG4gICAgICAgICAgICB2YWx1ZTogeyByYXc6IHRoaXMuY3VycmVudC52YWx1ZSwgY29va2VkOiBudWxsIH0sXG4gICAgICAgICAgICB0YWlsOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5saXRlcmFsLmV4cHJlc3Npb25zLnB1c2gobm9kZSk7XG4gICAgICAgIHRoaXMuY3VycmVudC52YWx1ZSA9ICcnO1xuICAgIH1cbiAgICBwdXNoKCkge1xuICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50ID0geyB2YWx1ZTogJycgfTtcbiAgICAgICAgY29uc3QgbGl0ZXJhbCA9IHRoaXMubGl0ZXJhbCA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdUZW1wbGF0ZUxpdGVyYWwnLFxuICAgICAgICAgICAgZXhwcmVzc2lvbnM6IFtdLFxuICAgICAgICAgICAgcXVhc2lzOiBbXVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnN0YWNrLnB1c2goeyBjdXJyZW50LCBsaXRlcmFsIH0pO1xuICAgIH1cbiAgICBwb3AoKSB7XG4gICAgICAgIHRoaXMubGl0ZXJhbC5xdWFzaXMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiAnVGVtcGxhdGVFbGVtZW50JyxcbiAgICAgICAgICAgIHZhbHVlOiB7IHJhdzogdGhpcy5jdXJyZW50LnZhbHVlLCBjb29rZWQ6IG51bGwgfSxcbiAgICAgICAgICAgIHRhaWw6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHBvcHBlZCA9IHRoaXMuc3RhY2sucG9wKCk7XG4gICAgICAgIGNvbnN0IGxhc3QgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV07XG4gICAgICAgIGlmIChsYXN0KSB7XG4gICAgICAgICAgICB0aGlzLmxpdGVyYWwgPSBsYXN0LmxpdGVyYWw7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnQgPSBsYXN0LmN1cnJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBvcHBlZC5saXRlcmFsO1xuICAgIH1cbiAgICByZW5kZXIobm9kZXMsIG9wdGlvbnMpIHtcbiAgICAgICAgbm9kZXMuZm9yRWFjaChub2RlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSBoYW5kbGVycyQxW25vZGUudHlwZV07XG4gICAgICAgICAgICBpZiAoIWhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGhhbmRsZXIgZm9yICcke25vZGUudHlwZX0nIG5vZGVzYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoYW5kbGVyKG5vZGUsIHRoaXMsIG9wdGlvbnMpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNzcihjb21wb25lbnQsIG9wdGlvbnMpIHtcbiAgICBjb25zdCByZW5kZXJlciA9IG5ldyBSZW5kZXJlciQxKHtcbiAgICAgICAgbmFtZTogY29tcG9uZW50Lm5hbWVcbiAgICB9KTtcbiAgICBjb25zdCB7IG5hbWUgfSA9IGNvbXBvbmVudDtcbiAgICAvLyBjcmVhdGUgJCRyZW5kZXIgZnVuY3Rpb25cbiAgICByZW5kZXJlci5yZW5kZXIodHJpbShjb21wb25lbnQuZnJhZ21lbnQuY2hpbGRyZW4pLCBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgbG9jYXRlOiBjb21wb25lbnQubG9jYXRlXG4gICAgfSwgb3B0aW9ucykpO1xuICAgIC8vIFRPRE8gcHV0IHRoaXMgaW5zaWRlIHRoZSBSZW5kZXJlciBjbGFzc1xuICAgIGNvbnN0IGxpdGVyYWwgPSByZW5kZXJlci5wb3AoKTtcbiAgICAvLyBUT0RPIGNvbmNhdGVuYXRlIENTUyBtYXBzXG4gICAgY29uc3QgY3NzID0gb3B0aW9ucy5jdXN0b21FbGVtZW50ID9cbiAgICAgICAgeyBjb2RlOiBudWxsLCBtYXA6IG51bGwgfSA6XG4gICAgICAgIGNvbXBvbmVudC5zdHlsZXNoZWV0LnJlbmRlcihvcHRpb25zLmZpbGVuYW1lLCB0cnVlKTtcbiAgICBjb25zdCB1c2VzX3Jlc3QgPSBjb21wb25lbnQudmFyX2xvb2t1cC5oYXMoJyQkcmVzdFByb3BzJyk7XG4gICAgY29uc3QgcHJvcHMgPSBjb21wb25lbnQudmFycy5maWx0ZXIodmFyaWFibGUgPT4gIXZhcmlhYmxlLm1vZHVsZSAmJiB2YXJpYWJsZS5leHBvcnRfbmFtZSk7XG4gICAgY29uc3QgcmVzdCA9IHVzZXNfcmVzdCA/IGIgYGxldCAkJHJlc3RQcm9wcyA9IEBjb21wdXRlX3Jlc3RfcHJvcHMoJCRwcm9wcywgWyR7cHJvcHMubWFwKHByb3AgPT4gYFwiJHtwcm9wLmV4cG9ydF9uYW1lfVwiYCkuam9pbignLCcpfV0pO2AgOiBudWxsO1xuICAgIGNvbnN0IHVzZXNfc2xvdHMgPSBjb21wb25lbnQudmFyX2xvb2t1cC5oYXMoJyQkc2xvdHMnKTtcbiAgICBjb25zdCBzbG90cyA9IHVzZXNfc2xvdHMgPyBiIGBsZXQgJCRzbG90cyA9IEBjb21wdXRlX3Nsb3RzKCNzbG90cyk7YCA6IG51bGw7XG4gICAgY29uc3QgcmVhY3RpdmVfc3RvcmVzID0gY29tcG9uZW50LnZhcnMuZmlsdGVyKHZhcmlhYmxlID0+IHZhcmlhYmxlLm5hbWVbMF0gPT09ICckJyAmJiB2YXJpYWJsZS5uYW1lWzFdICE9PSAnJCcpO1xuICAgIGNvbnN0IHJlYWN0aXZlX3N0b3JlX3N1YnNjcmlwdGlvbnMgPSByZWFjdGl2ZV9zdG9yZXNcbiAgICAgICAgLmZpbHRlcihzdG9yZSA9PiB7XG4gICAgICAgIGNvbnN0IHZhcmlhYmxlID0gY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KHN0b3JlLm5hbWUuc2xpY2UoMSkpO1xuICAgICAgICByZXR1cm4gIXZhcmlhYmxlIHx8IHZhcmlhYmxlLmhvaXN0YWJsZTtcbiAgICB9KVxuICAgICAgICAubWFwKCh7IG5hbWUgfSkgPT4ge1xuICAgICAgICBjb25zdCBzdG9yZV9uYW1lID0gbmFtZS5zbGljZSgxKTtcbiAgICAgICAgcmV0dXJuIGIgYFxuXHRcdFx0XHQke2NvbXBvbmVudC5jb21waWxlX29wdGlvbnMuZGV2ICYmIGIgYEB2YWxpZGF0ZV9zdG9yZSgke3N0b3JlX25hbWV9LCAnJHtzdG9yZV9uYW1lfScpO2B9XG5cdFx0XHRcdCR7YCQkdW5zdWJzY3JpYmVfJHtzdG9yZV9uYW1lfWB9ID0gQHN1YnNjcmliZSgke3N0b3JlX25hbWV9LCAjdmFsdWUgPT4gJHtuYW1lfSA9ICN2YWx1ZSlcblx0XHRcdGA7XG4gICAgfSk7XG4gICAgY29uc3QgcmVhY3RpdmVfc3RvcmVfdW5zdWJzY3JpcHRpb25zID0gcmVhY3RpdmVfc3RvcmVzLm1hcCgoeyBuYW1lIH0pID0+IGIgYCR7YCQkdW5zdWJzY3JpYmVfJHtuYW1lLnNsaWNlKDEpfWB9KClgKTtcbiAgICBjb25zdCByZWFjdGl2ZV9zdG9yZV9kZWNsYXJhdGlvbnMgPSByZWFjdGl2ZV9zdG9yZXNcbiAgICAgICAgLm1hcCgoeyBuYW1lIH0pID0+IHtcbiAgICAgICAgY29uc3Qgc3RvcmVfbmFtZSA9IG5hbWUuc2xpY2UoMSk7XG4gICAgICAgIGNvbnN0IHN0b3JlID0gY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KHN0b3JlX25hbWUpO1xuICAgICAgICBpZiAoc3RvcmUgJiYgc3RvcmUucmVhc3NpZ25lZCkge1xuICAgICAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSBgJCR1bnN1YnNjcmliZV8ke3N0b3JlX25hbWV9YDtcbiAgICAgICAgICAgIGNvbnN0IHN1YnNjcmliZSA9IGAkJHN1YnNjcmliZV8ke3N0b3JlX25hbWV9YDtcbiAgICAgICAgICAgIHJldHVybiBiIGBsZXQgJHtuYW1lfSwgJHt1bnN1YnNjcmliZX0gPSBAbm9vcCwgJHtzdWJzY3JpYmV9ID0gKCkgPT4gKCR7dW5zdWJzY3JpYmV9KCksICR7dW5zdWJzY3JpYmV9ID0gQHN1YnNjcmliZSgke3N0b3JlX25hbWV9LCAkJHZhbHVlID0+ICR7bmFtZX0gPSAkJHZhbHVlKSwgJHtzdG9yZV9uYW1lfSlgO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBiIGBsZXQgJHtuYW1lfSwgJHtgJCR1bnN1YnNjcmliZV8ke3N0b3JlX25hbWV9YH07YDtcbiAgICB9KTtcbiAgICAvLyBpbnN0cnVtZW50IGdldC9zZXQgc3RvcmUgdmFsdWVcbiAgICBpZiAoY29tcG9uZW50LmFzdC5pbnN0YW5jZSkge1xuICAgICAgICBsZXQgc2NvcGUgPSBjb21wb25lbnQuaW5zdGFuY2Vfc2NvcGU7XG4gICAgICAgIGNvbnN0IG1hcCA9IGNvbXBvbmVudC5pbnN0YW5jZV9zY29wZV9tYXA7XG4gICAgICAgIHdhbGsoY29tcG9uZW50LmFzdC5pbnN0YW5jZS5jb250ZW50LCB7XG4gICAgICAgICAgICBlbnRlcihub2RlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1hcC5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBtYXAuZ2V0KG5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZWF2ZShub2RlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1hcC5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdBc3NpZ25tZW50RXhwcmVzc2lvbicgfHwgbm9kZS50eXBlID09PSAnVXBkYXRlRXhwcmVzc2lvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWduZWUgPSBub2RlLnR5cGUgPT09ICdBc3NpZ25tZW50RXhwcmVzc2lvbicgPyBub2RlLmxlZnQgOiBub2RlLmFyZ3VtZW50O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lcyA9IG5ldyBTZXQoZXh0cmFjdF9uYW1lcyhhc3NpZ25lZSkpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0b19pbnZhbGlkYXRlID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIXZhcmlhYmxlLmhvaXN0YWJsZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICF2YXJpYWJsZS5nbG9iYWwgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhdmFyaWFibGUubW9kdWxlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHZhcmlhYmxlLnN1YnNjcmliYWJsZSB8fCB2YXJpYWJsZS5uYW1lWzBdID09PSAnJCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9faW52YWxpZGF0ZS5hZGQodmFyaWFibGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvX2ludmFsaWRhdGUuc2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBsYWNlKGludmFsaWRhdGUoeyBjb21wb25lbnQgfSwgc2NvcGUsIG5vZGUsIHRvX2ludmFsaWRhdGUsIHRydWUpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudC5yZXdyaXRlX3Byb3BzKCh7IG5hbWUsIHJlYXNzaWduZWQgfSkgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGAkJHtuYW1lfWA7XG4gICAgICAgIGxldCBpbnNlcnQgPSByZWFzc2lnbmVkXG4gICAgICAgICAgICA/IGIgYCR7YCQkc3Vic2NyaWJlXyR7bmFtZX1gfSgpYFxuICAgICAgICAgICAgOiBiIGAke2AkJHVuc3Vic2NyaWJlXyR7bmFtZX1gfSA9IEBzdWJzY3JpYmUoJHtuYW1lfSwgI3ZhbHVlID0+ICQke3ZhbHVlfSA9ICN2YWx1ZSlgO1xuICAgICAgICBpZiAoY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5kZXYpIHtcbiAgICAgICAgICAgIGluc2VydCA9IGIgYEB2YWxpZGF0ZV9zdG9yZSgke25hbWV9LCAnJHtuYW1lfScpOyAke2luc2VydH1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbnNlcnQ7XG4gICAgfSk7XG4gICAgY29uc3QgaW5zdGFuY2VfamF2YXNjcmlwdCA9IGNvbXBvbmVudC5leHRyYWN0X2phdmFzY3JpcHQoY29tcG9uZW50LmFzdC5pbnN0YW5jZSk7XG4gICAgLy8gVE9ETyBvbmx5IGRvIHRoaXMgZm9yIHByb3BzIHdpdGggYSBkZWZhdWx0IHZhbHVlXG4gICAgY29uc3QgcGFyZW50X2JpbmRpbmdzID0gaW5zdGFuY2VfamF2YXNjcmlwdFxuICAgICAgICA/IGNvbXBvbmVudC52YXJzXG4gICAgICAgICAgICAuZmlsdGVyKHZhcmlhYmxlID0+ICF2YXJpYWJsZS5tb2R1bGUgJiYgdmFyaWFibGUuZXhwb3J0X25hbWUpXG4gICAgICAgICAgICAubWFwKHByb3AgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGIgYGlmICgkJHByb3BzLiR7cHJvcC5leHBvcnRfbmFtZX0gPT09IHZvaWQgMCAmJiAkJGJpbmRpbmdzLiR7cHJvcC5leHBvcnRfbmFtZX0gJiYgJHtwcm9wLm5hbWV9ICE9PSB2b2lkIDApICQkYmluZGluZ3MuJHtwcm9wLmV4cG9ydF9uYW1lfSgke3Byb3AubmFtZX0pO2A7XG4gICAgICAgIH0pXG4gICAgICAgIDogW107XG4gICAgY29uc3QgaW5qZWN0ZWQgPSBBcnJheS5mcm9tKGNvbXBvbmVudC5pbmplY3RlZF9yZWFjdGl2ZV9kZWNsYXJhdGlvbl92YXJzKS5maWx0ZXIobmFtZSA9PiB7XG4gICAgICAgIGNvbnN0IHZhcmlhYmxlID0gY29tcG9uZW50LnZhcl9sb29rdXAuZ2V0KG5hbWUpO1xuICAgICAgICByZXR1cm4gdmFyaWFibGUuaW5qZWN0ZWQ7XG4gICAgfSk7XG4gICAgY29uc3QgcmVhY3RpdmVfZGVjbGFyYXRpb25zID0gY29tcG9uZW50LnJlYWN0aXZlX2RlY2xhcmF0aW9ucy5tYXAoZCA9PiB7XG4gICAgICAgIGNvbnN0IGJvZHkgPSBkLm5vZGUuYm9keTtcbiAgICAgICAgbGV0IHN0YXRlbWVudCA9IGIgYCR7Ym9keX1gO1xuICAgICAgICBpZiAoIWQuZGVjbGFyYXRpb24pIHsgLy8gVE9ETyBkbyBub3QgYWRkIGxhYmVsIGlmIGl0J3Mgbm90IHJlZmVyZW5jZWRcbiAgICAgICAgICAgIHN0YXRlbWVudCA9IGIgYCQ6IHsgJHtzdGF0ZW1lbnR9IH1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGF0ZW1lbnQ7XG4gICAgfSk7XG4gICAgY29uc3QgbWFpbiA9IHJlbmRlcmVyLmhhc19iaW5kaW5nc1xuICAgICAgICA/IGIgYFxuXHRcdFx0bGV0ICQkc2V0dGxlZDtcblx0XHRcdGxldCAkJHJlbmRlcmVkO1xuXG5cdFx0XHRkbyB7XG5cdFx0XHRcdCQkc2V0dGxlZCA9IHRydWU7XG5cblx0XHRcdFx0JHtyZWFjdGl2ZV9kZWNsYXJhdGlvbnN9XG5cblx0XHRcdFx0JCRyZW5kZXJlZCA9ICR7bGl0ZXJhbH07XG5cdFx0XHR9IHdoaWxlICghJCRzZXR0bGVkKTtcblxuXHRcdFx0JHtyZWFjdGl2ZV9zdG9yZV91bnN1YnNjcmlwdGlvbnN9XG5cblx0XHRcdHJldHVybiAkJHJlbmRlcmVkO1xuXHRcdGBcbiAgICAgICAgOiBiIGBcblx0XHRcdCR7cmVhY3RpdmVfZGVjbGFyYXRpb25zfVxuXG5cdFx0XHQke3JlYWN0aXZlX3N0b3JlX3Vuc3Vic2NyaXB0aW9uc31cblxuXHRcdFx0cmV0dXJuICR7bGl0ZXJhbH07YDtcbiAgICBjb25zdCBibG9ja3MgPSBbXG4gICAgICAgIC4uLmluamVjdGVkLm1hcChuYW1lID0+IGIgYGxldCAke25hbWV9O2ApLFxuICAgICAgICByZXN0LFxuICAgICAgICBzbG90cyxcbiAgICAgICAgLi4ucmVhY3RpdmVfc3RvcmVfZGVjbGFyYXRpb25zLFxuICAgICAgICAuLi5yZWFjdGl2ZV9zdG9yZV9zdWJzY3JpcHRpb25zLFxuICAgICAgICBpbnN0YW5jZV9qYXZhc2NyaXB0LFxuICAgICAgICAuLi5wYXJlbnRfYmluZGluZ3MsXG4gICAgICAgIGNzcy5jb2RlICYmIGIgYCQkcmVzdWx0LmNzcy5hZGQoI2Nzcyk7YCxcbiAgICAgICAgbWFpblxuICAgIF0uZmlsdGVyKEJvb2xlYW4pO1xuICAgIGNvbnN0IGNzc19zb3VyY2VtYXBfZW5hYmxlZCA9IGNoZWNrX2VuYWJsZV9zb3VyY2VtYXAob3B0aW9ucy5lbmFibGVTb3VyY2VtYXAsICdjc3MnKTtcbiAgICBjb25zdCBqcyA9IGIgYFxuXHRcdCR7Y3NzLmNvZGUgPyBiIGBcblx0XHRjb25zdCAjY3NzID0ge1xuXHRcdFx0Y29kZTogXCIke2Nzcy5jb2RlfVwiLFxuXHRcdFx0bWFwOiAke2Nzc19zb3VyY2VtYXBfZW5hYmxlZCAmJiBjc3MubWFwID8gc3RyaW5nX2xpdGVyYWwoY3NzLm1hcC50b1N0cmluZygpKSA6ICdudWxsJ31cblx0XHR9O2AgOiBudWxsfVxuXG5cdFx0JHtjb21wb25lbnQuZXh0cmFjdF9qYXZhc2NyaXB0KGNvbXBvbmVudC5hc3QubW9kdWxlKX1cblxuXHRcdCR7Y29tcG9uZW50LmZ1bGx5X2hvaXN0ZWR9XG5cblx0XHRjb25zdCAke25hbWV9ID0gQGNyZWF0ZV9zc3JfY29tcG9uZW50KCgkJHJlc3VsdCwgJCRwcm9wcywgJCRiaW5kaW5ncywgI3Nsb3RzKSA9PiB7XG5cdFx0XHQke2Jsb2Nrc31cblx0XHR9KTtcblx0YDtcbiAgICByZXR1cm4geyBqcywgY3NzIH07XG59XG5mdW5jdGlvbiB0cmltKG5vZGVzKSB7XG4gICAgbGV0IHN0YXJ0ID0gMDtcbiAgICBmb3IgKDsgc3RhcnQgPCBub2Rlcy5sZW5ndGg7IHN0YXJ0ICs9IDEpIHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW3N0YXJ0XTtcbiAgICAgICAgaWYgKG5vZGUudHlwZSAhPT0gJ1RleHQnKVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIG5vZGUuZGF0YSA9IG5vZGUuZGF0YS5yZXBsYWNlKC9eXFxzKy8sICcnKTtcbiAgICAgICAgaWYgKG5vZGUuZGF0YSlcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBsZXQgZW5kID0gbm9kZXMubGVuZ3RoO1xuICAgIGZvciAoOyBlbmQgPiBzdGFydDsgZW5kIC09IDEpIHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2VuZCAtIDFdO1xuICAgICAgICBpZiAobm9kZS50eXBlICE9PSAnVGV4dCcpXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgbm9kZS5kYXRhID0gbm9kZS5kYXRhLnJlcGxhY2UoL1xccyskLywgJycpO1xuICAgICAgICBpZiAobm9kZS5kYXRhKVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBub2Rlcy5zbGljZShzdGFydCwgZW5kKTtcbn1cblxuY29uc3Qgd3JhcHBlcnMkMSA9IHsgZXNtLCBjanMgfTtcbmZ1bmN0aW9uIGNyZWF0ZV9tb2R1bGUocHJvZ3JhbSwgZm9ybWF0LCBuYW1lLCBiYW5uZXIsIHN2ZWx0ZVBhdGggPSAnc3ZlbHRlJywgaGVscGVycywgZ2xvYmFscywgaW1wb3J0cywgbW9kdWxlX2V4cG9ydHMsIGV4cG9ydHNfZnJvbSkge1xuICAgIGNvbnN0IGludGVybmFsX3BhdGggPSBgJHtzdmVsdGVQYXRofS9pbnRlcm5hbGA7XG4gICAgaGVscGVycy5zb3J0KChhLCBiKSA9PiAoYS5uYW1lIDwgYi5uYW1lKSA/IC0xIDogMSk7XG4gICAgZ2xvYmFscy5zb3J0KChhLCBiKSA9PiAoYS5uYW1lIDwgYi5uYW1lKSA/IC0xIDogMSk7XG4gICAgY29uc3QgZm9ybWF0dGVyID0gd3JhcHBlcnMkMVtmb3JtYXRdO1xuICAgIGlmICghZm9ybWF0dGVyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgb3B0aW9ucy5mb3JtYXQgaXMgaW52YWxpZCAobXVzdCBiZSAke2xpc3QoT2JqZWN0LmtleXMod3JhcHBlcnMkMSkpfSlgKTtcbiAgICB9XG4gICAgcmV0dXJuIGZvcm1hdHRlcihwcm9ncmFtLCBuYW1lLCBiYW5uZXIsIHN2ZWx0ZVBhdGgsIGludGVybmFsX3BhdGgsIGhlbHBlcnMsIGdsb2JhbHMsIGltcG9ydHMsIG1vZHVsZV9leHBvcnRzLCBleHBvcnRzX2Zyb20pO1xufVxuZnVuY3Rpb24gZWRpdF9zb3VyY2Uoc291cmNlLCBzdmVsdGVQYXRoKSB7XG4gICAgcmV0dXJuIHNvdXJjZSA9PT0gJ3N2ZWx0ZScgfHwgc291cmNlLnN0YXJ0c1dpdGgoJ3N2ZWx0ZS8nKVxuICAgICAgICA/IHNvdXJjZS5yZXBsYWNlKCdzdmVsdGUnLCBzdmVsdGVQYXRoKVxuICAgICAgICA6IHNvdXJjZTtcbn1cbmZ1bmN0aW9uIGdldF9pbnRlcm5hbF9nbG9iYWxzKGdsb2JhbHMsIGhlbHBlcnMpIHtcbiAgICByZXR1cm4gZ2xvYmFscy5sZW5ndGggPiAwICYmIHtcbiAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRpb24nLFxuICAgICAgICBraW5kOiAnY29uc3QnLFxuICAgICAgICBkZWNsYXJhdGlvbnM6IFt7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRvcicsXG4gICAgICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ09iamVjdFBhdHRlcm4nLFxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBnbG9iYWxzLm1hcChnID0+ICh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUHJvcGVydHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0aGFuZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiBnLm5hbWUgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBnLmFsaWFzLFxuICAgICAgICAgICAgICAgICAgICAgICAga2luZDogJ2luaXQnXG4gICAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW5pdDogaGVscGVycy5maW5kKCh7IG5hbWUgfSkgPT4gbmFtZSA9PT0gJ2dsb2JhbHMnKS5hbGlhc1xuICAgICAgICAgICAgfV1cbiAgICB9O1xufVxuZnVuY3Rpb24gZXNtKHByb2dyYW0sIG5hbWUsIGJhbm5lciwgc3ZlbHRlUGF0aCwgaW50ZXJuYWxfcGF0aCwgaGVscGVycywgZ2xvYmFscywgaW1wb3J0cywgbW9kdWxlX2V4cG9ydHMsIGV4cG9ydHNfZnJvbSkge1xuICAgIGNvbnN0IGltcG9ydF9kZWNsYXJhdGlvbiA9IHtcbiAgICAgICAgdHlwZTogJ0ltcG9ydERlY2xhcmF0aW9uJyxcbiAgICAgICAgc3BlY2lmaWVyczogaGVscGVycy5tYXAoaCA9PiAoe1xuICAgICAgICAgICAgdHlwZTogJ0ltcG9ydFNwZWNpZmllcicsXG4gICAgICAgICAgICBsb2NhbDogaC5hbGlhcyxcbiAgICAgICAgICAgIGltcG9ydGVkOiB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogaC5uYW1lIH1cbiAgICAgICAgfSkpLFxuICAgICAgICBzb3VyY2U6IHsgdHlwZTogJ0xpdGVyYWwnLCB2YWx1ZTogaW50ZXJuYWxfcGF0aCB9XG4gICAgfTtcbiAgICBjb25zdCBpbnRlcm5hbF9nbG9iYWxzID0gZ2V0X2ludGVybmFsX2dsb2JhbHMoZ2xvYmFscywgaGVscGVycyk7XG4gICAgLy8gZWRpdCB1c2VyIGltcG9ydHNcbiAgICBmdW5jdGlvbiByZXdyaXRlX2ltcG9ydChub2RlKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZWRpdF9zb3VyY2Uobm9kZS5zb3VyY2UudmFsdWUsIHN2ZWx0ZVBhdGgpO1xuICAgICAgICBpZiAobm9kZS5zb3VyY2UudmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICBub2RlLnNvdXJjZS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgbm9kZS5zb3VyY2UucmF3ID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpbXBvcnRzLmZvckVhY2gocmV3cml0ZV9pbXBvcnQpO1xuICAgIGV4cG9ydHNfZnJvbS5mb3JFYWNoKHJld3JpdGVfaW1wb3J0KTtcbiAgICBjb25zdCBleHBvcnRzID0gbW9kdWxlX2V4cG9ydHMubGVuZ3RoID4gMCAmJiB7XG4gICAgICAgIHR5cGU6ICdFeHBvcnROYW1lZERlY2xhcmF0aW9uJyxcbiAgICAgICAgc3BlY2lmaWVyczogbW9kdWxlX2V4cG9ydHMubWFwKHggPT4gKHtcbiAgICAgICAgICAgIHR5cGU6ICdTcGVjaWZpZXInLFxuICAgICAgICAgICAgbG9jYWw6IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiB4Lm5hbWUgfSxcbiAgICAgICAgICAgIGV4cG9ydGVkOiB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogeC5hcyB9XG4gICAgICAgIH0pKVxuICAgIH07XG4gICAgcHJvZ3JhbS5ib2R5ID0gYiBgXG5cdFx0LyogJHtiYW5uZXJ9ICovXG5cblx0XHQke2ltcG9ydF9kZWNsYXJhdGlvbn1cblx0XHQke2ludGVybmFsX2dsb2JhbHN9XG5cdFx0JHtpbXBvcnRzfVxuXHRcdCR7ZXhwb3J0c19mcm9tfVxuXG5cdFx0JHtwcm9ncmFtLmJvZHl9XG5cblx0XHRleHBvcnQgZGVmYXVsdCAke25hbWV9O1xuXHRcdCR7ZXhwb3J0c31cblx0YDtcbn1cbmZ1bmN0aW9uIGNqcyhwcm9ncmFtLCBuYW1lLCBiYW5uZXIsIHN2ZWx0ZVBhdGgsIGludGVybmFsX3BhdGgsIGhlbHBlcnMsIGdsb2JhbHMsIGltcG9ydHMsIG1vZHVsZV9leHBvcnRzLCBleHBvcnRzX2Zyb20pIHtcbiAgICBjb25zdCBpbnRlcm5hbF9yZXF1aXJlcyA9IHtcbiAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRpb24nLFxuICAgICAgICBraW5kOiAnY29uc3QnLFxuICAgICAgICBkZWNsYXJhdGlvbnM6IFt7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRvcicsXG4gICAgICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ09iamVjdFBhdHRlcm4nLFxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBoZWxwZXJzLm1hcChoID0+ICh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUHJvcGVydHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0aGFuZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiBoLm5hbWUgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBoLmFsaWFzLFxuICAgICAgICAgICAgICAgICAgICAgICAga2luZDogJ2luaXQnXG4gICAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW5pdDogeCBgcmVxdWlyZShcIiR7aW50ZXJuYWxfcGF0aH1cIilgXG4gICAgICAgICAgICB9XVxuICAgIH07XG4gICAgY29uc3QgaW50ZXJuYWxfZ2xvYmFscyA9IGdldF9pbnRlcm5hbF9nbG9iYWxzKGdsb2JhbHMsIGhlbHBlcnMpO1xuICAgIGNvbnN0IHVzZXJfcmVxdWlyZXMgPSBpbXBvcnRzLm1hcChub2RlID0+IHtcbiAgICAgICAgY29uc3QgaW5pdCA9IHggYHJlcXVpcmUoXCIke2VkaXRfc291cmNlKG5vZGUuc291cmNlLnZhbHVlLCBzdmVsdGVQYXRoKX1cIilgO1xuICAgICAgICBpZiAobm9kZS5zcGVjaWZpZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGIgYCR7aW5pdH07YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRpb24nLFxuICAgICAgICAgICAga2luZDogJ2NvbnN0JyxcbiAgICAgICAgICAgIGRlY2xhcmF0aW9uczogW3tcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1ZhcmlhYmxlRGVjbGFyYXRvcicsXG4gICAgICAgICAgICAgICAgICAgIGlkOiBub2RlLnNwZWNpZmllcnNbMF0udHlwZSA9PT0gJ0ltcG9ydE5hbWVzcGFjZVNwZWNpZmllcidcbiAgICAgICAgICAgICAgICAgICAgICAgID8geyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6IG5vZGUuc3BlY2lmaWVyc1swXS5sb2NhbC5uYW1lIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdPYmplY3RQYXR0ZXJuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBub2RlLnNwZWNpZmllcnMubWFwKHMgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1Byb3BlcnR5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRoYW5kOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcHV0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IHMudHlwZSA9PT0gJ0ltcG9ydFNwZWNpZmllcicgPyBzLmltcG9ydGVkIDogeyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6ICdkZWZhdWx0JyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcy5sb2NhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2luZDogJ2luaXQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBpbml0XG4gICAgICAgICAgICAgICAgfV1cbiAgICAgICAgfTtcbiAgICB9KTtcbiAgICBjb25zdCBleHBvcnRzID0gbW9kdWxlX2V4cG9ydHMubWFwKHggPT4gYiBgZXhwb3J0cy4ke3sgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiB4LmFzIH19ID0gJHt7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogeC5uYW1lIH19O2ApO1xuICAgIGNvbnN0IHVzZXJfZXhwb3J0c19mcm9tID0gZXhwb3J0c19mcm9tLm1hcChub2RlID0+IHtcbiAgICAgICAgY29uc3QgaW5pdCA9IHggYHJlcXVpcmUoXCIke2VkaXRfc291cmNlKG5vZGUuc291cmNlLnZhbHVlLCBzdmVsdGVQYXRoKX1cIilgO1xuICAgICAgICByZXR1cm4gbm9kZS5zcGVjaWZpZXJzLm1hcChzcGVjaWZpZXIgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGIgYGV4cG9ydHMuJHtzcGVjaWZpZXIuZXhwb3J0ZWR9ID0gJHtpbml0fS4ke3NwZWNpZmllci5sb2NhbH07YDtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgcHJvZ3JhbS5ib2R5ID0gYiBgXG5cdFx0LyogJHtiYW5uZXJ9ICovXG5cblx0XHRcInVzZSBzdHJpY3RcIjtcblx0XHQke2ludGVybmFsX3JlcXVpcmVzfVxuXHRcdCR7aW50ZXJuYWxfZ2xvYmFsc31cblx0XHQke3VzZXJfcmVxdWlyZXN9XG5cdFx0JHt1c2VyX2V4cG9ydHNfZnJvbX1cblxuXHRcdCR7cHJvZ3JhbS5ib2R5fVxuXG5cdFx0ZXhwb3J0cy5kZWZhdWx0ID0gJHtuYW1lfTtcblx0XHQke2V4cG9ydHN9XG5cdGA7XG59XG5cbnZhciBDaHVuayA9IGZ1bmN0aW9uIENodW5rKHN0YXJ0LCBlbmQsIGNvbnRlbnQpIHtcblx0dGhpcy5zdGFydCA9IHN0YXJ0O1xuXHR0aGlzLmVuZCA9IGVuZDtcblx0dGhpcy5vcmlnaW5hbCA9IGNvbnRlbnQ7XG5cblx0dGhpcy5pbnRybyA9ICcnO1xuXHR0aGlzLm91dHJvID0gJyc7XG5cblx0dGhpcy5jb250ZW50ID0gY29udGVudDtcblx0dGhpcy5zdG9yZU5hbWUgPSBmYWxzZTtcblx0dGhpcy5lZGl0ZWQgPSBmYWxzZTtcblxuXHQvLyB3ZSBtYWtlIHRoZXNlIG5vbi1lbnVtZXJhYmxlLCBmb3Igc2FuaXR5IHdoaWxlIGRlYnVnZ2luZ1xuXHRPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7XG5cdFx0cHJldmlvdXM6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBudWxsIH0sXG5cdFx0bmV4dDogICAgIHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBudWxsIH1cblx0fSk7XG59O1xuXG5DaHVuay5wcm90b3R5cGUuYXBwZW5kTGVmdCA9IGZ1bmN0aW9uIGFwcGVuZExlZnQgKGNvbnRlbnQpIHtcblx0dGhpcy5vdXRybyArPSBjb250ZW50O1xufTtcblxuQ2h1bmsucHJvdG90eXBlLmFwcGVuZFJpZ2h0ID0gZnVuY3Rpb24gYXBwZW5kUmlnaHQgKGNvbnRlbnQpIHtcblx0dGhpcy5pbnRybyA9IHRoaXMuaW50cm8gKyBjb250ZW50O1xufTtcblxuQ2h1bmsucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gY2xvbmUgKCkge1xuXHR2YXIgY2h1bmsgPSBuZXcgQ2h1bmsodGhpcy5zdGFydCwgdGhpcy5lbmQsIHRoaXMub3JpZ2luYWwpO1xuXG5cdGNodW5rLmludHJvID0gdGhpcy5pbnRybztcblx0Y2h1bmsub3V0cm8gPSB0aGlzLm91dHJvO1xuXHRjaHVuay5jb250ZW50ID0gdGhpcy5jb250ZW50O1xuXHRjaHVuay5zdG9yZU5hbWUgPSB0aGlzLnN0b3JlTmFtZTtcblx0Y2h1bmsuZWRpdGVkID0gdGhpcy5lZGl0ZWQ7XG5cblx0cmV0dXJuIGNodW5rO1xufTtcblxuQ2h1bmsucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24gY29udGFpbnMgKGluZGV4KSB7XG5cdHJldHVybiB0aGlzLnN0YXJ0IDwgaW5kZXggJiYgaW5kZXggPCB0aGlzLmVuZDtcbn07XG5cbkNodW5rLnByb3RvdHlwZS5lYWNoTmV4dCA9IGZ1bmN0aW9uIGVhY2hOZXh0IChmbikge1xuXHR2YXIgY2h1bmsgPSB0aGlzO1xuXHR3aGlsZSAoY2h1bmspIHtcblx0XHRmbihjaHVuayk7XG5cdFx0Y2h1bmsgPSBjaHVuay5uZXh0O1xuXHR9XG59O1xuXG5DaHVuay5wcm90b3R5cGUuZWFjaFByZXZpb3VzID0gZnVuY3Rpb24gZWFjaFByZXZpb3VzIChmbikge1xuXHR2YXIgY2h1bmsgPSB0aGlzO1xuXHR3aGlsZSAoY2h1bmspIHtcblx0XHRmbihjaHVuayk7XG5cdFx0Y2h1bmsgPSBjaHVuay5wcmV2aW91cztcblx0fVxufTtcblxuQ2h1bmsucHJvdG90eXBlLmVkaXQgPSBmdW5jdGlvbiBlZGl0IChjb250ZW50LCBzdG9yZU5hbWUsIGNvbnRlbnRPbmx5KSB7XG5cdHRoaXMuY29udGVudCA9IGNvbnRlbnQ7XG5cdGlmICghY29udGVudE9ubHkpIHtcblx0XHR0aGlzLmludHJvID0gJyc7XG5cdFx0dGhpcy5vdXRybyA9ICcnO1xuXHR9XG5cdHRoaXMuc3RvcmVOYW1lID0gc3RvcmVOYW1lO1xuXG5cdHRoaXMuZWRpdGVkID0gdHJ1ZTtcblxuXHRyZXR1cm4gdGhpcztcbn07XG5cbkNodW5rLnByb3RvdHlwZS5wcmVwZW5kTGVmdCA9IGZ1bmN0aW9uIHByZXBlbmRMZWZ0IChjb250ZW50KSB7XG5cdHRoaXMub3V0cm8gPSBjb250ZW50ICsgdGhpcy5vdXRybztcbn07XG5cbkNodW5rLnByb3RvdHlwZS5wcmVwZW5kUmlnaHQgPSBmdW5jdGlvbiBwcmVwZW5kUmlnaHQgKGNvbnRlbnQpIHtcblx0dGhpcy5pbnRybyA9IGNvbnRlbnQgKyB0aGlzLmludHJvO1xufTtcblxuQ2h1bmsucHJvdG90eXBlLnNwbGl0ID0gZnVuY3Rpb24gc3BsaXQgKGluZGV4KSB7XG5cdHZhciBzbGljZUluZGV4ID0gaW5kZXggLSB0aGlzLnN0YXJ0O1xuXG5cdHZhciBvcmlnaW5hbEJlZm9yZSA9IHRoaXMub3JpZ2luYWwuc2xpY2UoMCwgc2xpY2VJbmRleCk7XG5cdHZhciBvcmlnaW5hbEFmdGVyID0gdGhpcy5vcmlnaW5hbC5zbGljZShzbGljZUluZGV4KTtcblxuXHR0aGlzLm9yaWdpbmFsID0gb3JpZ2luYWxCZWZvcmU7XG5cblx0dmFyIG5ld0NodW5rID0gbmV3IENodW5rKGluZGV4LCB0aGlzLmVuZCwgb3JpZ2luYWxBZnRlcik7XG5cdG5ld0NodW5rLm91dHJvID0gdGhpcy5vdXRybztcblx0dGhpcy5vdXRybyA9ICcnO1xuXG5cdHRoaXMuZW5kID0gaW5kZXg7XG5cblx0aWYgKHRoaXMuZWRpdGVkKSB7XG5cdFx0Ly8gVE9ETyBpcyB0aGlzIGJsb2NrIG5lY2Vzc2FyeT8uLi5cblx0XHRuZXdDaHVuay5lZGl0KCcnLCBmYWxzZSk7XG5cdFx0dGhpcy5jb250ZW50ID0gJyc7XG5cdH0gZWxzZSB7XG5cdFx0dGhpcy5jb250ZW50ID0gb3JpZ2luYWxCZWZvcmU7XG5cdH1cblxuXHRuZXdDaHVuay5uZXh0ID0gdGhpcy5uZXh0O1xuXHRpZiAobmV3Q2h1bmsubmV4dCkgeyBuZXdDaHVuay5uZXh0LnByZXZpb3VzID0gbmV3Q2h1bms7IH1cblx0bmV3Q2h1bmsucHJldmlvdXMgPSB0aGlzO1xuXHR0aGlzLm5leHQgPSBuZXdDaHVuaztcblxuXHRyZXR1cm4gbmV3Q2h1bms7XG59O1xuXG5DaHVuay5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZyAoKSB7XG5cdHJldHVybiB0aGlzLmludHJvICsgdGhpcy5jb250ZW50ICsgdGhpcy5vdXRybztcbn07XG5cbkNodW5rLnByb3RvdHlwZS50cmltRW5kID0gZnVuY3Rpb24gdHJpbUVuZCAocngpIHtcblx0dGhpcy5vdXRybyA9IHRoaXMub3V0cm8ucmVwbGFjZShyeCwgJycpO1xuXHRpZiAodGhpcy5vdXRyby5sZW5ndGgpIHsgcmV0dXJuIHRydWU7IH1cblxuXHR2YXIgdHJpbW1lZCA9IHRoaXMuY29udGVudC5yZXBsYWNlKHJ4LCAnJyk7XG5cblx0aWYgKHRyaW1tZWQubGVuZ3RoKSB7XG5cdFx0aWYgKHRyaW1tZWQgIT09IHRoaXMuY29udGVudCkge1xuXHRcdFx0dGhpcy5zcGxpdCh0aGlzLnN0YXJ0ICsgdHJpbW1lZC5sZW5ndGgpLmVkaXQoJycsIHVuZGVmaW5lZCwgdHJ1ZSk7XG5cdFx0fVxuXHRcdHJldHVybiB0cnVlO1xuXG5cdH0gZWxzZSB7XG5cdFx0dGhpcy5lZGl0KCcnLCB1bmRlZmluZWQsIHRydWUpO1xuXG5cdFx0dGhpcy5pbnRybyA9IHRoaXMuaW50cm8ucmVwbGFjZShyeCwgJycpO1xuXHRcdGlmICh0aGlzLmludHJvLmxlbmd0aCkgeyByZXR1cm4gdHJ1ZTsgfVxuXHR9XG59O1xuXG5DaHVuay5wcm90b3R5cGUudHJpbVN0YXJ0ID0gZnVuY3Rpb24gdHJpbVN0YXJ0IChyeCkge1xuXHR0aGlzLmludHJvID0gdGhpcy5pbnRyby5yZXBsYWNlKHJ4LCAnJyk7XG5cdGlmICh0aGlzLmludHJvLmxlbmd0aCkgeyByZXR1cm4gdHJ1ZTsgfVxuXG5cdHZhciB0cmltbWVkID0gdGhpcy5jb250ZW50LnJlcGxhY2UocngsICcnKTtcblxuXHRpZiAodHJpbW1lZC5sZW5ndGgpIHtcblx0XHRpZiAodHJpbW1lZCAhPT0gdGhpcy5jb250ZW50KSB7XG5cdFx0XHR0aGlzLnNwbGl0KHRoaXMuZW5kIC0gdHJpbW1lZC5sZW5ndGgpO1xuXHRcdFx0dGhpcy5lZGl0KCcnLCB1bmRlZmluZWQsIHRydWUpO1xuXHRcdH1cblx0XHRyZXR1cm4gdHJ1ZTtcblxuXHR9IGVsc2Uge1xuXHRcdHRoaXMuZWRpdCgnJywgdW5kZWZpbmVkLCB0cnVlKTtcblxuXHRcdHRoaXMub3V0cm8gPSB0aGlzLm91dHJvLnJlcGxhY2UocngsICcnKTtcblx0XHRpZiAodGhpcy5vdXRyby5sZW5ndGgpIHsgcmV0dXJuIHRydWU7IH1cblx0fVxufTtcblxudmFyIGJ0b2EkMiA9IGZ1bmN0aW9uICgpIHtcblx0dGhyb3cgbmV3IEVycm9yKCdVbnN1cHBvcnRlZCBlbnZpcm9ubWVudDogYHdpbmRvdy5idG9hYCBvciBgQnVmZmVyYCBzaG91bGQgYmUgc3VwcG9ydGVkLicpO1xufTtcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygd2luZG93LmJ0b2EgPT09ICdmdW5jdGlvbicpIHtcblx0YnRvYSQyID0gZnVuY3Rpb24gKHN0cikgeyByZXR1cm4gd2luZG93LmJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHN0cikpKTsgfTtcbn0gZWxzZSBpZiAodHlwZW9mIEJ1ZmZlciA9PT0gJ2Z1bmN0aW9uJykge1xuXHRidG9hJDIgPSBmdW5jdGlvbiAoc3RyKSB7IHJldHVybiBCdWZmZXIuZnJvbShzdHIsICd1dGYtOCcpLnRvU3RyaW5nKCdiYXNlNjQnKTsgfTtcbn1cblxudmFyIFNvdXJjZU1hcCQxID0gZnVuY3Rpb24gU291cmNlTWFwKHByb3BlcnRpZXMpIHtcblx0dGhpcy52ZXJzaW9uID0gMztcblx0dGhpcy5maWxlID0gcHJvcGVydGllcy5maWxlO1xuXHR0aGlzLnNvdXJjZXMgPSBwcm9wZXJ0aWVzLnNvdXJjZXM7XG5cdHRoaXMuc291cmNlc0NvbnRlbnQgPSBwcm9wZXJ0aWVzLnNvdXJjZXNDb250ZW50O1xuXHR0aGlzLm5hbWVzID0gcHJvcGVydGllcy5uYW1lcztcblx0dGhpcy5tYXBwaW5ncyA9IGVuY29kZShwcm9wZXJ0aWVzLm1hcHBpbmdzKTtcbn07XG5cblNvdXJjZU1hcCQxLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nICgpIHtcblx0cmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMpO1xufTtcblxuU291cmNlTWFwJDEucHJvdG90eXBlLnRvVXJsID0gZnVuY3Rpb24gdG9VcmwgKCkge1xuXHRyZXR1cm4gJ2RhdGE6YXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04O2Jhc2U2NCwnICsgYnRvYSQyKHRoaXMudG9TdHJpbmcoKSk7XG59O1xuXG5mdW5jdGlvbiBndWVzc0luZGVudChjb2RlKSB7XG5cdHZhciBsaW5lcyA9IGNvZGUuc3BsaXQoJ1xcbicpO1xuXG5cdHZhciB0YWJiZWQgPSBsaW5lcy5maWx0ZXIoZnVuY3Rpb24gKGxpbmUpIHsgcmV0dXJuIC9eXFx0Ky8udGVzdChsaW5lKTsgfSk7XG5cdHZhciBzcGFjZWQgPSBsaW5lcy5maWx0ZXIoZnVuY3Rpb24gKGxpbmUpIHsgcmV0dXJuIC9eIHsyLH0vLnRlc3QobGluZSk7IH0pO1xuXG5cdGlmICh0YWJiZWQubGVuZ3RoID09PSAwICYmIHNwYWNlZC5sZW5ndGggPT09IDApIHtcblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdC8vIE1vcmUgbGluZXMgdGFiYmVkIHRoYW4gc3BhY2VkPyBBc3N1bWUgdGFicywgYW5kXG5cdC8vIGRlZmF1bHQgdG8gdGFicyBpbiB0aGUgY2FzZSBvZiBhIHRpZSAob3Igbm90aGluZ1xuXHQvLyB0byBnbyBvbilcblx0aWYgKHRhYmJlZC5sZW5ndGggPj0gc3BhY2VkLmxlbmd0aCkge1xuXHRcdHJldHVybiAnXFx0Jztcblx0fVxuXG5cdC8vIE90aGVyd2lzZSwgd2UgbmVlZCB0byBndWVzcyB0aGUgbXVsdGlwbGVcblx0dmFyIG1pbiA9IHNwYWNlZC5yZWR1Y2UoZnVuY3Rpb24gKHByZXZpb3VzLCBjdXJyZW50KSB7XG5cdFx0dmFyIG51bVNwYWNlcyA9IC9eICsvLmV4ZWMoY3VycmVudClbMF0ubGVuZ3RoO1xuXHRcdHJldHVybiBNYXRoLm1pbihudW1TcGFjZXMsIHByZXZpb3VzKTtcblx0fSwgSW5maW5pdHkpO1xuXG5cdHJldHVybiBuZXcgQXJyYXkobWluICsgMSkuam9pbignICcpO1xufVxuXG5mdW5jdGlvbiBnZXRSZWxhdGl2ZVBhdGgoZnJvbSwgdG8pIHtcblx0dmFyIGZyb21QYXJ0cyA9IGZyb20uc3BsaXQoL1svXFxcXF0vKTtcblx0dmFyIHRvUGFydHMgPSB0by5zcGxpdCgvWy9cXFxcXS8pO1xuXG5cdGZyb21QYXJ0cy5wb3AoKTsgLy8gZ2V0IGRpcm5hbWVcblxuXHR3aGlsZSAoZnJvbVBhcnRzWzBdID09PSB0b1BhcnRzWzBdKSB7XG5cdFx0ZnJvbVBhcnRzLnNoaWZ0KCk7XG5cdFx0dG9QYXJ0cy5zaGlmdCgpO1xuXHR9XG5cblx0aWYgKGZyb21QYXJ0cy5sZW5ndGgpIHtcblx0XHR2YXIgaSA9IGZyb21QYXJ0cy5sZW5ndGg7XG5cdFx0d2hpbGUgKGktLSkgeyBmcm9tUGFydHNbaV0gPSAnLi4nOyB9XG5cdH1cblxuXHRyZXR1cm4gZnJvbVBhcnRzLmNvbmNhdCh0b1BhcnRzKS5qb2luKCcvJyk7XG59XG5cbnZhciB0b1N0cmluZyQxID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztcblxuZnVuY3Rpb24gaXNPYmplY3QodGhpbmcpIHtcblx0cmV0dXJuIHRvU3RyaW5nJDEuY2FsbCh0aGluZykgPT09ICdbb2JqZWN0IE9iamVjdF0nO1xufVxuXG5mdW5jdGlvbiBnZXRMb2NhdG9yJDEoc291cmNlKSB7XG5cdHZhciBvcmlnaW5hbExpbmVzID0gc291cmNlLnNwbGl0KCdcXG4nKTtcblx0dmFyIGxpbmVPZmZzZXRzID0gW107XG5cblx0Zm9yICh2YXIgaSA9IDAsIHBvcyA9IDA7IGkgPCBvcmlnaW5hbExpbmVzLmxlbmd0aDsgaSsrKSB7XG5cdFx0bGluZU9mZnNldHMucHVzaChwb3MpO1xuXHRcdHBvcyArPSBvcmlnaW5hbExpbmVzW2ldLmxlbmd0aCArIDE7XG5cdH1cblxuXHRyZXR1cm4gZnVuY3Rpb24gbG9jYXRlKGluZGV4KSB7XG5cdFx0dmFyIGkgPSAwO1xuXHRcdHZhciBqID0gbGluZU9mZnNldHMubGVuZ3RoO1xuXHRcdHdoaWxlIChpIDwgaikge1xuXHRcdFx0dmFyIG0gPSAoaSArIGopID4+IDE7XG5cdFx0XHRpZiAoaW5kZXggPCBsaW5lT2Zmc2V0c1ttXSkge1xuXHRcdFx0XHRqID0gbTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGkgPSBtICsgMTtcblx0XHRcdH1cblx0XHR9XG5cdFx0dmFyIGxpbmUgPSBpIC0gMTtcblx0XHR2YXIgY29sdW1uID0gaW5kZXggLSBsaW5lT2Zmc2V0c1tsaW5lXTtcblx0XHRyZXR1cm4geyBsaW5lOiBsaW5lLCBjb2x1bW46IGNvbHVtbiB9O1xuXHR9O1xufVxuXG52YXIgTWFwcGluZ3MgPSBmdW5jdGlvbiBNYXBwaW5ncyhoaXJlcykge1xuXHR0aGlzLmhpcmVzID0gaGlyZXM7XG5cdHRoaXMuZ2VuZXJhdGVkQ29kZUxpbmUgPSAwO1xuXHR0aGlzLmdlbmVyYXRlZENvZGVDb2x1bW4gPSAwO1xuXHR0aGlzLnJhdyA9IFtdO1xuXHR0aGlzLnJhd1NlZ21lbnRzID0gdGhpcy5yYXdbdGhpcy5nZW5lcmF0ZWRDb2RlTGluZV0gPSBbXTtcblx0dGhpcy5wZW5kaW5nID0gbnVsbDtcbn07XG5cbk1hcHBpbmdzLnByb3RvdHlwZS5hZGRFZGl0ID0gZnVuY3Rpb24gYWRkRWRpdCAoc291cmNlSW5kZXgsIGNvbnRlbnQsIGxvYywgbmFtZUluZGV4KSB7XG5cdGlmIChjb250ZW50Lmxlbmd0aCkge1xuXHRcdHZhciBzZWdtZW50ID0gW3RoaXMuZ2VuZXJhdGVkQ29kZUNvbHVtbiwgc291cmNlSW5kZXgsIGxvYy5saW5lLCBsb2MuY29sdW1uXTtcblx0XHRpZiAobmFtZUluZGV4ID49IDApIHtcblx0XHRcdHNlZ21lbnQucHVzaChuYW1lSW5kZXgpO1xuXHRcdH1cblx0XHR0aGlzLnJhd1NlZ21lbnRzLnB1c2goc2VnbWVudCk7XG5cdH0gZWxzZSBpZiAodGhpcy5wZW5kaW5nKSB7XG5cdFx0dGhpcy5yYXdTZWdtZW50cy5wdXNoKHRoaXMucGVuZGluZyk7XG5cdH1cblxuXHR0aGlzLmFkdmFuY2UoY29udGVudCk7XG5cdHRoaXMucGVuZGluZyA9IG51bGw7XG59O1xuXG5NYXBwaW5ncy5wcm90b3R5cGUuYWRkVW5lZGl0ZWRDaHVuayA9IGZ1bmN0aW9uIGFkZFVuZWRpdGVkQ2h1bmsgKHNvdXJjZUluZGV4LCBjaHVuaywgb3JpZ2luYWwsIGxvYywgc291cmNlbWFwTG9jYXRpb25zKSB7XG5cdHZhciBvcmlnaW5hbENoYXJJbmRleCA9IGNodW5rLnN0YXJ0O1xuXHR2YXIgZmlyc3QgPSB0cnVlO1xuXG5cdHdoaWxlIChvcmlnaW5hbENoYXJJbmRleCA8IGNodW5rLmVuZCkge1xuXHRcdGlmICh0aGlzLmhpcmVzIHx8IGZpcnN0IHx8IHNvdXJjZW1hcExvY2F0aW9uc1tvcmlnaW5hbENoYXJJbmRleF0pIHtcblx0XHRcdHRoaXMucmF3U2VnbWVudHMucHVzaChbdGhpcy5nZW5lcmF0ZWRDb2RlQ29sdW1uLCBzb3VyY2VJbmRleCwgbG9jLmxpbmUsIGxvYy5jb2x1bW5dKTtcblx0XHR9XG5cblx0XHRpZiAob3JpZ2luYWxbb3JpZ2luYWxDaGFySW5kZXhdID09PSAnXFxuJykge1xuXHRcdFx0bG9jLmxpbmUgKz0gMTtcblx0XHRcdGxvYy5jb2x1bW4gPSAwO1xuXHRcdFx0dGhpcy5nZW5lcmF0ZWRDb2RlTGluZSArPSAxO1xuXHRcdFx0dGhpcy5yYXdbdGhpcy5nZW5lcmF0ZWRDb2RlTGluZV0gPSB0aGlzLnJhd1NlZ21lbnRzID0gW107XG5cdFx0XHR0aGlzLmdlbmVyYXRlZENvZGVDb2x1bW4gPSAwO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2MuY29sdW1uICs9IDE7XG5cdFx0XHR0aGlzLmdlbmVyYXRlZENvZGVDb2x1bW4gKz0gMTtcblx0XHR9XG5cblx0XHRvcmlnaW5hbENoYXJJbmRleCArPSAxO1xuXHRcdGZpcnN0ID0gZmFsc2U7XG5cdH1cblxuXHR0aGlzLnBlbmRpbmcgPSBbdGhpcy5nZW5lcmF0ZWRDb2RlQ29sdW1uLCBzb3VyY2VJbmRleCwgbG9jLmxpbmUsIGxvYy5jb2x1bW5dO1xufTtcblxuTWFwcGluZ3MucHJvdG90eXBlLmFkdmFuY2UgPSBmdW5jdGlvbiBhZHZhbmNlIChzdHIpIHtcblx0aWYgKCFzdHIpIHsgcmV0dXJuOyB9XG5cblx0dmFyIGxpbmVzID0gc3RyLnNwbGl0KCdcXG4nKTtcblxuXHRpZiAobGluZXMubGVuZ3RoID4gMSkge1xuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoIC0gMTsgaSsrKSB7XG5cdFx0XHR0aGlzLmdlbmVyYXRlZENvZGVMaW5lKys7XG5cdFx0XHR0aGlzLnJhd1t0aGlzLmdlbmVyYXRlZENvZGVMaW5lXSA9IHRoaXMucmF3U2VnbWVudHMgPSBbXTtcblx0XHR9XG5cdFx0dGhpcy5nZW5lcmF0ZWRDb2RlQ29sdW1uID0gMDtcblx0fVxuXG5cdHRoaXMuZ2VuZXJhdGVkQ29kZUNvbHVtbiArPSBsaW5lc1tsaW5lcy5sZW5ndGggLSAxXS5sZW5ndGg7XG59O1xuXG52YXIgbiA9ICdcXG4nO1xuXG52YXIgd2FybmVkID0ge1xuXHRpbnNlcnRMZWZ0OiBmYWxzZSxcblx0aW5zZXJ0UmlnaHQ6IGZhbHNlLFxuXHRzdG9yZU5hbWU6IGZhbHNlXG59O1xuXG52YXIgTWFnaWNTdHJpbmcgPSBmdW5jdGlvbiBNYWdpY1N0cmluZyhzdHJpbmcsIG9wdGlvbnMpIHtcblx0aWYgKCBvcHRpb25zID09PSB2b2lkIDAgKSBvcHRpb25zID0ge307XG5cblx0dmFyIGNodW5rID0gbmV3IENodW5rKDAsIHN0cmluZy5sZW5ndGgsIHN0cmluZyk7XG5cblx0T2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywge1xuXHRcdG9yaWdpbmFsOiAgICAgICAgICAgICAgeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IHN0cmluZyB9LFxuXHRcdG91dHJvOiAgICAgICAgICAgICAgICAgeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6ICcnIH0sXG5cdFx0aW50cm86ICAgICAgICAgICAgICAgICB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogJycgfSxcblx0XHRmaXJzdENodW5rOiAgICAgICAgICAgIHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBjaHVuayB9LFxuXHRcdGxhc3RDaHVuazogICAgICAgICAgICAgeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGNodW5rIH0sXG5cdFx0bGFzdFNlYXJjaGVkQ2h1bms6ICAgICB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogY2h1bmsgfSxcblx0XHRieVN0YXJ0OiAgICAgICAgICAgICAgIHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiB7fSB9LFxuXHRcdGJ5RW5kOiAgICAgICAgICAgICAgICAgeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IHt9IH0sXG5cdFx0ZmlsZW5hbWU6ICAgICAgICAgICAgICB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogb3B0aW9ucy5maWxlbmFtZSB9LFxuXHRcdGluZGVudEV4Y2x1c2lvblJhbmdlczogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IG9wdGlvbnMuaW5kZW50RXhjbHVzaW9uUmFuZ2VzIH0sXG5cdFx0c291cmNlbWFwTG9jYXRpb25zOiAgICB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZToge30gfSxcblx0XHRzdG9yZWROYW1lczogICAgICAgICAgIHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiB7fSB9LFxuXHRcdGluZGVudFN0cjogICAgICAgICAgICAgeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGd1ZXNzSW5kZW50KHN0cmluZykgfVxuXHR9KTtcblxuXHR0aGlzLmJ5U3RhcnRbMF0gPSBjaHVuaztcblx0dGhpcy5ieUVuZFtzdHJpbmcubGVuZ3RoXSA9IGNodW5rO1xufTtcblxuTWFnaWNTdHJpbmcucHJvdG90eXBlLmFkZFNvdXJjZW1hcExvY2F0aW9uID0gZnVuY3Rpb24gYWRkU291cmNlbWFwTG9jYXRpb24gKGNoYXIpIHtcblx0dGhpcy5zb3VyY2VtYXBMb2NhdGlvbnNbY2hhcl0gPSB0cnVlO1xufTtcblxuTWFnaWNTdHJpbmcucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIGFwcGVuZCAoY29udGVudCkge1xuXHRpZiAodHlwZW9mIGNvbnRlbnQgIT09ICdzdHJpbmcnKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ291dHJvIGNvbnRlbnQgbXVzdCBiZSBhIHN0cmluZycpOyB9XG5cblx0dGhpcy5vdXRybyArPSBjb250ZW50O1xuXHRyZXR1cm4gdGhpcztcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS5hcHBlbmRMZWZ0ID0gZnVuY3Rpb24gYXBwZW5kTGVmdCAoaW5kZXgsIGNvbnRlbnQpIHtcblx0aWYgKHR5cGVvZiBjb250ZW50ICE9PSAnc3RyaW5nJykgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnNlcnRlZCBjb250ZW50IG11c3QgYmUgYSBzdHJpbmcnKTsgfVxuXG5cdHRoaXMuX3NwbGl0KGluZGV4KTtcblxuXHR2YXIgY2h1bmsgPSB0aGlzLmJ5RW5kW2luZGV4XTtcblxuXHRpZiAoY2h1bmspIHtcblx0XHRjaHVuay5hcHBlbmRMZWZ0KGNvbnRlbnQpO1xuXHR9IGVsc2Uge1xuXHRcdHRoaXMuaW50cm8gKz0gY29udGVudDtcblx0fVxuXHRyZXR1cm4gdGhpcztcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS5hcHBlbmRSaWdodCA9IGZ1bmN0aW9uIGFwcGVuZFJpZ2h0IChpbmRleCwgY29udGVudCkge1xuXHRpZiAodHlwZW9mIGNvbnRlbnQgIT09ICdzdHJpbmcnKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ2luc2VydGVkIGNvbnRlbnQgbXVzdCBiZSBhIHN0cmluZycpOyB9XG5cblx0dGhpcy5fc3BsaXQoaW5kZXgpO1xuXG5cdHZhciBjaHVuayA9IHRoaXMuYnlTdGFydFtpbmRleF07XG5cblx0aWYgKGNodW5rKSB7XG5cdFx0Y2h1bmsuYXBwZW5kUmlnaHQoY29udGVudCk7XG5cdH0gZWxzZSB7XG5cdFx0dGhpcy5vdXRybyArPSBjb250ZW50O1xuXHR9XG5cdHJldHVybiB0aGlzO1xufTtcblxuTWFnaWNTdHJpbmcucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gY2xvbmUgKCkge1xuXHR2YXIgY2xvbmVkID0gbmV3IE1hZ2ljU3RyaW5nKHRoaXMub3JpZ2luYWwsIHsgZmlsZW5hbWU6IHRoaXMuZmlsZW5hbWUgfSk7XG5cblx0dmFyIG9yaWdpbmFsQ2h1bmsgPSB0aGlzLmZpcnN0Q2h1bms7XG5cdHZhciBjbG9uZWRDaHVuayA9IChjbG9uZWQuZmlyc3RDaHVuayA9IGNsb25lZC5sYXN0U2VhcmNoZWRDaHVuayA9IG9yaWdpbmFsQ2h1bmsuY2xvbmUoKSk7XG5cblx0d2hpbGUgKG9yaWdpbmFsQ2h1bmspIHtcblx0XHRjbG9uZWQuYnlTdGFydFtjbG9uZWRDaHVuay5zdGFydF0gPSBjbG9uZWRDaHVuaztcblx0XHRjbG9uZWQuYnlFbmRbY2xvbmVkQ2h1bmsuZW5kXSA9IGNsb25lZENodW5rO1xuXG5cdFx0dmFyIG5leHRPcmlnaW5hbENodW5rID0gb3JpZ2luYWxDaHVuay5uZXh0O1xuXHRcdHZhciBuZXh0Q2xvbmVkQ2h1bmsgPSBuZXh0T3JpZ2luYWxDaHVuayAmJiBuZXh0T3JpZ2luYWxDaHVuay5jbG9uZSgpO1xuXG5cdFx0aWYgKG5leHRDbG9uZWRDaHVuaykge1xuXHRcdFx0Y2xvbmVkQ2h1bmsubmV4dCA9IG5leHRDbG9uZWRDaHVuaztcblx0XHRcdG5leHRDbG9uZWRDaHVuay5wcmV2aW91cyA9IGNsb25lZENodW5rO1xuXG5cdFx0XHRjbG9uZWRDaHVuayA9IG5leHRDbG9uZWRDaHVuaztcblx0XHR9XG5cblx0XHRvcmlnaW5hbENodW5rID0gbmV4dE9yaWdpbmFsQ2h1bms7XG5cdH1cblxuXHRjbG9uZWQubGFzdENodW5rID0gY2xvbmVkQ2h1bms7XG5cblx0aWYgKHRoaXMuaW5kZW50RXhjbHVzaW9uUmFuZ2VzKSB7XG5cdFx0Y2xvbmVkLmluZGVudEV4Y2x1c2lvblJhbmdlcyA9IHRoaXMuaW5kZW50RXhjbHVzaW9uUmFuZ2VzLnNsaWNlKCk7XG5cdH1cblxuXHRPYmplY3Qua2V5cyh0aGlzLnNvdXJjZW1hcExvY2F0aW9ucykuZm9yRWFjaChmdW5jdGlvbiAobG9jKSB7XG5cdFx0Y2xvbmVkLnNvdXJjZW1hcExvY2F0aW9uc1tsb2NdID0gdHJ1ZTtcblx0fSk7XG5cblx0cmV0dXJuIGNsb25lZDtcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS5nZW5lcmF0ZURlY29kZWRNYXAgPSBmdW5jdGlvbiBnZW5lcmF0ZURlY29kZWRNYXAgKG9wdGlvbnMpIHtcblx0XHR2YXIgdGhpcyQxID0gdGhpcztcblxuXHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuXHR2YXIgc291cmNlSW5kZXggPSAwO1xuXHR2YXIgbmFtZXMgPSBPYmplY3Qua2V5cyh0aGlzLnN0b3JlZE5hbWVzKTtcblx0dmFyIG1hcHBpbmdzID0gbmV3IE1hcHBpbmdzKG9wdGlvbnMuaGlyZXMpO1xuXG5cdHZhciBsb2NhdGUgPSBnZXRMb2NhdG9yJDEodGhpcy5vcmlnaW5hbCk7XG5cblx0aWYgKHRoaXMuaW50cm8pIHtcblx0XHRtYXBwaW5ncy5hZHZhbmNlKHRoaXMuaW50cm8pO1xuXHR9XG5cblx0dGhpcy5maXJzdENodW5rLmVhY2hOZXh0KGZ1bmN0aW9uIChjaHVuaykge1xuXHRcdHZhciBsb2MgPSBsb2NhdGUoY2h1bmsuc3RhcnQpO1xuXG5cdFx0aWYgKGNodW5rLmludHJvLmxlbmd0aCkgeyBtYXBwaW5ncy5hZHZhbmNlKGNodW5rLmludHJvKTsgfVxuXG5cdFx0aWYgKGNodW5rLmVkaXRlZCkge1xuXHRcdFx0bWFwcGluZ3MuYWRkRWRpdChcblx0XHRcdFx0c291cmNlSW5kZXgsXG5cdFx0XHRcdGNodW5rLmNvbnRlbnQsXG5cdFx0XHRcdGxvYyxcblx0XHRcdFx0Y2h1bmsuc3RvcmVOYW1lID8gbmFtZXMuaW5kZXhPZihjaHVuay5vcmlnaW5hbCkgOiAtMVxuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bWFwcGluZ3MuYWRkVW5lZGl0ZWRDaHVuayhzb3VyY2VJbmRleCwgY2h1bmssIHRoaXMkMS5vcmlnaW5hbCwgbG9jLCB0aGlzJDEuc291cmNlbWFwTG9jYXRpb25zKTtcblx0XHR9XG5cblx0XHRpZiAoY2h1bmsub3V0cm8ubGVuZ3RoKSB7IG1hcHBpbmdzLmFkdmFuY2UoY2h1bmsub3V0cm8pOyB9XG5cdH0pO1xuXG5cdHJldHVybiB7XG5cdFx0ZmlsZTogb3B0aW9ucy5maWxlID8gb3B0aW9ucy5maWxlLnNwbGl0KC9bL1xcXFxdLykucG9wKCkgOiBudWxsLFxuXHRcdHNvdXJjZXM6IFtvcHRpb25zLnNvdXJjZSA/IGdldFJlbGF0aXZlUGF0aChvcHRpb25zLmZpbGUgfHwgJycsIG9wdGlvbnMuc291cmNlKSA6IG51bGxdLFxuXHRcdHNvdXJjZXNDb250ZW50OiBvcHRpb25zLmluY2x1ZGVDb250ZW50ID8gW3RoaXMub3JpZ2luYWxdIDogW251bGxdLFxuXHRcdG5hbWVzOiBuYW1lcyxcblx0XHRtYXBwaW5nczogbWFwcGluZ3MucmF3XG5cdH07XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUuZ2VuZXJhdGVNYXAgPSBmdW5jdGlvbiBnZW5lcmF0ZU1hcCAob3B0aW9ucykge1xuXHRyZXR1cm4gbmV3IFNvdXJjZU1hcCQxKHRoaXMuZ2VuZXJhdGVEZWNvZGVkTWFwKG9wdGlvbnMpKTtcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS5nZXRJbmRlbnRTdHJpbmcgPSBmdW5jdGlvbiBnZXRJbmRlbnRTdHJpbmcgKCkge1xuXHRyZXR1cm4gdGhpcy5pbmRlbnRTdHIgPT09IG51bGwgPyAnXFx0JyA6IHRoaXMuaW5kZW50U3RyO1xufTtcblxuTWFnaWNTdHJpbmcucHJvdG90eXBlLmluZGVudCA9IGZ1bmN0aW9uIGluZGVudCAoaW5kZW50U3RyLCBvcHRpb25zKSB7XG5cdHZhciBwYXR0ZXJuID0gL15bXlxcclxcbl0vZ207XG5cblx0aWYgKGlzT2JqZWN0KGluZGVudFN0cikpIHtcblx0XHRvcHRpb25zID0gaW5kZW50U3RyO1xuXHRcdGluZGVudFN0ciA9IHVuZGVmaW5lZDtcblx0fVxuXG5cdGluZGVudFN0ciA9IGluZGVudFN0ciAhPT0gdW5kZWZpbmVkID8gaW5kZW50U3RyIDogdGhpcy5pbmRlbnRTdHIgfHwgJ1xcdCc7XG5cblx0aWYgKGluZGVudFN0ciA9PT0gJycpIHsgcmV0dXJuIHRoaXM7IH0gLy8gbm9vcFxuXG5cdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG5cdC8vIFByb2Nlc3MgZXhjbHVzaW9uIHJhbmdlc1xuXHR2YXIgaXNFeGNsdWRlZCA9IHt9O1xuXG5cdGlmIChvcHRpb25zLmV4Y2x1ZGUpIHtcblx0XHR2YXIgZXhjbHVzaW9ucyA9XG5cdFx0XHR0eXBlb2Ygb3B0aW9ucy5leGNsdWRlWzBdID09PSAnbnVtYmVyJyA/IFtvcHRpb25zLmV4Y2x1ZGVdIDogb3B0aW9ucy5leGNsdWRlO1xuXHRcdGV4Y2x1c2lvbnMuZm9yRWFjaChmdW5jdGlvbiAoZXhjbHVzaW9uKSB7XG5cdFx0XHRmb3IgKHZhciBpID0gZXhjbHVzaW9uWzBdOyBpIDwgZXhjbHVzaW9uWzFdOyBpICs9IDEpIHtcblx0XHRcdFx0aXNFeGNsdWRlZFtpXSA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHR2YXIgc2hvdWxkSW5kZW50TmV4dENoYXJhY3RlciA9IG9wdGlvbnMuaW5kZW50U3RhcnQgIT09IGZhbHNlO1xuXHR2YXIgcmVwbGFjZXIgPSBmdW5jdGlvbiAobWF0Y2gpIHtcblx0XHRpZiAoc2hvdWxkSW5kZW50TmV4dENoYXJhY3RlcikgeyByZXR1cm4gKFwiXCIgKyBpbmRlbnRTdHIgKyBtYXRjaCk7IH1cblx0XHRzaG91bGRJbmRlbnROZXh0Q2hhcmFjdGVyID0gdHJ1ZTtcblx0XHRyZXR1cm4gbWF0Y2g7XG5cdH07XG5cblx0dGhpcy5pbnRybyA9IHRoaXMuaW50cm8ucmVwbGFjZShwYXR0ZXJuLCByZXBsYWNlcik7XG5cblx0dmFyIGNoYXJJbmRleCA9IDA7XG5cdHZhciBjaHVuayA9IHRoaXMuZmlyc3RDaHVuaztcblxuXHR3aGlsZSAoY2h1bmspIHtcblx0XHR2YXIgZW5kID0gY2h1bmsuZW5kO1xuXG5cdFx0aWYgKGNodW5rLmVkaXRlZCkge1xuXHRcdFx0aWYgKCFpc0V4Y2x1ZGVkW2NoYXJJbmRleF0pIHtcblx0XHRcdFx0Y2h1bmsuY29udGVudCA9IGNodW5rLmNvbnRlbnQucmVwbGFjZShwYXR0ZXJuLCByZXBsYWNlcik7XG5cblx0XHRcdFx0aWYgKGNodW5rLmNvbnRlbnQubGVuZ3RoKSB7XG5cdFx0XHRcdFx0c2hvdWxkSW5kZW50TmV4dENoYXJhY3RlciA9IGNodW5rLmNvbnRlbnRbY2h1bmsuY29udGVudC5sZW5ndGggLSAxXSA9PT0gJ1xcbic7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2hhckluZGV4ID0gY2h1bmsuc3RhcnQ7XG5cblx0XHRcdHdoaWxlIChjaGFySW5kZXggPCBlbmQpIHtcblx0XHRcdFx0aWYgKCFpc0V4Y2x1ZGVkW2NoYXJJbmRleF0pIHtcblx0XHRcdFx0XHR2YXIgY2hhciA9IHRoaXMub3JpZ2luYWxbY2hhckluZGV4XTtcblxuXHRcdFx0XHRcdGlmIChjaGFyID09PSAnXFxuJykge1xuXHRcdFx0XHRcdFx0c2hvdWxkSW5kZW50TmV4dENoYXJhY3RlciA9IHRydWU7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChjaGFyICE9PSAnXFxyJyAmJiBzaG91bGRJbmRlbnROZXh0Q2hhcmFjdGVyKSB7XG5cdFx0XHRcdFx0XHRzaG91bGRJbmRlbnROZXh0Q2hhcmFjdGVyID0gZmFsc2U7XG5cblx0XHRcdFx0XHRcdGlmIChjaGFySW5kZXggPT09IGNodW5rLnN0YXJ0KSB7XG5cdFx0XHRcdFx0XHRcdGNodW5rLnByZXBlbmRSaWdodChpbmRlbnRTdHIpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5fc3BsaXRDaHVuayhjaHVuaywgY2hhckluZGV4KTtcblx0XHRcdFx0XHRcdFx0Y2h1bmsgPSBjaHVuay5uZXh0O1xuXHRcdFx0XHRcdFx0XHRjaHVuay5wcmVwZW5kUmlnaHQoaW5kZW50U3RyKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjaGFySW5kZXggKz0gMTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRjaGFySW5kZXggPSBjaHVuay5lbmQ7XG5cdFx0Y2h1bmsgPSBjaHVuay5uZXh0O1xuXHR9XG5cblx0dGhpcy5vdXRybyA9IHRoaXMub3V0cm8ucmVwbGFjZShwYXR0ZXJuLCByZXBsYWNlcik7XG5cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24gaW5zZXJ0ICgpIHtcblx0dGhyb3cgbmV3IEVycm9yKCdtYWdpY1N0cmluZy5pbnNlcnQoLi4uKSBpcyBkZXByZWNhdGVkLiBVc2UgcHJlcGVuZFJpZ2h0KC4uLikgb3IgYXBwZW5kTGVmdCguLi4pJyk7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUuaW5zZXJ0TGVmdCA9IGZ1bmN0aW9uIGluc2VydExlZnQgKGluZGV4LCBjb250ZW50KSB7XG5cdGlmICghd2FybmVkLmluc2VydExlZnQpIHtcblx0XHRjb25zb2xlLndhcm4oJ21hZ2ljU3RyaW5nLmluc2VydExlZnQoLi4uKSBpcyBkZXByZWNhdGVkLiBVc2UgbWFnaWNTdHJpbmcuYXBwZW5kTGVmdCguLi4pIGluc3RlYWQnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlXG5cdFx0d2FybmVkLmluc2VydExlZnQgPSB0cnVlO1xuXHR9XG5cblx0cmV0dXJuIHRoaXMuYXBwZW5kTGVmdChpbmRleCwgY29udGVudCk7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUuaW5zZXJ0UmlnaHQgPSBmdW5jdGlvbiBpbnNlcnRSaWdodCAoaW5kZXgsIGNvbnRlbnQpIHtcblx0aWYgKCF3YXJuZWQuaW5zZXJ0UmlnaHQpIHtcblx0XHRjb25zb2xlLndhcm4oJ21hZ2ljU3RyaW5nLmluc2VydFJpZ2h0KC4uLikgaXMgZGVwcmVjYXRlZC4gVXNlIG1hZ2ljU3RyaW5nLnByZXBlbmRSaWdodCguLi4pIGluc3RlYWQnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlXG5cdFx0d2FybmVkLmluc2VydFJpZ2h0ID0gdHJ1ZTtcblx0fVxuXG5cdHJldHVybiB0aGlzLnByZXBlbmRSaWdodChpbmRleCwgY29udGVudCk7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uIG1vdmUgKHN0YXJ0LCBlbmQsIGluZGV4KSB7XG5cdGlmIChpbmRleCA+PSBzdGFydCAmJiBpbmRleCA8PSBlbmQpIHsgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgbW92ZSBhIHNlbGVjdGlvbiBpbnNpZGUgaXRzZWxmJyk7IH1cblxuXHR0aGlzLl9zcGxpdChzdGFydCk7XG5cdHRoaXMuX3NwbGl0KGVuZCk7XG5cdHRoaXMuX3NwbGl0KGluZGV4KTtcblxuXHR2YXIgZmlyc3QgPSB0aGlzLmJ5U3RhcnRbc3RhcnRdO1xuXHR2YXIgbGFzdCA9IHRoaXMuYnlFbmRbZW5kXTtcblxuXHR2YXIgb2xkTGVmdCA9IGZpcnN0LnByZXZpb3VzO1xuXHR2YXIgb2xkUmlnaHQgPSBsYXN0Lm5leHQ7XG5cblx0dmFyIG5ld1JpZ2h0ID0gdGhpcy5ieVN0YXJ0W2luZGV4XTtcblx0aWYgKCFuZXdSaWdodCAmJiBsYXN0ID09PSB0aGlzLmxhc3RDaHVuaykgeyByZXR1cm4gdGhpczsgfVxuXHR2YXIgbmV3TGVmdCA9IG5ld1JpZ2h0ID8gbmV3UmlnaHQucHJldmlvdXMgOiB0aGlzLmxhc3RDaHVuaztcblxuXHRpZiAob2xkTGVmdCkgeyBvbGRMZWZ0Lm5leHQgPSBvbGRSaWdodDsgfVxuXHRpZiAob2xkUmlnaHQpIHsgb2xkUmlnaHQucHJldmlvdXMgPSBvbGRMZWZ0OyB9XG5cblx0aWYgKG5ld0xlZnQpIHsgbmV3TGVmdC5uZXh0ID0gZmlyc3Q7IH1cblx0aWYgKG5ld1JpZ2h0KSB7IG5ld1JpZ2h0LnByZXZpb3VzID0gbGFzdDsgfVxuXG5cdGlmICghZmlyc3QucHJldmlvdXMpIHsgdGhpcy5maXJzdENodW5rID0gbGFzdC5uZXh0OyB9XG5cdGlmICghbGFzdC5uZXh0KSB7XG5cdFx0dGhpcy5sYXN0Q2h1bmsgPSBmaXJzdC5wcmV2aW91cztcblx0XHR0aGlzLmxhc3RDaHVuay5uZXh0ID0gbnVsbDtcblx0fVxuXG5cdGZpcnN0LnByZXZpb3VzID0gbmV3TGVmdDtcblx0bGFzdC5uZXh0ID0gbmV3UmlnaHQgfHwgbnVsbDtcblxuXHRpZiAoIW5ld0xlZnQpIHsgdGhpcy5maXJzdENodW5rID0gZmlyc3Q7IH1cblx0aWYgKCFuZXdSaWdodCkgeyB0aGlzLmxhc3RDaHVuayA9IGxhc3Q7IH1cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUub3ZlcndyaXRlID0gZnVuY3Rpb24gb3ZlcndyaXRlIChzdGFydCwgZW5kLCBjb250ZW50LCBvcHRpb25zKSB7XG5cdGlmICh0eXBlb2YgY29udGVudCAhPT0gJ3N0cmluZycpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigncmVwbGFjZW1lbnQgY29udGVudCBtdXN0IGJlIGEgc3RyaW5nJyk7IH1cblxuXHR3aGlsZSAoc3RhcnQgPCAwKSB7IHN0YXJ0ICs9IHRoaXMub3JpZ2luYWwubGVuZ3RoOyB9XG5cdHdoaWxlIChlbmQgPCAwKSB7IGVuZCArPSB0aGlzLm9yaWdpbmFsLmxlbmd0aDsgfVxuXG5cdGlmIChlbmQgPiB0aGlzLm9yaWdpbmFsLmxlbmd0aCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2VuZCBpcyBvdXQgb2YgYm91bmRzJyk7IH1cblx0aWYgKHN0YXJ0ID09PSBlbmQpXG5cdFx0eyB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBvdmVyd3JpdGUgYSB6ZXJvLWxlbmd0aCByYW5nZSDigJMgdXNlIGFwcGVuZExlZnQgb3IgcHJlcGVuZFJpZ2h0IGluc3RlYWQnKTsgfVxuXG5cdHRoaXMuX3NwbGl0KHN0YXJ0KTtcblx0dGhpcy5fc3BsaXQoZW5kKTtcblxuXHRpZiAob3B0aW9ucyA9PT0gdHJ1ZSkge1xuXHRcdGlmICghd2FybmVkLnN0b3JlTmFtZSkge1xuXHRcdFx0Y29uc29sZS53YXJuKCdUaGUgZmluYWwgYXJndW1lbnQgdG8gbWFnaWNTdHJpbmcub3ZlcndyaXRlKC4uLikgc2hvdWxkIGJlIGFuIG9wdGlvbnMgb2JqZWN0LiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3JpY2gtaGFycmlzL21hZ2ljLXN0cmluZycpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcblx0XHRcdHdhcm5lZC5zdG9yZU5hbWUgPSB0cnVlO1xuXHRcdH1cblxuXHRcdG9wdGlvbnMgPSB7IHN0b3JlTmFtZTogdHJ1ZSB9O1xuXHR9XG5cdHZhciBzdG9yZU5hbWUgPSBvcHRpb25zICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnN0b3JlTmFtZSA6IGZhbHNlO1xuXHR2YXIgY29udGVudE9ubHkgPSBvcHRpb25zICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbnRlbnRPbmx5IDogZmFsc2U7XG5cblx0aWYgKHN0b3JlTmFtZSkge1xuXHRcdHZhciBvcmlnaW5hbCA9IHRoaXMub3JpZ2luYWwuc2xpY2Uoc3RhcnQsIGVuZCk7XG5cdFx0dGhpcy5zdG9yZWROYW1lc1tvcmlnaW5hbF0gPSB0cnVlO1xuXHR9XG5cblx0dmFyIGZpcnN0ID0gdGhpcy5ieVN0YXJ0W3N0YXJ0XTtcblx0dmFyIGxhc3QgPSB0aGlzLmJ5RW5kW2VuZF07XG5cblx0aWYgKGZpcnN0KSB7XG5cdFx0aWYgKGVuZCA+IGZpcnN0LmVuZCAmJiBmaXJzdC5uZXh0ICE9PSB0aGlzLmJ5U3RhcnRbZmlyc3QuZW5kXSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgb3ZlcndyaXRlIGFjcm9zcyBhIHNwbGl0IHBvaW50Jyk7XG5cdFx0fVxuXG5cdFx0Zmlyc3QuZWRpdChjb250ZW50LCBzdG9yZU5hbWUsIGNvbnRlbnRPbmx5KTtcblxuXHRcdGlmIChmaXJzdCAhPT0gbGFzdCkge1xuXHRcdFx0dmFyIGNodW5rID0gZmlyc3QubmV4dDtcblx0XHRcdHdoaWxlIChjaHVuayAhPT0gbGFzdCkge1xuXHRcdFx0XHRjaHVuay5lZGl0KCcnLCBmYWxzZSk7XG5cdFx0XHRcdGNodW5rID0gY2h1bmsubmV4dDtcblx0XHRcdH1cblxuXHRcdFx0Y2h1bmsuZWRpdCgnJywgZmFsc2UpO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQvLyBtdXN0IGJlIGluc2VydGluZyBhdCB0aGUgZW5kXG5cdFx0dmFyIG5ld0NodW5rID0gbmV3IENodW5rKHN0YXJ0LCBlbmQsICcnKS5lZGl0KGNvbnRlbnQsIHN0b3JlTmFtZSk7XG5cblx0XHQvLyBUT0RPIGxhc3QgY2h1bmsgaW4gdGhlIGFycmF5IG1heSBub3QgYmUgdGhlIGxhc3QgY2h1bmssIGlmIGl0J3MgbW92ZWQuLi5cblx0XHRsYXN0Lm5leHQgPSBuZXdDaHVuaztcblx0XHRuZXdDaHVuay5wcmV2aW91cyA9IGxhc3Q7XG5cdH1cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUucHJlcGVuZCA9IGZ1bmN0aW9uIHByZXBlbmQgKGNvbnRlbnQpIHtcblx0aWYgKHR5cGVvZiBjb250ZW50ICE9PSAnc3RyaW5nJykgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdvdXRybyBjb250ZW50IG11c3QgYmUgYSBzdHJpbmcnKTsgfVxuXG5cdHRoaXMuaW50cm8gPSBjb250ZW50ICsgdGhpcy5pbnRybztcblx0cmV0dXJuIHRoaXM7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUucHJlcGVuZExlZnQgPSBmdW5jdGlvbiBwcmVwZW5kTGVmdCAoaW5kZXgsIGNvbnRlbnQpIHtcblx0aWYgKHR5cGVvZiBjb250ZW50ICE9PSAnc3RyaW5nJykgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnNlcnRlZCBjb250ZW50IG11c3QgYmUgYSBzdHJpbmcnKTsgfVxuXG5cdHRoaXMuX3NwbGl0KGluZGV4KTtcblxuXHR2YXIgY2h1bmsgPSB0aGlzLmJ5RW5kW2luZGV4XTtcblxuXHRpZiAoY2h1bmspIHtcblx0XHRjaHVuay5wcmVwZW5kTGVmdChjb250ZW50KTtcblx0fSBlbHNlIHtcblx0XHR0aGlzLmludHJvID0gY29udGVudCArIHRoaXMuaW50cm87XG5cdH1cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUucHJlcGVuZFJpZ2h0ID0gZnVuY3Rpb24gcHJlcGVuZFJpZ2h0IChpbmRleCwgY29udGVudCkge1xuXHRpZiAodHlwZW9mIGNvbnRlbnQgIT09ICdzdHJpbmcnKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ2luc2VydGVkIGNvbnRlbnQgbXVzdCBiZSBhIHN0cmluZycpOyB9XG5cblx0dGhpcy5fc3BsaXQoaW5kZXgpO1xuXG5cdHZhciBjaHVuayA9IHRoaXMuYnlTdGFydFtpbmRleF07XG5cblx0aWYgKGNodW5rKSB7XG5cdFx0Y2h1bmsucHJlcGVuZFJpZ2h0KGNvbnRlbnQpO1xuXHR9IGVsc2Uge1xuXHRcdHRoaXMub3V0cm8gPSBjb250ZW50ICsgdGhpcy5vdXRybztcblx0fVxuXHRyZXR1cm4gdGhpcztcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiByZW1vdmUgKHN0YXJ0LCBlbmQpIHtcblx0d2hpbGUgKHN0YXJ0IDwgMCkgeyBzdGFydCArPSB0aGlzLm9yaWdpbmFsLmxlbmd0aDsgfVxuXHR3aGlsZSAoZW5kIDwgMCkgeyBlbmQgKz0gdGhpcy5vcmlnaW5hbC5sZW5ndGg7IH1cblxuXHRpZiAoc3RhcnQgPT09IGVuZCkgeyByZXR1cm4gdGhpczsgfVxuXG5cdGlmIChzdGFydCA8IDAgfHwgZW5kID4gdGhpcy5vcmlnaW5hbC5sZW5ndGgpIHsgdGhyb3cgbmV3IEVycm9yKCdDaGFyYWN0ZXIgaXMgb3V0IG9mIGJvdW5kcycpOyB9XG5cdGlmIChzdGFydCA+IGVuZCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2VuZCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBzdGFydCcpOyB9XG5cblx0dGhpcy5fc3BsaXQoc3RhcnQpO1xuXHR0aGlzLl9zcGxpdChlbmQpO1xuXG5cdHZhciBjaHVuayA9IHRoaXMuYnlTdGFydFtzdGFydF07XG5cblx0d2hpbGUgKGNodW5rKSB7XG5cdFx0Y2h1bmsuaW50cm8gPSAnJztcblx0XHRjaHVuay5vdXRybyA9ICcnO1xuXHRcdGNodW5rLmVkaXQoJycpO1xuXG5cdFx0Y2h1bmsgPSBlbmQgPiBjaHVuay5lbmQgPyB0aGlzLmJ5U3RhcnRbY2h1bmsuZW5kXSA6IG51bGw7XG5cdH1cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUubGFzdENoYXIgPSBmdW5jdGlvbiBsYXN0Q2hhciAoKSB7XG5cdGlmICh0aGlzLm91dHJvLmxlbmd0aClcblx0XHR7IHJldHVybiB0aGlzLm91dHJvW3RoaXMub3V0cm8ubGVuZ3RoIC0gMV07IH1cblx0dmFyIGNodW5rID0gdGhpcy5sYXN0Q2h1bms7XG5cdGRvIHtcblx0XHRpZiAoY2h1bmsub3V0cm8ubGVuZ3RoKVxuXHRcdFx0eyByZXR1cm4gY2h1bmsub3V0cm9bY2h1bmsub3V0cm8ubGVuZ3RoIC0gMV07IH1cblx0XHRpZiAoY2h1bmsuY29udGVudC5sZW5ndGgpXG5cdFx0XHR7IHJldHVybiBjaHVuay5jb250ZW50W2NodW5rLmNvbnRlbnQubGVuZ3RoIC0gMV07IH1cblx0XHRpZiAoY2h1bmsuaW50cm8ubGVuZ3RoKVxuXHRcdFx0eyByZXR1cm4gY2h1bmsuaW50cm9bY2h1bmsuaW50cm8ubGVuZ3RoIC0gMV07IH1cblx0fSB3aGlsZSAoY2h1bmsgPSBjaHVuay5wcmV2aW91cyk7XG5cdGlmICh0aGlzLmludHJvLmxlbmd0aClcblx0XHR7IHJldHVybiB0aGlzLmludHJvW3RoaXMuaW50cm8ubGVuZ3RoIC0gMV07IH1cblx0cmV0dXJuICcnO1xufTtcblxuTWFnaWNTdHJpbmcucHJvdG90eXBlLmxhc3RMaW5lID0gZnVuY3Rpb24gbGFzdExpbmUgKCkge1xuXHR2YXIgbGluZUluZGV4ID0gdGhpcy5vdXRyby5sYXN0SW5kZXhPZihuKTtcblx0aWYgKGxpbmVJbmRleCAhPT0gLTEpXG5cdFx0eyByZXR1cm4gdGhpcy5vdXRyby5zdWJzdHIobGluZUluZGV4ICsgMSk7IH1cblx0dmFyIGxpbmVTdHIgPSB0aGlzLm91dHJvO1xuXHR2YXIgY2h1bmsgPSB0aGlzLmxhc3RDaHVuaztcblx0ZG8ge1xuXHRcdGlmIChjaHVuay5vdXRyby5sZW5ndGggPiAwKSB7XG5cdFx0XHRsaW5lSW5kZXggPSBjaHVuay5vdXRyby5sYXN0SW5kZXhPZihuKTtcblx0XHRcdGlmIChsaW5lSW5kZXggIT09IC0xKVxuXHRcdFx0XHR7IHJldHVybiBjaHVuay5vdXRyby5zdWJzdHIobGluZUluZGV4ICsgMSkgKyBsaW5lU3RyOyB9XG5cdFx0XHRsaW5lU3RyID0gY2h1bmsub3V0cm8gKyBsaW5lU3RyO1xuXHRcdH1cblxuXHRcdGlmIChjaHVuay5jb250ZW50Lmxlbmd0aCA+IDApIHtcblx0XHRcdGxpbmVJbmRleCA9IGNodW5rLmNvbnRlbnQubGFzdEluZGV4T2Yobik7XG5cdFx0XHRpZiAobGluZUluZGV4ICE9PSAtMSlcblx0XHRcdFx0eyByZXR1cm4gY2h1bmsuY29udGVudC5zdWJzdHIobGluZUluZGV4ICsgMSkgKyBsaW5lU3RyOyB9XG5cdFx0XHRsaW5lU3RyID0gY2h1bmsuY29udGVudCArIGxpbmVTdHI7XG5cdFx0fVxuXG5cdFx0aWYgKGNodW5rLmludHJvLmxlbmd0aCA+IDApIHtcblx0XHRcdGxpbmVJbmRleCA9IGNodW5rLmludHJvLmxhc3RJbmRleE9mKG4pO1xuXHRcdFx0aWYgKGxpbmVJbmRleCAhPT0gLTEpXG5cdFx0XHRcdHsgcmV0dXJuIGNodW5rLmludHJvLnN1YnN0cihsaW5lSW5kZXggKyAxKSArIGxpbmVTdHI7IH1cblx0XHRcdGxpbmVTdHIgPSBjaHVuay5pbnRybyArIGxpbmVTdHI7XG5cdFx0fVxuXHR9IHdoaWxlIChjaHVuayA9IGNodW5rLnByZXZpb3VzKTtcblx0bGluZUluZGV4ID0gdGhpcy5pbnRyby5sYXN0SW5kZXhPZihuKTtcblx0aWYgKGxpbmVJbmRleCAhPT0gLTEpXG5cdFx0eyByZXR1cm4gdGhpcy5pbnRyby5zdWJzdHIobGluZUluZGV4ICsgMSkgKyBsaW5lU3RyOyB9XG5cdHJldHVybiB0aGlzLmludHJvICsgbGluZVN0cjtcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS5zbGljZSA9IGZ1bmN0aW9uIHNsaWNlIChzdGFydCwgZW5kKSB7XG5cdFx0aWYgKCBzdGFydCA9PT0gdm9pZCAwICkgc3RhcnQgPSAwO1xuXHRcdGlmICggZW5kID09PSB2b2lkIDAgKSBlbmQgPSB0aGlzLm9yaWdpbmFsLmxlbmd0aDtcblxuXHR3aGlsZSAoc3RhcnQgPCAwKSB7IHN0YXJ0ICs9IHRoaXMub3JpZ2luYWwubGVuZ3RoOyB9XG5cdHdoaWxlIChlbmQgPCAwKSB7IGVuZCArPSB0aGlzLm9yaWdpbmFsLmxlbmd0aDsgfVxuXG5cdHZhciByZXN1bHQgPSAnJztcblxuXHQvLyBmaW5kIHN0YXJ0IGNodW5rXG5cdHZhciBjaHVuayA9IHRoaXMuZmlyc3RDaHVuaztcblx0d2hpbGUgKGNodW5rICYmIChjaHVuay5zdGFydCA+IHN0YXJ0IHx8IGNodW5rLmVuZCA8PSBzdGFydCkpIHtcblx0XHQvLyBmb3VuZCBlbmQgY2h1bmsgYmVmb3JlIHN0YXJ0XG5cdFx0aWYgKGNodW5rLnN0YXJ0IDwgZW5kICYmIGNodW5rLmVuZCA+PSBlbmQpIHtcblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fVxuXG5cdFx0Y2h1bmsgPSBjaHVuay5uZXh0O1xuXHR9XG5cblx0aWYgKGNodW5rICYmIGNodW5rLmVkaXRlZCAmJiBjaHVuay5zdGFydCAhPT0gc3RhcnQpXG5cdFx0eyB0aHJvdyBuZXcgRXJyb3IoKFwiQ2Fubm90IHVzZSByZXBsYWNlZCBjaGFyYWN0ZXIgXCIgKyBzdGFydCArIFwiIGFzIHNsaWNlIHN0YXJ0IGFuY2hvci5cIikpOyB9XG5cblx0dmFyIHN0YXJ0Q2h1bmsgPSBjaHVuaztcblx0d2hpbGUgKGNodW5rKSB7XG5cdFx0aWYgKGNodW5rLmludHJvICYmIChzdGFydENodW5rICE9PSBjaHVuayB8fCBjaHVuay5zdGFydCA9PT0gc3RhcnQpKSB7XG5cdFx0XHRyZXN1bHQgKz0gY2h1bmsuaW50cm87XG5cdFx0fVxuXG5cdFx0dmFyIGNvbnRhaW5zRW5kID0gY2h1bmsuc3RhcnQgPCBlbmQgJiYgY2h1bmsuZW5kID49IGVuZDtcblx0XHRpZiAoY29udGFpbnNFbmQgJiYgY2h1bmsuZWRpdGVkICYmIGNodW5rLmVuZCAhPT0gZW5kKVxuXHRcdFx0eyB0aHJvdyBuZXcgRXJyb3IoKFwiQ2Fubm90IHVzZSByZXBsYWNlZCBjaGFyYWN0ZXIgXCIgKyBlbmQgKyBcIiBhcyBzbGljZSBlbmQgYW5jaG9yLlwiKSk7IH1cblxuXHRcdHZhciBzbGljZVN0YXJ0ID0gc3RhcnRDaHVuayA9PT0gY2h1bmsgPyBzdGFydCAtIGNodW5rLnN0YXJ0IDogMDtcblx0XHR2YXIgc2xpY2VFbmQgPSBjb250YWluc0VuZCA/IGNodW5rLmNvbnRlbnQubGVuZ3RoICsgZW5kIC0gY2h1bmsuZW5kIDogY2h1bmsuY29udGVudC5sZW5ndGg7XG5cblx0XHRyZXN1bHQgKz0gY2h1bmsuY29udGVudC5zbGljZShzbGljZVN0YXJ0LCBzbGljZUVuZCk7XG5cblx0XHRpZiAoY2h1bmsub3V0cm8gJiYgKCFjb250YWluc0VuZCB8fCBjaHVuay5lbmQgPT09IGVuZCkpIHtcblx0XHRcdHJlc3VsdCArPSBjaHVuay5vdXRybztcblx0XHR9XG5cblx0XHRpZiAoY29udGFpbnNFbmQpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGNodW5rID0gY2h1bmsubmV4dDtcblx0fVxuXG5cdHJldHVybiByZXN1bHQ7XG59O1xuXG4vLyBUT0RPIGRlcHJlY2F0ZSB0aGlzPyBub3QgcmVhbGx5IHZlcnkgdXNlZnVsXG5NYWdpY1N0cmluZy5wcm90b3R5cGUuc25pcCA9IGZ1bmN0aW9uIHNuaXAgKHN0YXJ0LCBlbmQpIHtcblx0dmFyIGNsb25lID0gdGhpcy5jbG9uZSgpO1xuXHRjbG9uZS5yZW1vdmUoMCwgc3RhcnQpO1xuXHRjbG9uZS5yZW1vdmUoZW5kLCBjbG9uZS5vcmlnaW5hbC5sZW5ndGgpO1xuXG5cdHJldHVybiBjbG9uZTtcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS5fc3BsaXQgPSBmdW5jdGlvbiBfc3BsaXQgKGluZGV4KSB7XG5cdGlmICh0aGlzLmJ5U3RhcnRbaW5kZXhdIHx8IHRoaXMuYnlFbmRbaW5kZXhdKSB7IHJldHVybjsgfVxuXG5cdHZhciBjaHVuayA9IHRoaXMubGFzdFNlYXJjaGVkQ2h1bms7XG5cdHZhciBzZWFyY2hGb3J3YXJkID0gaW5kZXggPiBjaHVuay5lbmQ7XG5cblx0d2hpbGUgKGNodW5rKSB7XG5cdFx0aWYgKGNodW5rLmNvbnRhaW5zKGluZGV4KSkgeyByZXR1cm4gdGhpcy5fc3BsaXRDaHVuayhjaHVuaywgaW5kZXgpOyB9XG5cblx0XHRjaHVuayA9IHNlYXJjaEZvcndhcmQgPyB0aGlzLmJ5U3RhcnRbY2h1bmsuZW5kXSA6IHRoaXMuYnlFbmRbY2h1bmsuc3RhcnRdO1xuXHR9XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUuX3NwbGl0Q2h1bmsgPSBmdW5jdGlvbiBfc3BsaXRDaHVuayAoY2h1bmssIGluZGV4KSB7XG5cdGlmIChjaHVuay5lZGl0ZWQgJiYgY2h1bmsuY29udGVudC5sZW5ndGgpIHtcblx0XHQvLyB6ZXJvLWxlbmd0aCBlZGl0ZWQgY2h1bmtzIGFyZSBhIHNwZWNpYWwgY2FzZSAob3ZlcmxhcHBpbmcgcmVwbGFjZW1lbnRzKVxuXHRcdHZhciBsb2MgPSBnZXRMb2NhdG9yJDEodGhpcy5vcmlnaW5hbCkoaW5kZXgpO1xuXHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdChcIkNhbm5vdCBzcGxpdCBhIGNodW5rIHRoYXQgaGFzIGFscmVhZHkgYmVlbiBlZGl0ZWQgKFwiICsgKGxvYy5saW5lKSArIFwiOlwiICsgKGxvYy5jb2x1bW4pICsgXCIg4oCTIFxcXCJcIiArIChjaHVuay5vcmlnaW5hbCkgKyBcIlxcXCIpXCIpXG5cdFx0KTtcblx0fVxuXG5cdHZhciBuZXdDaHVuayA9IGNodW5rLnNwbGl0KGluZGV4KTtcblxuXHR0aGlzLmJ5RW5kW2luZGV4XSA9IGNodW5rO1xuXHR0aGlzLmJ5U3RhcnRbaW5kZXhdID0gbmV3Q2h1bms7XG5cdHRoaXMuYnlFbmRbbmV3Q2h1bmsuZW5kXSA9IG5ld0NodW5rO1xuXG5cdGlmIChjaHVuayA9PT0gdGhpcy5sYXN0Q2h1bmspIHsgdGhpcy5sYXN0Q2h1bmsgPSBuZXdDaHVuazsgfVxuXG5cdHRoaXMubGFzdFNlYXJjaGVkQ2h1bmsgPSBjaHVuaztcblx0cmV0dXJuIHRydWU7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZyAoKSB7XG5cdHZhciBzdHIgPSB0aGlzLmludHJvO1xuXG5cdHZhciBjaHVuayA9IHRoaXMuZmlyc3RDaHVuaztcblx0d2hpbGUgKGNodW5rKSB7XG5cdFx0c3RyICs9IGNodW5rLnRvU3RyaW5nKCk7XG5cdFx0Y2h1bmsgPSBjaHVuay5uZXh0O1xuXHR9XG5cblx0cmV0dXJuIHN0ciArIHRoaXMub3V0cm87XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUuaXNFbXB0eSA9IGZ1bmN0aW9uIGlzRW1wdHkgKCkge1xuXHR2YXIgY2h1bmsgPSB0aGlzLmZpcnN0Q2h1bms7XG5cdGRvIHtcblx0XHRpZiAoY2h1bmsuaW50cm8ubGVuZ3RoICYmIGNodW5rLmludHJvLnRyaW0oKSB8fFxuXHRcdFx0XHRjaHVuay5jb250ZW50Lmxlbmd0aCAmJiBjaHVuay5jb250ZW50LnRyaW0oKSB8fFxuXHRcdFx0XHRjaHVuay5vdXRyby5sZW5ndGggJiYgY2h1bmsub3V0cm8udHJpbSgpKVxuXHRcdFx0eyByZXR1cm4gZmFsc2U7IH1cblx0fSB3aGlsZSAoY2h1bmsgPSBjaHVuay5uZXh0KTtcblx0cmV0dXJuIHRydWU7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUubGVuZ3RoID0gZnVuY3Rpb24gbGVuZ3RoICgpIHtcblx0dmFyIGNodW5rID0gdGhpcy5maXJzdENodW5rO1xuXHR2YXIgbGVuZ3RoID0gMDtcblx0ZG8ge1xuXHRcdGxlbmd0aCArPSBjaHVuay5pbnRyby5sZW5ndGggKyBjaHVuay5jb250ZW50Lmxlbmd0aCArIGNodW5rLm91dHJvLmxlbmd0aDtcblx0fSB3aGlsZSAoY2h1bmsgPSBjaHVuay5uZXh0KTtcblx0cmV0dXJuIGxlbmd0aDtcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS50cmltTGluZXMgPSBmdW5jdGlvbiB0cmltTGluZXMgKCkge1xuXHRyZXR1cm4gdGhpcy50cmltKCdbXFxcXHJcXFxcbl0nKTtcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS50cmltID0gZnVuY3Rpb24gdHJpbSAoY2hhclR5cGUpIHtcblx0cmV0dXJuIHRoaXMudHJpbVN0YXJ0KGNoYXJUeXBlKS50cmltRW5kKGNoYXJUeXBlKTtcbn07XG5cbk1hZ2ljU3RyaW5nLnByb3RvdHlwZS50cmltRW5kQWJvcnRlZCA9IGZ1bmN0aW9uIHRyaW1FbmRBYm9ydGVkIChjaGFyVHlwZSkge1xuXHR2YXIgcnggPSBuZXcgUmVnRXhwKChjaGFyVHlwZSB8fCAnXFxcXHMnKSArICcrJCcpO1xuXG5cdHRoaXMub3V0cm8gPSB0aGlzLm91dHJvLnJlcGxhY2UocngsICcnKTtcblx0aWYgKHRoaXMub3V0cm8ubGVuZ3RoKSB7IHJldHVybiB0cnVlOyB9XG5cblx0dmFyIGNodW5rID0gdGhpcy5sYXN0Q2h1bms7XG5cblx0ZG8ge1xuXHRcdHZhciBlbmQgPSBjaHVuay5lbmQ7XG5cdFx0dmFyIGFib3J0ZWQgPSBjaHVuay50cmltRW5kKHJ4KTtcblxuXHRcdC8vIGlmIGNodW5rIHdhcyB0cmltbWVkLCB3ZSBoYXZlIGEgbmV3IGxhc3RDaHVua1xuXHRcdGlmIChjaHVuay5lbmQgIT09IGVuZCkge1xuXHRcdFx0aWYgKHRoaXMubGFzdENodW5rID09PSBjaHVuaykge1xuXHRcdFx0XHR0aGlzLmxhc3RDaHVuayA9IGNodW5rLm5leHQ7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuYnlFbmRbY2h1bmsuZW5kXSA9IGNodW5rO1xuXHRcdFx0dGhpcy5ieVN0YXJ0W2NodW5rLm5leHQuc3RhcnRdID0gY2h1bmsubmV4dDtcblx0XHRcdHRoaXMuYnlFbmRbY2h1bmsubmV4dC5lbmRdID0gY2h1bmsubmV4dDtcblx0XHR9XG5cblx0XHRpZiAoYWJvcnRlZCkgeyByZXR1cm4gdHJ1ZTsgfVxuXHRcdGNodW5rID0gY2h1bmsucHJldmlvdXM7XG5cdH0gd2hpbGUgKGNodW5rKTtcblxuXHRyZXR1cm4gZmFsc2U7XG59O1xuXG5NYWdpY1N0cmluZy5wcm90b3R5cGUudHJpbUVuZCA9IGZ1bmN0aW9uIHRyaW1FbmQgKGNoYXJUeXBlKSB7XG5cdHRoaXMudHJpbUVuZEFib3J0ZWQoY2hhclR5cGUpO1xuXHRyZXR1cm4gdGhpcztcbn07XG5NYWdpY1N0cmluZy5wcm90b3R5cGUudHJpbVN0YXJ0QWJvcnRlZCA9IGZ1bmN0aW9uIHRyaW1TdGFydEFib3J0ZWQgKGNoYXJUeXBlKSB7XG5cdHZhciByeCA9IG5ldyBSZWdFeHAoJ14nICsgKGNoYXJUeXBlIHx8ICdcXFxccycpICsgJysnKTtcblxuXHR0aGlzLmludHJvID0gdGhpcy5pbnRyby5yZXBsYWNlKHJ4LCAnJyk7XG5cdGlmICh0aGlzLmludHJvLmxlbmd0aCkgeyByZXR1cm4gdHJ1ZTsgfVxuXG5cdHZhciBjaHVuayA9IHRoaXMuZmlyc3RDaHVuaztcblxuXHRkbyB7XG5cdFx0dmFyIGVuZCA9IGNodW5rLmVuZDtcblx0XHR2YXIgYWJvcnRlZCA9IGNodW5rLnRyaW1TdGFydChyeCk7XG5cblx0XHRpZiAoY2h1bmsuZW5kICE9PSBlbmQpIHtcblx0XHRcdC8vIHNwZWNpYWwgY2FzZS4uLlxuXHRcdFx0aWYgKGNodW5rID09PSB0aGlzLmxhc3RDaHVuaykgeyB0aGlzLmxhc3RDaHVuayA9IGNodW5rLm5leHQ7IH1cblxuXHRcdFx0dGhpcy5ieUVuZFtjaHVuay5lbmRdID0gY2h1bms7XG5cdFx0XHR0aGlzLmJ5U3RhcnRbY2h1bmsubmV4dC5zdGFydF0gPSBjaHVuay5uZXh0O1xuXHRcdFx0dGhpcy5ieUVuZFtjaHVuay5uZXh0LmVuZF0gPSBjaHVuay5uZXh0O1xuXHRcdH1cblxuXHRcdGlmIChhYm9ydGVkKSB7IHJldHVybiB0cnVlOyB9XG5cdFx0Y2h1bmsgPSBjaHVuay5uZXh0O1xuXHR9IHdoaWxlIChjaHVuayk7XG5cblx0cmV0dXJuIGZhbHNlO1xufTtcblxuTWFnaWNTdHJpbmcucHJvdG90eXBlLnRyaW1TdGFydCA9IGZ1bmN0aW9uIHRyaW1TdGFydCAoY2hhclR5cGUpIHtcblx0dGhpcy50cmltU3RhcnRBYm9ydGVkKGNoYXJUeXBlKTtcblx0cmV0dXJuIHRoaXM7XG59O1xuXG5jb25zdCBVTktOT1dOID0ge307XG5mdW5jdGlvbiBnYXRoZXJfcG9zc2libGVfdmFsdWVzKG5vZGUsIHNldCkge1xuICAgIGlmIChub2RlLnR5cGUgPT09ICdMaXRlcmFsJykge1xuICAgICAgICBzZXQuYWRkKG5vZGUudmFsdWUpO1xuICAgIH1cbiAgICBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdDb25kaXRpb25hbEV4cHJlc3Npb24nKSB7XG4gICAgICAgIGdhdGhlcl9wb3NzaWJsZV92YWx1ZXMobm9kZS5jb25zZXF1ZW50LCBzZXQpO1xuICAgICAgICBnYXRoZXJfcG9zc2libGVfdmFsdWVzKG5vZGUuYWx0ZXJuYXRlLCBzZXQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc2V0LmFkZChVTktOT1dOKTtcbiAgICB9XG59XG5cbnZhciBCbG9ja0FwcGxpZXNUb05vZGU7XG4oZnVuY3Rpb24gKEJsb2NrQXBwbGllc1RvTm9kZSkge1xuICAgIEJsb2NrQXBwbGllc1RvTm9kZVtCbG9ja0FwcGxpZXNUb05vZGVbXCJOb3RQb3NzaWJsZVwiXSA9IDBdID0gXCJOb3RQb3NzaWJsZVwiO1xuICAgIEJsb2NrQXBwbGllc1RvTm9kZVtCbG9ja0FwcGxpZXNUb05vZGVbXCJQb3NzaWJsZVwiXSA9IDFdID0gXCJQb3NzaWJsZVwiO1xuICAgIEJsb2NrQXBwbGllc1RvTm9kZVtCbG9ja0FwcGxpZXNUb05vZGVbXCJVbmtub3duU2VsZWN0b3JUeXBlXCJdID0gMl0gPSBcIlVua25vd25TZWxlY3RvclR5cGVcIjtcbn0pKEJsb2NrQXBwbGllc1RvTm9kZSB8fCAoQmxvY2tBcHBsaWVzVG9Ob2RlID0ge30pKTtcbnZhciBOb2RlRXhpc3Q7XG4oZnVuY3Rpb24gKE5vZGVFeGlzdCkge1xuICAgIE5vZGVFeGlzdFtOb2RlRXhpc3RbXCJQcm9iYWJseVwiXSA9IDFdID0gXCJQcm9iYWJseVwiO1xuICAgIE5vZGVFeGlzdFtOb2RlRXhpc3RbXCJEZWZpbml0ZWx5XCJdID0gMl0gPSBcIkRlZmluaXRlbHlcIjtcbn0pKE5vZGVFeGlzdCB8fCAoTm9kZUV4aXN0ID0ge30pKTtcbmNvbnN0IHdoaXRlbGlzdF9hdHRyaWJ1dGVfc2VsZWN0b3IgPSBuZXcgTWFwKFtcbiAgICBbJ2RldGFpbHMnLCBuZXcgU2V0KFsnb3BlbiddKV1cbl0pO1xuY2xhc3MgU2VsZWN0b3IkMSB7XG4gICAgY29uc3RydWN0b3Iobm9kZSwgc3R5bGVzaGVldCkge1xuICAgICAgICB0aGlzLm5vZGUgPSBub2RlO1xuICAgICAgICB0aGlzLnN0eWxlc2hlZXQgPSBzdHlsZXNoZWV0O1xuICAgICAgICB0aGlzLmJsb2NrcyA9IGdyb3VwX3NlbGVjdG9ycyhub2RlKTtcbiAgICAgICAgLy8gdGFrZSB0cmFpbGluZyA6Z2xvYmFsKC4uLikgc2VsZWN0b3JzIG91dCBvZiBjb25zaWRlcmF0aW9uXG4gICAgICAgIGxldCBpID0gdGhpcy5ibG9ja3MubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoaSA+IDApIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5ibG9ja3NbaSAtIDFdLmdsb2JhbClcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGkgLT0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvY2FsX2Jsb2NrcyA9IHRoaXMuYmxvY2tzLnNsaWNlKDAsIGkpO1xuICAgICAgICBjb25zdCBob3N0X29ubHkgPSB0aGlzLmJsb2Nrcy5sZW5ndGggPT09IDEgJiYgdGhpcy5ibG9ja3NbMF0uaG9zdDtcbiAgICAgICAgY29uc3Qgcm9vdF9vbmx5ID0gdGhpcy5ibG9ja3MubGVuZ3RoID09PSAxICYmIHRoaXMuYmxvY2tzWzBdLnJvb3Q7XG4gICAgICAgIHRoaXMudXNlZCA9IHRoaXMubG9jYWxfYmxvY2tzLmxlbmd0aCA9PT0gMCB8fCBob3N0X29ubHkgfHwgcm9vdF9vbmx5O1xuICAgIH1cbiAgICBhcHBseShub2RlKSB7XG4gICAgICAgIGNvbnN0IHRvX2VuY2Fwc3VsYXRlID0gW107XG4gICAgICAgIGFwcGx5X3NlbGVjdG9yKHRoaXMubG9jYWxfYmxvY2tzLnNsaWNlKCksIG5vZGUsIHRvX2VuY2Fwc3VsYXRlKTtcbiAgICAgICAgaWYgKHRvX2VuY2Fwc3VsYXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRvX2VuY2Fwc3VsYXRlLmZvckVhY2goKHsgbm9kZSwgYmxvY2sgfSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGVzaGVldC5ub2Rlc193aXRoX2Nzc19jbGFzcy5hZGQobm9kZSk7XG4gICAgICAgICAgICAgICAgYmxvY2suc2hvdWxkX2VuY2Fwc3VsYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy51c2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBtaW5pZnkoY29kZSkge1xuICAgICAgICBsZXQgYyA9IG51bGw7XG4gICAgICAgIHRoaXMuYmxvY2tzLmZvckVhY2goKGJsb2NrLCBpKSA9PiB7XG4gICAgICAgICAgICBpZiAoaSA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAoYmxvY2suc3RhcnQgLSBjID4gMSkge1xuICAgICAgICAgICAgICAgICAgICBjb2RlLm92ZXJ3cml0ZShjLCBibG9jay5zdGFydCwgYmxvY2suY29tYmluYXRvci5uYW1lIHx8ICcgJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYyA9IGJsb2NrLmVuZDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHRyYW5zZm9ybShjb2RlLCBhdHRyLCBtYXhfYW1vdW50X2NsYXNzX3NwZWNpZmljaXR5X2luY3JlYXNlZCkge1xuICAgICAgICBjb25zdCBhbW91bnRfY2xhc3Nfc3BlY2lmaWNpdHlfdG9faW5jcmVhc2UgPSBtYXhfYW1vdW50X2NsYXNzX3NwZWNpZmljaXR5X2luY3JlYXNlZCAtIHRoaXMuYmxvY2tzLmZpbHRlcihibG9jayA9PiBibG9jay5zaG91bGRfZW5jYXBzdWxhdGUpLmxlbmd0aDtcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlX2dsb2JhbF9wc2V1ZG9fY2xhc3Moc2VsZWN0b3IpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0ID0gc2VsZWN0b3IuY2hpbGRyZW5bMF07XG4gICAgICAgICAgICBjb25zdCBsYXN0ID0gc2VsZWN0b3IuY2hpbGRyZW5bc2VsZWN0b3IuY2hpbGRyZW4ubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICBjb2RlLnJlbW92ZShzZWxlY3Rvci5zdGFydCwgZmlyc3Quc3RhcnQpLnJlbW92ZShsYXN0LmVuZCwgc2VsZWN0b3IuZW5kKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBlbmNhcHN1bGF0ZV9ibG9jayhibG9jaywgYXR0cikge1xuICAgICAgICAgICAgZm9yIChjb25zdCBzZWxlY3RvciBvZiBibG9jay5zZWxlY3RvcnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3IudHlwZSA9PT0gJ1BzZXVkb0NsYXNzU2VsZWN0b3InICYmIHNlbGVjdG9yLm5hbWUgPT09ICdnbG9iYWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZV9nbG9iYWxfcHNldWRvX2NsYXNzKHNlbGVjdG9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgaSA9IGJsb2NrLnNlbGVjdG9ycy5sZW5ndGg7XG4gICAgICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSBibG9jay5zZWxlY3RvcnNbaV07XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdG9yLnR5cGUgPT09ICdQc2V1ZG9FbGVtZW50U2VsZWN0b3InIHx8IHNlbGVjdG9yLnR5cGUgPT09ICdQc2V1ZG9DbGFzc1NlbGVjdG9yJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3IubmFtZSAhPT0gJ3Jvb3QnICYmIHNlbGVjdG9yLm5hbWUgIT09ICdob3N0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5wcmVwZW5kUmlnaHQoc2VsZWN0b3Iuc3RhcnQsIGF0dHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3IudHlwZSA9PT0gJ1R5cGVTZWxlY3RvcicgJiYgc2VsZWN0b3IubmFtZSA9PT0gJyonKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvZGUub3ZlcndyaXRlKHNlbGVjdG9yLnN0YXJ0LCBzZWxlY3Rvci5lbmQsIGF0dHIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29kZS5hcHBlbmRMZWZ0KHNlbGVjdG9yLmVuZCwgYXR0cik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuYmxvY2tzLmZvckVhY2goKGJsb2NrLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKGJsb2NrLmdsb2JhbCkge1xuICAgICAgICAgICAgICAgIHJlbW92ZV9nbG9iYWxfcHNldWRvX2NsYXNzKGJsb2NrLnNlbGVjdG9yc1swXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYmxvY2suc2hvdWxkX2VuY2Fwc3VsYXRlKVxuICAgICAgICAgICAgICAgIGVuY2Fwc3VsYXRlX2Jsb2NrKGJsb2NrLCBpbmRleCA9PT0gdGhpcy5ibG9ja3MubGVuZ3RoIC0gMSA/IGF0dHIucmVwZWF0KGFtb3VudF9jbGFzc19zcGVjaWZpY2l0eV90b19pbmNyZWFzZSArIDEpIDogYXR0cik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB2YWxpZGF0ZShjb21wb25lbnQpIHtcbiAgICAgICAgbGV0IHN0YXJ0ID0gMDtcbiAgICAgICAgbGV0IGVuZCA9IHRoaXMuYmxvY2tzLmxlbmd0aDtcbiAgICAgICAgZm9yICg7IHN0YXJ0IDwgZW5kOyBzdGFydCArPSAxKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYmxvY2tzW3N0YXJ0XS5nbG9iYWwpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICg7IGVuZCA+IHN0YXJ0OyBlbmQgLT0gMSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmJsb2Nrc1tlbmQgLSAxXS5nbG9iYWwpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJsb2Nrc1tpXS5nbG9iYWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKHRoaXMuYmxvY2tzW2ldLnNlbGVjdG9yc1swXSwgY29tcGlsZXJfZXJyb3JzLmNzc19pbnZhbGlkX2dsb2JhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy52YWxpZGF0ZV9nbG9iYWxfd2l0aF9tdWx0aXBsZV9zZWxlY3RvcnMoY29tcG9uZW50KTtcbiAgICB9XG4gICAgdmFsaWRhdGVfZ2xvYmFsX3dpdGhfbXVsdGlwbGVfc2VsZWN0b3JzKGNvbXBvbmVudCkge1xuICAgICAgICBpZiAodGhpcy5ibG9ja3MubGVuZ3RoID09PSAxICYmIHRoaXMuYmxvY2tzWzBdLnNlbGVjdG9ycy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIC8vIHN0YW5kYWxvbmUgOmdsb2JhbCgpIHdpdGggbXVsdGlwbGUgc2VsZWN0b3JzIGlzIE9LXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBibG9jayBvZiB0aGlzLmJsb2Nrcykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBzZWxlY3RvciBvZiBibG9jay5zZWxlY3RvcnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3IudHlwZSA9PT0gJ1BzZXVkb0NsYXNzU2VsZWN0b3InICYmIHNlbGVjdG9yLm5hbWUgPT09ICdnbG9iYWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgvW15cXFxcXSwoPyEoW14oW10rW15cXFxcXXxbXihbXFxcXF0pWylcXF1dKS8udGVzdChzZWxlY3Rvci5jaGlsZHJlblswXS52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5lcnJvcihzZWxlY3RvciwgY29tcGlsZXJfZXJyb3JzLmNzc19pbnZhbGlkX2dsb2JhbF9zZWxlY3Rvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0X2Ftb3VudF9jbGFzc19zcGVjaWZpY2l0eV9pbmNyZWFzZWQoKSB7XG4gICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgYmxvY2sgb2YgdGhpcy5ibG9ja3MpIHtcbiAgICAgICAgICAgIGlmIChibG9jay5zaG91bGRfZW5jYXBzdWxhdGUpIHtcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb3VudDtcbiAgICB9XG59XG5mdW5jdGlvbiBhcHBseV9zZWxlY3RvcihibG9ja3MsIG5vZGUsIHRvX2VuY2Fwc3VsYXRlKSB7XG4gICAgY29uc3QgYmxvY2sgPSBibG9ja3MucG9wKCk7XG4gICAgaWYgKCFibG9jaylcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICghbm9kZSkge1xuICAgICAgICByZXR1cm4gKChibG9jay5nbG9iYWwgJiYgYmxvY2tzLmV2ZXJ5KGJsb2NrID0+IGJsb2NrLmdsb2JhbCkpIHx8XG4gICAgICAgICAgICAoYmxvY2suaG9zdCAmJiBibG9ja3MubGVuZ3RoID09PSAwKSk7XG4gICAgfVxuICAgIHN3aXRjaCAoYmxvY2tfbWlnaHRfYXBwbHlfdG9fbm9kZShibG9jaywgbm9kZSkpIHtcbiAgICAgICAgY2FzZSBCbG9ja0FwcGxpZXNUb05vZGUuTm90UG9zc2libGU6XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNhc2UgQmxvY2tBcHBsaWVzVG9Ob2RlLlVua25vd25TZWxlY3RvclR5cGU6XG4gICAgICAgICAgICAvLyBiYWlsLiBUT0RPIGZpZ3VyZSBvdXQgd2hhdCB0aGVzZSBjb3VsZCBiZVxuICAgICAgICAgICAgdG9fZW5jYXBzdWxhdGUucHVzaCh7IG5vZGUsIGJsb2NrIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChibG9jay5jb21iaW5hdG9yKSB7XG4gICAgICAgIGlmIChibG9jay5jb21iaW5hdG9yLnR5cGUgPT09ICdXaGl0ZVNwYWNlJykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBhbmNlc3Rvcl9ibG9jayBvZiBibG9ja3MpIHtcbiAgICAgICAgICAgICAgICBpZiAoYW5jZXN0b3JfYmxvY2suZ2xvYmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYW5jZXN0b3JfYmxvY2suaG9zdCkge1xuICAgICAgICAgICAgICAgICAgICB0b19lbmNhcHN1bGF0ZS5wdXNoKHsgbm9kZSwgYmxvY2sgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgcGFyZW50ID0gbm9kZTtcbiAgICAgICAgICAgICAgICB3aGlsZSAocGFyZW50ID0gZ2V0X2VsZW1lbnRfcGFyZW50KHBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrX21pZ2h0X2FwcGx5X3RvX25vZGUoYW5jZXN0b3JfYmxvY2ssIHBhcmVudCkgIT09IEJsb2NrQXBwbGllc1RvTm9kZS5Ob3RQb3NzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9fZW5jYXBzdWxhdGUucHVzaCh7IG5vZGU6IHBhcmVudCwgYmxvY2s6IGFuY2VzdG9yX2Jsb2NrIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0b19lbmNhcHN1bGF0ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9fZW5jYXBzdWxhdGUucHVzaCh7IG5vZGUsIGJsb2NrIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYmxvY2tzLmV2ZXJ5KGJsb2NrID0+IGJsb2NrLmdsb2JhbCkpIHtcbiAgICAgICAgICAgICAgICB0b19lbmNhcHN1bGF0ZS5wdXNoKHsgbm9kZSwgYmxvY2sgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYmxvY2suY29tYmluYXRvci5uYW1lID09PSAnPicpIHtcbiAgICAgICAgICAgIGNvbnN0IGhhc19nbG9iYWxfcGFyZW50ID0gYmxvY2tzLmV2ZXJ5KGJsb2NrID0+IGJsb2NrLmdsb2JhbCk7XG4gICAgICAgICAgICBpZiAoaGFzX2dsb2JhbF9wYXJlbnQgfHwgYXBwbHlfc2VsZWN0b3IoYmxvY2tzLCBnZXRfZWxlbWVudF9wYXJlbnQobm9kZSksIHRvX2VuY2Fwc3VsYXRlKSkge1xuICAgICAgICAgICAgICAgIHRvX2VuY2Fwc3VsYXRlLnB1c2goeyBub2RlLCBibG9jayB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChibG9jay5jb21iaW5hdG9yLm5hbWUgPT09ICcrJyB8fCBibG9jay5jb21iaW5hdG9yLm5hbWUgPT09ICd+Jykge1xuICAgICAgICAgICAgY29uc3Qgc2libGluZ3MgPSBnZXRfcG9zc2libGVfZWxlbWVudF9zaWJsaW5ncyhub2RlLCBibG9jay5jb21iaW5hdG9yLm5hbWUgPT09ICcrJyk7XG4gICAgICAgICAgICBsZXQgaGFzX21hdGNoID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBOT1RFOiBpZiB3ZSBoYXZlIDpnbG9iYWwoKSwgd2UgY291bGRuJ3QgZmlndXJlIG91dCB3aGF0IGlzIHNlbGVjdGVkIHdpdGhpbiBgOmdsb2JhbGAgZHVlIHRvIHRoZVxuICAgICAgICAgICAgLy8gY3NzLXRyZWUgbGltaXRhdGlvbiB0aGF0IGRvZXMgbm90IHBhcnNlIHRoZSBpbm5lciBzZWxlY3RvciBvZiA6Z2xvYmFsXG4gICAgICAgICAgICAvLyBzbyB1bmxlc3Mgd2UgYXJlIHN1cmUgdGhlcmUgd2lsbCBiZSBubyBzaWJsaW5nIHRvIG1hdGNoLCB3ZSB3aWxsIGNvbnNpZGVyIGl0IGFzIG1hdGNoZWRcbiAgICAgICAgICAgIGNvbnN0IGhhc19nbG9iYWwgPSBibG9ja3Muc29tZShibG9jayA9PiBibG9jay5nbG9iYWwpO1xuICAgICAgICAgICAgaWYgKGhhc19nbG9iYWwpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2libGluZ3Muc2l6ZSA9PT0gMCAmJiBnZXRfZWxlbWVudF9wYXJlbnQobm9kZSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0b19lbmNhcHN1bGF0ZS5wdXNoKHsgbm9kZSwgYmxvY2sgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHBvc3NpYmxlX3NpYmxpbmcgb2Ygc2libGluZ3Mua2V5cygpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFwcGx5X3NlbGVjdG9yKGJsb2Nrcy5zbGljZSgpLCBwb3NzaWJsZV9zaWJsaW5nLCB0b19lbmNhcHN1bGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9fZW5jYXBzdWxhdGUucHVzaCh7IG5vZGUsIGJsb2NrIH0pO1xuICAgICAgICAgICAgICAgICAgICBoYXNfbWF0Y2ggPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBoYXNfbWF0Y2g7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETyBvdGhlciBjb21iaW5hdG9yc1xuICAgICAgICB0b19lbmNhcHN1bGF0ZS5wdXNoKHsgbm9kZSwgYmxvY2sgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICB0b19lbmNhcHN1bGF0ZS5wdXNoKHsgbm9kZSwgYmxvY2sgfSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBibG9ja19taWdodF9hcHBseV90b19ub2RlKGJsb2NrLCBub2RlKSB7XG4gICAgbGV0IGkgPSBibG9jay5zZWxlY3RvcnMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSBibG9jay5zZWxlY3RvcnNbaV07XG4gICAgICAgIGNvbnN0IG5hbWUgPSB0eXBlb2Ygc2VsZWN0b3IubmFtZSA9PT0gJ3N0cmluZycgJiYgc2VsZWN0b3IubmFtZS5yZXBsYWNlKC9cXFxcKC4pL2csICckMScpO1xuICAgICAgICBpZiAoc2VsZWN0b3IudHlwZSA9PT0gJ1BzZXVkb0NsYXNzU2VsZWN0b3InICYmIChuYW1lID09PSAnaG9zdCcgfHwgbmFtZSA9PT0gJ3Jvb3QnKSkge1xuICAgICAgICAgICAgcmV0dXJuIEJsb2NrQXBwbGllc1RvTm9kZS5Ob3RQb3NzaWJsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYmxvY2suc2VsZWN0b3JzLmxlbmd0aCA9PT0gMSAmJiBzZWxlY3Rvci50eXBlID09PSAnUHNldWRvQ2xhc3NTZWxlY3RvcicgJiYgbmFtZSA9PT0gJ2dsb2JhbCcpIHtcbiAgICAgICAgICAgIHJldHVybiBCbG9ja0FwcGxpZXNUb05vZGUuTm90UG9zc2libGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdG9yLnR5cGUgPT09ICdQc2V1ZG9DbGFzc1NlbGVjdG9yJyB8fCBzZWxlY3Rvci50eXBlID09PSAnUHNldWRvRWxlbWVudFNlbGVjdG9yJykge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdG9yLnR5cGUgPT09ICdDbGFzc1NlbGVjdG9yJykge1xuICAgICAgICAgICAgaWYgKCFhdHRyaWJ1dGVfbWF0Y2hlcyhub2RlLCAnY2xhc3MnLCBuYW1lLCAnfj0nLCBmYWxzZSkgJiYgIW5vZGUuY2xhc3Nlcy5zb21lKGMgPT4gYy5uYW1lID09PSBuYW1lKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gQmxvY2tBcHBsaWVzVG9Ob2RlLk5vdFBvc3NpYmxlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlbGVjdG9yLnR5cGUgPT09ICdJZFNlbGVjdG9yJykge1xuICAgICAgICAgICAgaWYgKCFhdHRyaWJ1dGVfbWF0Y2hlcyhub2RlLCAnaWQnLCBuYW1lLCAnPScsIGZhbHNlKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gQmxvY2tBcHBsaWVzVG9Ob2RlLk5vdFBvc3NpYmxlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlbGVjdG9yLnR5cGUgPT09ICdBdHRyaWJ1dGVTZWxlY3RvcicpIHtcbiAgICAgICAgICAgIGlmICghKHdoaXRlbGlzdF9hdHRyaWJ1dGVfc2VsZWN0b3IuaGFzKG5vZGUubmFtZS50b0xvd2VyQ2FzZSgpKSAmJiB3aGl0ZWxpc3RfYXR0cmlidXRlX3NlbGVjdG9yLmdldChub2RlLm5hbWUudG9Mb3dlckNhc2UoKSkuaGFzKHNlbGVjdG9yLm5hbWUubmFtZS50b0xvd2VyQ2FzZSgpKSkgJiZcbiAgICAgICAgICAgICAgICAhYXR0cmlidXRlX21hdGNoZXMobm9kZSwgc2VsZWN0b3IubmFtZS5uYW1lLCBzZWxlY3Rvci52YWx1ZSAmJiB1bnF1b3RlKHNlbGVjdG9yLnZhbHVlKSwgc2VsZWN0b3IubWF0Y2hlciwgc2VsZWN0b3IuZmxhZ3MpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEJsb2NrQXBwbGllc1RvTm9kZS5Ob3RQb3NzaWJsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzZWxlY3Rvci50eXBlID09PSAnVHlwZVNlbGVjdG9yJykge1xuICAgICAgICAgICAgaWYgKG5vZGUubmFtZS50b0xvd2VyQ2FzZSgpICE9PSBuYW1lLnRvTG93ZXJDYXNlKCkgJiYgbmFtZSAhPT0gJyonKVxuICAgICAgICAgICAgICAgIHJldHVybiBCbG9ja0FwcGxpZXNUb05vZGUuTm90UG9zc2libGU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gQmxvY2tBcHBsaWVzVG9Ob2RlLlVua25vd25TZWxlY3RvclR5cGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIEJsb2NrQXBwbGllc1RvTm9kZS5Qb3NzaWJsZTtcbn1cbmZ1bmN0aW9uIHRlc3RfYXR0cmlidXRlKG9wZXJhdG9yLCBleHBlY3RlZF92YWx1ZSwgY2FzZV9pbnNlbnNpdGl2ZSwgdmFsdWUpIHtcbiAgICBpZiAoY2FzZV9pbnNlbnNpdGl2ZSkge1xuICAgICAgICBleHBlY3RlZF92YWx1ZSA9IGV4cGVjdGVkX3ZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICB9XG4gICAgc3dpdGNoIChvcGVyYXRvcikge1xuICAgICAgICBjYXNlICc9JzogcmV0dXJuIHZhbHVlID09PSBleHBlY3RlZF92YWx1ZTtcbiAgICAgICAgY2FzZSAnfj0nOiByZXR1cm4gdmFsdWUuc3BsaXQoL1xccy8pLmluY2x1ZGVzKGV4cGVjdGVkX3ZhbHVlKTtcbiAgICAgICAgY2FzZSAnfD0nOiByZXR1cm4gYCR7dmFsdWV9LWAuc3RhcnRzV2l0aChgJHtleHBlY3RlZF92YWx1ZX0tYCk7XG4gICAgICAgIGNhc2UgJ149JzogcmV0dXJuIHZhbHVlLnN0YXJ0c1dpdGgoZXhwZWN0ZWRfdmFsdWUpO1xuICAgICAgICBjYXNlICckPSc6IHJldHVybiB2YWx1ZS5lbmRzV2l0aChleHBlY3RlZF92YWx1ZSk7XG4gICAgICAgIGNhc2UgJyo9JzogcmV0dXJuIHZhbHVlLmluY2x1ZGVzKGV4cGVjdGVkX3ZhbHVlKTtcbiAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKFwidGhpcyBzaG91bGRuJ3QgaGFwcGVuXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGF0dHJpYnV0ZV9tYXRjaGVzKG5vZGUsIG5hbWUsIGV4cGVjdGVkX3ZhbHVlLCBvcGVyYXRvciwgY2FzZV9pbnNlbnNpdGl2ZSkge1xuICAgIGNvbnN0IHNwcmVhZCA9IG5vZGUuYXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci50eXBlID09PSAnU3ByZWFkJyk7XG4gICAgaWYgKHNwcmVhZClcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgaWYgKG5vZGUuYmluZGluZ3Muc29tZSgoYmluZGluZykgPT4gYmluZGluZy5uYW1lID09PSBuYW1lKSlcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgY29uc3QgYXR0ciA9IG5vZGUuYXR0cmlidXRlcy5maW5kKChhdHRyKSA9PiBhdHRyLm5hbWUgPT09IG5hbWUpO1xuICAgIGlmICghYXR0cilcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChhdHRyLmlzX3RydWUpXG4gICAgICAgIHJldHVybiBvcGVyYXRvciA9PT0gbnVsbDtcbiAgICBpZiAoIWV4cGVjdGVkX3ZhbHVlKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoYXR0ci5jaHVua3MubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gYXR0ci5jaHVua3NbMF07XG4gICAgICAgIGlmICghdmFsdWUpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICh2YWx1ZS50eXBlID09PSAnVGV4dCcpXG4gICAgICAgICAgICByZXR1cm4gdGVzdF9hdHRyaWJ1dGUob3BlcmF0b3IsIGV4cGVjdGVkX3ZhbHVlLCBjYXNlX2luc2Vuc2l0aXZlLCB2YWx1ZS5kYXRhKTtcbiAgICB9XG4gICAgY29uc3QgcG9zc2libGVfdmFsdWVzID0gbmV3IFNldCgpO1xuICAgIGxldCBwcmV2X3ZhbHVlcyA9IFtdO1xuICAgIGZvciAoY29uc3QgY2h1bmsgb2YgYXR0ci5jaHVua3MpIHtcbiAgICAgICAgY29uc3QgY3VycmVudF9wb3NzaWJsZV92YWx1ZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIGlmIChjaHVuay50eXBlID09PSAnVGV4dCcpIHtcbiAgICAgICAgICAgIGN1cnJlbnRfcG9zc2libGVfdmFsdWVzLmFkZChjaHVuay5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGdhdGhlcl9wb3NzaWJsZV92YWx1ZXMoY2h1bmsubm9kZSwgY3VycmVudF9wb3NzaWJsZV92YWx1ZXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGltcG9zc2libGUgdG8gZmluZCBvdXQgYWxsIGNvbWJpbmF0aW9uc1xuICAgICAgICBpZiAoY3VycmVudF9wb3NzaWJsZV92YWx1ZXMuaGFzKFVOS05PV04pKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmIChwcmV2X3ZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBzdGFydF93aXRoX3NwYWNlID0gW107XG4gICAgICAgICAgICBjb25zdCByZW1haW5pbmcgPSBbXTtcbiAgICAgICAgICAgIGN1cnJlbnRfcG9zc2libGVfdmFsdWVzLmZvckVhY2goKGN1cnJlbnRfcG9zc2libGVfdmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoL15cXHMvLnRlc3QoY3VycmVudF9wb3NzaWJsZV92YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRfd2l0aF9zcGFjZS5wdXNoKGN1cnJlbnRfcG9zc2libGVfdmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nLnB1c2goY3VycmVudF9wb3NzaWJsZV92YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAocmVtYWluaW5nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhcnRfd2l0aF9zcGFjZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZXZfdmFsdWVzLmZvckVhY2gocHJldl92YWx1ZSA9PiBwb3NzaWJsZV92YWx1ZXMuYWRkKHByZXZfdmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgY29tYmluZWQgPSBbXTtcbiAgICAgICAgICAgICAgICBwcmV2X3ZhbHVlcy5mb3JFYWNoKChwcmV2X3ZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZy5mb3JFYWNoKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tYmluZWQucHVzaChwcmV2X3ZhbHVlICsgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBwcmV2X3ZhbHVlcyA9IGNvbWJpbmVkO1xuICAgICAgICAgICAgICAgIHN0YXJ0X3dpdGhfc3BhY2UuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKC9cXHMkLy50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zc2libGVfdmFsdWVzLmFkZCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2X3ZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcHJldl92YWx1ZXMuZm9yRWFjaChwcmV2X3ZhbHVlID0+IHBvc3NpYmxlX3ZhbHVlcy5hZGQocHJldl92YWx1ZSkpO1xuICAgICAgICAgICAgICAgIHByZXZfdmFsdWVzID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudF9wb3NzaWJsZV92YWx1ZXMuZm9yRWFjaCgoY3VycmVudF9wb3NzaWJsZV92YWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKC9cXHMkLy50ZXN0KGN1cnJlbnRfcG9zc2libGVfdmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcG9zc2libGVfdmFsdWVzLmFkZChjdXJyZW50X3Bvc3NpYmxlX3ZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHByZXZfdmFsdWVzLnB1c2goY3VycmVudF9wb3NzaWJsZV92YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAocHJldl92YWx1ZXMubGVuZ3RoIDwgY3VycmVudF9wb3NzaWJsZV92YWx1ZXMuc2l6ZSkge1xuICAgICAgICAgICAgcHJldl92YWx1ZXMucHVzaCgnICcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcmV2X3ZhbHVlcy5sZW5ndGggPiAyMCkge1xuICAgICAgICAgICAgLy8gbWlnaHQgZ3JvdyBleHBvbmVudGlhbGx5LCBiYWlsIG91dFxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJldl92YWx1ZXMuZm9yRWFjaChwcmV2X3ZhbHVlID0+IHBvc3NpYmxlX3ZhbHVlcy5hZGQocHJldl92YWx1ZSkpO1xuICAgIGlmIChwb3NzaWJsZV92YWx1ZXMuaGFzKFVOS05PV04pKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHBvc3NpYmxlX3ZhbHVlcykge1xuICAgICAgICBpZiAodGVzdF9hdHRyaWJ1dGUob3BlcmF0b3IsIGV4cGVjdGVkX3ZhbHVlLCBjYXNlX2luc2Vuc2l0aXZlLCB2YWx1ZSkpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuZnVuY3Rpb24gdW5xdW90ZSh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZS50eXBlID09PSAnSWRlbnRpZmllcicpXG4gICAgICAgIHJldHVybiB2YWx1ZS5uYW1lO1xuICAgIGNvbnN0IHN0ciA9IHZhbHVlLnZhbHVlO1xuICAgIGlmIChzdHJbMF0gPT09IHN0cltzdHIubGVuZ3RoIC0gMV0gJiYgc3RyWzBdID09PSBcIidcIiB8fCBzdHJbMF0gPT09ICdcIicpIHtcbiAgICAgICAgcmV0dXJuIHN0ci5zbGljZSgxLCBzdHIubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIHJldHVybiBzdHI7XG59XG5mdW5jdGlvbiBnZXRfZWxlbWVudF9wYXJlbnQobm9kZSkge1xuICAgIGxldCBwYXJlbnQgPSBub2RlO1xuICAgIHdoaWxlICgocGFyZW50ID0gcGFyZW50LnBhcmVudCkgJiYgcGFyZW50LnR5cGUgIT09ICdFbGVtZW50JylcbiAgICAgICAgO1xuICAgIHJldHVybiBwYXJlbnQ7XG59XG5mdW5jdGlvbiBnZXRfcG9zc2libGVfZWxlbWVudF9zaWJsaW5ncyhub2RlLCBhZGphY2VudF9vbmx5KSB7XG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IE1hcCgpO1xuICAgIGxldCBwcmV2ID0gbm9kZTtcbiAgICB3aGlsZSAocHJldiA9IHByZXYucHJldikge1xuICAgICAgICBpZiAocHJldi50eXBlID09PSAnRWxlbWVudCcpIHtcbiAgICAgICAgICAgIGlmICghcHJldi5hdHRyaWJ1dGVzLmZpbmQoYXR0ciA9PiBhdHRyLnR5cGUgPT09ICdBdHRyaWJ1dGUnICYmIGF0dHIubmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc2xvdCcpKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnNldChwcmV2LCBOb2RlRXhpc3QuRGVmaW5pdGVseSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYWRqYWNlbnRfb25seSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHByZXYudHlwZSA9PT0gJ0VhY2hCbG9jaycgfHwgcHJldi50eXBlID09PSAnSWZCbG9jaycgfHwgcHJldi50eXBlID09PSAnQXdhaXRCbG9jaycpIHtcbiAgICAgICAgICAgIGNvbnN0IHBvc3NpYmxlX2xhc3RfY2hpbGQgPSBnZXRfcG9zc2libGVfbGFzdF9jaGlsZChwcmV2LCBhZGphY2VudF9vbmx5KTtcbiAgICAgICAgICAgIGFkZF90b19tYXAocG9zc2libGVfbGFzdF9jaGlsZCwgcmVzdWx0KTtcbiAgICAgICAgICAgIGlmIChhZGphY2VudF9vbmx5ICYmIGhhc19kZWZpbml0ZV9lbGVtZW50cyhwb3NzaWJsZV9sYXN0X2NoaWxkKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFwcmV2IHx8ICFhZGphY2VudF9vbmx5KSB7XG4gICAgICAgIGxldCBwYXJlbnQgPSBub2RlO1xuICAgICAgICBsZXQgc2tpcF9lYWNoX2Zvcl9sYXN0X2NoaWxkID0gbm9kZS50eXBlID09PSAnRWxzZUJsb2NrJztcbiAgICAgICAgd2hpbGUgKChwYXJlbnQgPSBwYXJlbnQucGFyZW50KSAmJiAocGFyZW50LnR5cGUgPT09ICdFYWNoQmxvY2snIHx8IHBhcmVudC50eXBlID09PSAnSWZCbG9jaycgfHwgcGFyZW50LnR5cGUgPT09ICdFbHNlQmxvY2snIHx8IHBhcmVudC50eXBlID09PSAnQXdhaXRCbG9jaycpKSB7XG4gICAgICAgICAgICBjb25zdCBwb3NzaWJsZV9zaWJsaW5ncyA9IGdldF9wb3NzaWJsZV9lbGVtZW50X3NpYmxpbmdzKHBhcmVudCwgYWRqYWNlbnRfb25seSk7XG4gICAgICAgICAgICBhZGRfdG9fbWFwKHBvc3NpYmxlX3NpYmxpbmdzLCByZXN1bHQpO1xuICAgICAgICAgICAgaWYgKHBhcmVudC50eXBlID09PSAnRWFjaEJsb2NrJykge1xuICAgICAgICAgICAgICAgIC8vIGZpcnN0IGNoaWxkIG9mIGVhY2ggYmxvY2sgY2FuIHNlbGVjdCB0aGUgbGFzdCBjaGlsZCBvZiBlYWNoIGJsb2NrIGFzIHByZXZpb3VzIHNpYmxpbmdcbiAgICAgICAgICAgICAgICBpZiAoc2tpcF9lYWNoX2Zvcl9sYXN0X2NoaWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNraXBfZWFjaF9mb3JfbGFzdF9jaGlsZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkX3RvX21hcChnZXRfcG9zc2libGVfbGFzdF9jaGlsZChwYXJlbnQsIGFkamFjZW50X29ubHkpLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBhcmVudC50eXBlID09PSAnRWxzZUJsb2NrJykge1xuICAgICAgICAgICAgICAgIHNraXBfZWFjaF9mb3JfbGFzdF9jaGlsZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhZGphY2VudF9vbmx5ICYmIGhhc19kZWZpbml0ZV9lbGVtZW50cyhwb3NzaWJsZV9zaWJsaW5ncykpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gZ2V0X3Bvc3NpYmxlX2xhc3RfY2hpbGQoYmxvY2ssIGFkamFjZW50X29ubHkpIHtcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgTWFwKCk7XG4gICAgaWYgKGJsb2NrLnR5cGUgPT09ICdFYWNoQmxvY2snKSB7XG4gICAgICAgIGNvbnN0IGVhY2hfcmVzdWx0ID0gbG9vcF9jaGlsZChibG9jay5jaGlsZHJlbiwgYWRqYWNlbnRfb25seSk7XG4gICAgICAgIGNvbnN0IGVsc2VfcmVzdWx0ID0gYmxvY2suZWxzZSA/IGxvb3BfY2hpbGQoYmxvY2suZWxzZS5jaGlsZHJlbiwgYWRqYWNlbnRfb25seSkgOiBuZXcgTWFwKCk7XG4gICAgICAgIGNvbnN0IG5vdF9leGhhdXN0aXZlID0gIWhhc19kZWZpbml0ZV9lbGVtZW50cyhlbHNlX3Jlc3VsdCk7XG4gICAgICAgIGlmIChub3RfZXhoYXVzdGl2ZSkge1xuICAgICAgICAgICAgbWFya19hc19wcm9iYWJseShlYWNoX3Jlc3VsdCk7XG4gICAgICAgICAgICBtYXJrX2FzX3Byb2JhYmx5KGVsc2VfcmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgICBhZGRfdG9fbWFwKGVhY2hfcmVzdWx0LCByZXN1bHQpO1xuICAgICAgICBhZGRfdG9fbWFwKGVsc2VfcmVzdWx0LCByZXN1bHQpO1xuICAgIH1cbiAgICBlbHNlIGlmIChibG9jay50eXBlID09PSAnSWZCbG9jaycpIHtcbiAgICAgICAgY29uc3QgaWZfcmVzdWx0ID0gbG9vcF9jaGlsZChibG9jay5jaGlsZHJlbiwgYWRqYWNlbnRfb25seSk7XG4gICAgICAgIGNvbnN0IGVsc2VfcmVzdWx0ID0gYmxvY2suZWxzZSA/IGxvb3BfY2hpbGQoYmxvY2suZWxzZS5jaGlsZHJlbiwgYWRqYWNlbnRfb25seSkgOiBuZXcgTWFwKCk7XG4gICAgICAgIGNvbnN0IG5vdF9leGhhdXN0aXZlID0gIWhhc19kZWZpbml0ZV9lbGVtZW50cyhpZl9yZXN1bHQpIHx8ICFoYXNfZGVmaW5pdGVfZWxlbWVudHMoZWxzZV9yZXN1bHQpO1xuICAgICAgICBpZiAobm90X2V4aGF1c3RpdmUpIHtcbiAgICAgICAgICAgIG1hcmtfYXNfcHJvYmFibHkoaWZfcmVzdWx0KTtcbiAgICAgICAgICAgIG1hcmtfYXNfcHJvYmFibHkoZWxzZV9yZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIGFkZF90b19tYXAoaWZfcmVzdWx0LCByZXN1bHQpO1xuICAgICAgICBhZGRfdG9fbWFwKGVsc2VfcmVzdWx0LCByZXN1bHQpO1xuICAgIH1cbiAgICBlbHNlIGlmIChibG9jay50eXBlID09PSAnQXdhaXRCbG9jaycpIHtcbiAgICAgICAgY29uc3QgcGVuZGluZ19yZXN1bHQgPSBibG9jay5wZW5kaW5nID8gbG9vcF9jaGlsZChibG9jay5wZW5kaW5nLmNoaWxkcmVuLCBhZGphY2VudF9vbmx5KSA6IG5ldyBNYXAoKTtcbiAgICAgICAgY29uc3QgdGhlbl9yZXN1bHQgPSBibG9jay50aGVuID8gbG9vcF9jaGlsZChibG9jay50aGVuLmNoaWxkcmVuLCBhZGphY2VudF9vbmx5KSA6IG5ldyBNYXAoKTtcbiAgICAgICAgY29uc3QgY2F0Y2hfcmVzdWx0ID0gYmxvY2suY2F0Y2ggPyBsb29wX2NoaWxkKGJsb2NrLmNhdGNoLmNoaWxkcmVuLCBhZGphY2VudF9vbmx5KSA6IG5ldyBNYXAoKTtcbiAgICAgICAgY29uc3Qgbm90X2V4aGF1c3RpdmUgPSAhaGFzX2RlZmluaXRlX2VsZW1lbnRzKHBlbmRpbmdfcmVzdWx0KSB8fCAhaGFzX2RlZmluaXRlX2VsZW1lbnRzKHRoZW5fcmVzdWx0KSB8fCAhaGFzX2RlZmluaXRlX2VsZW1lbnRzKGNhdGNoX3Jlc3VsdCk7XG4gICAgICAgIGlmIChub3RfZXhoYXVzdGl2ZSkge1xuICAgICAgICAgICAgbWFya19hc19wcm9iYWJseShwZW5kaW5nX3Jlc3VsdCk7XG4gICAgICAgICAgICBtYXJrX2FzX3Byb2JhYmx5KHRoZW5fcmVzdWx0KTtcbiAgICAgICAgICAgIG1hcmtfYXNfcHJvYmFibHkoY2F0Y2hfcmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgICBhZGRfdG9fbWFwKHBlbmRpbmdfcmVzdWx0LCByZXN1bHQpO1xuICAgICAgICBhZGRfdG9fbWFwKHRoZW5fcmVzdWx0LCByZXN1bHQpO1xuICAgICAgICBhZGRfdG9fbWFwKGNhdGNoX3Jlc3VsdCwgcmVzdWx0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGhhc19kZWZpbml0ZV9lbGVtZW50cyhyZXN1bHQpIHtcbiAgICBpZiAocmVzdWx0LnNpemUgPT09IDApXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IGV4aXN0IG9mIHJlc3VsdC52YWx1ZXMoKSkge1xuICAgICAgICBpZiAoZXhpc3QgPT09IE5vZGVFeGlzdC5EZWZpbml0ZWx5KSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5mdW5jdGlvbiBhZGRfdG9fbWFwKGZyb20sIHRvKSB7XG4gICAgZnJvbS5mb3JFYWNoKChleGlzdCwgZWxlbWVudCkgPT4ge1xuICAgICAgICB0by5zZXQoZWxlbWVudCwgaGlnaGVyX2V4aXN0ZW5jZShleGlzdCwgdG8uZ2V0KGVsZW1lbnQpKSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBoaWdoZXJfZXhpc3RlbmNlKGV4aXN0MSwgZXhpc3QyKSB7XG4gICAgaWYgKGV4aXN0MSA9PT0gdW5kZWZpbmVkIHx8IGV4aXN0MiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm4gZXhpc3QxIHx8IGV4aXN0MjtcbiAgICByZXR1cm4gZXhpc3QxID4gZXhpc3QyID8gZXhpc3QxIDogZXhpc3QyO1xufVxuZnVuY3Rpb24gbWFya19hc19wcm9iYWJseShyZXN1bHQpIHtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiByZXN1bHQua2V5cygpKSB7XG4gICAgICAgIHJlc3VsdC5zZXQoa2V5LCBOb2RlRXhpc3QuUHJvYmFibHkpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGxvb3BfY2hpbGQoY2hpbGRyZW4sIGFkamFjZW50X29ubHkpIHtcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgTWFwKCk7XG4gICAgZm9yIChsZXQgaSA9IGNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07XG4gICAgICAgIGlmIChjaGlsZC50eXBlID09PSAnRWxlbWVudCcpIHtcbiAgICAgICAgICAgIHJlc3VsdC5zZXQoY2hpbGQsIE5vZGVFeGlzdC5EZWZpbml0ZWx5KTtcbiAgICAgICAgICAgIGlmIChhZGphY2VudF9vbmx5KSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2hpbGQudHlwZSA9PT0gJ0VhY2hCbG9jaycgfHwgY2hpbGQudHlwZSA9PT0gJ0lmQmxvY2snIHx8IGNoaWxkLnR5cGUgPT09ICdBd2FpdEJsb2NrJykge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRfcmVzdWx0ID0gZ2V0X3Bvc3NpYmxlX2xhc3RfY2hpbGQoY2hpbGQsIGFkamFjZW50X29ubHkpO1xuICAgICAgICAgICAgYWRkX3RvX21hcChjaGlsZF9yZXN1bHQsIHJlc3VsdCk7XG4gICAgICAgICAgICBpZiAoYWRqYWNlbnRfb25seSAmJiBoYXNfZGVmaW5pdGVfZWxlbWVudHMoY2hpbGRfcmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5jbGFzcyBCbG9jayQyIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21iaW5hdG9yKSB7XG4gICAgICAgIHRoaXMuY29tYmluYXRvciA9IGNvbWJpbmF0b3I7XG4gICAgICAgIHRoaXMuaG9zdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJvb3QgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZWxlY3RvcnMgPSBbXTtcbiAgICAgICAgdGhpcy5zdGFydCA9IG51bGw7XG4gICAgICAgIHRoaXMuZW5kID0gbnVsbDtcbiAgICAgICAgdGhpcy5zaG91bGRfZW5jYXBzdWxhdGUgPSBmYWxzZTtcbiAgICB9XG4gICAgYWRkKHNlbGVjdG9yKSB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdG9ycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnQgPSBzZWxlY3Rvci5zdGFydDtcbiAgICAgICAgICAgIHRoaXMuaG9zdCA9IHNlbGVjdG9yLnR5cGUgPT09ICdQc2V1ZG9DbGFzc1NlbGVjdG9yJyAmJiBzZWxlY3Rvci5uYW1lID09PSAnaG9zdCc7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yb290ID0gdGhpcy5yb290IHx8IHNlbGVjdG9yLnR5cGUgPT09ICdQc2V1ZG9DbGFzc1NlbGVjdG9yJyAmJiBzZWxlY3Rvci5uYW1lID09PSAncm9vdCc7XG4gICAgICAgIHRoaXMuc2VsZWN0b3JzLnB1c2goc2VsZWN0b3IpO1xuICAgICAgICB0aGlzLmVuZCA9IHNlbGVjdG9yLmVuZDtcbiAgICB9XG4gICAgZ2V0IGdsb2JhbCgpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnNlbGVjdG9ycy5sZW5ndGggPj0gMSAmJlxuICAgICAgICAgICAgdGhpcy5zZWxlY3RvcnNbMF0udHlwZSA9PT0gJ1BzZXVkb0NsYXNzU2VsZWN0b3InICYmXG4gICAgICAgICAgICB0aGlzLnNlbGVjdG9yc1swXS5uYW1lID09PSAnZ2xvYmFsJyAmJlxuICAgICAgICAgICAgdGhpcy5zZWxlY3RvcnMuZXZlcnkoKHNlbGVjdG9yKSA9PiBzZWxlY3Rvci50eXBlID09PSAnUHNldWRvQ2xhc3NTZWxlY3RvcicgfHwgc2VsZWN0b3IudHlwZSA9PT0gJ1BzZXVkb0VsZW1lbnRTZWxlY3RvcicpKTtcbiAgICB9XG59XG5mdW5jdGlvbiBncm91cF9zZWxlY3RvcnMoc2VsZWN0b3IpIHtcbiAgICBsZXQgYmxvY2sgPSBuZXcgQmxvY2skMihudWxsKTtcbiAgICBjb25zdCBibG9ja3MgPSBbYmxvY2tdO1xuICAgIHNlbGVjdG9yLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkKSA9PiB7XG4gICAgICAgIGlmIChjaGlsZC50eXBlID09PSAnV2hpdGVTcGFjZScgfHwgY2hpbGQudHlwZSA9PT0gJ0NvbWJpbmF0b3InKSB7XG4gICAgICAgICAgICBibG9jayA9IG5ldyBCbG9jayQyKGNoaWxkKTtcbiAgICAgICAgICAgIGJsb2Nrcy5wdXNoKGJsb2NrKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJsb2NrLmFkZChjaGlsZCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gYmxvY2tzO1xufVxuXG5mdW5jdGlvbiByZW1vdmVfY3NzX3ByZWZpeChuYW1lKSB7XG4gICAgcmV0dXJuIG5hbWUucmVwbGFjZSgvXi0oKHdlYmtpdCl8KG1veil8KG8pfChtcykpLS8sICcnKTtcbn1cbmNvbnN0IGlzX2tleWZyYW1lc19ub2RlID0gKG5vZGUpID0+IHJlbW92ZV9jc3NfcHJlZml4KG5vZGUubmFtZSkgPT09ICdrZXlmcmFtZXMnO1xuY29uc3QgYXRfcnVsZV9oYXNfZGVjbGFyYXRpb24gPSAoeyBibG9jayB9KSA9PiBibG9jayAmJlxuICAgIGJsb2NrLmNoaWxkcmVuICYmXG4gICAgYmxvY2suY2hpbGRyZW4uZmluZCgobm9kZSkgPT4gbm9kZS50eXBlID09PSAnRGVjbGFyYXRpb24nKTtcbmZ1bmN0aW9uIG1pbmlmeV9kZWNsYXJhdGlvbnMoY29kZSwgc3RhcnQsIGRlY2xhcmF0aW9ucykge1xuICAgIGxldCBjID0gc3RhcnQ7XG4gICAgZGVjbGFyYXRpb25zLmZvckVhY2goKGRlY2xhcmF0aW9uLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHNlcGFyYXRvciA9IGkgPiAwID8gJzsnIDogJyc7XG4gICAgICAgIGlmICgoZGVjbGFyYXRpb24ubm9kZS5zdGFydCAtIGMpID4gc2VwYXJhdG9yLmxlbmd0aCkge1xuICAgICAgICAgICAgY29kZS5vdmVyd3JpdGUoYywgZGVjbGFyYXRpb24ubm9kZS5zdGFydCwgc2VwYXJhdG9yKTtcbiAgICAgICAgfVxuICAgICAgICBkZWNsYXJhdGlvbi5taW5pZnkoY29kZSk7XG4gICAgICAgIGMgPSBkZWNsYXJhdGlvbi5ub2RlLmVuZDtcbiAgICB9KTtcbiAgICByZXR1cm4gYztcbn1cbmNsYXNzIFJ1bGUkMSB7XG4gICAgY29uc3RydWN0b3Iobm9kZSwgc3R5bGVzaGVldCwgcGFyZW50KSB7XG4gICAgICAgIHRoaXMubm9kZSA9IG5vZGU7XG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgICAgICB0aGlzLnNlbGVjdG9ycyA9IG5vZGUucHJlbHVkZS5jaGlsZHJlbi5tYXAoKG5vZGUpID0+IG5ldyBTZWxlY3RvciQxKG5vZGUsIHN0eWxlc2hlZXQpKTtcbiAgICAgICAgdGhpcy5kZWNsYXJhdGlvbnMgPSBub2RlLmJsb2NrLmNoaWxkcmVuLm1hcCgobm9kZSkgPT4gbmV3IERlY2xhcmF0aW9uJDEobm9kZSkpO1xuICAgIH1cbiAgICBhcHBseShub2RlKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4gc2VsZWN0b3IuYXBwbHkobm9kZSkpOyAvLyBUT0RPIG1vdmUgdGhlIGxvZ2ljIGluIGhlcmU/XG4gICAgfVxuICAgIGlzX3VzZWQoZGV2KSB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5ub2RlLnR5cGUgPT09ICdBdHJ1bGUnICYmIGlzX2tleWZyYW1lc19ub2RlKHRoaXMucGFyZW50Lm5vZGUpKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmICh0aGlzLmRlY2xhcmF0aW9ucy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm4gZGV2O1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RvcnMuc29tZShzID0+IHMudXNlZCk7XG4gICAgfVxuICAgIG1pbmlmeShjb2RlLCBfZGV2KSB7XG4gICAgICAgIGxldCBjID0gdGhpcy5ub2RlLnN0YXJ0O1xuICAgICAgICBsZXQgc3RhcnRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbGVjdG9ycy5mb3JFYWNoKChzZWxlY3RvcikgPT4ge1xuICAgICAgICAgICAgaWYgKHNlbGVjdG9yLnVzZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZXBhcmF0b3IgPSBzdGFydGVkID8gJywnIDogJyc7XG4gICAgICAgICAgICAgICAgaWYgKChzZWxlY3Rvci5ub2RlLnN0YXJ0IC0gYykgPiBzZXBhcmF0b3IubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvZGUub3ZlcndyaXRlKGMsIHNlbGVjdG9yLm5vZGUuc3RhcnQsIHNlcGFyYXRvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLm1pbmlmeShjb2RlKTtcbiAgICAgICAgICAgICAgICBjID0gc2VsZWN0b3Iubm9kZS5lbmQ7XG4gICAgICAgICAgICAgICAgc3RhcnRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb2RlLnJlbW92ZShjLCB0aGlzLm5vZGUuYmxvY2suc3RhcnQpO1xuICAgICAgICBjID0gdGhpcy5ub2RlLmJsb2NrLnN0YXJ0ICsgMTtcbiAgICAgICAgYyA9IG1pbmlmeV9kZWNsYXJhdGlvbnMoY29kZSwgYywgdGhpcy5kZWNsYXJhdGlvbnMpO1xuICAgICAgICBjb2RlLnJlbW92ZShjLCB0aGlzLm5vZGUuYmxvY2suZW5kIC0gMSk7XG4gICAgfVxuICAgIHRyYW5zZm9ybShjb2RlLCBpZCwga2V5ZnJhbWVzLCBtYXhfYW1vdW50X2NsYXNzX3NwZWNpZmljaXR5X2luY3JlYXNlZCkge1xuICAgICAgICBpZiAodGhpcy5wYXJlbnQgJiYgdGhpcy5wYXJlbnQubm9kZS50eXBlID09PSAnQXRydWxlJyAmJiBpc19rZXlmcmFtZXNfbm9kZSh0aGlzLnBhcmVudC5ub2RlKSlcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBjb25zdCBhdHRyID0gYC4ke2lkfWA7XG4gICAgICAgIHRoaXMuc2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4gc2VsZWN0b3IudHJhbnNmb3JtKGNvZGUsIGF0dHIsIG1heF9hbW91bnRfY2xhc3Nfc3BlY2lmaWNpdHlfaW5jcmVhc2VkKSk7XG4gICAgICAgIHRoaXMuZGVjbGFyYXRpb25zLmZvckVhY2goZGVjbGFyYXRpb24gPT4gZGVjbGFyYXRpb24udHJhbnNmb3JtKGNvZGUsIGtleWZyYW1lcykpO1xuICAgIH1cbiAgICB2YWxpZGF0ZShjb21wb25lbnQpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RvcnMuZm9yRWFjaChzZWxlY3RvciA9PiB7XG4gICAgICAgICAgICBzZWxlY3Rvci52YWxpZGF0ZShjb21wb25lbnQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgd2Fybl9vbl91bnVzZWRfc2VsZWN0b3IoaGFuZGxlcikge1xuICAgICAgICB0aGlzLnNlbGVjdG9ycy5mb3JFYWNoKHNlbGVjdG9yID0+IHtcbiAgICAgICAgICAgIGlmICghc2VsZWN0b3IudXNlZClcbiAgICAgICAgICAgICAgICBoYW5kbGVyKHNlbGVjdG9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldF9tYXhfYW1vdW50X2NsYXNzX3NwZWNpZmljaXR5X2luY3JlYXNlZCgpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KC4uLnRoaXMuc2VsZWN0b3JzLm1hcChzZWxlY3RvciA9PiBzZWxlY3Rvci5nZXRfYW1vdW50X2NsYXNzX3NwZWNpZmljaXR5X2luY3JlYXNlZCgpKSk7XG4gICAgfVxufVxuY2xhc3MgRGVjbGFyYXRpb24kMSB7XG4gICAgY29uc3RydWN0b3Iobm9kZSkge1xuICAgICAgICB0aGlzLm5vZGUgPSBub2RlO1xuICAgIH1cbiAgICB0cmFuc2Zvcm0oY29kZSwga2V5ZnJhbWVzKSB7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5ID0gdGhpcy5ub2RlLnByb3BlcnR5ICYmIHJlbW92ZV9jc3NfcHJlZml4KHRoaXMubm9kZS5wcm9wZXJ0eS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgaWYgKHByb3BlcnR5ID09PSAnYW5pbWF0aW9uJyB8fCBwcm9wZXJ0eSA9PT0gJ2FuaW1hdGlvbi1uYW1lJykge1xuICAgICAgICAgICAgdGhpcy5ub2RlLnZhbHVlLmNoaWxkcmVuLmZvckVhY2goKGJsb2NrKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGJsb2NrLnR5cGUgPT09ICdJZGVudGlmaWVyJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYmxvY2submFtZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleWZyYW1lcy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUub3ZlcndyaXRlKGJsb2NrLnN0YXJ0LCBibG9jay5lbmQsIGtleWZyYW1lcy5nZXQobmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWluaWZ5KGNvZGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLm5vZGUucHJvcGVydHkpXG4gICAgICAgICAgICByZXR1cm47IC8vIEBhcHBseSwgYW5kIHBvc3NpYmx5IG90aGVyIHdlaXJkIGNhc2VzP1xuICAgICAgICBjb25zdCBjID0gdGhpcy5ub2RlLnN0YXJ0ICsgdGhpcy5ub2RlLnByb3BlcnR5Lmxlbmd0aDtcbiAgICAgICAgY29uc3QgZmlyc3QgPSB0aGlzLm5vZGUudmFsdWUuY2hpbGRyZW5cbiAgICAgICAgICAgID8gdGhpcy5ub2RlLnZhbHVlLmNoaWxkcmVuWzBdXG4gICAgICAgICAgICA6IHRoaXMubm9kZS52YWx1ZTtcbiAgICAgICAgbGV0IHN0YXJ0ID0gZmlyc3Quc3RhcnQ7XG4gICAgICAgIHdoaWxlICgvXFxzLy50ZXN0KGNvZGUub3JpZ2luYWxbc3RhcnRdKSlcbiAgICAgICAgICAgIHN0YXJ0ICs9IDE7XG4gICAgICAgIGlmIChzdGFydCAtIGMgPiAxKSB7XG4gICAgICAgICAgICBjb2RlLm92ZXJ3cml0ZShjLCBzdGFydCwgJzonKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmNsYXNzIEF0cnVsZSQxIHtcbiAgICBjb25zdHJ1Y3Rvcihub2RlKSB7XG4gICAgICAgIHRoaXMubm9kZSA9IG5vZGU7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgdGhpcy5kZWNsYXJhdGlvbnMgPSBbXTtcbiAgICB9XG4gICAgYXBwbHkobm9kZSkge1xuICAgICAgICBpZiAodGhpcy5ub2RlLm5hbWUgPT09ICdtZWRpYScgfHwgdGhpcy5ub2RlLm5hbWUgPT09ICdzdXBwb3J0cycpIHtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB7XG4gICAgICAgICAgICAgICAgY2hpbGQuYXBwbHkobm9kZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpc19rZXlmcmFtZXNfbm9kZSh0aGlzLm5vZGUpKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLmZvckVhY2goKHJ1bGUpID0+IHtcbiAgICAgICAgICAgICAgICBydWxlLnNlbGVjdG9ycy5mb3JFYWNoKHNlbGVjdG9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IudXNlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpc191c2VkKF9kZXYpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7IC8vIFRPRE9cbiAgICB9XG4gICAgbWluaWZ5KGNvZGUsIGRldikge1xuICAgICAgICBpZiAodGhpcy5ub2RlLm5hbWUgPT09ICdtZWRpYScpIHtcbiAgICAgICAgICAgIGNvbnN0IGV4cHJlc3Npb25fY2hhciA9IGNvZGUub3JpZ2luYWxbdGhpcy5ub2RlLnByZWx1ZGUuc3RhcnRdO1xuICAgICAgICAgICAgbGV0IGMgPSB0aGlzLm5vZGUuc3RhcnQgKyAoZXhwcmVzc2lvbl9jaGFyID09PSAnKCcgPyA2IDogNyk7XG4gICAgICAgICAgICBpZiAodGhpcy5ub2RlLnByZWx1ZGUuc3RhcnQgPiBjKVxuICAgICAgICAgICAgICAgIGNvZGUucmVtb3ZlKGMsIHRoaXMubm9kZS5wcmVsdWRlLnN0YXJ0KTtcbiAgICAgICAgICAgIHRoaXMubm9kZS5wcmVsdWRlLmNoaWxkcmVuLmZvckVhY2goKHF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyBtaW5pZnkgcXVlcmllc1xuICAgICAgICAgICAgICAgIGMgPSBxdWVyeS5lbmQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvZGUucmVtb3ZlKGMsIHRoaXMubm9kZS5ibG9jay5zdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5ub2RlLm5hbWUgPT09ICdzdXBwb3J0cycpIHtcbiAgICAgICAgICAgIGxldCBjID0gdGhpcy5ub2RlLnN0YXJ0ICsgOTtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vZGUucHJlbHVkZS5zdGFydCAtIGMgPiAxKVxuICAgICAgICAgICAgICAgIGNvZGUub3ZlcndyaXRlKGMsIHRoaXMubm9kZS5wcmVsdWRlLnN0YXJ0LCAnICcpO1xuICAgICAgICAgICAgdGhpcy5ub2RlLnByZWx1ZGUuY2hpbGRyZW4uZm9yRWFjaCgocXVlcnkpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIG1pbmlmeSBxdWVyaWVzXG4gICAgICAgICAgICAgICAgYyA9IHF1ZXJ5LmVuZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29kZS5yZW1vdmUoYywgdGhpcy5ub2RlLmJsb2NrLnN0YXJ0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCBjID0gdGhpcy5ub2RlLnN0YXJ0ICsgdGhpcy5ub2RlLm5hbWUubGVuZ3RoICsgMTtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vZGUucHJlbHVkZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vZGUucHJlbHVkZS5zdGFydCAtIGMgPiAxKVxuICAgICAgICAgICAgICAgICAgICBjb2RlLm92ZXJ3cml0ZShjLCB0aGlzLm5vZGUucHJlbHVkZS5zdGFydCwgJyAnKTtcbiAgICAgICAgICAgICAgICBjID0gdGhpcy5ub2RlLnByZWx1ZGUuZW5kO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMubm9kZS5ibG9jayAmJiB0aGlzLm5vZGUuYmxvY2suc3RhcnQgLSBjID4gMCkge1xuICAgICAgICAgICAgICAgIGNvZGUucmVtb3ZlKGMsIHRoaXMubm9kZS5ibG9jay5zdGFydCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETyBvdGhlciBhdHJ1bGVzXG4gICAgICAgIGlmICh0aGlzLm5vZGUuYmxvY2spIHtcbiAgICAgICAgICAgIGxldCBjID0gdGhpcy5ub2RlLmJsb2NrLnN0YXJ0ICsgMTtcbiAgICAgICAgICAgIGlmICh0aGlzLmRlY2xhcmF0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjID0gbWluaWZ5X2RlY2xhcmF0aW9ucyhjb2RlLCBjLCB0aGlzLmRlY2xhcmF0aW9ucyk7XG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlIGF0cnVsZSBoYXMgY2hpbGRyZW4sIGxlYXZlIHRoZSBsYXN0IGRlY2xhcmF0aW9uIHNlbWljb2xvbiBhbG9uZVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoaWxkcmVuLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgYysrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGQuaXNfdXNlZChkZXYpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvZGUucmVtb3ZlKGMsIGNoaWxkLm5vZGUuc3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICBjaGlsZC5taW5pZnkoY29kZSwgZGV2KTtcbiAgICAgICAgICAgICAgICAgICAgYyA9IGNoaWxkLm5vZGUuZW5kO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29kZS5yZW1vdmUoYywgdGhpcy5ub2RlLmJsb2NrLmVuZCAtIDEpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHRyYW5zZm9ybShjb2RlLCBpZCwga2V5ZnJhbWVzLCBtYXhfYW1vdW50X2NsYXNzX3NwZWNpZmljaXR5X2luY3JlYXNlZCkge1xuICAgICAgICBpZiAoaXNfa2V5ZnJhbWVzX25vZGUodGhpcy5ub2RlKSkge1xuICAgICAgICAgICAgdGhpcy5ub2RlLnByZWx1ZGUuY2hpbGRyZW4uZm9yRWFjaCgoeyB0eXBlLCBuYW1lLCBzdGFydCwgZW5kIH0pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ0lkZW50aWZpZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lLnN0YXJ0c1dpdGgoJy1nbG9iYWwtJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUucmVtb3ZlKHN0YXJ0LCBzdGFydCArIDgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKChydWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5zZWxlY3RvcnMuZm9yRWFjaChzZWxlY3RvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yLnVzZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlLm92ZXJ3cml0ZShzdGFydCwgZW5kLCBrZXlmcmFtZXMuZ2V0KG5hbWUpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB7XG4gICAgICAgICAgICBjaGlsZC50cmFuc2Zvcm0oY29kZSwgaWQsIGtleWZyYW1lcywgbWF4X2Ftb3VudF9jbGFzc19zcGVjaWZpY2l0eV9pbmNyZWFzZWQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgdmFsaWRhdGUoY29tcG9uZW50KSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB7XG4gICAgICAgICAgICBjaGlsZC52YWxpZGF0ZShjb21wb25lbnQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgd2Fybl9vbl91bnVzZWRfc2VsZWN0b3IoaGFuZGxlcikge1xuICAgICAgICBpZiAodGhpcy5ub2RlLm5hbWUgIT09ICdtZWRpYScpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB7XG4gICAgICAgICAgICBjaGlsZC53YXJuX29uX3VudXNlZF9zZWxlY3RvcihoYW5kbGVyKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldF9tYXhfYW1vdW50X2NsYXNzX3NwZWNpZmljaXR5X2luY3JlYXNlZCgpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KC4uLnRoaXMuY2hpbGRyZW4ubWFwKHJ1bGUgPT4gcnVsZS5nZXRfbWF4X2Ftb3VudF9jbGFzc19zcGVjaWZpY2l0eV9pbmNyZWFzZWQoKSkpO1xuICAgIH1cbn1cbmNvbnN0IGdldF9kZWZhdWx0X2Nzc19oYXNoID0gKHsgY3NzLCBoYXNoIH0pID0+IHtcbiAgICByZXR1cm4gYHN2ZWx0ZS0ke2hhc2goY3NzKX1gO1xufTtcbmNsYXNzIFN0eWxlc2hlZXQge1xuICAgIGNvbnN0cnVjdG9yKHsgc291cmNlLCBhc3QsIGNvbXBvbmVudF9uYW1lLCBmaWxlbmFtZSwgZGV2LCBnZXRfY3NzX2hhc2ggPSBnZXRfZGVmYXVsdF9jc3NfaGFzaCB9KSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgdGhpcy5rZXlmcmFtZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMubm9kZXNfd2l0aF9jc3NfY2xhc3MgPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgICB0aGlzLmFzdCA9IGFzdDtcbiAgICAgICAgdGhpcy5maWxlbmFtZSA9IGZpbGVuYW1lO1xuICAgICAgICB0aGlzLmRldiA9IGRldjtcbiAgICAgICAgaWYgKGFzdC5jc3MgJiYgYXN0LmNzcy5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBnZXRfY3NzX2hhc2goe1xuICAgICAgICAgICAgICAgIGZpbGVuYW1lLFxuICAgICAgICAgICAgICAgIG5hbWU6IGNvbXBvbmVudF9uYW1lLFxuICAgICAgICAgICAgICAgIGNzczogYXN0LmNzcy5jb250ZW50LnN0eWxlcyxcbiAgICAgICAgICAgICAgICBoYXNoXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuaGFzX3N0eWxlcyA9IHRydWU7XG4gICAgICAgICAgICBjb25zdCBzdGFjayA9IFtdO1xuICAgICAgICAgICAgbGV0IGRlcHRoID0gMDtcbiAgICAgICAgICAgIGxldCBjdXJyZW50X2F0cnVsZSA9IG51bGw7XG4gICAgICAgICAgICB3YWxrKGFzdC5jc3MsIHtcbiAgICAgICAgICAgICAgICBlbnRlcjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0F0cnVsZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0cnVsZSA9IG5ldyBBdHJ1bGUkMShub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYXRydWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50X2F0cnVsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfYXRydWxlLmNoaWxkcmVuLnB1c2goYXRydWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRlcHRoIDw9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goYXRydWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc19rZXlmcmFtZXNfbm9kZShub2RlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucHJlbHVkZS5jaGlsZHJlbi5mb3JFYWNoKChleHByZXNzaW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHByZXNzaW9uLnR5cGUgPT09ICdJZGVudGlmaWVyJyAmJiAhZXhwcmVzc2lvbi5uYW1lLnN0YXJ0c1dpdGgoJy1nbG9iYWwtJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMua2V5ZnJhbWVzLnNldChleHByZXNzaW9uLm5hbWUsIGAke3RoaXMuaWR9LSR7ZXhwcmVzc2lvbi5uYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhdF9ydWxlX2hhc19kZWNsYXJhdGlvbihub2RlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0X3J1bGVfZGVjbGFyYXRpb25zID0gbm9kZS5ibG9jay5jaGlsZHJlblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKG5vZGUgPT4gbm9kZS50eXBlID09PSAnRGVjbGFyYXRpb24nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKG5vZGUgPT4gbmV3IERlY2xhcmF0aW9uJDEobm9kZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0cnVsZS5kZWNsYXJhdGlvbnMucHVzaCguLi5hdF9ydWxlX2RlY2xhcmF0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2F0cnVsZSA9IGF0cnVsZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnUnVsZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJ1bGUgPSBuZXcgUnVsZSQxKG5vZGUsIHRoaXMsIGN1cnJlbnRfYXRydWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50X2F0cnVsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfYXRydWxlLmNoaWxkcmVuLnB1c2gocnVsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChkZXB0aCA8PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKHJ1bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRlcHRoICs9IDE7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsZWF2ZTogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0F0cnVsZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9hdHJ1bGUgPSBzdGFja1tzdGFjay5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkZXB0aCAtPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5oYXNfc3R5bGVzID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXBwbHkobm9kZSkge1xuICAgICAgICBpZiAoIXRoaXMuaGFzX3N0eWxlcylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW5baV07XG4gICAgICAgICAgICBjaGlsZC5hcHBseShub2RlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZWlmeSgpIHtcbiAgICAgICAgdGhpcy5ub2Rlc193aXRoX2Nzc19jbGFzcy5mb3JFYWNoKChub2RlKSA9PiB7XG4gICAgICAgICAgICBub2RlLmFkZF9jc3NfY2xhc3MoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlcihmaWxlLCBzaG91bGRfdHJhbnNmb3JtX3NlbGVjdG9ycykge1xuICAgICAgICBpZiAoIXRoaXMuaGFzX3N0eWxlcykge1xuICAgICAgICAgICAgcmV0dXJuIHsgY29kZTogbnVsbCwgbWFwOiBudWxsIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29kZSA9IG5ldyBNYWdpY1N0cmluZyh0aGlzLnNvdXJjZSk7XG4gICAgICAgIHdhbGsodGhpcy5hc3QuY3NzLCB7XG4gICAgICAgICAgICBlbnRlcjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBjb2RlLmFkZFNvdXJjZW1hcExvY2F0aW9uKG5vZGUuc3RhcnQpO1xuICAgICAgICAgICAgICAgIGNvZGUuYWRkU291cmNlbWFwTG9jYXRpb24obm9kZS5lbmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHNob3VsZF90cmFuc2Zvcm1fc2VsZWN0b3JzKSB7XG4gICAgICAgICAgICBjb25zdCBtYXggPSBNYXRoLm1heCguLi50aGlzLmNoaWxkcmVuLm1hcChydWxlID0+IHJ1bGUuZ2V0X21heF9hbW91bnRfY2xhc3Nfc3BlY2lmaWNpdHlfaW5jcmVhc2VkKCkpKTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcbiAgICAgICAgICAgICAgICBjaGlsZC50cmFuc2Zvcm0oY29kZSwgdGhpcy5pZCwgdGhpcy5rZXlmcmFtZXMsIG1heCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgYyA9IDA7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB7XG4gICAgICAgICAgICBpZiAoY2hpbGQuaXNfdXNlZCh0aGlzLmRldikpIHtcbiAgICAgICAgICAgICAgICBjb2RlLnJlbW92ZShjLCBjaGlsZC5ub2RlLnN0YXJ0KTtcbiAgICAgICAgICAgICAgICBjaGlsZC5taW5pZnkoY29kZSwgdGhpcy5kZXYpO1xuICAgICAgICAgICAgICAgIGMgPSBjaGlsZC5ub2RlLmVuZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvZGUucmVtb3ZlKGMsIHRoaXMuc291cmNlLmxlbmd0aCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb2RlOiBjb2RlLnRvU3RyaW5nKCksXG4gICAgICAgICAgICBtYXA6IGNvZGUuZ2VuZXJhdGVNYXAoe1xuICAgICAgICAgICAgICAgIGluY2x1ZGVDb250ZW50OiB0cnVlLFxuICAgICAgICAgICAgICAgIHNvdXJjZTogdGhpcy5maWxlbmFtZSxcbiAgICAgICAgICAgICAgICBmaWxlXG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuICAgIH1cbiAgICB2YWxpZGF0ZShjb21wb25lbnQpIHtcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IHtcbiAgICAgICAgICAgIGNoaWxkLnZhbGlkYXRlKGNvbXBvbmVudCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB3YXJuX29uX3VudXNlZF9zZWxlY3RvcnMoY29tcG9uZW50KSB7XG4gICAgICAgIGNvbnN0IGlnbm9yZXMgPSAhdGhpcy5hc3QuY3NzID8gW10gOiBleHRyYWN0X2lnbm9yZXNfYWJvdmVfcG9zaXRpb24odGhpcy5hc3QuY3NzLnN0YXJ0LCB0aGlzLmFzdC5odG1sLmNoaWxkcmVuKTtcbiAgICAgICAgY29tcG9uZW50LnB1c2hfaWdub3JlcyhpZ25vcmVzKTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IHtcbiAgICAgICAgICAgIGNoaWxkLndhcm5fb25fdW51c2VkX3NlbGVjdG9yKChzZWxlY3RvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuKHNlbGVjdG9yLm5vZGUsIGNvbXBpbGVyX3dhcm5pbmdzLmNzc191bnVzZWRfc2VsZWN0b3IodGhpcy5zb3VyY2Uuc2xpY2Uoc2VsZWN0b3Iubm9kZS5zdGFydCwgc2VsZWN0b3Iubm9kZS5lbmQpKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbXBvbmVudC5wb3BfaWdub3JlcygpO1xuICAgIH1cbn1cblxuY29uc3QgdGVzdCA9IHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzLmVudi5URVNUO1xuXG5jbGFzcyBUZW1wbGF0ZVNjb3BlIHtcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQpIHtcbiAgICAgICAgdGhpcy5vd25lcnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgICAgICB0aGlzLm5hbWVzID0gbmV3IFNldChwYXJlbnQgPyBwYXJlbnQubmFtZXMgOiBbXSk7XG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzX2Zvcl9uYW1lID0gbmV3IE1hcChwYXJlbnQgPyBwYXJlbnQuZGVwZW5kZW5jaWVzX2Zvcl9uYW1lIDogW10pO1xuICAgIH1cbiAgICBhZGQobmFtZSwgZGVwZW5kZW5jaWVzLCBvd25lcikge1xuICAgICAgICB0aGlzLm5hbWVzLmFkZChuYW1lKTtcbiAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXNfZm9yX25hbWUuc2V0KG5hbWUsIGRlcGVuZGVuY2llcyk7XG4gICAgICAgIHRoaXMub3duZXJzLnNldChuYW1lLCBvd25lcik7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBjaGlsZCgpIHtcbiAgICAgICAgY29uc3QgY2hpbGQgPSBuZXcgVGVtcGxhdGVTY29wZSh0aGlzKTtcbiAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgIH1cbiAgICBpc190b3BfbGV2ZWwobmFtZSkge1xuICAgICAgICByZXR1cm4gIXRoaXMucGFyZW50IHx8ICF0aGlzLm5hbWVzLmhhcyhuYW1lKSAmJiB0aGlzLnBhcmVudC5pc190b3BfbGV2ZWwobmFtZSk7XG4gICAgfVxuICAgIGdldF9vd25lcihuYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm93bmVycy5nZXQobmFtZSkgfHwgKHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50LmdldF9vd25lcihuYW1lKSk7XG4gICAgfVxuICAgIGlzX2xldChuYW1lKSB7XG4gICAgICAgIGNvbnN0IG93bmVyID0gdGhpcy5nZXRfb3duZXIobmFtZSk7XG4gICAgICAgIHJldHVybiBvd25lciAmJiAob3duZXIudHlwZSA9PT0gJ0VsZW1lbnQnIHx8IG93bmVyLnR5cGUgPT09ICdJbmxpbmVDb21wb25lbnQnIHx8IG93bmVyLnR5cGUgPT09ICdTbG90VGVtcGxhdGUnKTtcbiAgICB9XG4gICAgaXNfYXdhaXQobmFtZSkge1xuICAgICAgICBjb25zdCBvd25lciA9IHRoaXMuZ2V0X293bmVyKG5hbWUpO1xuICAgICAgICByZXR1cm4gb3duZXIgJiYgKG93bmVyLnR5cGUgPT09ICdUaGVuQmxvY2snIHx8IG93bmVyLnR5cGUgPT09ICdDYXRjaEJsb2NrJyk7XG4gICAgfVxuICAgIGlzX2NvbnN0KG5hbWUpIHtcbiAgICAgICAgY29uc3Qgb3duZXIgPSB0aGlzLmdldF9vd25lcihuYW1lKTtcbiAgICAgICAgcmV0dXJuIG93bmVyICYmIG93bmVyLnR5cGUgPT09ICdDb25zdFRhZyc7XG4gICAgfVxufVxuXG5jbGFzcyBGcmFnbWVudCBleHRlbmRzIE5vZGUkMSB7XG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50LCBpbmZvKSB7XG4gICAgICAgIGNvbnN0IHNjb3BlID0gbmV3IFRlbXBsYXRlU2NvcGUoKTtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBudWxsLCBzY29wZSwgaW5mbyk7XG4gICAgICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IG1hcF9jaGlsZHJlbihjb21wb25lbnQsIHRoaXMsIHNjb3BlLCBpbmZvLmNoaWxkcmVuKTtcbiAgICB9XG59XG5cbi8vIFRoaXMgZmlsZSBpcyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZFxudmFyIGludGVybmFsX2V4cG9ydHMgPSBuZXcgU2V0KFtcIkh0bWxUYWdcIiwgXCJIdG1sVGFnSHlkcmF0aW9uXCIsIFwiU3ZlbHRlQ29tcG9uZW50XCIsIFwiU3ZlbHRlQ29tcG9uZW50RGV2XCIsIFwiU3ZlbHRlQ29tcG9uZW50VHlwZWRcIiwgXCJTdmVsdGVFbGVtZW50XCIsIFwiYWN0aW9uX2Rlc3Ryb3llclwiLCBcImFkZF9hdHRyaWJ1dGVcIiwgXCJhZGRfY2xhc3Nlc1wiLCBcImFkZF9mbHVzaF9jYWxsYmFja1wiLCBcImFkZF9sb2NhdGlvblwiLCBcImFkZF9yZW5kZXJfY2FsbGJhY2tcIiwgXCJhZGRfcmVzaXplX2xpc3RlbmVyXCIsIFwiYWRkX3N0eWxlc1wiLCBcImFkZF90cmFuc2Zvcm1cIiwgXCJhZnRlclVwZGF0ZVwiLCBcImFwcGVuZFwiLCBcImFwcGVuZF9kZXZcIiwgXCJhcHBlbmRfZW1wdHlfc3R5bGVzaGVldFwiLCBcImFwcGVuZF9oeWRyYXRpb25cIiwgXCJhcHBlbmRfaHlkcmF0aW9uX2RldlwiLCBcImFwcGVuZF9zdHlsZXNcIiwgXCJhc3NpZ25cIiwgXCJhdHRyXCIsIFwiYXR0cl9kZXZcIiwgXCJhdHRyaWJ1dGVfdG9fb2JqZWN0XCIsIFwiYmVmb3JlVXBkYXRlXCIsIFwiYmluZFwiLCBcImJpbmRpbmdfY2FsbGJhY2tzXCIsIFwiYmxhbmtfb2JqZWN0XCIsIFwiYnViYmxlXCIsIFwiY2hlY2tfb3V0cm9zXCIsIFwiY2hpbGRyZW5cIiwgXCJjbGFpbV9jb21wb25lbnRcIiwgXCJjbGFpbV9lbGVtZW50XCIsIFwiY2xhaW1faHRtbF90YWdcIiwgXCJjbGFpbV9zcGFjZVwiLCBcImNsYWltX3N2Z19lbGVtZW50XCIsIFwiY2xhaW1fdGV4dFwiLCBcImNsZWFyX2xvb3BzXCIsIFwiY29tcG9uZW50X3N1YnNjcmliZVwiLCBcImNvbXB1dGVfcmVzdF9wcm9wc1wiLCBcImNvbXB1dGVfc2xvdHNcIiwgXCJjcmVhdGVFdmVudERpc3BhdGNoZXJcIiwgXCJjcmVhdGVfYW5pbWF0aW9uXCIsIFwiY3JlYXRlX2JpZGlyZWN0aW9uYWxfdHJhbnNpdGlvblwiLCBcImNyZWF0ZV9jb21wb25lbnRcIiwgXCJjcmVhdGVfaW5fdHJhbnNpdGlvblwiLCBcImNyZWF0ZV9vdXRfdHJhbnNpdGlvblwiLCBcImNyZWF0ZV9zbG90XCIsIFwiY3JlYXRlX3Nzcl9jb21wb25lbnRcIiwgXCJjdXJyZW50X2NvbXBvbmVudFwiLCBcImN1c3RvbV9ldmVudFwiLCBcImRhdGFzZXRfZGV2XCIsIFwiZGVidWdcIiwgXCJkZXN0cm95X2Jsb2NrXCIsIFwiZGVzdHJveV9jb21wb25lbnRcIiwgXCJkZXN0cm95X2VhY2hcIiwgXCJkZXRhY2hcIiwgXCJkZXRhY2hfYWZ0ZXJfZGV2XCIsIFwiZGV0YWNoX2JlZm9yZV9kZXZcIiwgXCJkZXRhY2hfYmV0d2Vlbl9kZXZcIiwgXCJkZXRhY2hfZGV2XCIsIFwiZGlydHlfY29tcG9uZW50c1wiLCBcImRpc3BhdGNoX2RldlwiLCBcImVhY2hcIiwgXCJlbGVtZW50XCIsIFwiZWxlbWVudF9pc1wiLCBcImVtcHR5XCIsIFwiZW5kX2h5ZHJhdGluZ1wiLCBcImVzY2FwZVwiLCBcImVzY2FwZV9hdHRyaWJ1dGVfdmFsdWVcIiwgXCJlc2NhcGVfb2JqZWN0XCIsIFwiZXNjYXBlZFwiLCBcImV4Y2x1ZGVfaW50ZXJuYWxfcHJvcHNcIiwgXCJmaXhfYW5kX2Rlc3Ryb3lfYmxvY2tcIiwgXCJmaXhfYW5kX291dHJvX2FuZF9kZXN0cm95X2Jsb2NrXCIsIFwiZml4X3Bvc2l0aW9uXCIsIFwiZmx1c2hcIiwgXCJnZXRBbGxDb250ZXh0c1wiLCBcImdldENvbnRleHRcIiwgXCJnZXRfYWxsX2RpcnR5X2Zyb21fc2NvcGVcIiwgXCJnZXRfYmluZGluZ19ncm91cF92YWx1ZVwiLCBcImdldF9jdXJyZW50X2NvbXBvbmVudFwiLCBcImdldF9jdXN0b21fZWxlbWVudHNfc2xvdHNcIiwgXCJnZXRfcm9vdF9mb3Jfc3R5bGVcIiwgXCJnZXRfc2xvdF9jaGFuZ2VzXCIsIFwiZ2V0X3NwcmVhZF9vYmplY3RcIiwgXCJnZXRfc3ByZWFkX3VwZGF0ZVwiLCBcImdldF9zdG9yZV92YWx1ZVwiLCBcImdsb2JhbHNcIiwgXCJncm91cF9vdXRyb3NcIiwgXCJoYW5kbGVfcHJvbWlzZVwiLCBcImhhc0NvbnRleHRcIiwgXCJoYXNfcHJvcFwiLCBcImlkZW50aXR5XCIsIFwiaW5pdFwiLCBcImluc2VydFwiLCBcImluc2VydF9kZXZcIiwgXCJpbnNlcnRfaHlkcmF0aW9uXCIsIFwiaW5zZXJ0X2h5ZHJhdGlvbl9kZXZcIiwgXCJpbnRyb3NcIiwgXCJpbnZhbGlkX2F0dHJpYnV0ZV9uYW1lX2NoYXJhY3RlclwiLCBcImlzX2NsaWVudFwiLCBcImlzX2Nyb3Nzb3JpZ2luXCIsIFwiaXNfZW1wdHlcIiwgXCJpc19mdW5jdGlvblwiLCBcImlzX3Byb21pc2VcIiwgXCJsaXN0ZW5cIiwgXCJsaXN0ZW5fZGV2XCIsIFwibG9vcFwiLCBcImxvb3BfZ3VhcmRcIiwgXCJtZXJnZV9zc3Jfc3R5bGVzXCIsIFwibWlzc2luZ19jb21wb25lbnRcIiwgXCJtb3VudF9jb21wb25lbnRcIiwgXCJub29wXCIsIFwibm90X2VxdWFsXCIsIFwibm93XCIsIFwibnVsbF90b19lbXB0eVwiLCBcIm9iamVjdF93aXRob3V0X3Byb3BlcnRpZXNcIiwgXCJvbkRlc3Ryb3lcIiwgXCJvbk1vdW50XCIsIFwib25jZVwiLCBcIm91dHJvX2FuZF9kZXN0cm95X2Jsb2NrXCIsIFwicHJldmVudF9kZWZhdWx0XCIsIFwicHJvcF9kZXZcIiwgXCJxdWVyeV9zZWxlY3Rvcl9hbGxcIiwgXCJyYWZcIiwgXCJydW5cIiwgXCJydW5fYWxsXCIsIFwic2FmZV9ub3RfZXF1YWxcIiwgXCJzY2hlZHVsZV91cGRhdGVcIiwgXCJzZWxlY3RfbXVsdGlwbGVfdmFsdWVcIiwgXCJzZWxlY3Rfb3B0aW9uXCIsIFwic2VsZWN0X29wdGlvbnNcIiwgXCJzZWxlY3RfdmFsdWVcIiwgXCJzZWxmXCIsIFwic2V0Q29udGV4dFwiLCBcInNldF9hdHRyaWJ1dGVzXCIsIFwic2V0X2N1cnJlbnRfY29tcG9uZW50XCIsIFwic2V0X2N1c3RvbV9lbGVtZW50X2RhdGFcIiwgXCJzZXRfZGF0YVwiLCBcInNldF9kYXRhX2RldlwiLCBcInNldF9pbnB1dF90eXBlXCIsIFwic2V0X2lucHV0X3ZhbHVlXCIsIFwic2V0X25vd1wiLCBcInNldF9yYWZcIiwgXCJzZXRfc3RvcmVfdmFsdWVcIiwgXCJzZXRfc3R5bGVcIiwgXCJzZXRfc3ZnX2F0dHJpYnV0ZXNcIiwgXCJzcGFjZVwiLCBcInNwcmVhZFwiLCBcInNyY191cmxfZXF1YWxcIiwgXCJzdGFydF9oeWRyYXRpbmdcIiwgXCJzdG9wX3Byb3BhZ2F0aW9uXCIsIFwic3Vic2NyaWJlXCIsIFwic3ZnX2VsZW1lbnRcIiwgXCJ0ZXh0XCIsIFwidGlja1wiLCBcInRpbWVfcmFuZ2VzX3RvX2FycmF5XCIsIFwidG9fbnVtYmVyXCIsIFwidG9nZ2xlX2NsYXNzXCIsIFwidHJhbnNpdGlvbl9pblwiLCBcInRyYW5zaXRpb25fb3V0XCIsIFwidHJ1c3RlZFwiLCBcInVwZGF0ZV9hd2FpdF9ibG9ja19icmFuY2hcIiwgXCJ1cGRhdGVfa2V5ZWRfZWFjaFwiLCBcInVwZGF0ZV9zbG90XCIsIFwidXBkYXRlX3Nsb3RfYmFzZVwiLCBcInZhbGlkYXRlX2NvbXBvbmVudFwiLCBcInZhbGlkYXRlX2VhY2hfYXJndW1lbnRcIiwgXCJ2YWxpZGF0ZV9lYWNoX2tleXNcIiwgXCJ2YWxpZGF0ZV9zbG90c1wiLCBcInZhbGlkYXRlX3N0b3JlXCIsIFwieGxpbmtfYXR0clwiXSk7XG5cbmZ1bmN0aW9uIGlzX3VzZWRfYXNfcmVmZXJlbmNlKG5vZGUsIHBhcmVudCkge1xuICAgIGlmICghaXNfcmVmZXJlbmNlKG5vZGUsIHBhcmVudCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyogZXNsaW50LWRpc2FibGUgbm8tZmFsbHRocm91Z2ggKi9cbiAgICBzd2l0Y2ggKHBhcmVudC50eXBlKSB7XG4gICAgICAgIC8vIGRpc3JlZ2FyZCB0aGUgYGZvb2AgaW4gYGNvbnN0IGZvbyA9IGJhcmBcbiAgICAgICAgY2FzZSAnVmFyaWFibGVEZWNsYXJhdG9yJzpcbiAgICAgICAgICAgIHJldHVybiBub2RlICE9PSBwYXJlbnQuaWQ7XG4gICAgICAgIC8vIGRpc3JlZ2FyZCB0aGUgYGZvb2AsIGBiYXJgIGluIGBmdW5jdGlvbiBmb28oYmFyKXt9YFxuICAgICAgICBjYXNlICdGdW5jdGlvbkRlY2xhcmF0aW9uJzpcbiAgICAgICAgLy8gZGlzcmVnYXJkIHRoZSBgZm9vYCBpbiBgaW1wb3J0IHsgZm9vIH0gZnJvbSAnZm9vJ2BcbiAgICAgICAgY2FzZSAnSW1wb3J0U3BlY2lmaWVyJzpcbiAgICAgICAgLy8gZGlzcmVnYXJkIHRoZSBgZm9vYCBpbiBgaW1wb3J0IGZvbyBmcm9tICdmb28nYFxuICAgICAgICBjYXNlICdJbXBvcnREZWZhdWx0U3BlY2lmaWVyJzpcbiAgICAgICAgLy8gZGlzcmVnYXJkIHRoZSBgZm9vYCBpbiBgaW1wb3J0ICogYXMgZm9vIGZyb20gJ2ZvbydgXG4gICAgICAgIGNhc2UgJ0ltcG9ydE5hbWVzcGFjZVNwZWNpZmllcic6XG4gICAgICAgIC8vIGRpc3JlZ2FyZCB0aGUgYGZvb2AgaW4gYGV4cG9ydCB7IGZvbyB9YFxuICAgICAgICBjYXNlICdFeHBvcnRTcGVjaWZpZXInOlxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5jbGFzcyBDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKGFzdCwgc291cmNlLCBuYW1lLCBjb21waWxlX29wdGlvbnMsIHN0YXRzLCB3YXJuaW5ncykge1xuICAgICAgICB0aGlzLmlnbm9yZV9zdGFjayA9IFtdO1xuICAgICAgICB0aGlzLnZhcnMgPSBbXTtcbiAgICAgICAgdGhpcy52YXJfbG9va3VwID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmltcG9ydHMgPSBbXTtcbiAgICAgICAgdGhpcy5leHBvcnRzX2Zyb20gPSBbXTtcbiAgICAgICAgdGhpcy5pbnN0YW5jZV9leHBvcnRzX2Zyb20gPSBbXTtcbiAgICAgICAgdGhpcy5ob2lzdGFibGVfbm9kZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMubm9kZV9mb3JfZGVjbGFyYXRpb24gPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMucGFydGx5X2hvaXN0ZWQgPSBbXTtcbiAgICAgICAgdGhpcy5mdWxseV9ob2lzdGVkID0gW107XG4gICAgICAgIHRoaXMucmVhY3RpdmVfZGVjbGFyYXRpb25zID0gW107XG4gICAgICAgIHRoaXMucmVhY3RpdmVfZGVjbGFyYXRpb25fbm9kZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMuaGFzX3JlYWN0aXZlX2Fzc2lnbm1lbnRzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaW5qZWN0ZWRfcmVhY3RpdmVfZGVjbGFyYXRpb25fdmFycyA9IG5ldyBTZXQoKTtcbiAgICAgICAgdGhpcy5oZWxwZXJzID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmdsb2JhbHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuaW5kaXJlY3RfZGVwZW5kZW5jaWVzID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmVsZW1lbnRzID0gW107XG4gICAgICAgIHRoaXMuYWxpYXNlcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy51c2VkX25hbWVzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLmdsb2JhbGx5X3VzZWRfbmFtZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMuc2xvdHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuc2xvdF9vdXRsZXRzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLm5hbWUgPSB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZSB9O1xuICAgICAgICB0aGlzLnN0YXRzID0gc3RhdHM7XG4gICAgICAgIHRoaXMud2FybmluZ3MgPSB3YXJuaW5ncztcbiAgICAgICAgdGhpcy5hc3QgPSBhc3Q7XG4gICAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgICB0aGlzLmNvbXBpbGVfb3B0aW9ucyA9IGNvbXBpbGVfb3B0aW9ucztcbiAgICAgICAgLy8gdGhlIGluc3RhbmNlIEpTIGdldHMgbXV0YXRlZCwgc28gd2UgcGFya1xuICAgICAgICAvLyBhIGNvcHkgaGVyZSBmb3IgbGF0ZXIuIFRPRE8gdGhpcyBmZWVscyBncm9zc1xuICAgICAgICB0aGlzLm9yaWdpbmFsX2FzdCA9IGNsb25lKHtcbiAgICAgICAgICAgIGh0bWw6IGFzdC5odG1sLFxuICAgICAgICAgICAgY3NzOiBhc3QuY3NzLFxuICAgICAgICAgICAgaW5zdGFuY2U6IGFzdC5pbnN0YW5jZSxcbiAgICAgICAgICAgIG1vZHVsZTogYXN0Lm1vZHVsZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5maWxlID1cbiAgICAgICAgICAgIGNvbXBpbGVfb3B0aW9ucy5maWxlbmFtZSAmJlxuICAgICAgICAgICAgICAgICh0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCdcbiAgICAgICAgICAgICAgICAgICAgPyBjb21waWxlX29wdGlvbnMuZmlsZW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKHByb2Nlc3MuY3dkKCksICcnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL15bL1xcXFxdLywgJycpXG4gICAgICAgICAgICAgICAgICAgIDogY29tcGlsZV9vcHRpb25zLmZpbGVuYW1lKTtcbiAgICAgICAgdGhpcy5sb2NhdGUgPSBnZXRMb2NhdG9yKHRoaXMuc291cmNlLCB7IG9mZnNldExpbmU6IDEgfSk7XG4gICAgICAgIC8vIHN0eWxlc1xuICAgICAgICB0aGlzLnN0eWxlc2hlZXQgPSBuZXcgU3R5bGVzaGVldCh7XG4gICAgICAgICAgICBzb3VyY2UsXG4gICAgICAgICAgICBhc3QsXG4gICAgICAgICAgICBmaWxlbmFtZTogY29tcGlsZV9vcHRpb25zLmZpbGVuYW1lLFxuICAgICAgICAgICAgY29tcG9uZW50X25hbWU6IG5hbWUsXG4gICAgICAgICAgICBkZXY6IGNvbXBpbGVfb3B0aW9ucy5kZXYsXG4gICAgICAgICAgICBnZXRfY3NzX2hhc2g6IGNvbXBpbGVfb3B0aW9ucy5jc3NIYXNoXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnN0eWxlc2hlZXQudmFsaWRhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuY29tcG9uZW50X29wdGlvbnMgPSBwcm9jZXNzX2NvbXBvbmVudF9vcHRpb25zKHRoaXMsIHRoaXMuYXN0Lmh0bWwuY2hpbGRyZW4pO1xuICAgICAgICB0aGlzLm5hbWVzcGFjZSA9XG4gICAgICAgICAgICBuYW1lc3BhY2VzW3RoaXMuY29tcG9uZW50X29wdGlvbnMubmFtZXNwYWNlXSB8fFxuICAgICAgICAgICAgICAgIHRoaXMuY29tcG9uZW50X29wdGlvbnMubmFtZXNwYWNlO1xuICAgICAgICBpZiAoY29tcGlsZV9vcHRpb25zLmN1c3RvbUVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBvbmVudF9vcHRpb25zLnRhZyA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgY29tcGlsZV9vcHRpb25zLnRhZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3ZlbHRlT3B0aW9ucyA9IGFzdC5odG1sLmNoaWxkcmVuLmZpbmQoY2hpbGQgPT4gY2hpbGQubmFtZSA9PT0gJ3N2ZWx0ZTpvcHRpb25zJykgfHwgeyBzdGFydDogMCwgZW5kOiAwIH07XG4gICAgICAgICAgICAgICAgdGhpcy53YXJuKHN2ZWx0ZU9wdGlvbnMsIGNvbXBpbGVyX3dhcm5pbmdzLmN1c3RvbV9lbGVtZW50X25vX3RhZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnRhZyA9IHRoaXMuY29tcG9uZW50X29wdGlvbnMudGFnIHx8IGNvbXBpbGVfb3B0aW9ucy50YWc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRhZyA9IHRoaXMubmFtZS5uYW1lO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud2Fsa19tb2R1bGVfanMoKTtcbiAgICAgICAgdGhpcy5wdXNoX2lnbm9yZXModGhpcy5hc3QuaW5zdGFuY2UgPyBleHRyYWN0X2lnbm9yZXNfYWJvdmVfcG9zaXRpb24odGhpcy5hc3QuaW5zdGFuY2Uuc3RhcnQsIHRoaXMuYXN0Lmh0bWwuY2hpbGRyZW4pIDogW10pO1xuICAgICAgICB0aGlzLndhbGtfaW5zdGFuY2VfanNfcHJlX3RlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMucG9wX2lnbm9yZXMoKTtcbiAgICAgICAgdGhpcy5mcmFnbWVudCA9IG5ldyBGcmFnbWVudCh0aGlzLCBhc3QuaHRtbCk7XG4gICAgICAgIHRoaXMubmFtZSA9IHRoaXMuZ2V0X3VuaXF1ZV9uYW1lKG5hbWUpO1xuICAgICAgICB0aGlzLnB1c2hfaWdub3Jlcyh0aGlzLmFzdC5pbnN0YW5jZSA/IGV4dHJhY3RfaWdub3Jlc19hYm92ZV9wb3NpdGlvbih0aGlzLmFzdC5pbnN0YW5jZS5zdGFydCwgdGhpcy5hc3QuaHRtbC5jaGlsZHJlbikgOiBbXSk7XG4gICAgICAgIHRoaXMud2Fsa19pbnN0YW5jZV9qc19wb3N0X3RlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMucG9wX2lnbm9yZXMoKTtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5mb3JFYWNoKGVsZW1lbnQgPT4gdGhpcy5zdHlsZXNoZWV0LmFwcGx5KGVsZW1lbnQpKTtcbiAgICAgICAgaWYgKCFjb21waWxlX29wdGlvbnMuY3VzdG9tRWxlbWVudClcbiAgICAgICAgICAgIHRoaXMuc3R5bGVzaGVldC5yZWlmeSgpO1xuICAgICAgICB0aGlzLnN0eWxlc2hlZXQud2Fybl9vbl91bnVzZWRfc2VsZWN0b3JzKHRoaXMpO1xuICAgIH1cbiAgICBhZGRfdmFyKHZhcmlhYmxlLCBhZGRfdG9fbG9va3VwID0gdHJ1ZSkge1xuICAgICAgICB0aGlzLnZhcnMucHVzaCh2YXJpYWJsZSk7XG4gICAgICAgIGlmIChhZGRfdG9fbG9va3VwKSB7XG4gICAgICAgICAgICB0aGlzLnZhcl9sb29rdXAuc2V0KHZhcmlhYmxlLm5hbWUsIHZhcmlhYmxlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhZGRfcmVmZXJlbmNlKG5hbWUpIHtcbiAgICAgICAgY29uc3QgdmFyaWFibGUgPSB0aGlzLnZhcl9sb29rdXAuZ2V0KG5hbWUpO1xuICAgICAgICBpZiAodmFyaWFibGUpIHtcbiAgICAgICAgICAgIHZhcmlhYmxlLnJlZmVyZW5jZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzX3Jlc2VydmVkX2tleXdvcmQobmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkX3Zhcih7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBpbmplY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VkOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChuYW1lWzBdID09PSAnJCcpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkX3Zhcih7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBpbmplY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VkOiB0cnVlLFxuICAgICAgICAgICAgICAgIG11dGF0ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3Qgc3Vic2NyaWJhYmxlX25hbWUgPSBuYW1lLnNsaWNlKDEpO1xuICAgICAgICAgICAgY29uc3QgdmFyaWFibGUgPSB0aGlzLnZhcl9sb29rdXAuZ2V0KHN1YnNjcmliYWJsZV9uYW1lKTtcbiAgICAgICAgICAgIGlmICh2YXJpYWJsZSkge1xuICAgICAgICAgICAgICAgIHZhcmlhYmxlLnJlZmVyZW5jZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHZhcmlhYmxlLnN1YnNjcmliYWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jb21waWxlX29wdGlvbnMudmFyc1JlcG9ydCA9PT0gJ2Z1bGwnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRfdmFyKHsgbmFtZSwgcmVmZXJlbmNlZDogdHJ1ZSB9LCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnVzZWRfbmFtZXMuYWRkKG5hbWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFsaWFzKG5hbWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmFsaWFzZXMuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLmFsaWFzZXMuc2V0KG5hbWUsIHRoaXMuZ2V0X3VuaXF1ZV9uYW1lKG5hbWUpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5hbGlhc2VzLmdldChuYW1lKTtcbiAgICB9XG4gICAgYXBwbHlfc3R5bGVzaGVldChlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuZWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICB9XG4gICAgZ2xvYmFsKG5hbWUpIHtcbiAgICAgICAgY29uc3QgYWxpYXMgPSB0aGlzLmFsaWFzKG5hbWUpO1xuICAgICAgICB0aGlzLmdsb2JhbHMuc2V0KG5hbWUsIGFsaWFzKTtcbiAgICAgICAgcmV0dXJuIGFsaWFzO1xuICAgIH1cbiAgICBnZW5lcmF0ZShyZXN1bHQpIHtcbiAgICAgICAgbGV0IGpzID0gbnVsbDtcbiAgICAgICAgbGV0IGNzcyA9IG51bGw7XG4gICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgY29tcGlsZV9vcHRpb25zLCBuYW1lIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBmb3JtYXQgPSAnZXNtJyB9ID0gY29tcGlsZV9vcHRpb25zO1xuICAgICAgICAgICAgY29uc3QgYmFubmVyID0gYCR7dGhpcy5maWxlID8gYCR7dGhpcy5maWxlfSBgIDogJyd9Z2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2JHsnMy40Ni4yJ31gO1xuICAgICAgICAgICAgY29uc3QgcHJvZ3JhbSA9IHsgdHlwZTogJ1Byb2dyYW0nLCBib2R5OiByZXN1bHQuanMgfTtcbiAgICAgICAgICAgIHdhbGsocHJvZ3JhbSwge1xuICAgICAgICAgICAgICAgIGVudGVyOiAobm9kZSwgcGFyZW50LCBrZXkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0lkZW50aWZpZXInKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5uYW1lWzBdID09PSAnQCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5uYW1lWzFdID09PSAnXycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxpYXMgPSB0aGlzLmdsb2JhbChub2RlLm5hbWUuc2xpY2UoMikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLm5hbWUgPSBhbGlhcy5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5hbWUgPSBub2RlLm5hbWUuc2xpY2UoMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21waWxlX29wdGlvbnMuaHlkcmF0YWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludGVybmFsX2V4cG9ydHMuaGFzKGAke25hbWV9X2h5ZHJhdGlvbmApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnX2h5ZHJhdGlvbic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpbnRlcm5hbF9leHBvcnRzLmhhcyhgJHtuYW1lfUh5ZHJhdGlvbmApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnSHlkcmF0aW9uJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29tcGlsZV9vcHRpb25zLmRldikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludGVybmFsX2V4cG9ydHMuaGFzKGAke25hbWV9X2RldmApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnX2Rldic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpbnRlcm5hbF9leHBvcnRzLmhhcyhgJHtuYW1lfURldmApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnRGV2JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbGlhcyA9IHRoaXMuYWxpYXMobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGVscGVycy5zZXQobmFtZSwgYWxpYXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLm5hbWUgPSBhbGlhcy5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUubmFtZVswXSAhPT0gJyMnICYmICFpc192YWxpZChub2RlLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBoYWNrIGFsbG93cyB4YGZvby4ke2Jhcn1gIHdoZXJlIGJhciBjb3VsZCBiZSBpbnZhbGlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGl0ZXJhbCA9IHsgdHlwZTogJ0xpdGVyYWwnLCB2YWx1ZTogbm9kZS5uYW1lIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC50eXBlID09PSAnUHJvcGVydHknICYmIGtleSA9PT0gJ2tleScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmtleSA9IGxpdGVyYWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcmVudC50eXBlID09PSAnTWVtYmVyRXhwcmVzc2lvbicgJiYga2V5ID09PSAncHJvcGVydHknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5wcm9wZXJ0eSA9IGxpdGVyYWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5jb21wdXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCByZWZlcmVuY2VkX2dsb2JhbHMgPSBBcnJheS5mcm9tKHRoaXMuZ2xvYmFscywgKFtuYW1lLCBhbGlhc10pID0+IG5hbWUgIT09IGFsaWFzLm5hbWUgJiYgeyBuYW1lLCBhbGlhcyB9KS5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICBpZiAocmVmZXJlbmNlZF9nbG9iYWxzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVscGVycy5zZXQoJ2dsb2JhbHMnLCB0aGlzLmFsaWFzKCdnbG9iYWxzJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaW1wb3J0ZWRfaGVscGVycyA9IEFycmF5LmZyb20odGhpcy5oZWxwZXJzLCAoW25hbWUsIGFsaWFzXSkgPT4gKHtcbiAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgIGFsaWFzXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBjcmVhdGVfbW9kdWxlKHByb2dyYW0sIGZvcm1hdCwgbmFtZSwgYmFubmVyLCBjb21waWxlX29wdGlvbnMuc3ZlbHRlUGF0aCwgaW1wb3J0ZWRfaGVscGVycywgcmVmZXJlbmNlZF9nbG9iYWxzLCB0aGlzLmltcG9ydHMsIHRoaXMudmFyc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIodmFyaWFibGUgPT4gdmFyaWFibGUubW9kdWxlICYmIHZhcmlhYmxlLmV4cG9ydF9uYW1lKVxuICAgICAgICAgICAgICAgIC5tYXAodmFyaWFibGUgPT4gKHtcbiAgICAgICAgICAgICAgICBuYW1lOiB2YXJpYWJsZS5uYW1lLFxuICAgICAgICAgICAgICAgIGFzOiB2YXJpYWJsZS5leHBvcnRfbmFtZVxuICAgICAgICAgICAgfSkpLCB0aGlzLmV4cG9ydHNfZnJvbSk7XG4gICAgICAgICAgICBjc3MgPSBjb21waWxlX29wdGlvbnMuY3VzdG9tRWxlbWVudFxuICAgICAgICAgICAgICAgID8geyBjb2RlOiBudWxsLCBtYXA6IG51bGwgfVxuICAgICAgICAgICAgICAgIDogcmVzdWx0LmNzcztcbiAgICAgICAgICAgIGNvbnN0IGpzX3NvdXJjZW1hcF9lbmFibGVkID0gY2hlY2tfZW5hYmxlX3NvdXJjZW1hcChjb21waWxlX29wdGlvbnMuZW5hYmxlU291cmNlbWFwLCAnanMnKTtcbiAgICAgICAgICAgIGlmICghanNfc291cmNlbWFwX2VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICBqcyA9IHByaW50KHByb2dyYW0pO1xuICAgICAgICAgICAgICAgIGpzLm1hcCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VtYXBfc291cmNlX2ZpbGVuYW1lID0gZ2V0X3NvdXJjZW1hcF9zb3VyY2VfZmlsZW5hbWUoY29tcGlsZV9vcHRpb25zKTtcbiAgICAgICAgICAgICAgICBqcyA9IHByaW50KHByb2dyYW0sIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlTWFwU291cmNlOiBzb3VyY2VtYXBfc291cmNlX2ZpbGVuYW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAganMubWFwLnNvdXJjZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZW1hcF9zb3VyY2VfZmlsZW5hbWVcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIGpzLm1hcC5zb3VyY2VzQ29udGVudCA9IFtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zb3VyY2VcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIGpzLm1hcCA9IGFwcGx5X3ByZXByb2Nlc3Nvcl9zb3VyY2VtYXAoc291cmNlbWFwX3NvdXJjZV9maWxlbmFtZSwganMubWFwLCBjb21waWxlX29wdGlvbnMuc291cmNlbWFwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAganMsXG4gICAgICAgICAgICBjc3MsXG4gICAgICAgICAgICBhc3Q6IHRoaXMub3JpZ2luYWxfYXN0LFxuICAgICAgICAgICAgd2FybmluZ3M6IHRoaXMud2FybmluZ3MsXG4gICAgICAgICAgICB2YXJzOiB0aGlzLmdldF92YXJzX3JlcG9ydCgpLFxuICAgICAgICAgICAgc3RhdHM6IHRoaXMuc3RhdHMucmVuZGVyKClcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZ2V0X3VuaXF1ZV9uYW1lKG5hbWUsIHNjb3BlKSB7XG4gICAgICAgIGlmICh0ZXN0KVxuICAgICAgICAgICAgbmFtZSA9IGAke25hbWV9JGA7XG4gICAgICAgIGxldCBhbGlhcyA9IG5hbWU7XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyByZXNlcnZlZC5oYXMoYWxpYXMpIHx8XG4gICAgICAgICAgICB0aGlzLnZhcl9sb29rdXAuaGFzKGFsaWFzKSB8fFxuICAgICAgICAgICAgdGhpcy51c2VkX25hbWVzLmhhcyhhbGlhcykgfHxcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsbHlfdXNlZF9uYW1lcy5oYXMoYWxpYXMpIHx8XG4gICAgICAgICAgICAoc2NvcGUgJiYgc2NvcGUuaGFzKGFsaWFzKSk7IGFsaWFzID0gYCR7bmFtZX1fJHtpKyt9YClcbiAgICAgICAgICAgIDtcbiAgICAgICAgdGhpcy51c2VkX25hbWVzLmFkZChhbGlhcyk7XG4gICAgICAgIHJldHVybiB7IHR5cGU6ICdJZGVudGlmaWVyJywgbmFtZTogYWxpYXMgfTtcbiAgICB9XG4gICAgZ2V0X3VuaXF1ZV9uYW1lX21ha2VyKCkge1xuICAgICAgICBjb25zdCBsb2NhbF91c2VkX25hbWVzID0gbmV3IFNldCgpO1xuICAgICAgICBmdW5jdGlvbiBhZGQobmFtZSkge1xuICAgICAgICAgICAgbG9jYWxfdXNlZF9uYW1lcy5hZGQobmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzZXJ2ZWQuZm9yRWFjaChhZGQpO1xuICAgICAgICBpbnRlcm5hbF9leHBvcnRzLmZvckVhY2goYWRkKTtcbiAgICAgICAgdGhpcy52YXJfbG9va3VwLmZvckVhY2goKF92YWx1ZSwga2V5KSA9PiBhZGQoa2V5KSk7XG4gICAgICAgIHJldHVybiAobmFtZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRlc3QpXG4gICAgICAgICAgICAgICAgbmFtZSA9IGAke25hbWV9JGA7XG4gICAgICAgICAgICBsZXQgYWxpYXMgPSBuYW1lO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IHRoaXMudXNlZF9uYW1lcy5oYXMoYWxpYXMpIHx8IGxvY2FsX3VzZWRfbmFtZXMuaGFzKGFsaWFzKTsgYWxpYXMgPSBgJHtuYW1lfV8ke2krK31gKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGxvY2FsX3VzZWRfbmFtZXMuYWRkKGFsaWFzKTtcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsbHlfdXNlZF9uYW1lcy5hZGQoYWxpYXMpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsXG4gICAgICAgICAgICAgICAgbmFtZTogYWxpYXNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgfVxuICAgIGdldF92YXJzX3JlcG9ydCgpIHtcbiAgICAgICAgY29uc3QgeyBjb21waWxlX29wdGlvbnMsIHZhcnMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHZhcnNfcmVwb3J0ID0gY29tcGlsZV9vcHRpb25zLnZhcnNSZXBvcnQgPT09IGZhbHNlXG4gICAgICAgICAgICA/IFtdXG4gICAgICAgICAgICA6IGNvbXBpbGVfb3B0aW9ucy52YXJzUmVwb3J0ID09PSAnZnVsbCdcbiAgICAgICAgICAgICAgICA/IHZhcnNcbiAgICAgICAgICAgICAgICA6IHZhcnMuZmlsdGVyKHYgPT4gIXYuZ2xvYmFsICYmICF2LmludGVybmFsKTtcbiAgICAgICAgcmV0dXJuIHZhcnNfcmVwb3J0Lm1hcCh2ID0+ICh7XG4gICAgICAgICAgICBuYW1lOiB2Lm5hbWUsXG4gICAgICAgICAgICBleHBvcnRfbmFtZTogdi5leHBvcnRfbmFtZSB8fCBudWxsLFxuICAgICAgICAgICAgaW5qZWN0ZWQ6IHYuaW5qZWN0ZWQgfHwgZmFsc2UsXG4gICAgICAgICAgICBtb2R1bGU6IHYubW9kdWxlIHx8IGZhbHNlLFxuICAgICAgICAgICAgbXV0YXRlZDogdi5tdXRhdGVkIHx8IGZhbHNlLFxuICAgICAgICAgICAgcmVhc3NpZ25lZDogdi5yZWFzc2lnbmVkIHx8IGZhbHNlLFxuICAgICAgICAgICAgcmVmZXJlbmNlZDogdi5yZWZlcmVuY2VkIHx8IGZhbHNlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHYud3JpdGFibGUgfHwgZmFsc2UsXG4gICAgICAgICAgICByZWZlcmVuY2VkX2Zyb21fc2NyaXB0OiB2LnJlZmVyZW5jZWRfZnJvbV9zY3JpcHQgfHwgZmFsc2VcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBlcnJvcihwb3MsIGUpIHtcbiAgICAgICAgaWYgKHRoaXMuY29tcGlsZV9vcHRpb25zLmVycm9yTW9kZSA9PT0gJ3dhcm4nKSB7XG4gICAgICAgICAgICB0aGlzLndhcm4ocG9zLCBlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVycm9yKGUubWVzc2FnZSwge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdWYWxpZGF0aW9uRXJyb3InLFxuICAgICAgICAgICAgICAgIGNvZGU6IGUuY29kZSxcbiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc291cmNlLFxuICAgICAgICAgICAgICAgIHN0YXJ0OiBwb3Muc3RhcnQsXG4gICAgICAgICAgICAgICAgZW5kOiBwb3MuZW5kLFxuICAgICAgICAgICAgICAgIGZpbGVuYW1lOiB0aGlzLmNvbXBpbGVfb3B0aW9ucy5maWxlbmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgd2Fybihwb3MsIHdhcm5pbmcpIHtcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlcyAmJiB0aGlzLmlnbm9yZXMuaGFzKHdhcm5pbmcuY29kZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdGFydCA9IHRoaXMubG9jYXRlKHBvcy5zdGFydCk7XG4gICAgICAgIGNvbnN0IGVuZCA9IHRoaXMubG9jYXRlKHBvcy5lbmQpO1xuICAgICAgICBjb25zdCBmcmFtZSA9IGdldF9jb2RlX2ZyYW1lKHRoaXMuc291cmNlLCBzdGFydC5saW5lIC0gMSwgc3RhcnQuY29sdW1uKTtcbiAgICAgICAgdGhpcy53YXJuaW5ncy5wdXNoKHtcbiAgICAgICAgICAgIGNvZGU6IHdhcm5pbmcuY29kZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHdhcm5pbmcubWVzc2FnZSxcbiAgICAgICAgICAgIGZyYW1lLFxuICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICBwb3M6IHBvcy5zdGFydCxcbiAgICAgICAgICAgIGZpbGVuYW1lOiB0aGlzLmNvbXBpbGVfb3B0aW9ucy5maWxlbmFtZSxcbiAgICAgICAgICAgIHRvU3RyaW5nOiAoKSA9PiBgJHt3YXJuaW5nLm1lc3NhZ2V9ICgke3N0YXJ0LmxpbmV9OiR7c3RhcnQuY29sdW1ufSlcXG4ke2ZyYW1lfWBcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGV4dHJhY3RfaW1wb3J0cyhub2RlKSB7XG4gICAgICAgIHRoaXMuaW1wb3J0cy5wdXNoKG5vZGUpO1xuICAgIH1cbiAgICBleHRyYWN0X2V4cG9ydHMobm9kZSwgbW9kdWxlX3NjcmlwdCA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IGlnbm9yZXMgPSBleHRyYWN0X3N2ZWx0ZV9pZ25vcmVfZnJvbV9jb21tZW50cyhub2RlKTtcbiAgICAgICAgaWYgKGlnbm9yZXMubGVuZ3RoKVxuICAgICAgICAgICAgdGhpcy5wdXNoX2lnbm9yZXMoaWdub3Jlcyk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2V4dHJhY3RfZXhwb3J0cyhub2RlLCBtb2R1bGVfc2NyaXB0KTtcbiAgICAgICAgaWYgKGlnbm9yZXMubGVuZ3RoKVxuICAgICAgICAgICAgdGhpcy5wb3BfaWdub3JlcygpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBfZXh0cmFjdF9leHBvcnRzKG5vZGUsIG1vZHVsZV9zY3JpcHQpIHtcbiAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0V4cG9ydERlZmF1bHREZWNsYXJhdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVycm9yKG5vZGUsIGNvbXBpbGVyX2Vycm9ycy5kZWZhdWx0X2V4cG9ydCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0V4cG9ydE5hbWVkRGVjbGFyYXRpb24nKSB7XG4gICAgICAgICAgICBpZiAobm9kZS5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBpZiAobW9kdWxlX3NjcmlwdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cG9ydHNfZnJvbS5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZV9leHBvcnRzX2Zyb20ucHVzaChub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobm9kZS5kZWNsYXJhdGlvbikge1xuICAgICAgICAgICAgICAgIGlmIChub2RlLmRlY2xhcmF0aW9uLnR5cGUgPT09ICdWYXJpYWJsZURlY2xhcmF0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBub2RlLmRlY2xhcmF0aW9uLmRlY2xhcmF0aW9ucy5mb3JFYWNoKGRlY2xhcmF0b3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdF9uYW1lcyhkZWNsYXJhdG9yLmlkKS5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gdGhpcy52YXJfbG9va3VwLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZS5leHBvcnRfbmFtZSA9IG5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlLndyaXRhYmxlICYmICEodmFyaWFibGUucmVmZXJlbmNlZCB8fCB2YXJpYWJsZS5yZWZlcmVuY2VkX2Zyb21fc2NyaXB0IHx8IHZhcmlhYmxlLnN1YnNjcmliYWJsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53YXJuKGRlY2xhcmF0b3IsIGNvbXBpbGVyX3dhcm5pbmdzLnVudXNlZF9leHBvcnRfbGV0KHRoaXMubmFtZS5uYW1lLCBuYW1lKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBub2RlLmRlY2xhcmF0aW9uLmlkO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IHRoaXMudmFyX2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlLmV4cG9ydF9uYW1lID0gbmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuZGVjbGFyYXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBub2RlLnNwZWNpZmllcnMuZm9yRWFjaChzcGVjaWZpZXIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IHRoaXMudmFyX2xvb2t1cC5nZXQoc3BlY2lmaWVyLmxvY2FsLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFyaWFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlLmV4cG9ydF9uYW1lID0gc3BlY2lmaWVyLmV4cG9ydGVkLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFyaWFibGUud3JpdGFibGUgJiYgISh2YXJpYWJsZS5yZWZlcmVuY2VkIHx8IHZhcmlhYmxlLnJlZmVyZW5jZWRfZnJvbV9zY3JpcHQgfHwgdmFyaWFibGUuc3Vic2NyaWJhYmxlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud2FybihzcGVjaWZpZXIsIGNvbXBpbGVyX3dhcm5pbmdzLnVudXNlZF9leHBvcnRfbGV0KHRoaXMubmFtZS5uYW1lLCBzcGVjaWZpZXIuZXhwb3J0ZWQubmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZXh0cmFjdF9qYXZhc2NyaXB0KHNjcmlwdCkge1xuICAgICAgICBpZiAoIXNjcmlwdClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gc2NyaXB0LmNvbnRlbnQuYm9keS5maWx0ZXIobm9kZSA9PiB7XG4gICAgICAgICAgICBpZiAoIW5vZGUpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMuaG9pc3RhYmxlX25vZGVzLmhhcyhub2RlKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5yZWFjdGl2ZV9kZWNsYXJhdGlvbl9ub2Rlcy5oYXMobm9kZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0ltcG9ydERlY2xhcmF0aW9uJylcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnRXhwb3J0RGVjbGFyYXRpb24nICYmIG5vZGUuc3BlY2lmaWVycy5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgd2Fsa19tb2R1bGVfanMoKSB7XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHNjcmlwdCA9IHRoaXMuYXN0Lm1vZHVsZTtcbiAgICAgICAgaWYgKCFzY3JpcHQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHdhbGsoc2NyaXB0LmNvbnRlbnQsIHtcbiAgICAgICAgICAgIGVudGVyKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnTGFiZWxlZFN0YXRlbWVudCcgJiYgbm9kZS5sYWJlbC5uYW1lID09PSAnJCcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lndhcm4obm9kZSwgY29tcGlsZXJfd2FybmluZ3MubW9kdWxlX3NjcmlwdF9yZWFjdGl2ZV9kZWNsYXJhdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyBzY29wZSwgZ2xvYmFscyB9ID0gY3JlYXRlX3Njb3BlcyhzY3JpcHQuY29udGVudCk7XG4gICAgICAgIHRoaXMubW9kdWxlX3Njb3BlID0gc2NvcGU7XG4gICAgICAgIHNjb3BlLmRlY2xhcmF0aW9ucy5mb3JFYWNoKChub2RlLCBuYW1lKSA9PiB7XG4gICAgICAgICAgICBpZiAobmFtZVswXSA9PT0gJyQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3Iobm9kZSwgY29tcGlsZXJfZXJyb3JzLmlsbGVnYWxfZGVjbGFyYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgd3JpdGFibGUgPSBub2RlLnR5cGUgPT09ICdWYXJpYWJsZURlY2xhcmF0aW9uJyAmJiAobm9kZS5raW5kID09PSAndmFyJyB8fCBub2RlLmtpbmQgPT09ICdsZXQnKTtcbiAgICAgICAgICAgIHRoaXMuYWRkX3Zhcih7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBtb2R1bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgaG9pc3RhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHdyaXRhYmxlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGdsb2JhbHMuZm9yRWFjaCgobm9kZSwgbmFtZSkgPT4ge1xuICAgICAgICAgICAgaWYgKG5hbWVbMF0gPT09ICckJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVycm9yKG5vZGUsIGNvbXBpbGVyX2Vycm9ycy5pbGxlZ2FsX3N1YnNjcmlwdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZF92YXIoe1xuICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICBnbG9iYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGhvaXN0YWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyBib2R5IH0gPSBzY3JpcHQuY29udGVudDtcbiAgICAgICAgbGV0IGkgPSBib2R5Lmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKC0taSA+PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBub2RlID0gYm9keVtpXTtcbiAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdJbXBvcnREZWNsYXJhdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmV4dHJhY3RfaW1wb3J0cyhub2RlKTtcbiAgICAgICAgICAgICAgICBib2R5LnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgvXkV4cG9ydC8udGVzdChub2RlLnR5cGUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVwbGFjZW1lbnQgPSB0aGlzLmV4dHJhY3RfZXhwb3J0cyhub2RlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBpZiAocmVwbGFjZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgYm9keVtpXSA9IHJlcGxhY2VtZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYm9keS5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHdhbGtfaW5zdGFuY2VfanNfcHJlX3RlbXBsYXRlKCkge1xuICAgICAgICBjb25zdCBzY3JpcHQgPSB0aGlzLmFzdC5pbnN0YW5jZTtcbiAgICAgICAgaWYgKCFzY3JpcHQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIGluamVjdCB2YXJzIGZvciByZWFjdGl2ZSBkZWNsYXJhdGlvbnNcbiAgICAgICAgc2NyaXB0LmNvbnRlbnQuYm9keS5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgICAgICAgaWYgKG5vZGUudHlwZSAhPT0gJ0xhYmVsZWRTdGF0ZW1lbnQnKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGlmIChub2RlLmJvZHkudHlwZSAhPT0gJ0V4cHJlc3Npb25TdGF0ZW1lbnQnKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IHsgZXhwcmVzc2lvbiB9ID0gbm9kZS5ib2R5O1xuICAgICAgICAgICAgaWYgKGV4cHJlc3Npb24udHlwZSAhPT0gJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJylcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAoZXhwcmVzc2lvbi5sZWZ0LnR5cGUgPT09ICdNZW1iZXJFeHByZXNzaW9uJylcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBleHRyYWN0X25hbWVzKGV4cHJlc3Npb24ubGVmdCkuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudmFyX2xvb2t1cC5oYXMobmFtZSkgJiYgbmFtZVswXSAhPT0gJyQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5qZWN0ZWRfcmVhY3RpdmVfZGVjbGFyYXRpb25fdmFycy5hZGQobmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB7IHNjb3BlOiBpbnN0YW5jZV9zY29wZSwgbWFwLCBnbG9iYWxzIH0gPSBjcmVhdGVfc2NvcGVzKHNjcmlwdC5jb250ZW50KTtcbiAgICAgICAgdGhpcy5pbnN0YW5jZV9zY29wZSA9IGluc3RhbmNlX3Njb3BlO1xuICAgICAgICB0aGlzLmluc3RhbmNlX3Njb3BlX21hcCA9IG1hcDtcbiAgICAgICAgaW5zdGFuY2Vfc2NvcGUuZGVjbGFyYXRpb25zLmZvckVhY2goKG5vZGUsIG5hbWUpID0+IHtcbiAgICAgICAgICAgIGlmIChuYW1lWzBdID09PSAnJCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lcnJvcihub2RlLCBjb21waWxlcl9lcnJvcnMuaWxsZWdhbF9kZWNsYXJhdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB3cml0YWJsZSA9IG5vZGUudHlwZSA9PT0gJ1ZhcmlhYmxlRGVjbGFyYXRpb24nICYmIChub2RlLmtpbmQgPT09ICd2YXInIHx8IG5vZGUua2luZCA9PT0gJ2xldCcpO1xuICAgICAgICAgICAgY29uc3QgaW1wb3J0ZWQgPSBub2RlLnR5cGUuc3RhcnRzV2l0aCgnSW1wb3J0Jyk7XG4gICAgICAgICAgICB0aGlzLmFkZF92YXIoe1xuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgaW5pdGlhbGlzZWQ6IGluc3RhbmNlX3Njb3BlLmluaXRpYWxpc2VkX2RlY2xhcmF0aW9ucy5oYXMobmFtZSksXG4gICAgICAgICAgICAgICAgd3JpdGFibGUsXG4gICAgICAgICAgICAgICAgaW1wb3J0ZWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5ub2RlX2Zvcl9kZWNsYXJhdGlvbi5zZXQobmFtZSwgbm9kZSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBOT1RFOiBhZGQgc3RvcmUgdmFyaWFibGUgZmlyc3QsIHRoZW4gb25seSAkc3RvcmUgdmFsdWVcbiAgICAgICAgLy8gYXMgYCRzdG9yZWAgd2lsbCBtYXJrIGBzdG9yZWAgdmFyaWFibGUgYXMgcmVmZXJlbmNlZCBhbmQgc3Vic2NyaWJhYmxlXG4gICAgICAgIGNvbnN0IGdsb2JhbF9rZXlzID0gQXJyYXkuZnJvbShnbG9iYWxzLmtleXMoKSk7XG4gICAgICAgIGNvbnN0IHNvcnRlZF9nbG9iYWxzID0gW1xuICAgICAgICAgICAgLi4uZ2xvYmFsX2tleXMuZmlsdGVyKGtleSA9PiBrZXlbMF0gIT09ICckJyksXG4gICAgICAgICAgICAuLi5nbG9iYWxfa2V5cy5maWx0ZXIoa2V5ID0+IGtleVswXSA9PT0gJyQnKVxuICAgICAgICBdO1xuICAgICAgICBzb3J0ZWRfZ2xvYmFscy5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMudmFyX2xvb2t1cC5oYXMobmFtZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGdsb2JhbHMuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5qZWN0ZWRfcmVhY3RpdmVfZGVjbGFyYXRpb25fdmFycy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZF92YXIoe1xuICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICBpbmplY3RlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJlYXNzaWduZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpc2VkOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpc19yZXNlcnZlZF9rZXl3b3JkKG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRfdmFyKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgaW5qZWN0ZWQ6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5hbWVbMF0gPT09ICckJykge1xuICAgICAgICAgICAgICAgIGlmIChuYW1lID09PSAnJCcgfHwgbmFtZVsxXSA9PT0gJyQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVycm9yKG5vZGUsIGNvbXBpbGVyX2Vycm9ycy5pbGxlZ2FsX2dsb2JhbChuYW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuYWRkX3Zhcih7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGluamVjdGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBtdXRhdGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkX3JlZmVyZW5jZShuYW1lLnNsaWNlKDEpKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IHRoaXMudmFyX2xvb2t1cC5nZXQobmFtZS5zbGljZSgxKSk7XG4gICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlLnN1YnNjcmliYWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlLnJlZmVyZW5jZWRfZnJvbV9zY3JpcHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkX3Zhcih7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGdsb2JhbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaG9pc3RhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRyYWNrX3JlZmVyZW5jZXNfYW5kX211dGF0aW9ucygpO1xuICAgIH1cbiAgICB3YWxrX2luc3RhbmNlX2pzX3Bvc3RfdGVtcGxhdGUoKSB7XG4gICAgICAgIGNvbnN0IHNjcmlwdCA9IHRoaXMuYXN0Lmluc3RhbmNlO1xuICAgICAgICBpZiAoIXNjcmlwdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5wb3N0X3RlbXBsYXRlX3dhbGsoKTtcbiAgICAgICAgdGhpcy5ob2lzdF9pbnN0YW5jZV9kZWNsYXJhdGlvbnMoKTtcbiAgICAgICAgdGhpcy5leHRyYWN0X3JlYWN0aXZlX2RlY2xhcmF0aW9ucygpO1xuICAgIH1cbiAgICBwb3N0X3RlbXBsYXRlX3dhbGsoKSB7XG4gICAgICAgIGNvbnN0IHNjcmlwdCA9IHRoaXMuYXN0Lmluc3RhbmNlO1xuICAgICAgICBpZiAoIXNjcmlwdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgY29tcG9uZW50ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBjb250ZW50IH0gPSBzY3JpcHQ7XG4gICAgICAgIGNvbnN0IHsgaW5zdGFuY2Vfc2NvcGUsIGluc3RhbmNlX3Njb3BlX21hcDogbWFwIH0gPSB0aGlzO1xuICAgICAgICBsZXQgc2NvcGUgPSBpbnN0YW5jZV9zY29wZTtcbiAgICAgICAgY29uc3QgdG9fcmVtb3ZlID0gW107XG4gICAgICAgIGNvbnN0IHJlbW92ZSA9IChwYXJlbnQsIHByb3AsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICB0b19yZW1vdmUudW5zaGlmdChbcGFyZW50LCBwcm9wLCBpbmRleF0pO1xuICAgICAgICB9O1xuICAgICAgICBsZXQgc2NvcGVfdXBkYXRlZCA9IGZhbHNlO1xuICAgICAgICBjb25zdCBjdXJyZW50X2Z1bmN0aW9uX3N0YWNrID0gW107XG4gICAgICAgIGxldCBjdXJyZW50X2Z1bmN0aW9uID0gbnVsbDtcbiAgICAgICAgd2Fsayhjb250ZW50LCB7XG4gICAgICAgICAgICBlbnRlcihub2RlLCBwYXJlbnQsIHByb3AsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKChub2RlLnR5cGUgPT09ICdGdW5jdGlvbkRlY2xhcmF0aW9uJyB8fCBub2RlLnR5cGUgPT09ICdGdW5jdGlvbkV4cHJlc3Npb24nKSkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2Z1bmN0aW9uX3N0YWNrLnB1c2goY3VycmVudF9mdW5jdGlvbiA9IG5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWFwLmhhcyhub2RlKSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZSA9IG1hcC5nZXQobm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdJbXBvcnREZWNsYXJhdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50LmV4dHJhY3RfaW1wb3J0cyhub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogdG8gdXNlIGFjdHVhbCByZW1vdmVcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlKHBhcmVudCwgcHJvcCwgaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5za2lwKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICgvXkV4cG9ydC8udGVzdChub2RlLnR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcGxhY2VtZW50ID0gY29tcG9uZW50LmV4dHJhY3RfZXhwb3J0cyhub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcGxhY2VtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2UocmVwbGFjZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogdG8gdXNlIGFjdHVhbCByZW1vdmVcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZShwYXJlbnQsIHByb3AsIGluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5za2lwKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbXBvbmVudC53YXJuX29uX3VuZGVmaW5lZF9zdG9yZV92YWx1ZV9yZWZlcmVuY2VzKG5vZGUsIHBhcmVudCwgcHJvcCwgc2NvcGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlYXZlKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoKG5vZGUudHlwZSA9PT0gJ0Z1bmN0aW9uRGVjbGFyYXRpb24nIHx8IG5vZGUudHlwZSA9PT0gJ0Z1bmN0aW9uRXhwcmVzc2lvbicpKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfZnVuY3Rpb25fc3RhY2sucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfZnVuY3Rpb24gPSBjdXJyZW50X2Z1bmN0aW9uX3N0YWNrW2N1cnJlbnRfZnVuY3Rpb25fc3RhY2subGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGRvIGl0IG9uIGxlYXZlLCB0byBwcmV2ZW50IGluZmluaXRlIGxvb3BcbiAgICAgICAgICAgICAgICBpZiAoY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5kZXYgJiYgY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5sb29wR3VhcmRUaW1lb3V0ID4gMCAmJiAoIWN1cnJlbnRfZnVuY3Rpb24gfHwgKCFjdXJyZW50X2Z1bmN0aW9uLmdlbmVyYXRvciAmJiAhY3VycmVudF9mdW5jdGlvbi5hc3luYykpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvX3JlcGxhY2VfZm9yX2xvb3BfcHJvdGVjdCA9IGNvbXBvbmVudC5sb29wX3Byb3RlY3Qobm9kZSwgc2NvcGUsIGNvbXBvbmVudC5jb21waWxlX29wdGlvbnMubG9vcEd1YXJkVGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0b19yZXBsYWNlX2Zvcl9sb29wX3Byb3RlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZSh0b19yZXBsYWNlX2Zvcl9sb29wX3Byb3RlY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGVfdXBkYXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1hcC5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZm9yIChjb25zdCBbcGFyZW50LCBwcm9wLCBpbmRleF0gb2YgdG9fcmVtb3ZlKSB7XG4gICAgICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudFtwcm9wXS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHBhcmVudFtwcm9wXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNjb3BlX3VwZGF0ZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc2NvcGUsIG1hcCB9ID0gY3JlYXRlX3Njb3BlcyhzY3JpcHQuY29udGVudCk7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlX3Njb3BlID0gc2NvcGU7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlX3Njb3BlX21hcCA9IG1hcDtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0cmFja19yZWZlcmVuY2VzX2FuZF9tdXRhdGlvbnMoKSB7XG4gICAgICAgIGNvbnN0IHNjcmlwdCA9IHRoaXMuYXN0Lmluc3RhbmNlO1xuICAgICAgICBpZiAoIXNjcmlwdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgY29tcG9uZW50ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBjb250ZW50IH0gPSBzY3JpcHQ7XG4gICAgICAgIGNvbnN0IHsgaW5zdGFuY2Vfc2NvcGUsIG1vZHVsZV9zY29wZSwgaW5zdGFuY2Vfc2NvcGVfbWFwOiBtYXAgfSA9IHRoaXM7XG4gICAgICAgIGxldCBzY29wZSA9IGluc3RhbmNlX3Njb3BlO1xuICAgICAgICB3YWxrKGNvbnRlbnQsIHtcbiAgICAgICAgICAgIGVudGVyKG5vZGUsIHBhcmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChtYXAuaGFzKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlID0gbWFwLmdldChub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJyB8fCBub2RlLnR5cGUgPT09ICdVcGRhdGVFeHByZXNzaW9uJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhc3NpZ25lZSA9IG5vZGUudHlwZSA9PT0gJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJyA/IG5vZGUubGVmdCA6IG5vZGUuYXJndW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVzID0gZXh0cmFjdF9uYW1lcyhhc3NpZ25lZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZXAgPSBhc3NpZ25lZS50eXBlID09PSAnTWVtYmVyRXhwcmVzc2lvbic7XG4gICAgICAgICAgICAgICAgICAgIG5hbWVzLmZvckVhY2gobmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzY29wZV9vd25lciA9IHNjb3BlLmZpbmRfb3duZXIobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGVfb3duZXIgIT09IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHNjb3BlX293bmVyID09PSBpbnN0YW5jZV9zY29wZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogbW9kdWxlX3Njb3BlICYmIG1vZHVsZV9zY29wZS5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IGNvbXBvbmVudC52YXJfbG9va3VwLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZVtkZWVwID8gJ211dGF0ZWQnIDogJ3JlYXNzaWduZWQnXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXNfdXNlZF9hc19yZWZlcmVuY2Uobm9kZSwgcGFyZW50KSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmplY3QgPSBnZXRfb2JqZWN0KG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZmluZF9vd25lcihvYmplY3QubmFtZSkgPT09IGluc3RhbmNlX3Njb3BlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IGNvbXBvbmVudC52YXJfbG9va3VwLmdldChvYmplY3QubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZS5yZWZlcmVuY2VkX2Zyb21fc2NyaXB0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZWF2ZShub2RlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1hcC5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgd2Fybl9vbl91bmRlZmluZWRfc3RvcmVfdmFsdWVfcmVmZXJlbmNlcyhub2RlLCBwYXJlbnQsIHByb3AsIHNjb3BlKSB7XG4gICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdMYWJlbGVkU3RhdGVtZW50JyAmJlxuICAgICAgICAgICAgbm9kZS5sYWJlbC5uYW1lID09PSAnJCcgJiZcbiAgICAgICAgICAgIHBhcmVudC50eXBlICE9PSAnUHJvZ3JhbScpIHtcbiAgICAgICAgICAgIHRoaXMud2Fybihub2RlLCBjb21waWxlcl93YXJuaW5ncy5ub25fdG9wX2xldmVsX3JlYWN0aXZlX2RlY2xhcmF0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNfcmVmZXJlbmNlKG5vZGUsIHBhcmVudCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdCA9IGdldF9vYmplY3Qobm9kZSk7XG4gICAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IG9iamVjdDtcbiAgICAgICAgICAgIGlmIChuYW1lWzBdID09PSAnJCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXNjb3BlLmhhcyhuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndhcm5faWZfdW5kZWZpbmVkKG5hbWUsIG9iamVjdCwgbnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChuYW1lWzFdICE9PSAnJCcgJiYgc2NvcGUuaGFzKG5hbWUuc2xpY2UoMSkpICYmIHNjb3BlLmZpbmRfb3duZXIobmFtZS5zbGljZSgxKSkgIT09IHRoaXMuaW5zdGFuY2Vfc2NvcGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoKC9GdW5jdGlvbi8udGVzdChwYXJlbnQudHlwZSkgJiYgcHJvcCA9PT0gJ3BhcmFtcycpIHx8IChwYXJlbnQudHlwZSA9PT0gJ1ZhcmlhYmxlRGVjbGFyYXRvcicgJiYgcHJvcCA9PT0gJ2lkJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lcnJvcihub2RlLCBjb21waWxlcl9lcnJvcnMuY29udGV4dHVhbF9zdG9yZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgbG9vcF9wcm90ZWN0KG5vZGUsIHNjb3BlLCB0aW1lb3V0KSB7XG4gICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdXaGlsZVN0YXRlbWVudCcgfHxcbiAgICAgICAgICAgIG5vZGUudHlwZSA9PT0gJ0ZvclN0YXRlbWVudCcgfHxcbiAgICAgICAgICAgIG5vZGUudHlwZSA9PT0gJ0RvV2hpbGVTdGF0ZW1lbnQnKSB7XG4gICAgICAgICAgICBjb25zdCBndWFyZCA9IHRoaXMuZ2V0X3VuaXF1ZV9uYW1lKCdndWFyZCcsIHNjb3BlKTtcbiAgICAgICAgICAgIHRoaXMudXNlZF9uYW1lcy5hZGQoZ3VhcmQubmFtZSk7XG4gICAgICAgICAgICBjb25zdCBiZWZvcmUgPSBiIGBjb25zdCAke2d1YXJkfSA9IEBsb29wX2d1YXJkKCR7dGltZW91dH0pYDtcbiAgICAgICAgICAgIGNvbnN0IGluc2lkZSA9IGIgYCR7Z3VhcmR9KCk7YDtcbiAgICAgICAgICAgIC8vIHdyYXAgZXhwcmVzc2lvbiBzdGF0ZW1lbnQgd2l0aCBCbG9ja1N0YXRlbWVudFxuICAgICAgICAgICAgaWYgKG5vZGUuYm9keS50eXBlICE9PSAnQmxvY2tTdGF0ZW1lbnQnKSB7XG4gICAgICAgICAgICAgICAgbm9kZS5ib2R5ID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQmxvY2tTdGF0ZW1lbnQnLFxuICAgICAgICAgICAgICAgICAgICBib2R5OiBbbm9kZS5ib2R5XVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBub2RlLmJvZHkuYm9keS5wdXNoKGluc2lkZVswXSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdCbG9ja1N0YXRlbWVudCcsXG4gICAgICAgICAgICAgICAgYm9keTogW1xuICAgICAgICAgICAgICAgICAgICBiZWZvcmVbMF0sXG4gICAgICAgICAgICAgICAgICAgIG5vZGVcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXdyaXRlX3Byb3BzKGdldF9pbnNlcnQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmFzdC5pbnN0YW5jZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgY29tcG9uZW50ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBpbnN0YW5jZV9zY29wZSwgaW5zdGFuY2Vfc2NvcGVfbWFwOiBtYXAgfSA9IHRoaXM7XG4gICAgICAgIGxldCBzY29wZSA9IGluc3RhbmNlX3Njb3BlO1xuICAgICAgICB3YWxrKHRoaXMuYXN0Lmluc3RhbmNlLmNvbnRlbnQsIHtcbiAgICAgICAgICAgIGVudGVyKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoL0Z1bmN0aW9uLy50ZXN0KG5vZGUudHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2tpcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWFwLmhhcyhub2RlKSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZSA9IG1hcC5nZXQobm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdFeHBvcnROYW1lZERlY2xhcmF0aW9uJyAmJiBub2RlLmRlY2xhcmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2Uobm9kZS5kZWNsYXJhdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdWYXJpYWJsZURlY2xhcmF0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBOT1RFOiBgdmFyYCBkb2VzIG5vdCBmb2xsb3cgYmxvY2sgc2NvcGluZ1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5raW5kID09PSAndmFyJyB8fCBzY29wZSA9PT0gaW5zdGFuY2Vfc2NvcGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc2VydHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZGRfbmV3X3Byb3BzKGV4cG9ydGVkLCBsb2NhbCwgZGVmYXVsdF92YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUHJvcGVydHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9ydGhhbmQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ6ICdpbml0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBleHBvcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRlZmF1bHRfdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdBc3NpZ25tZW50UGF0dGVybicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogbG9jYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IGRlZmF1bHRfdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogbG9jYWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyYW5zZm9ybVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYGBgXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBleHBvcnQgbGV0IHsgeCwgeSA9IDEyMyB9ID0gT0JKLCB6ID0gNDU2XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBgYGBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGludG9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGBgYFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGV0IHsgeDogeCQsIHk6IHkkID0gMTIzIH0gPSBPQko7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBsZXQgeyB4ID0geCQsIHkgPSB5JCwgeiA9IDQ1NiB9ID0gJCRwcm9wcztcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGBgYFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IG5vZGUuZGVjbGFyYXRpb25zLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlY2xhcmF0b3IgPSBub2RlLmRlY2xhcmF0aW9uc1tpbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlY2xhcmF0b3IuaWQudHlwZSAhPT0gJ0lkZW50aWZpZXInKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldF9uZXdfbmFtZShsb2NhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFyaWFibGUgPSBjb21wb25lbnQudmFyX2xvb2t1cC5nZXQobG9jYWwubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFyaWFibGUuc3Vic2NyaWJhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0cy5wdXNoKGdldF9pbnNlcnQodmFyaWFibGUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZS5leHBvcnRfbmFtZSAmJiB2YXJpYWJsZS53cml0YWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsaWFzX25hbWUgPSBjb21wb25lbnQuZ2V0X3VuaXF1ZV9uYW1lKGxvY2FsLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZF9uZXdfcHJvcHMoeyB0eXBlOiAnSWRlbnRpZmllcicsIG5hbWU6IHZhcmlhYmxlLmV4cG9ydF9uYW1lIH0sIGxvY2FsLCBhbGlhc19uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWxpYXNfbmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsb2NhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiByZW5hbWVfaWRlbnRpZmllcnMocGFyYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocGFyYW0udHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ09iamVjdFBhdHRlcm4nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhbmRsZV9wcm9wID0gKHByb3ApID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wLnR5cGUgPT09ICdSZXN0RWxlbWVudCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5hbWVfaWRlbnRpZmllcnMocHJvcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChwcm9wLnZhbHVlLnR5cGUgPT09ICdJZGVudGlmaWVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3AudmFsdWUgPSBnZXRfbmV3X25hbWUocHJvcC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5hbWVfaWRlbnRpZmllcnMocHJvcC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtLnByb3BlcnRpZXMuZm9yRWFjaChoYW5kbGVfcHJvcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdBcnJheVBhdHRlcm4nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhbmRsZV9lbGVtZW50ID0gKGVsZW1lbnQsIGluZGV4LCBhcnJheSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC50eXBlID09PSAnSWRlbnRpZmllcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlbaW5kZXhdID0gZ2V0X25ld19uYW1lKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuYW1lX2lkZW50aWZpZXJzKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0uZWxlbWVudHMuZm9yRWFjaChoYW5kbGVfZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdSZXN0RWxlbWVudCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtLmFyZ3VtZW50ID0gZ2V0X25ld19uYW1lKHBhcmFtLmFyZ3VtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnQXNzaWdubWVudFBhdHRlcm4nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW0ubGVmdC50eXBlID09PSAnSWRlbnRpZmllcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtLmxlZnQgPSBnZXRfbmV3X25hbWUocGFyYW0ubGVmdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5hbWVfaWRlbnRpZmllcnMocGFyYW0ubGVmdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuYW1lX2lkZW50aWZpZXJzKGRlY2xhcmF0b3IuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBkZWNsYXJhdG9yLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IGNvbXBvbmVudC52YXJfbG9va3VwLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNfcHJvcHMgPSB2YXJpYWJsZS5leHBvcnRfbmFtZSAmJiB2YXJpYWJsZS53cml0YWJsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzX3Byb3BzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRfbmV3X3Byb3BzKHsgdHlwZTogJ0lkZW50aWZpZXInLCBuYW1lOiB2YXJpYWJsZS5leHBvcnRfbmFtZSB9LCBkZWNsYXJhdG9yLmlkLCBkZWNsYXJhdG9yLmluaXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5kZWNsYXJhdGlvbnMuc3BsaWNlKGluZGV4LS0sIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZS5zdWJzY3JpYmFibGUgJiYgKGlzX3Byb3BzIHx8IGRlY2xhcmF0b3IuaW5pdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydHMucHVzaChnZXRfaW5zZXJ0KHZhcmlhYmxlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2UoYiBgXG5cdFx0XHRcdFx0XHRcdCR7bm9kZS5kZWNsYXJhdGlvbnMubGVuZ3RoID8gbm9kZSA6IG51bGx9XG5cdFx0XHRcdFx0XHRcdCR7cHJvcHMubGVuZ3RoID4gMCAmJiBiIGBsZXQgeyAke3Byb3BzfSB9ID0gJCRwcm9wcztgfVxuXHRcdFx0XHRcdFx0XHQke2luc2VydHN9XG5cdFx0XHRcdFx0XHRgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNraXAoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZWF2ZShub2RlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1hcC5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaG9pc3RfaW5zdGFuY2VfZGVjbGFyYXRpb25zKCkge1xuICAgICAgICAvLyB3ZSBjYW4gc2FmZWx5IGhvaXN0IHZhcmlhYmxlIGRlY2xhcmF0aW9ucyB0aGF0IGFyZVxuICAgICAgICAvLyBpbml0aWFsaXNlZCB0byBsaXRlcmFscywgYW5kIGZ1bmN0aW9ucyB0aGF0IGRvbid0XG4gICAgICAgIC8vIHJlZmVyZW5jZSBpbnN0YW5jZSB2YXJpYWJsZXMgb3RoZXIgdGhhbiBvdGhlclxuICAgICAgICAvLyBob2lzdGFibGUgZnVuY3Rpb25zLiBUT0RPIG90aGVycz9cbiAgICAgICAgY29uc3QgeyBob2lzdGFibGVfbm9kZXMsIHZhcl9sb29rdXAsIGluamVjdGVkX3JlYWN0aXZlX2RlY2xhcmF0aW9uX3ZhcnMsIGltcG9ydHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHRvcF9sZXZlbF9mdW5jdGlvbl9kZWNsYXJhdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGNvbnN0IHsgYm9keSB9ID0gdGhpcy5hc3QuaW5zdGFuY2UuY29udGVudDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2R5Lmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBub2RlID0gYm9keVtpXTtcbiAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdWYXJpYWJsZURlY2xhcmF0aW9uJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFsbF9ob2lzdGFibGUgPSBub2RlLmRlY2xhcmF0aW9ucy5ldmVyeShkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkLmluaXQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLmluaXQudHlwZSAhPT0gJ0xpdGVyYWwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAvLyBldmVyeXRoaW5nIGV4Y2VwdCBjb25zdCB2YWx1ZXMgY2FuIGJlIGNoYW5nZWQgYnkgZS5nLiBzdmVsdGUgZGV2dG9vbHNcbiAgICAgICAgICAgICAgICAgICAgLy8gd2hpY2ggbWVhbnMgd2UgY2FuJ3QgaG9pc3QgaXRcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUua2luZCAhPT0gJ2NvbnN0JyAmJiB0aGlzLmNvbXBpbGVfb3B0aW9ucy5kZXYpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gZC5pZDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudmFyX2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2LnJlYXNzaWduZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2LmV4cG9ydF9uYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy52YXJfbG9va3VwLmdldChuYW1lKS5yZWFzc2lnbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy52YXJzLmZpbmQodmFyaWFibGUgPT4gdmFyaWFibGUubmFtZSA9PT0gbmFtZSAmJiB2YXJpYWJsZS5tb2R1bGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKGFsbF9ob2lzdGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5kZWNsYXJhdGlvbnMuZm9yRWFjaChkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gdGhpcy52YXJfbG9va3VwLmdldChkLmlkLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGUuaG9pc3RhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGhvaXN0YWJsZV9ub2Rlcy5hZGQobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIGJvZHkuc3BsaWNlKGktLSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZnVsbHlfaG9pc3RlZC5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdFeHBvcnROYW1lZERlY2xhcmF0aW9uJyAmJlxuICAgICAgICAgICAgICAgIG5vZGUuZGVjbGFyYXRpb24gJiZcbiAgICAgICAgICAgICAgICBub2RlLmRlY2xhcmF0aW9uLnR5cGUgPT09ICdGdW5jdGlvbkRlY2xhcmF0aW9uJykge1xuICAgICAgICAgICAgICAgIHRvcF9sZXZlbF9mdW5jdGlvbl9kZWNsYXJhdGlvbnMuc2V0KG5vZGUuZGVjbGFyYXRpb24uaWQubmFtZSwgbm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnRnVuY3Rpb25EZWNsYXJhdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0b3BfbGV2ZWxfZnVuY3Rpb25fZGVjbGFyYXRpb25zLnNldChub2RlLmlkLm5hbWUsIG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoZWNrZWQgPSBuZXcgU2V0KCk7XG4gICAgICAgIGNvbnN0IHdhbGtpbmcgPSBuZXcgU2V0KCk7XG4gICAgICAgIGNvbnN0IGlzX2hvaXN0YWJsZSA9IGZuX2RlY2xhcmF0aW9uID0+IHtcbiAgICAgICAgICAgIGlmIChmbl9kZWNsYXJhdGlvbi50eXBlID09PSAnRXhwb3J0TmFtZWREZWNsYXJhdGlvbicpIHtcbiAgICAgICAgICAgICAgICBmbl9kZWNsYXJhdGlvbiA9IGZuX2RlY2xhcmF0aW9uLmRlY2xhcmF0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaW5zdGFuY2Vfc2NvcGUgPSB0aGlzLmluc3RhbmNlX3Njb3BlO1xuICAgICAgICAgICAgbGV0IHNjb3BlID0gdGhpcy5pbnN0YW5jZV9zY29wZTtcbiAgICAgICAgICAgIGNvbnN0IG1hcCA9IHRoaXMuaW5zdGFuY2Vfc2NvcGVfbWFwO1xuICAgICAgICAgICAgbGV0IGhvaXN0YWJsZSA9IHRydWU7XG4gICAgICAgICAgICAvLyBoYW5kbGUgY3ljbGVzXG4gICAgICAgICAgICB3YWxraW5nLmFkZChmbl9kZWNsYXJhdGlvbik7XG4gICAgICAgICAgICB3YWxrKGZuX2RlY2xhcmF0aW9uLCB7XG4gICAgICAgICAgICAgICAgZW50ZXIobm9kZSwgcGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaG9pc3RhYmxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2tpcCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWFwLmhhcyhub2RlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBtYXAuZ2V0KG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc19yZWZlcmVuY2Uobm9kZSwgcGFyZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBmbGF0dGVuX3JlZmVyZW5jZShub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG93bmVyID0gc2NvcGUuZmluZF9vd25lcihuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmplY3RlZF9yZWFjdGl2ZV9kZWNsYXJhdGlvbl92YXJzLmhhcyhuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvaXN0YWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobmFtZVswXSA9PT0gJyQnICYmICFvd25lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvaXN0YWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAob3duZXIgPT09IGluc3RhbmNlX3Njb3BlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFyaWFibGUgPSB2YXJfbG9va3VwLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFyaWFibGUucmVhc3NpZ25lZCB8fCB2YXJpYWJsZS5tdXRhdGVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob2lzdGFibGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gZm5fZGVjbGFyYXRpb24uaWQubmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZS5ob2lzdGFibGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9wX2xldmVsX2Z1bmN0aW9uX2RlY2xhcmF0aW9ucy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJfZGVjbGFyYXRpb24gPSB0b3BfbGV2ZWxfZnVuY3Rpb25fZGVjbGFyYXRpb25zLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdhbGtpbmcuaGFzKG90aGVyX2RlY2xhcmF0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9pc3RhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAob3RoZXJfZGVjbGFyYXRpb24udHlwZSA9PT0gJ0V4cG9ydE5hbWVkRGVjbGFyYXRpb24nICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWxraW5nLmhhcyhvdGhlcl9kZWNsYXJhdGlvbi5kZWNsYXJhdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvaXN0YWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFpc19ob2lzdGFibGUob3RoZXJfZGVjbGFyYXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob2lzdGFibGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9pc3RhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5za2lwKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxlYXZlKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcC5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlID0gc2NvcGUucGFyZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjaGVja2VkLmFkZChmbl9kZWNsYXJhdGlvbik7XG4gICAgICAgICAgICB3YWxraW5nLmRlbGV0ZShmbl9kZWNsYXJhdGlvbik7XG4gICAgICAgICAgICByZXR1cm4gaG9pc3RhYmxlO1xuICAgICAgICB9O1xuICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBub2RlXSBvZiB0b3BfbGV2ZWxfZnVuY3Rpb25fZGVjbGFyYXRpb25zKSB7XG4gICAgICAgICAgICBpZiAoaXNfaG9pc3RhYmxlKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFyaWFibGUgPSB0aGlzLnZhcl9sb29rdXAuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgICAgIHZhcmlhYmxlLmhvaXN0YWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgaG9pc3RhYmxlX25vZGVzLmFkZChub2RlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gYm9keS5pbmRleE9mKG5vZGUpO1xuICAgICAgICAgICAgICAgIGJvZHkuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIHRoaXMuZnVsbHlfaG9pc3RlZC5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgeyBzcGVjaWZpZXJzIH0gb2YgaW1wb3J0cykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBzcGVjaWZpZXIgb2Ygc3BlY2lmaWVycykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gdmFyX2xvb2t1cC5nZXQoc3BlY2lmaWVyLmxvY2FsLm5hbWUpO1xuICAgICAgICAgICAgICAgIGlmICghdmFyaWFibGUubXV0YXRlZCB8fCB2YXJpYWJsZS5zdWJzY3JpYmFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyaWFibGUuaG9pc3RhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZXh0cmFjdF9yZWFjdGl2ZV9kZWNsYXJhdGlvbnMoKSB7XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHVuc29ydGVkX3JlYWN0aXZlX2RlY2xhcmF0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLmFzdC5pbnN0YW5jZS5jb250ZW50LmJvZHkuZm9yRWFjaChub2RlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGlnbm9yZXMgPSBleHRyYWN0X3N2ZWx0ZV9pZ25vcmVfZnJvbV9jb21tZW50cyhub2RlKTtcbiAgICAgICAgICAgIGlmIChpZ25vcmVzLmxlbmd0aClcbiAgICAgICAgICAgICAgICB0aGlzLnB1c2hfaWdub3JlcyhpZ25vcmVzKTtcbiAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdMYWJlbGVkU3RhdGVtZW50JyAmJiBub2RlLmxhYmVsLm5hbWUgPT09ICckJykge1xuICAgICAgICAgICAgICAgIHRoaXMucmVhY3RpdmVfZGVjbGFyYXRpb25fbm9kZXMuYWRkKG5vZGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFzc2lnbmVlcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhc3NpZ25lZV9ub2RlcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kdWxlX2RlcGVuZGVuY2llcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgICAgICBsZXQgc2NvcGUgPSB0aGlzLmluc3RhbmNlX3Njb3BlO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hcCA9IHRoaXMuaW5zdGFuY2Vfc2NvcGVfbWFwO1xuICAgICAgICAgICAgICAgIHdhbGsobm9kZS5ib2R5LCB7XG4gICAgICAgICAgICAgICAgICAgIGVudGVyKG5vZGUsIHBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcC5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZSA9IG1hcC5nZXQobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnQXNzaWdubWVudEV4cHJlc3Npb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVmdCA9IGdldF9vYmplY3Qobm9kZS5sZWZ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0X2lkZW50aWZpZXJzKGxlZnQpLmZvckVhY2gobm9kZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbmVlX25vZGVzLmFkZChub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWVzLmFkZChub2RlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLm9wZXJhdG9yICE9PSAnPScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmFkZChsZWZ0Lm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gJ1VwZGF0ZUV4cHJlc3Npb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaWRlbnRpZmllciA9IGdldF9vYmplY3Qobm9kZS5hcmd1bWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWVzLmFkZChpZGVudGlmaWVyLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNfcmVmZXJlbmNlKG5vZGUsIHBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpZGVudGlmaWVyID0gZ2V0X29iamVjdChub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFzc2lnbmVlX25vZGVzLmhhcyhpZGVudGlmaWVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IGlkZW50aWZpZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG93bmVyID0gc2NvcGUuZmluZF9vd25lcihuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFyaWFibGUgPSBjb21wb25lbnQudmFyX2xvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzaG91bGRfYWRkX2FzX2RlcGVuZGVuY3kgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFyaWFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlLmlzX3JlYWN0aXZlX2RlcGVuZGVuY3kgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlLm1vZHVsZSAmJiB2YXJpYWJsZS53cml0YWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3VsZF9hZGRfYXNfZGVwZW5kZW5jeSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZV9kZXBlbmRlbmNpZXMuYWRkKG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzX3dyaXRhYmxlX29yX211dGF0ZWQgPSB2YXJpYWJsZSAmJiAodmFyaWFibGUud3JpdGFibGUgfHwgdmFyaWFibGUubXV0YXRlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRfYWRkX2FzX2RlcGVuZGVuY3kgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICghb3duZXIgfHwgb3duZXIgPT09IGNvbXBvbmVudC5pbnN0YW5jZV9zY29wZSkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuYW1lWzBdID09PSAnJCcgfHwgaXNfd3JpdGFibGVfb3JfbXV0YXRlZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llcy5hZGQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5za2lwKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGxlYXZlKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXAuaGFzKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAobW9kdWxlX2RlcGVuZGVuY2llcy5zaXplID4gMCAmJiBkZXBlbmRlbmNpZXMuc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQud2Fybihub2RlLmJvZHksIGNvbXBpbGVyX3dhcm5pbmdzLm1vZHVsZV9zY3JpcHRfdmFyaWFibGVfcmVhY3RpdmVfZGVjbGFyYXRpb24oQXJyYXkuZnJvbShtb2R1bGVfZGVwZW5kZW5jaWVzKSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB7IGV4cHJlc3Npb24gfSA9IG5vZGUuYm9keTtcbiAgICAgICAgICAgICAgICBjb25zdCBkZWNsYXJhdGlvbiA9IGV4cHJlc3Npb24gJiYgZXhwcmVzc2lvbi5sZWZ0O1xuICAgICAgICAgICAgICAgIHVuc29ydGVkX3JlYWN0aXZlX2RlY2xhcmF0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgYXNzaWduZWVzLFxuICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMsXG4gICAgICAgICAgICAgICAgICAgIG5vZGUsXG4gICAgICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaWdub3Jlcy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgdGhpcy5wb3BfaWdub3JlcygpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbG9va3VwID0gbmV3IE1hcCgpO1xuICAgICAgICB1bnNvcnRlZF9yZWFjdGl2ZV9kZWNsYXJhdGlvbnMuZm9yRWFjaChkZWNsYXJhdGlvbiA9PiB7XG4gICAgICAgICAgICBkZWNsYXJhdGlvbi5hc3NpZ25lZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWxvb2t1cC5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9va3VwLnNldChuYW1lLCBbXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFRPRE8gd2FybiBvciBlcnJvciBpZiBhIG5hbWUgaXMgYXNzaWduZWQgdG8gaW5cbiAgICAgICAgICAgICAgICAvLyBtdWx0aXBsZSByZWFjdGl2ZSBkZWNsYXJhdGlvbnM/XG4gICAgICAgICAgICAgICAgbG9va3VwLmdldChuYW1lKS5wdXNoKGRlY2xhcmF0aW9uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY3ljbGUgPSBjaGVja19ncmFwaF9mb3JfY3ljbGVzKHVuc29ydGVkX3JlYWN0aXZlX2RlY2xhcmF0aW9ucy5yZWR1Y2UoKGFjYywgZGVjbGFyYXRpb24pID0+IHtcbiAgICAgICAgICAgIGRlY2xhcmF0aW9uLmFzc2lnbmVlcy5mb3JFYWNoKHYgPT4ge1xuICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uLmRlcGVuZGVuY2llcy5mb3JFYWNoKHcgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWRlY2xhcmF0aW9uLmFzc2lnbmVlcy5oYXModykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjYy5wdXNoKFt2LCB3XSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwgW10pKTtcbiAgICAgICAgaWYgKGN5Y2xlICYmIGN5Y2xlLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgZGVjbGFyYXRpb25MaXN0ID0gbG9va3VwLmdldChjeWNsZVswXSk7XG4gICAgICAgICAgICBjb25zdCBkZWNsYXJhdGlvbiA9IGRlY2xhcmF0aW9uTGlzdFswXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVycm9yKGRlY2xhcmF0aW9uLm5vZGUsIGNvbXBpbGVyX2Vycm9ycy5jeWNsaWNhbF9yZWFjdGl2ZV9kZWNsYXJhdGlvbihjeWNsZSkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFkZF9kZWNsYXJhdGlvbiA9IGRlY2xhcmF0aW9uID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnJlYWN0aXZlX2RlY2xhcmF0aW9ucy5pbmNsdWRlcyhkZWNsYXJhdGlvbikpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgZGVjbGFyYXRpb24uZGVwZW5kZW5jaWVzLmZvckVhY2gobmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGRlY2xhcmF0aW9uLmFzc2lnbmVlcy5oYXMobmFtZSkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBjb25zdCBlYXJsaWVyX2RlY2xhcmF0aW9ucyA9IGxvb2t1cC5nZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKGVhcmxpZXJfZGVjbGFyYXRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGVhcmxpZXJfZGVjbGFyYXRpb25zLmZvckVhY2goYWRkX2RlY2xhcmF0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMucmVhY3RpdmVfZGVjbGFyYXRpb25zLnB1c2goZGVjbGFyYXRpb24pO1xuICAgICAgICB9O1xuICAgICAgICB1bnNvcnRlZF9yZWFjdGl2ZV9kZWNsYXJhdGlvbnMuZm9yRWFjaChhZGRfZGVjbGFyYXRpb24pO1xuICAgIH1cbiAgICB3YXJuX2lmX3VuZGVmaW5lZChuYW1lLCBub2RlLCB0ZW1wbGF0ZV9zY29wZSkge1xuICAgICAgICBpZiAobmFtZVswXSA9PT0gJyQnKSB7XG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gJyQnIHx8IG5hbWVbMV0gPT09ICckJyAmJiAhaXNfcmVzZXJ2ZWRfa2V5d29yZChuYW1lKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVycm9yKG5vZGUsIGNvbXBpbGVyX2Vycm9ycy5pbGxlZ2FsX2dsb2JhbChuYW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmhhc19yZWFjdGl2ZV9hc3NpZ25tZW50cyA9IHRydWU7IC8vIFRPRE8gZG9lcyB0aGlzIGJlbG9uZyBoZXJlP1xuICAgICAgICAgICAgaWYgKGlzX3Jlc2VydmVkX2tleXdvcmQobmFtZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgbmFtZSA9IG5hbWUuc2xpY2UoMSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudmFyX2xvb2t1cC5oYXMobmFtZSkgJiYgIXRoaXMudmFyX2xvb2t1cC5nZXQobmFtZSkuZ2xvYmFsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodGVtcGxhdGVfc2NvcGUgJiYgdGVtcGxhdGVfc2NvcGUubmFtZXMuaGFzKG5hbWUpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoZ2xvYmFscy5oYXMobmFtZSkgJiYgbm9kZS50eXBlICE9PSAnSW5saW5lQ29tcG9uZW50JylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy53YXJuKG5vZGUsIGNvbXBpbGVyX3dhcm5pbmdzLm1pc3NpbmdfZGVjbGFyYXRpb24obmFtZSwgISF0aGlzLmFzdC5pbnN0YW5jZSkpO1xuICAgIH1cbiAgICBwdXNoX2lnbm9yZXMoaWdub3Jlcykge1xuICAgICAgICB0aGlzLmlnbm9yZXMgPSBuZXcgU2V0KHRoaXMuaWdub3JlcyB8fCBbXSk7XG4gICAgICAgIGFkZF90b19zZXQodGhpcy5pZ25vcmVzLCBpZ25vcmVzKTtcbiAgICAgICAgdGhpcy5pZ25vcmVfc3RhY2sucHVzaCh0aGlzLmlnbm9yZXMpO1xuICAgIH1cbiAgICBwb3BfaWdub3JlcygpIHtcbiAgICAgICAgdGhpcy5pZ25vcmVfc3RhY2sucG9wKCk7XG4gICAgICAgIHRoaXMuaWdub3JlcyA9IHRoaXMuaWdub3JlX3N0YWNrW3RoaXMuaWdub3JlX3N0YWNrLmxlbmd0aCAtIDFdO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHByb2Nlc3NfY29tcG9uZW50X29wdGlvbnMoY29tcG9uZW50LCBub2Rlcykge1xuICAgIGNvbnN0IGNvbXBvbmVudF9vcHRpb25zID0ge1xuICAgICAgICBpbW11dGFibGU6IGNvbXBvbmVudC5jb21waWxlX29wdGlvbnMuaW1tdXRhYmxlIHx8IGZhbHNlLFxuICAgICAgICBhY2Nlc3NvcnM6ICdhY2Nlc3NvcnMnIGluIGNvbXBvbmVudC5jb21waWxlX29wdGlvbnNcbiAgICAgICAgICAgID8gY29tcG9uZW50LmNvbXBpbGVfb3B0aW9ucy5hY2Nlc3NvcnNcbiAgICAgICAgICAgIDogISFjb21wb25lbnQuY29tcGlsZV9vcHRpb25zLmN1c3RvbUVsZW1lbnQsXG4gICAgICAgIHByZXNlcnZlV2hpdGVzcGFjZTogISFjb21wb25lbnQuY29tcGlsZV9vcHRpb25zLnByZXNlcnZlV2hpdGVzcGFjZSxcbiAgICAgICAgbmFtZXNwYWNlOiBjb21wb25lbnQuY29tcGlsZV9vcHRpb25zLm5hbWVzcGFjZVxuICAgIH07XG4gICAgY29uc3Qgbm9kZSA9IG5vZGVzLmZpbmQobm9kZSA9PiBub2RlLm5hbWUgPT09ICdzdmVsdGU6b3B0aW9ucycpO1xuICAgIGZ1bmN0aW9uIGdldF92YWx1ZShhdHRyaWJ1dGUsIHsgY29kZSwgbWVzc2FnZSB9KSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IGF0dHJpYnV0ZTtcbiAgICAgICAgY29uc3QgY2h1bmsgPSB2YWx1ZVswXTtcbiAgICAgICAgaWYgKCFjaHVuaylcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihhdHRyaWJ1dGUsIHsgY29kZSwgbWVzc2FnZSB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2h1bmsudHlwZSA9PT0gJ1RleHQnKVxuICAgICAgICAgICAgcmV0dXJuIGNodW5rLmRhdGE7XG4gICAgICAgIGlmIChjaHVuay5leHByZXNzaW9uLnR5cGUgIT09ICdMaXRlcmFsJykge1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihhdHRyaWJ1dGUsIHsgY29kZSwgbWVzc2FnZSB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2h1bmsuZXhwcmVzc2lvbi52YWx1ZTtcbiAgICB9XG4gICAgaWYgKG5vZGUpIHtcbiAgICAgICAgbm9kZS5hdHRyaWJ1dGVzLmZvckVhY2goYXR0cmlidXRlID0+IHtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUudHlwZSA9PT0gJ0F0dHJpYnV0ZScpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IGF0dHJpYnV0ZTtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndGFnJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFnID0gZ2V0X3ZhbHVlKGF0dHJpYnV0ZSwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfdGFnX2F0dHJpYnV0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRhZyAhPT0gJ3N0cmluZycgJiYgdGFnICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihhdHRyaWJ1dGUsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX3RhZ19hdHRyaWJ1dGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhZyAmJiAhL15bYS16QS1aXVthLXpBLVowLTldKi1bYS16QS1aMC05LV0rJC8udGVzdCh0YWcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihhdHRyaWJ1dGUsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX3RhZ19wcm9wZXJ0eSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFnICYmICFjb21wb25lbnQuY29tcGlsZV9vcHRpb25zLmN1c3RvbUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQud2FybihhdHRyaWJ1dGUsIGNvbXBpbGVyX3dhcm5pbmdzLm1pc3NpbmdfY3VzdG9tX2VsZW1lbnRfY29tcGlsZV9vcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudF9vcHRpb25zLnRhZyA9IHRhZztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25hbWVzcGFjZSc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5zID0gZ2V0X3ZhbHVlKGF0dHJpYnV0ZSwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfbmFtZXNwYWNlX2F0dHJpYnV0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG5zICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoYXR0cmlidXRlLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9uYW1lc3BhY2VfYXR0cmlidXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWxpZF9uYW1lc3BhY2VzLmluZGV4T2YobnMpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gZnV6enltYXRjaChucywgdmFsaWRfbmFtZXNwYWNlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihhdHRyaWJ1dGUsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX25hbWVzcGFjZV9wcm9wZXJ0eShucywgbWF0Y2gpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudF9vcHRpb25zLm5hbWVzcGFjZSA9IG5zO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWNjZXNzb3JzJzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW1tdXRhYmxlJzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncHJlc2VydmVXaGl0ZXNwYWNlJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBnZXRfdmFsdWUoYXR0cmlidXRlLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9hdHRyaWJ1dGVfdmFsdWUobmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5lcnJvcihhdHRyaWJ1dGUsIGNvbXBpbGVyX2Vycm9ycy5pbnZhbGlkX2F0dHJpYnV0ZV92YWx1ZShuYW1lKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRfb3B0aW9uc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZXJyb3IoYXR0cmlidXRlLCBjb21waWxlcl9lcnJvcnMuaW52YWxpZF9vcHRpb25zX2F0dHJpYnV0ZV91bmtub3duKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50LmVycm9yKGF0dHJpYnV0ZSwgY29tcGlsZXJfZXJyb3JzLmludmFsaWRfb3B0aW9uc19hdHRyaWJ1dGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbXBvbmVudF9vcHRpb25zO1xufVxuZnVuY3Rpb24gZ2V0X3JlbGF0aXZlX3BhdGgoZnJvbSwgdG8pIHtcbiAgICBjb25zdCBmcm9tX3BhcnRzID0gZnJvbS5zcGxpdCgvWy9cXFxcXS8pO1xuICAgIGNvbnN0IHRvX3BhcnRzID0gdG8uc3BsaXQoL1svXFxcXF0vKTtcbiAgICBmcm9tX3BhcnRzLnBvcCgpOyAvLyBnZXQgZGlybmFtZVxuICAgIHdoaWxlIChmcm9tX3BhcnRzWzBdID09PSB0b19wYXJ0c1swXSkge1xuICAgICAgICBmcm9tX3BhcnRzLnNoaWZ0KCk7XG4gICAgICAgIHRvX3BhcnRzLnNoaWZ0KCk7XG4gICAgfVxuICAgIGlmIChmcm9tX3BhcnRzLmxlbmd0aCkge1xuICAgICAgICBsZXQgaSA9IGZyb21fcGFydHMubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoaS0tKVxuICAgICAgICAgICAgZnJvbV9wYXJ0c1tpXSA9ICcuLic7XG4gICAgfVxuICAgIHJldHVybiBmcm9tX3BhcnRzLmNvbmNhdCh0b19wYXJ0cykuam9pbignLycpO1xufVxuZnVuY3Rpb24gZ2V0X2Jhc2VuYW1lKGZpbGVuYW1lKSB7XG4gICAgcmV0dXJuIGZpbGVuYW1lLnNwbGl0KC9bL1xcXFxdLykucG9wKCk7XG59XG5mdW5jdGlvbiBnZXRfc291cmNlbWFwX3NvdXJjZV9maWxlbmFtZShjb21waWxlX29wdGlvbnMpIHtcbiAgICBpZiAoIWNvbXBpbGVfb3B0aW9ucy5maWxlbmFtZSlcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIGNvbXBpbGVfb3B0aW9ucy5vdXRwdXRGaWxlbmFtZVxuICAgICAgICA/IGdldF9yZWxhdGl2ZV9wYXRoKGNvbXBpbGVfb3B0aW9ucy5vdXRwdXRGaWxlbmFtZSwgY29tcGlsZV9vcHRpb25zLmZpbGVuYW1lKVxuICAgICAgICA6IGdldF9iYXNlbmFtZShjb21waWxlX29wdGlvbnMuZmlsZW5hbWUpO1xufVxuXG5mdW5jdGlvbiBnZXRfbmFtZV9mcm9tX2ZpbGVuYW1lKGZpbGVuYW1lKSB7XG4gICAgaWYgKCFmaWxlbmFtZSlcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgcGFydHMgPSBmaWxlbmFtZS5zcGxpdCgvWy9cXFxcXS8pLm1hcChlbmNvZGVVUkkpO1xuICAgIGlmIChwYXJ0cy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGNvbnN0IGluZGV4X21hdGNoID0gcGFydHNbcGFydHMubGVuZ3RoIC0gMV0ubWF0Y2goL15pbmRleChcXC5cXHcrKS8pO1xuICAgICAgICBpZiAoaW5kZXhfbWF0Y2gpIHtcbiAgICAgICAgICAgIHBhcnRzLnBvcCgpO1xuICAgICAgICAgICAgcGFydHNbcGFydHMubGVuZ3RoIC0gMV0gKz0gaW5kZXhfbWF0Y2hbMV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgYmFzZSA9IHBhcnRzLnBvcCgpXG4gICAgICAgIC5yZXBsYWNlKC8lL2csICd1JylcbiAgICAgICAgLnJlcGxhY2UoL1xcLlteLl0rJC8sICcnKVxuICAgICAgICAucmVwbGFjZSgvW15hLXpBLVpfJDAtOV0rL2csICdfJylcbiAgICAgICAgLnJlcGxhY2UoL15fLywgJycpXG4gICAgICAgIC5yZXBsYWNlKC9fJC8sICcnKVxuICAgICAgICAucmVwbGFjZSgvXihcXGQpLywgJ18kMScpO1xuICAgIGlmICghYmFzZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBkZXJpdmUgY29tcG9uZW50IG5hbWUgZnJvbSBmaWxlICR7ZmlsZW5hbWV9YCk7XG4gICAgfVxuICAgIHJldHVybiBiYXNlWzBdLnRvVXBwZXJDYXNlKCkgKyBiYXNlLnNsaWNlKDEpO1xufVxuXG5jb25zdCB2YWxpZF9vcHRpb25zID0gW1xuICAgICdmb3JtYXQnLFxuICAgICduYW1lJyxcbiAgICAnZmlsZW5hbWUnLFxuICAgICdzb3VyY2VtYXAnLFxuICAgICdlbmFibGVTb3VyY2VtYXAnLFxuICAgICdnZW5lcmF0ZScsXG4gICAgJ2Vycm9yTW9kZScsXG4gICAgJ3ZhcnNSZXBvcnQnLFxuICAgICdvdXRwdXRGaWxlbmFtZScsXG4gICAgJ2Nzc091dHB1dEZpbGVuYW1lJyxcbiAgICAnc3ZlbHRlUGF0aCcsXG4gICAgJ2RldicsXG4gICAgJ2FjY2Vzc29ycycsXG4gICAgJ2ltbXV0YWJsZScsXG4gICAgJ2h5ZHJhdGFibGUnLFxuICAgICdsZWdhY3knLFxuICAgICdjdXN0b21FbGVtZW50JyxcbiAgICAnbmFtZXNwYWNlJyxcbiAgICAndGFnJyxcbiAgICAnY3NzJyxcbiAgICAnbG9vcEd1YXJkVGltZW91dCcsXG4gICAgJ3ByZXNlcnZlQ29tbWVudHMnLFxuICAgICdwcmVzZXJ2ZVdoaXRlc3BhY2UnLFxuICAgICdjc3NIYXNoJ1xuXTtcbmZ1bmN0aW9uIHZhbGlkYXRlX29wdGlvbnMob3B0aW9ucywgd2FybmluZ3MpIHtcbiAgICBjb25zdCB7IG5hbWUsIGZpbGVuYW1lLCBsb29wR3VhcmRUaW1lb3V0LCBkZXYsIG5hbWVzcGFjZSB9ID0gb3B0aW9ucztcbiAgICBPYmplY3Qua2V5cyhvcHRpb25zKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIGlmICghdmFsaWRfb3B0aW9ucy5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IGZ1enp5bWF0Y2goa2V5LCB2YWxpZF9vcHRpb25zKTtcbiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gYFVucmVjb2duaXplZCBvcHRpb24gJyR7a2V5fSdgO1xuICAgICAgICAgICAgaWYgKG1hdGNoKVxuICAgICAgICAgICAgICAgIG1lc3NhZ2UgKz0gYCAoZGlkIHlvdSBtZWFuICcke21hdGNofSc/KWA7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAobmFtZSAmJiAhL15bYS16QS1aXyRdW2EtekEtWl8kMC05XSokLy50ZXN0KG5hbWUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgb3B0aW9ucy5uYW1lIG11c3QgYmUgYSB2YWxpZCBpZGVudGlmaWVyIChnb3QgJyR7bmFtZX0nKWApO1xuICAgIH1cbiAgICBpZiAobmFtZSAmJiAvXlthLXpdLy50ZXN0KG5hbWUpKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSAnb3B0aW9ucy5uYW1lIHNob3VsZCBiZSBjYXBpdGFsaXNlZCc7XG4gICAgICAgIHdhcm5pbmdzLnB1c2goe1xuICAgICAgICAgICAgY29kZTogJ29wdGlvbnMtbG93ZXJjYXNlLW5hbWUnLFxuICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgIGZpbGVuYW1lLFxuICAgICAgICAgICAgdG9TdHJpbmc6ICgpID0+IG1lc3NhZ2VcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChsb29wR3VhcmRUaW1lb3V0ICYmICFkZXYpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9ICdvcHRpb25zLmxvb3BHdWFyZFRpbWVvdXQgaXMgZm9yIG9wdGlvbnMuZGV2ID0gdHJ1ZSBvbmx5JztcbiAgICAgICAgd2FybmluZ3MucHVzaCh7XG4gICAgICAgICAgICBjb2RlOiAnb3B0aW9ucy1sb29wLWd1YXJkLXRpbWVvdXQnLFxuICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgIGZpbGVuYW1lLFxuICAgICAgICAgICAgdG9TdHJpbmc6ICgpID0+IG1lc3NhZ2VcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChuYW1lc3BhY2UgJiYgdmFsaWRfbmFtZXNwYWNlcy5pbmRleE9mKG5hbWVzcGFjZSkgPT09IC0xKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gZnV6enltYXRjaChuYW1lc3BhY2UsIHZhbGlkX25hbWVzcGFjZXMpO1xuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBuYW1lc3BhY2UgJyR7bmFtZXNwYWNlfScgKGRpZCB5b3UgbWVhbiAnJHttYXRjaH0nPylgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBuYW1lc3BhY2UgJyR7bmFtZXNwYWNlfSdgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGNvbXBpbGUoc291cmNlLCBvcHRpb25zID0ge30pIHtcbiAgICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGdlbmVyYXRlOiAnZG9tJywgZGV2OiBmYWxzZSwgZW5hYmxlU291cmNlbWFwOiB0cnVlIH0sIG9wdGlvbnMpO1xuICAgIGNvbnN0IHN0YXRzID0gbmV3IFN0YXRzKCk7XG4gICAgY29uc3Qgd2FybmluZ3MgPSBbXTtcbiAgICB2YWxpZGF0ZV9vcHRpb25zKG9wdGlvbnMsIHdhcm5pbmdzKTtcbiAgICBzdGF0cy5zdGFydCgncGFyc2UnKTtcbiAgICBjb25zdCBhc3QgPSBwYXJzZSQzKHNvdXJjZSwgb3B0aW9ucyk7XG4gICAgc3RhdHMuc3RvcCgncGFyc2UnKTtcbiAgICBzdGF0cy5zdGFydCgnY3JlYXRlIGNvbXBvbmVudCcpO1xuICAgIGNvbnN0IGNvbXBvbmVudCA9IG5ldyBDb21wb25lbnQoYXN0LCBzb3VyY2UsIG9wdGlvbnMubmFtZSB8fCBnZXRfbmFtZV9mcm9tX2ZpbGVuYW1lKG9wdGlvbnMuZmlsZW5hbWUpIHx8ICdDb21wb25lbnQnLCBvcHRpb25zLCBzdGF0cywgd2FybmluZ3MpO1xuICAgIHN0YXRzLnN0b3AoJ2NyZWF0ZSBjb21wb25lbnQnKTtcbiAgICBjb25zdCByZXN1bHQgPSBvcHRpb25zLmdlbmVyYXRlID09PSBmYWxzZVxuICAgICAgICA/IG51bGxcbiAgICAgICAgOiBvcHRpb25zLmdlbmVyYXRlID09PSAnc3NyJ1xuICAgICAgICAgICAgPyBzc3IoY29tcG9uZW50LCBvcHRpb25zKVxuICAgICAgICAgICAgOiBkb20oY29tcG9uZW50LCBvcHRpb25zKTtcbiAgICByZXR1cm4gY29tcG9uZW50LmdlbmVyYXRlKHJlc3VsdCk7XG59XG5cbi8qKlxuICogSW1wb3J0IGRlY29kZWQgc291cmNlbWFwIGZyb20gbW96aWxsYS9zb3VyY2UtbWFwL1NvdXJjZU1hcEdlbmVyYXRvclxuICogRm9ya2VkIGZyb20gc291cmNlLW1hcC9saWIvc291cmNlLW1hcC1nZW5lcmF0b3IuanNcbiAqIGZyb20gbWV0aG9kcyBfc2VyaWFsaXplTWFwcGluZ3MgYW5kIHRvSlNPTi5cbiAqIFdlIGNhbm5vdCB1c2Ugc291cmNlLW1hcC5kLnRzIHR5cGVzLCBiZWNhdXNlIHdlIGFjY2VzcyBoaWRkZW4gcHJvcGVydGllcy5cbiAqL1xuZnVuY3Rpb24gZGVjb2RlZF9zb3VyY2VtYXBfZnJvbV9nZW5lcmF0b3IoZ2VuZXJhdG9yKSB7XG4gICAgbGV0IHByZXZpb3VzX2dlbmVyYXRlZF9saW5lID0gMTtcbiAgICBjb25zdCBjb252ZXJ0ZWRfbWFwcGluZ3MgPSBbW11dO1xuICAgIGxldCByZXN1bHRfbGluZTtcbiAgICBsZXQgcmVzdWx0X3NlZ21lbnQ7XG4gICAgbGV0IG1hcHBpbmc7XG4gICAgY29uc3Qgc291cmNlX2lkeCA9IGdlbmVyYXRvci5fc291cmNlcy50b0FycmF5KClcbiAgICAgICAgLnJlZHVjZSgoYWNjLCB2YWwsIGlkeCkgPT4gKGFjY1t2YWxdID0gaWR4LCBhY2MpLCB7fSk7XG4gICAgY29uc3QgbmFtZV9pZHggPSBnZW5lcmF0b3IuX25hbWVzLnRvQXJyYXkoKVxuICAgICAgICAucmVkdWNlKChhY2MsIHZhbCwgaWR4KSA9PiAoYWNjW3ZhbF0gPSBpZHgsIGFjYyksIHt9KTtcbiAgICBjb25zdCBtYXBwaW5ncyA9IGdlbmVyYXRvci5fbWFwcGluZ3MudG9BcnJheSgpO1xuICAgIHJlc3VsdF9saW5lID0gY29udmVydGVkX21hcHBpbmdzWzBdO1xuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBtYXBwaW5ncy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBtYXBwaW5nID0gbWFwcGluZ3NbaV07XG4gICAgICAgIGlmIChtYXBwaW5nLmdlbmVyYXRlZExpbmUgPiBwcmV2aW91c19nZW5lcmF0ZWRfbGluZSkge1xuICAgICAgICAgICAgd2hpbGUgKG1hcHBpbmcuZ2VuZXJhdGVkTGluZSA+IHByZXZpb3VzX2dlbmVyYXRlZF9saW5lKSB7XG4gICAgICAgICAgICAgICAgY29udmVydGVkX21hcHBpbmdzLnB1c2goW10pO1xuICAgICAgICAgICAgICAgIHByZXZpb3VzX2dlbmVyYXRlZF9saW5lKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHRfbGluZSA9IGNvbnZlcnRlZF9tYXBwaW5nc1ttYXBwaW5nLmdlbmVyYXRlZExpbmUgLSAxXTsgLy8gbGluZSBpcyBvbmUtYmFzZWRcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpID4gMCkge1xuICAgICAgICAgICAgY29uc3QgcHJldmlvdXNfbWFwcGluZyA9IG1hcHBpbmdzW2kgLSAxXTtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIC8vIHNvcnRlZCBieSBzZWxlY3Rpdml0eVxuICAgICAgICAgICAgbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4gPT09IHByZXZpb3VzX21hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uICYmXG4gICAgICAgICAgICAgICAgbWFwcGluZy5vcmlnaW5hbENvbHVtbiA9PT0gcHJldmlvdXNfbWFwcGluZy5vcmlnaW5hbENvbHVtbiAmJlxuICAgICAgICAgICAgICAgIG1hcHBpbmcubmFtZSA9PT0gcHJldmlvdXNfbWFwcGluZy5uYW1lICYmXG4gICAgICAgICAgICAgICAgbWFwcGluZy5nZW5lcmF0ZWRMaW5lID09PSBwcmV2aW91c19tYXBwaW5nLmdlbmVyYXRlZExpbmUgJiZcbiAgICAgICAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsTGluZSA9PT0gcHJldmlvdXNfbWFwcGluZy5vcmlnaW5hbExpbmUgJiZcbiAgICAgICAgICAgICAgICBtYXBwaW5nLnNvdXJjZSA9PT0gcHJldmlvdXNfbWFwcGluZy5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXN1bHRfbGluZS5wdXNoKFttYXBwaW5nLmdlbmVyYXRlZENvbHVtbl0pO1xuICAgICAgICByZXN1bHRfc2VnbWVudCA9IHJlc3VsdF9saW5lW3Jlc3VsdF9saW5lLmxlbmd0aCAtIDFdO1xuICAgICAgICBpZiAobWFwcGluZy5zb3VyY2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzdWx0X3NlZ21lbnQucHVzaCguLi5bXG4gICAgICAgICAgICAgICAgc291cmNlX2lkeFttYXBwaW5nLnNvdXJjZV0sXG4gICAgICAgICAgICAgICAgbWFwcGluZy5vcmlnaW5hbExpbmUgLSAxLFxuICAgICAgICAgICAgICAgIG1hcHBpbmcub3JpZ2luYWxDb2x1bW5cbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgaWYgKG1hcHBpbmcubmFtZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0X3NlZ21lbnQucHVzaChuYW1lX2lkeFttYXBwaW5nLm5hbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBtYXAgPSB7XG4gICAgICAgIHZlcnNpb246IGdlbmVyYXRvci5fdmVyc2lvbixcbiAgICAgICAgc291cmNlczogZ2VuZXJhdG9yLl9zb3VyY2VzLnRvQXJyYXkoKSxcbiAgICAgICAgbmFtZXM6IGdlbmVyYXRvci5fbmFtZXMudG9BcnJheSgpLFxuICAgICAgICBtYXBwaW5nczogY29udmVydGVkX21hcHBpbmdzXG4gICAgfTtcbiAgICBpZiAoZ2VuZXJhdG9yLl9maWxlICE9IG51bGwpIHtcbiAgICAgICAgbWFwLmZpbGUgPSBnZW5lcmF0b3IuX2ZpbGU7XG4gICAgfVxuICAgIC8vIG5vdCBuZWVkZWQ6IG1hcC5zb3VyY2VzQ29udGVudCBhbmQgbWFwLnNvdXJjZVJvb3RcbiAgICByZXR1cm4gbWFwO1xufVxuZnVuY3Rpb24gZGVjb2RlX21hcChwcm9jZXNzZWQpIHtcbiAgICBsZXQgZGVjb2RlZF9tYXAgPSB0eXBlb2YgcHJvY2Vzc2VkLm1hcCA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKHByb2Nlc3NlZC5tYXApIDogcHJvY2Vzc2VkLm1hcDtcbiAgICBpZiAodHlwZW9mIChkZWNvZGVkX21hcC5tYXBwaW5ncykgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGRlY29kZWRfbWFwLm1hcHBpbmdzID0gZGVjb2RlKGRlY29kZWRfbWFwLm1hcHBpbmdzKTtcbiAgICB9XG4gICAgaWYgKGRlY29kZWRfbWFwLl9tYXBwaW5ncyAmJiBkZWNvZGVkX21hcC5jb25zdHJ1Y3Rvci5uYW1lID09PSAnU291cmNlTWFwR2VuZXJhdG9yJykge1xuICAgICAgICAvLyBpbXBvcnQgZGVjb2RlZCBzb3VyY2VtYXAgZnJvbSBtb3ppbGxhL3NvdXJjZS1tYXAvU291cmNlTWFwR2VuZXJhdG9yXG4gICAgICAgIGRlY29kZWRfbWFwID0gZGVjb2RlZF9zb3VyY2VtYXBfZnJvbV9nZW5lcmF0b3IoZGVjb2RlZF9tYXApO1xuICAgIH1cbiAgICByZXR1cm4gZGVjb2RlZF9tYXA7XG59XG5cbmZ1bmN0aW9uIHNsaWNlX3NvdXJjZShjb2RlX3NsaWNlLCBvZmZzZXQsIHsgZmlsZV9iYXNlbmFtZSwgZmlsZW5hbWUsIGdldF9sb2NhdGlvbiB9KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc291cmNlOiBjb2RlX3NsaWNlLFxuICAgICAgICBnZXRfbG9jYXRpb246IChpbmRleCkgPT4gZ2V0X2xvY2F0aW9uKGluZGV4ICsgb2Zmc2V0KSxcbiAgICAgICAgZmlsZV9iYXNlbmFtZSxcbiAgICAgICAgZmlsZW5hbWVcbiAgICB9O1xufVxuZnVuY3Rpb24gY2FsY3VsYXRlX3JlcGxhY2VtZW50cyhyZSwgZ2V0X3JlcGxhY2VtZW50LCBzb3VyY2UpIHtcbiAgICBjb25zdCByZXBsYWNlbWVudHMgPSBbXTtcbiAgICBzb3VyY2UucmVwbGFjZShyZSwgKC4uLm1hdGNoKSA9PiB7XG4gICAgICAgIHJlcGxhY2VtZW50cy5wdXNoKGdldF9yZXBsYWNlbWVudCguLi5tYXRjaCkudGhlbihyZXBsYWNlbWVudCA9PiB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaGVkX3N0cmluZyA9IG1hdGNoWzBdO1xuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gbWF0Y2hbbWF0Y2gubGVuZ3RoIC0gMl07XG4gICAgICAgICAgICByZXR1cm4gKHsgb2Zmc2V0LCBsZW5ndGg6IG1hdGNoZWRfc3RyaW5nLmxlbmd0aCwgcmVwbGFjZW1lbnQgfSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH0pO1xuICAgIHJldHVybiBQcm9taXNlLmFsbChyZXBsYWNlbWVudHMpO1xufVxuZnVuY3Rpb24gcGVyZm9ybV9yZXBsYWNlbWVudHMocmVwbGFjZW1lbnRzLCBzb3VyY2UpIHtcbiAgICBjb25zdCBvdXQgPSBuZXcgTWFwcGVkQ29kZSgpO1xuICAgIGxldCBsYXN0X2VuZCA9IDA7XG4gICAgZm9yIChjb25zdCB7IG9mZnNldCwgbGVuZ3RoLCByZXBsYWNlbWVudCB9IG9mIHJlcGxhY2VtZW50cykge1xuICAgICAgICBjb25zdCB1bmNoYW5nZWRfcHJlZml4ID0gTWFwcGVkQ29kZS5mcm9tX3NvdXJjZShzbGljZV9zb3VyY2Uoc291cmNlLnNvdXJjZS5zbGljZShsYXN0X2VuZCwgb2Zmc2V0KSwgbGFzdF9lbmQsIHNvdXJjZSkpO1xuICAgICAgICBvdXQuY29uY2F0KHVuY2hhbmdlZF9wcmVmaXgpLmNvbmNhdChyZXBsYWNlbWVudCk7XG4gICAgICAgIGxhc3RfZW5kID0gb2Zmc2V0ICsgbGVuZ3RoO1xuICAgIH1cbiAgICBjb25zdCB1bmNoYW5nZWRfc3VmZml4ID0gTWFwcGVkQ29kZS5mcm9tX3NvdXJjZShzbGljZV9zb3VyY2Uoc291cmNlLnNvdXJjZS5zbGljZShsYXN0X2VuZCksIGxhc3RfZW5kLCBzb3VyY2UpKTtcbiAgICByZXR1cm4gb3V0LmNvbmNhdCh1bmNoYW5nZWRfc3VmZml4KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHJlcGxhY2VfaW5fY29kZShyZWdleCwgZ2V0X3JlcGxhY2VtZW50LCBsb2NhdGlvbikge1xuICAgIGNvbnN0IHJlcGxhY2VtZW50cyA9IGF3YWl0IGNhbGN1bGF0ZV9yZXBsYWNlbWVudHMocmVnZXgsIGdldF9yZXBsYWNlbWVudCwgbG9jYXRpb24uc291cmNlKTtcbiAgICByZXR1cm4gcGVyZm9ybV9yZXBsYWNlbWVudHMocmVwbGFjZW1lbnRzLCBsb2NhdGlvbik7XG59XG5cbmZ1bmN0aW9uIGdldF9maWxlX2Jhc2VuYW1lKGZpbGVuYW1lKSB7XG4gICAgcmV0dXJuIGZpbGVuYW1lLnNwbGl0KC9bL1xcXFxdLykucG9wKCk7XG59XG4vKipcbiAqIFJlcHJlc2VudHMgaW50ZXJtZWRpYXRlIHN0YXRlcyBvZiB0aGUgcHJlcHJvY2Vzc2luZy5cbiAqL1xuY2xhc3MgUHJlcHJvY2Vzc1Jlc3VsdCB7XG4gICAgY29uc3RydWN0b3Ioc291cmNlLCBmaWxlbmFtZSkge1xuICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgICAgdGhpcy5maWxlbmFtZSA9IGZpbGVuYW1lO1xuICAgICAgICAvLyBzb3VyY2VtYXBfbGlzdCBpcyBzb3J0ZWQgaW4gcmV2ZXJzZSBvcmRlciBmcm9tIGxhc3QgbWFwIChpbmRleCAwKSB0byBmaXJzdCBtYXAgKGluZGV4IC0xKVxuICAgICAgICAvLyBzbyB3ZSB1c2Ugc291cmNlbWFwX2xpc3QudW5zaGlmdCgpIHRvIGFkZCBuZXcgbWFwc1xuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYW1wcHJvamVjdC9yZW1hcHBpbmcjbXVsdGlwbGUtdHJhbnNmb3JtYXRpb25zLW9mLWEtZmlsZVxuICAgICAgICB0aGlzLnNvdXJjZW1hcF9saXN0ID0gW107XG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gW107XG4gICAgICAgIHRoaXMudXBkYXRlX3NvdXJjZSh7IHN0cmluZzogc291cmNlIH0pO1xuICAgICAgICAvLyBwcmVwcm9jZXNzIHNvdXJjZSBtdXN0IGJlIHJlbGF0aXZlIHRvIGl0c2VsZiBvciBlcXVhbCBudWxsXG4gICAgICAgIHRoaXMuZmlsZV9iYXNlbmFtZSA9IGZpbGVuYW1lID09IG51bGwgPyBudWxsIDogZ2V0X2ZpbGVfYmFzZW5hbWUoZmlsZW5hbWUpO1xuICAgIH1cbiAgICB1cGRhdGVfc291cmNlKHsgc3RyaW5nOiBzb3VyY2UsIG1hcCwgZGVwZW5kZW5jaWVzIH0pIHtcbiAgICAgICAgaWYgKHNvdXJjZSAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgICAgICAgIHRoaXMuZ2V0X2xvY2F0aW9uID0gZ2V0TG9jYXRvcihzb3VyY2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtYXApIHtcbiAgICAgICAgICAgIHRoaXMuc291cmNlbWFwX2xpc3QudW5zaGlmdChtYXApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzLnB1c2goLi4uZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0b19wcm9jZXNzZWQoKSB7XG4gICAgICAgIC8vIENvbWJpbmUgYWxsIHRoZSBzb3VyY2UgbWFwcyBmb3IgZWFjaCBwcmVwcm9jZXNzb3IgZnVuY3Rpb24gaW50byBvbmVcbiAgICAgICAgY29uc3QgbWFwID0gY29tYmluZV9zb3VyY2VtYXBzKHRoaXMuZmlsZV9iYXNlbmFtZSwgdGhpcy5zb3VyY2VtYXBfbGlzdCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAvLyBUT0RPIHJldHVybiBzZXBhcmF0ZWQgb3V0cHV0LCBpbiBmdXR1cmUgdmVyc2lvbiB3aGVyZSBzdmVsdGUuY29tcGlsZSBzdXBwb3J0cyBpdDpcbiAgICAgICAgICAgIC8vIHN0eWxlOiB7IGNvZGU6IHN0eWxlQ29kZSwgbWFwOiBzdHlsZU1hcCB9LFxuICAgICAgICAgICAgLy8gc2NyaXB0IHsgY29kZTogc2NyaXB0Q29kZSwgbWFwOiBzY3JpcHRNYXAgfSxcbiAgICAgICAgICAgIC8vIG1hcmt1cCB7IGNvZGU6IG1hcmt1cENvZGUsIG1hcDogbWFya3VwTWFwIH0sXG4gICAgICAgICAgICBjb2RlOiB0aGlzLnNvdXJjZSxcbiAgICAgICAgICAgIGRlcGVuZGVuY2llczogWy4uLm5ldyBTZXQodGhpcy5kZXBlbmRlbmNpZXMpXSxcbiAgICAgICAgICAgIG1hcDogbWFwLFxuICAgICAgICAgICAgdG9TdHJpbmc6ICgpID0+IHRoaXMuc291cmNlXG4gICAgICAgIH07XG4gICAgfVxufVxuLyoqXG4gKiBDb252ZXJ0IHByZXByb2Nlc3NvciBvdXRwdXQgZm9yIHRoZSB0YWcgY29udGVudCBpbnRvIE1hcHBlZENvZGVcbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc2VkX2NvbnRlbnRfdG9fY29kZShwcm9jZXNzZWQsIGxvY2F0aW9uLCBmaWxlX2Jhc2VuYW1lKSB7XG4gICAgLy8gQ29udmVydCB0aGUgcHJlcHJvY2Vzc2VkIGNvZGUgYW5kIGl0cyBzb3VyY2VtYXAgdG8gYSBNYXBwZWRDb2RlXG4gICAgbGV0IGRlY29kZWRfbWFwO1xuICAgIGlmIChwcm9jZXNzZWQubWFwKSB7XG4gICAgICAgIGRlY29kZWRfbWFwID0gZGVjb2RlX21hcChwcm9jZXNzZWQpO1xuICAgICAgICAvLyBkZWNvZGVkIG1hcCBtYXkgbm90IGhhdmUgc291cmNlcyBmb3IgZW1wdHkgbWFwcyBsaWtlIGB7IG1hcHBpbmdzOiAnJyB9YFxuICAgICAgICBpZiAoZGVjb2RlZF9tYXAuc291cmNlcykge1xuICAgICAgICAgICAgLy8gb2Zmc2V0IG9ubHkgc2VnbWVudHMgcG9pbnRpbmcgYXQgb3JpZ2luYWwgY29tcG9uZW50IHNvdXJjZVxuICAgICAgICAgICAgY29uc3Qgc291cmNlX2luZGV4ID0gZGVjb2RlZF9tYXAuc291cmNlcy5pbmRleE9mKGZpbGVfYmFzZW5hbWUpO1xuICAgICAgICAgICAgaWYgKHNvdXJjZV9pbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBzb3VyY2VtYXBfYWRkX29mZnNldChkZWNvZGVkX21hcCwgbG9jYXRpb24sIHNvdXJjZV9pbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIE1hcHBlZENvZGUuZnJvbV9wcm9jZXNzZWQocHJvY2Vzc2VkLmNvZGUsIGRlY29kZWRfbWFwKTtcbn1cbi8qKlxuICogR2l2ZW4gdGhlIHdob2xlIHRhZyBpbmNsdWRpbmcgY29udGVudCwgcmV0dXJuIGEgYE1hcHBlZENvZGVgXG4gKiByZXByZXNlbnRpbmcgdGhlIHRhZyBjb250ZW50IHJlcGxhY2VkIHdpdGggYHByb2Nlc3NlZGAuXG4gKi9cbmZ1bmN0aW9uIHByb2Nlc3NlZF90YWdfdG9fY29kZShwcm9jZXNzZWQsIHRhZ19uYW1lLCBhdHRyaWJ1dGVzLCBzb3VyY2UpIHtcbiAgICBjb25zdCB7IGZpbGVfYmFzZW5hbWUsIGdldF9sb2NhdGlvbiB9ID0gc291cmNlO1xuICAgIGNvbnN0IGJ1aWxkX21hcHBlZF9jb2RlID0gKGNvZGUsIG9mZnNldCkgPT4gTWFwcGVkQ29kZS5mcm9tX3NvdXJjZShzbGljZV9zb3VyY2UoY29kZSwgb2Zmc2V0LCBzb3VyY2UpKTtcbiAgICBjb25zdCB0YWdfb3BlbiA9IGA8JHt0YWdfbmFtZX0ke2F0dHJpYnV0ZXMgfHwgJyd9PmA7XG4gICAgY29uc3QgdGFnX2Nsb3NlID0gYDwvJHt0YWdfbmFtZX0+YDtcbiAgICBjb25zdCB0YWdfb3Blbl9jb2RlID0gYnVpbGRfbWFwcGVkX2NvZGUodGFnX29wZW4sIDApO1xuICAgIGNvbnN0IHRhZ19jbG9zZV9jb2RlID0gYnVpbGRfbWFwcGVkX2NvZGUodGFnX2Nsb3NlLCB0YWdfb3Blbi5sZW5ndGggKyBzb3VyY2Uuc291cmNlLmxlbmd0aCk7XG4gICAgcGFyc2VfYXR0YWNoZWRfc291cmNlbWFwKHByb2Nlc3NlZCwgdGFnX25hbWUpO1xuICAgIGNvbnN0IGNvbnRlbnRfY29kZSA9IHByb2Nlc3NlZF9jb250ZW50X3RvX2NvZGUocHJvY2Vzc2VkLCBnZXRfbG9jYXRpb24odGFnX29wZW4ubGVuZ3RoKSwgZmlsZV9iYXNlbmFtZSk7XG4gICAgcmV0dXJuIHRhZ19vcGVuX2NvZGUuY29uY2F0KGNvbnRlbnRfY29kZSkuY29uY2F0KHRhZ19jbG9zZV9jb2RlKTtcbn1cbmZ1bmN0aW9uIHBhcnNlX3RhZ19hdHRyaWJ1dGVzKHN0cikge1xuICAgIC8vIG5vdGU6IHdvbid0IHdvcmsgd2l0aCBhdHRyaWJ1dGUgdmFsdWVzIGNvbnRhaW5pbmcgc3BhY2VzLlxuICAgIHJldHVybiBzdHJcbiAgICAgICAgLnNwbGl0KC9cXHMrLylcbiAgICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgICAucmVkdWNlKChhdHRycywgYXR0cikgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGkgPSBhdHRyLmluZGV4T2YoJz0nKTtcbiAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdID0gaSA+IDAgPyBbYXR0ci5zbGljZSgwLCBpKSwgYXR0ci5zbGljZShpICsgMSldIDogW2F0dHJdO1xuICAgICAgICBjb25zdCBbLCB1bnF1b3RlZF0gPSAodmFsdWUgJiYgdmFsdWUubWF0Y2goL15bJ1wiXSguKilbJ1wiXSQvKSkgfHwgW107XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGF0dHJzKSwgeyBba2V5XTogKF9hID0gKHVucXVvdGVkICE9PSBudWxsICYmIHVucXVvdGVkICE9PSB2b2lkIDAgPyB1bnF1b3RlZCA6IHZhbHVlKSwgKF9hICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHRydWUpKSB9KTtcbiAgICB9LCB7fSk7XG59XG4vKipcbiAqIENhbGN1bGF0ZSB0aGUgdXBkYXRlcyByZXF1aXJlZCB0byBwcm9jZXNzIGFsbCBpbnN0YW5jZXMgb2YgdGhlIHNwZWNpZmllZCB0YWcuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NfdGFnKHRhZ19uYW1lLCBwcmVwcm9jZXNzb3IsIHNvdXJjZSkge1xuICAgIGNvbnN0IHsgZmlsZW5hbWUsIHNvdXJjZTogbWFya3VwIH0gPSBzb3VyY2U7XG4gICAgY29uc3QgdGFnX3JlZ2V4ID0gdGFnX25hbWUgPT09ICdzdHlsZSdcbiAgICAgICAgPyAvPCEtLVteXSo/LS0+fDxzdHlsZShcXHNbXl0qPyk/KD86PihbXl0qPyk8XFwvc3R5bGU+fFxcLz4pL2dpXG4gICAgICAgIDogLzwhLS1bXl0qPy0tPnw8c2NyaXB0KFxcc1teXSo/KT8oPzo+KFteXSo/KTxcXC9zY3JpcHQ+fFxcLz4pL2dpO1xuICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IFtdO1xuICAgIGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3Nfc2luZ2xlX3RhZyh0YWdfd2l0aF9jb250ZW50LCBhdHRyaWJ1dGVzID0gJycsIGNvbnRlbnQgPSAnJywgdGFnX29mZnNldCkge1xuICAgICAgICBjb25zdCBub19jaGFuZ2UgPSAoKSA9PiBNYXBwZWRDb2RlLmZyb21fc291cmNlKHNsaWNlX3NvdXJjZSh0YWdfd2l0aF9jb250ZW50LCB0YWdfb2Zmc2V0LCBzb3VyY2UpKTtcbiAgICAgICAgaWYgKCFhdHRyaWJ1dGVzICYmICFjb250ZW50KVxuICAgICAgICAgICAgcmV0dXJuIG5vX2NoYW5nZSgpO1xuICAgICAgICBjb25zdCBwcm9jZXNzZWQgPSBhd2FpdCBwcmVwcm9jZXNzb3Ioe1xuICAgICAgICAgICAgY29udGVudDogY29udGVudCB8fCAnJyxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHBhcnNlX3RhZ19hdHRyaWJ1dGVzKGF0dHJpYnV0ZXMgfHwgJycpLFxuICAgICAgICAgICAgbWFya3VwLFxuICAgICAgICAgICAgZmlsZW5hbWVcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghcHJvY2Vzc2VkKVxuICAgICAgICAgICAgcmV0dXJuIG5vX2NoYW5nZSgpO1xuICAgICAgICBpZiAocHJvY2Vzc2VkLmRlcGVuZGVuY2llcylcbiAgICAgICAgICAgIGRlcGVuZGVuY2llcy5wdXNoKC4uLnByb2Nlc3NlZC5kZXBlbmRlbmNpZXMpO1xuICAgICAgICBpZiAoIXByb2Nlc3NlZC5tYXAgJiYgcHJvY2Vzc2VkLmNvZGUgPT09IGNvbnRlbnQpXG4gICAgICAgICAgICByZXR1cm4gbm9fY2hhbmdlKCk7XG4gICAgICAgIHJldHVybiBwcm9jZXNzZWRfdGFnX3RvX2NvZGUocHJvY2Vzc2VkLCB0YWdfbmFtZSwgYXR0cmlidXRlcywgc2xpY2Vfc291cmNlKGNvbnRlbnQsIHRhZ19vZmZzZXQsIHNvdXJjZSkpO1xuICAgIH1cbiAgICBjb25zdCB7IHN0cmluZywgbWFwIH0gPSBhd2FpdCByZXBsYWNlX2luX2NvZGUodGFnX3JlZ2V4LCBwcm9jZXNzX3NpbmdsZV90YWcsIHNvdXJjZSk7XG4gICAgcmV0dXJuIHsgc3RyaW5nLCBtYXAsIGRlcGVuZGVuY2llcyB9O1xufVxuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc19tYXJrdXAocHJvY2Vzcywgc291cmNlKSB7XG4gICAgY29uc3QgcHJvY2Vzc2VkID0gYXdhaXQgcHJvY2Vzcyh7XG4gICAgICAgIGNvbnRlbnQ6IHNvdXJjZS5zb3VyY2UsXG4gICAgICAgIGZpbGVuYW1lOiBzb3VyY2UuZmlsZW5hbWVcbiAgICB9KTtcbiAgICBpZiAocHJvY2Vzc2VkKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdHJpbmc6IHByb2Nlc3NlZC5jb2RlLFxuICAgICAgICAgICAgbWFwOiBwcm9jZXNzZWQubWFwXG4gICAgICAgICAgICAgICAgPyAvLyBUT0RPOiBjYW4gd2UgdXNlIGRlY29kZV9zb3VyY2VtYXA/XG4gICAgICAgICAgICAgICAgICAgIHR5cGVvZiBwcm9jZXNzZWQubWFwID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgICAgICAgICAgICAgPyBKU09OLnBhcnNlKHByb2Nlc3NlZC5tYXApXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHByb2Nlc3NlZC5tYXBcbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRlcGVuZGVuY2llczogcHJvY2Vzc2VkLmRlcGVuZGVuY2llc1xuICAgICAgICB9O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIHByZXByb2Nlc3Moc291cmNlLCBwcmVwcm9jZXNzb3IsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBmaWxlbmFtZSA9IChvcHRpb25zICYmIG9wdGlvbnMuZmlsZW5hbWUpIHx8IHByZXByb2Nlc3Nvci5maWxlbmFtZTsgLy8gbGVnYWN5XG4gICAgY29uc3QgcHJlcHJvY2Vzc29ycyA9IHByZXByb2Nlc3NvciA/IChBcnJheS5pc0FycmF5KHByZXByb2Nlc3NvcikgPyBwcmVwcm9jZXNzb3IgOiBbcHJlcHJvY2Vzc29yXSkgOiBbXTtcbiAgICBjb25zdCBtYXJrdXAgPSBwcmVwcm9jZXNzb3JzLm1hcChwID0+IHAubWFya3VwKS5maWx0ZXIoQm9vbGVhbik7XG4gICAgY29uc3Qgc2NyaXB0ID0gcHJlcHJvY2Vzc29ycy5tYXAocCA9PiBwLnNjcmlwdCkuZmlsdGVyKEJvb2xlYW4pO1xuICAgIGNvbnN0IHN0eWxlID0gcHJlcHJvY2Vzc29ycy5tYXAocCA9PiBwLnN0eWxlKS5maWx0ZXIoQm9vbGVhbik7XG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IFByZXByb2Nlc3NSZXN1bHQoc291cmNlLCBmaWxlbmFtZSk7XG4gICAgLy8gVE9ETyBrZWVwIHRyYWNrOiB3aGF0IHByZXByb2Nlc3NvciBnZW5lcmF0ZWQgd2hhdCBzb3VyY2VtYXA/XG4gICAgLy8gdG8gbWFrZSBkZWJ1Z2dpbmcgZWFzaWVyID0gZGV0ZWN0IGxvdy1yZXNvbHV0aW9uIHNvdXJjZW1hcHMgaW4gZm4gY29tYmluZV9tYXBwaW5nc1xuICAgIGZvciAoY29uc3QgcHJvY2VzcyBvZiBtYXJrdXApIHtcbiAgICAgICAgcmVzdWx0LnVwZGF0ZV9zb3VyY2UoYXdhaXQgcHJvY2Vzc19tYXJrdXAocHJvY2VzcywgcmVzdWx0KSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgcHJvY2VzcyBvZiBzY3JpcHQpIHtcbiAgICAgICAgcmVzdWx0LnVwZGF0ZV9zb3VyY2UoYXdhaXQgcHJvY2Vzc190YWcoJ3NjcmlwdCcsIHByb2Nlc3MsIHJlc3VsdCkpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHByZXByb2Nlc3Mgb2Ygc3R5bGUpIHtcbiAgICAgICAgcmVzdWx0LnVwZGF0ZV9zb3VyY2UoYXdhaXQgcHJvY2Vzc190YWcoJ3N0eWxlJywgcHJlcHJvY2VzcywgcmVzdWx0KSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQudG9fcHJvY2Vzc2VkKCk7XG59XG5cbmNvbnN0IFZFUlNJT04gPSAnMy40Ni4yJztcblxuZXhwb3J0IHsgVkVSU0lPTiwgY29tcGlsZSwgcGFyc2UkMyBhcyBwYXJzZSwgcHJlcHJvY2Vzcywgd2FsayB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tcGlsZXIubWpzLm1hcFxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQXNEQTtBQVVBO0FBWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFHQTtBQUNBO0FBQ0E7QUFZQTtBQVlBO0FBY0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFzQkE7QUFHQTtBQWdCQTtBQW9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQW9CQTtBQXNDQTtBQUVBO0FBaUJBO0FBYUE7QUFFQTtBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBY0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBS0E7QUFrREE7QUFnQkE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFnQkE7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQVVBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFDQTtBQUdBO0FBSUE7QUFDQTtBQUNBO0FBSUE7QUFJQTtBQUlBO0FBRUE7QUFFQTtBQUdBO0FBSUE7QUFJQTtBQUdBO0FBQ0E7QUFDQTtBQWtFQTtBQUlBO0FBZUE7QUFRQTtBQUVBO0FBV0E7QUFNQTtBQVFBO0FBTUE7QUFlQTtBQUVBO0FBZUE7QUFFQTtBQU1BO0FBaURBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUE0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBV0E7QUFDQTtBQUNBO0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBU0E7QUFDQTtBQUVBO0FBT0E7QUFDQTtBQUNBO0FBeUJBO0FBWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXlCQTtBQUNBO0FBaUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBc0RBO0FBV0E7QUFDQTtBQUVBO0FBY0E7QUFDQTtBQUVBO0FBd0JBO0FBZUE7QUF3RUE7QUFrQkE7QUFDQTtBQUVBO0FBa0JBO0FBQ0E7QUFFQTtBQWNBO0FBRUE7QUErQkE7QUE2QkE7QUFFQTtBQUNBO0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUE0QkE7QUFFQTtBQUlBO0FBQ0E7QUF3Q0E7QUE4QkE7QUFFQTtBQUNBO0FBU0E7QUFJQTtBQW1DQTtBQVNBO0FBR0E7QUFtQkE7QUErREE7QUEyQkE7QUFHQTtBQWdCQTtBQWlCQTtBQVNBO0FBUUE7QUFJQTtBQWlFQTtBQUdBO0FBa0JBO0FBR0E7QUFjQTtBQUlBO0FBcUNBO0FBV0E7QUFPQTtBQUVBO0FBc0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFXQTtBQTRDQTtBQWdCQTtBQVlBO0FBVUE7QUErQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFxRUE7QUFrQkE7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQW9CQTtBQTZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFhQTtBQUVBO0FBSUE7QUFGQTtBQWlDQTtBQWtCQTtBQWlCQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFRQTtBQUNBO0FBMEJBO0FBcURBO0FBbUdBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTRGQTtBQUNBO0FBaUJBO0FBQ0E7QUFHQTtBQWVBO0FBd0NBO0FBNERBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUE4QkE7QUFtREE7QUE0QkE7QUFTQTtBQUVBO0FBSUE7QUEyRkE7QUFRQTtBQTJCQTtBQXNCQTtBQWFBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFLQTtBQUNBO0FBRUE7QUFvQkE7QUFFQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUErQ0E7QUFDQTtBQUVBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUE0QkE7QUFXQTtBQTJCQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBcUJBO0FBRUE7QUFFQTtBQUVBO0FBS0E7QUFTQTtBQUNBO0FBQ0E7QUF5Q0E7QUFrQkE7QUFxQkE7QUFZQTtBQWdCQTtBQVlBO0FBbUNBO0FBQ0E7QUFDQTtBQWdDQTtBQThCQTtBQTJDQTtBQUNBO0FBRUE7QUFDQTtBQVlBO0FBR0E7QUFrRUE7QUFDQTtBQW1FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBT0E7QUFjQTtBQW9CQTtBQU9BO0FBU0E7QUFNQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBZ0JBO0FBS0E7QUFLQTtBQVFBO0FBb0JBO0FBV0E7QUFtQkE7QUFlQTtBQW9EQTtBQWFBO0FBUUE7QUFxQkE7QUFDQTtBQVVBO0FBbUJBO0FBQ0E7QUFDQTtBQWNBO0FBQ0E7QUFDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXNCQTtBQVdBO0FBYUE7QUF3QkE7QUErQkE7QUErQkE7QUFpQkE7QUE2Q0E7QUF1QkE7QUFjQTtBQXdDQTtBQUNBO0FBQ0E7QUFJQTtBQVdBO0FBbUJBO0FBQ0E7QUFjQTtBQUNBO0FBY0E7QUFDQTtBQUtBO0FBUUE7QUFNQTtBQUNBO0FBQ0E7QUFnQkE7QUFDQTtBQVNBO0FBb0JBO0FBMkJBO0FBV0E7QUFlQTtBQWVBO0FBNEJBO0FBQ0E7QUFtQkE7QUFlQTtBQUNBO0FBQ0E7QUFnQkE7QUFDQTtBQUVBO0FBYUE7QUFJQTtBQW1CQTtBQWdCQTtBQUVBO0FBS0E7QUFFQTtBQWNBO0FBQ0E7QUE0Q0E7QUFFQTtBQUtBO0FBY0E7QUFFQTtBQW9CQTtBQUNBO0FBQ0E7QUFFQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQVNBO0FBT0E7QUFLQTtBQVdBO0FBYUE7QUFNQTtBQUtBO0FBV0E7QUFVQTtBQVNBO0FBR0E7QUFPQTtBQW1CQTtBQUVBO0FBY0E7QUFDQTtBQUNBO0FBR0E7QUFXQTtBQUtBO0FBRUE7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUdBO0FBR0E7QUFHQTtBQUdBO0FBR0E7QUFHQTtBQUdBO0FBR0E7QUFpQ0E7QUFNQTtBQUtBO0FBQ0E7QUFNQTtBQUNBO0FBRUE7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQWNBO0FBQ0E7QUFDQTtBQW1CQTtBQVNBO0FBTUE7QUFXQTtBQWNBO0FBS0E7QUFFQTtBQVVBO0FBSUE7QUFhQTtBQVlBO0FBY0E7QUErQkE7QUFhQTtBQTRCQTtBQWFBO0FBWEE7QUFzQkE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTBDQTtBQUNBO0FBUUE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBU0E7QUFJQTtBQWdCQTtBQUVBO0FBV0E7QUF5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUVBO0FBa0RBO0FBQ0E7QUFHQTtBQWlCQTtBQXdDQTtBQXNCQTtBQUlBO0FBOENBO0FBdUNBO0FBV0E7QUFtQkE7QUFDQTtBQXFKQTtBQUNBO0FBQ0E7QUFpTUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQXNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBY0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMkNBO0FBeUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaUJBO0FBcUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBV0E7QUFHQTtBQUdBO0FBR0E7QUFHQTtBQUNBO0FBSUE7QUE0QkE7QUFDQTtBQUNBO0FBeUZBO0FBQ0E7QUFDQTtBQUNBO0FBNkNBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBbURBO0FBcUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQWtCQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBa0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFjQTtBQVdBO0FBS0E7QUFLQTtBQTJDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQVlBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFhQTtBQUNBO0FBQ0E7QUFnREE7QUFDQTtBQUNBO0FBdURBO0FBc1RBO0FBdUhBO0FBa0pBO0FBb0RBO0FBQ0E7QUE2Q0E7QUE4SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBdUZBO0FBS0E7QUF5Q0E7QUFFQTtBQXlGQTtBQUNBO0FBd0NBO0FBSUE7QUEwQkE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBUUE7QUFvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBZ0RBO0FBbUJBO0FBa0VBO0FBQ0E7QUFDQTtBQWNBO0FBNkJBO0FBQ0E7QUFDQTtBQW1CQTtBQUNBO0FBQ0E7QUFxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEyREE7QUEyREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFxQkE7QUFDQTtBQUNBO0FBSUE7QUFjQTtBQUNBO0FBQ0E7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQW9GQTtBQWFBO0FBU0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBZ0JBO0FBRUE7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUhBO0FBUUE7QUFDQTtBQUtBO0FBQ0E7QUFLQTtBQUNBO0FBS0E7QUFDQTtBQUtBO0FBQ0E7QUFLQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBS0E7QUFFQTtBQUtBO0FBS0E7QUFJQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBUUE7QUFFQTtBQUlBO0FBRUE7QUFJQTtBQUNBO0FBSUE7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUlBO0FBRUE7QUFJQTtBQUVBO0FBSUE7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFLQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNEVBO0FBcUJBO0FBMkNBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQU9BO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBSUE7QUFFQTtBQUlBO0FBRUE7QUFLQTtBQUNBO0FBT0E7QUFJQTtBQUNBO0FBS0E7QUFNQTtBQUVBO0FBQ0E7QUFHQTtBQUVBO0FBRUE7QUFJQTtBQUNBO0FBS0E7QUFNQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7QUFFQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBaUdBO0FBV0E7QUFPQTtBQVlBO0FBOElBO0FBRUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQU1BO0FBRUE7QUFNQTtBQUlBO0FBSUE7QUFHQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFRQTtBQUtBO0FBQ0E7QUFPQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBS0E7QUFHQTtBQUtBO0FBRUE7QUFJQTtBQUVBO0FBR0E7QUFHQTtBQUNBO0FBT0E7QUFFQTtBQU9BO0FBSUE7QUFDQTtBQUNBO0FBS0E7QUE1Q0E7QUFrREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBR0E7QUFHQTtBQUtBO0FBRUE7QUFJQTtBQUVBO0FBR0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQVFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFLQTtBQUVBO0FBQ0E7QUFNQTtBQUNBO0FBS0E7QUEvREE7QUF5RUE7QUFJQTtBQVNBO0FBQ0E7QUFRQTtBQUVBO0FBS0E7QUFFQTtBQUlBO0FBRUE7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUVBO0FBT0E7QUFFQTtBQUlBO0FBRUE7QUFLQTtBQUVBO0FBS0E7QUFFQTtBQUVBO0FBR0E7QUFNQTtBQUVBO0FBS0E7QUFFQTtBQUlBO0FBTUE7QUFFQTtBQUdBO0FBUUE7QUFFQTtBQUVBO0FBR0E7QUFPQTtBQUVBO0FBRUE7QUFDQTtBQVlBO0FBRUE7QUFLQTtBQUVBO0FBS0E7QUFFQTtBQUlBO0FBSUE7QUFPQTtBQUVBO0FBRUE7QUFJQTtBQU9BO0FBRUE7QUFLQTtBQUVBO0FBRUE7QUFHQTtBQU1BO0FBRUE7QUFLQTtBQUVBO0FBS0E7QUFFQTtBQUtBO0FBRUE7QUFJQTtBQUVBO0FBSUE7QUFFQTtBQUdBO0FBRUE7QUEwQ0E7QUFDQTtBQUVBO0FBT0E7QUFZQTtBQUtBO0FBa0JBO0FBTUE7QUE4RUE7QUFDQTtBQXlDQTtBQTZDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQXVJQTtBQVVBO0FBYUE7QUFVQTtBQWFBO0FBV0E7QUFhQTtBQVdBO0FBaUJBO0FBWUE7QUFlQTtBQVlBO0FBMEVBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFHQTtBQUdBO0FBQ0E7QUFJQTtBQW9CQTtBQUNBO0FBQ0E7QUFJQTtBQUtBO0FBQ0E7QUFRQTtBQVFBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFHQTtBQUdBO0FBQ0E7QUFJQTtBQVlBO0FBQ0E7QUFDQTtBQTBEQTtBQVFBO0FBRUE7QUFZQTtBQUVBO0FBRUE7QUFDQTtBQUdBO0FBR0E7QUFDQTtBQUlBO0FBMkZBO0FBbUlBO0FBR0E7QUF5QkE7QUFDQTtBQTZJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFzQ0E7QUFlQTtBQUlBO0FBdUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUF3QkE7QUFpQkE7QUFxQkE7QUFDQTtBQWNBO0FBYUE7QUFLQTtBQUtBO0FBS0E7QUFTQTtBQWlEQTtBQU1BO0FBd1RBO0FBQ0E7QUFDQTtBQTJDQTtBQUNBO0FBMkNBO0FBYUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBaUJBO0FBQ0E7QUFDQTtBQU1BO0FBWUE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQXhDQTtBQThDQTtBQVNBO0FBQ0E7QUFDQTtBQU1BO0FBWUE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQS9DQTtBQWtFQTtBQUNBO0FBQ0E7QUFPQTtBQUFBO0FBdUNBO0FBQ0E7QUFDQTtBQUpBO0FBdUVBO0FBT0E7QUFxQkE7QUFzREE7QUFHQTtBQW1DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUE2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBd0JBO0FBQ0E7QUF1QkE7QUFhQTtBQWdDQTtBQXdKQTtBQW9CQTtBQWVBO0FBQ0E7QUE0QkE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQW1EQTtBQUVBO0FBQ0E7QUFtQ0E7QUFZQTtBQUVBO0FBR0E7QUF3REE7QUFzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUEwRUE7QUFFQTtBQThCQTtBQVdBO0FBbUJBO0FBT0E7QUFDQTtBQXdGQTtBQXlDQTtBQWdEQTtBQVNBO0FBNlFBO0FBNEZBO0FBOERBO0FBNkRBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFvQkE7QUEwR0E7QUFtRkE7QUE4QkE7QUFTQTtBQUlBO0FBSUE7QUFDQTtBQUNBO0FBS0E7QUF1QkE7QUFFQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF3Q0E7QUFDQTtBQUNBO0FBRUE7QUFnREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBc0JBO0FBQ0E7QUFDQTtBQW9CQTtBQXVCQTtBQStCQTtBQWtHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBd0dBO0FBR0E7QUE4Q0E7QUF5aEVBO0FBaUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBSUE7QUFDQTtBQUlBO0FBSUE7QUFJQTtBQUlBO0FBSUE7QUFNQTtBQW9CQTtBQUNBO0FBVUE7QUE4RkE7QUE2Q0E7QUFhQTtBQUlBO0FBTUE7QUFlQTtBQUNBO0FBZ0ZBO0FBZ0VBO0FBNERBO0FBQ0E7QUFDQTtBQTRIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFtREE7QUF3QkE7QUF5Q0E7QUFjQTtBQThCQTtBQXVEQTtBQXlEQTtBQWlFQTtBQWNBO0FBeUJBO0FBd1NBO0FBQ0E7QUFxQ0E7QUFvQkE7QUF1TkE7QUFpSEE7QUFDQTtBQXdCQTtBQUNBO0FBb0RBO0FBaUJBO0FBQ0E7QUEyQ0E7QUFDQTtBQUNBO0FBaU5BO0FBRUE7QUF3RkE7QUF3Q0E7QUFVQTtBQXlCQTtBQUlBO0FBR0E7QUFJQTtBQUNBO0FBQ0E7QUFVQTtBQVVBO0FBU0E7QUFDQTtBQUNBO0FBK1FBO0FBZUE7QUFHQTtBQUdBO0FBcUJBO0FBdUJBO0FBdURBO0FBRUE7QUFDQTtBQThCQTtBQXlCQTtBQVdBO0FBTUE7QUFzQkE7QUFPQTtBQUlBO0FBR0E7QUFRQTtBQUNBO0FBeUJBO0FBQ0E7QUFDQTtBQUNBO0FBY0E7QUFDQTtBQUNBO0FBZ0pBO0FBa0lBO0FBQ0E7QUFPQTtBQStFQTtBQVVBO0FBNENBO0FBcUVBO0FBUUE7QUFRQTtBQXVCQTtBQThFQTtBQXFCQTtBQUNBO0FBQ0E7QUFvQ0E7QUFDQTtBQXFCQTtBQUNBO0FBQ0E7QUF5QkE7QUFTQTtBQUNBO0FBMkNBO0FBd0JBO0FBRUE7QUFVQTtBQUVBO0FBb0lBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFnQkE7QUFDQTtBQVNBO0FBc0VBO0FBVUE7QUFDQTtBQU1BO0FBaUJBO0FBR0E7QUFZQTtBQUdBO0FBSUE7QUFFQTtBQUlBO0FBS0E7QUFTQTtBQUlBO0FBSUE7QUFJQTtBQUdBO0FBaUZBO0FBaU1BO0FBQ0E7QUFLQTtBQTRFQTtBQStDQTtBQWtCQTtBQXlEQTtBQVdBO0FBMEZBO0FBQ0E7QUFDQTtBQVVBO0FBQ0E7QUF3R0E7QUF5UkE7QUE2T0E7QUFzRUE7QUFJQTtBQVNBO0FBQ0E7QUFvQkE7QUFpQkE7QUE2Q0E7QUE2QkE7QUFrRkE7QUF3S0E7QUFDQTtBQW9IQTtBQUlBO0FBZ0JBO0FBa0JBO0FBT0E7QUFDQTtBQUNBO0FBZ0JBO0FBeUNBO0FBaUVBO0FBQ0E7QUFTQTtBQVVBO0FBMEJBO0FBeURBO0FBa0NBO0FBeUJBO0FBQ0E7QUFDQTtBQUNBO0FBcUlBO0FBQ0E7QUFNQTtBQXdCQTtBQU1BO0FBSUE7QUE4REE7QUFHQTtBQXdDQTtBQTJLQTtBQU9BO0FBU0E7QUFPQTtBQTJFQTtBQUNBO0FBQ0E7QUF3Q0E7QUF5RkE7QUFtREE7QUErQkE7QUFDQTtBQUNBO0FBWUE7QUFvQkE7QUFXQTtBQXNDQTtBQUNBO0FBR0E7QUE0SUE7QUFLQTtBQUtBO0FBQ0E7QUFDQTtBQVFBO0FBR0E7QUFzQ0E7QUFzQ0E7QUFxREE7QUF1Q0E7QUFxRkE7QUFDQTtBQXVDQTtBQXNDQTtBQUNBO0FBaUZBO0FBNkRBO0FBQ0E7QUE0Q0E7QUFLQTtBQXdDQTtBQTJJQTtBQUNBO0FBMkpBO0FBQ0E7QUFnSkE7QUFrQ0E7QUFDQTtBQXNLQTtBQXlEQTtBQUNBO0FBQ0E7QUFDQTtBQXdIQTtBQUNBO0FBaUJBO0FBaUtBO0FBQ0E7QUFpRkE7QUErRUE7QUF3RUE7QUFDQTtBQUVBO0FBQ0E7QUFNQTtBQTZFQTtBQUVBO0FBS0E7QUFxQkE7QUEyQ0E7QUFjQTtBQStDQTtBQUNBO0FBQ0E7QUFpQkE7QUFDQTtBQU9BO0FBQ0E7QUFTQTtBQW9EQTtBQUlBO0FBR0E7QUFjQTtBQVdBO0FBZUE7QUFDQTtBQVNBO0FBQ0E7QUF3RUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQWtCQTtBQUNBO0FBR0E7QUFNQTtBQVFBO0FBWUE7QUFvQ0E7QUFJQTtBQTBCQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFRQTtBQXVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVdBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBVUE7QUFDQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBS0E7QUFJQTtBQUdBO0FBQ0E7QUFJQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFhQTtBQUNBO0FBT0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQVVBO0FBUUE7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWFBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBS0E7QUFDQTtBQUNBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFVQTtBQVFBO0FBQ0E7QUFDQTtBQUlBO0FBMEJBO0FBT0E7QUFDQTtBQW9CQTtBQUNBO0FBQ0E7QUFHQTtBQVFBO0FBT0E7QUFPQTtBQWlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBT0E7QUFFQTtBQU9BO0FBQ0E7QUFDQTtBQVVBO0FBWUE7QUFDQTtBQUNBO0FBWUE7QUFjQTtBQUNBO0FBRkE7QUFLQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQVdBO0FBQ0E7QUFpQkE7QUFPQTtBQVFBO0FBS0E7QUFHQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBZUE7QUE4QkE7QUFDQTtBQUdBO0FBQ0E7QUFpSUE7QUErQkE7QUEwQkE7QUFDQTtBQUNBO0FBQ0E7QUE0QkE7QUFxREE7QUFTQTtBQTRQQTtBQXlCQTtBQTRCQTtBQUNBO0FBQ0E7QUF3QkE7QUEyQkE7QUFDQTtBQUNBO0FBT0E7QUFRQTtBQWVBO0FBa0JBO0FBNkJBO0FBZ0RBO0FBQ0E7QUFvRkE7QUFnS0E7QUErRkE7QUFJQTtBQUVBO0FBa0NBO0FBOENBO0FBZUE7QUFnSUE7QUFxSEE7QUFtRkE7QUFnR0E7QUFDQTtBQUNBO0FBS0E7QUFjQTtBQTZSQTtBQUdBO0FBNkVBO0FBU0E7QUEyREE7QUFrQ0E7QUFHQTtBQWdJQTtBQUdBO0FBd0NBO0FBd0JBO0FBdUVBO0FBbUNBO0FBcURBO0FBOEZBO0FBbUNBO0FBMENBO0FBQ0E7QUFDQTtBQWlCQTtBQTBGQTtBQW9EQTtBQXVEQTtBQTRLQTtBQXFFQTtBQWtDQTtBQVNBO0FBVUE7QUFnQkE7QUFLQTtBQThPQTtBQVlBO0FBR0E7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQXVDQTtBQUNBO0FBZUE7QUFxSUE7QUEwUkE7QUFrQ0E7QUFDQTtBQXFGQTtBQVVBO0FBWUE7QUFvR0E7QUFvQ0E7QUFxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNEZBO0FBQ0E7QUFDQTtBQUNBO0FBWUE7QUFDQTtBQTZDQTtBQWdLQTtBQUNBO0FBdUNBO0FBdUdBO0FBc0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFxQkE7QUFLQTtBQWdDQTtBQVNBO0FBNkNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFJQTtBQWdCQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBUUE7QUFDQTtBQUdBO0FBSUE7QUFFQTtBQVNBO0FBQ0E7QUFDQTtBQWNBO0FBWUE7QUFDQTtBQXNDQTtBQWFBO0FBTUE7QUFSQTtBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/svelte/compiler.mjs\n");

/***/ }),

/***/ "./node_modules/url/url.js":
/*!*********************************!*\
  !*** ./node_modules/url/url.js ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n\nvar punycode = __webpack_require__(/*! punycode */ \"./node_modules/punycode/punycode.js\");\nvar util = __webpack_require__(/*! ./util */ \"./node_modules/url/util.js\");\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = __webpack_require__(/*! querystring */ \"./node_modules/querystring-es3/index.js\");\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvdXJsL3VybC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy91cmwvdXJsLmpzPzBiMTYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGFcbi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbi8vIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxuLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdFxuLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlXG4vLyBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZFxuLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTlxuLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sXG4vLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Jcbi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEVcbi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbid1c2Ugc3RyaWN0JztcblxudmFyIHB1bnljb2RlID0gcmVxdWlyZSgncHVueWNvZGUnKTtcbnZhciB1dGlsID0gcmVxdWlyZSgnLi91dGlsJyk7XG5cbmV4cG9ydHMucGFyc2UgPSB1cmxQYXJzZTtcbmV4cG9ydHMucmVzb2x2ZSA9IHVybFJlc29sdmU7XG5leHBvcnRzLnJlc29sdmVPYmplY3QgPSB1cmxSZXNvbHZlT2JqZWN0O1xuZXhwb3J0cy5mb3JtYXQgPSB1cmxGb3JtYXQ7XG5cbmV4cG9ydHMuVXJsID0gVXJsO1xuXG5mdW5jdGlvbiBVcmwoKSB7XG4gIHRoaXMucHJvdG9jb2wgPSBudWxsO1xuICB0aGlzLnNsYXNoZXMgPSBudWxsO1xuICB0aGlzLmF1dGggPSBudWxsO1xuICB0aGlzLmhvc3QgPSBudWxsO1xuICB0aGlzLnBvcnQgPSBudWxsO1xuICB0aGlzLmhvc3RuYW1lID0gbnVsbDtcbiAgdGhpcy5oYXNoID0gbnVsbDtcbiAgdGhpcy5zZWFyY2ggPSBudWxsO1xuICB0aGlzLnF1ZXJ5ID0gbnVsbDtcbiAgdGhpcy5wYXRobmFtZSA9IG51bGw7XG4gIHRoaXMucGF0aCA9IG51bGw7XG4gIHRoaXMuaHJlZiA9IG51bGw7XG59XG5cbi8vIFJlZmVyZW5jZTogUkZDIDM5ODYsIFJGQyAxODA4LCBSRkMgMjM5NlxuXG4vLyBkZWZpbmUgdGhlc2UgaGVyZSBzbyBhdCBsZWFzdCB0aGV5IG9ubHkgaGF2ZSB0byBiZVxuLy8gY29tcGlsZWQgb25jZSBvbiB0aGUgZmlyc3QgbW9kdWxlIGxvYWQuXG52YXIgcHJvdG9jb2xQYXR0ZXJuID0gL14oW2EtejAtOS4rLV0rOikvaSxcbiAgICBwb3J0UGF0dGVybiA9IC86WzAtOV0qJC8sXG5cbiAgICAvLyBTcGVjaWFsIGNhc2UgZm9yIGEgc2ltcGxlIHBhdGggVVJMXG4gICAgc2ltcGxlUGF0aFBhdHRlcm4gPSAvXihcXC9cXC8/KD8hXFwvKVteXFw/XFxzXSopKFxcP1teXFxzXSopPyQvLFxuXG4gICAgLy8gUkZDIDIzOTY6IGNoYXJhY3RlcnMgcmVzZXJ2ZWQgZm9yIGRlbGltaXRpbmcgVVJMcy5cbiAgICAvLyBXZSBhY3R1YWxseSBqdXN0IGF1dG8tZXNjYXBlIHRoZXNlLlxuICAgIGRlbGltcyA9IFsnPCcsICc+JywgJ1wiJywgJ2AnLCAnICcsICdcXHInLCAnXFxuJywgJ1xcdCddLFxuXG4gICAgLy8gUkZDIDIzOTY6IGNoYXJhY3RlcnMgbm90IGFsbG93ZWQgZm9yIHZhcmlvdXMgcmVhc29ucy5cbiAgICB1bndpc2UgPSBbJ3snLCAnfScsICd8JywgJ1xcXFwnLCAnXicsICdgJ10uY29uY2F0KGRlbGltcyksXG5cbiAgICAvLyBBbGxvd2VkIGJ5IFJGQ3MsIGJ1dCBjYXVzZSBvZiBYU1MgYXR0YWNrcy4gIEFsd2F5cyBlc2NhcGUgdGhlc2UuXG4gICAgYXV0b0VzY2FwZSA9IFsnXFwnJ10uY29uY2F0KHVud2lzZSksXG4gICAgLy8gQ2hhcmFjdGVycyB0aGF0IGFyZSBuZXZlciBldmVyIGFsbG93ZWQgaW4gYSBob3N0bmFtZS5cbiAgICAvLyBOb3RlIHRoYXQgYW55IGludmFsaWQgY2hhcnMgYXJlIGFsc28gaGFuZGxlZCwgYnV0IHRoZXNlXG4gICAgLy8gYXJlIHRoZSBvbmVzIHRoYXQgYXJlICpleHBlY3RlZCogdG8gYmUgc2Vlbiwgc28gd2UgZmFzdC1wYXRoXG4gICAgLy8gdGhlbS5cbiAgICBub25Ib3N0Q2hhcnMgPSBbJyUnLCAnLycsICc/JywgJzsnLCAnIyddLmNvbmNhdChhdXRvRXNjYXBlKSxcbiAgICBob3N0RW5kaW5nQ2hhcnMgPSBbJy8nLCAnPycsICcjJ10sXG4gICAgaG9zdG5hbWVNYXhMZW4gPSAyNTUsXG4gICAgaG9zdG5hbWVQYXJ0UGF0dGVybiA9IC9eWythLXowLTlBLVpfLV17MCw2M30kLyxcbiAgICBob3N0bmFtZVBhcnRTdGFydCA9IC9eKFsrYS16MC05QS1aXy1dezAsNjN9KSguKikkLyxcbiAgICAvLyBwcm90b2NvbHMgdGhhdCBjYW4gYWxsb3cgXCJ1bnNhZmVcIiBhbmQgXCJ1bndpc2VcIiBjaGFycy5cbiAgICB1bnNhZmVQcm90b2NvbCA9IHtcbiAgICAgICdqYXZhc2NyaXB0JzogdHJ1ZSxcbiAgICAgICdqYXZhc2NyaXB0Oic6IHRydWVcbiAgICB9LFxuICAgIC8vIHByb3RvY29scyB0aGF0IG5ldmVyIGhhdmUgYSBob3N0bmFtZS5cbiAgICBob3N0bGVzc1Byb3RvY29sID0ge1xuICAgICAgJ2phdmFzY3JpcHQnOiB0cnVlLFxuICAgICAgJ2phdmFzY3JpcHQ6JzogdHJ1ZVxuICAgIH0sXG4gICAgLy8gcHJvdG9jb2xzIHRoYXQgYWx3YXlzIGNvbnRhaW4gYSAvLyBiaXQuXG4gICAgc2xhc2hlZFByb3RvY29sID0ge1xuICAgICAgJ2h0dHAnOiB0cnVlLFxuICAgICAgJ2h0dHBzJzogdHJ1ZSxcbiAgICAgICdmdHAnOiB0cnVlLFxuICAgICAgJ2dvcGhlcic6IHRydWUsXG4gICAgICAnZmlsZSc6IHRydWUsXG4gICAgICAnaHR0cDonOiB0cnVlLFxuICAgICAgJ2h0dHBzOic6IHRydWUsXG4gICAgICAnZnRwOic6IHRydWUsXG4gICAgICAnZ29waGVyOic6IHRydWUsXG4gICAgICAnZmlsZTonOiB0cnVlXG4gICAgfSxcbiAgICBxdWVyeXN0cmluZyA9IHJlcXVpcmUoJ3F1ZXJ5c3RyaW5nJyk7XG5cbmZ1bmN0aW9uIHVybFBhcnNlKHVybCwgcGFyc2VRdWVyeVN0cmluZywgc2xhc2hlc0Rlbm90ZUhvc3QpIHtcbiAgaWYgKHVybCAmJiB1dGlsLmlzT2JqZWN0KHVybCkgJiYgdXJsIGluc3RhbmNlb2YgVXJsKSByZXR1cm4gdXJsO1xuXG4gIHZhciB1ID0gbmV3IFVybDtcbiAgdS5wYXJzZSh1cmwsIHBhcnNlUXVlcnlTdHJpbmcsIHNsYXNoZXNEZW5vdGVIb3N0KTtcbiAgcmV0dXJuIHU7XG59XG5cblVybC5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbih1cmwsIHBhcnNlUXVlcnlTdHJpbmcsIHNsYXNoZXNEZW5vdGVIb3N0KSB7XG4gIGlmICghdXRpbC5pc1N0cmluZyh1cmwpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlBhcmFtZXRlciAndXJsJyBtdXN0IGJlIGEgc3RyaW5nLCBub3QgXCIgKyB0eXBlb2YgdXJsKTtcbiAgfVxuXG4gIC8vIENvcHkgY2hyb21lLCBJRSwgb3BlcmEgYmFja3NsYXNoLWhhbmRsaW5nIGJlaGF2aW9yLlxuICAvLyBCYWNrIHNsYXNoZXMgYmVmb3JlIHRoZSBxdWVyeSBzdHJpbmcgZ2V0IGNvbnZlcnRlZCB0byBmb3J3YXJkIHNsYXNoZXNcbiAgLy8gU2VlOiBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9MjU5MTZcbiAgdmFyIHF1ZXJ5SW5kZXggPSB1cmwuaW5kZXhPZignPycpLFxuICAgICAgc3BsaXR0ZXIgPVxuICAgICAgICAgIChxdWVyeUluZGV4ICE9PSAtMSAmJiBxdWVyeUluZGV4IDwgdXJsLmluZGV4T2YoJyMnKSkgPyAnPycgOiAnIycsXG4gICAgICB1U3BsaXQgPSB1cmwuc3BsaXQoc3BsaXR0ZXIpLFxuICAgICAgc2xhc2hSZWdleCA9IC9cXFxcL2c7XG4gIHVTcGxpdFswXSA9IHVTcGxpdFswXS5yZXBsYWNlKHNsYXNoUmVnZXgsICcvJyk7XG4gIHVybCA9IHVTcGxpdC5qb2luKHNwbGl0dGVyKTtcblxuICB2YXIgcmVzdCA9IHVybDtcblxuICAvLyB0cmltIGJlZm9yZSBwcm9jZWVkaW5nLlxuICAvLyBUaGlzIGlzIHRvIHN1cHBvcnQgcGFyc2Ugc3R1ZmYgbGlrZSBcIiAgaHR0cDovL2Zvby5jb20gIFxcblwiXG4gIHJlc3QgPSByZXN0LnRyaW0oKTtcblxuICBpZiAoIXNsYXNoZXNEZW5vdGVIb3N0ICYmIHVybC5zcGxpdCgnIycpLmxlbmd0aCA9PT0gMSkge1xuICAgIC8vIFRyeSBmYXN0IHBhdGggcmVnZXhwXG4gICAgdmFyIHNpbXBsZVBhdGggPSBzaW1wbGVQYXRoUGF0dGVybi5leGVjKHJlc3QpO1xuICAgIGlmIChzaW1wbGVQYXRoKSB7XG4gICAgICB0aGlzLnBhdGggPSByZXN0O1xuICAgICAgdGhpcy5ocmVmID0gcmVzdDtcbiAgICAgIHRoaXMucGF0aG5hbWUgPSBzaW1wbGVQYXRoWzFdO1xuICAgICAgaWYgKHNpbXBsZVBhdGhbMl0pIHtcbiAgICAgICAgdGhpcy5zZWFyY2ggPSBzaW1wbGVQYXRoWzJdO1xuICAgICAgICBpZiAocGFyc2VRdWVyeVN0cmluZykge1xuICAgICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeXN0cmluZy5wYXJzZSh0aGlzLnNlYXJjaC5zdWJzdHIoMSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucXVlcnkgPSB0aGlzLnNlYXJjaC5zdWJzdHIoMSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAocGFyc2VRdWVyeVN0cmluZykge1xuICAgICAgICB0aGlzLnNlYXJjaCA9ICcnO1xuICAgICAgICB0aGlzLnF1ZXJ5ID0ge307XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH1cblxuICB2YXIgcHJvdG8gPSBwcm90b2NvbFBhdHRlcm4uZXhlYyhyZXN0KTtcbiAgaWYgKHByb3RvKSB7XG4gICAgcHJvdG8gPSBwcm90b1swXTtcbiAgICB2YXIgbG93ZXJQcm90byA9IHByb3RvLnRvTG93ZXJDYXNlKCk7XG4gICAgdGhpcy5wcm90b2NvbCA9IGxvd2VyUHJvdG87XG4gICAgcmVzdCA9IHJlc3Quc3Vic3RyKHByb3RvLmxlbmd0aCk7XG4gIH1cblxuICAvLyBmaWd1cmUgb3V0IGlmIGl0J3MgZ290IGEgaG9zdFxuICAvLyB1c2VyQHNlcnZlciBpcyAqYWx3YXlzKiBpbnRlcnByZXRlZCBhcyBhIGhvc3RuYW1lLCBhbmQgdXJsXG4gIC8vIHJlc29sdXRpb24gd2lsbCB0cmVhdCAvL2Zvby9iYXIgYXMgaG9zdD1mb28scGF0aD1iYXIgYmVjYXVzZSB0aGF0J3NcbiAgLy8gaG93IHRoZSBicm93c2VyIHJlc29sdmVzIHJlbGF0aXZlIFVSTHMuXG4gIGlmIChzbGFzaGVzRGVub3RlSG9zdCB8fCBwcm90byB8fCByZXN0Lm1hdGNoKC9eXFwvXFwvW15AXFwvXStAW15AXFwvXSsvKSkge1xuICAgIHZhciBzbGFzaGVzID0gcmVzdC5zdWJzdHIoMCwgMikgPT09ICcvLyc7XG4gICAgaWYgKHNsYXNoZXMgJiYgIShwcm90byAmJiBob3N0bGVzc1Byb3RvY29sW3Byb3RvXSkpIHtcbiAgICAgIHJlc3QgPSByZXN0LnN1YnN0cigyKTtcbiAgICAgIHRoaXMuc2xhc2hlcyA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFob3N0bGVzc1Byb3RvY29sW3Byb3RvXSAmJlxuICAgICAgKHNsYXNoZXMgfHwgKHByb3RvICYmICFzbGFzaGVkUHJvdG9jb2xbcHJvdG9dKSkpIHtcblxuICAgIC8vIHRoZXJlJ3MgYSBob3N0bmFtZS5cbiAgICAvLyB0aGUgZmlyc3QgaW5zdGFuY2Ugb2YgLywgPywgOywgb3IgIyBlbmRzIHRoZSBob3N0LlxuICAgIC8vXG4gICAgLy8gSWYgdGhlcmUgaXMgYW4gQCBpbiB0aGUgaG9zdG5hbWUsIHRoZW4gbm9uLWhvc3QgY2hhcnMgKmFyZSogYWxsb3dlZFxuICAgIC8vIHRvIHRoZSBsZWZ0IG9mIHRoZSBsYXN0IEAgc2lnbiwgdW5sZXNzIHNvbWUgaG9zdC1lbmRpbmcgY2hhcmFjdGVyXG4gICAgLy8gY29tZXMgKmJlZm9yZSogdGhlIEAtc2lnbi5cbiAgICAvLyBVUkxzIGFyZSBvYm5veGlvdXMuXG4gICAgLy9cbiAgICAvLyBleDpcbiAgICAvLyBodHRwOi8vYUBiQGMvID0+IHVzZXI6YUBiIGhvc3Q6Y1xuICAgIC8vIGh0dHA6Ly9hQGI/QGMgPT4gdXNlcjphIGhvc3Q6YyBwYXRoOi8/QGNcblxuICAgIC8vIHYwLjEyIFRPRE8oaXNhYWNzKTogVGhpcyBpcyBub3QgcXVpdGUgaG93IENocm9tZSBkb2VzIHRoaW5ncy5cbiAgICAvLyBSZXZpZXcgb3VyIHRlc3QgY2FzZSBhZ2FpbnN0IGJyb3dzZXJzIG1vcmUgY29tcHJlaGVuc2l2ZWx5LlxuXG4gICAgLy8gZmluZCB0aGUgZmlyc3QgaW5zdGFuY2Ugb2YgYW55IGhvc3RFbmRpbmdDaGFyc1xuICAgIHZhciBob3N0RW5kID0gLTE7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob3N0RW5kaW5nQ2hhcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBoZWMgPSByZXN0LmluZGV4T2YoaG9zdEVuZGluZ0NoYXJzW2ldKTtcbiAgICAgIGlmIChoZWMgIT09IC0xICYmIChob3N0RW5kID09PSAtMSB8fCBoZWMgPCBob3N0RW5kKSlcbiAgICAgICAgaG9zdEVuZCA9IGhlYztcbiAgICB9XG5cbiAgICAvLyBhdCB0aGlzIHBvaW50LCBlaXRoZXIgd2UgaGF2ZSBhbiBleHBsaWNpdCBwb2ludCB3aGVyZSB0aGVcbiAgICAvLyBhdXRoIHBvcnRpb24gY2Fubm90IGdvIHBhc3QsIG9yIHRoZSBsYXN0IEAgY2hhciBpcyB0aGUgZGVjaWRlci5cbiAgICB2YXIgYXV0aCwgYXRTaWduO1xuICAgIGlmIChob3N0RW5kID09PSAtMSkge1xuICAgICAgLy8gYXRTaWduIGNhbiBiZSBhbnl3aGVyZS5cbiAgICAgIGF0U2lnbiA9IHJlc3QubGFzdEluZGV4T2YoJ0AnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gYXRTaWduIG11c3QgYmUgaW4gYXV0aCBwb3J0aW9uLlxuICAgICAgLy8gaHR0cDovL2FAYi9jQGQgPT4gaG9zdDpiIGF1dGg6YSBwYXRoOi9jQGRcbiAgICAgIGF0U2lnbiA9IHJlc3QubGFzdEluZGV4T2YoJ0AnLCBob3N0RW5kKTtcbiAgICB9XG5cbiAgICAvLyBOb3cgd2UgaGF2ZSBhIHBvcnRpb24gd2hpY2ggaXMgZGVmaW5pdGVseSB0aGUgYXV0aC5cbiAgICAvLyBQdWxsIHRoYXQgb2ZmLlxuICAgIGlmIChhdFNpZ24gIT09IC0xKSB7XG4gICAgICBhdXRoID0gcmVzdC5zbGljZSgwLCBhdFNpZ24pO1xuICAgICAgcmVzdCA9IHJlc3Quc2xpY2UoYXRTaWduICsgMSk7XG4gICAgICB0aGlzLmF1dGggPSBkZWNvZGVVUklDb21wb25lbnQoYXV0aCk7XG4gICAgfVxuXG4gICAgLy8gdGhlIGhvc3QgaXMgdGhlIHJlbWFpbmluZyB0byB0aGUgbGVmdCBvZiB0aGUgZmlyc3Qgbm9uLWhvc3QgY2hhclxuICAgIGhvc3RFbmQgPSAtMTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vbkhvc3RDaGFycy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGhlYyA9IHJlc3QuaW5kZXhPZihub25Ib3N0Q2hhcnNbaV0pO1xuICAgICAgaWYgKGhlYyAhPT0gLTEgJiYgKGhvc3RFbmQgPT09IC0xIHx8IGhlYyA8IGhvc3RFbmQpKVxuICAgICAgICBob3N0RW5kID0gaGVjO1xuICAgIH1cbiAgICAvLyBpZiB3ZSBzdGlsbCBoYXZlIG5vdCBoaXQgaXQsIHRoZW4gdGhlIGVudGlyZSB0aGluZyBpcyBhIGhvc3QuXG4gICAgaWYgKGhvc3RFbmQgPT09IC0xKVxuICAgICAgaG9zdEVuZCA9IHJlc3QubGVuZ3RoO1xuXG4gICAgdGhpcy5ob3N0ID0gcmVzdC5zbGljZSgwLCBob3N0RW5kKTtcbiAgICByZXN0ID0gcmVzdC5zbGljZShob3N0RW5kKTtcblxuICAgIC8vIHB1bGwgb3V0IHBvcnQuXG4gICAgdGhpcy5wYXJzZUhvc3QoKTtcblxuICAgIC8vIHdlJ3ZlIGluZGljYXRlZCB0aGF0IHRoZXJlIGlzIGEgaG9zdG5hbWUsXG4gICAgLy8gc28gZXZlbiBpZiBpdCdzIGVtcHR5LCBpdCBoYXMgdG8gYmUgcHJlc2VudC5cbiAgICB0aGlzLmhvc3RuYW1lID0gdGhpcy5ob3N0bmFtZSB8fCAnJztcblxuICAgIC8vIGlmIGhvc3RuYW1lIGJlZ2lucyB3aXRoIFsgYW5kIGVuZHMgd2l0aCBdXG4gICAgLy8gYXNzdW1lIHRoYXQgaXQncyBhbiBJUHY2IGFkZHJlc3MuXG4gICAgdmFyIGlwdjZIb3N0bmFtZSA9IHRoaXMuaG9zdG5hbWVbMF0gPT09ICdbJyAmJlxuICAgICAgICB0aGlzLmhvc3RuYW1lW3RoaXMuaG9zdG5hbWUubGVuZ3RoIC0gMV0gPT09ICddJztcblxuICAgIC8vIHZhbGlkYXRlIGEgbGl0dGxlLlxuICAgIGlmICghaXB2Nkhvc3RuYW1lKSB7XG4gICAgICB2YXIgaG9zdHBhcnRzID0gdGhpcy5ob3N0bmFtZS5zcGxpdCgvXFwuLyk7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGhvc3RwYXJ0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgdmFyIHBhcnQgPSBob3N0cGFydHNbaV07XG4gICAgICAgIGlmICghcGFydCkgY29udGludWU7XG4gICAgICAgIGlmICghcGFydC5tYXRjaChob3N0bmFtZVBhcnRQYXR0ZXJuKSkge1xuICAgICAgICAgIHZhciBuZXdwYXJ0ID0gJyc7XG4gICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGsgPSBwYXJ0Lmxlbmd0aDsgaiA8IGs7IGorKykge1xuICAgICAgICAgICAgaWYgKHBhcnQuY2hhckNvZGVBdChqKSA+IDEyNykge1xuICAgICAgICAgICAgICAvLyB3ZSByZXBsYWNlIG5vbi1BU0NJSSBjaGFyIHdpdGggYSB0ZW1wb3JhcnkgcGxhY2Vob2xkZXJcbiAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0aGlzIHRvIG1ha2Ugc3VyZSBzaXplIG9mIGhvc3RuYW1lIGlzIG5vdFxuICAgICAgICAgICAgICAvLyBicm9rZW4gYnkgcmVwbGFjaW5nIG5vbi1BU0NJSSBieSBub3RoaW5nXG4gICAgICAgICAgICAgIG5ld3BhcnQgKz0gJ3gnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbmV3cGFydCArPSBwYXJ0W2pdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyB3ZSB0ZXN0IGFnYWluIHdpdGggQVNDSUkgY2hhciBvbmx5XG4gICAgICAgICAgaWYgKCFuZXdwYXJ0Lm1hdGNoKGhvc3RuYW1lUGFydFBhdHRlcm4pKSB7XG4gICAgICAgICAgICB2YXIgdmFsaWRQYXJ0cyA9IGhvc3RwYXJ0cy5zbGljZSgwLCBpKTtcbiAgICAgICAgICAgIHZhciBub3RIb3N0ID0gaG9zdHBhcnRzLnNsaWNlKGkgKyAxKTtcbiAgICAgICAgICAgIHZhciBiaXQgPSBwYXJ0Lm1hdGNoKGhvc3RuYW1lUGFydFN0YXJ0KTtcbiAgICAgICAgICAgIGlmIChiaXQpIHtcbiAgICAgICAgICAgICAgdmFsaWRQYXJ0cy5wdXNoKGJpdFsxXSk7XG4gICAgICAgICAgICAgIG5vdEhvc3QudW5zaGlmdChiaXRbMl0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5vdEhvc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHJlc3QgPSAnLycgKyBub3RIb3N0LmpvaW4oJy4nKSArIHJlc3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmhvc3RuYW1lID0gdmFsaWRQYXJ0cy5qb2luKCcuJyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5ob3N0bmFtZS5sZW5ndGggPiBob3N0bmFtZU1heExlbikge1xuICAgICAgdGhpcy5ob3N0bmFtZSA9ICcnO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBob3N0bmFtZXMgYXJlIGFsd2F5cyBsb3dlciBjYXNlLlxuICAgICAgdGhpcy5ob3N0bmFtZSA9IHRoaXMuaG9zdG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICBpZiAoIWlwdjZIb3N0bmFtZSkge1xuICAgICAgLy8gSUROQSBTdXBwb3J0OiBSZXR1cm5zIGEgcHVueWNvZGVkIHJlcHJlc2VudGF0aW9uIG9mIFwiZG9tYWluXCIuXG4gICAgICAvLyBJdCBvbmx5IGNvbnZlcnRzIHBhcnRzIG9mIHRoZSBkb21haW4gbmFtZSB0aGF0XG4gICAgICAvLyBoYXZlIG5vbi1BU0NJSSBjaGFyYWN0ZXJzLCBpLmUuIGl0IGRvZXNuJ3QgbWF0dGVyIGlmXG4gICAgICAvLyB5b3UgY2FsbCBpdCB3aXRoIGEgZG9tYWluIHRoYXQgYWxyZWFkeSBpcyBBU0NJSS1vbmx5LlxuICAgICAgdGhpcy5ob3N0bmFtZSA9IHB1bnljb2RlLnRvQVNDSUkodGhpcy5ob3N0bmFtZSk7XG4gICAgfVxuXG4gICAgdmFyIHAgPSB0aGlzLnBvcnQgPyAnOicgKyB0aGlzLnBvcnQgOiAnJztcbiAgICB2YXIgaCA9IHRoaXMuaG9zdG5hbWUgfHwgJyc7XG4gICAgdGhpcy5ob3N0ID0gaCArIHA7XG4gICAgdGhpcy5ocmVmICs9IHRoaXMuaG9zdDtcblxuICAgIC8vIHN0cmlwIFsgYW5kIF0gZnJvbSB0aGUgaG9zdG5hbWVcbiAgICAvLyB0aGUgaG9zdCBmaWVsZCBzdGlsbCByZXRhaW5zIHRoZW0sIHRob3VnaFxuICAgIGlmIChpcHY2SG9zdG5hbWUpIHtcbiAgICAgIHRoaXMuaG9zdG5hbWUgPSB0aGlzLmhvc3RuYW1lLnN1YnN0cigxLCB0aGlzLmhvc3RuYW1lLmxlbmd0aCAtIDIpO1xuICAgICAgaWYgKHJlc3RbMF0gIT09ICcvJykge1xuICAgICAgICByZXN0ID0gJy8nICsgcmVzdDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBub3cgcmVzdCBpcyBzZXQgdG8gdGhlIHBvc3QtaG9zdCBzdHVmZi5cbiAgLy8gY2hvcCBvZmYgYW55IGRlbGltIGNoYXJzLlxuICBpZiAoIXVuc2FmZVByb3RvY29sW2xvd2VyUHJvdG9dKSB7XG5cbiAgICAvLyBGaXJzdCwgbWFrZSAxMDAlIHN1cmUgdGhhdCBhbnkgXCJhdXRvRXNjYXBlXCIgY2hhcnMgZ2V0XG4gICAgLy8gZXNjYXBlZCwgZXZlbiBpZiBlbmNvZGVVUklDb21wb25lbnQgZG9lc24ndCB0aGluayB0aGV5XG4gICAgLy8gbmVlZCB0byBiZS5cbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGF1dG9Fc2NhcGUubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICB2YXIgYWUgPSBhdXRvRXNjYXBlW2ldO1xuICAgICAgaWYgKHJlc3QuaW5kZXhPZihhZSkgPT09IC0xKVxuICAgICAgICBjb250aW51ZTtcbiAgICAgIHZhciBlc2MgPSBlbmNvZGVVUklDb21wb25lbnQoYWUpO1xuICAgICAgaWYgKGVzYyA9PT0gYWUpIHtcbiAgICAgICAgZXNjID0gZXNjYXBlKGFlKTtcbiAgICAgIH1cbiAgICAgIHJlc3QgPSByZXN0LnNwbGl0KGFlKS5qb2luKGVzYyk7XG4gICAgfVxuICB9XG5cblxuICAvLyBjaG9wIG9mZiBmcm9tIHRoZSB0YWlsIGZpcnN0LlxuICB2YXIgaGFzaCA9IHJlc3QuaW5kZXhPZignIycpO1xuICBpZiAoaGFzaCAhPT0gLTEpIHtcbiAgICAvLyBnb3QgYSBmcmFnbWVudCBzdHJpbmcuXG4gICAgdGhpcy5oYXNoID0gcmVzdC5zdWJzdHIoaGFzaCk7XG4gICAgcmVzdCA9IHJlc3Quc2xpY2UoMCwgaGFzaCk7XG4gIH1cbiAgdmFyIHFtID0gcmVzdC5pbmRleE9mKCc/Jyk7XG4gIGlmIChxbSAhPT0gLTEpIHtcbiAgICB0aGlzLnNlYXJjaCA9IHJlc3Quc3Vic3RyKHFtKTtcbiAgICB0aGlzLnF1ZXJ5ID0gcmVzdC5zdWJzdHIocW0gKyAxKTtcbiAgICBpZiAocGFyc2VRdWVyeVN0cmluZykge1xuICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5c3RyaW5nLnBhcnNlKHRoaXMucXVlcnkpO1xuICAgIH1cbiAgICByZXN0ID0gcmVzdC5zbGljZSgwLCBxbSk7XG4gIH0gZWxzZSBpZiAocGFyc2VRdWVyeVN0cmluZykge1xuICAgIC8vIG5vIHF1ZXJ5IHN0cmluZywgYnV0IHBhcnNlUXVlcnlTdHJpbmcgc3RpbGwgcmVxdWVzdGVkXG4gICAgdGhpcy5zZWFyY2ggPSAnJztcbiAgICB0aGlzLnF1ZXJ5ID0ge307XG4gIH1cbiAgaWYgKHJlc3QpIHRoaXMucGF0aG5hbWUgPSByZXN0O1xuICBpZiAoc2xhc2hlZFByb3RvY29sW2xvd2VyUHJvdG9dICYmXG4gICAgICB0aGlzLmhvc3RuYW1lICYmICF0aGlzLnBhdGhuYW1lKSB7XG4gICAgdGhpcy5wYXRobmFtZSA9ICcvJztcbiAgfVxuXG4gIC8vdG8gc3VwcG9ydCBodHRwLnJlcXVlc3RcbiAgaWYgKHRoaXMucGF0aG5hbWUgfHwgdGhpcy5zZWFyY2gpIHtcbiAgICB2YXIgcCA9IHRoaXMucGF0aG5hbWUgfHwgJyc7XG4gICAgdmFyIHMgPSB0aGlzLnNlYXJjaCB8fCAnJztcbiAgICB0aGlzLnBhdGggPSBwICsgcztcbiAgfVxuXG4gIC8vIGZpbmFsbHksIHJlY29uc3RydWN0IHRoZSBocmVmIGJhc2VkIG9uIHdoYXQgaGFzIGJlZW4gdmFsaWRhdGVkLlxuICB0aGlzLmhyZWYgPSB0aGlzLmZvcm1hdCgpO1xuICByZXR1cm4gdGhpcztcbn07XG5cbi8vIGZvcm1hdCBhIHBhcnNlZCBvYmplY3QgaW50byBhIHVybCBzdHJpbmdcbmZ1bmN0aW9uIHVybEZvcm1hdChvYmopIHtcbiAgLy8gZW5zdXJlIGl0J3MgYW4gb2JqZWN0LCBhbmQgbm90IGEgc3RyaW5nIHVybC5cbiAgLy8gSWYgaXQncyBhbiBvYmosIHRoaXMgaXMgYSBuby1vcC5cbiAgLy8gdGhpcyB3YXksIHlvdSBjYW4gY2FsbCB1cmxfZm9ybWF0KCkgb24gc3RyaW5nc1xuICAvLyB0byBjbGVhbiB1cCBwb3RlbnRpYWxseSB3b25reSB1cmxzLlxuICBpZiAodXRpbC5pc1N0cmluZyhvYmopKSBvYmogPSB1cmxQYXJzZShvYmopO1xuICBpZiAoIShvYmogaW5zdGFuY2VvZiBVcmwpKSByZXR1cm4gVXJsLnByb3RvdHlwZS5mb3JtYXQuY2FsbChvYmopO1xuICByZXR1cm4gb2JqLmZvcm1hdCgpO1xufVxuXG5VcmwucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgYXV0aCA9IHRoaXMuYXV0aCB8fCAnJztcbiAgaWYgKGF1dGgpIHtcbiAgICBhdXRoID0gZW5jb2RlVVJJQ29tcG9uZW50KGF1dGgpO1xuICAgIGF1dGggPSBhdXRoLnJlcGxhY2UoLyUzQS9pLCAnOicpO1xuICAgIGF1dGggKz0gJ0AnO1xuICB9XG5cbiAgdmFyIHByb3RvY29sID0gdGhpcy5wcm90b2NvbCB8fCAnJyxcbiAgICAgIHBhdGhuYW1lID0gdGhpcy5wYXRobmFtZSB8fCAnJyxcbiAgICAgIGhhc2ggPSB0aGlzLmhhc2ggfHwgJycsXG4gICAgICBob3N0ID0gZmFsc2UsXG4gICAgICBxdWVyeSA9ICcnO1xuXG4gIGlmICh0aGlzLmhvc3QpIHtcbiAgICBob3N0ID0gYXV0aCArIHRoaXMuaG9zdDtcbiAgfSBlbHNlIGlmICh0aGlzLmhvc3RuYW1lKSB7XG4gICAgaG9zdCA9IGF1dGggKyAodGhpcy5ob3N0bmFtZS5pbmRleE9mKCc6JykgPT09IC0xID9cbiAgICAgICAgdGhpcy5ob3N0bmFtZSA6XG4gICAgICAgICdbJyArIHRoaXMuaG9zdG5hbWUgKyAnXScpO1xuICAgIGlmICh0aGlzLnBvcnQpIHtcbiAgICAgIGhvc3QgKz0gJzonICsgdGhpcy5wb3J0O1xuICAgIH1cbiAgfVxuXG4gIGlmICh0aGlzLnF1ZXJ5ICYmXG4gICAgICB1dGlsLmlzT2JqZWN0KHRoaXMucXVlcnkpICYmXG4gICAgICBPYmplY3Qua2V5cyh0aGlzLnF1ZXJ5KS5sZW5ndGgpIHtcbiAgICBxdWVyeSA9IHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeSh0aGlzLnF1ZXJ5KTtcbiAgfVxuXG4gIHZhciBzZWFyY2ggPSB0aGlzLnNlYXJjaCB8fCAocXVlcnkgJiYgKCc/JyArIHF1ZXJ5KSkgfHwgJyc7XG5cbiAgaWYgKHByb3RvY29sICYmIHByb3RvY29sLnN1YnN0cigtMSkgIT09ICc6JykgcHJvdG9jb2wgKz0gJzonO1xuXG4gIC8vIG9ubHkgdGhlIHNsYXNoZWRQcm90b2NvbHMgZ2V0IHRoZSAvLy4gIE5vdCBtYWlsdG86LCB4bXBwOiwgZXRjLlxuICAvLyB1bmxlc3MgdGhleSBoYWQgdGhlbSB0byBiZWdpbiB3aXRoLlxuICBpZiAodGhpcy5zbGFzaGVzIHx8XG4gICAgICAoIXByb3RvY29sIHx8IHNsYXNoZWRQcm90b2NvbFtwcm90b2NvbF0pICYmIGhvc3QgIT09IGZhbHNlKSB7XG4gICAgaG9zdCA9ICcvLycgKyAoaG9zdCB8fCAnJyk7XG4gICAgaWYgKHBhdGhuYW1lICYmIHBhdGhuYW1lLmNoYXJBdCgwKSAhPT0gJy8nKSBwYXRobmFtZSA9ICcvJyArIHBhdGhuYW1lO1xuICB9IGVsc2UgaWYgKCFob3N0KSB7XG4gICAgaG9zdCA9ICcnO1xuICB9XG5cbiAgaWYgKGhhc2ggJiYgaGFzaC5jaGFyQXQoMCkgIT09ICcjJykgaGFzaCA9ICcjJyArIGhhc2g7XG4gIGlmIChzZWFyY2ggJiYgc2VhcmNoLmNoYXJBdCgwKSAhPT0gJz8nKSBzZWFyY2ggPSAnPycgKyBzZWFyY2g7XG5cbiAgcGF0aG5hbWUgPSBwYXRobmFtZS5yZXBsYWNlKC9bPyNdL2csIGZ1bmN0aW9uKG1hdGNoKSB7XG4gICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChtYXRjaCk7XG4gIH0pO1xuICBzZWFyY2ggPSBzZWFyY2gucmVwbGFjZSgnIycsICclMjMnKTtcblxuICByZXR1cm4gcHJvdG9jb2wgKyBob3N0ICsgcGF0aG5hbWUgKyBzZWFyY2ggKyBoYXNoO1xufTtcblxuZnVuY3Rpb24gdXJsUmVzb2x2ZShzb3VyY2UsIHJlbGF0aXZlKSB7XG4gIHJldHVybiB1cmxQYXJzZShzb3VyY2UsIGZhbHNlLCB0cnVlKS5yZXNvbHZlKHJlbGF0aXZlKTtcbn1cblxuVXJsLnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24ocmVsYXRpdmUpIHtcbiAgcmV0dXJuIHRoaXMucmVzb2x2ZU9iamVjdCh1cmxQYXJzZShyZWxhdGl2ZSwgZmFsc2UsIHRydWUpKS5mb3JtYXQoKTtcbn07XG5cbmZ1bmN0aW9uIHVybFJlc29sdmVPYmplY3Qoc291cmNlLCByZWxhdGl2ZSkge1xuICBpZiAoIXNvdXJjZSkgcmV0dXJuIHJlbGF0aXZlO1xuICByZXR1cm4gdXJsUGFyc2Uoc291cmNlLCBmYWxzZSwgdHJ1ZSkucmVzb2x2ZU9iamVjdChyZWxhdGl2ZSk7XG59XG5cblVybC5wcm90b3R5cGUucmVzb2x2ZU9iamVjdCA9IGZ1bmN0aW9uKHJlbGF0aXZlKSB7XG4gIGlmICh1dGlsLmlzU3RyaW5nKHJlbGF0aXZlKSkge1xuICAgIHZhciByZWwgPSBuZXcgVXJsKCk7XG4gICAgcmVsLnBhcnNlKHJlbGF0aXZlLCBmYWxzZSwgdHJ1ZSk7XG4gICAgcmVsYXRpdmUgPSByZWw7XG4gIH1cblxuICB2YXIgcmVzdWx0ID0gbmV3IFVybCgpO1xuICB2YXIgdGtleXMgPSBPYmplY3Qua2V5cyh0aGlzKTtcbiAgZm9yICh2YXIgdGsgPSAwOyB0ayA8IHRrZXlzLmxlbmd0aDsgdGsrKykge1xuICAgIHZhciB0a2V5ID0gdGtleXNbdGtdO1xuICAgIHJlc3VsdFt0a2V5XSA9IHRoaXNbdGtleV07XG4gIH1cblxuICAvLyBoYXNoIGlzIGFsd2F5cyBvdmVycmlkZGVuLCBubyBtYXR0ZXIgd2hhdC5cbiAgLy8gZXZlbiBocmVmPVwiXCIgd2lsbCByZW1vdmUgaXQuXG4gIHJlc3VsdC5oYXNoID0gcmVsYXRpdmUuaGFzaDtcblxuICAvLyBpZiB0aGUgcmVsYXRpdmUgdXJsIGlzIGVtcHR5LCB0aGVuIHRoZXJlJ3Mgbm90aGluZyBsZWZ0IHRvIGRvIGhlcmUuXG4gIGlmIChyZWxhdGl2ZS5ocmVmID09PSAnJykge1xuICAgIHJlc3VsdC5ocmVmID0gcmVzdWx0LmZvcm1hdCgpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyBocmVmcyBsaWtlIC8vZm9vL2JhciBhbHdheXMgY3V0IHRvIHRoZSBwcm90b2NvbC5cbiAgaWYgKHJlbGF0aXZlLnNsYXNoZXMgJiYgIXJlbGF0aXZlLnByb3RvY29sKSB7XG4gICAgLy8gdGFrZSBldmVyeXRoaW5nIGV4Y2VwdCB0aGUgcHJvdG9jb2wgZnJvbSByZWxhdGl2ZVxuICAgIHZhciBya2V5cyA9IE9iamVjdC5rZXlzKHJlbGF0aXZlKTtcbiAgICBmb3IgKHZhciByayA9IDA7IHJrIDwgcmtleXMubGVuZ3RoOyByaysrKSB7XG4gICAgICB2YXIgcmtleSA9IHJrZXlzW3JrXTtcbiAgICAgIGlmIChya2V5ICE9PSAncHJvdG9jb2wnKVxuICAgICAgICByZXN1bHRbcmtleV0gPSByZWxhdGl2ZVtya2V5XTtcbiAgICB9XG5cbiAgICAvL3VybFBhcnNlIGFwcGVuZHMgdHJhaWxpbmcgLyB0byB1cmxzIGxpa2UgaHR0cDovL3d3dy5leGFtcGxlLmNvbVxuICAgIGlmIChzbGFzaGVkUHJvdG9jb2xbcmVzdWx0LnByb3RvY29sXSAmJlxuICAgICAgICByZXN1bHQuaG9zdG5hbWUgJiYgIXJlc3VsdC5wYXRobmFtZSkge1xuICAgICAgcmVzdWx0LnBhdGggPSByZXN1bHQucGF0aG5hbWUgPSAnLyc7XG4gICAgfVxuXG4gICAgcmVzdWx0LmhyZWYgPSByZXN1bHQuZm9ybWF0KCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGlmIChyZWxhdGl2ZS5wcm90b2NvbCAmJiByZWxhdGl2ZS5wcm90b2NvbCAhPT0gcmVzdWx0LnByb3RvY29sKSB7XG4gICAgLy8gaWYgaXQncyBhIGtub3duIHVybCBwcm90b2NvbCwgdGhlbiBjaGFuZ2luZ1xuICAgIC8vIHRoZSBwcm90b2NvbCBkb2VzIHdlaXJkIHRoaW5nc1xuICAgIC8vIGZpcnN0LCBpZiBpdCdzIG5vdCBmaWxlOiwgdGhlbiB3ZSBNVVNUIGhhdmUgYSBob3N0LFxuICAgIC8vIGFuZCBpZiB0aGVyZSB3YXMgYSBwYXRoXG4gICAgLy8gdG8gYmVnaW4gd2l0aCwgdGhlbiB3ZSBNVVNUIGhhdmUgYSBwYXRoLlxuICAgIC8vIGlmIGl0IGlzIGZpbGU6LCB0aGVuIHRoZSBob3N0IGlzIGRyb3BwZWQsXG4gICAgLy8gYmVjYXVzZSB0aGF0J3Mga25vd24gdG8gYmUgaG9zdGxlc3MuXG4gICAgLy8gYW55dGhpbmcgZWxzZSBpcyBhc3N1bWVkIHRvIGJlIGFic29sdXRlLlxuICAgIGlmICghc2xhc2hlZFByb3RvY29sW3JlbGF0aXZlLnByb3RvY29sXSkge1xuICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhyZWxhdGl2ZSk7XG4gICAgICBmb3IgKHZhciB2ID0gMDsgdiA8IGtleXMubGVuZ3RoOyB2KyspIHtcbiAgICAgICAgdmFyIGsgPSBrZXlzW3ZdO1xuICAgICAgICByZXN1bHRba10gPSByZWxhdGl2ZVtrXTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdC5ocmVmID0gcmVzdWx0LmZvcm1hdCgpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICByZXN1bHQucHJvdG9jb2wgPSByZWxhdGl2ZS5wcm90b2NvbDtcbiAgICBpZiAoIXJlbGF0aXZlLmhvc3QgJiYgIWhvc3RsZXNzUHJvdG9jb2xbcmVsYXRpdmUucHJvdG9jb2xdKSB7XG4gICAgICB2YXIgcmVsUGF0aCA9IChyZWxhdGl2ZS5wYXRobmFtZSB8fCAnJykuc3BsaXQoJy8nKTtcbiAgICAgIHdoaWxlIChyZWxQYXRoLmxlbmd0aCAmJiAhKHJlbGF0aXZlLmhvc3QgPSByZWxQYXRoLnNoaWZ0KCkpKTtcbiAgICAgIGlmICghcmVsYXRpdmUuaG9zdCkgcmVsYXRpdmUuaG9zdCA9ICcnO1xuICAgICAgaWYgKCFyZWxhdGl2ZS5ob3N0bmFtZSkgcmVsYXRpdmUuaG9zdG5hbWUgPSAnJztcbiAgICAgIGlmIChyZWxQYXRoWzBdICE9PSAnJykgcmVsUGF0aC51bnNoaWZ0KCcnKTtcbiAgICAgIGlmIChyZWxQYXRoLmxlbmd0aCA8IDIpIHJlbFBhdGgudW5zaGlmdCgnJyk7XG4gICAgICByZXN1bHQucGF0aG5hbWUgPSByZWxQYXRoLmpvaW4oJy8nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0LnBhdGhuYW1lID0gcmVsYXRpdmUucGF0aG5hbWU7XG4gICAgfVxuICAgIHJlc3VsdC5zZWFyY2ggPSByZWxhdGl2ZS5zZWFyY2g7XG4gICAgcmVzdWx0LnF1ZXJ5ID0gcmVsYXRpdmUucXVlcnk7XG4gICAgcmVzdWx0Lmhvc3QgPSByZWxhdGl2ZS5ob3N0IHx8ICcnO1xuICAgIHJlc3VsdC5hdXRoID0gcmVsYXRpdmUuYXV0aDtcbiAgICByZXN1bHQuaG9zdG5hbWUgPSByZWxhdGl2ZS5ob3N0bmFtZSB8fCByZWxhdGl2ZS5ob3N0O1xuICAgIHJlc3VsdC5wb3J0ID0gcmVsYXRpdmUucG9ydDtcbiAgICAvLyB0byBzdXBwb3J0IGh0dHAucmVxdWVzdFxuICAgIGlmIChyZXN1bHQucGF0aG5hbWUgfHwgcmVzdWx0LnNlYXJjaCkge1xuICAgICAgdmFyIHAgPSByZXN1bHQucGF0aG5hbWUgfHwgJyc7XG4gICAgICB2YXIgcyA9IHJlc3VsdC5zZWFyY2ggfHwgJyc7XG4gICAgICByZXN1bHQucGF0aCA9IHAgKyBzO1xuICAgIH1cbiAgICByZXN1bHQuc2xhc2hlcyA9IHJlc3VsdC5zbGFzaGVzIHx8IHJlbGF0aXZlLnNsYXNoZXM7XG4gICAgcmVzdWx0LmhyZWYgPSByZXN1bHQuZm9ybWF0KCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHZhciBpc1NvdXJjZUFicyA9IChyZXN1bHQucGF0aG5hbWUgJiYgcmVzdWx0LnBhdGhuYW1lLmNoYXJBdCgwKSA9PT0gJy8nKSxcbiAgICAgIGlzUmVsQWJzID0gKFxuICAgICAgICAgIHJlbGF0aXZlLmhvc3QgfHxcbiAgICAgICAgICByZWxhdGl2ZS5wYXRobmFtZSAmJiByZWxhdGl2ZS5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICcvJ1xuICAgICAgKSxcbiAgICAgIG11c3RFbmRBYnMgPSAoaXNSZWxBYnMgfHwgaXNTb3VyY2VBYnMgfHxcbiAgICAgICAgICAgICAgICAgICAgKHJlc3VsdC5ob3N0ICYmIHJlbGF0aXZlLnBhdGhuYW1lKSksXG4gICAgICByZW1vdmVBbGxEb3RzID0gbXVzdEVuZEFicyxcbiAgICAgIHNyY1BhdGggPSByZXN1bHQucGF0aG5hbWUgJiYgcmVzdWx0LnBhdGhuYW1lLnNwbGl0KCcvJykgfHwgW10sXG4gICAgICByZWxQYXRoID0gcmVsYXRpdmUucGF0aG5hbWUgJiYgcmVsYXRpdmUucGF0aG5hbWUuc3BsaXQoJy8nKSB8fCBbXSxcbiAgICAgIHBzeWNob3RpYyA9IHJlc3VsdC5wcm90b2NvbCAmJiAhc2xhc2hlZFByb3RvY29sW3Jlc3VsdC5wcm90b2NvbF07XG5cbiAgLy8gaWYgdGhlIHVybCBpcyBhIG5vbi1zbGFzaGVkIHVybCwgdGhlbiByZWxhdGl2ZVxuICAvLyBsaW5rcyBsaWtlIC4uLy4uIHNob3VsZCBiZSBhYmxlXG4gIC8vIHRvIGNyYXdsIHVwIHRvIHRoZSBob3N0bmFtZSwgYXMgd2VsbC4gIFRoaXMgaXMgc3RyYW5nZS5cbiAgLy8gcmVzdWx0LnByb3RvY29sIGhhcyBhbHJlYWR5IGJlZW4gc2V0IGJ5IG5vdy5cbiAgLy8gTGF0ZXIgb24sIHB1dCB0aGUgZmlyc3QgcGF0aCBwYXJ0IGludG8gdGhlIGhvc3QgZmllbGQuXG4gIGlmIChwc3ljaG90aWMpIHtcbiAgICByZXN1bHQuaG9zdG5hbWUgPSAnJztcbiAgICByZXN1bHQucG9ydCA9IG51bGw7XG4gICAgaWYgKHJlc3VsdC5ob3N0KSB7XG4gICAgICBpZiAoc3JjUGF0aFswXSA9PT0gJycpIHNyY1BhdGhbMF0gPSByZXN1bHQuaG9zdDtcbiAgICAgIGVsc2Ugc3JjUGF0aC51bnNoaWZ0KHJlc3VsdC5ob3N0KTtcbiAgICB9XG4gICAgcmVzdWx0Lmhvc3QgPSAnJztcbiAgICBpZiAocmVsYXRpdmUucHJvdG9jb2wpIHtcbiAgICAgIHJlbGF0aXZlLmhvc3RuYW1lID0gbnVsbDtcbiAgICAgIHJlbGF0aXZlLnBvcnQgPSBudWxsO1xuICAgICAgaWYgKHJlbGF0aXZlLmhvc3QpIHtcbiAgICAgICAgaWYgKHJlbFBhdGhbMF0gPT09ICcnKSByZWxQYXRoWzBdID0gcmVsYXRpdmUuaG9zdDtcbiAgICAgICAgZWxzZSByZWxQYXRoLnVuc2hpZnQocmVsYXRpdmUuaG9zdCk7XG4gICAgICB9XG4gICAgICByZWxhdGl2ZS5ob3N0ID0gbnVsbDtcbiAgICB9XG4gICAgbXVzdEVuZEFicyA9IG11c3RFbmRBYnMgJiYgKHJlbFBhdGhbMF0gPT09ICcnIHx8IHNyY1BhdGhbMF0gPT09ICcnKTtcbiAgfVxuXG4gIGlmIChpc1JlbEFicykge1xuICAgIC8vIGl0J3MgYWJzb2x1dGUuXG4gICAgcmVzdWx0Lmhvc3QgPSAocmVsYXRpdmUuaG9zdCB8fCByZWxhdGl2ZS5ob3N0ID09PSAnJykgP1xuICAgICAgICAgICAgICAgICAgcmVsYXRpdmUuaG9zdCA6IHJlc3VsdC5ob3N0O1xuICAgIHJlc3VsdC5ob3N0bmFtZSA9IChyZWxhdGl2ZS5ob3N0bmFtZSB8fCByZWxhdGl2ZS5ob3N0bmFtZSA9PT0gJycpID9cbiAgICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZS5ob3N0bmFtZSA6IHJlc3VsdC5ob3N0bmFtZTtcbiAgICByZXN1bHQuc2VhcmNoID0gcmVsYXRpdmUuc2VhcmNoO1xuICAgIHJlc3VsdC5xdWVyeSA9IHJlbGF0aXZlLnF1ZXJ5O1xuICAgIHNyY1BhdGggPSByZWxQYXRoO1xuICAgIC8vIGZhbGwgdGhyb3VnaCB0byB0aGUgZG90LWhhbmRsaW5nIGJlbG93LlxuICB9IGVsc2UgaWYgKHJlbFBhdGgubGVuZ3RoKSB7XG4gICAgLy8gaXQncyByZWxhdGl2ZVxuICAgIC8vIHRocm93IGF3YXkgdGhlIGV4aXN0aW5nIGZpbGUsIGFuZCB0YWtlIHRoZSBuZXcgcGF0aCBpbnN0ZWFkLlxuICAgIGlmICghc3JjUGF0aCkgc3JjUGF0aCA9IFtdO1xuICAgIHNyY1BhdGgucG9wKCk7XG4gICAgc3JjUGF0aCA9IHNyY1BhdGguY29uY2F0KHJlbFBhdGgpO1xuICAgIHJlc3VsdC5zZWFyY2ggPSByZWxhdGl2ZS5zZWFyY2g7XG4gICAgcmVzdWx0LnF1ZXJ5ID0gcmVsYXRpdmUucXVlcnk7XG4gIH0gZWxzZSBpZiAoIXV0aWwuaXNOdWxsT3JVbmRlZmluZWQocmVsYXRpdmUuc2VhcmNoKSkge1xuICAgIC8vIGp1c3QgcHVsbCBvdXQgdGhlIHNlYXJjaC5cbiAgICAvLyBsaWtlIGhyZWY9Jz9mb28nLlxuICAgIC8vIFB1dCB0aGlzIGFmdGVyIHRoZSBvdGhlciB0d28gY2FzZXMgYmVjYXVzZSBpdCBzaW1wbGlmaWVzIHRoZSBib29sZWFuc1xuICAgIGlmIChwc3ljaG90aWMpIHtcbiAgICAgIHJlc3VsdC5ob3N0bmFtZSA9IHJlc3VsdC5ob3N0ID0gc3JjUGF0aC5zaGlmdCgpO1xuICAgICAgLy9vY2NhdGlvbmFseSB0aGUgYXV0aCBjYW4gZ2V0IHN0dWNrIG9ubHkgaW4gaG9zdFxuICAgICAgLy90aGlzIGVzcGVjaWFsbHkgaGFwcGVucyBpbiBjYXNlcyBsaWtlXG4gICAgICAvL3VybC5yZXNvbHZlT2JqZWN0KCdtYWlsdG86bG9jYWwxQGRvbWFpbjEnLCAnbG9jYWwyQGRvbWFpbjInKVxuICAgICAgdmFyIGF1dGhJbkhvc3QgPSByZXN1bHQuaG9zdCAmJiByZXN1bHQuaG9zdC5pbmRleE9mKCdAJykgPiAwID9cbiAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lmhvc3Quc3BsaXQoJ0AnKSA6IGZhbHNlO1xuICAgICAgaWYgKGF1dGhJbkhvc3QpIHtcbiAgICAgICAgcmVzdWx0LmF1dGggPSBhdXRoSW5Ib3N0LnNoaWZ0KCk7XG4gICAgICAgIHJlc3VsdC5ob3N0ID0gcmVzdWx0Lmhvc3RuYW1lID0gYXV0aEluSG9zdC5zaGlmdCgpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXN1bHQuc2VhcmNoID0gcmVsYXRpdmUuc2VhcmNoO1xuICAgIHJlc3VsdC5xdWVyeSA9IHJlbGF0aXZlLnF1ZXJ5O1xuICAgIC8vdG8gc3VwcG9ydCBodHRwLnJlcXVlc3RcbiAgICBpZiAoIXV0aWwuaXNOdWxsKHJlc3VsdC5wYXRobmFtZSkgfHwgIXV0aWwuaXNOdWxsKHJlc3VsdC5zZWFyY2gpKSB7XG4gICAgICByZXN1bHQucGF0aCA9IChyZXN1bHQucGF0aG5hbWUgPyByZXN1bHQucGF0aG5hbWUgOiAnJykgK1xuICAgICAgICAgICAgICAgICAgICAocmVzdWx0LnNlYXJjaCA/IHJlc3VsdC5zZWFyY2ggOiAnJyk7XG4gICAgfVxuICAgIHJlc3VsdC5ocmVmID0gcmVzdWx0LmZvcm1hdCgpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBpZiAoIXNyY1BhdGgubGVuZ3RoKSB7XG4gICAgLy8gbm8gcGF0aCBhdCBhbGwuICBlYXN5LlxuICAgIC8vIHdlJ3ZlIGFscmVhZHkgaGFuZGxlZCB0aGUgb3RoZXIgc3R1ZmYgYWJvdmUuXG4gICAgcmVzdWx0LnBhdGhuYW1lID0gbnVsbDtcbiAgICAvL3RvIHN1cHBvcnQgaHR0cC5yZXF1ZXN0XG4gICAgaWYgKHJlc3VsdC5zZWFyY2gpIHtcbiAgICAgIHJlc3VsdC5wYXRoID0gJy8nICsgcmVzdWx0LnNlYXJjaDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0LnBhdGggPSBudWxsO1xuICAgIH1cbiAgICByZXN1bHQuaHJlZiA9IHJlc3VsdC5mb3JtYXQoKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gaWYgYSB1cmwgRU5EcyBpbiAuIG9yIC4uLCB0aGVuIGl0IG11c3QgZ2V0IGEgdHJhaWxpbmcgc2xhc2guXG4gIC8vIGhvd2V2ZXIsIGlmIGl0IGVuZHMgaW4gYW55dGhpbmcgZWxzZSBub24tc2xhc2h5LFxuICAvLyB0aGVuIGl0IG11c3QgTk9UIGdldCBhIHRyYWlsaW5nIHNsYXNoLlxuICB2YXIgbGFzdCA9IHNyY1BhdGguc2xpY2UoLTEpWzBdO1xuICB2YXIgaGFzVHJhaWxpbmdTbGFzaCA9IChcbiAgICAgIChyZXN1bHQuaG9zdCB8fCByZWxhdGl2ZS5ob3N0IHx8IHNyY1BhdGgubGVuZ3RoID4gMSkgJiZcbiAgICAgIChsYXN0ID09PSAnLicgfHwgbGFzdCA9PT0gJy4uJykgfHwgbGFzdCA9PT0gJycpO1xuXG4gIC8vIHN0cmlwIHNpbmdsZSBkb3RzLCByZXNvbHZlIGRvdWJsZSBkb3RzIHRvIHBhcmVudCBkaXJcbiAgLy8gaWYgdGhlIHBhdGggdHJpZXMgdG8gZ28gYWJvdmUgdGhlIHJvb3QsIGB1cGAgZW5kcyB1cCA+IDBcbiAgdmFyIHVwID0gMDtcbiAgZm9yICh2YXIgaSA9IHNyY1BhdGgubGVuZ3RoOyBpID49IDA7IGktLSkge1xuICAgIGxhc3QgPSBzcmNQYXRoW2ldO1xuICAgIGlmIChsYXN0ID09PSAnLicpIHtcbiAgICAgIHNyY1BhdGguc3BsaWNlKGksIDEpO1xuICAgIH0gZWxzZSBpZiAobGFzdCA9PT0gJy4uJykge1xuICAgICAgc3JjUGF0aC5zcGxpY2UoaSwgMSk7XG4gICAgICB1cCsrO1xuICAgIH0gZWxzZSBpZiAodXApIHtcbiAgICAgIHNyY1BhdGguc3BsaWNlKGksIDEpO1xuICAgICAgdXAtLTtcbiAgICB9XG4gIH1cblxuICAvLyBpZiB0aGUgcGF0aCBpcyBhbGxvd2VkIHRvIGdvIGFib3ZlIHRoZSByb290LCByZXN0b3JlIGxlYWRpbmcgLi5zXG4gIGlmICghbXVzdEVuZEFicyAmJiAhcmVtb3ZlQWxsRG90cykge1xuICAgIGZvciAoOyB1cC0tOyB1cCkge1xuICAgICAgc3JjUGF0aC51bnNoaWZ0KCcuLicpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChtdXN0RW5kQWJzICYmIHNyY1BhdGhbMF0gIT09ICcnICYmXG4gICAgICAoIXNyY1BhdGhbMF0gfHwgc3JjUGF0aFswXS5jaGFyQXQoMCkgIT09ICcvJykpIHtcbiAgICBzcmNQYXRoLnVuc2hpZnQoJycpO1xuICB9XG5cbiAgaWYgKGhhc1RyYWlsaW5nU2xhc2ggJiYgKHNyY1BhdGguam9pbignLycpLnN1YnN0cigtMSkgIT09ICcvJykpIHtcbiAgICBzcmNQYXRoLnB1c2goJycpO1xuICB9XG5cbiAgdmFyIGlzQWJzb2x1dGUgPSBzcmNQYXRoWzBdID09PSAnJyB8fFxuICAgICAgKHNyY1BhdGhbMF0gJiYgc3JjUGF0aFswXS5jaGFyQXQoMCkgPT09ICcvJyk7XG5cbiAgLy8gcHV0IHRoZSBob3N0IGJhY2tcbiAgaWYgKHBzeWNob3RpYykge1xuICAgIHJlc3VsdC5ob3N0bmFtZSA9IHJlc3VsdC5ob3N0ID0gaXNBYnNvbHV0ZSA/ICcnIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyY1BhdGgubGVuZ3RoID8gc3JjUGF0aC5zaGlmdCgpIDogJyc7XG4gICAgLy9vY2NhdGlvbmFseSB0aGUgYXV0aCBjYW4gZ2V0IHN0dWNrIG9ubHkgaW4gaG9zdFxuICAgIC8vdGhpcyBlc3BlY2lhbGx5IGhhcHBlbnMgaW4gY2FzZXMgbGlrZVxuICAgIC8vdXJsLnJlc29sdmVPYmplY3QoJ21haWx0bzpsb2NhbDFAZG9tYWluMScsICdsb2NhbDJAZG9tYWluMicpXG4gICAgdmFyIGF1dGhJbkhvc3QgPSByZXN1bHQuaG9zdCAmJiByZXN1bHQuaG9zdC5pbmRleE9mKCdAJykgPiAwID9cbiAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5ob3N0LnNwbGl0KCdAJykgOiBmYWxzZTtcbiAgICBpZiAoYXV0aEluSG9zdCkge1xuICAgICAgcmVzdWx0LmF1dGggPSBhdXRoSW5Ib3N0LnNoaWZ0KCk7XG4gICAgICByZXN1bHQuaG9zdCA9IHJlc3VsdC5ob3N0bmFtZSA9IGF1dGhJbkhvc3Quc2hpZnQoKTtcbiAgICB9XG4gIH1cblxuICBtdXN0RW5kQWJzID0gbXVzdEVuZEFicyB8fCAocmVzdWx0Lmhvc3QgJiYgc3JjUGF0aC5sZW5ndGgpO1xuXG4gIGlmIChtdXN0RW5kQWJzICYmICFpc0Fic29sdXRlKSB7XG4gICAgc3JjUGF0aC51bnNoaWZ0KCcnKTtcbiAgfVxuXG4gIGlmICghc3JjUGF0aC5sZW5ndGgpIHtcbiAgICByZXN1bHQucGF0aG5hbWUgPSBudWxsO1xuICAgIHJlc3VsdC5wYXRoID0gbnVsbDtcbiAgfSBlbHNlIHtcbiAgICByZXN1bHQucGF0aG5hbWUgPSBzcmNQYXRoLmpvaW4oJy8nKTtcbiAgfVxuXG4gIC8vdG8gc3VwcG9ydCByZXF1ZXN0Lmh0dHBcbiAgaWYgKCF1dGlsLmlzTnVsbChyZXN1bHQucGF0aG5hbWUpIHx8ICF1dGlsLmlzTnVsbChyZXN1bHQuc2VhcmNoKSkge1xuICAgIHJlc3VsdC5wYXRoID0gKHJlc3VsdC5wYXRobmFtZSA/IHJlc3VsdC5wYXRobmFtZSA6ICcnKSArXG4gICAgICAgICAgICAgICAgICAocmVzdWx0LnNlYXJjaCA/IHJlc3VsdC5zZWFyY2ggOiAnJyk7XG4gIH1cbiAgcmVzdWx0LmF1dGggPSByZWxhdGl2ZS5hdXRoIHx8IHJlc3VsdC5hdXRoO1xuICByZXN1bHQuc2xhc2hlcyA9IHJlc3VsdC5zbGFzaGVzIHx8IHJlbGF0aXZlLnNsYXNoZXM7XG4gIHJlc3VsdC5ocmVmID0gcmVzdWx0LmZvcm1hdCgpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcblxuVXJsLnByb3RvdHlwZS5wYXJzZUhvc3QgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGhvc3QgPSB0aGlzLmhvc3Q7XG4gIHZhciBwb3J0ID0gcG9ydFBhdHRlcm4uZXhlYyhob3N0KTtcbiAgaWYgKHBvcnQpIHtcbiAgICBwb3J0ID0gcG9ydFswXTtcbiAgICBpZiAocG9ydCAhPT0gJzonKSB7XG4gICAgICB0aGlzLnBvcnQgPSBwb3J0LnN1YnN0cigxKTtcbiAgICB9XG4gICAgaG9zdCA9IGhvc3Quc3Vic3RyKDAsIGhvc3QubGVuZ3RoIC0gcG9ydC5sZW5ndGgpO1xuICB9XG4gIGlmIChob3N0KSB0aGlzLmhvc3RuYW1lID0gaG9zdDtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/url/url.js\n");

/***/ }),

/***/ "./node_modules/url/util.js":
/*!**********************************!*\
  !*** ./node_modules/url/util.js ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvdXJsL3V0aWwuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvdXJsL3V0aWwuanM/MzVlOCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBpc1N0cmluZzogZnVuY3Rpb24oYXJnKSB7XG4gICAgcmV0dXJuIHR5cGVvZihhcmcpID09PSAnc3RyaW5nJztcbiAgfSxcbiAgaXNPYmplY3Q6IGZ1bmN0aW9uKGFyZykge1xuICAgIHJldHVybiB0eXBlb2YoYXJnKSA9PT0gJ29iamVjdCcgJiYgYXJnICE9PSBudWxsO1xuICB9LFxuICBpc051bGw6IGZ1bmN0aW9uKGFyZykge1xuICAgIHJldHVybiBhcmcgPT09IG51bGw7XG4gIH0sXG4gIGlzTnVsbE9yVW5kZWZpbmVkOiBmdW5jdGlvbihhcmcpIHtcbiAgICByZXR1cm4gYXJnID09IG51bGw7XG4gIH1cbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/url/util.js\n");

/***/ })

}]);